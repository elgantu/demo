/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t,n,r,a={538:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=async e=>{const t=document.createElement("video");return t.srcObject=e,await t.play(),t}},413:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>l});var a=n(482),i=e([a]);a=(i.then?(await i)():i)[0];const s={video:{frameRate:{ideal:10,max:10},width:1280,height:720}};async function o(){try{return await navigator.mediaDevices.getUserMedia(s)}catch(e){return"NotAllowedError"===e.name?Promise.reject(new Error("Доступ к камере запрещен")):"NotFoundError"===e.name?Promise.reject(new Error("Камера не найдена")):"NotReadableError"===e.name?Promise.reject(new Error("Не удалось получить доступ к камере")):"OverconstrainedError"===e.name||"ConstraintNotSatisfiedError"===e.name?Promise.reject(new Error("Не удалось получить доступ к камере из-за ограничений")):"SecurityError"===e.name?Promise.reject(new Error("Не удалось получить доступ к камере из-за проблем с безопасностью")):Promise.reject(new Error("Не удалось получить доступ к камере"))}}const l=async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const e=await o();return a.Z.streamFromWebcam=e,e}throw new Error("Ваш браузер не поддерживает getUserMedia")};r()}catch(u){r(u)}}))},66:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>s});var a=n(482),i=e([a]);a=(i.then?(await i)():i)[0];const s=async()=>(clearInterval(a.Z.sessionInterval),a.Z.sessionStarted=!1,a.Z.videoPlayed=!1,a.Z.videoStopedFromDetector=!1,a.Z.videoStopedFromButton=!1,a.Z.sessionInterval=null,a.Z.closedEye=!1,a.Z.closedEyeSecond=0,a.Z.streamFromWebcam.getTracks().forEach((e=>{e.stop()})),a.Z.streamFromWebcam=null,a.Z.virtualVideoElement.remove(),a.Z.virtualVideoElement=null,a.Z.virtualCanvasElement.remove(),a.Z.virtualCanvasContext=null,!0);r()}catch(e){r(e)}}))},238:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>o});var a=n(885),i=n(482),s=e([a,i]);[a,i]=s.then?(await s)():s;const o=async()=>{if(a.Z.initialed&&null!=i.Z.virtualVideoElement){i.Z.virtualCanvasContext.drawImage(i.Z.virtualVideoElement,0,0,i.Z.virtualCanvasElement.width,i.Z.virtualCanvasElement.height);let e=await i.Z.virtualCanvasContext.getImageData(0,0,i.Z.virtualCanvasElement.width,i.Z.virtualCanvasElement.height);const t=await i.Z.humanModel.detect(e);console.log(t),e=null;const n=t?.face[0]?.emotion.map((e=>e.score)),r=Math.max(...n,0),s=t?.face[0]?.emotion.filter((e=>e.score==r)),o=t.gesture.filter((e=>0==e.face&&"facing right"==e.gesture)).length>0,l=t.gesture.filter((e=>0==e.face&&"facing left"==e.gesture)).length>0,u=t.gesture.filter((e=>0==e.face&&"blink right eye"==e.gesture)).length>0,d=t.gesture.filter((e=>0==e.face&&"blink left eye"==e.gesture)).length>0,c=t.gesture.filter((e=>0==e.face&&"head up"==e.gesture)).length>0,h=t.gesture.filter((e=>0==e.iris&&"looking down"==e.gesture)).length>0,p=t.gesture.filter((e=>0==e.iris&&"looking left"==e.gesture)).length>0,m=t.gesture.filter((e=>0==e.iris&&"looking right"==e.gesture)).length>0,f=u||d;let g=!(c||o||l||m||p||h);if(g=!!f||g,f){if(0==i.Z.closedEyeSecond&&(i.Z.closedEyeSecond=a.Z.sessionTime),Number(a.Z.sessionTime-i.Z.closedEyeSecond)>500)return i.Z.closedEye=!0,i.Z.player.paused()||(i.Z.player.pause(),i.Z.videoStopedFromDetector=!0),{faces:t?.face.length,age:t?.face[0].age,gender:t?.face[0].gender,emotion:s[0].emotion,gazeCenter:g,blink:f,attention:0}}else i.Z.closedEyeSecond=0;if(i.Z.videoPlayed&&!i.Z.videoStopedFromButton)if(!g||t?.face.length<1){if(!i.Z.player.paused())return i.Z.player.pause(),i.Z.videoStopedFromDetector=!0,{faces:t?.face.length,age:t?.face[0].age,gender:t?.face[0].gender,emotion:s[0].emotion,gazeCenter:g,blink:f,attention:1}}else if(i.Z.player.paused())return i.Z.player.play(),i.Z.videoStopedFromDetector=!1,{faces:t?.face.length,age:t?.face[0].age,gender:t?.face[0].gender,emotion:s[0].emotion,gazeCenter:g,blink:f,attention:0};return!g||t?.face.length<1?{faces:t?.face.length,age:t?.face[0].age,gender:t?.face[0].gender,emotion:s[0].emotion,gazeCenter:g,blink:f,attention:0}:{faces:t?.face.length,age:t?.face[0].age,gender:t?.face[0].gender,emotion:s[0].emotion,gazeCenter:g,blink:f,attention:1}}};r()}catch(e){r(e)}}))},657:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>l});var a=n(413),i=n(538),s=n(482),o=e([a,s]);[a,s]=o.then?(await o)():o;const l=async()=>{const e=await(0,a.Z)(),t=await(0,i.Z)(e);s.Z.virtualVideoElement=t;const n=document.createElement("canvas");n.style.width="100%",n.style.height="100%",n.style.objectFit="contain";const r=n.getContext("2d");return n.width=t.videoWidth,n.height=t.videoHeight,s.Z.virtualCanvasElement=n,s.Z.virtualCanvasContext=r,s.Z.canvasDiv?.appendChild(s.Z.virtualCanvasElement),!0};r()}catch(e){r(e)}}))},529:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>u});var a=n(885),i=n(482),s=n(49),o=n(627),l=e([a,i,s,o]);[a,i,s,o]=l.then?(await l)():l;const u=async(e,t,n)=>{let r,l,u;return e instanceof HTMLDivElement?(r=e,l=t,u=n):e&&"object"==typeof e&&(r=e.videoDiv,l=e.canvasDiv,u=e.videoUrl),!a.Z.initialed&&(a.Z.initialed=!0,await i.Z.humanModel.load(),await i.Z.humanModel.warmup(),i.Z.addSrcToVideoElement(u),r?.appendChild(i.Z.playerVideoElement),i.Z.player=await i.Z.createPlayer(i.Z.playerVideoElement),i.Z.canvasDiv=l,await(0,o.Z)(),await(0,s.Z)(),!0)};r()}catch(e){r(e)}}))},135:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>i});var a=n(279);const e=async()=>await new a.p2({debug:!0,backend:"webgl",modelBasePath:"./",filter:{enabled:!0,equalization:!1,flip:!1},face:{enabled:!0,detector:{rotation:!1},mesh:{enabled:!0},attention:{enabled:!1},iris:{enabled:!0},description:{enabled:!0},emotion:{enabled:!0},antispoof:{enabled:!0},liveness:{enabled:!0}},body:{enabled:!1},hand:{enabled:!1},object:{enabled:!1},segmentation:{enabled:!1},gesture:{enabled:!0}}),i=await e();r()}catch(e){r(e)}}),1)},819:(e,t,n)=>{"use strict";n.a(e,(async(e,t)=>{try{var r=n(885),a=e([r]);r=(a.then?(await a)():a)[0],window.BICWeb=r.Z,t()}catch(e){t(e)}}))},504:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=e=>{let t=0;for(let n=0;n<e.length;n+=1)t+=e[n];return Math.round(t/e.length*100)}},885:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>l});var a=n(66),i=n(529),s=n(329),o=e([a,i,s]);[a,i,s]=o.then?(await o)():o;const l={initial:i.Z,initialed:!1,videoElement:null,indixesAttentionValue:0,sessionTime:0,changeVideo:s.Z,sessionIndexes:[{second:0,indexes:[]}],get deactivated(){return(0,a.Z)()}};r()}catch(e){r(e)}}))},482:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>u});var a=n(135),i=n(512),s=n(780),o=n(922),l=e([a,i,o]);[a,i,o]=l.then?(await l)():l;const u={humanModel:a.Z,virtualVideoElement:null,virtualCanvasElement:null,virtualCanvasContext:null,streamFromWebcam:null,player:null,createPlayer:s.Z,playerVideoElement:i.Z,addSrcToVideoElement:o.Z,sessionStarted:!1,videoPlayed:!1,videoStopedFromDetector:!1,videoStopedFromButton:!1,sessionInterval:null,closedEye:!1,closedEyeSecond:0,canvasDiv:void 0,indixesAttention:[]};r()}catch(e){r(e)}}))},922:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>s});var a=n(482),i=e([a]);a=(i.then?(await i)():i)[0];const s=async e=>(a.Z.playerVideoElement.src=e,!0);r()}catch(e){r(e)}}))},329:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>o});var a=n(885),i=n(482),s=e([a,i]);[a,i]=s.then?(await s)():s;const o=async e=>(i.Z.player.src(e),a.Z.deactivated,i.Z.player.pause(),i.Z.player.currentTime(0),i.Z.player.load(),!0);r()}catch(e){r(e)}}))},780:(e,t,n)=>{"use strict";n.d(t,{Z:()=>gu});var r=n(908),a=n.n(r),i=n(144),s=n.n(i),o=n(537),l=n.n(o),u=n(974),d=n.n(u),c=n(603),h=n.n(c),p=n(407),m=n.n(p),f=n(945),g=n.n(f);function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y.apply(this,arguments)}var b=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,r=0;r<n;++r)t[r].call(this,arguments[1]);else for(var a=Array.prototype.slice.call(arguments,1),i=t.length,s=0;s<i;++s)t[s].apply(this,a)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}();function x(e){for(var t,n=(t=e,a().atob?a().atob(t):Buffer.from(t,"base64").toString("binary")),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class A extends b{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const v=String.fromCharCode(9),w=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),n={};return t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),n},k=function(e){const t={};if(!e)return t;const n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let r,a=n.length;for(;a--;)""!==n[a]&&(r=/([^=]*)=(.*)/.exec(n[a]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),t[r[0]]=r[1]);return t};class S extends b{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce(((t,n)=>{const r=n(e);return r===e?t:t.concat([r])}),[e]).forEach((e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void this.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void this.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return n=y(w(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"map"},t[1]){const e=k(t[1]);e.URI&&(n.uri=e.URI),e.BYTERANGE&&(n.byterange=w(e.BYTERANGE))}this.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=k(t[1]),n.attributes.RESOLUTION){const e=n.attributes.RESOLUTION.split("x"),t={};e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),n.attributes.RESOLUTION=t}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}this.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=k(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=k(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=k(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"skip"},n.attributes=k(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(v)),void this.trigger("data",n);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part"},n.attributes=k(t[1]),["DURATION"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["INDEPENDENT","GAP"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))})),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=w(n.attributes.BYTERANGE)),void this.trigger("data",n);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"server-control"},n.attributes=k(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))})),void this.trigger("data",n);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part-inf"},n.attributes=k(t[1]),["PART-TARGET"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),void this.trigger("data",n);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"preload-hint"},n.attributes=k(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(e){if(n.attributes.hasOwnProperty(e)){n.attributes[e]=parseInt(n.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[t]=n.attributes[e],delete n.attributes[e]}})),void this.trigger("data",n);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"rendition-report"},n.attributes=k(t[1]),["LAST-MSN","LAST-PART"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseInt(n.attributes[e],10))})),void this.trigger("data",n);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=k(t[1]),["ID","CLASS"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=String(n.attributes[e]))})),["START-DATE","END-DATE"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=new Date(n.attributes[e]))})),["DURATION","PLANNED-DURATION"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["END-ON-NEXT"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/i.test(n.attributes[e]))})),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=n.attributes[e].toString(16))}));const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in n.attributes){if(!e.test(t))continue;const r=/[0-9A-Fa-f]{6}/g.test(n.attributes[t]),a=/^\d+(\.\d+)?$/.test(n.attributes[t]);n.attributes[t]=r?n.attributes[t].toString(16):a?parseFloat(n.attributes[t]):String(n.attributes[t])}this.trigger("data",n)}else t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t?this.trigger("data",{type:"tag",tagType:"independent-segments"}):this.trigger("data",{type:"tag",data:e.slice(4)})}}}else this.trigger("data",{type:"comment",text:e.slice(1)})})):this.trigger("data",{type:"uri",uri:e}))}addParser({expression:e,customType:t,dataParser:n,segment:r}){"function"!=typeof n&&(n=e=>e),this.customParsers.push((a=>{if(e.exec(a))return this.trigger("data",{type:"custom",data:n(a),customType:t,segment:r}),!0}))}addTagMapper({expression:e,map:t}){this.tagMappers.push((n=>e.test(n)?t(n):n))}}const T=function(e){const t={};return Object.keys(e).forEach((function(n){var r;t[(r=n,r.toLowerCase().replace(/-(\w)/g,(e=>e[1].toUpperCase())))]=e[n]})),t},_=function(e){const{serverControl:t,targetDuration:n,partTargetDuration:r}=e;if(!t)return;const a="#EXT-X-SERVER-CONTROL",i="holdBack",s="partHoldBack",o=n&&3*n,l=r&&2*r;n&&!t.hasOwnProperty(i)&&(t[i]=o,this.trigger("info",{message:`${a} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&t[i]<o&&(this.trigger("warn",{message:`${a} clamping HOLD-BACK (${t[i]}) to targetDuration * 3 (${o})`}),t[i]=o),r&&!t.hasOwnProperty(s)&&(t[s]=3*r,this.trigger("info",{message:`${a} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[s]}).`})),r&&t[s]<l&&(this.trigger("warn",{message:`${a} clamping PART-HOLD-BACK (${t[s]}) to partTargetDuration * 2 (${l}).`}),t[s]=l)};class I extends b{constructor(){super(),this.lineStream=new A,this.parseStream=new S,this.lineStream.pipe(this.parseStream);const e=this,t=[];let n,r,a={},i=!1;const s=function(){},o={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let l=0;this.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};let u=0,d=0;const c={};this.on("end",(()=>{a.uri||!a.parts&&!a.preloadHints||(!a.map&&n&&(a.map=n),!a.key&&r&&(a.key=r),a.timeline||"number"!=typeof l||(a.timeline=l),this.manifest.preloadSegment=a)})),this.parseStream.on("data",(function(h){let p,m;({tag(){({version(){h.version&&(this.manifest.version=h.version)},"allow-cache"(){this.manifest.allowCache=h.allowed,"allowed"in h||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const e={};"length"in h&&(a.byterange=e,e.length=h.length,"offset"in h||(h.offset=u)),"offset"in h&&(a.byterange=e,e.offset=h.offset),u=e.offset+e.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),h.duration>0&&(a.duration=h.duration),0===h.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(h.attributes)if("NONE"!==h.attributes.METHOD)if(h.attributes.URI){if("com.apple.streamingkeydelivery"===h.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:h.attributes});if("com.microsoft.playready"===h.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:h.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===h.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(h.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===h.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==h.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):h.attributes.KEYID&&"0x"===h.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:h.attributes.KEYFORMAT,keyId:h.attributes.KEYID.substring(2)},pssh:x(h.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));h.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:h.attributes.METHOD||"AES-128",uri:h.attributes.URI},void 0!==h.attributes.IV&&(r.iv=h.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(h.number)?this.manifest.mediaSequence=h.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+h.number})},"discontinuity-sequence"(){isFinite(h.number)?(this.manifest.discontinuitySequence=h.number,l=h.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+h.number})},"playlist-type"(){/VOD|EVENT/.test(h.playlistType)?this.manifest.playlistType=h.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+h.playlist})},map(){n={},h.uri&&(n.uri=h.uri),h.byterange&&(n.byterange=h.byterange),r&&(n.key=r)},"stream-inf"(){this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||o,h.attributes?(a.attributes||(a.attributes={}),y(a.attributes,h.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||o,!(h.attributes&&h.attributes.TYPE&&h.attributes["GROUP-ID"]&&h.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const e=this.manifest.mediaGroups[h.attributes.TYPE];e[h.attributes["GROUP-ID"]]=e[h.attributes["GROUP-ID"]]||{},p=e[h.attributes["GROUP-ID"]],m={default:/yes/i.test(h.attributes.DEFAULT)},m.default?m.autoselect=!0:m.autoselect=/yes/i.test(h.attributes.AUTOSELECT),h.attributes.LANGUAGE&&(m.language=h.attributes.LANGUAGE),h.attributes.URI&&(m.uri=h.attributes.URI),h.attributes["INSTREAM-ID"]&&(m.instreamId=h.attributes["INSTREAM-ID"]),h.attributes.CHARACTERISTICS&&(m.characteristics=h.attributes.CHARACTERISTICS),h.attributes.FORCED&&(m.forced=/yes/i.test(h.attributes.FORCED)),p[h.attributes.NAME]=m},discontinuity(){l+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=h.dateTimeString,this.manifest.dateTimeObject=h.dateTimeObject),a.dateTimeString=h.dateTimeString,a.dateTimeObject=h.dateTimeObject},targetduration(){!isFinite(h.duration)||h.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+h.duration}):(this.manifest.targetDuration=h.duration,_.call(this,this.manifest))},start(){h.attributes&&!isNaN(h.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:h.attributes["TIME-OFFSET"],precise:h.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){a.cueOut=h.data},"cue-out-cont"(){a.cueOutCont=h.data},"cue-in"(){a.cueIn=h.data},skip(){this.manifest.skip=T(h.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",h.attributes,["SKIPPED-SEGMENTS"])},part(){i=!0;const e=this.manifest.segments.length,t=T(h.attributes);a.parts=a.parts||[],a.parts.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=d),d=t.byterange.offset+t.byterange.length);const n=a.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${n} for segment #${e}`,h.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})}))},"server-control"(){const e=this.manifest.serverControl=T(h.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),_.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const e=this.manifest.segments.length,t=T(h.attributes),n=t.type&&"PART"===t.type;a.preloadHints=a.preloadHints||[],a.preloadHints.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=n?d:0,n&&(d=t.byterange.offset+t.byterange.length)));const r=a.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${r} for segment #${e}`,h.attributes,["TYPE","URI"]),t.type)for(let n=0;n<a.preloadHints.length-1;n++){const i=a.preloadHints[n];i.type&&i.type===t.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${r} for segment #${e} has the same TYPE ${t.type} as preload hint #${n}`})}},"rendition-report"(){const e=T(h.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);const t=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];i&&n.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${t}`,h.attributes,n)},"part-inf"(){this.manifest.partInf=T(h.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",h.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),_.call(this,this.manifest)},daterange(){this.manifest.daterange=this.manifest.daterange||[],this.manifest.daterange.push(T(h.attributes));const e=this.manifest.daterange.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${e}`,h.attributes,["ID","START-DATE"]);const t=this.manifest.daterange[e];t.endDate&&t.startDate&&new Date(t.endDate)<new Date(t.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),t.duration&&t.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),t.plannedDuration&&t.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const n=!!t.endOnNext;if(n&&!t.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),n&&(t.duration||t.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),t.duration&&t.endDate){const n=t.startDate,r=n.setSeconds(n.getSeconds()+t.duration);this.manifest.daterange[e].endDate=new Date(r)}if(t&&!this.manifest.dateTimeString&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),c[t.id]){for(const e in c[t.id])if(c[t.id][e]!==t[e]){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes and same attribute values"});break}}else c[t.id]=t},"independent-segments"(){this.manifest.independentSegments=!0}}[h.tagType]||s).call(e)},uri(){a.uri=h.uri,t.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),r&&(a.key=r),a.timeline=l,n&&(a.map=n),d=0,a={}},comment(){},custom(){h.segment?(a.custom=a.custom||{},a.custom[h.customType]=h.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[h.customType]=h.data)}})[h.type].call(e)}))}warnOnMissingAttributes_(e,t,n){const r=[];n.forEach((function(e){t.hasOwnProperty(e)||r.push(e)})),r.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${r.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var C,E,N={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},R=["video","audio","text"],P=["Video","Audio","Text"],D=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,(function(e,t,n){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)})):e},M=function(e){void 0===e&&(e="");var t=e.split(","),n=[];return t.forEach((function(e){var t;e=e.trim(),R.forEach((function(r){var a=N[r].exec(e.toLowerCase());if(a&&!(a.length<=1)){t=r;var i=e.substring(0,a[1].length),s=e.replace(i,"");n.push({type:i,details:s,mediaType:r})}})),t||n.push({type:e,details:"",mediaType:"unknown"})})),n},O=function(e){return void 0===e&&(e=""),N.audio.test(e.trim().toLowerCase())},$=function(e){if(e&&"string"==typeof e){var t,n=e.toLowerCase().split(",").map((function(e){return D(e.trim())})),r="video";1===n.length&&O(n[0])?r="audio":1===n.length&&(void 0===(t=n[0])&&(t=""),N.text.test(t.trim().toLowerCase()))&&(r="application");var a="mp4";return n.every((function(e){return N.mp4.test(e)}))?a="mp4":n.every((function(e){return N.webm.test(e)}))?a="webm":n.every((function(e){return N.ogg.test(e)}))&&(a="ogg"),r+"/"+a+';codecs="'+e+'"'}},F=function(e){return void 0===e&&(e=""),a().MediaSource&&a().MediaSource.isTypeSupported&&a().MediaSource.isTypeSupported($(e))||!1},L=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every((function(e){e=e.trim();for(var t=0;t<P.length;t++)if(N["muxer"+P[t]].test(e))return!0;return!1}))},z="mp4a.40.2",B=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,U=/^application\/dash\+xml/i,W=function(e){return B.test(e)?"hls":U.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null},V=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},j=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||V(e)||e instanceof ArrayBuffer||(e="number"!=typeof e||"number"==typeof e&&e!=e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},H=a().BigInt||Number,G=[H("0x1"),H("0x100"),H("0x10000"),H("0x1000000"),H("0x100000000"),H("0x10000000000"),H("0x1000000000000"),H("0x100000000000000"),H("0x10000000000000000")],q=(C=new Uint16Array([65484]),255===(E=new Uint8Array(C.buffer,C.byteOffset,C.byteLength))[0]||E[0],function(e,t){var n=void 0===t?{}:t,r=n.signed,a=void 0!==r&&r,i=n.le,s=void 0!==i&&i;e=j(e);var o=s?"reduce":"reduceRight",l=(e[o]?e[o]:Array.prototype[o]).call(e,(function(t,n,r){var a=s?r:Math.abs(r+1-e.length);return t+H(n)*G[a]}),H(0));if(a){var u=G[e.length]/H(2)-H(1);(l=H(l))>u&&(l-=u,l-=u,l-=H(2))}return Number(l)}),X=function(e,t){if("string"!=typeof e&&e&&"function"==typeof e.toString&&(e=e.toString()),"string"!=typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},K=function(e,t,n){var r=void 0===n?{}:n,a=r.offset,i=void 0===a?0:a,s=r.mask,o=void 0===s?[]:s;e=j(e);var l=(t=j(t)).every?t.every:Array.prototype.every;return t.length&&e.length-i>=t.length&&l.call(t,(function(t,n){return t===(o[n]?o[n]&e[i+n]:e[i+n])}))};const Z=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=a().location&&a().location.href||"");var n="function"==typeof a().URL,r=/^\/\//.test(e),i=!a().location&&!/\/\//i.test(e);if(n?e=new(a().URL)(e,a().location||"http://example.com"):/\/\//i.test(e)||(e=g().buildAbsoluteURL(a().location&&a().location.href||"",e)),n){var s=new URL(t,e);return i?s.href.slice(18):r?s.href.slice(s.protocol.length):s.href}return g().buildAbsoluteURL(e,t)};var Y=n(969);const J=e=>!!e&&"object"==typeof e,Q=(...e)=>e.reduce(((e,t)=>("object"!=typeof t||Object.keys(t).forEach((n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):J(e[n])&&J(t[n])?e[n]=Q(e[n],t[n]):e[n]=t[n]})),e)),{}),ee=e=>Object.keys(e).map((t=>e[t])),te=e=>e.reduce(((e,t)=>e.concat(t)),[]),ne=e=>{if(!e.length)return[];const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t};const re=({baseUrl:e="",source:t="",range:n="",indexRange:r=""})=>{const i={uri:t,resolvedUri:Z(e||"",t)};if(n||r){const e=(n||r).split("-");let t,s=a().BigInt?a().BigInt(e[0]):parseInt(e[0],10),o=a().BigInt?a().BigInt(e[1]):parseInt(e[1],10);s<Number.MAX_SAFE_INTEGER&&"bigint"==typeof s&&(s=Number(s)),o<Number.MAX_SAFE_INTEGER&&"bigint"==typeof o&&(o=Number(o)),t="bigint"==typeof o||"bigint"==typeof s?a().BigInt(o)-a().BigInt(s)+a().BigInt(1):o-s+1,"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),i.byterange={length:t,offset:s}}return i},ae=e=>(e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e),ie={static(e){const{duration:t,timescale:n=1,sourceDuration:r,periodDuration:a}=e,i=ae(e.endNumber),s=t/n;return"number"==typeof i?{start:0,end:i}:"number"==typeof a?{start:0,end:a/s}:{start:0,end:r/s}},dynamic(e){const{NOW:t,clientOffset:n,availabilityStartTime:r,timescale:a=1,duration:i,periodStart:s=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=e,u=ae(e.endNumber),d=(t+n)/1e3,c=r+s,h=d+o-c,p=Math.ceil(h*a/i),m=Math.floor((d-c-l)*a/i),f=Math.floor((d-c)*a/i);return{start:Math.max(0,m),end:"number"==typeof u?u:Math.min(p,f)}}},se=e=>{const{type:t,duration:n,timescale:r=1,periodDuration:a,sourceDuration:i}=e,{start:s,end:o}=ie[t](e),l=((e,t)=>{const n=[];for(let r=e;r<t;r++)n.push(r);return n})(s,o).map((e=>t=>{const{duration:n,timescale:r=1,periodStart:a,startNumber:i=1}=e;return{number:i+t,duration:n/r,timeline:a,time:t*n}})(e));if("static"===t){const e=l.length-1,t="number"==typeof a?a:i;l[e].duration=t-n/r*e}return l},oe=e=>{const{baseUrl:t,initialization:n={},sourceDuration:r,indexRange:a="",periodStart:i,presentationTime:s,number:o=0,duration:l}=e;if(!t)throw new Error("NO_BASE_URL");const u=re({baseUrl:t,source:n.sourceURL,range:n.range}),d=re({baseUrl:t,source:t,indexRange:a});if(d.map=u,l){const t=se(e);t.length&&(d.duration=t[0].duration,d.timeline=t[0].timeline)}else r&&(d.duration=r,d.timeline=i);return d.presentationTime=s||i,d.number=o,[d]},le=(e,t,n)=>{const r=e.sidx.map?e.sidx.map:null,i=e.sidx.duration,s=e.timeline||0,o=e.sidx.byterange,l=o.offset+o.length,u=t.timescale,d=t.references.filter((e=>1!==e.referenceType)),c=[],h=e.endList?"static":"dynamic",p=e.sidx.timeline;let m,f=p,g=e.mediaSequence||0;m="bigint"==typeof t.firstOffset?a().BigInt(l)+t.firstOffset:l+t.firstOffset;for(let e=0;e<d.length;e++){const o=t.references[e],l=o.referencedSize,d=o.subsegmentDuration;let y;y="bigint"==typeof m?m+a().BigInt(l)-a().BigInt(1):m+l-1;const b=oe({baseUrl:n,timescale:u,timeline:s,periodStart:p,presentationTime:f,number:g,duration:d,sourceDuration:i,indexRange:`${m}-${y}`,type:h})[0];r&&(b.map=r),c.push(b),m+="bigint"==typeof m?a().BigInt(l):l,f+=d/u,g++}return e.segments=c,e},ue=["AUDIO","SUBTITLES"],de=e=>{return(t=e,n=({timeline:e})=>e,ee(t.reduce(((e,t)=>(t.forEach((t=>{e[n(t)]=t})),e)),{}))).sort(((e,t)=>e.timeline>t.timeline?1:-1));var t,n},ce=e=>{let t=[];var n,r;return n=e,r=(e,n,r,a)=>{t=t.concat(e.playlists||[])},ue.forEach((function(e){for(var t in n.mediaGroups[e])for(var a in n.mediaGroups[e][t]){var i=n.mediaGroups[e][t][a];r(i)}})),t},he=({playlist:e,mediaSequence:t})=>{e.mediaSequence=t,e.segments.forEach(((t,n)=>{t.number=e.mediaSequence+n}))},pe=e=>e&&e.uri+"-"+(e=>{let t;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?a().BigInt(e.offset)+a().BigInt(e.length)-a().BigInt(1):e.offset+e.length-1,`${e.offset}-${t}`})(e.byterange),me=e=>ee(e.reduce(((e,t)=>{const n=t.attributes.id+(t.attributes.lang||"");return e[n]?(t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),e[n].segments.push(...t.segments)),t.attributes.contentProtection&&(e[n].attributes.contentProtection=t.attributes.contentProtection)):(e[n]=t,e[n].attributes.timelineStarts=[]),e[n].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e}),{})).map((e=>{var t;return e.discontinuityStarts=(t=e.segments||[],"discontinuity",t.reduce(((e,t,n)=>(t.discontinuity&&e.push(n),e)),[])),e})),fe=(e,t)=>{const n=pe(e.sidx),r=n&&t[n]&&t[n].sidx;return r&&le(e,r,e.sidx.resolvedUri),e},ge=(e,t={})=>{if(!Object.keys(t).length)return e;for(const n in e)e[n]=fe(e[n],t);return e},ye=({attributes:e,segments:t,sidx:n,discontinuityStarts:r})=>{const a={attributes:{NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:"",targetDuration:e.duration,discontinuityStarts:r,timelineStarts:e.timelineStarts,segments:t};return e.frameRate&&(a.attributes["FRAME-RATE"]=e.frameRate),e.contentProtection&&(a.contentProtection=e.contentProtection),n&&(a.sidx=n),a},be=({attributes:e})=>"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType,xe=({attributes:e})=>"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType,Ae=({attributes:e})=>"text/vtt"===e.mimeType||"text"===e.contentType,ve=e=>e?Object.keys(e).reduce(((t,n)=>{const r=e[n];return t.concat(r.playlists)}),[]):[],we=({dashPlaylists:e,locations:t,sidxMapping:n={},previousManifest:r,eventStream:a})=>{if(!e.length)return{};const{sourceDuration:i,type:s,suggestedPresentationDelay:o,minimumUpdatePeriod:l}=e[0].attributes,u=me(e.filter(be)).map(ye),d=me(e.filter(xe)),c=me(e.filter(Ae)),h=e.map((e=>e.attributes.captionServices)).filter(Boolean),p={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:i,playlists:ge(u,n)};l>=0&&(p.minimumUpdatePeriod=1e3*l),t&&(p.locations=t),"dynamic"===s&&(p.suggestedPresentationDelay=o),a&&a.length>0&&(p.eventStream=a);const m=0===p.playlists.length,f=d.length?((e,t={},n=!1)=>{let r;const a=e.reduce(((e,a)=>{const i=a.attributes.role&&a.attributes.role.value||"",s=a.attributes.lang||"";let o=a.attributes.label||"main";if(s&&!a.attributes.label){const e=i?` (${i})`:"";o=`${a.attributes.lang}${e}`}e[o]||(e[o]={language:s,autoselect:!0,default:"main"===i,playlists:[],uri:""});const l=fe((({attributes:e,segments:t,sidx:n,mediaSequence:r,discontinuitySequence:a,discontinuityStarts:i},s)=>{const o={attributes:{NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:"",targetDuration:e.duration,discontinuitySequence:a,discontinuityStarts:i,timelineStarts:e.timelineStarts,mediaSequence:r,segments:t};return e.contentProtection&&(o.contentProtection=e.contentProtection),n&&(o.sidx=n),s&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o})(a,n),t);return e[o].playlists.push(l),void 0===r&&"main"===i&&(r=a,r.default=!0),e}),{});return r||(a[Object.keys(a)[0]].default=!0),a})(d,n,m):null,g=c.length?((e,t={})=>e.reduce(((e,n)=>{const r=n.attributes.label||n.attributes.lang||"text";return e[r]||(e[r]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),e[r].playlists.push(fe((({attributes:e,segments:t,mediaSequence:n,discontinuityStarts:r,discontinuitySequence:a})=>{void 0===t&&(t=[{uri:e.baseUrl,timeline:e.periodStart,resolvedUri:e.baseUrl||"",duration:e.sourceDuration,number:0}],e.duration=e.sourceDuration);const i={NAME:e.id,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1};return e.codecs&&(i.CODECS=e.codecs),{attributes:i,uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,timelineStarts:e.timelineStarts,discontinuityStarts:r,discontinuitySequence:a,mediaSequence:n,segments:t}})(n),t)),e}),{}))(c,n):null,y=u.concat(ve(f),ve(g)),b=y.map((({timelineStarts:e})=>e));var x,A;return p.timelineStarts=de(b),x=y,A=p.timelineStarts,x.forEach((e=>{e.mediaSequence=0,e.discontinuitySequence=A.findIndex((function({timeline:t}){return t===e.timeline})),e.segments&&e.segments.forEach(((e,t)=>{e.number=t}))})),f&&(p.mediaGroups.AUDIO.audio=f),g&&(p.mediaGroups.SUBTITLES.subs=g),h.length&&(p.mediaGroups["CLOSED-CAPTIONS"].cc=h.reduce(((e,t)=>t?(t.forEach((t=>{const{channel:n,language:r}=t;e[r]={autoselect:!1,default:!1,instreamId:n,language:r},t.hasOwnProperty("aspectRatio")&&(e[r].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[r].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[r]["3D"]=t["3D"])})),e):e),{})),r?(({oldManifest:e,newManifest:t})=>{const n=e.playlists.concat(ce(e)),r=t.playlists.concat(ce(t));return t.timelineStarts=de([e.timelineStarts,t.timelineStarts]),(({oldPlaylists:e,newPlaylists:t,timelineStarts:n})=>{t.forEach((t=>{t.discontinuitySequence=n.findIndex((function({timeline:e}){return e===t.timeline}));const r=((e,t)=>{for(let n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null})(e,t.attributes.NAME);if(!r)return;if(t.sidx)return;const a=t.segments[0],i=r.segments.findIndex((function(e){return Math.abs(e.presentationTime-a.presentationTime)<.016666666666666666}));if(-1===i)return he({playlist:t,mediaSequence:r.mediaSequence+r.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!r.segments.length&&t.timeline>r.timeline||r.segments.length&&t.timeline>r.segments[r.segments.length-1].timeline)&&t.discontinuitySequence--);r.segments[i].discontinuity&&!a.discontinuity&&(a.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),he({playlist:t,mediaSequence:r.segments[i].number})}))})({oldPlaylists:n,newPlaylists:r,timelineStarts:t.timelineStarts}),t})({oldManifest:r,newManifest:p}):p},ke=(e,t,n)=>{const{NOW:r,clientOffset:a,availabilityStartTime:i,timescale:s=1,periodStart:o=0,minimumUpdatePeriod:l=0}=e,u=(r+a)/1e3+l-(i+o);return Math.ceil((u*s-t)/n)},Se=(e,t)=>{const{type:n,minimumUpdatePeriod:r=0,media:a="",sourceDuration:i,timescale:s=1,startNumber:o=1,periodStart:l}=e,u=[];let d=-1;for(let c=0;c<t.length;c++){const h=t[c],p=h.d,m=h.r||0,f=h.t||0;let g;if(d<0&&(d=f),f&&f>d&&(d=f),m<0){const o=c+1;g=o===t.length?"dynamic"===n&&r>0&&a.indexOf("$Number$")>0?ke(e,d,p):(i*s-d)/p:(t[o].t-d)/p}else g=m+1;const y=o+u.length+g;let b=o+u.length;for(;b<y;)u.push({number:b,duration:p/s,time:d,timeline:l}),d+=p,b++}return u},Te=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,_e=(e,t)=>e.replace(Te,(e=>(t,n,r,a)=>{if("$$"===t)return"$";if(void 0===e[n])return t;const i=""+e[n];return"RepresentationID"===n?i:(a=r?parseInt(a,10):1,i.length>=a?i:`${new Array(a-i.length+1).join("0")}${i}`)})(t)),Ie=(e,t)=>{const n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:r={sourceURL:"",range:""}}=e,a=re({baseUrl:e.baseUrl,source:_e(r.sourceURL,n),range:r.range}),i=((e,t)=>e.duration||t?e.duration?se(e):Se(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}])(e,t);return i.map((t=>{n.Number=t.number,n.Time=t.time;const r=_e(e.media||"",n),i=e.timescale||1,s=e.presentationTimeOffset||0,o=e.periodStart+(t.time-s)/i;return{uri:r,timeline:t.timeline,duration:t.duration,resolvedUri:Z(e.baseUrl||"",r),map:a,number:t.number,presentationTime:o}}))},Ce=(e,t)=>{const{duration:n,segmentUrls:r=[],periodStart:a}=e;if(!n&&!t||n&&t)throw new Error("SEGMENT_TIME_UNSPECIFIED");const i=r.map((t=>((e,t)=>{const{baseUrl:n,initialization:r={}}=e,a=re({baseUrl:n,source:r.sourceURL,range:r.range}),i=re({baseUrl:n,source:t.media,range:t.mediaRange});return i.map=a,i})(e,t)));let s;return n&&(s=se(e)),t&&(s=Se(e,t)),s.map(((t,n)=>{if(i[n]){const r=i[n],s=e.timescale||1,o=e.presentationTimeOffset||0;return r.timeline=t.timeline,r.duration=t.duration,r.number=t.number,r.presentationTime=a+(t.time-o)/s,r}})).filter((e=>e))},Ee=({attributes:e,segmentInfo:t})=>{let n,r;t.template?(r=Ie,n=Q(e,t.template)):t.base?(r=oe,n=Q(e,t.base)):t.list&&(r=Ce,n=Q(e,t.list));const a={attributes:e};if(!r)return a;const i=r(n,t.segmentTimeline);if(n.duration){const{duration:e,timescale:t=1}=n;n.duration=e/t}else i.length?n.duration=i.reduce(((e,t)=>Math.max(e,Math.ceil(t.duration))),0):n.duration=0;return a.attributes=n,a.segments=i,t.base&&n.indexRange&&(a.sidx=i[0],a.segments=[]),a},Ne=(e,t)=>ne(e.childNodes).filter((({tagName:e})=>e===t)),Re=e=>e.textContent.trim(),Pe=e=>{const t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;const[n,r,a,i,s,o]=t.slice(1);return 31536e3*parseFloat(n||0)+2592e3*parseFloat(r||0)+86400*parseFloat(a||0)+3600*parseFloat(i||0)+60*parseFloat(s||0)+parseFloat(o||0)},De={mediaPresentationDuration:e=>Pe(e),availabilityStartTime(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:e=>Pe(e),suggestedPresentationDelay:e=>Pe(e),type:e=>e,timeShiftBufferDepth:e=>Pe(e),start:e=>Pe(e),width:e=>parseInt(e,10),height:e=>parseInt(e,10),bandwidth:e=>parseInt(e,10),frameRate:e=>(e=>parseFloat(e.split("/").reduce(((e,t)=>e/t))))(e),startNumber:e=>parseInt(e,10),timescale:e=>parseInt(e,10),presentationTimeOffset:e=>parseInt(e,10),duration(e){const t=parseInt(e,10);return isNaN(t)?Pe(e):t},d:e=>parseInt(e,10),t:e=>parseInt(e,10),r:e=>parseInt(e,10),presentationTime:e=>parseInt(e,10),DEFAULT:e=>e},Me=e=>e&&e.attributes?ne(e.attributes).reduce(((e,t)=>{const n=De[t.name]||De.DEFAULT;return e[t.name]=n(t.value),e}),{}):{},Oe={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},$e=(e,t)=>t.length?te(e.map((function(e){return t.map((function(t){return Z(e,Re(t))}))}))):e,Fe=e=>{const t=Ne(e,"SegmentTemplate")[0],n=Ne(e,"SegmentList")[0],r=n&&Ne(n,"SegmentURL").map((e=>Q({tag:"SegmentURL"},Me(e)))),a=Ne(e,"SegmentBase")[0],i=n||t,s=i&&Ne(i,"SegmentTimeline")[0],o=n||a||t,l=o&&Ne(o,"Initialization")[0],u=t&&Me(t);u&&l?u.initialization=l&&Me(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const d={template:u,segmentTimeline:s&&Ne(s,"S").map((e=>Me(e))),list:n&&Q(Me(n),{segmentUrls:r,initialization:Me(l)}),base:a&&Q(Me(a),{initialization:Me(l)})};return Object.keys(d).forEach((e=>{d[e]||delete d[e]})),d},Le=e=>te(Ne(e.node,"EventStream").map((t=>{const n=Me(t),r=n.schemeIdUri;return Ne(t,"Event").map((t=>{const a=Me(t),i=a.presentationTime||0,s=n.timescale||1,o=a.duration||0,l=i/s+e.attributes.start;return{schemeIdUri:r,value:n.value,id:a.id,start:l,end:l+o/s,messageData:Re(t)||a.messageData,contentEncoding:n.contentEncoding,presentationTimeOffset:n.presentationTimeOffset||0}}))}))),ze=(e,t,n)=>r=>{const i=Me(r),s=$e(t,Ne(r,"BaseURL")),o=Ne(r,"Role")[0],l={role:Me(o)};let u=Q(e,i,l);const d=Ne(r,"Accessibility")[0],c="urn:scte:dash:cc:cea-608:2015"===(h=Me(d)).schemeIdUri?("string"!=typeof h.value?[]:h.value.split(";")).map((e=>{let t,n;return n=e,/^CC\d=/.test(e)?[t,n]=e.split("="):/^CC\d$/.test(e)&&(t=e),{channel:t,language:n}})):"urn:scte:dash:cc:cea-708:2015"===h.schemeIdUri?("string"!=typeof h.value?[]:h.value.split(";")).map((e=>{const t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){const[n,r=""]=e.split("=");t.channel=n,t.language=e,r.split(",").forEach((e=>{const[n,r]=e.split(":");"lang"===n?t.language=r:"er"===n?t.easyReader=Number(r):"war"===n?t.aspectRatio=Number(r):"3D"===n&&(t["3D"]=Number(r))}))}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})):void 0;var h;c&&(u=Q(u,{captionServices:c}));const p=Ne(r,"Label")[0];if(p&&p.childNodes.length){const e=p.childNodes[0].nodeValue.trim();u=Q(u,{label:e})}const m=Ne(r,"ContentProtection").reduce(((e,t)=>{const n=Me(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const r=Oe[n.schemeIdUri];if(r){e[r]={attributes:n};const i=Ne(t,"cenc:pssh")[0];if(i){const t=Re(i);e[r].pssh=t&&function(e){for(var t,n=(t=e,a().atob?a().atob(t):Buffer.from(t,"base64").toString("binary")),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(t)}}return e}),{});Object.keys(m).length&&(u=Q(u,{contentProtection:m}));const f=Fe(r),g=Ne(r,"Representation"),y=Q(n,f);return te(g.map(((e,t,n)=>r=>{const a=Ne(r,"BaseURL"),i=$e(t,a),s=Q(e,Me(r)),o=Fe(r);return i.map((e=>({segmentInfo:Q(n,o),attributes:Q(s,{baseUrl:e})})))})(u,s,y)))},Be=(e,t)=>(n,r)=>{const a=$e(t,Ne(n.node,"BaseURL")),i=Q(e,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(i.periodDuration=n.attributes.duration);const s=Ne(n.node,"AdaptationSet"),o=Fe(n.node);return te(s.map(ze(i,a,o)))},Ue=e=>{if(""===e)throw new Error("DASH_EMPTY_MANIFEST");const t=new Y.DOMParser;let n,r;try{n=t.parseFromString(e,"application/xml"),r=n&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(e){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error("DASH_INVALID_XML");return r};var We,Ve=n(221),je=n.n(Ve),He=j([73,68,51]),Ge=function e(t,n){return void 0===n&&(n=0),(t=j(t)).length-n<10||!K(t,He,{offset:n})?n:(n+=function(e,t){void 0===t&&(t=0);var n=(e=j(e))[t+5],r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&n)>>4?r+20:r+10}(t,n),e(t,n))},qe=(new Uint8Array([79,112,117,115,72,101,97,100]),function(e){return"string"==typeof e?X(e):e}),Xe=function(e){e=j(e);for(var t=[],n=0;e.length>n;){var r=e[n],a=0,i=0,s=e[++i];for(i++;128&s;)a=(127&s)<<7,s=e[i],i++;a+=127&s;for(var o=0;o<We.length;o++){var l=We[o],u=l.id,d=l.parser;if(r===u){t.push(d(e.subarray(i,i+a)));break}}n+=a+i}return t};We=[{id:3,parser:function(e){var t={tag:3,id:e[0]<<8|e[1],flags:e[2],size:3,dependsOnEsId:0,ocrEsId:0,descriptors:[],url:""};if(128&t.flags&&(t.dependsOnEsId=e[t.size]<<8|e[t.size+1],t.size+=2),64&t.flags){var n=e[t.size];t.url=function(e){if(!e)return"";e=Array.prototype.slice.call(e);var t=String.fromCharCode.apply(null,j(e));try{return decodeURIComponent(escape(t))}catch(e){}return t}(e.subarray(t.size+1,t.size+1+n)),t.size+=n}return 32&t.flags&&(t.ocrEsId=e[t.size]<<8|e[t.size+1],t.size+=2),t.descriptors=Xe(e.subarray(t.size))||[],t}},{id:4,parser:function(e){return{tag:4,oti:e[0],streamType:e[1],bufferSize:e[2]<<16|e[3]<<8|e[4],maxBitrate:e[5]<<24|e[6]<<16|e[7]<<8|e[8],avgBitrate:e[9]<<24|e[10]<<16|e[11]<<8|e[12],descriptors:Xe(e.subarray(13))}}},{id:5,parser:function(e){return{tag:5,bytes:e}}},{id:6,parser:function(e){return{tag:6,bytes:e}}}];var Ke=function e(t,n,r){void 0===r&&(r=!1),n=function(e){return Array.isArray(e)?e.map((function(e){return qe(e)})):[qe(e)]}(n),t=j(t);var a=[];if(!n.length)return a;for(var i=0;i<t.length;){var s=(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0,o=t.subarray(i+4,i+8);if(0===s)break;var l=i+s;if(l>t.length){if(r)break;l=t.length}var u=t.subarray(i+8,l);K(o,n[0])&&(1===n.length?a.push(u):a.push.apply(a,e(u,n.slice(1),r))),i=l}return a},Ze={EBML:j([26,69,223,163]),DocType:j([66,130]),Segment:j([24,83,128,103]),SegmentInfo:j([21,73,169,102]),Tracks:j([22,84,174,107]),Track:j([174]),TrackNumber:j([215]),DefaultDuration:j([35,227,131]),TrackEntry:j([174]),TrackType:j([131]),FlagDefault:j([136]),CodecID:j([134]),CodecPrivate:j([99,162]),VideoTrack:j([224]),AudioTrack:j([225]),Cluster:j([31,67,182,117]),Timestamp:j([231]),TimestampScale:j([42,215,177]),BlockGroup:j([160]),BlockDuration:j([155]),Block:j([161]),SimpleBlock:j([163])},Ye=[128,64,32,16,8,4,2,1],Je=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1);var a=function(e){for(var t=1,n=0;n<Ye.length&&!(e&Ye[n]);n++)t++;return t}(e[t]),i=e.subarray(t,t+a);return n&&((i=Array.prototype.slice.call(e,t,t+a))[0]^=Ye[a-1]),{length:a,value:q(i,{signed:r}),bytes:i}},Qe=function e(t){return"string"==typeof t?t.match(/.{1,2}/g).map((function(t){return e(t)})):"number"==typeof t?function(e,t){var n=(void 0===t?{}:t).le,r=void 0!==n&&n;("bigint"!=typeof e&&"number"!=typeof e||"number"==typeof e&&e!=e)&&(e=0);for(var a,i=(a=e=H(e),Math.ceil(function(e){return e.toString(2).length}(a)/8)),s=new Uint8Array(new ArrayBuffer(i)),o=0;o<i;o++){var l=r?o:Math.abs(o+1-s.length);s[l]=Number(e/G[o]&H(255)),e<0&&(s[l]=Math.abs(~s[l]),s[l]-=0===o?1:2)}return s}(t):t},et=function e(t,n,r){if(r>=n.length)return n.length;var a=Je(n,r,!1);if(K(t.bytes,a.bytes))return r;var i=Je(n,r+a.length);return e(t,n,r+i.length+i.value+a.length)},tt=function e(t,n){n=function(e){return Array.isArray(e)?e.map((function(e){return Qe(e)})):[Qe(e)]}(n),t=j(t);var r=[];if(!n.length)return r;for(var a=0;a<t.length;){var i=Je(t,a,!1),s=Je(t,a+i.length),o=a+i.length+s.length;127===s.value&&(s.value=et(i,t,o),s.value!==t.length&&(s.value-=o));var l=o+s.value>t.length?t.length:o+s.value,u=t.subarray(o,l);K(n[0],i.bytes)&&(1===n.length?r.push(u):r=r.concat(e(u,n.slice(1)))),a+=i.length+s.length+u.length}return r},nt=j([0,0,0,1]),rt=j([0,0,1]),at=j([0,0,3]),it=function(e){for(var t=[],n=1;n<e.length-2;)K(e.subarray(n,n+3),at)&&(t.push(n+2),n++),n++;if(0===t.length)return e;var r=e.length-t.length,a=new Uint8Array(r),i=0;for(n=0;n<r;i++,n++)i===t[0]&&(i++,t.shift()),a[n]=e[i];return a},st=function(e,t,n,r){void 0===r&&(r=1/0),e=j(e),n=[].concat(n);for(var a,i=0,s=0;i<e.length&&(s<r||a);){var o=void 0;if(K(e.subarray(i),nt)?o=4:K(e.subarray(i),rt)&&(o=3),o){if(s++,a)return it(e.subarray(a,i));var l=void 0;"h264"===t?l=31&e[i+o]:"h265"===t&&(l=e[i+o]>>1&63),-1!==n.indexOf(l)&&(a=i+o),i+=o+("h264"===t?1:2)}else i++}return e.subarray(0,0)},ot={webm:j([119,101,98,109]),matroska:j([109,97,116,114,111,115,107,97]),flac:j([102,76,97,67]),ogg:j([79,103,103,83]),ac3:j([11,119]),riff:j([82,73,70,70]),avi:j([65,86,73]),wav:j([87,65,86,69]),"3gp":j([102,116,121,112,51,103]),mp4:j([102,116,121,112]),fmp4:j([115,116,121,112]),mov:j([102,116,121,112,113,116]),moov:j([109,111,111,118]),moof:j([109,111,111,102])},lt={aac:function(e){var t=Ge(e);return K(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Ge(e);return K(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=tt(e,[Ze.EBML,Ze.DocType])[0];return K(t,ot.webm)},mkv:function(e){var t=tt(e,[Ze.EBML,Ze.DocType])[0];return K(t,ot.matroska)},mp4:function(e){return!lt["3gp"](e)&&!lt.mov(e)&&(!(!K(e,ot.mp4,{offset:4})&&!K(e,ot.fmp4,{offset:4}))||!(!K(e,ot.moof,{offset:4})&&!K(e,ot.moov,{offset:4}))||void 0)},mov:function(e){return K(e,ot.mov,{offset:4})},"3gp":function(e){return K(e,ot["3gp"],{offset:4})},ac3:function(e){var t=Ge(e);return K(e,ot.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];for(var t=0;t+188<e.length&&t<188;){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=Ge(e);return K(e,ot.flac,{offset:t})},ogg:function(e){return K(e,ot.ogg)},avi:function(e){return K(e,ot.riff)&&K(e,ot.avi,{offset:8})},wav:function(e){return K(e,ot.riff)&&K(e,ot.wav,{offset:8})},h264:function(e){return function(e,t,n){return st(e,"h264",7,3)}(e).length},h265:function(e){return function(e,t,n){return st(e,"h265",[32,33],3)}(e).length}},ut=Object.keys(lt).filter((function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e})).concat(["ts","h264","h265"]);ut.forEach((function(e){var t=lt[e];lt[e]=function(e){return t(j(e))}}));var dt=lt,ct=function(e){e=j(e);for(var t=0;t<ut.length;t++){var n=ut[t];if(dt[n](e))return n}return""},ht=n(489),pt="8.3.0";const mt={},ft=function(e,t){return mt[e]=mt[e]||[],t&&(mt[e]=mt[e].concat(t)),mt[e]},gt=function(e,t){const n=ft(e).indexOf(t);return!(n<=-1||(mt[e]=mt[e].slice(),mt[e].splice(n,1),0))},yt={prefixed:!0},bt=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],xt=bt[0];let At;for(let e=0;e<bt.length;e++)if(bt[e][1]in s()){At=bt[e];break}if(At){for(let e=0;e<At.length;e++)yt[xt[e]]=At[e];yt.prefixed=At[0]!==xt[0]}let vt=[];const wt=function e(t){let n,r="info";const i=function(...e){n("log",r,e)};return n=((e,t)=>(n,r,i)=>{const s=t.levels[r],o=new RegExp(`^(${s})$`);if("log"!==n&&i.unshift(n.toUpperCase()+":"),i.unshift(e+":"),vt){vt.push([].concat(i));const e=vt.length-1e3;vt.splice(0,e>0?e:0)}if(!a().console)return;let l=a().console[n];l||"debug"!==n||(l=a().console.info||a().console.log),l&&s&&o.test(n)&&l[Array.isArray(i)?"apply":"call"](a().console,i)})(t,i),i.createLogger=n=>e(t+": "+n),i.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:r},i.level=e=>{if("string"==typeof e){if(!i.levels.hasOwnProperty(e))throw new Error(`"${e}" in not a valid log level`);r=e}return r},(i.history=()=>vt?[].concat(vt):[]).filter=e=>(vt||[]).filter((t=>new RegExp(`.*${e}.*`).test(t[0]))),i.history.clear=()=>{vt&&(vt.length=0)},i.history.disable=()=>{null!==vt&&(vt.length=0,vt=null)},i.history.enable=()=>{null===vt&&(vt=[])},i.error=(...e)=>n("error",r,e),i.warn=(...e)=>n("warn",r,e),i.debug=(...e)=>n("debug",r,e),i}("VIDEOJS"),kt=wt.createLogger,St=Object.prototype.toString,Tt=function(e){return Ct(e)?Object.keys(e):[]};function _t(e,t){Tt(e).forEach((n=>t(e[n],n)))}function It(e,t,n=0){return Tt(e).reduce(((n,r)=>t(n,e[r],r)),n)}function Ct(e){return!!e&&"object"==typeof e}function Et(e){return Ct(e)&&"[object Object]"===St.call(e)&&e.constructor===Object}function Nt(...e){const t={};return e.forEach((e=>{e&&_t(e,((e,n)=>{Et(e)?(Et(t[n])||(t[n]={}),t[n]=Nt(t[n],e)):t[n]=e}))})),t}function Rt(e,t,n,r=!0){const a=n=>Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!0}),i={configurable:!0,enumerable:!0,get(){const e=n();return a(e),e}};return r&&(i.set=a),Object.defineProperty(e,t,i)}var Pt=Object.freeze({__proto__:null,each:_t,reduce:It,isObject:Ct,isPlain:Et,merge:Nt,defineLazyProperty:Rt});let Dt,Mt=!1,Ot=null,$t=!1,Ft=!1,Lt=!1,zt=!1,Bt=!1,Ut=null,Wt=null,Vt=null,jt=!1,Ht=!1,Gt=!1,qt=!1;const Xt=Boolean(en()&&("ontouchstart"in a()||a().navigator.maxTouchPoints||a().DocumentTouch&&a().document instanceof a().DocumentTouch)),Kt=a().navigator&&a().navigator.userAgentData;if(Kt&&($t="Android"===Kt.platform,Lt=Boolean(Kt.brands.find((e=>"Microsoft Edge"===e.brand))),zt=Boolean(Kt.brands.find((e=>"Chromium"===e.brand))),Bt=!Lt&&zt,Ut=Wt=(Kt.brands.find((e=>"Chromium"===e.brand))||{}).version||null,Ht="Windows"===Kt.platform),!zt){const e=a().navigator&&a().navigator.userAgent||"";Mt=/iPod/i.test(e),Ot=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),$t=/Android/i.test(e),Dt=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const n=t[1]&&parseFloat(t[1]),r=t[2]&&parseFloat(t[2]);return n&&r?parseFloat(t[1]+"."+t[2]):n||null}(),Ft=/Firefox/i.test(e),Lt=/Edg/i.test(e),zt=/Chrome/i.test(e)||/CriOS/i.test(e),Bt=!Lt&&zt,Ut=Wt=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),Vt=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let n=t&&parseFloat(t[1]);return!n&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(n=11),n}(),jt=/Safari/i.test(e)&&!Bt&&!$t&&!Lt,Ht=/Windows/i.test(e),Gt=/iPad/i.test(e)||jt&&Xt&&!/iPhone/i.test(e),qt=/iPhone/i.test(e)&&!Gt}const Zt=qt||Gt||Mt,Yt=(jt||Zt)&&!Bt;var Jt=Object.freeze({__proto__:null,get IS_IPOD(){return Mt},get IOS_VERSION(){return Ot},get IS_ANDROID(){return $t},get ANDROID_VERSION(){return Dt},get IS_FIREFOX(){return Ft},get IS_EDGE(){return Lt},get IS_CHROMIUM(){return zt},get IS_CHROME(){return Bt},get CHROMIUM_VERSION(){return Ut},get CHROME_VERSION(){return Wt},get IE_VERSION(){return Vt},get IS_SAFARI(){return jt},get IS_WINDOWS(){return Ht},get IS_IPAD(){return Gt},get IS_IPHONE(){return qt},TOUCH_ENABLED:Xt,IS_IOS:Zt,IS_ANY_SAFARI:Yt});function Qt(e){return"string"==typeof e&&Boolean(e.trim())}function en(){return s()===a().document}function tn(e){return Ct(e)&&1===e.nodeType}function nn(){try{return a().parent!==a().self}catch(e){return!0}}function rn(e){return function(t,n){if(!Qt(t))return s()[e](null);Qt(n)&&(n=s().querySelector(n));const r=tn(n)?n:s();return r[e]&&r[e](t)}}function an(e="div",t={},n={},r){const a=s().createElement(e);return Object.getOwnPropertyNames(t).forEach((function(e){const n=t[e];"textContent"===e?sn(a,n):a[e]===n&&"tabIndex"!==e||(a[e]=n)})),Object.getOwnPropertyNames(n).forEach((function(e){a.setAttribute(e,n[e])})),r&&Tn(a,r),a}function sn(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function on(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function ln(e,t){return function(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}(t),e.classList.contains(t)}function un(e,...t){return e.classList.add(...t.reduce(((e,t)=>e.concat(t.split(/\s+/))),[])),e}function dn(e,...t){return e?(e.classList.remove(...t.reduce(((e,t)=>e.concat(t.split(/\s+/))),[])),e):(wt.warn("removeClass was called with an element that doesn't exist"),null)}function cn(e,t,n){return"function"==typeof n&&(n=n(e,t)),"boolean"!=typeof n&&(n=void 0),t.split(/\s+/).forEach((t=>e.classList.toggle(t,n))),e}function hn(e,t){Object.getOwnPropertyNames(t).forEach((function(n){const r=t[n];null==r||!1===r?e.removeAttribute(n):e.setAttribute(n,!0===r?"":r)}))}function pn(e){const t={};if(e&&e.attributes&&e.attributes.length>0){const n=e.attributes;for(let r=n.length-1;r>=0;r--){const a=n[r].name;let i=n[r].value;"boolean"!=typeof e[a]&&-1===",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+a+",")||(i=null!==i),t[a]=i}}return t}function mn(e,t){return e.getAttribute(t)}function fn(e,t,n){e.setAttribute(t,n)}function gn(e,t){e.removeAttribute(t)}function yn(){s().body.focus(),s().onselectstart=function(){return!1}}function bn(){s().onselectstart=function(){return!0}}function xn(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),n={};return["bottom","height","left","right","top","width"].forEach((e=>{void 0!==t[e]&&(n[e]=t[e])})),n.height||(n.height=parseFloat(Nn(e,"height"))),n.width||(n.width=parseFloat(Nn(e,"width"))),n}}function An(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,n=e.offsetHeight;let r=0,a=0;for(;e.offsetParent&&e!==s()[yt.fullscreenElement];)r+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent;return{left:r,top:a,width:t,height:n}}function vn(e,t){const n={x:0,y:0};if(Zt){let t=e;for(;t&&"html"!==t.nodeName.toLowerCase();){const e=Nn(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);n.x+=t[4],n.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);n.x+=t[12],n.y+=t[13]}t=t.parentNode}}const r={},a=An(t.target),i=An(e),s=i.width,o=i.height;let l=t.offsetY-(i.top-a.top),u=t.offsetX-(i.left-a.left);return t.changedTouches&&(u=t.changedTouches[0].pageX-i.left,l=t.changedTouches[0].pageY+i.top,Zt&&(u-=n.x,l-=n.y)),r.y=1-Math.max(0,Math.min(1,l/o)),r.x=Math.max(0,Math.min(1,u/s)),r}function wn(e){return Ct(e)&&3===e.nodeType}function kn(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function Sn(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map((e=>("function"==typeof e&&(e=e()),tn(e)||wn(e)?e:"string"==typeof e&&/\S/.test(e)?s().createTextNode(e):void 0))).filter((e=>e))}function Tn(e,t){return Sn(t).forEach((t=>e.appendChild(t))),e}function _n(e,t){return Tn(kn(e),t)}function In(e){return void 0===e.button&&void 0===e.buttons||0===e.button&&void 0===e.buttons||"mouseup"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons}const Cn=rn("querySelector"),En=rn("querySelectorAll");function Nn(e,t){if(!e||!t)return"";if("function"==typeof a().getComputedStyle){let n;try{n=a().getComputedStyle(e)}catch(e){return""}return n?n.getPropertyValue(t)||n[t]:""}return""}var Rn=Object.freeze({__proto__:null,isReal:en,isEl:tn,isInFrame:nn,createEl:an,textContent:sn,prependTo:on,hasClass:ln,addClass:un,removeClass:dn,toggleClass:cn,setAttributes:hn,getAttributes:pn,getAttribute:mn,setAttribute:fn,removeAttribute:gn,blockTextSelection:yn,unblockTextSelection:bn,getBoundingClientRect:xn,findPosition:An,getPointerPosition:vn,isTextNode:wn,emptyEl:kn,normalizeContent:Sn,appendContent:Tn,insertContent:_n,isSingleLeftClick:In,$:Cn,$$:En,computedStyle:Nn});let Pn,Dn=!1;const Mn=function(){if(!1===Pn.options.autoSetup)return;const e=Array.prototype.slice.call(s().getElementsByTagName("video")),t=Array.prototype.slice.call(s().getElementsByTagName("audio")),n=Array.prototype.slice.call(s().getElementsByTagName("video-js")),r=e.concat(t,n);if(r&&r.length>0)for(let e=0,t=r.length;e<t;e++){const t=r[e];if(!t||!t.getAttribute){On(1);break}void 0===t.player&&null!==t.getAttribute("data-setup")&&Pn(t)}else Dn||On(1)};function On(e,t){en()&&(t&&(Pn=t),a().setTimeout(Mn,e))}function $n(){Dn=!0,a().removeEventListener("load",$n)}en()&&("complete"===s().readyState?$n():a().addEventListener("load",$n));const Fn=function(e){const t=s().createElement("style");return t.className=e,t},Ln=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var zn=new WeakMap;let Bn,Un=3;function Wn(){return Un++}function Vn(e,t){if(!zn.has(e))return;const n=zn.get(e);0===n.handlers[t].length&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),Object.getOwnPropertyNames(n.handlers).length<=0&&(delete n.handlers,delete n.dispatcher,delete n.disabled),0===Object.getOwnPropertyNames(n).length&&zn.delete(e)}function jn(e,t,n,r){n.forEach((function(n){e(t,n,r)}))}function Hn(e){if(e.fixed_)return e;function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const r=e||a().event;e={};for(const t in r)"layerX"!==t&&"layerY"!==t&&"keyLocation"!==t&&"webkitMovementX"!==t&&"webkitMovementY"!==t&&"path"!==t&&("returnValue"===t&&r.preventDefault||(e[t]=r[t]));if(e.target||(e.target=e.srcElement||s()),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){r.preventDefault&&r.preventDefault(),e.returnValue=!1,r.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){r.stopPropagation&&r.stopPropagation(),e.cancelBubble=!0,r.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){r.stopImmediatePropagation&&r.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n,null!==e.clientX&&void 0!==e.clientX){const t=s().documentElement,n=s().body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const Gn=function(){if("boolean"!=typeof Bn){Bn=!1;try{const e=Object.defineProperty({},"passive",{get(){Bn=!0}});a().addEventListener("test",null,e),a().removeEventListener("test",null,e)}catch(e){}}return Bn},qn=["touchstart","touchmove"];function Xn(e,t,n){if(Array.isArray(t))return jn(Xn,e,t,n);zn.has(e)||zn.set(e,{});const r=zn.get(e);if(r.handlers||(r.handlers={}),r.handlers[t]||(r.handlers[t]=[]),n.guid||(n.guid=Wn()),r.handlers[t].push(n),r.dispatcher||(r.disabled=!1,r.dispatcher=function(t,n){if(r.disabled)return;t=Hn(t);const a=r.handlers[t.type];if(a){const r=a.slice(0);for(let a=0,i=r.length;a<i&&!t.isImmediatePropagationStopped();a++)try{r[a].call(e,t,n)}catch(e){wt.error(e)}}}),1===r.handlers[t].length)if(e.addEventListener){let n=!1;Gn()&&qn.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,r.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,r.dispatcher)}function Kn(e,t,n){if(!zn.has(e))return;const r=zn.get(e);if(!r.handlers)return;if(Array.isArray(t))return jn(Kn,e,t,n);const a=function(e,t){r.handlers[t]=[],Vn(e,t)};if(void 0===t){for(const t in r.handlers)Object.prototype.hasOwnProperty.call(r.handlers||{},t)&&a(e,t);return}const i=r.handlers[t];if(i)if(n){if(n.guid)for(let e=0;e<i.length;e++)i[e].guid===n.guid&&i.splice(e--,1);Vn(e,t)}else a(e,t)}function Zn(e,t,n){const r=zn.has(e)?zn.get(e):{},a=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=Hn(t),r.dispatcher&&r.dispatcher.call(e,t,n),a&&!t.isPropagationStopped()&&!0===t.bubbles)Zn.call(null,a,t,n);else if(!a&&!t.defaultPrevented&&t.target&&t.target[t.type]){zn.has(t.target)||zn.set(t.target,{});const e=zn.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function Yn(e,t,n){if(Array.isArray(t))return jn(Yn,e,t,n);const r=function(){Kn(e,t,r),n.apply(this,arguments)};r.guid=n.guid=n.guid||Wn(),Xn(e,t,r)}function Jn(e,t,n){const r=function(){Kn(e,t,r),n.apply(this,arguments)};r.guid=n.guid=n.guid||Wn(),Xn(e,t,r)}var Qn=Object.freeze({__proto__:null,fixEvent:Hn,on:Xn,off:Kn,trigger:Zn,one:Yn,any:Jn});const er=30,tr=function(e,t,n){t.guid||(t.guid=Wn());const r=t.bind(e);return r.guid=n?n+"_"+t.guid:t.guid,r},nr=function(e,t){let n=a().performance.now();return function(...r){const i=a().performance.now();i-n>=t&&(e(...r),n=i)}},rr=function(e,t,n,r=a()){let i;const s=function(){const a=this,s=arguments;let o=function(){i=null,o=null,n||e.apply(a,s)};!i&&n&&e.apply(a,s),r.clearTimeout(i),i=r.setTimeout(o,t)};return s.cancel=()=>{r.clearTimeout(i),i=null},s};var ar=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:er,bind_:tr,throttle:nr,debounce:rr});let ir;class sr{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Xn(this,e,t),this.addEventListener=n}off(e,t){Kn(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Yn(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Jn(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;"string"==typeof e&&(e={type:t}),e=Hn(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Zn(this,e)}queueTrigger(e){ir||(ir=new Map);const t=e.type||e;let n=ir.get(this);n||(n=new Map,ir.set(this,n));const r=n.get(t);n.delete(t),a().clearTimeout(r);const i=a().setTimeout((()=>{n.delete(t),0===n.size&&(n=null,ir.delete(this)),this.trigger(e)}),0);n.set(t,i)}}sr.prototype.allowedEvents_={},sr.prototype.addEventListener=sr.prototype.on,sr.prototype.removeEventListener=sr.prototype.off,sr.prototype.dispatchEvent=sr.prototype.trigger;const or=e=>"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e,lr=e=>e instanceof sr||!!e.eventBusEl_&&["on","one","off","trigger"].every((t=>"function"==typeof e[t])),ur=e=>"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,dr=(e,t,n)=>{if(!e||!e.nodeName&&!lr(e))throw new Error(`Invalid target for ${or(t)}#${n}; must be a DOM node or evented object.`)},cr=(e,t,n)=>{if(!ur(e))throw new Error(`Invalid event type for ${or(t)}#${n}; must be a non-empty string or array.`)},hr=(e,t,n)=>{if("function"!=typeof e)throw new Error(`Invalid listener for ${or(t)}#${n}; must be a function.`)},pr=(e,t,n)=>{const r=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let a,i,s;return r?(a=e.eventBusEl_,t.length>=3&&t.shift(),[i,s]=t):[a,i,s]=t,dr(a,e,n),cr(i,e,n),hr(s,e,n),s=tr(e,s),{isTargetingSelf:r,target:a,type:i,listener:s}},mr=(e,t,n,r)=>{dr(e,e,t),e.nodeName?Qn[t](e,n,r):e[t](n,r)},fr={on(...e){const{isTargetingSelf:t,target:n,type:r,listener:a}=pr(this,e,"on");if(mr(n,"on",r,a),!t){const e=()=>this.off(n,r,a);e.guid=a.guid;const t=()=>this.off("dispose",e);t.guid=a.guid,mr(this,"on","dispose",e),mr(n,"on","dispose",t)}},one(...e){const{isTargetingSelf:t,target:n,type:r,listener:a}=pr(this,e,"one");if(t)mr(n,"one",r,a);else{const e=(...t)=>{this.off(n,r,e),a.apply(null,t)};e.guid=a.guid,mr(n,"one",r,e)}},any(...e){const{isTargetingSelf:t,target:n,type:r,listener:a}=pr(this,e,"any");if(t)mr(n,"any",r,a);else{const e=(...t)=>{this.off(n,r,e),a.apply(null,t)};e.guid=a.guid,mr(n,"any",r,e)}},off(e,t,n){if(!e||ur(e))Kn(this.eventBusEl_,e,t);else{const r=e,a=t;dr(r,this,"off"),cr(a,this,"off"),hr(n,this,"off"),n=tr(this,n),this.off("dispose",n),r.nodeName?(Kn(r,a,n),Kn(r,"dispose",n)):lr(r)&&(r.off(a,n),r.off("dispose",n))}},trigger(e,t){dr(this.eventBusEl_,this,"trigger");const n=e&&"string"!=typeof e?e.type:e;if(!ur(n))throw new Error(`Invalid event type for ${or(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return Zn(this.eventBusEl_,e,t)}};function gr(e,t={}){const{eventBusKey:n}=t;if(n){if(!e[n].nodeName)throw new Error(`The eventBusKey "${n}" does not refer to an element.`);e.eventBusEl_=e[n]}else e.eventBusEl_=an("span",{className:"vjs-event-bus"});return Object.assign(e,fr),e.eventedCallbacks&&e.eventedCallbacks.forEach((e=>{e()})),e.on("dispose",(()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach((function(e){e&&zn.has(e)&&zn.delete(e)})),a().setTimeout((()=>{e.eventBusEl_=null}),0)})),e}const yr={state:{},setState(e){let t;return"function"==typeof e&&(e=e()),_t(e,((e,n)=>{this.state[n]!==e&&(t=t||{},t[n]={from:this.state[n],to:e}),this.state[n]=e})),t&&lr(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function br(e,t){return Object.assign(e,yr),e.state=Object.assign({},e.state,t),"function"==typeof e.handleStateChanged&&lr(e)&&e.on("statechanged",e.handleStateChanged),e}const xr=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toLowerCase()))},Ar=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toUpperCase()))},vr=function(e,t){return Ar(e)===Ar(t)};var wr=Object.freeze({__proto__:null,toLowerCase:xr,toTitleCase:Ar,titleCaseEquals:vr});class kr{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Nt({},this.options_),t=this.options_=Nt(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${Wn()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach((e=>this.addClass(e))),["on","off","one","any","trigger"].forEach((e=>{this[e]=void 0})),!1!==t.evented&&(gr(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),br(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(n),!1!==t.reportTouchActivity&&this.enableTouchActivity()}on(e,t){}off(e,t){}one(e,t){}any(e,t){}trigger(e){}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=Nt(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return an(e,t,n)}localize(e,t,n=e){const r=this.player_.language&&this.player_.language(),a=this.player_.languages&&this.player_.languages(),i=a&&a[r],s=r&&r.split("-")[0],o=a&&a[s];let l=n;return i&&i[e]?l=i[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,(function(e,n){const r=t[n-1];let a=r;return void 0===r&&(a=e),a}))),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce(((e,t)=>e.concat(t)),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}addChild(e,t={},n=this.children_.length){let r,a;if("string"==typeof e){a=Ar(e);const n=t.componentClass||a;t.name=a;const i=kr.getComponent(n);if(!i)throw new Error(`Component ${n} does not exist`);if("function"!=typeof i)return null;r=new i(this.player_||this,t)}else r=e;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),a=a||r.name&&Ar(r.name()),a&&(this.childNameIndex_[a]=r,this.childNameIndex_[xr(a)]=r),"function"==typeof r.el&&r.el()){let e=null;this.children_[n+1]&&(this.children_[n+1].el_?e=this.children_[n+1].el_:tn(this.children_[n+1])&&(e=this.children_[n+1])),this.contentEl().insertBefore(r.el(),e)}return r}removeChild(e){if("string"==typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let n=this.children_.length-1;n>=0;n--)if(this.children_[n]===e){t=!0,this.children_.splice(n,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Ar(e.name())]=null,this.childNameIndex_[xr(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=e=>{const n=e.name;let r=e.opts;if(void 0!==t[n]&&(r=t[n]),!1===r)return;!0===r&&(r={}),r.playerOptions=this.options_.playerOptions;const a=this.addChild(n,r);a&&(this[n]=a)};let r;const a=kr.getComponent("Tech");r=Array.isArray(e)?e:Object.keys(e),r.concat(Object.keys(this.options_).filter((function(e){return!r.some((function(t){return"string"==typeof t?e===t:e===t.name}))}))).map((t=>{let n,r;return"string"==typeof t?(n=t,r=e[n]||this.options_[n]||{}):(n=t.name,r=t),{name:n,opts:r}})).filter((e=>{const t=kr.getComponent(e.opts.componentClass||Ar(e.name));return t&&!a.isTech(t)})).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout((function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach((function(e){e.call(this)}),this),this.trigger("ready")}),1)}$(e,t){return Cn(e,t||this.contentEl())}$$(e,t){return En(e,t||this.contentEl())}hasClass(e){return ln(this.el_,e)}addClass(...e){un(this.el_,...e)}removeClass(...e){dn(this.el_,...e)}toggleClass(e,t){cn(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return mn(this.el_,e)}setAttribute(e,t){fn(this.el_,e,t)}removeAttribute(e){gn(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(n||this.trigger("componentresize"));if(!this.el_)return 0;const r=this.el_.style[e],a=r.indexOf("px");return-1!==a?parseInt(r.slice(0,a),10):parseInt(this.el_["offset"+Ar(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=Nn(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const n=`offset${Ar(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(l().isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e,t=0,n=null;this.on("touchstart",(function(r){1===r.touches.length&&(n={pageX:r.touches[0].pageX,pageY:r.touches[0].pageY},t=a().performance.now(),e=!0)})),this.on("touchmove",(function(t){if(t.touches.length>1)e=!1;else if(n){const r=t.touches[0].pageX-n.pageX,a=t.touches[0].pageY-n.pageY;Math.sqrt(r*r+a*a)>10&&(e=!1)}}));const r=function(){e=!1};this.on("touchleave",r),this.on("touchcancel",r),this.on("touchend",(function(r){n=null,!0===e&&a().performance.now()-t<200&&(r.preventDefault(),this.trigger("tap"))}))}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=tr(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",(function(){e(),this.clearInterval(t),t=this.setInterval(e,250)}));const n=function(n){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=tr(this,e),this.clearTimersOnDispose_(),n=a().setTimeout((()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()}),t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),a().clearTimeout(e)),e}setInterval(e,t){e=tr(this,e),this.clearTimersOnDispose_();const n=a().setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),a().clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=tr(this,e),t=a().requestAnimationFrame((()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()})),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){if(this.namedRafs_.has(e))return;this.clearTimersOnDispose_(),t=tr(this,t);const n=this.requestAnimationFrame((()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)}));return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),a().cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",(()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach((([e,t])=>{this[e].forEach(((e,n)=>this[t](n)))})),this.clearingTimersOnDispose_=!1})))}static registerComponent(e,t){if("string"!=typeof e||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=kr.getComponent("Tech"),r=n&&n.isTech(t),a=kr===t||kr.prototype.isPrototypeOf(t.prototype);if(r||!a){let t;throw t=r?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${e}"; ${t}.`)}e=Ar(e),kr.components_||(kr.components_={});const i=kr.getComponent("Player");if("Player"===e&&i&&i.players){const e=i.players,t=Object.keys(e);if(e&&t.length>0&&t.map((t=>e[t])).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return kr.components_[e]=t,kr.components_[xr(e)]=t,t}static getComponent(e){if(e&&kr.components_)return kr.components_[e]}}function Sr(e,t,n,r){return function(e,t,n){if("number"!=typeof t||t<0||t>n)throw new Error(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is non-numeric or out of bounds (0-${n}).`)}(e,r,n.length-1),n[r][t]}function Tr(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:Sr.bind(null,"start",0,e),end:Sr.bind(null,"end",1,e)},a().Symbol&&a().Symbol.iterator&&(t[a().Symbol.iterator]=()=>(e||[]).values()),t}function _r(e,t){return Array.isArray(e)?Tr(e):void 0===e||void 0===t?Tr():Tr([[e,t]])}kr.registerComponent("Component",kr);const Ir=function(e,t){e=e<0?0:e;let n=Math.floor(e%60),r=Math.floor(e/60%60),a=Math.floor(e/3600);const i=Math.floor(t/60%60),s=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(a=r=n="-"),a=a>0||s>0?a+":":"",r=((a||i>=10)&&r<10?"0"+r:r)+":",n=n<10?"0"+n:n,a+r+n};let Cr=Ir;function Er(e){Cr=e}function Nr(){Cr=Ir}function Rr(e,t=e){return Cr(e,t)}var Pr=Object.freeze({__proto__:null,createTimeRanges:_r,createTimeRange:_r,setFormatTime:Er,resetFormatTime:Nr,formatTime:Rr});function Dr(e,t){let n,r,a=0;if(!t)return 0;e&&e.length||(e=_r(0,0));for(let i=0;i<e.length;i++)n=e.start(i),r=e.end(i),r>t&&(r=t),a+=r-n;return a/t}function Mr(e){if(e instanceof Mr)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:Ct(e)&&("number"==typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=Mr.defaultMessages[this.code]||"")}Mr.prototype.code=0,Mr.prototype.message="",Mr.prototype.status=null,Mr.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Mr.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(let e=0;e<Mr.errorTypes.length;e++)Mr[Mr.errorTypes[e]]=e,Mr.prototype[Mr.errorTypes[e]]=e;function Or(e){return null!=e&&"function"==typeof e.then}function $r(e){Or(e)&&e.then(null,(e=>{}))}const Fr=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(((t,n,r)=>(e[n]&&(t[n]=e[n]),t)),{cues:e.cues&&Array.prototype.map.call(e.cues,(function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}}))})};const Lr="vjs-modal-dialog";class zr extends kr{constructor(e,t){super(e,t),this.handleKeyDown_=e=>this.handleKeyDown(e),this.close_=e=>this.close(e),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=an("div",{className:`${Lr}-content`},{role:"document"}),this.descEl_=an("p",{className:`${Lr}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),sn(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${Lr} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(!this.opened_){const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}}opened(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"==typeof e){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const e=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,r=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),_n(t,e),this.trigger("modalfill"),r?n.insertBefore(t,r):n.appendChild(t);const a=this.getChild("closeButton");a&&n.appendChild(a.el_)}empty(){this.trigger("beforemodalempty"),kn(this.contentEl()),this.trigger("modalempty")}content(e){return void 0!==e&&(this.content_=e),this.content_}conditionalFocus_(){const e=s().activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(e.stopPropagation(),l().isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(!l().isEventKey(e,"Tab"))return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let r;for(let e=0;e<t.length;e++)if(n===t[e]){r=e;break}s().activeElement===this.el_&&(r=0),e.shiftKey&&0===r?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||r!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,(e=>(e instanceof a().HTMLAnchorElement||e instanceof a().HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof a().HTMLInputElement||e instanceof a().HTMLSelectElement||e instanceof a().HTMLTextAreaElement||e instanceof a().HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof a().HTMLIFrameElement||e instanceof a().HTMLObjectElement||e instanceof a().HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")))}}zr.prototype.options_={pauseOnOpen:!0,temporary:!0},kr.registerComponent("ModalDialog",zr);class Br extends sr{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},lr(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const r=this[n];if(r.id===e){t=r;break}}return t}}Br.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const e in Br.prototype.allowedEvents_)Br.prototype["on"+e]=null;const Ur=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].enabled=!1)},Wr=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].selected=!1)};class Vr extends Br{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class jr{constructor(e){jr.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const r=e.length;this.cues_=e,this.length_=e.length;const a=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<r)for(n=t;n<r;n++)a.call(this,n)}getCueById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const r=this[n];if(r.id===e){t=r;break}}return t}}const Hr={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Gr={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},qr={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Xr={disabled:"disabled",hidden:"hidden",showing:"showing"};class Kr extends sr{constructor(e={}){super();const t={id:e.id||"vjs_track_"+Wn(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const e in t)Object.defineProperty(this,e,{get:()=>t[e],set(){}});Object.defineProperty(this,"label",{get:()=>n,set(e){e!==n&&(n=e,this.trigger("labelchange"))}})}}const Zr=function(e){const t=["protocol","hostname","port","pathname","search","hash","host"],n=s().createElement("a");n.href=e;const r={};for(let e=0;e<t.length;e++)r[t[e]]=n[t[e]];return"http:"===r.protocol&&(r.host=r.host.replace(/:80$/,"")),"https:"===r.protocol&&(r.host=r.host.replace(/:443$/,"")),r.protocol||(r.protocol=a().location.protocol),r.host||(r.host=a().location.host),r},Yr=function(e){if(!e.match(/^https?:\/\//)){const t=s().createElement("a");t.href=e,e=t.href}return e},Jr=function(e){if("string"==typeof e){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(e);if(t)return t.pop().toLowerCase()}return""},Qr=function(e,t=a().location){const n=Zr(e);return(":"===n.protocol?t.protocol:n.protocol)+n.host!==t.protocol+t.host};var ea=Object.freeze({__proto__:null,parseUrl:Zr,getAbsoluteURL:Yr,getFileExtension:Jr,isCrossOrigin:Qr});const ta=function(e,t){const n=new(a().WebVTT.Parser)(a(),a().vttjs,a().WebVTT.StringDecoder()),r=[];n.oncue=function(e){t.addCue(e)},n.onparsingerror=function(e){r.push(e)},n.onflush=function(){t.trigger({type:"loadeddata",target:t})},n.parse(e),r.length>0&&(a().console&&a().console.groupCollapsed&&a().console.groupCollapsed(`Text Track parsing errors for ${t.src}`),r.forEach((e=>wt.error(e))),a().console&&a().console.groupEnd&&a().console.groupEnd()),n.flush()},na=function(e,t){const n={uri:e},r=Qr(e);r&&(n.cors=r);const i="use-credentials"===t.tech_.crossOrigin();i&&(n.withCredentials=i),h()(n,tr(this,(function(e,n,r){if(e)return wt.error(e,n);t.loaded_=!0,"function"!=typeof a().WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],(e=>{if("vttjserror"!==e.type)return ta(r,t);wt.error(`vttjs failed to load, stopping trying to process ${t.src}`)})):ta(r,t)})))};class ra extends Kr{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=Nt(e,{kind:qr[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=Xr[t.mode]||"disabled";const r=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const a=new jr(this.cues_),i=new jr(this.activeCues_);let s=!1;this.timeupdateHandler=tr(this,(function(e={}){this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,s&&(this.trigger("cuechange"),s=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))})),this.tech_.one("dispose",(()=>{this.stopTracking()})),"disabled"!==n&&this.startTracking(),Object.defineProperties(this,{default:{get:()=>r,set(){}},mode:{get:()=>n,set(e){Xr[e]&&n!==e&&(n=e,this.preload_||"disabled"===n||0!==this.cues.length||na(this.src,this),this.stopTracking(),"disabled"!==n&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?a:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return i;const e=this.tech_.currentTime(),t=[];for(let n=0,r=this.cues.length;n<r;n++){const r=this.cues[n];r.startTime<=e&&r.endTime>=e&&t.push(r)}if(s=!1,t.length!==this.activeCues_.length)s=!0;else for(let e=0;e<t.length;e++)-1===this.activeCues_.indexOf(t[e])&&(s=!0);return this.activeCues_=t,i.setCues_(this.activeCues_),i},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&na(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(a().vttjs&&!(e instanceof a().vttjs.VTTCue)){t=new(a().vttjs.VTTCue)(e.startTime,e.endTime,e.text);for(const n in e)n in t||(t[n]=e[n]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let e=0;e<n.length;e++)n[e]!==this&&n[e].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}ra.prototype.allowedEvents_={cuechange:"cuechange"};class aa extends Kr{constructor(e={}){const t=Nt(e,{kind:Gr[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get:()=>n,set(e){"boolean"==typeof e&&e!==n&&(n=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class ia extends Kr{constructor(e={}){const t=Nt(e,{kind:Hr[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get:()=>n,set(e){"boolean"==typeof e&&e!==n&&(n=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class sa extends sr{constructor(e={}){let t;super();const n=new ra(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get:()=>t},track:{get:()=>n}}),t=sa.NONE,n.addEventListener("loadeddata",(()=>{t=sa.LOADED,this.trigger({type:"load",target:this})}))}}sa.prototype.allowedEvents_={load:"load"},sa.NONE=0,sa.LOADING=1,sa.LOADED=2,sa.ERROR=3;const oa={audio:{ListClass:class extends Br{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){Ur(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&Ur(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,Ur(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}},TrackClass:aa,capitalName:"Audio"},video:{ListClass:class extends Br{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){Wr(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&Wr(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,Wr(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}},TrackClass:ia,capitalName:"Video"},text:{ListClass:Vr,TrackClass:ra,capitalName:"Text"}};Object.keys(oa).forEach((function(e){oa[e].getterName=`${e}Tracks`,oa[e].privateName=`${e}Tracks_`}));const la={remoteText:{ListClass:Vr,TrackClass:ra,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:class{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,r=this.trackElements_.length;n<r;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}},TrackClass:sa,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ua=Object.assign({},oa,la);la.names=Object.keys(la),oa.names=Object.keys(oa),ua.names=[].concat(la.names).concat(oa.names);class da extends kr{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=e=>this.onDurationChange(e),this.trackProgress_=e=>this.trackProgress(e),this.trackCurrentTime_=e=>this.trackCurrentTime(e),this.stopTrackingCurrentTime_=e=>this.stopTrackingCurrentTime(e),this.disposeSourceHandler_=e=>this.disposeSourceHandler(e),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",(function(){this.hasStarted_=!0})),this.on("loadstart",(function(){this.hasStarted_=!1})),ua.names.forEach((t=>{const n=ua[t];e&&e[n.getterName]&&(this[n.privateName]=e[n.getterName])})),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach((t=>{!1===e[`native${t}Tracks`]&&(this[`featuresNative${t}Tracks`]=!1)})),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new ua.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",(()=>this.setTimeout((()=>this.triggerSourceset(e)),1))),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(tr(this,(function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()})),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return _r(0,0)}bufferedPercent(){return Dr(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval((function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}),250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(oa.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){(e=[].concat(e)).forEach((e=>{const t=this[`${e}Tracks`]()||[];let n=t.length;for(;n--;){const r=t[n];"text"===e&&this.removeRemoteTextTrack(r),t.removeTrack(r)}}))}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new Mr(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?_r(0,0):_r()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){oa.names.forEach((e=>{const t=oa[e],n=()=>{this.trigger(`${e}trackchange`)},r=this[t.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),this.on("dispose",(()=>{r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)}))}))}addWebVttScript_(){if(!a().WebVTT)if(s().body.contains(this.el())){if(!this.options_["vtt.js"]&&Et(m())&&Object.keys(m()).length>0)return void this.trigger("vttjsloaded");const e=s().createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",(()=>{e.onload=null,e.onerror=null})),a().WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=t=>e.addTrack(t.track),r=t=>e.removeTrack(t.track);t.on("addtrack",n),t.on("removetrack",r),this.addWebVttScript_();const a=()=>this.trigger("texttrackchange"),i=()=>{a();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("cuechange",a),"showing"===n.mode&&n.addEventListener("cuechange",a)}};i(),e.addEventListener("change",i),e.addEventListener("addtrack",i),e.addEventListener("removetrack",i),this.on("dispose",(function(){t.off("addtrack",n),t.off("removetrack",r),e.removeEventListener("change",i),e.removeEventListener("addtrack",i),e.removeEventListener("removetrack",i);for(let t=0;t<e.length;t++)e[t].removeEventListener("cuechange",a)}))}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,n,r,a={}){const i=e.textTracks();a.kind=t,n&&(a.label=n),r&&(a.language=r),a.tech=e;const s=new ua.text.TrackClass(a);return i.addTrack(s),s}(this,e,t,n)}createRemoteTextTrack(e){const t=Nt(e,{tech:this});return new la.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return"boolean"!=typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!1===t&&this.ready((()=>this.autoRemoteTextTracks_.addTrack(n.track))),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=Wn();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",(()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())}))):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return da.canPlayType(e.type)}static isTech(e){return e.prototype instanceof da||e instanceof da||e===da}static registerTech(e,t){if(da.techs_||(da.techs_={}),!da.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!da.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!da.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Ar(e),da.techs_[e]=t,da.techs_[xr(e)]=t,"Tech"!==e&&da.defaultTechOrder_.push(e),t}static getTech(e){if(e)return da.techs_&&da.techs_[e]?da.techs_[e]:(e=Ar(e),a()&&a().videojs&&a().videojs[e]?(wt.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),a().videojs[e]):void 0)}}ua.names.forEach((function(e){const t=ua[e];da.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}})),da.prototype.featuresVolumeControl=!0,da.prototype.featuresMuteControl=!0,da.prototype.featuresFullscreenResize=!1,da.prototype.featuresPlaybackRate=!1,da.prototype.featuresProgressEvents=!1,da.prototype.featuresSourceset=!1,da.prototype.featuresTimeupdateEvents=!1,da.prototype.featuresNativeTextTracks=!1,da.prototype.featuresVideoFrameCallback=!1,da.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){let r=e.sourceHandlers;r||(r=e.sourceHandlers=[]),void 0===n&&(n=r.length),r.splice(n,0,t)},e.canPlayType=function(t){const n=e.sourceHandlers||[];let r;for(let e=0;e<n.length;e++)if(r=n[e].canPlayType(t),r)return r;return""},e.selectSourceHandler=function(t,n){const r=e.sourceHandlers||[];let a;for(let e=0;e<r.length;e++)if(a=r[e].canHandleSource(t,n),a)return r[e];return null},e.canPlaySource=function(t,n){const r=e.selectSourceHandler(t,n);return r?r.canHandleSource(t,n):""},["seekable","seeking","duration"].forEach((function(e){const t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})}),e.prototype),e.prototype.setSource=function(t){let n=e.selectSourceHandler(t,this.options_);n||(e.nativeSourceHandler?n=e.nativeSourceHandler:wt.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},kr.registerComponent("Tech",da),da.registerTech("Tech",da),da.defaultTechOrder_=[];const ca={},ha={},pa={};function ma(e,t,n){e.setTimeout((()=>Aa(t,ca[t.type],n,e)),1)}function fa(e,t,n,r=null){const a="call"+Ar(n),i=e.reduce(xa(a),r),s=i===pa,o=s?null:t[n](i);return function(e,t,n,r){for(let a=e.length-1;a>=0;a--){const i=e[a];i[t]&&i[t](r,n)}}(e,n,o,s),o}const ga={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},ya={setCurrentTime:1,setMuted:1,setVolume:1},ba={play:1,pause:1};function xa(e){return(t,n)=>t===pa?pa:n[e]?n[e](t):t}function Aa(e={},t=[],n,r,a=[],i=!1){const[s,...o]=t;if("string"==typeof s)Aa(e,ca[s],n,r,a,i);else if(s){const t=function(e,t){const n=ha[e.id()];let r=null;if(null==n)return r=t(e),ha[e.id()]=[[t,r]],r;for(let e=0;e<n.length;e++){const[a,i]=n[e];a===t&&(r=i)}return null===r&&(r=t(e),n.push([t,r])),r}(r,s);if(!t.setSource)return a.push(t),Aa(e,o,n,r,a,i);t.setSource(Object.assign({},e),(function(s,l){if(s)return Aa(e,o,n,r,a,i);a.push(t),Aa(l,e.type===l.type?o:ca[l.type],n,r,a,i)}))}else o.length?Aa(e,o,n,r,a,i):i?n(e,a):Aa(e,ca["*"],n,r,a,!0)}const va={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},wa=function(e=""){const t=Jr(e);return va[t.toLowerCase()]||""},ka=function(e){if(Array.isArray(e)){let t=[];e.forEach((function(e){e=ka(e),Array.isArray(e)?t=t.concat(e):Ct(e)&&t.push(e)})),e=t}else e="string"==typeof e&&e.trim()?[Sa({src:e})]:Ct(e)&&"string"==typeof e.src&&e.src&&e.src.trim()?[Sa(e)]:[];return e};function Sa(e){if(!e.type){const t=wa(e.src);t&&(e.type=t)}return e}kr.registerComponent("MediaLoader",class extends kr{constructor(e,t,n){if(super(e,Nt({createEl:!1},t),n),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let n=0,r=t.playerOptions.techOrder;n<r.length;n++){const t=Ar(r[n]);let a=da.getTech(t);if(t||(a=kr.getComponent(t)),a&&a.isSupported()){e.loadTech_(t);break}}}});class Ta extends kr{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=e=>this.handleMouseOver(e),this.handleMouseOut_=e=>this.handleMouseOut(e),this.handleClick_=e=>this.handleClick(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&wt.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const r=an(e,t,n);return r.appendChild(an("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=an("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(void 0===e)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,sn(this.controlTextEl_,n),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){l().isEventKey(e,"Space")||l().isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}kr.registerComponent("ClickableComponent",Ta);class _a extends Ta{constructor(e,t){super(e,t),this.update(),this.update_=e=>this.update(e),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return an("div",{className:"vjs-poster"})}crossOrigin(e){if(void 0===e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(an("picture",{className:"vjs-poster",tabIndex:-1},{},an("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?$r(this.player_.play()):this.player_.pause())}}_a.prototype.crossorigin=_a.prototype.crossOrigin,kr.registerComponent("PosterImage",_a);const Ia="#222",Ca="#ccc",Ea={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Na(e,t){let n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}function Ra(e,t,n){try{e.style[t]=n}catch(e){return}}kr.registerComponent("TextTrackDisplay",class extends kr{constructor(e,t,n){super(e,t,n);const r=e=>this.updateDisplay(e);e.on("loadstart",(e=>this.toggleDisplay(e))),e.on("texttrackchange",r),e.on("loadedmetadata",(e=>this.preselectTrack(e))),e.ready(tr(this,(function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",r),e.on("playerresize",r);const t=a().screen.orientation||a(),n=a().screen.orientation?"change":"orientationchange";t.addEventListener(n,r),e.on("dispose",(()=>t.removeEventListener(n,r)));const i=this.options_.playerOptions.tracks||[];for(let e=0;e<i.length;e++)this.player_.addRemoteTextTrack(i[e],!0);this.preselectTrack()})))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let r,a,i;for(let s=0;s<t.length;s++){const o=t[s];n&&n.enabled&&n.language&&n.language===o.language&&o.kind in e?o.kind===n.kind?i=o:i||(i=o):n&&!n.enabled?(i=null,r=null,a=null):o.default&&("descriptions"!==o.kind||r?o.kind in e&&!a&&(a=o):r=o)}i?i.mode="showing":a?a.mode="showing":r&&(r.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"==typeof a().WebVTT&&a().WebVTT.processCues(a(),[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let n=0;n<e.length;++n){const r=e[n];"showing"===r.mode&&t.push(r)}return void this.updateForTrack(t)}let n=null,r=null,a=e.length;for(;a--;){const t=e[a];"showing"===t.mode&&("descriptions"===t.kind?n=t:r=t)}r?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(r)):n&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let r=n.length;for(;r--;){const e=n[r];if(!e)continue;const i=e.displayState;if(t.color&&(i.firstChild.style.color=t.color),t.textOpacity&&Ra(i.firstChild,"color",Na(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(i.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Ra(i.firstChild,"backgroundColor",Na(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Ra(i,"backgroundColor",Na(t.windowColor,t.windowOpacity)):i.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?i.firstChild.style.textShadow=`2px 2px 3px ${Ia}, 2px 2px 4px ${Ia}, 2px 2px 5px ${Ia}`:"raised"===t.edgeStyle?i.firstChild.style.textShadow=`1px 1px ${Ia}, 2px 2px ${Ia}, 3px 3px ${Ia}`:"depressed"===t.edgeStyle?i.firstChild.style.textShadow=`1px 1px ${Ca}, 0 1px ${Ca}, -1px -1px ${Ia}, 0 -1px ${Ia}`:"uniform"===t.edgeStyle&&(i.firstChild.style.textShadow=`0 0 4px ${Ia}, 0 0 4px ${Ia}, 0 0 4px ${Ia}, 0 0 4px ${Ia}`)),t.fontPercent&&1!==t.fontPercent){const e=a().parseFloat(i.style.fontSize);i.style.fontSize=e*t.fontPercent+"px",i.style.height="auto",i.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?i.firstChild.style.fontVariant="small-caps":i.firstChild.style.fontFamily=Ea[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!=typeof a().WebVTT||e.every((e=>!e.activeCues)))return;const t=[];for(let n=0;n<e.length;++n){const r=e[n];for(let e=0;e<r.activeCues.length;++e)t.push(r.activeCues[e])}a().WebVTT.processCues(a(),t,this.el_);for(let t=0;t<e.length;++t){const n=e[t];for(let e=0;e<n.activeCues.length;++e){const r=n.activeCues[e].displayState;un(r,"vjs-text-track-cue","vjs-text-track-cue-"+(n.language?n.language:t)),n.language&&fn(r,"lang",n.language)}this.player_.textTrackSettings&&this.updateDisplayState(n)}}}),kr.registerComponent("LoadingSpinner",class extends kr{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=an("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),r=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}});class Pa extends Ta{createEl(e,t={},n={}){const r=an("button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n));return r.appendChild(an("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}addChild(e,t={}){const n=this.constructor.name;return wt.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),kr.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){l().isEventKey(e,"Space")||l().isEventKey(e,"Enter")?e.stopPropagation():super.handleKeyDown(e)}}kr.registerComponent("Button",Pa);class Da extends Pa{constructor(e,t){super(e,t),this.mouseused_=!1,this.on("mousedown",(e=>this.handleMouseDown(e)))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY)return $r(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(!r)return void this.player_.tech(!0).focus();const a=()=>r.focus();Or(t)?t.then(a,(()=>{})):this.setTimeout(a,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}Da.prototype.controlText_="Play Video",kr.registerComponent("BigPlayButton",Da),kr.registerComponent("CloseButton",class extends Pa{constructor(e,t){super(e,t),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){l().isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}});class Ma extends Pa{constructor(e,t={}){super(e,t),t.replay=void 0===t.replay||t.replay,this.on(e,"play",(e=>this.handlePlay(e))),this.on(e,"pause",(e=>this.handlePause(e))),t.replay&&this.on(e,"ended",(e=>this.handleEnded(e)))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?$r(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",(e=>this.handleSeeked(e)))}}Ma.prototype.controlText_="Play",kr.registerComponent("PlayToggle",Ma);class Oa extends kr{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended"],(e=>this.updateContent(e))),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=an("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)} `},{role:"presentation"});return t.appendChild(n),this.contentEl_=an("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}updateTextNode_(e=0){e=Rr(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",(()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,wt.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=s().createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))})))}updateContent(e){}}Oa.prototype.labelText_="Time",Oa.prototype.controlText_="Time",kr.registerComponent("TimeDisplay",Oa);class $a extends Oa{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}$a.prototype.labelText_="Current Time",$a.prototype.controlText_="Current Time",kr.registerComponent("CurrentTimeDisplay",$a);class Fa extends Oa{constructor(e,t){super(e,t);const n=e=>this.updateContent(e);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}Fa.prototype.labelText_="Duration",Fa.prototype.controlText_="Duration",kr.registerComponent("DurationDisplay",Fa),kr.registerComponent("TimeDivider",class extends kr{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}});class La extends Oa{constructor(e,t){super(e,t),this.on(e,"durationchange",(e=>this.updateContent(e)))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(an("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!=typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}}La.prototype.labelText_="Remaining Time",La.prototype.controlText_="Remaining Time",kr.registerComponent("RemainingTimeDisplay",La),kr.registerComponent("LiveDisplay",class extends kr{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",(e=>this.updateShowing(e)))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=an("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(an("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(s().createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}});class za extends Pa{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=e=>this.updateLiveEdgeStatus(e),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=an("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}function Ba(e,t,n){return e=Number(e),Math.min(n,Math.max(t,isNaN(e)?t:e))}za.prototype.controlText_="Seek to live, currently playing live",kr.registerComponent("SeekToLive",za);var Ua=Object.freeze({__proto__:null,clamp:Ba});class Wa extends kr{constructor(e,t){super(e,t),this.handleMouseDown_=e=>this.handleMouseDown(e),this.handleMouseUp_=e=>this.handleMouseUp(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.handleClick_=e=>this.handleClick(e),this.handleMouseMove_=e=>this.handleMouseMove(e),this.update_=e=>this.update(e),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||Bt||e.preventDefault(),yn(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;bn(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",(()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"}))),e}getProgress(){return Number(Ba(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=vn(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){l().isEventKey(e,"Left")||l().isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):l().isEventKey(e,"Right")||l().isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}kr.registerComponent("Slider",Wa);const Va=(e,t)=>Ba(e/t*100,0,100).toFixed(2)+"%";kr.registerComponent("LoadProgressBar",class extends kr{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",(e=>this.update(e)))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=an("span",{className:"vjs-control-text"}),n=an("span",{textContent:this.localize("Loaded")}),r=s().createTextNode(": ");return this.percentageEl_=an("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",(()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():this.player_.duration(),r=this.player_.bufferedEnd(),a=this.partEls_,i=Va(r,n);this.percent_!==i&&(this.el_.style.width=i,sn(this.percentageEl_,i),this.percent_=i);for(let e=0;e<t.length;e++){const n=t.start(e),i=t.end(e);let s=a[e];s||(s=this.el_.appendChild(an()),a[e]=s),s.dataset.start===n&&s.dataset.end===i||(s.dataset.start=n,s.dataset.end=i,s.style.left=Va(n,r),s.style.width=Va(i-n,r))}for(let e=a.length;e>t.length;e--)this.el_.removeChild(a[e-1]);a.length=t.length}))}}),kr.registerComponent("TimeTooltip",class extends kr{constructor(e,t){super(e,t),this.update=nr(tr(this,this.update),er)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const r=An(this.el_),a=xn(this.player_.el()),i=e.width*t;if(!a||!r)return;const s=e.left-a.left+i,o=e.width-i+(a.right-e.right);let l=r.width/2;s<l?l+=l-s:o<l&&(l=o),l<0?l=0:l>r.width&&(l=r.width),l=Math.round(l),this.el_.style.right=`-${l}px`,this.write(n)}write(e){sn(this.el_,e)}updateTime(e,t,n,r){this.requestNamedAnimationFrame("TimeTooltip#updateTime",(()=>{let a;const i=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),n=e-t*e;a=(n<1?"":"-")+Rr(n,e)}else a=Rr(n,i);this.update(e,t,a),r&&r()}))}});class ja extends kr{constructor(e,t){super(e,t),this.update=nr(tr(this,this.update),er)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const n=this.getChild("timeTooltip");if(!n)return;const r=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,r)}}ja.prototype.options_={children:[]},Zt||$t||ja.prototype.options_.children.push("timeTooltip"),kr.registerComponent("PlayProgressBar",ja);class Ha extends kr{constructor(e,t){super(e,t),this.update=nr(tr(this,this.update),er)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,(()=>{this.el_.style.left=e.width*t+"px"}))}}Ha.prototype.options_={children:["timeTooltip"]},kr.registerComponent("MouseTimeDisplay",Ha);class Ga extends Wa{constructor(e,t){super(e,t),this.setEventHandlers_()}setEventHandlers_(){this.update_=tr(this,this.update),this.update=nr(this.update_,er),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in s()&&"visibilityState"in s()&&this.on(s(),"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===s().visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,er))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===s().visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",(()=>{const e=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),n=this.player_.liveTracker;let r=this.player_.duration();n&&n.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===e&&this.duration_===r||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[Rr(e,r),Rr(r,r)],"{1} of {2}")),this.currentTime_=e,this.duration_=r),this.bar&&this.bar.update(xn(this.el()),this.getProgress())})),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){In(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!In(e))return;let n;t||this.player_.scrubbing()||this.player_.scrubbing(!0);const r=this.calculateDistance(e),a=this.player_.liveTracker;if(a&&a.isLive()){if(r>=.99)return void a.seekToLiveEdge();const e=a.seekableStart(),t=a.liveCurrentTime();if(n=e+r*a.liveWindow(),n>=t&&(n=t),n<=e&&(n=e+.1),n===1/0)return}else n=r*this.player_.duration(),n===this.player_.duration()&&(n-=.1);this.userSeek_(n)}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?$r(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+5)}stepBack(){this.userSeek_(this.player_.currentTime()-5)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(l().isEventKey(e,"Space")||l().isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(l().isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(l().isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(l()(e))){e.preventDefault(),e.stopPropagation();const n=10*(l().codes[l()(e)]-l().codes[0])/100;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else l().isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-60)):l().isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+60)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in s()&&"visibilityState"in s()&&this.off(s(),"visibilitychange",this.toggleVisibility_),super.dispose()}}Ga.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},Zt||$t||Ga.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),kr.registerComponent("SeekBar",Ga);class qa extends kr{constructor(e,t){super(e,t),this.handleMouseMove=nr(tr(this,this.handleMouseMove),er),this.throttledHandleMouseSeek=nr(tr(this,this.handleMouseSeek),er),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.handleMouseDownHandler_=e=>this.handleMouseDown(e),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),r=t.getChild("mouseTimeDisplay");if(!n&&!r)return;const a=t.el(),i=An(a);let s=vn(a,e).x;s=Ba(s,0,1),r&&r.update(i,s),n&&n.update(i,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach((e=>e.disable&&e.disable())),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&$r(this.player_.play())}}enable(){this.children().forEach((e=>e.enable&&e.enable())),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}qa.prototype.options_={children:["seekBar"]},kr.registerComponent("ProgressControl",qa);class Xa extends Pa{constructor(e,t){super(e,t),this.on(e,["enterpictureinpicture","leavepictureinpicture"],(e=>this.handlePictureInPictureChange(e))),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],(e=>this.handlePictureInPictureEnabledChange(e))),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],(()=>{"audio"===e.currentType().substring(0,5)||e.audioPosterMode()||e.audioOnlyMode()?(e.isInPictureInPicture()&&e.exitPictureInPicture(),this.hide()):this.show()})),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control ${super.buildCSSClass()}`}handlePictureInPictureEnabledChange(){s().pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in a()?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}}Xa.prototype.controlText_="Picture-in-Picture",kr.registerComponent("PictureInPictureToggle",Xa);class Ka extends Pa{constructor(e,t){super(e,t),this.on(e,"fullscreenchange",(e=>this.handleFullscreenChange(e))),!1===s()[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?this.controlText("Exit Fullscreen"):this.controlText("Fullscreen")}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}Ka.prototype.controlText_="Fullscreen",kr.registerComponent("FullscreenToggle",Ka),kr.registerComponent("VolumeLevel",class extends kr{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}),kr.registerComponent("VolumeLevelTooltip",class extends kr{constructor(e,t){super(e,t),this.update=nr(tr(this,this.update),er)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,r){if(!n){const n=xn(this.el_),r=xn(this.player_.el()),a=e.width*t;if(!r||!n)return;const i=e.left-r.left+a,s=e.width-a+(r.right-e.right);let o=n.width/2;i<o?o+=o-i:s<o&&(o=s),o<0?o=0:o>n.width&&(o=n.width),this.el_.style.right=`-${o}px`}this.write(`${r}%`)}write(e){sn(this.el_,e)}updateVolume(e,t,n,r,a){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",(()=>{this.update(e,t,n,r.toFixed(0)),a&&a()}))}});class Za extends kr{constructor(e,t){super(e,t),this.update=nr(tr(this,this.update),er)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,r,(()=>{n?this.el_.style.bottom=e.height*t+"px":this.el_.style.left=e.width*t+"px"}))}}Za.prototype.options_={children:["volumeLevelTooltip"]},kr.registerComponent("MouseVolumeLevelDisplay",Za);class Ya extends Wa{constructor(e,t){super(e,t),this.on("slideractive",(e=>this.updateLastVolume_(e))),this.on(e,"volumechange",(e=>this.updateARIAAttributes(e))),e.ready((()=>this.updateARIAAttributes()))}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){In(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),r=xn(n),a=this.vertical();let i=vn(n,e);i=a?i.y:i.x,i=Ba(i,0,1),t.update(r,i,a)}In(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",(()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)}))}}Ya.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},Zt||$t||Ya.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Ya.prototype.playerEvent="volumechange",kr.registerComponent("VolumeBar",Ya);class Ja extends kr{constructor(e,t={}){t.vertical=t.vertical||!1,(void 0===t.volumeBar||Et(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))}(this,e),this.throttledHandleMouseMove=nr(tr(this,this.handleMouseMove),er),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.on("mousedown",(e=>this.handleMouseDown(e))),this.on("touchstart",(e=>this.handleMouseDown(e))),this.on("mousemove",(e=>this.handleMouseMove(e))),this.on(this.volumeBar,["focus","slideractive"],(()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")})),this.on(this.volumeBar,["blur","sliderinactive"],(()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")}))}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}Ja.prototype.options_={children:["volumeBar"]},kr.registerComponent("VolumeControl",Ja);class Qa extends Pa{constructor(e,t){super(e,t),function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))}(this,e),this.on(e,["loadstart","volumechange"],(e=>this.update(e)))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(0===t){const e=n<.1?.1:n;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;Zt&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2),dn(this.el_,[0,1,2,3].reduce(((e,t)=>e+`${t?" ":""}vjs-vol-${t}`),"")),un(this.el_,`vjs-vol-${t}`)}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)}}Qa.prototype.controlText_="Mute",kr.registerComponent("MuteToggle",Qa);class ei extends kr{constructor(e,t={}){void 0!==t.inline?t.inline=t.inline:t.inline=!0,(void 0===t.volumeControl||Et(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=e=>this.handleKeyPress(e),this.on(e,["loadstart"],(e=>this.volumePanelState_(e))),this.on(this.muteToggle,"keyup",(e=>this.handleKeyPress(e))),this.on(this.volumeControl,"keyup",(e=>this.handleVolumeControlKeyUp(e))),this.on("keydown",(e=>this.handleKeyPress(e))),this.on("mouseover",(e=>this.handleMouseOver(e))),this.on("mouseout",(e=>this.handleMouseOut(e))),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){l().isEventKey(e,"Esc")&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),Xn(s(),"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),Kn(s(),"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){l().isEventKey(e,"Esc")&&this.handleMouseOut()}}ei.prototype.options_={children:["muteToggle","volumeControl"]},kr.registerComponent("VolumePanel",ei),kr.registerComponent("SkipForward",class extends Pa{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()?n.seekableEnd():this.player_.duration();let a;a=t+this.skipTime<=r?t+this.skipTime:r,this.player_.currentTime(a)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}});class ti extends Pa{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()&&n.seekableStart();let a;a=r&&t-this.skipTime<=r?r:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(a)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}ti.prototype.controlText_="Skip Backward",kr.registerComponent("SkipBackward",ti);class ni extends kr{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",(e=>this.handleKeyDown(e))),this.boundHandleBlur_=e=>this.handleBlur(e),this.boundHandleTapClick_=e=>this.handleTapClick(e)}addEventListenerForItem(e){e instanceof kr&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof kr&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=an(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),Xn(t,"click",(function(e){e.preventDefault(),e.stopImmediatePropagation()})),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||s().activeElement;if(!this.children().some((e=>e.el()===t))){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter((t=>t.el()===e.target))[0];if(!n)return;"CaptionSettingsMenuItem"!==n.name()&&this.menuButton_.focus()}}handleKeyDown(e){l().isEventKey(e,"Left")||l().isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(l().isEventKey(e,"Right")||l().isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}kr.registerComponent("Menu",ni);class ri extends kr{constructor(e,t={}){super(e,t),this.menuButton_=new Pa(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Pa.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const r=e=>this.handleClick(e);this.handleMenuKeyUp_=e=>this.handleMenuKeyUp(e),this.on(this.menuButton_,"tap",r),this.on(this.menuButton_,"click",r),this.on(this.menuButton_,"keydown",(e=>this.handleKeyDown(e))),this.on(this.menuButton_,"mouseenter",(()=>{this.addClass("vjs-hover"),this.menu.show(),Xn(s(),"keyup",this.handleMenuKeyUp_)})),this.on("mouseleave",(e=>this.handleMouseLeave(e))),this.on("keydown",(e=>this.handleSubmenuKeyDown(e)))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new ni(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=an("li",{className:"vjs-menu-title",textContent:Ar(this.options_.title),tabIndex:-1}),n=new kr(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}buildWrapperCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${Pa.prototype.buildCSSClass()} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),Kn(s(),"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){l().isEventKey(e,"Esc")||l().isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),l().isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(l().isEventKey(e,"Up")||l().isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(l().isEventKey(e,"Esc")||l().isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(l().isEventKey(e,"Esc")||l().isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),l().isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),Zt&&nn())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}kr.registerComponent("MenuButton",ri);class ai extends ri{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const r=tr(this,this.update);n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),n.addEventListener("labelchange",r),this.player_.on("ready",r),this.player_.on("dispose",(function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r),n.removeEventListener("labelchange",r)}))}}kr.registerComponent("TrackButton",ai);const ii=["Tab","Esc","Up","Down","Right","Left"];class si extends Ta{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const r=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n);return r.replaceChild(an("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),r.querySelector(".vjs-icon-placeholder")),r}handleKeyDown(e){ii.some((t=>l().isEventKey(e,t)))||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}kr.registerComponent("MenuItem",si);class oi extends si{constructor(e,t){const n=t.track,r=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected="showing"===n.mode,super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const i=(...e)=>{this.handleTracksChange.apply(this,e)},o=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],i),r.addEventListener("change",i),r.addEventListener("selectedlanguagechange",o),this.on("dispose",(function(){e.off(["loadstart","texttrackchange"],i),r.removeEventListener("change",i),r.removeEventListener("selectedlanguagechange",o)})),void 0===r.onchange){let e;this.on(["tap","click"],(function(){if("object"!=typeof a().Event)try{e=new(a().Event)("change")}catch(e){}e||(e=s().createEvent("Event"),e.initEvent("change",!0,!0)),r.dispatchEvent(e)}))}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),n)for(let e=0;e<n.length;e++){const r=n[e];-1!==this.kinds.indexOf(r.kind)&&(r===t?"showing"!==r.mode&&(r.mode="showing"):"disabled"!==r.mode&&(r.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}kr.registerComponent("TextTrackMenuItem",oi);class li extends oi{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(this.options_.kinds.indexOf(r.kind)>-1&&"showing"===r.mode){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(["captions","descriptions","subtitles"].indexOf(r.kind)>-1&&"showing"===r.mode){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}kr.registerComponent("OffTextTrackMenuItem",li);class ui extends ai{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=oi){let n;this.label_&&(n=`${this.label_} off`),e.push(new li(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const r=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let n=0;n<r.length;n++){const a=r[n];if(this.kinds_.indexOf(a.kind)>-1){const n=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});n.addClass(`vjs-${a.kind}-menu-item`),e.push(n)}}return e}}kr.registerComponent("TextTrackButton",ui);class di extends si{constructor(e,t){const n=t.track,r=t.cue,a=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=r.text,t.selected=r.startTime<=a&&a<r.endTime,super(e,t),this.track=n,this.cue=r}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}kr.registerComponent("ChaptersTrackMenuItem",di);class ci extends ui{constructor(e,t,n){super(e,t,n),this.selectCurrentItem_=()=>{this.items.forEach((e=>{e.selected(this.track_.activeCues[0]===e.cue)}))}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(Ar(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,r=t.length;n<r;n++){const r=t[n],a=new di(this.player_,{track:this.track_,cue:r});e.push(a)}return e}}ci.prototype.kind_="chapters",ci.prototype.controlText_="Chapters",kr.registerComponent("ChaptersButton",ci);class hi extends ui{constructor(e,t,n){super(e,t,n);const r=e.textTracks(),a=tr(this,this.handleTracksChange);r.addEventListener("change",a),this.on("dispose",(function(){r.removeEventListener("change",a)}))}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(r.kind!==this.kind_&&"showing"===r.mode){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}hi.prototype.kind_="descriptions",hi.prototype.controlText_="Descriptions",kr.registerComponent("DescriptionsButton",hi);class pi extends ui{constructor(e,t,n){super(e,t,n)}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}pi.prototype.kind_="subtitles",pi.prototype.controlText_="Subtitles",kr.registerComponent("SubtitlesButton",pi);class mi extends oi{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}kr.registerComponent("CaptionSettingsMenuItem",mi);class fi extends ui{constructor(e,t,n){super(e,t,n)}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new mi(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}fi.prototype.kind_="captions",fi.prototype.controlText_="Captions",kr.registerComponent("CaptionsButton",fi);class gi extends oi{createEl(e,t,n){const r=super.createEl(e,t,n),a=r.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(a.appendChild(an("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),a.appendChild(an("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),r}}kr.registerComponent("SubsCapsMenuItem",gi);class yi extends ui{constructor(e,t={}){super(e,t),this.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions"),this.menuButton_.controlText(Ar(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new mi(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,gi),e}}yi.prototype.kinds_=["captions","subtitles"],yi.prototype.controlText_="Subtitles",kr.registerComponent("SubsCapsButton",yi);class bi extends si{constructor(e,t){const n=t.track,r=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const a=(...e)=>{this.handleTracksChange.apply(this,e)};r.addEventListener("change",a),this.on("dispose",(()=>{r.removeEventListener("change",a)}))}createEl(e,t,n){const r=super.createEl(e,t,n),a=r.querySelector(".vjs-menu-item-text");return"main-desc"===this.options_.track.kind&&(a.appendChild(an("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),a.appendChild(an("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),r}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const n=e[t];n!==this.track&&(n.enabled=n===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}kr.registerComponent("AudioTrackMenuItem",bi);class xi extends ai{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t)}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];e.push(new bi(this.player_,{track:r,selectable:!0,multiSelectable:!1}))}return e}}xi.prototype.controlText_="Audio Track",kr.registerComponent("AudioTrackButton",xi);class Ai extends si{constructor(e,t){const n=t.rate,r=parseFloat(n,10);t.label=n,t.selected=r===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=r,this.on(e,"ratechange",(e=>this.update(e)))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}Ai.prototype.contentElType="button",kr.registerComponent("PlaybackRateMenuItem",Ai);class vi extends ri{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",(e=>this.updateVisibility(e))),this.on(e,"ratechange",(e=>this.updateLabel(e))),this.on(e,"playbackrateschange",(e=>this.handlePlaybackRateschange(e)))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=an("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new Ai(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}vi.prototype.controlText_="Playback Rate",kr.registerComponent("PlaybackRateMenuButton",vi);class wi extends kr{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}kr.registerComponent("Spacer",wi),kr.registerComponent("CustomControlSpacer",class extends wi{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:" "})}});class ki extends kr{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}ki.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in s()&&ki.prototype.options_.children.splice(ki.prototype.options_.children.length-1,0,"pictureInPictureToggle"),kr.registerComponent("ControlBar",ki);class Si extends zr{constructor(e,t){super(e,t),this.on(e,"error",(e=>this.open(e)))}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}Si.prototype.options_=Object.assign({},zr.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),kr.registerComponent("ErrorDisplay",Si);const Ti="vjs-text-track-settings",_i=["#000","Black"],Ii=["#00F","Blue"],Ci=["#0FF","Cyan"],Ei=["#0F0","Green"],Ni=["#F0F","Magenta"],Ri=["#F00","Red"],Pi=["#FFF","White"],Di=["#FF0","Yellow"],Mi=["1","Opaque"],Oi=["0.5","Semi-Transparent"],$i=["0","Transparent"],Fi={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[_i,Pi,Ri,Ei,Ii,Di,Ni,Ci]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Mi,Oi,$i]},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Pi,_i,Ri,Ei,Ii,Di,Ni,Ci]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Mi,Oi]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[$i,Oi,Mi]}};function Li(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}Fi.windowColor.options=Fi.backgroundColor.options,kr.registerComponent("TextTrackSettings",class extends zr{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.endDialog=an("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.on(this.$(".vjs-done-button"),"click",(()=>{this.saveSettings(),this.close()})),this.on(this.$(".vjs-default-button"),"click",(()=>{this.setDefaults(),this.updateDisplay()})),_t(Fi,(e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})),this.options_.persistTextTrackSettings&&this.restoreSettings()}dispose(){this.endDialog=null,super.dispose()}createElSelect_(e,t="",n="label"){const r=Fi[e],a=r.id.replace("%s",this.id_),i=[t,a].join(" ").trim();return[`<${n} id="${a}" class="${"label"===n?"vjs-label":""}">`,this.localize(r.label),`</${n}>`,`<select aria-labelledby="${i}">`].concat(r.options.map((e=>{const t=a+"-"+e[1].replace(/\W+/g,"");return[`<option id="${t}" value="${e[0]}" `,`aria-labelledby="${i} ${t}">`,this.localize(e[1]),"</option>"].join("")}))).concat("</select>").join("")}createElFgColor_(){const e=`captions-text-legend-${this.id_}`;return['<fieldset class="vjs-fg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text"),"</legend>",'<span class="vjs-text-color">',this.createElSelect_("color",e),"</span>",'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")}createElBgColor_(){const e=`captions-background-${this.id_}`;return['<fieldset class="vjs-bg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text Background"),"</legend>",'<span class="vjs-bg-color">',this.createElSelect_("backgroundColor",e),"</span>",'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")}createElWinColor_(){const e=`captions-window-${this.id_}`;return['<fieldset class="vjs-window vjs-track-setting">',`<legend id="${e}">`,this.localize("Caption Area Background"),"</legend>",'<span class="vjs-window-color">',this.createElSelect_("windowColor",e),"</span>",'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")}createElColors_(){return an("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})}createElFont_(){return an("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})}createElControls_(){const e=this.localize("restore all settings to the default values");return an("div",{className:"vjs-track-settings-controls",innerHTML:[`<button type="button" class="vjs-default-button" title="${e}">`,this.localize("Reset"),`<span class="vjs-control-text"> ${e}</span>`,"</button>",`<button type="button" class="vjs-done-button">${this.localize("Done")}</button>`].join("")})}content(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return It(Fi,((e,t,n)=>{const r=(a=this.$(t.selector),i=t.parser,Li(a.options[a.options.selectedIndex].value,i));var a,i;return void 0!==r&&(e[n]=r),e}),{})}setValues(e){_t(Fi,((t,n)=>{!function(e,t,n){if(t)for(let r=0;r<e.options.length;r++)if(Li(e.options[r].value,n)===t){e.selectedIndex=r;break}}(this.$(t.selector),e[n],t.parser)}))}setDefaults(){_t(Fi,(e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t}))}restoreSettings(){let e;try{e=JSON.parse(a().localStorage.getItem(Ti))}catch(e){wt.warn(e)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?a().localStorage.setItem(Ti,JSON.stringify(e)):a().localStorage.removeItem(Ti)}catch(e){wt.warn(e)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}conditionalBlur_(){this.previouslyActiveEl_=null;const e=this.player_.controlBar,t=e&&e.subsCapsButton,n=e&&e.captionsButton;t?t.focus():n&&n.focus()}handleLanguagechange(){this.fill()}}),kr.registerComponent("ResizeManager",class extends kr{constructor(e,t){let n=t.ResizeObserver||a().ResizeObserver;null===t.ResizeObserver&&(n=!1),super(e,Nt({createEl:!n,reportTouchActivity:!1},t)),this.ResizeObserver=t.ResizeObserver||a().ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=rr((()=>{this.resizeHandler()}),100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){Kn(this,"resize",e),Kn(this,"unload",t),t=null};Xn(this.el_.contentWindow,"unload",t),Xn(this.el_.contentWindow,"resize",e)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}});const zi={trackingThreshold:20,liveTolerance:15};kr.registerComponent("LiveTracker",class extends kr{constructor(e,t){super(e,Nt(zi,t,{createEl:!1})),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=e=>this.handlePlay(e),this.handleFirstTimeupdate_=e=>this.handleFirstTimeupdate(e),this.handleSeeked_=e=>this.handleSeeked(e),this.seekToLiveEdge_=e=>this.seekToLiveEdge(e),this.reset_(),this.on(this.player_,"durationchange",(e=>this.handleDurationchange(e))),this.on(this.player_,"canplay",(()=>this.toggleTracking()))}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(a().performance.now().toFixed(4)),n=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const r=this.liveCurrentTime(),i=this.player_.currentTime();let s=this.player_.paused()||this.seekedBehindLive_||Math.abs(r-i)>this.options_.liveTolerance;this.timeupdateSeen_&&r!==1/0||(s=!1),s!==this.behindLiveEdge_&&(this.behindLiveEdge_=s,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,er),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"==typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}),kr.registerComponent("TitleBar",class extends kr{constructor(e,t){super(e,t),this.on("statechanged",(e=>this.updateDom_())),this.updateDom_()}createEl(){return this.els={title:an("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${Wn()}`}),description:an("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${Wn()}`})},an("div",{className:"vjs-title-bar"},{},Object.values(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach((e=>{const r=this.state[e],a=this.els[e],i=n[e];kn(a),r&&sn(a,r),t&&(t.removeAttribute(i),r&&t.setAttribute(i,a.id))})),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}});const Bi=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const n=e.$$("source"),r=[];let a="";if(!n.length)return!1;for(let e=0;e<n.length;e++){const t=n[e].src;t&&-1===r.indexOf(t)&&r.push(t)}return!!r.length&&(1===r.length&&(a=r[0]),e.triggerSourceset(a),!0)},Ui=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=s().createElement(this.nodeName.toLowerCase());t.innerHTML=e;const n=s().createDocumentFragment();for(;t.childNodes.length;)n.appendChild(t.childNodes[0]);return this.innerText="",a().Element.prototype.appendChild.call(this,n),this.innerHTML}}),Wi=(e,t)=>{let n={};for(let r=0;r<e.length&&(n=Object.getOwnPropertyDescriptor(e[r],t),!(n&&n.set&&n.get));r++);return n.enumerable=!0,n.configurable=!0,n},Vi=function(e){const t=e.el();if(t.resetSourceWatch_)return;const n={},r=(e=>Wi([e.el(),a().HTMLMediaElement.prototype,a().Element.prototype,Ui],"innerHTML"))(e),i=n=>(...r)=>{const a=n.apply(t,r);return Bi(e),a};["append","appendChild","insertAdjacentHTML"].forEach((e=>{t[e]&&(n[e]=t[e],t[e]=i(n[e]))})),Object.defineProperty(t,"innerHTML",Nt(r,{set:i(r.set)})),t.resetSourceWatch_=()=>{t.resetSourceWatch_=null,Object.keys(n).forEach((e=>{t[e]=n[e]})),Object.defineProperty(t,"innerHTML",r)},e.one("sourceset",t.resetSourceWatch_)},ji=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?Yr(a().Element.prototype.getAttribute.call(this,"src")):""},set(e){return a().Element.prototype.setAttribute.call(this,"src",e),e}});class Hi extends da{constructor(e,t){super(e,t);const n=e.source;let r=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,n&&(this.el_.currentSrc!==n.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const n=[];for(;t--;){const a=e[t];"track"===a.nodeName.toLowerCase()&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(a),this.remoteTextTracks().addTrack(a.track),this.textTracks().addTrack(a.track),r||this.el_.hasAttribute("crossorigin")||!Qr(a.src)||(r=!0)):n.push(a))}for(let e=0;e<n.length;e++)this.el_.removeChild(n[e])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&r&&wt.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),(Xt||qt)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),Hi.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){!function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const n=(e=>Wi([e.el(),a().HTMLMediaElement.prototype,ji],"src"))(e),r=t.setAttribute,i=t.load;Object.defineProperty(t,"src",Nt(n,{set:r=>{const a=n.set.call(t,r);return e.triggerSourceset(t.src),a}})),t.setAttribute=(n,a)=>{const i=r.call(t,n,a);return/src/i.test(n)&&e.triggerSourceset(t.src),i},t.load=()=>{const n=i.call(t);return Bi(e)||(e.triggerSourceset(""),Vi(e)),n},t.currentSrc?e.triggerSourceset(t.currentSrc):Bi(e)||Vi(e),t.resetSourceset_=()=>{t.resetSourceset_=null,t.load=i,t.setAttribute=r,Object.defineProperty(t,"src",n),t.resetSourceWatch_&&t.resetSourceWatch_()}}(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let n=0;n<e.length;n++){const r=e[n];"metadata"===r.kind&&t.push({track:r,storedMode:r.mode})}};n(),e.addEventListener("change",n),this.on("dispose",(()=>e.removeEventListener("change",n)));const r=()=>{for(let e=0;e<t.length;e++){const n=t[e];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}e.removeEventListener("change",r)};this.on("webkitbeginfullscreen",(()=>{e.removeEventListener("change",n),e.removeEventListener("change",r),e.addEventListener("change",r)})),this.on("webkitendfullscreen",(()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",r)}))}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach((e=>{this.el()[`${n}Tracks`].removeEventListener(e,this[`${n}TracksListeners_`][e])})),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=oa[e],n=this.el()[t.getterName],r=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const a={change:t=>{const n={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(n),"text"===e&&this[la.remoteText.getterName]().trigger(n)},addtrack(e){r.addTrack(e.track)},removetrack(e){r.removeTrack(e.track)}},i=function(){const e=[];for(let t=0;t<r.length;t++){let a=!1;for(let e=0;e<n.length;e++)if(n[e]===r[t]){a=!0;break}a||e.push(r[t])}for(;e.length;)r.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=a,Object.keys(a).forEach((e=>{const t=a[e];n.addEventListener(e,t),this.on("dispose",(r=>n.removeEventListener(e,t)))})),this.on("loadstart",i),this.on("dispose",(e=>this.off("loadstart",i)))}proxyNativeTracks_(){oa.names.forEach((e=>{this.proxyNativeTracksForType_(e)}))}createEl(){let e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),Hi.disposeMediaElement(e),e=t}else{e=s().createElement("video");const t=Nt({},this.options_.tag&&pn(this.options_.tag));Xt&&!0===this.options_.nativeControlsForTouch||delete t.controls,hn(e,Object.assign(t,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&fn(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const r=t[n],a=this.options_[r];void 0!==a&&(a?fn(e,r,r):gn(e,r),e[r]=a)}return e}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const n=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready((function(){this.off("loadstart",t),this.off("loadedmetadata",n),e||this.trigger("loadstart")}))}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready((function(){t.forEach((function(e){this.trigger(e)}),this)}))}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&Yt?this.el_.fastSeek(e):this.el_.currentTime=e}catch(e){wt(e,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&$t&&Bt&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",(()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)}))}supportsFullScreen(){return"function"==typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)$r(this.el_.play()),this.setTimeout((function(){e.pause();try{e.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}}),0);else try{e.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}reset(){Hi.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=s().createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)e!==t[n]&&e!==t[n].track||this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),a().performance&&(e.creationTime=a().performance.now()),e}}Rt(Hi,"TEST_VID",(function(){if(!en())return;const e=s().createElement("video"),t=s().createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e})),Hi.isSupported=function(){try{Hi.TEST_VID.volume=.5}catch(e){return!1}return!(!Hi.TEST_VID||!Hi.TEST_VID.canPlayType)},Hi.canPlayType=function(e){return Hi.TEST_VID.canPlayType(e)},Hi.canPlaySource=function(e,t){return Hi.canPlayType(e.type)},Hi.canControlVolume=function(){try{const e=Hi.TEST_VID.volume;Hi.TEST_VID.volume=e/2+.1;const t=e!==Hi.TEST_VID.volume;return t&&Zt?(a().setTimeout((()=>{Hi&&Hi.prototype&&(Hi.prototype.featuresVolumeControl=e!==Hi.TEST_VID.volume)})),!1):t}catch(e){return!1}},Hi.canMuteVolume=function(){try{const e=Hi.TEST_VID.muted;return Hi.TEST_VID.muted=!e,Hi.TEST_VID.muted?fn(Hi.TEST_VID,"muted","muted"):gn(Hi.TEST_VID,"muted"),e!==Hi.TEST_VID.muted}catch(e){return!1}},Hi.canControlPlaybackRate=function(){if($t&&Bt&&Wt<58)return!1;try{const e=Hi.TEST_VID.playbackRate;return Hi.TEST_VID.playbackRate=e/2+.1,e!==Hi.TEST_VID.playbackRate}catch(e){return!1}},Hi.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(s().createElement("video"),"src",{get:e,set:e}),Object.defineProperty(s().createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(s().createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(s().createElement("audio"),"innerHTML",{get:e,set:e})}catch(e){return!1}return!0},Hi.supportsNativeTextTracks=function(){return Yt||Zt&&Bt},Hi.supportsNativeVideoTracks=function(){return!(!Hi.TEST_VID||!Hi.TEST_VID.videoTracks)},Hi.supportsNativeAudioTracks=function(){return!(!Hi.TEST_VID||!Hi.TEST_VID.audioTracks)},Hi.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach((function([e,t]){Rt(Hi.prototype,e,(()=>Hi[t]()),!0)})),Hi.prototype.featuresVolumeControl=Hi.canControlVolume(),Hi.prototype.movingMediaElementInDOM=!Zt,Hi.prototype.featuresFullscreenResize=!0,Hi.prototype.featuresProgressEvents=!0,Hi.prototype.featuresTimeupdateEvents=!0,Hi.prototype.featuresVideoFrameCallback=!(!Hi.TEST_VID||!Hi.TEST_VID.requestVideoFrameCallback),Hi.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e){}}()}},Hi.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let n=t.length;for(;n--;)e.removeChild(t[n]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach((function(e){Hi.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}})),["muted","defaultMuted","autoplay","loop","playsinline"].forEach((function(e){Hi.prototype["set"+Ar(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}})),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach((function(e){Hi.prototype[e]=function(){return this.el_[e]}})),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach((function(e){Hi.prototype["set"+Ar(e)]=function(t){this.el_[e]=t}})),["pause","load","play"].forEach((function(e){Hi.prototype[e]=function(){return this.el_[e]()}})),da.withSourceHandlers(Hi),Hi.nativeSourceHandler={},Hi.nativeSourceHandler.canPlayType=function(e){try{return Hi.TEST_VID.canPlayType(e)}catch(e){return""}},Hi.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return Hi.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=Jr(e.src);return Hi.nativeSourceHandler.canPlayType(`video/${t}`)}return""},Hi.nativeSourceHandler.handleSource=function(e,t,n){t.setSrc(e.src)},Hi.nativeSourceHandler.dispose=function(){},Hi.registerSourceHandler(Hi.nativeSourceHandler),da.registerTech("Html5",Hi);const Gi=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],qi={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},Xi=["tiny","xsmall","small","medium","large","xlarge","huge"],Ki={};Xi.forEach((e=>{const t="x"===e.charAt(0)?`x-${e.substring(1)}`:e;Ki[e]=`vjs-layout-${t}`}));const Zi={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class Yi extends kr{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${Wn()}`,(t=Object.assign(Yi.getTagSettings(e),t)).initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const n=e.closest("[lang]");n&&(t.language=n.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=e=>this.documentFullscreenChange_(e),this.boundFullWindowOnEscKey_=e=>this.fullWindowOnEscKey(e),this.boundUpdateStyleEl_=e=>this.updateStyleEl_(e),this.boundApplyInitTime_=e=>this.applyInitTime_(e),this.boundUpdateCurrentBreakpoint_=e=>this.updateCurrentBreakpoint_(e),this.boundHandleTechClick_=e=>this.handleTechClick_(e),this.boundHandleTechDoubleClick_=e=>this.handleTechDoubleClick_(e),this.boundHandleTechTouchStart_=e=>this.handleTechTouchStart_(e),this.boundHandleTechTouchMove_=e=>this.handleTechTouchMove_(e),this.boundHandleTechTouchEnd_=e=>this.handleTechTouchEnd_(e),this.boundHandleTechTap_=e=>this.handleTechTap_(e),this.isFullscreen_=!1,this.log=kt(this.id_),this.fsApi_=yt,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&pn(e),this.language(this.options_.language),t.languages){const e={};Object.getOwnPropertyNames(t.languages).forEach((function(n){e[n.toLowerCase()]=t.languages[n]})),this.languages_=e}else this.languages_=Yi.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach((e=>{if("function"!=typeof this[e])throw new Error(`plugin "${e}" does not exist`)})),this.scrubbing_=!1,this.el_=this.createEl(),gr(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(Xn(s(),this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=Nt(this.options_);t.plugins&&Object.keys(t.plugins).forEach((e=>{this[e](t.plugins[e])})),t.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(t.playbackRates),this.initChildren(),this.isAudio("audio"===e.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),Xt&&this.addClass("vjs-touch-enabled"),Zt||this.addClass("vjs-workinghover"),Yi.players[this.id_]=this;const a=pt.split(".")[0];this.addClass(`vjs-v${a}`),this.userActive(!0),this.reportUserActivity(),this.one("play",(e=>this.listenForUserActivity_(e))),this.on("keydown",(e=>this.handleKeyDown(e))),this.on("languagechange",(e=>this.handleLanguagechange(e))),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",(()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)}))}dispose(){this.trigger("dispose"),this.off("dispose"),Kn(s(),this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Kn(s(),"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),Yi.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),ha[this.id()]=null,ua.names.forEach((e=>{const t=this[ua[e].getterName]();t&&t.off&&t.off()})),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,n=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const r="video-js"===this.tag.tagName.toLowerCase();n?e=this.el_=t.parentNode:r||(e=this.el_=super.createEl("div"));const i=pn(t);if(r){for(e=this.el_=t,t=this.tag=s().createElement("video");e.children.length;)t.appendChild(e.firstChild);ln(e,"video-js")||un(e,"video-js"),e.appendChild(t),n=this.playerElIngest_=e,Object.keys(e).forEach((n=>{try{t[n]=e[n]}catch(e){}}))}if(t.setAttribute("tabindex","-1"),i.tabindex="-1",Bt&&Ht&&(t.setAttribute("role","application"),i.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in i&&delete i.width,"height"in i&&delete i.height,Object.getOwnPropertyNames(i).forEach((function(n){r&&"class"===n||e.setAttribute(n,i[n]),r&&t.setAttribute(n,i[n])})),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused"),!0!==a().VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=Fn("vjs-styles-dimensions");const e=Cn(".vjs-styles-defaults"),t=Cn("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const o=t.getElementsByTagName("a");for(let e=0;e<o.length;e++){const t=o.item(e);un(t,"vjs-hidden"),t.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!n&&t.parentNode.insertBefore(e,t),on(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if(void 0===e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):wt.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(void 0===t)return this[n]||0;if(""===t||"auto"===t)return this[n]=void 0,void this.updateStyleEl_();const r=parseFloat(t);isNaN(r)?wt.error(`Improper value "${t}" supplied for for ${e}`):(this[n]=r,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;var t,n;this.fluid_=!!e,lr(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),n=()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)},lr(t=this)?n():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(n))):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===a().VIDEOJS_NO_DYNAMIC_STYLE){const e="number"==typeof this.width_?this.width_:this.options_.width,t="number"==typeof this.height_?this.height_:this.options_.height,n=this.tech_&&this.tech_.el();return void(n&&(e>=0&&(n.width=e),t>=0&&(n.height=t)))}let e,t,n,r;n=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const i=n.split(":"),s=i[1]/i[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/s:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*s,r=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(r),Ln(this.styleEl_,`\n      .${r} {\n        width: ${e}px;\n        height: ${t}px;\n      }\n\n      .${r}.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ${100*s}%;\n      }\n    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=Ar(e),r=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(da.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let a=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(a=!1);const i={source:t,autoplay:a,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${r}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};ua.names.forEach((e=>{const t=ua[e];i[t.getterName]=this[t.privateName]})),Object.assign(i,this.options_[n]),Object.assign(i,this.options_[r]),Object.assign(i,this.options_[e.toLowerCase()]),this.tag&&(i.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(i.startTime=this.cache_.currentTime);const s=da.getTech(e);if(!s)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);var o,l;this.tech_=new s(i),this.tech_.ready(tr(this,this.handleTechReady_),!0),o=this.textTracksJson_||[],l=this.tech_,o.forEach((function(e){const t=l.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach((e=>t.addCue(e)))})),l.textTracks(),Gi.forEach((e=>{this.on(this.tech_,e,(t=>this[`handleTech${Ar(e)}_`](t)))})),Object.keys(qi).forEach((e=>{this.on(this.tech_,e,(t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${qi[e]}_`].bind(this),event:t}):this[`handleTech${qi[e]}_`](t)}))})),this.on(this.tech_,"loadstart",(e=>this.handleTechLoadStart_(e))),this.on(this.tech_,"sourceset",(e=>this.handleTechSourceset_(e))),this.on(this.tech_,"waiting",(e=>this.handleTechWaiting_(e))),this.on(this.tech_,"ended",(e=>this.handleTechEnded_(e))),this.on(this.tech_,"seeking",(e=>this.handleTechSeeking_(e))),this.on(this.tech_,"play",(e=>this.handleTechPlay_(e))),this.on(this.tech_,"pause",(e=>this.handleTechPause_(e))),this.on(this.tech_,"durationchange",(e=>this.handleTechDurationChange_(e))),this.on(this.tech_,"fullscreenchange",((e,t)=>this.handleTechFullscreenChange_(e,t))),this.on(this.tech_,"fullscreenerror",((e,t)=>this.handleTechFullscreenError_(e,t))),this.on(this.tech_,"enterpictureinpicture",(e=>this.handleTechEnterPictureInPicture_(e))),this.on(this.tech_,"leavepictureinpicture",(e=>this.handleTechLeavePictureInPicture_(e))),this.on(this.tech_,"error",(e=>this.handleTechError_(e))),this.on(this.tech_,"posterchange",(e=>this.handleTechPosterChange_(e))),this.on(this.tech_,"textdata",(e=>this.handleTechTextData_(e))),this.on(this.tech_,"ratechange",(e=>this.handleTechRateChange_(e))),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||on(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){ua.names.forEach((e=>{const t=ua[e];this[t.privateName]=this[t.getterName]()})),this.textTracksJson_=function(e){const t=e.$$("track"),n=Array.prototype.map.call(t,(e=>e.track));return Array.prototype.map.call(t,(function(e){const t=Fr(e.track);return e.src&&(t.src=e.src),t})).concat(Array.prototype.filter.call(e.textTracks(),(function(e){return-1===n.indexOf(e)})).map(Fr))}(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&wt.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!=typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const n=this.play();if(Or(n))return n.catch((e=>{throw t(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${e||""}`)}))};let n;return"any"!==e||this.muted()?n="muted"!==e||this.muted()?this.play():t():(n=this.play(),Or(n)&&(n=n.catch(t))),Or(n)?n.then((()=>{this.trigger({type:"autoplay-success",autoplay:e})})).catch((()=>{this.trigger({type:"autoplay-failure",autoplay:e})})):void 0}updateSourceCaches_(e=""){let t=e,n="";"string"!=typeof t&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=((e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const n=e.cache_.sources.filter((e=>e.src===t));if(n.length)return n[0].type;const r=e.$$("source");for(let e=0;e<r.length;e++){const n=r[e];if(n.type&&n.src&&n.src===t)return n.type}return wa(t)})(this,t)),this.cache_.source=Nt({},e,{src:t,type:n});const r=this.cache_.sources.filter((e=>e.src&&e.src===t)),a=[],i=this.$$("source"),s=[];for(let e=0;e<i.length;e++){const n=pn(i[e]);a.push(n),n.src&&n.src===t&&s.push(n.src)}s.length&&!r.length?this.cache_.sources=a:r.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(t=()=>{}),t(r),e.src||this.tech_.any(["sourceset","loadstart"],(e=>{if("sourceset"===e.type)return;const t=this.techGet("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)}))}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach((e=>e.callback(e.event))),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?$r(this.play()):this.pause()))}handleTechDoubleClick_(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),(t=>t.contains(e.target)))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let r=s()[this.fsApi_.fullscreenElement]===n;!r&&n.matches?r=n.matches(":"+this.fsApi_.fullscreen):!r&&n.msMatchesSelector&&(r=n.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",(()=>{this.removeClass("vjs-ios-native-fs")}))),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready((function(){if(e in ya)return function(e,t,n,r){return t[n](e.reduce(xa(n),r))}(this.middleware_,this.tech_,e,t);if(e in ba)return fa(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(e){throw wt(e),e}}),!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in ga)return function(e,t,n){return e.reduceRight(xa(n),t[n]())}(this.middleware_,this.tech_,e);if(e in ba)return fa(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw wt(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t;if("TypeError"===t.name)throw wt(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t;throw wt(t),t}}}play(){return new Promise((e=>{this.play_(e)}))}play_(e=$r){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(Yt||Zt);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=e=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&n&&this.load());const r=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===r?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(r)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach((function(e){e()}))}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach((function(t){t(e)}))}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||_r(0,0)}scrubbing(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0!==e?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=_r(0,0)),e}bufferedPercent(){return Dr(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise(((n,r)=>{function a(){t.off("fullscreenerror",s),t.off("fullscreenchange",i)}function i(){a(),n()}function s(e,t){a(),r(t)}t.one("fullscreenchange",i),t.one("fullscreenerror",s);const o=t.requestFullscreenHelper_(e);o&&(o.then(a,a),o.then(n,r))}))}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then((()=>this.isFullscreen(!0)),(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&1==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise(((t,n)=>{function r(){e.off("fullscreenerror",i),e.off("fullscreenchange",a)}function a(){r(),t()}function i(e,t){r(),n(t)}e.one("fullscreenchange",a),e.one("fullscreenerror",i);const s=e.exitFullscreenHelper_();s&&(s.then(r,r),s.then(t,n))}))}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=s()[this.fsApi_.exitFullscreen]();return e&&$r(e.then((()=>this.isFullscreen(!1)))),e}this.tech_.supportsFullScreen()&&1==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=s().documentElement.style.overflow,Xn(s(),"keydown",this.boundFullWindowOnEscKey_),s().documentElement.style.overflow="hidden",un(s().body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){l().isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,Kn(s(),"keydown",this.boundFullWindowOnEscKey_),s().documentElement.style.overflow=this.docOrigOverflow,dn(s().body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&a().documentPictureInPicture){const e=s().createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(an("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),a().documentPictureInPicture.requestWindow({initialAspectRatio:this.videoWidth()/this.videoHeight(),copyStyleSheets:!0}).then((t=>(this.el_.parentNode.insertBefore(e,this.el_),t.document.body.append(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger("enterpictureinpicture"),t.addEventListener("unload",(t=>{const n=t.target.querySelector(".video-js");e.replaceWith(n),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")})),t)))}return"pictureInPictureEnabled"in s()&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return a().documentPictureInPicture&&a().documentPictureInPicture.window?(a().documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in s()?s().exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;t&&t.hotkeys&&((e=>{const t=e.tagName.toLowerCase();return!!e.isContentEditable||("input"===t?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type):-1!==["textarea"].indexOf(t))})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e)))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=(e=>l().isEventKey(e,"f")),muteKey:r=(e=>l().isEventKey(e,"m")),playPauseKey:a=(e=>l().isEventKey(e,"k")||l().isEventKey(e,"Space"))}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const t=kr.getComponent("FullscreenToggle");!1!==s()[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else r.call(this,e)?(e.preventDefault(),e.stopPropagation(),kr.getComponent("MuteToggle").prototype.handleClick.call(this,e)):a.call(this,e)&&(e.preventDefault(),e.stopPropagation(),kr.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let n=0,r=this.options_.techOrder;n<r.length;n++){const a=r[n];let i=da.getTech(a);if(i||(i=kr.getComponent(a)),i){if(i.isSupported()&&(t=i.canPlayType(e),t))return t}else wt.error(`The "${a}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(e){const t=this.options_.techOrder.map((e=>[e,da.getTech(e)])).filter((([e,t])=>t?t.isSupported():(wt.error(`The "${e}" tech is undefined. Skipped browser support check for that tech.`),!1))),n=function(e,t,n){let r;return e.some((e=>t.some((t=>{if(r=n(e,t),r)return!0})))),r};let r;const a=([e,t],n)=>{if(t.canPlaySource(n,this.options_[e.toLowerCase()]))return{source:n,tech:e}};var i;return r=this.options_.sourceOrder?n(e,t,(i=a,(e,t)=>i(t,e))):n(t,e,a),r||!1}handleSrc_(e,t){if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=ka(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),ma(this,n[0],((e,r)=>{if(this.middleware_=r,t||(this.cache_.sources=n),this.updateSourceCaches_(e),this.src_(e))return n.length>1?this.handleSrc_(n.slice(1)):(this.changingSrc_=!1,this.setTimeout((function(){this.error({code:4,message:this.options_.notSupportedMessage})}),0),void this.triggerReady());var a,i;a=r,i=this.tech_,a.forEach((e=>e.setTech&&e.setTech(i)))})),n.length>1){const e=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=()=>{this.off("error",e),this.off("playing",t)}}}else this.setTimeout((function(){this.error({code:4,message:this.options_.notSupportedMessage})}),0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(vr(t.tech,this.techName_)?(this.ready((function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1}),!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready((()=>{this.changingSrc_=!1})),!1))}load(){this.techCall_("load")}reset(){this.paused()?this.doReset_():$r(this.play().then((()=>this.doReset_())))}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),lr(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:r}=this.controlBar||{},{seekBar:a}=n||{};e&&e.updateContent(),t&&t.updateContent(),r&&r.updateContent(),a&&(a.update(),a.loadProgressBar&&a.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(ft("beforeerror").forEach((t=>{const n=t(this,e);Ct(n)&&!Array.isArray(n)||"string"==typeof n||"number"==typeof n||null===n?e=n:this.log.error("please return a value that MediaError expects in beforeerror hooks")})),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",(function(){this.off(["click","touchstart"],t)}))}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Mr(e),this.addClass("vjs-error"),wt.error(`(CODE:${this.error_.code} ${Mr.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),ft("error").forEach((e=>e(this,this.error_)))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",(function(e){e.stopPropagation(),e.preventDefault()})),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const r=tr(this,this.reportUserActivity),a=function(t){r(),this.clearInterval(e)};this.on("mousedown",(function(){r(),this.clearInterval(e),e=this.setInterval(r,250)})),this.on("mousemove",(function(e){e.screenX===t&&e.screenY===n||(t=e.screenX,n=e.screenY,r())})),this.on("mouseup",a),this.on("mouseleave",a);const i=this.getChild("controlBar");let s;!i||Zt||$t||(i.on("mouseenter",(function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0})),i.on("mouseleave",(function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout}))),this.on("keydown",r),this.on("keyup",r),this.setInterval((function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(s);const e=this.options_.inactivityTimeout;e<=0||(s=this.setTimeout((function(){this.userActivity_||this.userActive(!1)}),e))}),250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach((e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))})),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach((e=>e.show())),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then((()=>this.enableAudioOnlyUI_()))}return Promise.resolve().then((()=>this.disableAudioOnlyUI_()))}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return"boolean"!=typeof e||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then((()=>{this.enablePosterModeUI_()})):Promise.resolve().then((()=>{this.enablePosterModeUI_()})):Promise.resolve().then((()=>{this.disablePosterModeUI_()})))}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),lr(this)&&this.trigger("languagechange"))}languages(){return Nt(Yi.prototype.options_.languages,this.languages_)}toJSON(){const e=Nt(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let r=t[n];r=Nt(r),r.player=void 0,e.tracks[n]=r}return e}createModal(e,t){(t=t||{}).content=e||"";const n=new zr(this,t);return this.addChild(n),n.on("dispose",(()=>{this.removeChild(n)})),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<Xi.length;n++){const r=Xi[n];if(t<=this.breakpoints_[r]){if(e===r)return;e&&this.removeClass(Ki[e]),this.addClass(Ki[r]),this.breakpoint_=r;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Object.assign({},Zi,e),this.updateCurrentBreakpoint_()),Object.assign(this.breakpoints_)}responsive(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return Ki[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!=typeof e)return;this.reset(),this.cache_.media=Nt(e);const{artist:n,artwork:r,description:a,poster:i,src:s,textTracks:o,title:l}=this.cache_.media;!r&&i&&(this.cache_.media.artwork=[{src:i,type:wa(i)}]),s&&this.src(s),i&&this.poster(i),Array.isArray(o)&&o.forEach((e=>this.addRemoteTextTrack(e,!1))),this.titleBar&&this.titleBar.update({title:l,description:a||n||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),(e=>({kind:e.kind,label:e.label,language:e.language,src:e.src})))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:wa(t.poster)}]),t}return Nt(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=pn(e),r=n["data-setup"];if(ln(e,"vjs-fill")&&(n.fill=!0),ln(e,"vjs-fluid")&&(n.fluid=!0),null!==r){const[e,t]=d()(r||"{}");e&&wt.error(e),Object.assign(n,t)}if(Object.assign(t,n),e.hasChildNodes()){const n=e.childNodes;for(let e=0,r=n.length;e<r;e++){const r=n[e],a=r.nodeName.toLowerCase();"source"===a?t.sources.push(pn(r)):"track"===a&&t.tracks.push(pn(r))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every((e=>"number"==typeof e))&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}ua.names.forEach((function(e){const t=ua[e];Yi.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}})),Yi.prototype.crossorigin=Yi.prototype.crossOrigin,Yi.players={};const Ji=a().navigator;Yi.prototype.options_={techOrder:da.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Ji&&(Ji.languages&&Ji.languages[0]||Ji.userLanguage||Ji.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach((function(e){Yi.prototype[e]=function(){return this.techGet_(e)}})),Gi.forEach((function(e){Yi.prototype[`handleTech${Ar(e)}_`]=function(){return this.trigger(e)}})),kr.registerComponent("Player",Yi);const Qi="plugin",es="activePlugins_",ts={},ns=e=>ts.hasOwnProperty(e),rs=e=>ns(e)?ts[e]:void 0,as=(e,t)=>{e[es]=e[es]||{},e[es][t]=!0},is=(e,t,n)=>{const r=(n?"before":"")+"pluginsetup";e.trigger(r,t),e.trigger(r+":"+t.name,t)},ss=(e,t)=>(t.prototype.name=e,function(...n){is(this,{name:e,plugin:t,instance:null},!0);const r=new t(...[this,...n]);return this[e]=()=>r,is(this,r.getEventHash()),r});class os{constructor(e){if(this.constructor===os)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),gr(this),delete this.trigger,br(this,this.constructor.defaultState),as(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return Zn(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[es][e]=!1,this.player=this.state=null,t[e]=ss(e,ts[e])}static isBasic(e){const t="string"==typeof e?rs(e):e;return"function"==typeof t&&!os.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if("string"!=typeof e)throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(ns(e))wt.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(Yi.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if("function"!=typeof t)throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return ts[e]=t,e!==Qi&&(os.isBasic(t)?Yi.prototype[e]=function(e,t){const n=function(){is(this,{name:e,plugin:t,instance:null},!0);const n=t.apply(this,arguments);return as(this,e),is(this,{name:e,plugin:t,instance:n}),n};return Object.keys(t).forEach((function(e){n[e]=t[e]})),n}(e,t):Yi.prototype[e]=ss(e,t)),t}static deregisterPlugin(e){if(e===Qi)throw new Error("Cannot de-register base plugin.");ns(e)&&(delete ts[e],delete Yi.prototype[e])}static getPlugins(e=Object.keys(ts)){let t;return e.forEach((e=>{const n=rs(e);n&&(t=t||{},t[e]=n)})),t}static getPluginVersion(e){const t=rs(e);return t&&t.VERSION||""}}function ls(e,t,n,r){return function(e,t){let n=!1;return function(...r){return n||wt.warn(e),n=!0,t.apply(this,r)}}(`${t} is deprecated and will be removed in ${e}.0; please use ${n} instead.`,r)}os.getPlugin=rs,os.BASE_PLUGIN_NAME=Qi,os.registerPlugin(Qi,os),Yi.prototype.usingPlugin=function(e){return!!this[es]&&!0===this[es][e]},Yi.prototype.hasPlugin=function(e){return!!ns(e)};const us=e=>0===e.indexOf("#")?e.slice(1):e;function ds(e,t,n){let r=ds.getPlayer(e);if(r)return t&&wt.warn(`Player "${e}" is already initialised. Options will not be applied.`),n&&r.ready(n),r;const a="string"==typeof e?Cn("#"+us(e)):e;if(!tn(a))throw new TypeError("The element or ID supplied is not valid. (videojs)");a.ownerDocument.defaultView&&a.ownerDocument.body.contains(a)||wt.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(a.parentNode&&a.parentNode.hasAttribute("data-vjs-player")?a.parentNode:a).cloneNode(!0)),ft("beforesetup").forEach((e=>{const n=e(a,Nt(t));Ct(n)&&!Array.isArray(n)?t=Nt(t,n):wt.error("please return an object in beforesetup hooks")}));const i=kr.getComponent("Player");return r=new i(a,t,n),ft("setup").forEach((e=>e(r))),r}if(ds.hooks_=mt,ds.hooks=ft,ds.hook=function(e,t){ft(e,t)},ds.hookOnce=function(e,t){ft(e,[].concat(t).map((t=>{const n=(...r)=>(gt(e,n),t(...r));return n})))},ds.removeHook=gt,!0!==a().VIDEOJS_NO_DYNAMIC_STYLE&&en()){let e=Cn(".vjs-styles-defaults");if(!e){e=Fn("vjs-styles-defaults");const t=Cn("head");t&&t.insertBefore(e,t.firstChild),Ln(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}On(1,ds),ds.VERSION=pt,ds.options=Yi.prototype.options_,ds.getPlayers=()=>Yi.players,ds.getPlayer=e=>{const t=Yi.players;let n;if("string"==typeof e){const r=us(e),a=t[r];if(a)return a;n=Cn("#"+r)}else n=e;if(tn(n)){const{player:e,playerId:r}=n;if(e||t[r])return e||t[r]}},ds.getAllPlayers=()=>Object.keys(Yi.players).map((e=>Yi.players[e])).filter(Boolean),ds.players=Yi.players,ds.getComponent=kr.getComponent,ds.registerComponent=(e,t)=>{da.isTech(t)&&wt.warn(`The ${e} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),kr.registerComponent.call(kr,e,t)},ds.getTech=da.getTech,ds.registerTech=da.registerTech,ds.use=function(e,t){ca[e]=ca[e]||[],ca[e].push(t)},Object.defineProperty(ds,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(ds.middleware,"TERMINATOR",{value:pa,writeable:!1,enumerable:!0}),ds.browser=Jt,ds.obj=Pt,ds.mergeOptions=ls(9,"videojs.mergeOptions","videojs.obj.merge",Nt),ds.defineLazyProperty=ls(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",Rt),ds.bind=ls(9,"videojs.bind","native Function.prototype.bind",tr),ds.registerPlugin=os.registerPlugin,ds.deregisterPlugin=os.deregisterPlugin,ds.plugin=(e,t)=>(wt.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),os.registerPlugin(e,t)),ds.getPlugins=os.getPlugins,ds.getPlugin=os.getPlugin,ds.getPluginVersion=os.getPluginVersion,ds.addLanguage=function(e,t){return e=(""+e).toLowerCase(),ds.options.languages=Nt(ds.options.languages,{[e]:t}),ds.options.languages[e]},ds.log=wt,ds.createLogger=kt,ds.time=Pr,ds.createTimeRange=ls(9,"videojs.createTimeRange","videojs.time.createTimeRanges",_r),ds.createTimeRanges=ls(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",_r),ds.formatTime=ls(9,"videojs.formatTime","videojs.time.formatTime",Rr),ds.setFormatTime=ls(9,"videojs.setFormatTime","videojs.time.setFormatTime",Er),ds.resetFormatTime=ls(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",Nr),ds.parseUrl=ls(9,"videojs.parseUrl","videojs.url.parseUrl",Zr),ds.isCrossOrigin=ls(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Qr),ds.EventTarget=sr,ds.any=Jn,ds.on=Xn,ds.one=Yn,ds.off=Kn,ds.trigger=Zn,ds.xhr=h(),ds.TextTrack=ra,ds.AudioTrack=aa,ds.VideoTrack=ia,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach((e=>{ds[e]=function(){return wt.warn(`videojs.${e}() is deprecated; use videojs.dom.${e}() instead`),Rn[e].apply(null,arguments)}})),ds.computedStyle=ls(9,"videojs.computedStyle","videojs.dom.computedStyle",Nn),ds.dom=Rn,ds.fn=ar,ds.num=Ua,ds.str=wr,ds.url=ea;class cs{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class hs extends ds.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new cs(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const n=this[t];if(n.id===e)return n}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}hs.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const e in hs.prototype.allowedEvents_)hs.prototype["on"+e]=null;var ps="3.0.0";const ms=function(e){return function(e,t){const n=e.qualityLevels,r=new hs,a=function(){r.dispose(),e.qualityLevels=n,e.off("dispose",a)};return e.on("dispose",a),e.qualityLevels=()=>r,e.qualityLevels.VERSION=ps,r}(this,ds.mergeOptions({},e))};(ds.registerPlugin||ds.plugin)("qualityLevels",ms),ms.VERSION=ps;const fs=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=a().location&&a().location.href||"");var n="function"==typeof a().URL,r=/^\/\//.test(e),i=!a().location&&!/\/\//i.test(e);if(n?e=new(a().URL)(e,a().location||"http://example.com"):/\/\//i.test(e)||(e=g().buildAbsoluteURL(a().location&&a().location.href||"",e)),n){var s=new URL(t,e);return i?s.href.slice(18):r?s.href.slice(s.protocol.length):s.href}return g().buildAbsoluteURL(e,t)},gs=(e,t)=>t&&t.responseURL&&e!==t.responseURL?t.responseURL:e,ys=e=>ds.log.debug?ds.log.debug.bind(ds,"VHS:",`${e} >`):function(){};function bs(...e){const t=ds.obj||ds;return(t.merge||t.mergeOptions).apply(t,e)}function xs(...e){const t=ds.time||ds;return(t.createTimeRanges||t.createTimeRanges).apply(t,e)}const As=1/30,vs=.1,ws=function(e,t){const n=[];let r;if(e&&e.length)for(r=0;r<e.length;r++)t(e.start(r),e.end(r))&&n.push([e.start(r),e.end(r)]);return xs(n)},ks=function(e,t){return ws(e,(function(e,n){return e-vs<=t&&n+vs>=t}))},Ss=function(e,t){return ws(e,(function(e){return e-As>=t}))},Ts=e=>{const t=[];if(!e||!e.length)return"";for(let n=0;n<e.length;n++)t.push(e.start(n)+" => "+e.end(n));return t.join(", ")},_s=e=>{const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},Is=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},Cs=function(e,t){let n=0;if(!e||!e.length)return n;for(let r=0;r<e.length;r++){const a=e.start(r),i=e.end(r);t>i||(n+=t>a&&t<=i?i-t:i-a)}return n},Es=(e,t)=>{if(!t.preload)return t.duration;let n=0;return(t.parts||[]).forEach((function(e){n+=e.duration})),(t.preloadHints||[]).forEach((function(t){"PART"===t.type&&(n+=e.partTargetDuration)})),n},Ns=e=>(e.segments||[]).reduce(((e,t,n)=>(t.parts?t.parts.forEach((function(r,a){e.push({duration:r.duration,segmentIndex:n,partIndex:a,part:r,segment:t})})):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e)),[]),Rs=e=>{const t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},Ps=({preloadSegment:e})=>{if(!e)return;const{parts:t,preloadHints:n}=e;let r=(n||[]).reduce(((e,t)=>e+("PART"===t.type?1:0)),0);return r+=t&&t.length?t.length:0,r},Ds=(e,t)=>{if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;const n=Rs(t).length>0;return n&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:n&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},Ms=function(e,t,n){if(void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;const r=function(e,t){let n=0,r=t-e.mediaSequence,a=e.segments[r];if(a){if(void 0!==a.start)return{result:a.start,precise:!0};if(void 0!==a.end)return{result:a.end-a.duration,precise:!0}}for(;r--;){if(a=e.segments[r],void 0!==a.end)return{result:n+a.end,precise:!0};if(n+=Es(e,a),void 0!==a.start)return{result:n+a.start,precise:!0}}return{result:n,precise:!1}}(e,t);if(r.precise)return r.result;const a=function(e,t){let n,r=0,a=t-e.mediaSequence;for(;a<e.segments.length;a++){if(n=e.segments[a],void 0!==n.start)return{result:n.start-r,precise:!0};if(r+=Es(e,n),void 0!==n.end)return{result:n.end-r,precise:!0}}return{result:-1,precise:!1}}(e,t);return a.precise?a.result:r.result+n},Os=function(e,t,n){if(!e)return 0;if("number"!=typeof n&&(n=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return a()[1/0]}return Ms(e,t,n)},$s=function({defaultDuration:e,durationList:t,startIndex:n,endIndex:r}){let a=0;if(n>r&&([n,r]=[r,n]),n<0){for(let t=n;t<Math.min(0,r);t++)a+=e;n=0}for(let e=n;e<r;e++)a+=t[e].duration;return a},Fs=function(e,t,n,r){if(!e||!e.segments)return null;if(e.endList)return Os(e);if(null===t)return null;t=t||0;let a=Ms(e,e.mediaSequence+e.segments.length,t);return n&&(a-=r="number"==typeof r?r:Ds(null,e)),Math.max(0,a)},Ls=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},zs=function(e){return e.excludeUntil&&e.excludeUntil===1/0},Bs=function(e){const t=Ls(e);return!e.disabled&&!t},Us=function(e,t){return t.attributes&&t.attributes[e]},Ws=(e,t)=>{if(1===e.playlists.length)return!0;const n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter((e=>!!Bs(e)&&(e.attributes.BANDWIDTH||0)<n)).length},Vs=(e,t)=>!(!e&&!t||!e&&t||e&&!t||e!==t&&(!e.id||!t.id||e.id!==t.id)&&(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)&&(!e.uri||!t.uri||e.uri!==t.uri)),js=function(e,t){const n=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{};let r=!1;for(const e in n){for(const a in n[e])if(r=t(n[e][a]),r)break;if(r)break}return!!r},Hs=e=>{if(!e||!e.playlists||!e.playlists.length)return js(e,(e=>e.playlists&&e.playlists.length||e.uri));for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t],r=n.attributes&&n.attributes.CODECS;if((!r||!r.split(",").every((e=>O(e))))&&!js(e,(e=>Vs(n,e))))return!1}return!0};var Gs={liveEdgeDelay:Ds,duration:Os,seekable:function(e,t,n){const r=t||0,a=Fs(e,t,!0,n);return null===a?xs():xs(r,a)},getMediaInfoForTime:function({playlist:e,currentTime:t,startingSegmentIndex:n,startingPartIndex:r,startTime:a,exactManifestTimings:i}){let s=t-a;const o=Ns(e);let l=0;for(let e=0;e<o.length;e++){const t=o[e];if(n===t.segmentIndex&&("number"!=typeof r||"number"!=typeof t.partIndex||r===t.partIndex)){l=e;break}}if(s<0){if(l>0)for(let t=l-1;t>=0;t--){const n=o[t];if(s+=n.duration,i){if(s<0)continue}else if(s+As<=0)continue;return{partIndex:n.partIndex,segmentIndex:n.segmentIndex,startTime:a-$s({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:t})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t}}if(l<0){for(let n=l;n<0;n++)if(s-=e.targetDuration,s<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t};l=0}for(let t=l;t<o.length;t++){const n=o[t];if(s-=n.duration,i){if(s>0)continue}else if(s-As>=0)continue;return{partIndex:n.partIndex,segmentIndex:n.segmentIndex,startTime:a+$s({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:t})}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:t}},isEnabled:Bs,isDisabled:function(e){return e.disabled},isExcluded:Ls,isIncompatible:zs,playlistEnd:Fs,isAes:function(e){for(let t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},hasAttribute:Us,estimateSegmentRequestTime:function(e,t,n,r=0){return Us("BANDWIDTH",n)?(e*n.attributes.BANDWIDTH-8*r)/t:NaN},isLowestEnabledRendition:Ws,isAudioOnly:Hs,playlistMatch:Vs,segmentDurationWithParts:Es};const{log:qs}=ds,Xs=(e,t)=>`${e}-${t}`,Ks=(e,t,n)=>`placeholder-uri-${e}-${t}-${n}`,Zs=(e,t)=>{e.mediaGroups&&["AUDIO","SUBTITLES"].forEach((n=>{if(e.mediaGroups[n])for(const r in e.mediaGroups[n])for(const a in e.mediaGroups[n][r]){const i=e.mediaGroups[n][r][a];t(i,n,r,a)}}))},Ys=({playlist:e,uri:t,id:n})=>{e.id=n,e.playlistErrors_=0,t&&(e.uri=t),e.attributes=e.attributes||{}},Js=(e,t,n=Ks)=>{e.uri=t;for(let t=0;t<e.playlists.length;t++)if(!e.playlists[t].uri){const n=`placeholder-uri-${t}`;e.playlists[t].uri=n}const r=Hs(e);Zs(e,((t,a,i,s)=>{if(!t.playlists||!t.playlists.length){if(r&&"AUDIO"===a&&!t.uri)for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t];if(n.attributes&&n.attributes.AUDIO&&n.attributes.AUDIO===i)return}t.playlists=[y({},t)]}t.playlists.forEach((function(t,r){const o=n(a,i,s,t),l=Xs(r,o);t.uri?t.resolvedUri=t.resolvedUri||fs(e.uri,t.uri):(t.uri=0===r?o:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t}))})),(e=>{let t=e.playlists.length;for(;t--;){const n=e.playlists[t];Ys({playlist:n,id:Xs(t,n.uri)}),n.resolvedUri=fs(e.uri,n.uri),e.playlists[n.id]=n,e.playlists[n.uri]=n,n.attributes.BANDWIDTH||qs.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}})(e),(e=>{Zs(e,(t=>{t.uri&&(t.resolvedUri=fs(e.uri,t.uri))}))})(e)},{EventTarget:Qs}=ds,eo=(e,t)=>{if(!e)return t;const n=bs(e,t);if(e.preloadHints&&!t.preloadHints&&delete n.preloadHints,e.parts&&!t.parts)delete n.parts;else if(e.parts&&t.parts)for(let r=0;r<t.parts.length;r++)e.parts&&e.parts[r]&&(n.parts[r]=bs(e.parts[r],t.parts[r]));return!e.skipped&&t.skipped&&(n.skipped=!1),e.preload&&!t.preload&&(n.preload=!1),n},to=(e,t)=>{!e.resolvedUri&&e.uri&&(e.resolvedUri=fs(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=fs(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=fs(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=fs(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach((e=>{e.resolvedUri||(e.resolvedUri=fs(t,e.uri))})),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach((e=>{e.resolvedUri||(e.resolvedUri=fs(t,e.uri))}))},no=function(e){const t=e.segments||[],n=e.preloadSegment;if(n&&n.parts&&n.parts.length){if(n.preloadHints)for(let e=0;e<n.preloadHints.length;e++)if("MAP"===n.preloadHints[e].type)return t;n.duration=e.targetDuration,n.preload=!0,t.push(n)}return t},ro=(e,t)=>e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment,ao=(e,t,n=ro)=>{const r=bs(e,{}),a=r.playlists[t.id];if(!a)return null;if(n(a,t))return null;t.segments=no(t);const i=bs(a,t);if(i.preloadSegment&&!t.preloadSegment&&delete i.preloadSegment,a.segments){if(t.skip){t.segments=t.segments||[];for(let e=0;e<t.skip.skippedSegments;e++)t.segments.unshift({skipped:!0})}i.segments=((e,t,n)=>{const r=e.slice(),a=t.slice();n=n||0;const i=[];let s;for(let e=0;e<a.length;e++){const t=r[e+n],o=a[e];t?(s=t.map||s,i.push(eo(t,o))):(s&&!o.map&&(o.map=s),i.push(o))}return i})(a.segments,t.segments,t.mediaSequence-a.mediaSequence)}i.segments.forEach((e=>{to(e,i.resolvedUri)}));for(let e=0;e<r.playlists.length;e++)r.playlists[e].id===t.id&&(r.playlists[e]=i);return r.playlists[t.id]=i,r.playlists[t.uri]=i,Zs(e,((e,n,r,a)=>{if(e.playlists)for(let n=0;n<e.playlists.length;n++)t.id===e.playlists[n].id&&(e.playlists[n]=i)})),r},io=(e,t)=>{const n=e.segments||[],r=n[n.length-1],a=r&&r.parts&&r.parts[r.parts.length-1],i=a&&a.duration||r&&r.duration;return t&&i?1e3*i:500*(e.partTargetDuration||e.targetDuration||10)};class so extends Qs{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=ys("PlaylistLoader");const{withCredentials:r=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=r;const a=t.options_;this.customTagParsers=a&&a.customTagParsers||[],this.customTagMappers=a&&a.customTagMappers||[],this.llhls=a&&a.llhls,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_)}handleMediaupdatetimeout_(){if("HAVE_METADATA"!==this.state)return;const e=this.media();let t=fs(this.main.uri,e.uri);this.llhls&&(t=((e,t)=>{if(t.endList||!t.serverControl)return e;const n={};if(t.serverControl.canBlockReload){const{preloadSegment:e}=t;let r=t.mediaSequence+t.segments.length;if(e){const a=e.parts||[],i=Ps(t)-1;i>-1&&i!==a.length-1&&(n._HLS_part=i),(i>-1||a.length)&&r--}n._HLS_msn=r}if(t.serverControl&&t.serverControl.canSkipUntil&&(n._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(n).length){const t=new(a().URL)(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach((function(e){n.hasOwnProperty(e)&&t.searchParams.set(e,n[e])})),e=t.toString()}return e})(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials},((e,t)=>{if(this.request)return e?this.playlistRequestError(this.request,this.media(),"HAVE_METADATA"):void this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}))}playlistRequestError(e,t,n){const{uri:r,id:a}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[a],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}parseManifest_({url:e,manifestString:t}){return(({onwarn:e,oninfo:t,manifestString:n,customTagParsers:r=[],customTagMappers:a=[],llhls:i})=>{const s=new I;e&&s.on("warn",e),t&&s.on("info",t),r.forEach((e=>s.addParser(e))),a.forEach((e=>s.addTagMapper(e))),s.push(n),s.end();const o=s.manifest;if(i||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach((function(e){o.hasOwnProperty(e)&&delete o[e]})),o.segments&&o.segments.forEach((function(e){["parts","preloadHints"].forEach((function(t){e.hasOwnProperty(t)&&delete e[t]}))}))),!o.targetDuration){let t=10;o.segments&&o.segments.length&&(t=o.segments.reduce(((e,t)=>Math.max(e,t.duration)),0)),e&&e(`manifest has no targetDuration defaulting to ${t}`),o.targetDuration=t}const l=Rs(o);if(l.length&&!o.partTargetDuration){const t=l.reduce(((e,t)=>Math.max(e,t.duration)),0);e&&(e(`manifest has no partTargetDuration defaulting to ${t}`),qs.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=t}return o})({onwarn:({message:t})=>this.logger_(`m3u8-parser warn for ${e}: ${t}`),oninfo:({message:t})=>this.logger_(`m3u8-parser info for ${e}: ${t}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:r}){this.request=null,this.state="HAVE_METADATA";const a=t||this.parseManifest_({url:n,manifestString:e});a.lastRequest=Date.now(),Ys({playlist:a,uri:n,id:r});const i=ao(this.main,a);this.targetDuration=a.partTargetDuration||a.targetDuration,this.pendingMedia_=null,i?(this.main=i,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(io(this.media(),!!i)),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),a().clearTimeout(this.mediaUpdateTimeout),a().clearTimeout(this.finalRenditionTimeout),this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(a().clearTimeout(this.finalRenditionTimeout),t){const t=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;return void(this.finalRenditionTimeout=a().setTimeout(this.media.bind(this,e,!1),t))}const n=this.state,r=!this.media_||e.id!==this.media_.id,i=this.main.playlists[e.id];if(i&&i.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(r&&(this.trigger("mediachanging"),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(io(e,!0)),r){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},((t,r)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=gs(e.resolvedUri,r),t)return this.playlistRequestError(this.request,e,n);this.haveMetadata({playlistString:r.responseText,url:e.uri,id:e.id}),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")}}))}}pause(){this.mediaUpdateTimeout&&(a().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(a().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const e=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=a().setTimeout((()=>{this.mediaUpdateTimeout=null,this.load()}),e)}else this.started?t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(a().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=a().setTimeout((()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)}),e))}start(){if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=a().location.href),this.src.resolvedUri=this.src.uri,void setTimeout((()=>{this.setupInitialPlaylist(this.src)}),0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},((e,t)=>{if(!this.request)return;if(this.request=null,e)return this.error={status:t.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:t.responseText,code:2},"HAVE_NOTHING"===this.state&&(this.started=!1),this.trigger("error");this.src=gs(this.src,t);const n=this.parseManifest_({manifestString:t.responseText,url:this.src});this.setupInitialPlaylist(n)}))}srcUri(){return"string"==typeof this.src?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists)return this.main=e,Js(this.main,this.srcUri()),e.playlists.forEach((e=>{e.segments=no(e),e.segments.forEach((t=>{to(t,e.resolvedUri)}))})),this.trigger("loadedplaylist"),void(this.request||this.media(this.main.playlists[0]));const t=this.srcUri()||a().location.href;this.main=((e,t)=>{const n=Xs(0,t),r={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:a().location.href,resolvedUri:a().location.href,playlists:[{uri:t,id:n,resolvedUri:t,attributes:{}}]};return r.playlists[n]=r.playlists[0],r.playlists[t]=r.playlists[0],r})(0,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}}const{xhr:oo}=ds,lo=function(e,t,n,r){const a="arraybuffer"===e.responseType?e.response:e.responseText;!t&&a&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=a.byteLength||a.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),n.headers&&(e.responseHeaders=n.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===n.statusCode||206===n.statusCode||0===n.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(a||e.responseText)))),r(t,e)},uo=function(){const e=function e(t,n){t=bs({timeout:45e3},t);const r=e.beforeRequest||ds.Vhs.xhr.beforeRequest;if(r&&"function"==typeof r){const e=r(t);e&&(t=e)}const a=(!0===ds.Vhs.xhr.original?oo:ds.Vhs.xhr)(t,(function(e,t){return lo(a,e,t,n)})),i=a.abort;return a.abort=function(){return a.aborted=!0,i.apply(a,arguments)},a.uri=t.uri,a.requestTime=Date.now(),a};return e.original=!0,e},co=function(e){const t={};return e.byterange&&(t.Range=function(e){let t;const n=e.offset;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?a().BigInt(e.offset)+a().BigInt(e.length)-a().BigInt(1):e.offset+e.length-1,"bytes="+n+"-"+t}(e.byterange)),t},ho=function(e,t){return e.start(t)+"-"+e.end(t)},po=function(e,t){const n=e.toString(16);return"00".substring(0,2-n.length)+n+(t%2?" ":"")},mo=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},fo=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n];V(r)?t[n]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[n]=r})),t},go=function(e){const t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},yo=function(e){return e.resolvedUri},bo=e=>{const t=Array.prototype.slice.call(e),n=16;let r,a,i="";for(let e=0;e<t.length/n;e++)r=t.slice(e*n,e*n+n).map(po).join(""),a=t.slice(e*n,e*n+n).map(mo).join(""),i+=r+" "+a+"\n";return i};var xo=Object.freeze({__proto__:null,createTransferableMessage:fo,initSegmentId:go,segmentKeyId:yo,hexDump:bo,tagDump:({bytes:e})=>bo(e),textRanges:e=>{let t,n="";for(t=0;t<e.length;t++)n+=ho(e,t)+" ";return n}});const Ao=({programTime:e,playlist:t,retryCount:n=2,seekTo:r,pauseAfterSeek:a=!0,tech:i,callback:s})=>{if(!s)throw new Error("seekToProgramTime: callback must be provided");if(void 0===e||!t||!r)return s({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!t.endList&&!i.hasStarted_)return s({message:"player must be playing a live stream to start buffering"});if(!(e=>{if(!e.segments||0===e.segments.length)return!1;for(let t=0;t<e.segments.length;t++)if(!e.segments[t].dateTimeObject)return!1;return!0})(t))return s({message:"programDateTime tags must be provided in the manifest "+t.resolvedUri});const o=((e,t)=>{let n;try{n=new Date(e)}catch(e){return null}if(!t||!t.segments||0===t.segments.length)return null;let r=t.segments[0];if(n<r.dateTimeObject)return null;for(let e=0;e<t.segments.length-1&&(r=t.segments[e],!(n<t.segments[e+1].dateTimeObject));e++);const a=t.segments[t.segments.length-1],i=a.dateTimeObject,s=a.videoTimingInfo?(o=a.videoTimingInfo).transmuxedPresentationEnd-o.transmuxedPresentationStart-o.transmuxerPrependedSeconds:a.duration+.25*a.duration;var o;return n>new Date(i.getTime()+1e3*s)?null:(n>i&&(r=a),{segment:r,estimatedStart:r.videoTimingInfo?r.videoTimingInfo.transmuxedPresentationStart:Gs.duration(t,t.mediaSequence+t.segments.indexOf(r)),type:r.videoTimingInfo?"accurate":"estimate"})})(e,t);if(!o)return s({message:`${e} was not found in the stream`});const l=o.segment,u=((e,t)=>{let n,r;try{n=new Date(e),r=new Date(t)}catch(e){}const a=n.getTime();return(r.getTime()-a)/1e3})(l.dateTimeObject,e);if("estimate"===o.type)return 0===n?s({message:`${e} is not buffered yet. Try again`}):(r(o.estimatedStart+u),void i.one("seeked",(()=>{Ao({programTime:e,playlist:t,retryCount:n-1,seekTo:r,pauseAfterSeek:a,tech:i,callback:s})})));const d=l.start+u;i.one("seeked",(()=>s(null,i.currentTime()))),a&&i.pause(),r(d)},vo=(e,t)=>{if(4===e.readyState)return t()},{EventTarget:wo}=ds,ko=function(e,t){if(!ro(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(let n=0;n<e.segments.length;n++){const r=e.segments[n],a=t.segments[n];if(r.uri!==a.uri)return!1;if(!r.byterange&&!a.byterange)continue;const i=r.byterange,s=a.byterange;if(i&&!s||!i&&s)return!1;if(i.offset!==s.offset||i.length!==s.length)return!1}return!0},So=(e,t,n,r)=>`placeholder-uri-${e}-${t}-${r.attributes.NAME||n}`,To=(e,t)=>(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length,_o=(e,t)=>{const n={};for(const r in e){const a=e[r].sidx;if(a){const e=pe(a);if(!t[e])break;const r=t[e].sidxInfo;To(r,a)&&(n[e]=t[e])}}return n};class Io extends wo{constructor(e,t,n={},r){super(),this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:a=!1}=n;if(this.vhs_=t,this.withCredentials=a,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",(()=>{this.refreshXml_()})),this.on("mediaupdatetimeout",(()=>{this.refreshMedia_(this.media().id)})),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=ys("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}requestErrored_(e,t,n){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2}:e,n&&(this.state=n),this.trigger("error"),!0):void 0)}addSidxSegments_(e,t,n){const r=e.sidx&&pe(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r])return void(this.mediaRequest_=a().setTimeout((()=>n(!1)),0));const i=gs(e.sidx.resolvedUri),s=(a,i)=>{if(this.requestErrored_(a,i,t))return;const s=this.mainPlaylistLoader_.sidxMapping_;let o;try{o=je()(j(i.response).subarray(8))}catch(e){return void this.requestErrored_(e,i,t)}return s[r]={sidxInfo:e.sidx,sidx:o},le(e,o,e.sidx.resolvedUri),n(!0)};this.request=((e,t,n)=>{let r,a=[],i=!1;const s=function(e,t,r,a){return t.abort(),i=!0,n(e,t,r,a)},o=function(e,t){if(i)return;if(e)return s(e,t,"",a);const n=t.responseText.substring(a&&a.byteLength||0,t.responseText.length);if(a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter((function(e){return e&&(e.byteLength||e.length)&&"string"!=typeof e})),t.length<=1)return j(t[0]);var r=t.reduce((function(e,t,n){return e+(t.byteLength||t.length)}),0),a=new Uint8Array(r),i=0;return t.forEach((function(e){e=j(e),a.set(e,i),i+=e.byteLength})),a}(a,X(n,!0)),r=r||Ge(a),a.length<10||r&&a.length<r+2)return vo(t,(()=>s(e,t,"",a)));const o=ct(a);return"ts"===o&&a.length<188||!o&&a.length<376?vo(t,(()=>s(e,t,"",a))):s(null,t,o,a)},l={uri:e,beforeSend(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",(function({total:t,loaded:n}){return lo(e,null,{statusCode:e.status},o)}))}},u=t(l,(function(e,t){return lo(u,e,t,o)}));return u})(i,this.vhs_.xhr,((t,n,r,a)=>{if(t)return s(t,n);if(!r||"mp4"!==r)return s({status:n.status,message:`Unsupported ${r||"unknown"} container type for sidx segment at URL: ${i}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},n);const{offset:o,length:l}=e.sidx.byterange;if(a.length>=l+o)return s(t,{response:a.subarray(o,o+l),status:n.status,uri:n.uri});this.request=this.vhs_.xhr({uri:i,responseType:"arraybuffer",headers:co({byterange:e.sidx.byterange})},s)}))}dispose(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},a().clearTimeout(this.minimumUpdatePeriodTimeout_),a().clearTimeout(this.mediaRequest_),a().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if("string"==typeof e){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,(n=>{this.haveMetadata({startingState:t,playlist:e})})))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),"HAVE_MAIN_MANIFEST"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),a().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(a().clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)}load(e){a().clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const e=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=a().setTimeout((()=>this.load()),e)}else this.started?t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()}start(){this.started=!0,this.isMain_?this.requestMain_(((e,t)=>{this.haveMain_(),this.hasPendingRequest()||this.media_||this.media(this.mainPlaylistLoader_.main.playlists[0])})):this.mediaRequest_=a().setTimeout((()=>this.haveMain_()),0)}requestMain_(e){this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},((t,n)=>{if(this.requestErrored_(t,n))return void("HAVE_NOTHING"===this.state&&(this.started=!1));const r=n.responseText!==this.mainPlaylistLoader_.mainXml_;return this.mainPlaylistLoader_.mainXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?this.mainLoaded_=Date.parse(n.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=gs(this.mainPlaylistLoader_.srcUrl,n),r?(this.handleMain_(),void this.syncClientServerClock_((()=>e(n,r)))):e(n,r)}))}syncClientServerClock_(e){const t=(n=this.mainPlaylistLoader_.mainXml_,(e=>{const t=Ne(e,"UTCTiming")[0];if(!t)return null;const n=Me(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error("UNSUPPORTED_UTC_TIMING_SCHEME")}return n})(Ue(n)));var n;return null===t?(this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()):"DIRECT"===t.method?(this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:fs(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials},((n,r)=>{if(!this.request)return;if(n)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();let a;a="HEAD"===t.method?r.responseHeaders&&r.responseHeaders.date?Date.parse(r.responseHeaders.date):this.mainLoaded_:Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=a-Date.now(),e()})))}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main;let t=(({mainXml:e,srcUrl:t,clientOffset:n,sidxMapping:r,previousManifest:a})=>{const i=((e,t={})=>{const n=((e,t={})=>{const{manifestUri:n="",NOW:r=Date.now(),clientOffset:a=0}=t,i=Ne(e,"Period");if(!i.length)throw new Error("INVALID_NUMBER_OF_PERIOD");const s=Ne(e,"Location"),o=Me(e),l=$e([n],Ne(e,"BaseURL"));o.type=o.type||"static",o.sourceDuration=o.mediaPresentationDuration||0,o.NOW=r,o.clientOffset=a,s.length&&(o.locations=s.map(Re));const u=[];return i.forEach(((e,t)=>{const n=Me(e),r=u[t-1];n.start=(({attributes:e,priorPeriodAttributes:t,mpdType:n})=>"number"==typeof e.start?e.start:t&&"number"==typeof t.start&&"number"==typeof t.duration?t.start+t.duration:t||"static"!==n?null:0)({attributes:n,priorPeriodAttributes:r?r.attributes:null,mpdType:o.type}),u.push({node:e,attributes:n})})),{locations:o.locations,representationInfo:te(u.map(Be(o,l))),eventStream:te(u.map(Le))}})(Ue(e),t),r=n.representationInfo.map(Ee);return we({dashPlaylists:r,locations:n.locations,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest,eventStream:n.eventStream})})(e,{manifestUri:t,clientOffset:n,sidxMapping:r,previousManifest:a});return Js(i,t,So),i})({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(t=((e,t,n)=>{let r=!0,a=bs(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts});for(let e=0;e<t.playlists.length;e++){const i=t.playlists[e];if(i.sidx){const e=pe(i.sidx);n&&n[e]&&n[e].sidx&&le(i,n[e].sidx,i.sidx.resolvedUri)}const s=ao(a,i,ko);s&&(a=s,r=!1)}return Zs(t,((e,t,n,i)=>{if(e.playlists&&e.playlists.length){const s=e.playlists[0].id,o=ao(a,e.playlists[0],ko);o&&(a=o,i in a.mediaGroups[t][n]||(a.mediaGroups[t][n][i]=e),a.mediaGroups[t][n][i].playlists[0]=a.playlists[s],r=!1)}})),((e,t)=>{Zs(e,((n,r,a,i)=>{i in t.mediaGroups[r][a]||delete e.mediaGroups[r][a][i]}))})(a,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(r=!1),r?null:a})(e,t,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=t||e;const n=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];return n&&n!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=n),(!e||t&&t.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),Boolean(t)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(a().clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!=typeof t||t<=0?t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`):this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=a().setTimeout((()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)}),e)}refreshXml_(){this.requestMain_(((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=((e,t)=>{let n=_o(e.playlists,t);return Zs(e,((e,r,a,i)=>{if(e.playlists&&e.playlists.length){const r=e.playlists;n=bs(n,_o(r,t))}})),n})(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,(e=>{this.refreshMedia_(this.media().id)})))}))}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const e=()=>{this.media().endList||(this.mediaUpdateTimeout=a().setTimeout((()=>{this.trigger("mediaupdatetimeout"),e()}),io(this.media(),Boolean(n))))};e()}this.trigger("loadedplaylist")}}var Co={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const Eo=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},No=function(e){return function(){const t=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(t){const n=new BlobBuilder;return n.append(e),URL.createObjectURL(n.getBlob())}}(e),n=Eo(new Worker(t));n.objURL=t;const r=n.terminate;return n.on=n.addEventListener,n.off=n.removeEventListener,n.terminate=function(){return URL.revokeObjectURL(t),r.call(this)},n}},Ro=function(e){return`var browserWorkerPolyFill = ${Eo.toString()};\nbrowserWorkerPolyFill(self);\n`+e},Po=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},Do=Ro(Po((function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},t=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var r;return!!e[t]&&(r=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(r,1),r>-1)},this.trigger=function(t){var n,r,a,i;if(n=e[t])if(2===arguments.length)for(a=n.length,r=0;r<a;++r)n[r].call(this,arguments[1]);else{for(i=[],r=arguments.length,r=1;r<arguments.length;++r)i.push(arguments[r]);for(a=n.length,r=0;r<a;++r)n[r].apply(this,i)}},this.dispose=function(){e={}}}};t.prototype.pipe=function(e){return this.on("data",(function(t){e.push(t)})),this.on("done",(function(t){e.flush(t)})),this.on("partialdone",(function(t){e.partialFlush(t)})),this.on("endedtimeline",(function(t){e.endTimeline(t)})),this.on("reset",(function(t){e.reset(t)})),e},t.prototype.push=function(e){this.trigger("data",e)},t.prototype.flush=function(e){this.trigger("done",e)},t.prototype.partialFlush=function(e){this.trigger("partialdone",e)},t.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},t.prototype.reset=function(e){this.trigger("reset",e)};var r,a,i,s,o,l,u,d,c,h,p,m,f,g,y,b,x,A,v,w,k,S,T,_,I,C,E,N,R,P,D,M,O,$,F,L,z,B,U,W,V=t,j=Math.pow(2,32),H={getUint64:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:n.getUint32(0)*j+n.getUint32(4)},MAX_UINT32:j},G=H.MAX_UINT32;!function(){var e;if(S={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in S)S.hasOwnProperty(e)&&(S[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);T=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),I=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),_=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),E=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),N={video:C,audio:E},D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),P=new Uint8Array([0,0,0,0,0,0,0,0]),M=new Uint8Array([0,0,0,0,0,0,0,0]),O=M,$=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F=M,R=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),r=function(e){var t,n,r=[],a=0;for(t=1;t<arguments.length;t++)r.push(arguments[t]);for(t=r.length;t--;)a+=r[t].byteLength;for(n=new Uint8Array(a+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,a=8;t<r.length;t++)n.set(r[t],a),a+=r[t].byteLength;return n},a=function(){return r(S.dinf,r(S.dref,D))},i=function(e){return r(S.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},y=function(e){return r(S.hdlr,N[e])},g=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),r(S.mdhd,t)},f=function(e){return r(S.mdia,g(e),y(e.type),l(e))},o=function(e){return r(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},l=function(e){return r(S.minf,"video"===e.type?r(S.vmhd,R):r(S.smhd,P),a(),x(e))},u=function(e,t){for(var n=[],a=t.length;a--;)n[a]=v(t[a]);return r.apply(null,[S.moof,o(e)].concat(n))},d=function(e){for(var t=e.length,n=[];t--;)n[t]=p(e[t]);return r.apply(null,[S.moov,h(4294967295)].concat(n).concat(c(e)))},c=function(e){for(var t=e.length,n=[];t--;)n[t]=w(e[t]);return r.apply(null,[S.mvex].concat(n))},h=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r(S.mvhd,t)},b=function(e){var t,n,a=e.samples||[],i=new Uint8Array(4+a.length);for(n=0;n<a.length;n++)t=a[n].flags,i[n+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return r(S.sdtp,i)},x=function(e){return r(S.stbl,A(e),r(S.stts,F),r(S.stsc,O),r(S.stsz,$),r(S.stco,M))},A=function(e){return r(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?L(e):z(e))},L=function(e){var t,n,a=e.sps||[],i=e.pps||[],s=[],o=[];for(t=0;t<a.length;t++)s.push((65280&a[t].byteLength)>>>8),s.push(255&a[t].byteLength),s=s.concat(Array.prototype.slice.call(a[t]));for(t=0;t<i.length;t++)o.push((65280&i[t].byteLength)>>>8),o.push(255&i[t].byteLength),o=o.concat(Array.prototype.slice.call(i[t]));if(n=[S.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r(S.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([a.length],s,[i.length],o))),r(S.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];n.push(r(S.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return r.apply(null,n)},z=function(e){return r(S.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),i(e))},m=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return r(S.tkhd,t)},v=function(e){var t,n,a,i,s,o;return t=r(S.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),s=Math.floor(e.baseMediaDecodeTime/G),o=Math.floor(e.baseMediaDecodeTime%G),n=r(S.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),"audio"===e.type?(a=k(e,92),r(S.traf,t,n,a)):(i=b(e),a=k(e,i.length+92),r(S.traf,t,n,a,i))},p=function(e){return e.duration=e.duration||4294967295,r(S.trak,m(e),f(e))},w=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),r(S.trex,t)},W=function(e,t){var n=0,r=0,a=0,i=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(r=2),void 0!==e[0].flags&&(a=4),void 0!==e[0].compositionTimeOffset&&(i=8)),[0,0,n|r|a|i,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},U=function(e,t){var n,a,i,s,o,l;for(t+=20+16*(s=e.samples||[]).length,i=W(s,t),(a=new Uint8Array(i.length+16*s.length)).set(i),n=i.length,l=0;l<s.length;l++)o=s[l],a[n++]=(4278190080&o.duration)>>>24,a[n++]=(16711680&o.duration)>>>16,a[n++]=(65280&o.duration)>>>8,a[n++]=255&o.duration,a[n++]=(4278190080&o.size)>>>24,a[n++]=(16711680&o.size)>>>16,a[n++]=(65280&o.size)>>>8,a[n++]=255&o.size,a[n++]=o.flags.isLeading<<2|o.flags.dependsOn,a[n++]=o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,a[n++]=61440&o.flags.degradationPriority,a[n++]=15&o.flags.degradationPriority,a[n++]=(4278190080&o.compositionTimeOffset)>>>24,a[n++]=(16711680&o.compositionTimeOffset)>>>16,a[n++]=(65280&o.compositionTimeOffset)>>>8,a[n++]=255&o.compositionTimeOffset;return r(S.trun,a)},B=function(e,t){var n,a,i,s,o,l;for(t+=20+8*(s=e.samples||[]).length,i=W(s,t),(n=new Uint8Array(i.length+8*s.length)).set(i),a=i.length,l=0;l<s.length;l++)o=s[l],n[a++]=(4278190080&o.duration)>>>24,n[a++]=(16711680&o.duration)>>>16,n[a++]=(65280&o.duration)>>>8,n[a++]=255&o.duration,n[a++]=(4278190080&o.size)>>>24,n[a++]=(16711680&o.size)>>>16,n[a++]=(65280&o.size)>>>8,n[a++]=255&o.size;return r(S.trun,n)},k=function(e,t){return"audio"===e.type?B(e,t):U(e,t)};var q,X,K,Z,Y,J,Q,ee,te={ftyp:s=function(){return r(S.ftyp,T,_,T,I)},mdat:function(e){return r(S.mdat,e)},moof:u,moov:d,initSegment:function(e){var t,n=s(),r=d(e);return(t=new Uint8Array(n.byteLength+r.byteLength)).set(n),t.set(r,n.byteLength),t}},ne=function(e,t){var n={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n},re={groupNalsIntoFrames:function(e){var t,n,r=[],a=[];for(a.byteLength=0,a.nalCount=0,a.duration=0,r.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(n=e[t]).nalUnitType?(r.length&&(r.duration=n.dts-r.dts,a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r)),(r=[n]).byteLength=n.data.byteLength,r.pts=n.pts,r.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(r.keyFrame=!0),r.duration=n.dts-r.dts,r.byteLength+=n.data.byteLength,r.push(n));return a.length&&(!r.duration||r.duration<=0)&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r),a},groupFramesIntoGops:function(e){var t,n,r=[],a=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=e[0].pts,a.dts=e[0].dts,t=0;t<e.length;t++)(n=e[t]).keyFrame?(r.length&&(a.push(r),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration),(r=[n]).nalCount=n.length,r.byteLength=n.byteLength,r.pts=n.pts,r.dts=n.dts,r.duration=n.duration):(r.duration+=n.duration,r.nalCount+=n.length,r.byteLength+=n.byteLength,r.push(n));return a.length&&r.duration<=0&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration,a.push(r),a},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var n,r,a,i,s,o=t||0,l=[];for(n=0;n<e.length;n++)for(i=e[n],r=0;r<i.length;r++)s=i[r],o+=(a=ne(s,o)).size,l.push(a);return l},concatenateNalData:function(e){var t,n,r,a,i,s,o=0,l=e.byteLength,u=e.nalCount,d=new Uint8Array(l+4*u),c=new DataView(d.buffer);for(t=0;t<e.length;t++)for(a=e[t],n=0;n<a.length;n++)for(i=a[n],r=0;r<i.length;r++)s=i[r],c.setUint32(o,s.data.byteLength),o+=4,d.set(s.data,o),o+=s.data.byteLength;return d},generateSampleTableForFrame:function(e,t){var n,r=[];return n=ne(e,t||0),r.push(n),r},concatenateNalDataForFrame:function(e){var t,n,r=0,a=e.byteLength,i=e.length,s=new Uint8Array(a+4*i),o=new DataView(s.buffer);for(t=0;t<e.length;t++)n=e[t],o.setUint32(r,n.data.byteLength),r+=4,s.set(n.data,r),r+=n.data.byteLength;return s}},ae=[33,16,5,32,164,27],ie=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],se=function(e){for(var t=[];e--;)t.push(0);return t},oe=9e4;J=function(e,t){return X(Y(e,t))},Q=function(e,t){return K(Z(e),t)},ee=function(e,t,n){return Z(n?e:e-t)};var le={ONE_SECOND_IN_TS:oe,secondsToVideoTs:X=function(e){return e*oe},secondsToAudioTs:K=function(e,t){return e*t},videoTsToSeconds:Z=function(e){return e/oe},audioTsToSeconds:Y=function(e,t){return e/t},audioTsToVideoTs:J,videoTsToAudioTs:Q,metadataTsToSeconds:ee},ue=le,de={prefixWithSilence:function(e,t,n,r){var a,i,s,o,l,u=0,d=0,c=0;if(t.length&&(a=ue.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),i=Math.ceil(ue.ONE_SECOND_IN_TS/(e.samplerate/1024)),n&&r&&(u=a-Math.max(n,r),c=(d=Math.floor(u/i))*i),!(d<1||c>ue.ONE_SECOND_IN_TS/2))){for((s=function(){if(!q){var e={96e3:[ae,[227,64],se(154),[56]],88200:[ae,[231],se(170),[56]],64e3:[ae,[248,192],se(240),[56]],48e3:[ae,[255,192],se(268),[55,148,128],se(54),[112]],44100:[ae,[255,192],se(268),[55,163,128],se(84),[112]],32e3:[ae,[255,192],se(268),[55,234],se(226),[112]],24e3:[ae,[255,192],se(268),[55,255,128],se(268),[111,112],se(126),[224]],16e3:[ae,[255,192],se(268),[55,255,128],se(268),[111,255],se(269),[223,108],se(195),[1,192]],12e3:[ie,se(268),[3,127,248],se(268),[6,255,240],se(268),[13,255,224],se(268),[27,253,128],se(259),[56]],11025:[ie,se(268),[3,127,248],se(268),[6,255,240],se(268),[13,255,224],se(268),[27,255,192],se(268),[55,175,128],se(108),[112]],8e3:[ie,se(268),[3,121,16],se(47),[7]]};t=e,q=Object.keys(t).reduce((function(e,n){return e[n]=new Uint8Array(t[n].reduce((function(e,t){return e.concat(t)}),[])),e}),{})}var t;return q}()[e.samplerate])||(s=t[0].data),o=0;o<d;o++)l=t[0],t.splice(0,0,{data:s,dts:l.dts-i,pts:l.pts-i});return e.baseMediaDecodeTime-=Math.floor(ue.videoTsToAudioTs(c,e.samplerate)),c}},trimAdtsFramesByEarliestDts:function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter((function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)})))},generateSampleTable:function(e){var t,n,r=[];for(t=0;t<e.length;t++)n=e[t],r.push({size:n.data.byteLength,duration:1024});return r},concatenateFrameData:function(e){var t,n,r=0,a=new Uint8Array(function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t].data.byteLength;return n}(e));for(t=0;t<e.length;t++)n=e[t],a.set(n.data,r),r+=n.data.byteLength;return a}},ce=le.ONE_SECOND_IN_TS,he={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var n,r=e.minSegmentDts;return t||(r-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=r,n=Math.max(0,n),"audio"===e.type&&(n*=e.samplerate/ce,n=Math.floor(n)),n},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))}},pe={parseSei:function(e){for(var t=0,n={payloadType:-1,payloadSize:0},r=0,a=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)r+=255,t++;for(r+=e[t++];255===e[t];)a+=255,t++;if(a+=e[t++],!n.payload&&4===r){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){n.payloadType=r,n.payloadSize=a,n.payload=e.subarray(t,t+a);break}n.payload=void 0}t+=a,r=0,a=0}return n},parseUserData:function(e){return 181!==e.payload[0]||49!=(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var n,r,a,i,s=[];if(!(64&t[0]))return s;for(r=31&t[0],n=0;n<r;n++)i={type:3&t[2+(a=3*n)],pts:e},4&t[a+2]&&(i.ccData=t[a+3]<<8|t[a+4],s.push(i));return s},discardEmulationPreventionBytes:function(e){for(var t,n,r=e.byteLength,a=[],i=1;i<r-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(a.push(i+2),i+=2):i++;if(0===a.length)return e;t=r-a.length,n=new Uint8Array(t);var s=0;for(i=0;i<t;s++,i++)s===a[0]&&(s++,a.shift()),n[i]=e[s];return n},USER_DATA_REGISTERED_ITU_T_T35:4},me=V,fe=pe,ge=function(e){e=e||{},ge.prototype.init.call(this),this.parse708captions_="boolean"!=typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new _e(0,0),new _e(0,1),new _e(1,0),new _e(1,1)],this.parse708captions_&&(this.cc708Stream_=new ve({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach((function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))}),this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ge.prototype=new me,ge.prototype.push=function(e){var t,n,r;if("sei_rbsp"===e.nalUnitType&&(t=fe.parseSei(e.escapedRBSP)).payload&&t.payloadType===fe.USER_DATA_REGISTERED_ITU_T_T35&&(n=fe.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));r=fe.parseCaptionPackets(e.pts,n),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},ge.prototype.flushCCStreams=function(e){this.ccStreams_.forEach((function(t){return"flush"===e?t.flush():t.partialFlush()}),this)},ge.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach((function(e,t){e.presortIndex=t})),this.captionPackets_.sort((function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts})),this.captionPackets_.forEach((function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)}),this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},ge.prototype.flush=function(){return this.flushStream("flush")},ge.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ge.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach((function(e){e.reset()}))},ge.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},ge.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},ge.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},ge.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)},ge.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var ye={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},be=function(e){return 32<=e&&e<=127||160<=e&&e<=255},xe=function(e){this.windowNum=e,this.reset()};xe.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},xe.prototype.getText=function(){return this.rows.join("\n")},xe.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},xe.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},xe.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},xe.prototype.addText=function(e){this.rows[this.rowIdx]+=e},xe.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var Ae=function(e,t,n){this.serviceNum=e,this.text="",this.currentWindow=new xe(-1),this.windows=[],this.stream=n,"string"==typeof t&&this.createTextDecoder(t)};Ae.prototype.init=function(e,t){this.startPts=e;for(var n=0;n<8;n++)this.windows[n]=new xe(n),"function"==typeof t&&(this.windows[n].beforeRowOverflow=t)},Ae.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},Ae.prototype.createTextDecoder=function(e){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var ve=function(e){e=e||{},ve.prototype.init.call(this);var t,n=this,r=e.captionServices||{},a={};Object.keys(r).forEach((e=>{t=r[e],/^SERVICE/.test(e)&&(a[e]=t.encoding)})),this.serviceEncodings=a,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(n.new708Packet(),n.add708Bytes(e)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(e))}};ve.prototype=new me,ve.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},ve.prototype.add708Bytes=function(e){var t=e.ccData,n=t>>>8,r=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(n),this.current708Packet.data.push(r)},ve.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,n=null,r=null,a=0,i=t[a++];for(e.seq=i>>6,e.sizeCode=63&i;a<t.length;a++)r=31&(i=t[a++]),7==(n=i>>5)&&r>0&&(n=i=t[a++]),this.pushServiceBlock(n,a,r),r>0&&(a+=r-1)},ve.prototype.pushServiceBlock=function(e,t,n){var r,a=t,i=this.current708Packet.data,s=this.services[e];for(s||(s=this.initService(e,a));a<t+n&&a<i.length;a++)r=i[a],be(r)?a=this.handleText(a,s):24===r?a=this.multiByteCharacter(a,s):16===r?a=this.extendedCommands(a,s):128<=r&&r<=135?a=this.setCurrentWindow(a,s):152<=r&&r<=159?a=this.defineWindow(a,s):136===r?a=this.clearWindows(a,s):140===r?a=this.deleteWindows(a,s):137===r?a=this.displayWindows(a,s):138===r?a=this.hideWindows(a,s):139===r?a=this.toggleWindows(a,s):151===r?a=this.setWindowAttributes(a,s):144===r?a=this.setPenAttributes(a,s):145===r?a=this.setPenColor(a,s):146===r?a=this.setPenLocation(a,s):143===r?s=this.reset(a,s):8===r?s.currentWindow.backspace():12===r?s.currentWindow.clearText():13===r?s.currentWindow.pendingNewLine=!0:14===r?s.currentWindow.clearText():141===r&&a++},ve.prototype.extendedCommands=function(e,t){var n=this.current708Packet.data[++e];return be(n)&&(e=this.handleText(e,t,{isExtended:!0})),e},ve.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},ve.prototype.initService=function(e,t){var n,r,a=this;return(n="SERVICE"+e)in this.serviceEncodings&&(r=this.serviceEncodings[n]),this.services[e]=new Ae(e,r,a),this.services[e].init(this.getPts(t),(function(t){a.flushDisplayed(t,a.services[e])})),this.services[e]},ve.prototype.handleText=function(e,t,n){var r,a,i,s,o=n&&n.isExtended,l=n&&n.isMultiByte,u=this.current708Packet.data,d=o?4096:0,c=u[e],h=u[e+1],p=t.currentWindow;return t.textDecoder_&&!o?(l?(a=[c,h],e++):a=[c],r=t.textDecoder_.decode(new Uint8Array(a))):(s=ye[i=d|c]||i,r=4096&i&&i===s?"":String.fromCharCode(s)),p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(e)),p.pendingNewLine=!1,p.addText(r),e},ve.prototype.multiByteCharacter=function(e,t){var n=this.current708Packet.data,r=n[e+1],a=n[e+2];return be(r)&&be(a)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},ve.prototype.setCurrentWindow=function(e,t){var n=7&this.current708Packet.data[e];return t.setCurrentWindow(n),e},ve.prototype.defineWindow=function(e,t){var n=this.current708Packet.data,r=n[e],a=7&r;t.setCurrentWindow(a);var i=t.currentWindow;return r=n[++e],i.visible=(32&r)>>5,i.rowLock=(16&r)>>4,i.columnLock=(8&r)>>3,i.priority=7&r,r=n[++e],i.relativePositioning=(128&r)>>7,i.anchorVertical=127&r,r=n[++e],i.anchorHorizontal=r,r=n[++e],i.anchorPoint=(240&r)>>4,i.rowCount=15&r,r=n[++e],i.columnCount=63&r,r=n[++e],i.windowStyle=(56&r)>>3,i.penStyle=7&r,i.virtualRowCount=i.rowCount+1,e},ve.prototype.setWindowAttributes=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.winAttr;return r=n[++e],a.fillOpacity=(192&r)>>6,a.fillRed=(48&r)>>4,a.fillGreen=(12&r)>>2,a.fillBlue=3&r,r=n[++e],a.borderType=(192&r)>>6,a.borderRed=(48&r)>>4,a.borderGreen=(12&r)>>2,a.borderBlue=3&r,r=n[++e],a.borderType+=(128&r)>>5,a.wordWrap=(64&r)>>6,a.printDirection=(48&r)>>4,a.scrollDirection=(12&r)>>2,a.justify=3&r,r=n[++e],a.effectSpeed=(240&r)>>4,a.effectDirection=(12&r)>>2,a.displayEffect=3&r,e},ve.prototype.flushDisplayed=function(e,t){for(var n=[],r=0;r<8;r++)t.windows[r].visible&&!t.windows[r].isEmpty()&&n.push(t.windows[r].getText());t.endPts=e,t.text=n.join("\n\n"),this.pushCaption(t),t.startPts=e},ve.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},ve.prototype.displayWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&(t.windows[a].visible=1);return e},ve.prototype.hideWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&(t.windows[a].visible=0);return e},ve.prototype.toggleWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&(t.windows[a].visible^=1);return e},ve.prototype.clearWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&t.windows[a].clearText();return e},ve.prototype.deleteWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&t.windows[a].reset();return e},ve.prototype.setPenAttributes=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.penAttr;return r=n[++e],a.textTag=(240&r)>>4,a.offset=(12&r)>>2,a.penSize=3&r,r=n[++e],a.italics=(128&r)>>7,a.underline=(64&r)>>6,a.edgeType=(56&r)>>3,a.fontStyle=7&r,e},ve.prototype.setPenColor=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.penColor;return r=n[++e],a.fgOpacity=(192&r)>>6,a.fgRed=(48&r)>>4,a.fgGreen=(12&r)>>2,a.fgBlue=3&r,r=n[++e],a.bgOpacity=(192&r)>>6,a.bgRed=(48&r)>>4,a.bgGreen=(12&r)>>2,a.bgBlue=3&r,r=n[++e],a.edgeRed=(48&r)>>4,a.edgeGreen=(12&r)>>2,a.edgeBlue=3&r,e},ve.prototype.setPenLocation=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,r=n[++e],a.row=15&r,r=n[++e],a.column=63&r,e},ve.prototype.reset=function(e,t){var n=this.getPts(e);return this.flushDisplayed(n,t),this.initService(t.serviceNum,e)};var we={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ke=function(e){return null===e?"":(e=we[e]||e,String.fromCharCode(e))},Se=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Te=function(){for(var e=[],t=15;t--;)e.push("");return e},_e=function(e,t){_e.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,r,a,i;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),r=t>>>8,a=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Te();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Te();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Te()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(r,a))i=ke((r=(3&r)<<8)|a),this[this.mode_](e.pts,i),this.column_++;else if(this.isExtCharacter(r,a))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),i=ke((r=(3&r)<<8)|a),this[this.mode_](e.pts,i),this.column_++;else if(this.isMidRowCode(r,a))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&a)&&this.addFormatting(e.pts,["i"]),1==(1&a)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(r,a))this.column_+=3&a;else if(this.isPAC(r,a)){var s=Se.indexOf(7968&t);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(e.pts,s)),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&a&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(a)&&14==(14&a)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(r)&&(0===a&&(a=null),i=ke(r),i+=ke(a),this[this.mode_](e.pts,i),this.column_+=i.length)}else this.lastControlCode_=null}};_e.prototype=new me,_e.prototype.flushDisplayed=function(e){var t=this.displayed_.map((function(e,t){try{return e.trim()}catch(e){return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+t+"."}),""}}),this).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},_e.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Te(),this.nonDisplayed_=Te(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},_e.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},_e.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},_e.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},_e.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},_e.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},_e.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},_e.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},_e.prototype.isNormalChar=function(e){return e>=32&&e<=127},_e.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Te(),this.displayed_=Te()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},_e.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce((function(e,t){return e+"<"+t+">"}),"");this[this.mode_](e,n)},_e.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce((function(e,t){return e+"</"+t+">"}),"");this.formatting_=[],this[this.mode_](e,t)}},_e.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_];n+=t,this.nonDisplayed_[this.row_]=n},_e.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_];n+=t,this.displayed_[this.row_]=n},_e.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},_e.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_];n+=t,this.displayed_[this.row_]=n};var Ie={CaptionStream:ge,Cea608Stream:_e,Cea708Stream:ve},Ce={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ee=V,Ne="shared",Re=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>4294967296;)e+=8589934592*n;return e},Pe=function(e){var t,n;Pe.prototype.init.call(this),this.type_=e||Ne,this.push=function(e){this.type_!==Ne&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=Re(e.dts,n),e.pts=Re(e.pts,n),t=e.dts,this.trigger("data",e))},this.flush=function(){n=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Pe.prototype=new Ee;var De,Me={TimestampRolloverStream:Pe,handleRollover:Re},Oe=(e,t,n)=>{if(!e)return-1;for(var r=n;r<e.length;r++)if(e[r]===t)return r;return-1},$e=function(e,t,n){var r,a="";for(r=t;r<n;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a},Fe=function(e,t,n){return decodeURIComponent($e(e,t,n))},Le=function(e,t,n){return unescape($e(e,t,n))},ze=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Be={APIC:function(e){var t,n,r=1;3===e.data[0]&&((t=Oe(e.data,0,r))<0||(e.mimeType=Le(e.data,r,t),r=t+1,e.pictureType=e.data[r],r++,(n=Oe(e.data,0,r))<0||(e.description=Fe(e.data,r,n),r=n+1,"--\x3e"===e.mimeType?e.url=Le(e.data,r,e.data.length):e.pictureData=e.data.subarray(r,e.data.length))))},"T*":function(e){3===e.data[0]&&(e.value=Fe(e.data,1,e.data.length).replace(/\0*$/,""),e.values=e.value.split("\0"))},TXXX:function(e){var t;3===e.data[0]&&-1!==(t=Oe(e.data,0,1))&&(e.description=Fe(e.data,1,t),e.value=Fe(e.data,t+1,e.data.length).replace(/\0*$/,""),e.data=e.value)},"W*":function(e){e.url=Le(e.data,0,e.data.length).replace(/\0.*$/,"")},WXXX:function(e){var t;3===e.data[0]&&-1!==(t=Oe(e.data,0,1))&&(e.description=Fe(e.data,1,t),e.url=Le(e.data,t+1,e.data.length).replace(/\0.*$/,""))},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Le(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},Ue={parseId3Frames:function(e){var t,n=10,r=0,a=[];if(!(e.length<10||e[0]!=="I".charCodeAt(0)||e[1]!=="D".charCodeAt(0)||e[2]!=="3".charCodeAt(0))){r=ze(e.subarray(6,10)),r+=10,64&e[5]&&(n+=4,n+=ze(e.subarray(10,14)),r-=ze(e.subarray(16,20)));do{if((t=ze(e.subarray(n+4,n+8)))<1)break;var i={id:String.fromCharCode(e[n],e[n+1],e[n+2],e[n+3]),data:e.subarray(n+10,n+t+10)};i.key=i.id,Be[i.id]?Be[i.id](i):"T"===i.id[0]?Be["T*"](i):"W"===i.id[0]&&Be["W*"](i),a.push(i),n+=10,n+=t}while(n<r);return a}},parseSyncSafeInteger:ze,frameParsers:Be},We=Ce,Ve=Ue;(De=function(e){var t,n={descriptor:e&&e.descriptor},r=0,a=[],i=0;if(De.prototype.init.call(this),this.dispatchType=We.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,n,s,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(i=0,a.length=0),0===a.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(a.push(e),i+=e.data.byteLength,1===a.length&&(r=Ve.parseSyncSafeInteger(e.data.subarray(6,10)),r+=10),!(i<r)){for(t={data:new Uint8Array(r),frames:[],pts:a[0].pts,dts:a[0].dts},l=0;l<r;)t.data.set(a[0].data.subarray(0,r-l),l),l+=a[0].data.byteLength,i-=a[0].data.byteLength,a.shift();n=10,64&t.data[5]&&(n+=4,n+=Ve.parseSyncSafeInteger(t.data.subarray(10,14)),r-=Ve.parseSyncSafeInteger(t.data.subarray(16,20)));do{if((s=Ve.parseSyncSafeInteger(t.data.subarray(n+4,n+8)))<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if((o={id:String.fromCharCode(t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]),data:t.data.subarray(n+10,n+s+10)}).key=o.id,Ve.frameParsers[o.id]?Ve.frameParsers[o.id](o):"T"===o.id[0]?Ve.frameParsers["T*"](o):"W"===o.id[0]&&Ve.frameParsers["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var u=o.data,d=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;d*=4,d+=3&u[7],o.timeStamp=d,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),n+=10,n+=s}while(n<r);this.trigger("data",t)}}}).prototype=new V;var je,He,Ge,qe=De,Xe=V,Ke=Ie,Ze=Ce,Ye=Me.TimestampRolloverStream,Je=188;(je=function(){var e=new Uint8Array(Je),t=0;je.prototype.init.call(this),this.push=function(n){var r,a=0,i=Je;for(t?((r=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),r.set(n,t),t=0):r=n;i<r.byteLength;)71!==r[a]||71!==r[i]?(a++,i++):(this.trigger("data",r.subarray(a,i)),a+=Je,i+=Je);a<r.byteLength&&(e.set(r.subarray(a),0),t=r.byteLength-a)},this.flush=function(){t===Je&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new Xe,(He=function(){var e,t,n,r;He.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,r){var a=0;r.payloadUnitStartIndicator&&(a+=e[a]+1),"pat"===r.type?t(e.subarray(a),r):n(e.subarray(a),r)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],r.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=r.pmtPid},n=function(e,t){var n,a;if(1&e[5]){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,a=12+((15&e[10])<<8|e[11]);a<n;){var i=e[a],s=(31&e[a+1])<<8|e[a+2];i===Ze.H264_STREAM_TYPE&&null===r.programMapTable.video?r.programMapTable.video=s:i===Ze.ADTS_STREAM_TYPE&&null===r.programMapTable.audio?r.programMapTable.audio=s:i===Ze.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][s]=i),a+=5+((15&e[a+3])<<8|e[a+4])}t.programMapTable=r.programMapTable}},this.push=function(t){var n={},r=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(r+=t[r]+1),0===n.pid)n.type="pat",e(t.subarray(r),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(r),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,r,n]):this.processPes_(t,r,n)},this.processPes_=function(e,t,n){n.pid===this.programMapTable.video?n.streamType=Ze.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?n.streamType=Ze.ADTS_STREAM_TYPE:n.streamType=this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}}).prototype=new Xe,He.STREAM_TYPES={h264:27,adts:15},Ge=function(){var e,t=this,n=!1,r={data:[],size:0},a={data:[],size:0},i={data:[],size:0},s=function(e,n,r){var a,i,s=new Uint8Array(e.size),o={type:n},l=0,u=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)i=e.data[l],s.set(i.data,u),u+=i.data.byteLength;!function(e,t){var n;const r=e[0]<<16|e[1]<<8|e[2];t.data=new Uint8Array,1===r&&(t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!=(4&e[6]),192&(n=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&n&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8]))}(s,o),a="video"===n||o.packetLength<=e.size,(r||a)&&(e.size=0,e.data.length=0),a&&t.trigger("data",o)}};Ge.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case Ze.H264_STREAM_TYPE:e=r,t="video";break;case Ze.ADTS_STREAM_TYPE:e=a,t="audio";break;case Ze.METADATA_STREAM_TYPE:e=i,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&s(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var r={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),n=!0,t.trigger("data",r)}})[o.type]()},this.reset=function(){r.size=0,r.data.length=0,a.size=0,a.data.length=0,this.trigger("reset")},this.flushStreams_=function(){s(r,"video"),s(a,"audio"),s(i,"timed-metadata")},this.flush=function(){if(!n&&e){var r={type:"metadata",tracks:[]};null!==e.video&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",r)}n=!1,this.flushStreams_(),this.trigger("done")}},Ge.prototype=new Xe;var Qe={PAT_PID:0,MP2T_PACKET_LENGTH:Je,TransportPacketStream:je,TransportParseStream:He,ElementaryStream:Ge,TimestampRolloverStream:Ye,CaptionStream:Ke.CaptionStream,Cea608Stream:Ke.Cea608Stream,Cea708Stream:Ke.Cea708Stream,MetadataStream:qe};for(var et in Ze)Ze.hasOwnProperty(et)&&(Qe[et]=Ze[et]);var tt,nt=Qe,rt=le.ONE_SECOND_IN_TS,at=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(tt=function(e){var t,n=0;tt.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:`adts skiping bytes ${e} to ${t} in frame ${n} outside syncword`})},this.push=function(r){var a,i,s,o,l,u=0;if(e||(n=0),"audio"===r.type){var d;for(t&&t.length?(s=t,(t=new Uint8Array(s.byteLength+r.data.byteLength)).set(s),t.set(r.data,s.byteLength)):t=r.data;u+7<t.length;)if(255===t[u]&&240==(246&t[u+1])){if("number"==typeof d&&(this.skipWarn_(d,u),d=null),i=2*(1&~t[u+1]),a=(3&t[u+3])<<11|t[u+4]<<3|(224&t[u+5])>>5,l=(o=1024*(1+(3&t[u+6])))*rt/at[(60&t[u+2])>>>2],t.byteLength-u<a)break;this.trigger("data",{pts:r.pts+n*l,dts:r.dts+n*l,sampleCount:o,audioobjecttype:1+(t[u+2]>>>6&3),channelcount:(1&t[u+2])<<2|(192&t[u+3])>>>6,samplerate:at[(60&t[u+2])>>>2],samplingfrequencyindex:(60&t[u+2])>>>2,samplesize:16,data:t.subarray(u+7+i,u+a)}),n++,u+=a}else"number"!=typeof d&&(d=u),u++;"number"==typeof d&&(this.skipWarn_(d,u),d=null),t=t.subarray(u)}},this.flush=function(){n=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}}).prototype=new V;var it,st,ot,lt=tt,ut=V,dt=function(e){var t=e.byteLength,n=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var a=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");i.set(e.subarray(a,a+s)),n=new DataView(i.buffer).getUint32(0),r=8*s,t-=s},this.skipBits=function(e){var a;r>e?(n<<=e,r-=e):(e-=r,e-=8*(a=Math.floor(e/8)),t-=a,this.loadWord(),n<<=e,r-=e)},this.readBits=function(e){var a=Math.min(r,e),i=n>>>32-a;return(r-=a)>0?n<<=a:t>0&&this.loadWord(),(a=e-a)>0?i<<a|this.readBits(a):i},this.skipLeadingZeros=function(){var e;for(e=0;e<r;++e)if(0!=(n&2147483648>>>e))return n<<=e,r-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(st=function(){var e,t,n=0;st.prototype.init.call(this),this.push=function(r){var a;t?((a=new Uint8Array(t.byteLength+r.data.byteLength)).set(t),a.set(r.data,t.byteLength),t=a):t=r.data;for(var i=t.byteLength;n<i-3;n++)if(1===t[n+2]){e=n+5;break}for(;e<i;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<i);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3}t=t.subarray(n),e-=n,n=0},this.reset=function(){t=null,n=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new ut,ot={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},it=function(){var e,t,n,r,a,i,s,o=new st;it.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,r=e.dts,o.push(e))},o.on("data",(function(s){var o={trackId:t,pts:n,dts:r,data:s,nalUnitTypeCode:31&s[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=a(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=a(s.subarray(1)),o.config=i(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)})),o.on("done",(function(){e.trigger("done")})),o.on("partialdone",(function(){e.trigger("partialdone")})),o.on("reset",(function(){e.trigger("reset")})),o.on("endedtimeline",(function(){e.trigger("endedtimeline")})),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},s=function(e,t){var n,r=8,a=8;for(n=0;n<e;n++)0!==a&&(a=(r+t.readExpGolomb()+256)%256),r=0===a?r:a},a=function(e){for(var t,n,r=e.byteLength,a=[],i=1;i<r-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(a.push(i+2),i+=2):i++;if(0===a.length)return e;t=r-a.length,n=new Uint8Array(t);var s=0;for(i=0;i<t;s++,i++)s===a[0]&&(s++,a.shift()),n[i]=e[s];return n},i=function(e){var t,n,r,a,i,o,l,u,d,c,h,p,m=0,f=0,g=0,y=0,b=[1,1];if(n=(t=new dt(e)).readUnsignedByte(),a=t.readUnsignedByte(),r=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),ot[n]&&(3===(i=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(h=3!==i?8:12,p=0;p<h;p++)t.readBoolean()&&s(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),u=t.readUnsignedExpGolomb(),d=t.readUnsignedExpGolomb(),0===(c=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(m=t.readUnsignedExpGolomb(),f=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}b&&(b[0],b[1])}return{profileIdc:n,levelIdc:r,profileCompatibility:a,width:16*(u+1)-2*m-2*f,height:(2-c)*(d+1)*16-2*g-2*y,sarRatio:b}}},it.prototype=new ut;var ct,ht={H264Stream:it,NalByteStream:st},pt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],mt=function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return n=n>=0?n:0,(16&e[t+5])>>4?n+20:n+10},ft=function(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=mt(e,t),ft(e,t))},gt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},yt={isLikelyAacData:function(e){var t=ft(e,0);return e.length>=t+2&&255==(255&e[t])&&240==(240&e[t+1])&&16==(22&e[t+1])},parseId3TagSize:mt,parseAdtsSize:function(e,t){var n=(224&e[t+5])>>5,r=e[t+4]<<3;return 6144&e[t+3]|r|n},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return pt[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,n,r;t=10,64&e[5]&&(t+=4,t+=gt(e.subarray(10,14)));do{if((n=gt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){r=e.subarray(t+10,t+n+10);for(var a=0;a<r.byteLength;a++)if(0===r[a]){var i=unescape(function(e,t,n){var r,a="";for(r=0;r<n;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a}(r,0,a));if("com.apple.streaming.transportStreamTimestamp"===i){var s=r.subarray(a+1),o=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return(o*=4)+(3&s[7])}break}}t+=10,t+=n}while(t<e.byteLength);return null}},bt=yt;(ct=function(){var e=new Uint8Array,t=0;ct.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var r,a,i,s,o=0,l=0;for(e.length?(s=e.length,(e=new Uint8Array(n.byteLength+s)).set(e.subarray(0,s)),e.set(n,s)):e=n;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255!=(255&e[l])||240!=(240&e[l+1]))l++;else{if(e.length-l<7)break;if(l+(o=bt.parseAdtsSize(e,l))>e.length)break;i={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",i),l+=o}else{if(e.length-l<10)break;if(l+(o=bt.parseId3TagSize(e,l))>e.length)break;a={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",a),l+=o}r=e.length-l,e=r>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new V;var xt,At,vt,wt,kt=V,St=te,Tt=re,_t=de,It=he,Ct=nt,Et=le,Nt=lt,Rt=ht.H264Stream,Pt=ct,Dt=yt.isLikelyAacData,Mt=le.ONE_SECOND_IN_TS,Ot=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],$t=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Ft=function(e,t){t.stream=e,this.trigger("log",t)},Lt=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var a=n[r];"headOfPipeline"!==a&&t[a].on&&t[a].on("log",Ft.bind(e,a))}},zt=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},Bt=function(e,t,n,r,a,i){return{start:{dts:e,pts:e+(n-t)},end:{dts:e+(r-t),pts:e+(a-n)},prependedContentDuration:i,baseMediaDecodeTime:e}};At=function(e,t){var n,r=[],a=0,i=0,s=1/0;n=(t=t||{}).firstSequenceNumber||0,At.prototype.init.call(this),this.push=function(t){It.collectDtsInfo(e,t),e&&Ot.forEach((function(n){e[n]=t[n]})),r.push(t)},this.setEarliestDts=function(e){a=e},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){i=e},this.flush=function(){var o,l,u,d,c,h,p;0!==r.length?(o=_t.trimAdtsFramesByEarliestDts(r,e,a),e.baseMediaDecodeTime=It.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),p=_t.prefixWithSilence(e,o,i,s),e.samples=_t.generateSampleTable(o),u=St.mdat(_t.concatenateFrameData(o)),r=[],l=St.moof(n,[e]),d=new Uint8Array(l.byteLength+u.byteLength),n++,d.set(l),d.set(u,l.byteLength),It.clearDtsInfo(e),c=Math.ceil(1024*Mt/e.samplerate),o.length&&(h=o.length*c,this.trigger("segmentTimingInfo",Bt(Et.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+h,o[0].pts+h,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+h})),this.trigger("data",{track:e,boxes:d}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){It.clearDtsInfo(e),r=[],this.trigger("reset")}},At.prototype=new kt,xt=function(e,t){var n,r,a,i=[],s=[];n=(t=t||{}).firstSequenceNumber||0,xt.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){It.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.config,e.sps=[t.data],$t.forEach((function(t){e[t]=r[t]}),this)),"pic_parameter_set_rbsp"!==t.nalUnitType||a||(a=t.data,e.pps=[t.data]),i.push(t)},this.flush=function(){for(var r,a,o,l,u,d,c,h,p=0;i.length&&"access_unit_delimiter_rbsp"!==i[0].nalUnitType;)i.shift();if(0===i.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(r=Tt.groupNalsIntoFrames(i),(o=Tt.groupFramesIntoGops(r))[0][0].keyFrame||((a=this.getGopForFusion_(i[0],e))?(p=a.duration,o.unshift(a),o.byteLength+=a.byteLength,o.nalCount+=a.nalCount,o.pts=a.pts,o.dts=a.dts,o.duration+=a.duration):o=Tt.extendFirstKeyFrame(o)),s.length){var m;if(!(m=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");It.clearDtsInfo(e),o=m}It.collectDtsInfo(e,o),e.samples=Tt.generateSampleTable(o),u=St.mdat(Tt.concatenateNalData(o)),e.baseMediaDecodeTime=It.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map((function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}}))),c=o[0],h=o[o.length-1],this.trigger("segmentTimingInfo",Bt(e.baseMediaDecodeTime,c.dts,c.pts,h.dts+h.duration,h.pts+h.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=St.moof(n,[e]),d=new Uint8Array(l.byteLength+u.byteLength),n++,d.set(l),d.set(u,l.byteLength),this.trigger("data",{track:e,boxes:d}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),i=[],this.gopCache_.length=0,s.length=0,this.trigger("reset")},this.resetStream_=function(){It.clearDtsInfo(e),r=void 0,a=void 0},this.getGopForFusion_=function(t){var n,r,a,i,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)a=(i=this.gopCache_[s]).gop,e.pps&&zt(e.pps[0],i.pps[0])&&e.sps&&zt(e.sps[0],i.sps[0])&&(a.dts<e.timelineStartInfo.dts||(n=t.dts-a.dts-a.duration)>=-1e4&&n<=45e3&&(!r||o>n)&&(r=i,o=n));return r?r.gop:null},this.alignGopsAtStart_=function(e){var t,n,r,a,i,o,l,u;for(i=e.byteLength,o=e.nalCount,l=e.duration,t=n=0;t<s.length&&n<e.length&&(r=s[t],a=e[n],r.pts!==a.pts);)a.pts>r.pts?t++:(n++,i-=a.byteLength,o-=a.nalCount,l-=a.duration);return 0===n?e:n===e.length?null:((u=e.slice(n)).byteLength=i,u.duration=l,u.nalCount=o,u.pts=u[0].pts,u.dts=u[0].dts,u)},this.alignGopsAtEnd_=function(e){var t,n,r,a,i,o,l;for(t=s.length-1,n=e.length-1,i=null,o=!1;t>=0&&n>=0;){if(r=s[t],a=e[n],r.pts===a.pts){o=!0;break}r.pts>a.pts?t--:(t===s.length-1&&(i=n),n--)}if(!o&&null===i)return null;if(0===(l=o?n:i))return e;var u=e.slice(l),d=u.reduce((function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e}),{byteLength:0,duration:0,nalCount:0});return u.byteLength=d.byteLength,u.duration=d.duration,u.nalCount=d.nalCount,u.pts=u[0].pts,u.dts=u[0].dts,u},this.alignGopsWith=function(e){s=e}},xt.prototype=new kt,wt=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"==typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,wt.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}},wt.prototype=new kt,wt.prototype.flush=function(e){var t,n,r,a,i=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,$t.forEach((function(e){s.info[e]=this.videoTrack[e]}),this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Ot.forEach((function(e){s.info[e]=this.audioTrack[e]}),this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,r=St.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(r.byteLength),s.initSegment.set(r),s.data=new Uint8Array(this.pendingBytes),a=0;a<this.pendingBoxes.length;a++)s.data.set(this.pendingBoxes[a],i),i+=this.pendingBoxes[a].byteLength;for(a=0;a<this.pendingCaptions.length;a++)(t=this.pendingCaptions[a]).startTime=Et.metadataTsToSeconds(t.startPts,o,this.keepOriginalTimestamps),t.endTime=Et.metadataTsToSeconds(t.endPts,o,this.keepOriginalTimestamps),s.captionStreams[t.stream]=!0,s.captions.push(t);for(a=0;a<this.pendingMetadata.length;a++)(n=this.pendingMetadata[a]).cueTime=Et.metadataTsToSeconds(n.pts,o,this.keepOriginalTimestamps),s.metadata.push(n);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),a=0;a<s.captions.length;a++)t=s.captions[a],this.trigger("caption",t);for(a=0;a<s.metadata.length;a++)n=s.metadata[a],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},wt.prototype.setRemux=function(e){this.remuxTracks=e},(vt=function(e){var t,n,r=this,a=!0;vt.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="aac",a.metadataStream=new Ct.MetadataStream,a.aacStream=new Pt,a.audioTimestampRolloverStream=new Ct.TimestampRolloverStream("audio"),a.timedMetadataTimestampRolloverStream=new Ct.TimestampRolloverStream("timed-metadata"),a.adtsStream=new Nt,a.coalesceStream=new wt(e,a.metadataStream),a.headOfPipeline=a.aacStream,a.aacStream.pipe(a.audioTimestampRolloverStream).pipe(a.adtsStream),a.aacStream.pipe(a.timedMetadataTimestampRolloverStream).pipe(a.metadataStream).pipe(a.coalesceStream),a.metadataStream.on("timestamp",(function(e){a.aacStream.setTimestamp(e.timeStamp)})),a.aacStream.on("data",(function(i){"timed-metadata"!==i.type&&"audio"!==i.type||a.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:r.baseMediaDecodeTime},codec:"adts",type:"audio"},a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new At(n,e),a.audioSegmentStream.on("log",r.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",r.trigger.bind(r,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream),r.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t}))})),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),Lt(this,a)},this.setupTsPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="ts",a.metadataStream=new Ct.MetadataStream,a.packetStream=new Ct.TransportPacketStream,a.parseStream=new Ct.TransportParseStream,a.elementaryStream=new Ct.ElementaryStream,a.timestampRolloverStream=new Ct.TimestampRolloverStream,a.adtsStream=new Nt,a.h264Stream=new Rt,a.captionStream=new Ct.CaptionStream(e),a.coalesceStream=new wt(e,a.metadataStream),a.headOfPipeline=a.packetStream,a.packetStream.pipe(a.parseStream).pipe(a.elementaryStream).pipe(a.timestampRolloverStream),a.timestampRolloverStream.pipe(a.h264Stream),a.timestampRolloverStream.pipe(a.adtsStream),a.timestampRolloverStream.pipe(a.metadataStream).pipe(a.coalesceStream),a.h264Stream.pipe(a.captionStream).pipe(a.coalesceStream),a.elementaryStream.on("data",(function(i){var s;if("metadata"===i.type){for(s=i.tracks.length;s--;)t||"video"!==i.tracks[s].type?n||"audio"!==i.tracks[s].type||((n=i.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime):(t=i.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime;t&&!a.videoSegmentStream&&(a.coalesceStream.numberOfTracks++,a.videoSegmentStream=new xt(t,e),a.videoSegmentStream.on("log",r.getLogTrigger_("videoSegmentStream")),a.videoSegmentStream.on("timelineStartInfo",(function(t){n&&!e.keepOriginalTimestamps&&(n.timelineStartInfo=t,a.audioSegmentStream.setEarliestDts(t.dts-r.baseMediaDecodeTime))})),a.videoSegmentStream.on("processedGopsInfo",r.trigger.bind(r,"gopInfo")),a.videoSegmentStream.on("segmentTimingInfo",r.trigger.bind(r,"videoSegmentTimingInfo")),a.videoSegmentStream.on("baseMediaDecodeTime",(function(e){n&&a.audioSegmentStream.setVideoBaseMediaDecodeTime(e)})),a.videoSegmentStream.on("timingInfo",r.trigger.bind(r,"videoTimingInfo")),a.h264Stream.pipe(a.videoSegmentStream).pipe(a.coalesceStream)),n&&!a.audioSegmentStream&&(a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new At(n,e),a.audioSegmentStream.on("log",r.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",r.trigger.bind(r,"audioTimingInfo")),a.audioSegmentStream.on("segmentTimingInfo",r.trigger.bind(r,"audioSegmentTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),r.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t})}})),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("id3Frame",(function(e){e.dispatchType=a.metadataStream.dispatchType,r.trigger("id3Frame",e)})),a.coalesceStream.on("caption",this.trigger.bind(this,"caption")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),Lt(this,a)},this.setBaseMediaDecodeTime=function(r){var a=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=r),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,It.clearDtsInfo(n),a.audioTimestampRolloverStream&&a.audioTimestampRolloverStream.discontinuity()),t&&(a.videoSegmentStream&&(a.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,It.clearDtsInfo(t),a.captionStream.reset()),a.timestampRolloverStream&&a.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var n=this.transmuxPipeline_;e.remux=t,n&&n.coalesceStream&&n.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(n){n.stream=e,t.trigger("log",n)}},this.push=function(e){if(a){var t=Dt(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),a=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){a=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new kt;var Ut,Wt,Vt,jt,Ht={Transmuxer:vt,VideoSegmentStream:xt,AudioSegmentStream:At,AUDIO_PROPERTIES:Ot,VIDEO_PROPERTIES:$t,generateSegmentTimingInfo:Bt},Gt=function(e){return e>>>0},qt=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),(t+=String.fromCharCode(e[2]))+String.fromCharCode(e[3])},Xt=Gt,Kt=qt,Zt=function(e,t){var n,r,a,i,s,o=[];if(!t.length)return null;for(n=0;n<e.byteLength;)r=Xt(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),a=Kt(e.subarray(n+4,n+8)),i=r>1?n+r:e.byteLength,a===t[0]&&(1===t.length?o.push(e.subarray(n+8,i)):(s=Zt(e.subarray(n+8,i),t.slice(1))).length&&(o=o.concat(s))),n=i;return o},Yt=Gt,Jt=H.getUint64,Qt=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=Jt(e.subarray(4)):t.baseMediaDecodeTime=Yt(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},en=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},tn=function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),a=1&n.flags[2],i=4&n.flags[2],s=1&n.flags[1],o=2&n.flags[1],l=4&n.flags[1],u=8&n.flags[1],d=r.getUint32(4),c=8;for(a&&(n.dataOffset=r.getInt32(c),c+=4),i&&d&&(t={flags:en(e.subarray(c,c+4))},c+=4,s&&(t.duration=r.getUint32(c),c+=4),o&&(t.size=r.getUint32(c),c+=4),u&&(1===n.version?t.compositionTimeOffset=r.getInt32(c):t.compositionTimeOffset=r.getUint32(c),c+=4),n.samples.push(t),d--);d--;)t={},s&&(t.duration=r.getUint32(c),c+=4),o&&(t.size=r.getUint32(c),c+=4),l&&(t.flags=en(e.subarray(c,c+4)),c+=4),u&&(1===n.version?t.compositionTimeOffset=r.getInt32(c):t.compositionTimeOffset=r.getUint32(c),c+=4),n.samples.push(t);return n},nn=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},a=1&r.flags[2],i=2&r.flags[2],s=8&r.flags[2],o=16&r.flags[2],l=32&r.flags[2],u=65536&r.flags[0],d=131072&r.flags[0];return t=8,a&&(t+=4,r.baseDataOffset=n.getUint32(12),t+=4),i&&(r.sampleDescriptionIndex=n.getUint32(t),t+=4),s&&(r.defaultSampleDuration=n.getUint32(t),t+=4),o&&(r.defaultSampleSize=n.getUint32(t),t+=4),l&&(r.defaultSampleFlags=n.getUint32(t)),u&&(r.durationIsEmpty=!0),!a&&d&&(r.baseDataOffsetIsMoof=!0),r},rn=(Ut="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},pe.discardEmulationPreventionBytes),an=Ie.CaptionStream,sn=Zt,on=Qt,ln=tn,un=nn,dn=Ut,cn=function(e,t){for(var n=e,r=0;r<t.length;r++){var a=t[r];if(n<a.size)return a;n-=a.size}return null},hn=function(){var e,t,n,r,a,i,s=!1;this.isInitialized=function(){return s},this.init=function(t){e=new an,s=!0,i=!!t&&t.isPartial,e.on("data",(function(e){e.startTime=e.startPts/r,e.endTime=e.endPts/r,a.captions.push(e),a.captionStreams[e.stream]=!0})),e.on("log",(function(e){a.logs.push(e)}))},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length||n===e[0]&&r===t[n])},this.parse=function(e,i,s){var o;if(!this.isInitialized())return null;if(!i||!s)return null;if(this.isNewInit(i,s))n=i[0],r=s[n];else if(null===n||!r)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,i,s)}return o=function(e,t,n){if(null===t)return null;var r=function(e,t){var n=sn(e,["moof","traf"]),r=sn(e,["mdat"]),a={},i=[];return r.forEach((function(e,t){var r=n[t];i.push({mdat:e,traf:r})})),i.forEach((function(e){var n,r,i=e.mdat,s=e.traf,o=sn(s,["tfhd"]),l=un(o[0]),u=l.trackId,d=sn(s,["tfdt"]),c=d.length>0?on(d[0]).baseMediaDecodeTime:0,h=sn(s,["trun"]);t===u&&h.length>0&&(n=function(e,t,n){var r=t,a=n.defaultSampleDuration||0,i=n.defaultSampleSize||0,s=n.trackId,o=[];return e.forEach((function(e){var t=ln(e).samples;t.forEach((function(e){void 0===e.duration&&(e.duration=a),void 0===e.size&&(e.size=i),e.trackId=s,e.dts=r,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"==typeof r?(e.pts=r+dn.BigInt(e.compositionTimeOffset),r+=dn.BigInt(e.duration)):(e.pts=r+e.compositionTimeOffset,r+=e.duration)})),o=o.concat(t)})),o}(h,c,l),r=function(e,t,n){var r,a,i,s,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(a=0;a+4<e.length;a+=i)if(i=o.getUint32(a),a+=4,!(i<=0))switch(31&e[a]){case 6:var u=e.subarray(a+1,a+1+i),d=cn(a,t);if(r={nalUnitType:"sei_rbsp",size:i,data:u,escapedRBSP:rn(u),trackId:n},d)r.pts=d.pts,r.dts=d.dts,s=d;else{if(!s){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+a+" for trackId "+n+". See mux.js#223."});break}r.pts=s.pts,r.dts=s.dts}l.seiNals.push(r)}return l}(i,n,u),a[u]||(a[u]={seiNals:[],logs:[]}),a[u].seiNals=a[u].seiNals.concat(r.seiNals),a[u].logs=a[u].logs.concat(r.logs))})),a}(e,t)[t]||{};return{seiNals:r.seiNals,logs:r.logs,timescale:n}}(e,n,r),o&&o.logs&&(a.logs=a.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),a):a.logs.length?{logs:a.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach((function(t){e.push(t)}))},this.flushStream=function(){if(!this.isInitialized())return null;i?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){a.captions=[],a.captionStreams={},a.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,r=null,a?this.clearParsedCaptions():a={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},pn=Gt,mn=function(e){return("00"+e.toString(16)).slice(-2)},fn=Zt,gn=qt,yn=H.getUint64,bn=Ut;Wt=function(e,t){var n=fn(t,["moof","traf"]).reduce((function(t,n){var r,a=fn(n,["tfhd"])[0],i=pn(a[4]<<24|a[5]<<16|a[6]<<8|a[7]),s=e[i]||9e4,o=fn(n,["tfdt"])[0],l=new DataView(o.buffer,o.byteOffset,o.byteLength);let u;return"bigint"==typeof(r=1===o[0]?yn(o.subarray(4,12)):l.getUint32(4))?u=r/bn.BigInt(s):"number"!=typeof r||isNaN(r)||(u=r/s),u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),u<t&&(t=u),t}),1/0);return"bigint"==typeof n||isFinite(n)?n:0},jt=function(e){var t=0===e[0]?12:20;return pn(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},Vt=function(e){var t=fn(e,["moov","trak"]),n=[];return t.forEach((function(e){var t,r,a={},i=fn(e,["tkhd"])[0];i&&(r=(t=new DataView(i.buffer,i.byteOffset,i.byteLength)).getUint8(0),a.id=0===r?t.getUint32(12):t.getUint32(20));var s=fn(e,["mdia","hdlr"])[0];if(s){var o=gn(s.subarray(8,12));a.type="vide"===o?"video":"soun"===o?"audio":o}var l=fn(e,["mdia","minf","stbl","stsd"])[0];if(l){var u=l.subarray(8);a.codec=gn(u.subarray(4,8));var d,c=fn(u,[a.codec])[0];c&&(/^[asm]vc[1-9]$/i.test(a.codec)?(d=c.subarray(78),"avcC"===gn(d.subarray(4,8))&&d.length>11?(a.codec+=".",a.codec+=mn(d[9]),a.codec+=mn(d[10]),a.codec+=mn(d[11])):a.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(a.codec)?(d=c.subarray(28),"esds"===gn(d.subarray(4,8))&&d.length>20&&0!==d[19]?(a.codec+="."+mn(d[19]),a.codec+="."+mn(d[20]>>>2&63).replace(/^0/,"")):a.codec="mp4a.40.2"):a.codec=a.codec.toLowerCase())}var h=fn(e,["mdia","mdhd"])[0];h&&(a.timescale=jt(h)),n.push(a)})),n};var xn=Wt,An=Vt,vn=Ce,wn=function(e){var t=31&e[1];return(t<<=8)|e[2]},kn=function(e){return!!(64&e[1])},Sn=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},Tn=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},_n={parseType:function(e,t){var n=wn(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},parsePat:function(e){var t=kn(e),n=4+Sn(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},parsePmt:function(e){var t={},n=kn(e),r=4+Sn(e);if(n&&(r+=e[r]+1),1&e[r+5]){var a;a=3+((15&e[r+1])<<8|e[r+2])-4;for(var i=12+((15&e[r+10])<<8|e[r+11]);i<a;){var s=r+i;t[(31&e[s+1])<<8|e[s+2]]=e[s],i+=5+((15&e[s+3])<<8|e[s+4])}return t}},parsePayloadUnitStartIndicator:kn,parsePesType:function(e,t){switch(t[wn(e)]){case vn.H264_STREAM_TYPE:return"video";case vn.ADTS_STREAM_TYPE:return"audio";case vn.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!kn(e))return null;var t=4+Sn(e);if(t>=e.byteLength)return null;var n,r=null;return 192&(n=e[t+7])&&((r={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,r.pts*=4,r.pts+=(6&e[t+13])>>>1,r.dts=r.pts,64&n&&(r.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,r.dts*=4,r.dts+=(6&e[t+18])>>>1)),r},videoPacketContainsKeyFrame:function(e){for(var t=4+Sn(e),n=e.subarray(t),r=0,a=0,i=!1;a<n.byteLength-3;a++)if(1===n[a+2]){r=a+5;break}for(;r<n.byteLength;)switch(n[r]){case 0:if(0!==n[r-1]){r+=2;break}if(0!==n[r-2]){r++;break}a+3!==r-2&&"slice_layer_without_partitioning_rbsp_idr"===Tn(31&n[a+3])&&(i=!0);do{r++}while(1!==n[r]&&r<n.length);a=r-2,r+=3;break;case 1:if(0!==n[r-1]||0!==n[r-2]){r+=3;break}"slice_layer_without_partitioning_rbsp_idr"===Tn(31&n[a+3])&&(i=!0),a=r-2,r+=3;break;default:r+=3}return n=n.subarray(a),r-=a,a=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===Tn(31&n[a+3])&&(i=!0),i}},In=Ce,Cn=Me.handleRollover,En={};En.ts=_n,En.aac=yt;var Nn=le.ONE_SECOND_IN_TS,Rn=188,Pn=71,Dn=function(e,t,n){for(var r,a,i,s,o=0,l=Rn,u=!1;l<=e.byteLength;)if(e[o]!==Pn||e[l]!==Pn&&l!==e.byteLength)o++,l++;else{if(r=e.subarray(o,l),"pes"===En.ts.parseType(r,t.pid)&&(a=En.ts.parsePesType(r,t.table),i=En.ts.parsePayloadUnitStartIndicator(r),"audio"===a&&i&&(s=En.ts.parsePesTime(r))&&(s.type="audio",n.audio.push(s),u=!0)),u)break;o+=Rn,l+=Rn}for(o=(l=e.byteLength)-Rn,u=!1;o>=0;)if(e[o]!==Pn||e[l]!==Pn&&l!==e.byteLength)o--,l--;else{if(r=e.subarray(o,l),"pes"===En.ts.parseType(r,t.pid)&&(a=En.ts.parsePesType(r,t.table),i=En.ts.parsePayloadUnitStartIndicator(r),"audio"===a&&i&&(s=En.ts.parsePesTime(r))&&(s.type="audio",n.audio.push(s),u=!0)),u)break;o-=Rn,l-=Rn}},Mn=function(e,t,n){for(var r,a,i,s,o,l,u,d=0,c=Rn,h=!1,p={data:[],size:0};c<e.byteLength;)if(e[d]!==Pn||e[c]!==Pn)d++,c++;else{if(r=e.subarray(d,c),"pes"===En.ts.parseType(r,t.pid)&&(a=En.ts.parsePesType(r,t.table),i=En.ts.parsePayloadUnitStartIndicator(r),"video"===a&&(i&&!h&&(s=En.ts.parsePesTime(r))&&(s.type="video",n.video.push(s),h=!0),!n.firstKeyFrame))){if(i&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)u=p.data.shift(),o.set(u,l),l+=u.byteLength;if(En.ts.videoPacketContainsKeyFrame(o)){var m=En.ts.parsePesTime(o);m?(n.firstKeyFrame=m,n.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(r),p.size+=r.byteLength}if(h&&n.firstKeyFrame)break;d+=Rn,c+=Rn}for(d=(c=e.byteLength)-Rn,h=!1;d>=0;)if(e[d]!==Pn||e[c]!==Pn)d--,c--;else{if(r=e.subarray(d,c),"pes"===En.ts.parseType(r,t.pid)&&(a=En.ts.parsePesType(r,t.table),i=En.ts.parsePayloadUnitStartIndicator(r),"video"===a&&i&&(s=En.ts.parsePesTime(r))&&(s.type="video",n.video.push(s),h=!0)),h)break;d-=Rn,c-=Rn}},On=function(e,t){var n;return n=En.aac.isLikelyAacData(e)?function(e){for(var t,n=!1,r=0,a=null,i=null,s=0,o=0;e.length-o>=3;){switch(En.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){n=!0;break}if((s=En.aac.parseId3TagSize(e,o))>e.length){n=!0;break}null===i&&(t=e.subarray(o,o+s),i=En.aac.parseAacTimestamp(t)),o+=s;break;case"audio":if(e.length-o<7){n=!0;break}if((s=En.aac.parseAdtsSize(e,o))>e.length){n=!0;break}null===a&&(t=e.subarray(o,o+s),a=En.aac.parseSampleRate(t)),r++,o+=s;break;default:o++}if(n)return null}if(null===a||null===i)return null;var l=Nn/a;return{audio:[{type:"audio",dts:i,pts:i},{type:"audio",dts:i+1024*r*l,pts:i+1024*r*l}]}}(e):function(e){var t={pid:null,table:null},n={};for(var r in function(e,t){for(var n,r=0,a=Rn;a<e.byteLength;)if(e[r]!==Pn||e[a]!==Pn)r++,a++;else{switch(n=e.subarray(r,a),En.ts.parseType(n,t.pid)){case"pat":t.pid=En.ts.parsePat(n);break;case"pmt":var i=En.ts.parsePmt(n);t.table=t.table||{},Object.keys(i).forEach((function(e){t.table[e]=i[e]}))}r+=Rn,a+=Rn}}(e,t),t.table)if(t.table.hasOwnProperty(r))switch(t.table[r]){case In.H264_STREAM_TYPE:n.video=[],Mn(e,t,n),0===n.video.length&&delete n.video;break;case In.ADTS_STREAM_TYPE:n.audio=[],Dn(e,t,n),0===n.audio.length&&delete n.audio}return n}(e),n&&(n.audio||n.video)?(function(e,t){if(e.audio&&e.audio.length){var n=t;(void 0===n||isNaN(n))&&(n=e.audio[0].dts),e.audio.forEach((function(e){e.dts=Cn(e.dts,n),e.pts=Cn(e.pts,n),e.dtsTime=e.dts/Nn,e.ptsTime=e.pts/Nn}))}if(e.video&&e.video.length){var r=t;if((void 0===r||isNaN(r))&&(r=e.video[0].dts),e.video.forEach((function(e){e.dts=Cn(e.dts,r),e.pts=Cn(e.pts,r),e.dtsTime=e.dts/Nn,e.ptsTime=e.pts/Nn})),e.firstKeyFrame){var a=e.firstKeyFrame;a.dts=Cn(a.dts,r),a.pts=Cn(a.pts,r),a.dtsTime=a.dts/Nn,a.ptsTime=a.pts/Nn}}}(n,t),n):null};class $n{constructor(e,t){this.options=t||{},this.self=e,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Ht.Transmuxer(this.options),function(e,t){t.on("data",(function(t){const n=t.initSegment;t.initSegment={data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength};const r=t.data;t.data=r.buffer,e.postMessage({action:"data",segment:t,byteOffset:r.byteOffset,byteLength:r.byteLength},[t.data])})),t.on("done",(function(t){e.postMessage({action:"done"})})),t.on("gopInfo",(function(t){e.postMessage({action:"gopInfo",gopInfo:t})})),t.on("videoSegmentTimingInfo",(function(t){const n={start:{decode:le.videoTsToSeconds(t.start.dts),presentation:le.videoTsToSeconds(t.start.pts)},end:{decode:le.videoTsToSeconds(t.end.dts),presentation:le.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:le.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=le.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:n})})),t.on("audioSegmentTimingInfo",(function(t){const n={start:{decode:le.videoTsToSeconds(t.start.dts),presentation:le.videoTsToSeconds(t.start.pts)},end:{decode:le.videoTsToSeconds(t.end.dts),presentation:le.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:le.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=le.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:n})})),t.on("id3Frame",(function(t){e.postMessage({action:"id3Frame",id3Frame:t})})),t.on("caption",(function(t){e.postMessage({action:"caption",caption:t})})),t.on("trackinfo",(function(t){e.postMessage({action:"trackinfo",trackInfo:t})})),t.on("audioTimingInfo",(function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:le.videoTsToSeconds(t.start),end:le.videoTsToSeconds(t.end)}})})),t.on("videoTimingInfo",(function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:le.videoTsToSeconds(t.start),end:le.videoTsToSeconds(t.end)}})})),t.on("log",(function(t){e.postMessage({action:"log",log:t})}))}(this.self,this.transmuxer)}pushMp4Captions(e){this.captionParser||(this.captionParser=new hn,this.captionParser.init());const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:n&&n.captions||[],logs:n&&n.logs||[],data:t.buffer},[t.buffer])}probeMp4StartTime({timescales:e,data:t}){const n=xn(e,t);this.self.postMessage({action:"probeMp4StartTime",startTime:n,data:t},[t.buffer])}probeMp4Tracks({data:e}){const t=An(e);this.self.postMessage({action:"probeMp4Tracks",tracks:t,data:e},[e.buffer])}probeTs({data:e,baseStartTime:t}){const n="number"!=typeof t||isNaN(t)?void 0:t*le.ONE_SECOND_IN_TS,r=On(e,n);let a=null;r&&(a={hasVideo:r.video&&2===r.video.length||!1,hasAudio:r.audio&&2===r.audio.length||!1},a.hasVideo&&(a.videoStart=r.video[0].ptsTime),a.hasAudio&&(a.audioStart=r.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:a,data:e},[e.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(e){const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}reset(){this.transmuxer.reset()}setTimestampOffset(e){const t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(le.secondsToVideoTs(t)))}setAudioAppendStart(e){this.transmuxer.setAudioAppendStart(Math.ceil(le.secondsToVideoTs(e.appendStart)))}setRemux(e){this.transmuxer.setRemux(e.remux)}flush(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new $n(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new $n(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}})));var Mo=No(Do);const Oo=e=>{const{transmuxer:t,bytes:n,audioAppendStart:r,gopsToAlignWith:a,remux:i,onData:s,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:u,onVideoSegmentTimingInfo:d,onAudioSegmentTimingInfo:c,onId3:h,onCaptions:p,onDone:m,onEndedTimeline:f,onTransmuxerLog:g,isEndOfTimeline:y}=e,b={buffer:[]};let x=y;if(t.onmessage=n=>{t.currentTransmux===e&&("data"===n.data.action&&((e,t,n)=>{const{type:r,initSegment:a,captions:i,captionStreams:s,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:u}=e.data.segment;t.buffer.push({captions:i,captionStreams:s,metadata:o});const d=e.data.segment.boxes||{data:e.data.segment.data},c={type:r,data:new Uint8Array(d.data,d.data.byteOffset,d.data.byteLength),initSegment:new Uint8Array(a.data,a.byteOffset,a.byteLength)};void 0!==l&&(c.videoFrameDtsTime=l),void 0!==u&&(c.videoFramePtsTime=u),n(c)})(n,b,s),"trackinfo"===n.data.action&&o(n.data.trackInfo),"gopInfo"===n.data.action&&((e,t)=>{t.gopInfo=e.data.gopInfo})(n,b),"audioTimingInfo"===n.data.action&&l(n.data.audioTimingInfo),"videoTimingInfo"===n.data.action&&u(n.data.videoTimingInfo),"videoSegmentTimingInfo"===n.data.action&&d(n.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===n.data.action&&c(n.data.audioSegmentTimingInfo),"id3Frame"===n.data.action&&h([n.data.id3Frame],n.data.id3Frame.dispatchType),"caption"===n.data.action&&p(n.data.caption),"endedtimeline"===n.data.action&&(x=!1,f()),"log"===n.data.action&&g(n.data.log),"transmuxed"===n.data.type&&(x||(t.onmessage=null,(({transmuxedData:e,callback:t})=>{e.buffer=[],t(e)})({transmuxedData:b,callback:m}),$o(t))))},r&&t.postMessage({action:"setAudioAppendStart",appendStart:r}),Array.isArray(a)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:a}),void 0!==i&&t.postMessage({action:"setRemux",remux:i}),n.byteLength){const e=n instanceof ArrayBuffer?n:n.buffer,r=n instanceof ArrayBuffer?0:n.byteOffset;t.postMessage({action:"push",data:e,byteOffset:r,byteLength:n.byteLength},[e])}y&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},$o=e=>{e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"==typeof e.currentTransmux?e.currentTransmux():Oo(e.currentTransmux))},Fo=(e,t)=>{e.postMessage({action:t}),$o(e)};var Lo=e=>{((e,t)=>{if(!t.currentTransmux)return t.currentTransmux=e,void Fo(t,e);t.transmuxQueue.push(Fo.bind(null,t,e))})("reset",e)};const zo=function(e){const t=e.transmuxer,n=e.endAction||e.action,r=e.callback,a=y({},e,{endAction:null,transmuxer:null,callback:null}),i=a=>{a.data.action===n&&(t.removeEventListener("message",i),a.data.data&&(a.data.data=new Uint8Array(a.data.data,e.byteOffset||0,e.byteLength||a.data.data.byteLength),e.data&&(e.data=a.data.data)),r(a.data))};if(t.addEventListener("message",i),e.data){const n=e.data instanceof ArrayBuffer;a.byteOffset=n?0:e.data.byteOffset,a.byteLength=e.data.byteLength;const r=[n?e.data:e.data.buffer];t.postMessage(a,r)}else t.postMessage(a)},Bo=-101,Uo=-102,Wo=e=>{e.forEach((e=>{e.abort()}))},Vo=(e,t)=>t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:Bo,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:Uo,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:2,xhr:t}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:2,xhr:t}:null,jo=(e,t,n)=>(r,a)=>{const i=a.response,s=Vo(r,a);if(s)return n(s,e);if(16!==i.byteLength)return n({status:a.status,message:"Invalid HLS key at URL: "+a.uri,code:2,xhr:a},e);const o=new DataView(i),l=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);for(let e=0;e<t.length;e++)t[e].bytes=l;return n(null,e)},Ho=(e,t)=>{const n=ct(e.map.bytes);if("mp4"!==n){const r=e.map.resolvedUri||e.map.uri;return t({internal:!0,message:`Found unsupported ${n||"unknown"} container for initialization segment at URL: ${r}`,code:2})}zo({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:({tracks:n,data:r})=>(e.map.bytes=r,n.forEach((function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"==typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale))})),t(null))})},Go=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})=>{const p=e.map&&e.map.tracks||{},m=Boolean(p.audio&&p.video);let f=r.bind(null,e,"audio","start");const g=r.bind(null,e,"audio","end");let y=r.bind(null,e,"video","start");const b=r.bind(null,e,"video","end");zo({action:"probeTs",transmuxer:e.transmuxer,data:t,baseStartTime:e.baseStartTime,callback:r=>{e.bytes=t=r.data;const p=r.result;p&&(n(e,{hasAudio:p.hasAudio,hasVideo:p.hasVideo,isMuxed:m}),n=null,p.hasAudio&&!m&&f(p.audioStart),p.hasVideo&&y(p.videoStart),f=null,y=null),(e=>{if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void Oo(e);e.transmuxer.transmuxQueue.push(e)})({bytes:t,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,remux:m,onData:t=>{t.type="combined"===t.type?"video":t.type,d(e,t)},onTrackInfo:t=>{n&&(m&&(t.isMuxed=!0),n(e,t))},onAudioTimingInfo:e=>{f&&void 0!==e.start&&(f(e.start),f=null),g&&void 0!==e.end&&g(e.end)},onVideoTimingInfo:e=>{y&&void 0!==e.start&&(y(e.start),y=null),b&&void 0!==e.end&&b(e.end)},onVideoSegmentTimingInfo:e=>{a(e)},onAudioSegmentTimingInfo:e=>{i(e)},onId3:(t,n)=>{s(e,t,n)},onCaptions:t=>{o(e,[t])},isEndOfTimeline:l,onEndedTimeline:()=>{u()},onTransmuxerLog:h,onDone:t=>{c&&(t.type="combined"===t.type?"video":t.type,c(null,e,t))}})}})},qo=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})=>{let p=new Uint8Array(t);if(function(e){return Ke(e,["moof"]).length>0}(p)){e.isFmp4=!0;const{tracks:a}=e.map,i={isFmp4:!0,hasVideo:!!a.video,hasAudio:!!a.audio};a.audio&&a.audio.codec&&"enca"!==a.audio.codec&&(i.audioCodec=a.audio.codec),a.video&&a.video.codec&&"encv"!==a.video.codec&&(i.videoCodec=a.video.codec),a.video&&a.audio&&(i.isMuxed=!0),n(e,i);const s=t=>{d(e,{data:p,type:i.hasAudio&&!i.isMuxed?"audio":"video"}),t&&t.length&&o(e,t),c(null,e,{})};zo({action:"probeMp4StartTime",timescales:e.map.timescales,data:p,transmuxer:e.transmuxer,callback:({data:n,startTime:o})=>{t=n.buffer,e.bytes=p=n,i.hasAudio&&!i.isMuxed&&r(e,"audio","start",o),i.hasVideo&&r(e,"video","start",o),a.video&&n.byteLength&&e.transmuxer?zo({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:e.transmuxer,data:p,timescales:e.map.timescales,trackIds:[a.video.id],callback:n=>{t=n.data.buffer,e.bytes=p=n.data,n.logs.forEach((function(e){h(bs(e,{stream:"mp4CaptionParser"}))})),s(n.captions)}}):s()}})}else if(e.transmuxer){if(void 0===e.container&&(e.container=ct(p)),"ts"!==e.container&&"aac"!==e.container)return n(e,{hasAudio:!1,hasVideo:!1}),void c(null,e,{});Go({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})}else c(null,e,{})},Xo=function({id:e,key:t,encryptedBytes:n,decryptionWorker:r},a){const i=t=>{if(t.data.source===e){r.removeEventListener("message",i);const e=t.data.decrypted;a(new Uint8Array(e.bytes,e.byteOffset,e.byteLength))}};let s;r.addEventListener("message",i),s=t.bytes.slice?t.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.bytes)),r.postMessage(fo({source:e,encrypted:n,key:s,iv:t.iv}),[n.buffer,s.buffer])},Ko=({xhr:e,xhrOptions:t,decryptionWorker:n,segment:r,abortFn:a,progressFn:i,trackInfoFn:s,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:d,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:p,dataFn:m,doneFn:f,onTransmuxerLog:g})=>{const y=[],b=(({activeXhrs:e,decryptionWorker:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})=>{let p=0,m=!1;return(f,g)=>{if(!m){if(f)return m=!0,Wo(e),c(f,g);if(p+=1,p===e.length){const p=function(){if(g.encryptedBytes)return(({decryptionWorker:e,segment:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})=>{Xo({id:t.requestId,key:t.key,encryptedBytes:t.encryptedBytes,decryptionWorker:e},(e=>{t.bytes=e,qo({segment:t,bytes:t.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})}))})({decryptionWorker:t,segment:g,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h});qo({segment:g,bytes:g.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d,doneFn:c,onTransmuxerLog:h})};if(g.endOfAllRequests=Date.now(),g.map&&g.map.encryptedBytes&&!g.map.bytes)return Xo({decryptionWorker:t,id:g.requestId+"-init",encryptedBytes:g.map.encryptedBytes,key:g.map.key},(t=>{g.map.bytes=t,Ho(g,(t=>{if(t)return Wo(e),c(t,g);p()}))}));p()}}}})({activeXhrs:y,decryptionWorker:n,trackInfoFn:s,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:d,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:p,dataFn:m,doneFn:f,onTransmuxerLog:g});if(r.key&&!r.key.bytes){const n=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&n.push(r.map.key);const a=e(bs(t,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),jo(r,n,b));y.push(a)}if(r.map&&!r.map.bytes){if(r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri)){const n=e(bs(t,{uri:r.map.key.resolvedUri,responseType:"arraybuffer"}),jo(r,[r.map.key],b));y.push(n)}const n=bs(t,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:co(r.map)}),a=(({segment:e,finishProcessingFn:t})=>(n,r)=>{const a=Vo(n,r);if(a)return t(a,e);const i=new Uint8Array(r.response);if(e.map.key)return e.map.encryptedBytes=i,t(null,e);e.map.bytes=i,Ho(e,(function(n){if(n)return n.xhr=r,n.status=r.status,t(n,e);t(null,e)}))})({segment:r,finishProcessingFn:b}),i=e(n,a);y.push(i)}const x=bs(t,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:co(r)}),A=e(x,(({segment:e,finishProcessingFn:t,responseType:n})=>(r,a)=>{const i=Vo(r,a);if(i)return t(i,e);const s="arraybuffer"!==n&&a.responseText?(e=>{const t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer})(a.responseText.substring(e.lastReachedChar||0)):a.response;return e.stats=(e=>({bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}))(a),e.key?e.encryptedBytes=new Uint8Array(s):e.bytes=new Uint8Array(s),t(null,e)})({segment:r,finishProcessingFn:b,responseType:x.responseType}));A.addEventListener("progress",(({segment:e,progressFn:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:d})=>n=>{if(!n.target.aborted)return e.stats=bs(e.stats,(e=>{const t=e.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return n.bytesReceived=e.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n})(n)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(n,e)})({segment:r,progressFn:i,trackInfoFn:s,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:d,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:p,dataFn:m})),y.push(A);const v={};return y.forEach((e=>{e.addEventListener("loadend",(({loadendState:e,abortFn:t})=>n=>{n.target.aborted&&t&&!e.calledAbortFn&&(t(),e.calledAbortFn=!0)})({loadendState:v,abortFn:a}))})),()=>Wo(y)},Zo=ys("CodecUtils"),Yo=(e,t)=>{const n=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&n.AUDIO&&e.mediaGroups.AUDIO[n.AUDIO]},Jo=function(e){const t={};return e.forEach((({mediaType:e,type:n,details:r})=>{t[e]=t[e]||[],t[e].push(D(`${n}${r}`))})),Object.keys(t).forEach((function(e){if(t[e].length>1)return Zo(`multiple ${e} codecs found as attributes: ${t[e].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),void(t[e]=null);t[e]=t[e][0]})),t},Qo=function(e){let t=0;return e.audio&&t++,e.video&&t++,t},el=function(e,t){const n=t.attributes||{},r=Jo(function(e){const t=e.attributes||{};if(t.CODECS)return M(t.CODECS)}(t)||[]);if(Yo(e,t)&&!r.audio&&!((e,t)=>{if(!Yo(e,t))return!0;const n=t.attributes||{},r=e.mediaGroups.AUDIO[n.AUDIO];for(const e in r)if(!r[e].uri&&!r[e].playlists)return!0;return!1})(e,t)){const t=Jo(function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var r in n){var a=n[r];if(a.default&&a.playlists)return M(a.playlists[0].attributes.CODECS)}return null}(e,n.AUDIO)||[]);t.audio&&(r.audio=t.audio)}return r},tl=ys("PlaylistSelector"),nl=function(e){if(!e||!e.playlist)return;const t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})},rl=function(e,t){if(!e)return"";const n=a().getComputedStyle(e);return n?n[t]:""},al=function(e,t){const n=e.slice();e.sort((function(e,r){const a=t(e,r);return 0===a?n.indexOf(e)-n.indexOf(r):a}))},il=function(e,t){let n,r;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||a().Number.MAX_VALUE,t.attributes.BANDWIDTH&&(r=t.attributes.BANDWIDTH),r=r||a().Number.MAX_VALUE,n-r};let sl=function(e,t,n,r,i,s){if(!e)return;const o={bandwidth:t,width:n,height:r,limitRenditionByPlayerDimensions:i};let l=e.playlists;Gs.isAudioOnly(e)&&(l=s.getAudioTrackPlaylists_(),o.audioOnly=!0);let u=l.map((e=>{let t;const n=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,r=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return t=e.attributes&&e.attributes.BANDWIDTH,t=t||a().Number.MAX_VALUE,{bandwidth:t,width:n,height:r,playlist:e}}));al(u,((e,t)=>e.bandwidth-t.bandwidth)),u=u.filter((e=>!Gs.isIncompatible(e.playlist)));let d=u.filter((e=>Gs.isEnabled(e.playlist)));d.length||(d=u.filter((e=>!Gs.isDisabled(e.playlist))));const c=d.filter((e=>e.bandwidth*Co.BANDWIDTH_VARIANCE<t));let h=c[c.length-1];const p=c.filter((e=>e.bandwidth===h.bandwidth))[0];if(!1===i){const e=p||d[0]||u[0];if(e&&e.playlist){let t="sortedPlaylistReps";return p&&(t="bandwidthBestRep"),d[0]&&(t="enabledPlaylistReps"),tl(`choosing ${nl(e)} using ${t} with options`,o),e.playlist}return tl("could not choose a playlist with options",o),null}const m=c.filter((e=>e.width&&e.height));al(m,((e,t)=>e.width-t.width));const f=m.filter((e=>e.width===n&&e.height===r));h=f[f.length-1];const g=f.filter((e=>e.bandwidth===h.bandwidth))[0];let y,b,x,A;if(g||(y=m.filter((e=>e.width>n||e.height>r)),b=y.filter((e=>e.width===y[0].width&&e.height===y[0].height)),h=b[b.length-1],x=b.filter((e=>e.bandwidth===h.bandwidth))[0]),s.leastPixelDiffSelector){const e=m.map((e=>(e.pixelDiff=Math.abs(e.width-n)+Math.abs(e.height-r),e)));al(e,((e,t)=>e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff)),A=e[0]}const v=A||x||g||p||d[0]||u[0];if(v&&v.playlist){let e="sortedPlaylistReps";return A?e="leastPixelDiffRep":x?e="resolutionPlusOneRep":g?e="resolutionBestRep":p?e="bandwidthBestRep":d[0]&&(e="enabledPlaylistReps"),tl(`choosing ${nl(v)} using ${e} with options`,o),v.playlist}return tl("could not choose a playlist with options",o),null};const ol=function(){const e=this.useDevicePixelRatio&&a().devicePixelRatio||1;return sl(this.playlists.main,this.systemBandwidth,parseInt(rl(this.tech_.el(),"width"),10)*e,parseInt(rl(this.tech_.el(),"height"),10)*e,this.limitRenditionByPlayerDimensions,this.playlistController_)},ll=function(e,t,n){let r,a;if(n&&n.cues)for(r=n.cues.length;r--;)a=n.cues[r],a.startTime>=e&&a.endTime<=t&&n.removeCue(a)},ul=e=>"number"==typeof e&&isFinite(e),dl=1/60,cl=e=>{const{startOfSegment:t,duration:n,segment:r,part:a,playlist:{mediaSequence:i,id:s,segments:o=[]},mediaIndex:l,partIndex:u,timeline:d}=e,c=o.length-1;let h="mediaIndex/partIndex increment";e.getMediaInfoForTime?h=`getMediaInfoForTime (${e.getMediaInfoForTime})`:e.isSyncRequest&&(h="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(h+=` with independent ${e.independent}`);const p="number"==typeof u,m=e.segment.uri?"segment":"pre-segment",f=p?Ps({preloadSegment:r})-1:0;return`${m} [${i+l}/${i+c}]`+(p?` part [${u}/${f}]`:"")+` segment start/end [${r.start} => ${r.end}]`+(p?` part start/end [${a.start} => ${a.end}]`:"")+` startOfSegment [${t}]`+` duration [${n}]`+` timeline [${d}]`+` selected by [${h}]`+` playlist [${s}]`},hl=e=>`${e}TimingInfo`,pl=({timelineChangeController:e,currentTimeline:t,segmentTimeline:n,loaderType:r,audioDisabled:a})=>{if(t===n)return!1;if("audio"===r){const t=e.lastTimelineChange({type:"main"});return!t||t.to!==n}if("main"===r&&a){const t=e.pendingTimelineChange({type:"audio"});return!t||t.to!==n}return!1},ml=({segmentDuration:e,maxDuration:t})=>!!e&&Math.round(e)>t+As;class fl extends ds.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=ds.browser.IE_VERSION>=11,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",(()=>{this.isEndOfStream_()||(this.ended_=!1)})),this.fetchAtBuffer_=!1,this.logger_=ys(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(e){e!==this.state_&&(this.logger_(`${this.state_} -> ${e}`),this.state_=e,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",(()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})),"main"===this.loaderType_&&this.timelineChangeController_.on("pendingtimelinechange",(()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})),"audio"===this.loaderType_&&this.timelineChangeController_.on("timelinechange",(()=>{this.hasEnoughInfoToLoad_()&&this.processLoadQueue_(),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}))}createTransmuxer_(){return(e=>{const t=new Mo;t.currentTransmux=null,t.transmuxQueue=[];const n=t.terminate;return t.terminate=()=>(t.currentTransmux=null,t.transmuxQueue.length=0,n.call(t)),t.postMessage({action:"init",options:e}),t})({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&a().clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,a().clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)}error(e){return void 0!==e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&Lo(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return xs();if("main"===this.loaderType_){const{hasAudio:t,hasVideo:n,isMuxed:r}=e;if(n&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=go(e);let r=this.initSegments_[n];return t&&!r&&e.bytes&&(this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const n=yo(e);let r=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[n]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const a={resolvedUri:(r||e).resolvedUri};return r&&(a.bytes=r.bytes),a}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;const n=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));let a=null;if(n&&(n.id?a=n.id:n.uri&&(a=n.uri)),this.logger_(`playlist update [${a} => ${e.id||e.uri}]`),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri)return null!==this.mediaIndex&&(e.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,void this.trigger("playlistupdate");const i=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${i}]`),null!==this.mediaIndex)if(this.mediaIndex-=i,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const e=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!e.parts||!e.parts.length||!e.parts[this.partIndex])){const e=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=e}}r&&(r.mediaIndex-=i,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(a().clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return null===this.checkBufferTimeout_}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.resyncLoader()}resyncLoader(){this.transmuxer_&&Lo(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=(()=>{}),r=!1){if(t===1/0&&(t=this.duration_()),t<=e)return void this.logger_("skipping remove because end ${end} is <= start ${start}");if(!this.sourceUpdater_||!this.getMediaInfo_())return void this.logger_("skipping remove because no source updater or starting media info");let a=1;const i=()=>{a--,0===a&&n()};!r&&this.audioDisabled_||(a++,this.sourceUpdater_.removeAudio(e,t,i)),(r||"main"===this.loaderType_)&&(this.gopBuffer_=((e,t,n,r)=>{const a=Math.ceil((t-r)*ht.ONE_SECOND_IN_TS),i=Math.ceil((n-r)*ht.ONE_SECOND_IN_TS),s=e.slice();let o=e.length;for(;o--&&!(e[o].pts<=i););if(-1===o)return s;let l=o+1;for(;l--&&!(e[l].pts<=a););return l=Math.max(l,0),s.splice(l,o-l+1),s})(this.gopBuffer_,e,t,this.timeMapping_),a++,this.sourceUpdater_.removeVideo(e,t,i));for(const n in this.inbandTextTracks_)ll(e,t,this.inbandTextTracks_[n]);ll(e,t,this.segmentMetadataTrack_),i()}monitorBuffer_(){this.checkBufferTimeout_&&a().clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=a().setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&a().clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=a().setTimeout(this.monitorBufferTick_.bind(this),500)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();e&&("number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const r="number"==typeof e&&t.segments[e],a=e+1===t.segments.length,i=!r||!r.parts||n+1===r.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&a&&i}chooseNextRequest_(){const e=this.buffered_(),t=Is(e)||0,n=Cs(e,this.currentTime_()),r=!this.hasPlayed_()&&n>=1,a=n>=this.goalBufferLength_(),i=this.playlist_.segments;if(!i.length||r||a)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());const s={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(s.isSyncRequest)s.mediaIndex=function(e,t,n){t=t||[];const r=[];let a=0;for(let i=0;i<t.length;i++){const s=t[i];if(e===s.timeline&&(r.push(i),a+=s.duration,a>n))return i}return 0===r.length?0:r[r.length-1]}(this.currentTimeline_,i,t);else if(null!==this.mediaIndex){const e=i[this.mediaIndex],n="number"==typeof this.partIndex?this.partIndex:-1;s.startOfSegment=e.end?e.end:t,e.parts&&e.parts[n+1]?(s.mediaIndex=this.mediaIndex,s.partIndex=n+1):s.mediaIndex=this.mediaIndex+1}else{const{segmentIndex:e,startTime:n,partIndex:r}=Gs.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?t:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});s.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${t}`:`currentTime ${this.currentTime_()}`,s.mediaIndex=e,s.startOfSegment=n,s.partIndex=r}const o=i[s.mediaIndex];let l=o&&"number"==typeof s.partIndex&&o.parts&&o.parts[s.partIndex];if(!o||"number"==typeof s.partIndex&&!l)return null;if("number"!=typeof s.partIndex&&o.parts&&(s.partIndex=0,l=o.parts[0]),!n&&l&&!l.independent)if(0===s.partIndex){const e=i[s.mediaIndex-1],t=e.parts&&e.parts.length&&e.parts[e.parts.length-1];t&&t.independent&&(s.mediaIndex-=1,s.partIndex=e.parts.length-1,s.independent="previous segment")}else o.parts[s.partIndex-1].independent&&(s.partIndex-=1,s.independent="previous part");const u=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return s.mediaIndex>=i.length-1&&u&&!this.seeking_()?null:this.generateSegmentInfo_(s)}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:r,startOfSegment:a,isSyncRequest:i,partIndex:s,forceTimestampOffset:o,getMediaInfoForTime:l}=e,u=n.segments[r],d="number"==typeof s&&u.parts[s],c={requestId:"segment-loader-"+Math.random(),uri:d&&d.resolvedUri||u.resolvedUri,mediaIndex:r,partIndex:d?s:null,isSyncRequest:i,startOfSegment:a,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:u.timeline,duration:d&&d.duration||u.duration,segment:u,part:d,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},h=void 0!==o?o:this.isPendingTimestampOffset_;c.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:u.timeline,currentTimeline:this.currentTimeline_,startOfSegment:a,buffered:this.buffered_(),overrideCheck:h});const p=Is(this.sourceUpdater_.audioBuffered());return"number"==typeof p&&(c.audioAppendStart=p-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(c.gopsToAlignWith=((e,t,n)=>{if(null==t||!e.length)return[];const r=Math.ceil((t-n+3)*ht.ONE_SECOND_IN_TS);let a;for(a=0;a<e.length&&!(e[a].pts>r);a++);return e.slice(a)})(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),c}timestampOffsetForSegment_(e){return(({segmentTimeline:e,currentTimeline:t,startOfSegment:n,buffered:r,overrideCheck:a})=>a||e!==t?e<t?n:r.length?r.end(r.length-1):n:null)(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,a=Gs.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),i=function(e,t,n=1){return((e.length?e.end(e.length-1):0)-t)/n}(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(a<=i)return;const s=function(e){const{main:t,currentTime:n,bandwidth:r,duration:a,segmentDuration:i,timeUntilRebuffer:s,currentTimeline:o,syncController:l}=e,u=t.playlists.filter((e=>!Gs.isIncompatible(e)));let d=u.filter(Gs.isEnabled);d.length||(d=u.filter((e=>!Gs.isDisabled(e))));const c=d.filter(Gs.hasAttribute.bind(null,"BANDWIDTH")).map((e=>{const t=l.getSyncPoint(e,a,o,n)?1:2;return{playlist:e,rebufferingImpact:Gs.estimateSegmentRequestTime(i,r,e)*t-s}})),h=c.filter((e=>e.rebufferingImpact<=0));return al(h,((e,t)=>il(t.playlist,e.playlist))),h.length?h[0]:(al(c,((e,t)=>e.rebufferingImpact-t.rebufferingImpact)),c[0]||null)}({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:i,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!s)return;const o=a-i-s.rebufferingImpact;let l=.5;i<=As&&(l=1),!s.playlist||s.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=s.playlist.attributes.BANDWIDTH*Co.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${cl(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")}handleTrackInfo_(e,t){this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;const n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++){const i=n[a];if(i!==r[a])return!1;if(e[i]!==t[i])return!1}return!0}(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_()))}handleTimingInfo_(e,t,n,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const a=this.pendingSegment_,i=hl(t);a[i]=a[i]||{},a[i][n]=r,this.logger_(`timinginfo: ${t} - ${n} - ${r}`),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(0===t.length)return void this.logger_("SegmentLoader received no captions from a caption event");if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));const n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r={};t.forEach((e=>{r[e.stream]=r[e.stream]||{startTime:1/0,captions:[],endTime:0};const t=r[e.stream];t.startTime=Math.min(t.startTime,e.startTime+n),t.endTime=Math.max(t.endTime,e.endTime+n),t.captions.push(e)})),Object.keys(r).forEach((e=>{const{startTime:t,endTime:i,captions:s}=r[e],o=this.inbandTextTracks_;this.logger_(`adding cues from ${t} -> ${i} for ${e}`),function(e,t,n){if(!e[n]){t.trigger({type:"usage",name:"vhs-608"});let r=n;/^cc708_/.test(n)&&(r="SERVICE"+n.split("_")[1]);const a=t.textTracks().getTrackById(r);if(a)e[n]=a;else{let a=n,i=n,s=!1;const o=(t.options_.vhs&&t.options_.vhs.captionServices||{})[r];o&&(a=o.label,i=o.language,s=o.default),e[n]=t.addRemoteTextTrack({kind:"captions",id:r,default:s,label:a,language:i},!1).track}}}(o,this.vhs_.tech_,e),ll(t,i,o[e]),function({inbandTextTracks:e,captionArray:t,timestampOffset:n}){if(!t)return;const r=a().WebKitDataCue||a().VTTCue;t.forEach((t=>{const a=t.stream;e[a].addCue(new r(t.startTime+n,t.endTime+n,t.text))}))}({captionArray:s,inbandTextTracks:o,timestampOffset:n})})),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n));const r=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();((e,t,n)=>{e.metadataTrack_||(e.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=t)})(this.inbandTextTracks_,n,this.vhs_.tech_),(({inbandTextTracks:e,metadataArray:t,timestampOffset:n,videoDuration:r})=>{if(!t)return;const i=a().WebKitDataCue||a().VTTCue,s=e.metadataTrack_;if(!s)return;if(t.forEach((e=>{const t=e.cueTime+n;!("number"!=typeof t||a().isNaN(t)||t<0)&&t<1/0&&e.frames.forEach((e=>{const n=new i(t,t,e.value||e.url||e.data||"");n.frame=e,n.value=e,function(e){Object.defineProperties(e.frame,{id:{get:()=>(ds.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key)},value:{get:()=>(ds.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data)},privateData:{get:()=>(ds.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data)}})}(n),s.addCue(n)}))})),!s.cues||!s.cues.length)return;const o=s.cues,l=[];for(let e=0;e<o.length;e++)o[e]&&l.push(o[e]);const u=l.reduce(((e,t)=>{const n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e}),{}),d=Object.keys(u).sort(((e,t)=>Number(e)-Number(t)));d.forEach(((e,t)=>{const n=u[e],a=Number(d[t+1])||r;n.forEach((e=>{e.endTime=a}))}))})({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:r,videoDuration:this.duration_()})}processMetadataQueue_(){this.metadataQueue_.id3.forEach((e=>e())),this.metadataQueue_.caption.forEach((e=>e())),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach((e=>e()))}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach((e=>e()))}hasEnoughInfoToLoad_(){if("audio"!==this.loaderType_)return!0;const e=this.pendingSegment_;return!(!e||this.getCurrentMediaInfo_()&&pl({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:r,isMuxed:a}=t;return!(r&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!a&&!e.audioTimingInfo||pl({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return void this.callQueue_.push(this.handleData_.bind(this,e,t));const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[hl(t.type)].start;else{const e=this.getCurrentMediaInfo_(),t="main"===this.loaderType_&&e&&e.hasVideo;let r;t&&(r=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:t,firstVideoFrameTimeForData:r,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:"main"===this.loaderType_});const e=this.chooseNextRequest_();if(e.mediaIndex!==n.mediaIndex||e.partIndex!==n.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){"main"!==this.loaderType_||"number"!=typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:r}){if(n){const e=go(n);if(this.activeInitSegmentId_===e)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=e}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},r){const i=this.sourceUpdater_.audioBuffered(),s=this.sourceUpdater_.videoBuffered();i.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+_s(i).join(", ")),s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+_s(s).join(", "));const o=i.length?i.start(0):0,l=i.length?i.end(i.length-1):0,u=s.length?s.start(0):0,d=s.length?s.end(s.length-1):0;if(l-o<=1&&d-u<=1)return this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${_s(i).join(", ")}, video buffer: ${_s(s).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const c=this.currentTime_()-1;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${c}`),this.remove(0,c,(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=a().setTimeout((()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()}),1e3)}),!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},r){r&&(22!==r.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error(`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n}))}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:r,bytes:a}){if(!a){const e=[r];let t=r.byteLength;n&&(e.unshift(n),t+=n.byteLength),a=(e=>{let t,n=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach((e=>{t.set(e,n),n+=e.byteLength}))),t})({bytes:t,segments:e})}this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:a},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:a}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,a=`${e}TimingInfo`;r[a]||(r[a]={}),r[a].transmuxerPrependedSeconds=n.prependedContentDuration||0,r[a].transmuxedPresentationStart=n.start.presentation,r[a].transmuxedDecodeStart=n.start.decode,r[a].transmuxedPresentationEnd=n.end.presentation,r[a].transmuxedDecodeEnd=n.end.decode,r[a].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:r}=t;if(!r||!r.byteLength)return;if("audio"===n&&this.audioDisabled_)return;const a=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:a,data:r})}loadSegment_(e){this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(e):this.loadQueue_.push((()=>{const t=y({},e,{forceTimestampOffset:!0});y(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)}))}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=null!==this.mediaIndex,a=e.timeline!==this.currentTimeline_&&e.timeline>0,i=n||r&&a;this.logger_(`Requesting ${cl(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=Ko({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:i,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:t,level:n,stream:r})=>{this.logger_(`${cl(e)} logged from transmuxer stream ${r} as a ${n}: ${t}`)}})}trimBackBuffer_(e){const t=((e,t,n)=>{let r=t-Co.BACK_BUFFER_LENGTH;e.length&&(r=Math.max(r,e.start(0)));const a=t-n;return Math.min(a,r)})(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,r={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},a=e.playlist.segments[e.mediaIndex-1];if(a&&a.timeline===t.timeline&&(a.videoTimingInfo?r.baseStartTime=a.videoTimingInfo.transmuxedDecodeEnd:a.audioTimingInfo&&(r.baseStartTime=a.audioTimingInfo.transmuxedDecodeEnd)),t.key){const n=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);r.key=this.segmentKey(t.key),r.key.iv=n}return t.map&&(r.map=this.initSegmentForMap(t.map)),r}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){this.pendingSegment_.byteLength=t.bytesReceived,e<dl?this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record 0.016666666666666666`):(this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime)}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length)return void this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return;if(t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===Uo)return;return this.pause(),e.code===Bo?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=((e,t,n)=>{if(!t.length)return e;if(n)return t.slice();const r=t[0].pts;let a=0;for(;a<e.length&&!(e[a].pts>=r);a++);return e.slice(0,a).concat(t)})(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){"number"==typeof e.start&&"number"==typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:a,useVideoTimingInfo:i,videoTimingInfo:s,audioTimingInfo:o}){if(void 0!==e)return e;if(!i)return o.start;const l=t.segments[n-1];return 0!==n&&l&&void 0!==l.start&&l.end===r+a?s.start:r}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),void this.trigger("error");const{hasAudio:n,hasVideo:r,isMuxed:a}=t,i="main"===this.loaderType_&&r,s=!this.audioDisabled_&&n&&!a;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!=typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);i&&e.waitingOnAppends++,s&&e.waitingOnAppends++,i&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),s&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=((e,t,n)=>"main"===e&&t&&n?n.hasAudio||n.hasVideo?t.hasVideo&&!n.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&n.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null)(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0)}updateSourceBufferTimestampOffset_(e){if(null===e.timestampOffset||"number"!=typeof e.timingInfo.start||e.changedTimestampOffset||"main"!==this.loaderType_)return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&"number"==typeof e.transmuxedDecodeStart?e.transmuxedDecodeStart:t&&"number"==typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),n="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;n&&(e.timingInfo.end="number"==typeof n.end?n.end:n.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());const e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});const t=((e,t)=>{if("hls"!==t)return null;const n=(e=>{let t=0;return["video","audio"].forEach((function(n){const r=e[`${n}TimingInfo`];if(!r)return;const{start:i,end:s}=r;let o;"bigint"==typeof i||"bigint"==typeof s?o=a().BigInt(s)-a().BigInt(i):"number"==typeof i&&"number"==typeof s&&(o=s-i),void 0!==o&&o>t&&(t=o)})),"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),t})({audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo});if(!n)return null;const r=e.playlist.targetDuration,i=ml({segmentDuration:n,maxDuration:2*r}),s=ml({segmentDuration:n,maxDuration:r}),o=`Segment with index ${e.mediaIndex} from playlist ${e.playlist.id} has a duration of ${n} when the reported duration is ${e.duration} and the target duration is ${r}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return i||s?{severity:i?"warn":"info",message:o}:null})(e,this.sourceType_);if(t&&("warn"===t.severity?ds.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_))return void this.logger_(`Throwing away un-appended sync request ${cl(e)}`);this.logger_(`Appended ${cl(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,r=e.part,i=n.end&&this.currentTime_()-n.end>3*e.playlist.targetDuration,s=r&&r.end&&this.currentTime_()-r.end>3*e.playlist.partTargetDuration;if(i||s)return this.logger_(`bad ${i?"segment":"part"} ${cl(e)}`),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<dl)return void this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record 0.016666666666666666`);const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,r=t.end;if(!ul(n)||!ul(r))return;ll(n,r,this.segmentMetadataTrack_);const i=a().WebKitDataCue||a().VTTCue,s={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:r},o=new i(n,r,JSON.stringify(s));o.value=s,this.segmentMetadataTrack_.addCue(o)}}function gl(){}const yl=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toUpperCase()))},bl=["video","audio"],xl=(e,t)=>{const n=t[`${e}Buffer`];return n&&n.updating||t.queuePending[e]},Al=(e,t)=>{if(0===t.queue.length)return;let n=0,r=t.queue[n];if("mediaSource"!==r.type){if("mediaSource"!==e&&t.ready()&&"closed"!==t.mediaSource.readyState&&!xl(e,t)){if(r.type!==e){if(n=((e,t)=>{for(let n=0;n<t.length;n++){const r=t[n];if("mediaSource"===r.type)return null;if(r.type===e)return n}return null})(e,t.queue),null===n)return;r=t.queue[n]}return t.queue.splice(n,1),t.queuePending[e]=r,r.action(e,t),r.doneFn?void 0:(t.queuePending[e]=null,void Al(e,t))}}else t.updating()||"closed"===t.mediaSource.readyState||(t.queue.shift(),r.action(t),r.doneFn&&r.doneFn(),Al("audio",t),Al("video",t))},vl=(e,t)=>{const n=t[`${e}Buffer`],r=yl(e);n&&(n.removeEventListener("updateend",t[`on${r}UpdateEnd_`]),n.removeEventListener("error",t[`on${r}Error_`]),t.codecs[e]=null,t[`${e}Buffer`]=null)},wl=(e,t)=>e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t),kl=(e,t,n)=>(r,a)=>{const i=a[`${r}Buffer`];if(wl(a.mediaSource,i)){a.logger_(`Appending segment ${t.mediaIndex}'s ${e.length} bytes to ${r}Buffer`);try{i.appendBuffer(e)}catch(e){a.logger_(`Error with code ${e.code} `+(22===e.code?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${t.mediaIndex} to ${r}Buffer`),a.queuePending[r]=null,n(e)}}},Sl=(e,t)=>(n,r)=>{const a=r[`${n}Buffer`];if(wl(r.mediaSource,a)){r.logger_(`Removing ${e} to ${t} from ${n}Buffer`);try{a.remove(e,t)}catch(a){r.logger_(`Remove ${e} to ${t} from ${n}Buffer failed`)}}},Tl=e=>(t,n)=>{const r=n[`${t}Buffer`];wl(n.mediaSource,r)&&(n.logger_(`Setting ${t}timestampOffset to ${e}`),r.timestampOffset=e)},_l=e=>(t,n)=>{e()},Il=e=>t=>{if("open"===t.mediaSource.readyState){t.logger_(`Calling mediaSource endOfStream(${e||""})`);try{t.mediaSource.endOfStream(e)}catch(e){ds.log.warn("Failed to call media source endOfStream",e)}}},Cl=e=>t=>{t.logger_(`Setting mediaSource duration to ${e}`);try{t.mediaSource.duration=e}catch(e){ds.log.warn("Failed to set media source duration",e)}},El=(e,t)=>n=>{const r=yl(e),a=$(t);n.logger_(`Adding ${e}Buffer with codec ${t} to mediaSource`);const i=n.mediaSource.addSourceBuffer(a);i.addEventListener("updateend",n[`on${r}UpdateEnd_`]),i.addEventListener("error",n[`on${r}Error_`]),n.codecs[e]=t,n[`${e}Buffer`]=i},Nl=e=>t=>{const n=t[`${e}Buffer`];if(vl(e,t),wl(t.mediaSource,n)){t.logger_(`Removing ${e}Buffer with codec ${t.codecs[e]} from mediaSource`);try{t.mediaSource.removeSourceBuffer(n)}catch(t){ds.log.warn(`Failed to removeSourceBuffer ${e}Buffer`,t)}}},Rl=e=>(t,n)=>{const r=n[`${t}Buffer`],a=$(e);wl(n.mediaSource,r)&&n.codecs[t]!==e&&(n.logger_(`changing ${t}Buffer codec from ${n.codecs[t]} to ${e}`),r.changeType(a),n.codecs[t]=e)},Pl=({type:e,sourceUpdater:t,action:n,doneFn:r,name:a})=>{t.queue.push({type:e,action:n,doneFn:r,name:a}),Al(e,t)},Dl=(e,t)=>n=>{if(t.queuePending[e]){const n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t[`${e}Error_`])}Al(e,t)};class Ml extends ds.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>Al("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=ys("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Dl("video",this),this.onAudioUpdateEnd_=Dl("audio",this),this.onVideoError_=e=>{this.videoError_=e},this.onAudioError_=e=>{this.audioError_=e},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Pl({type:"mediaSource",sourceUpdater:this,action:El(e,t),name:"addSourceBuffer"})}abort(e){Pl({type:e,sourceUpdater:this,action:(e,t)=>{if("open"!==t.mediaSource.readyState)return;const n=t[`${e}Buffer`];if(wl(t.mediaSource,n)){t.logger_(`calling abort on ${e}Buffer`);try{n.abort()}catch(t){ds.log.warn(`Failed to abort on ${e}Buffer`,t)}}},name:"abort"})}removeSourceBuffer(e){this.canRemoveSourceBuffer()?Pl({type:"mediaSource",sourceUpdater:this,action:Nl(e),name:"removeSourceBuffer"}):ds.log.error("removeSourceBuffer is not supported!")}canRemoveSourceBuffer(){return!ds.browser.IE_VERSION&&!ds.browser.IS_FIREFOX&&a().MediaSource&&a().MediaSource.prototype&&"function"==typeof a().MediaSource.prototype.removeSourceBuffer}static canChangeType(){return a().SourceBuffer&&a().SourceBuffer.prototype&&"function"==typeof a().SourceBuffer.prototype.changeType}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){this.canChangeType()?Pl({type:e,sourceUpdater:this,action:Rl(t),name:"changeType"}):ds.log.error("changeType is not supported!")}addOrChangeSourceBuffers(e){if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach((t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)}))}appendBuffer(e,t){const{segmentInfo:n,type:r,bytes:a}=e;if(this.processedAppend_=!0,"audio"===r&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_(`delayed audio append of ${a.length} until video append`);if(Pl({type:r,sourceUpdater:this,action:kl(a,n||{mediaIndex:-1},t),doneFn:t,name:"appendBuffer"}),"video"===r){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const e=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${e.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,e.forEach((e=>{this.appendBuffer.apply(this,e)}))}}audioBuffered(){return wl(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:xs()}videoBuffered(){return wl(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:xs()}buffered(){const e=wl(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=wl(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():function(e,t){let n=null,r=null,a=0;const i=[],s=[];if(!(e&&e.length&&t&&t.length))return xs();let o=e.length;for(;o--;)i.push({time:e.start(o),type:"start"}),i.push({time:e.end(o),type:"end"});for(o=t.length;o--;)i.push({time:t.start(o),type:"start"}),i.push({time:t.end(o),type:"end"});for(i.sort((function(e,t){return e.time-t.time})),o=0;o<i.length;o++)"start"===i[o].type?(a++,2===a&&(n=i[o].time)):"end"===i[o].type&&(a--,1===a&&(r=i[o].time)),null!==n&&null!==r&&(s.push([n,r]),n=null,r=null);return xs(s)}(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=gl){Pl({type:"mediaSource",sourceUpdater:this,action:Cl(e),name:"duration",doneFn:t})}endOfStream(e=null,t=gl){"string"!=typeof e&&(e=void 0),Pl({type:"mediaSource",sourceUpdater:this,action:Il(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=gl){this.audioBuffered().length&&0!==this.audioBuffered().end(0)?Pl({type:"audio",sourceUpdater:this,action:Sl(e,t),doneFn:n,name:"remove"}):n()}removeVideo(e,t,n=gl){this.videoBuffered().length&&0!==this.videoBuffered().end(0)?Pl({type:"video",sourceUpdater:this,action:Sl(e,t),doneFn:n,name:"remove"}):n()}updating(){return!(!xl("audio",this)&&!xl("video",this))}audioTimestampOffset(e){return void 0!==e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Pl({type:"audio",sourceUpdater:this,action:Tl(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return void 0!==e&&this.videoBuffer&&this.videoTimestampOffset!==e&&(Pl({type:"video",sourceUpdater:this,action:Tl(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Pl({type:"audio",sourceUpdater:this,action:_l(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Pl({type:"video",sourceUpdater:this,action:_l(e),name:"callback"})}dispose(){this.trigger("dispose"),bl.forEach((e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`]((()=>vl(e,this)))})),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Ol=e=>decodeURIComponent(escape(String.fromCharCode.apply(null,e))),$l=new Uint8Array("\n\n".split("").map((e=>e.charCodeAt(0))));class Fl extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class Ll extends fl{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.loaderType_="subtitle",this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}createTransmuxer_(){return null}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return xs();const e=this.subtitlesTrack_.cues;return xs([[e[0].startTime,e[e.length-1].startTime]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=go(e);let r=this.initSegments_[n];if(t&&!r&&e.bytes){const t=$l.byteLength+e.bytes.byteLength,a=new Uint8Array(t);a.set(e.bytes),a.set($l,e.bytes.byteLength),this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return void 0===e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_}remove(e,t){ll(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline)){const e=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};return this.syncController_.one("timestampoffset",e),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_)return void(this.state="READY");if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===Bo&&this.handleTimeout_(),e.code===Uo?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const i=r.segment;if(i.map&&(i.map.bytes=t.map.bytes),r.bytes=t.bytes,"function"!=typeof a().WebVTT&&"function"==typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then((()=>this.segmentRequestFinished_(e,t,n)),(()=>this.stopForError({message:"Error loading vtt.js"})));i.requested=!0;try{this.parseVTTCues_(r)}catch(e){return void this.stopForError({message:e.message})}if(this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=i.duration,r.cues.forEach((e=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new(a().VTTCue)(e.startTime,e.endTime,e.text):e)})),function(e){const t=e.cues;if(t)for(let n=0;n<t.length;n++){const r=[];let a=0;for(let e=0;e<t.length;e++)t[n].startTime===t[e].startTime&&t[n].endTime===t[e].endTime&&t[n].text===t[e].text&&(a++,a>1&&r.push(t[e]));r.length&&r.forEach((t=>e.removeCue(t)))}}(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(){}updateTimingInfoEnd_(){}parseVTTCues_(e){let t,n=!1;if("function"!=typeof a().WebVTT)throw new Fl;"function"==typeof a().TextDecoder?t=new(a().TextDecoder)("utf8"):(t=a().WebVTT.StringDecoder(),n=!0);const r=new(a().WebVTT.Parser)(a(),a().vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=t=>{e.timestampmap=t},r.onparsingerror=e=>{ds.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){let t=e.segment.map.bytes;n&&(t=Ol(t)),r.parse(t)}let i=e.bytes;n&&(i=Ol(i)),r.parse(i),r.flush()}updateTimeMapping_(e,t,n){const r=e.segment;if(!t)return;if(!e.cues.length)return void(r.empty=!0);const a=e.timestampmap,i=a.MPEGTS/ht.ONE_SECOND_IN_TS-a.LOCAL+t.mapping;if(e.cues.forEach((e=>{e.startTime+=i,e.endTime+=i})),!n.syncInfo){const t=e.cues[0].startTime,a=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(t,a-r.duration)}}}}const zl=function(e,t){const n=e.cues;for(let e=0;e<n.length;e++){const r=n[e];if(t>=r.adStartTime&&t<=r.adEndTime)return r}return null},Bl=[{name:"VOD",run:(e,t,n,r,a)=>n!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"ProgramDateTime",run:(e,t,n,r,a)=>{if(!Object.keys(e.timelineToDatetimeMappings).length)return null;let i=null,s=null;const o=Ns(t);a=a||0;for(let n=0;n<o.length;n++){const r=o[t.endList||0===a?n:o.length-(n+1)],l=r.segment,u=e.timelineToDatetimeMappings[l.timeline];if(!u||!l.dateTimeObject)continue;let d=l.dateTimeObject.getTime()/1e3+u;if(l.parts&&"number"==typeof r.partIndex)for(let e=0;e<r.partIndex;e++)d+=l.parts[e].duration;const c=Math.abs(a-d);if(null!==s&&(0===c||s<c))break;s=c,i={time:d,segmentIndex:r.segmentIndex,partIndex:r.partIndex}}return i}},{name:"Segment",run:(e,t,n,r,a)=>{let i=null,s=null;a=a||0;const o=Ns(t);for(let e=0;e<o.length;e++){const n=o[t.endList||0===a?e:o.length-(e+1)],l=n.segment,u=n.part&&n.part.start||l&&l.start;if(l.timeline===r&&void 0!==u){const e=Math.abs(a-u);if(null!==s&&s<e)break;(!i||null===s||s>=e)&&(s=e,i={time:u,segmentIndex:n.segmentIndex,partIndex:n.partIndex})}}return i}},{name:"Discontinuity",run:(e,t,n,r,a)=>{let i=null;if(a=a||0,t.discontinuityStarts&&t.discontinuityStarts.length){let n=null;for(let r=0;r<t.discontinuityStarts.length;r++){const s=t.discontinuityStarts[r],o=t.discontinuitySequence+r+1,l=e.discontinuities[o];if(l){const e=Math.abs(a-l.time);if(null!==n&&n<e)break;(!i||null===n||n>=e)&&(n=e,i={time:l.time,segmentIndex:s,partIndex:null})}}}return i}},{name:"Playlist",run:(e,t,n,r,a)=>t.syncInfo?{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}:null}];class Ul extends ds.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={},this.logger_=ys("SyncController")}getSyncPoint(e,t,n,r){const a=this.runStrategies_(e,t,n,r);return a.length?this.selectSyncPoint_(a,{key:"time",value:r}):null}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+$s({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,r){const a=[];for(let i=0;i<Bl.length;i++){const s=Bl[i],o=s.run(this,e,t,n,r);o&&(o.strategy=s.name,a.push({strategy:s.name,syncPoint:o}))}return a}selectSyncPoint_(e,t){let n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),a=e[0].strategy;for(let i=1;i<e.length;i++){const s=Math.abs(e[i].syncPoint[t.key]-t.value);s<r&&(r=s,n=e[i].syncPoint,a=e[i].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${a}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+("number"==typeof n.partIndex?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>86400)ds.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);else for(let r=n-1;r>=0;r--){const n=e.segments[r];if(n&&void 0!==n.start){t.syncInfo={mediaSequence:e.mediaSequence+r,time:n.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const a=r.dateTimeObject;r.discontinuity&&t&&a&&(this.timelineToDatetimeMappings[r.timeline]=-a.getTime()/1e3)}timestampOffsetForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].time}mappingForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const r=e.segment,a=e.part;let i,s,o=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${o.time}] [mapping: ${o.mapping}]`)),i=e.startOfSegment,s=t.end+o.mapping;else{if(!o)return!1;i=t.start+o.mapping,s=t.end+o.mapping}return a&&(a.start=i,a.end=s),(!r.start||i<r.start)&&(r.start=i),r.end=s,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const a=t.discontinuityStarts[r],i=t.discontinuitySequence+r+1,s=a-e.mediaIndex,o=Math.abs(s);if(!this.discontinuities[i]||this.discontinuities[i].accuracy>o){let r;r=s<0?n.start-$s({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:a}):n.end+$s({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:a}),this.discontinuities[i]={time:r,accuracy:o}}}}dispose(){this.trigger("dispose"),this.off()}}class Wl extends ds.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return"number"==typeof t&&"number"==typeof n&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){return"number"==typeof t&&"number"==typeof n&&(this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e],this.trigger("timelinechange")),this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const Vl=Ro(Po((function(){var e=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,r=0;r<n;++r)t[r].call(this,arguments[1]);else for(var a=Array.prototype.slice.call(arguments,1),i=t.length,s=0;s<i;++s)t[s].apply(this,a)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}();let t=null;class r{constructor(e){let n,r,a;t||(t=function(){const e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],r=t[4],a=n[4];let i,s,o;const l=[],u=[];let d,c,h,p,m,f;for(i=0;i<256;i++)u[(l[i]=i<<1^283*(i>>7))^i]=i;for(s=o=0;!r[s];s^=d||1,o=u[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^255&p^99,r[s]=p,a[p]=s,h=l[c=l[d=l[s]]],f=16843009*h^65537*c^257*d^16843008*s,m=257*l[p]^16843008*p,i=0;i<4;i++)t[i][s]=m=m<<24^m>>>8,n[i][p]=f=f<<24^f>>>8;for(i=0;i<5;i++)t[i]=t[i].slice(0),n[i]=n[i].slice(0);return e}()),this._tables=[[t[0][0].slice(),t[0][1].slice(),t[0][2].slice(),t[0][3].slice(),t[0][4].slice()],[t[1][0].slice(),t[1][1].slice(),t[1][2].slice(),t[1][3].slice(),t[1][4].slice()]];const i=this._tables[0][4],s=this._tables[1],o=e.length;let l=1;if(4!==o&&6!==o&&8!==o)throw new Error("Invalid aes key size");const u=e.slice(0),d=[];for(this._key=[u,d],n=o;n<4*o+28;n++)a=u[n-1],(n%o==0||8===o&&n%o==4)&&(a=i[a>>>24]<<24^i[a>>16&255]<<16^i[a>>8&255]<<8^i[255&a],n%o==0&&(a=a<<8^a>>>24^l<<24,l=l<<1^283*(l>>7))),u[n]=u[n-o]^a;for(r=0;n;r++,n--)a=u[3&r?n:n-4],d[r]=n<=4||r<4?a:s[0][i[a>>>24]]^s[1][i[a>>16&255]]^s[2][i[a>>8&255]]^s[3][i[255&a]]}decrypt(e,t,n,r,a,i){const s=this._key[1];let o,l,u,d=e^s[0],c=r^s[1],h=n^s[2],p=t^s[3];const m=s.length/4-2;let f,g=4;const y=this._tables[1],b=y[0],x=y[1],A=y[2],v=y[3],w=y[4];for(f=0;f<m;f++)o=b[d>>>24]^x[c>>16&255]^A[h>>8&255]^v[255&p]^s[g],l=b[c>>>24]^x[h>>16&255]^A[p>>8&255]^v[255&d]^s[g+1],u=b[h>>>24]^x[p>>16&255]^A[d>>8&255]^v[255&c]^s[g+2],p=b[p>>>24]^x[d>>16&255]^A[c>>8&255]^v[255&h]^s[g+3],g+=4,d=o,c=l,h=u;for(f=0;f<4;f++)a[(3&-f)+i]=w[d>>>24]<<24^w[c>>16&255]<<16^w[h>>8&255]<<8^w[255&p]^s[g++],o=d,d=c,c=h,h=p,p=o}}class a extends e{constructor(){super(e),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const i=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24};class s{constructor(e,t,n,r){const o=s.STEP,l=new Int32Array(e.buffer),u=new Uint8Array(e.byteLength);let d=0;for(this.asyncStream_=new a,this.asyncStream_.push(this.decryptChunk_(l.subarray(d,d+o),t,n,u)),d=o;d<l.length;d+=o)n=new Uint32Array([i(l[d-4]),i(l[d-3]),i(l[d-2]),i(l[d-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(d,d+o),t,n,u));this.asyncStream_.push((function(){var e;r(null,(e=u).subarray(0,e.byteLength-e[e.byteLength-1]))}))}static get STEP(){return 32e3}decryptChunk_(e,t,n,a){return function(){const s=function(e,t,n){const a=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),s=new r(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),l=new Int32Array(o.buffer);let u,d,c,h,p,m,f,g,y;for(u=n[0],d=n[1],c=n[2],h=n[3],y=0;y<a.length;y+=4)p=i(a[y]),m=i(a[y+1]),f=i(a[y+2]),g=i(a[y+3]),s.decrypt(p,m,f,g,l,y),l[y]=i(l[y]^u),l[y+1]=i(l[y+1]^d),l[y+2]=i(l[y+2]^c),l[y+3]=i(l[y+3]^h),u=p,d=m,c=f,h=g;return o}(e,t,n);a.set(s,e.byteOffset)}}}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},l=("undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{}).BigInt||Number;l("0x1"),l("0x100"),l("0x10000"),l("0x1000000"),l("0x100000000"),l("0x10000000000"),l("0x1000000000000"),l("0x100000000000000"),l("0x10000000000000000"),function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();self.onmessage=function(e){const t=e.data,n=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),r=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),a=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new s(n,r,a,(function(e,n){self.postMessage(function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n];var a;a=r,("function"===ArrayBuffer.isView?ArrayBuffer.isView(a):a&&a.buffer instanceof ArrayBuffer)?t[n]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[n]=r})),t}({source:t.source,decrypted:n}),[n.buffer])}))}})));var jl=No(Vl);const Hl=e=>{let t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},Gl=(e,t)=>{e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},ql=(e,t)=>{t.activePlaylistLoader=e,e.load()},Xl={AUDIO:(e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:r},excludePlaylist:a}=t;Gl(n,r);const i=r.activeTrack(),s=r.activeGroup(),o=(s.filter((e=>e.default))[0]||s[0]).id,l=r.tracks[o];if(i!==l){ds.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const e in r.tracks)r.tracks[e].enabled=r.tracks[e]===l;r.onTrackChanged()}else a({error:{message:"Problem encountered loading the default audio track."}})},SUBTITLES:(e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:r}}=t;ds.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),Gl(n,r);const a=r.activeTrack();a&&(a.mode="disabled"),r.onTrackChanged()}},Kl={AUDIO:(e,t,n)=>{if(!t)return;const{tech:r,requestOptions:a,segmentLoaders:{[e]:i}}=n;t.on("loadedmetadata",(()=>{const e=t.media();i.playlist(e,a),(!r.paused()||e.endList&&"none"!==r.preload())&&i.load()})),t.on("loadedplaylist",(()=>{i.playlist(t.media(),a),r.paused()||i.load()})),t.on("error",Xl[e](e,n))},SUBTITLES:(e,t,n)=>{const{tech:r,requestOptions:a,segmentLoaders:{[e]:i},mediaTypes:{[e]:s}}=n;t.on("loadedmetadata",(()=>{const e=t.media();i.playlist(e,a),i.track(s.activeTrack()),(!r.paused()||e.endList&&"none"!==r.preload())&&i.load()})),t.on("loadedplaylist",(()=>{i.playlist(t.media(),a),r.paused()||i.load()})),t.on("error",Xl[e](e,n))}},Zl={AUDIO:(e,t)=>{const{vhs:n,sourceType:r,segmentLoaders:{[e]:a},requestOptions:i,main:{mediaGroups:s},mediaTypes:{[e]:{groups:o,tracks:l,logger_:u}},mainPlaylistLoader:d}=t,c=Hs(d.main);s[e]&&0!==Object.keys(s[e]).length||(s[e]={main:{default:{default:!0}}},c&&(s[e].main.default.playlists=d.main.playlists));for(const a in s[e]){o[a]||(o[a]=[]);for(const h in s[e][a]){let p,m=s[e][a][h];if(c?(u(`AUDIO group '${a}' label '${h}' is a main playlist`),m.isMainPlaylist=!0,p=null):p="vhs-json"===r&&m.playlists?new so(m.playlists[0],n,i):m.resolvedUri?new so(m.resolvedUri,n,i):m.playlists&&"dash"===r?new Io(m.playlists[0],n,i,d):null,m=bs({id:h,playlistLoader:p},m),Kl[e](e,m.playlistLoader,t),o[a].push(m),void 0===l[h]){const e=new ds.AudioTrack({id:h,kind:Hl(m),enabled:!1,language:m.language,default:m.default,label:h});l[h]=e}}}a.on("error",Xl[e](e,t))},SUBTITLES:(e,t)=>{const{tech:n,vhs:r,sourceType:a,segmentLoaders:{[e]:i},requestOptions:s,main:{mediaGroups:o},mediaTypes:{[e]:{groups:l,tracks:u}},mainPlaylistLoader:d}=t;for(const i in o[e]){l[i]||(l[i]=[]);for(const c in o[e][i]){if(o[e][i][c].forced)continue;let h,p=o[e][i][c];if("hls"===a)h=new so(p.resolvedUri,r,s);else if("dash"===a){if(!p.playlists.filter((e=>e.excludeUntil!==1/0)).length)return;h=new Io(p.playlists[0],r,s,d)}else"vhs-json"===a&&(h=new so(p.playlists?p.playlists[0]:p.resolvedUri,r,s));if(p=bs({id:c,playlistLoader:h},p),Kl[e](e,p.playlistLoader,t),l[i].push(p),void 0===u[c]){const e=n.addRemoteTextTrack({id:c,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:c},!1).track;u[c]=e}}}i.on("error",Xl[e](e,t))},"CLOSED-CAPTIONS":(e,t)=>{const{tech:n,main:{mediaGroups:r},mediaTypes:{[e]:{groups:a,tracks:i}}}=t;for(const t in r[e]){a[t]||(a[t]=[]);for(const s in r[e][t]){const o=r[e][t][s];if(!/^(?:CC|SERVICE)/.test(o.instreamId))continue;const l=n.options_.vhs&&n.options_.vhs.captionServices||{};let u={label:s,language:o.language,instreamId:o.instreamId,default:o.default&&o.autoselect};if(l[u.instreamId]&&(u=bs(u,l[u.instreamId])),void 0===u.default&&delete u.default,a[t].push(bs({id:s},o)),void 0===i[s]){const e=n.addRemoteTextTrack({id:u.instreamId,kind:"captions",default:u.default,language:u.language,label:u.label},!1).track;i[s]=e}}}}},Yl=(e,t)=>{for(let n=0;n<e.length;n++){if(Vs(t,e[n]))return!0;if(e[n].playlists&&Yl(e[n].playlists,t))return!0}return!1},Jl={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if(n[e].enabled)return n[e];return null},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if("showing"===n[e].mode||"hidden"===n[e].mode)return n[e];return null}};let Ql;const eu=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],tu=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]};class nu extends ds.EventTarget{constructor(e){super();const{src:t,withCredentials:n,tech:r,bandwidth:i,externVhs:s,useCueTags:o,playlistExclusionDuration:l,enableLowInitialPlaylist:u,sourceType:d,cacheEncryptionKeys:c,bufferBasedABR:h,leastPixelDiffSelector:p,captionServices:m}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:f}=e;null==f&&(f=1/0),Ql=s,this.bufferBasedABR=Boolean(h),this.leastPixelDiffSelector=Boolean(p),this.withCredentials=n,this.tech_=r,this.vhs_=r.vhs,this.sourceType_=d,this.useCueTags_=o,this.playlistExclusionDuration=l,this.maxPlaylistRetries=f,this.enableLowInitialPlaylist=u,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:f,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=(()=>{const e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((t=>{e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:gl,activeTrack:gl,getActiveGroup:gl,onGroupChanged:gl,onTrackChanged:gl,lastTrack_:null,logger_:ys(`MediaGroups[${t}]`)}})),e})(),this.mediaSource=new(a().MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.seekable_=xs(),this.hasPlayed_=!1,this.syncController_=new Ul(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=new jl,this.sourceUpdater_=new Ml(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new Wl;const g={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:m,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:i,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:c,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings};this.mainPlaylistLoader_="dash"===this.sourceType_?new Io(t,this.vhs_,this.requestOptions_):new so(t,this.vhs_,this.requestOptions_),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new fl(bs(g,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new fl(bs(g,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new Ll(bs(g,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise(((e,t)=>{function n(){r.off("vttjserror",a),e()}function a(){r.off("vttjsloaded",n),t()}r.one("vttjsloaded",n),r.one("vttjserror",a),r.addWebVttScript_()}))}),e),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",(()=>this.startABRTimer_())),this.tech_.on("pause",(()=>this.stopABRTimer_())),this.tech_.on("play",(()=>this.startABRTimer_()))),eu.forEach((e=>{this[e+"_"]=tu.bind(this,e)})),this.logger_=ys("pc"),this.triggeredFmp4Usage=!1,"none"===this.tech_.preload()?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const y="none"===this.tech_.preload()?"play":"loadstart";this.tech_.one(y,(()=>{const e=Date.now();this.tech_.one("loadeddata",(()=>{this.timeToLoadedData__=Date.now()-e,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends}))}))}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const r=this.media(),a=r&&(r.id||r.uri),i=e.id||e.uri;a&&a!==i&&(this.logger_(`switch media ${a} -> ${i} from ${t}`),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})),this.mainPlaylistLoader_.media(e,n)}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=a().setInterval((()=>this.checkABR_()),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(a().clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,r=Object.keys(n);let a;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)a=this.mediaTypes_.AUDIO.activeTrack();else{const e=n.main||r.length&&n[r[0]];for(const t in e)if(e[t].default){a={label:t};break}}if(!a)return t;const i=[];for(const t in n)if(n[t][a.label]){const r=n[t][a.label];if(r.playlists&&r.playlists.length)i.push.apply(i,r.playlists);else if(r.uri)i.push(r);else if(e.playlists.length)for(let n=0;n<e.playlists.length;n++){const r=e.playlists[n];r.attributes&&r.attributes.AUDIO&&r.attributes.AUDIO===t&&i.push(r)}}return i.length?i:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",(()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;Ws(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&"none"!==this.tech_.preload()&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),(e=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((t=>{Zl[t](t,e)}));const{mediaTypes:t,mainPlaylistLoader:n,tech:r,vhs:a,segmentLoaders:{AUDIO:i,main:s}}=e;["AUDIO","SUBTITLES"].forEach((n=>{t[n].activeGroup=((e,t)=>n=>{const{mainPlaylistLoader:r,mediaTypes:{[e]:{groups:a}}}=t,i=r.media();if(!i)return null;let s=null;i.attributes[e]&&(s=a[i.attributes[e]]);const o=Object.keys(a);if(!s)if("AUDIO"===e&&o.length>1&&Hs(t.main))for(let e=0;e<o.length;e++){const t=a[o[e]];if(Yl(t,i)){s=t;break}}else a.main?s=a.main:1===o.length&&(s=a[o[0]]);return void 0===n?s:null!==n&&s&&s.filter((e=>e.id===n.id))[0]||null})(n,e),t[n].activeTrack=Jl[n](n,e),t[n].onGroupChanged=((e,t)=>()=>{const{segmentLoaders:{[e]:n,main:r},mediaTypes:{[e]:a}}=t,i=a.activeTrack(),s=a.getActiveGroup(),o=a.activePlaylistLoader,l=a.lastGroup_;s&&l&&s.id===l.id||(a.lastGroup_=s,a.lastTrack_=i,Gl(n,a),s&&!s.isMainPlaylist&&(s.playlistLoader?(n.resyncLoader(),ql(s.playlistLoader,a)):o&&r.resetEverything()))})(n,e),t[n].onGroupChanging=((e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:r}}=t;r.lastGroup_=null,n.abort(),n.pause()})(n,e),t[n].onTrackChanged=((e,t)=>()=>{const{mainPlaylistLoader:n,segmentLoaders:{[e]:r,main:a},mediaTypes:{[e]:i}}=t,s=i.activeTrack(),o=i.getActiveGroup(),l=i.activePlaylistLoader,u=i.lastTrack_;if((!u||!s||u.id!==s.id)&&(i.lastGroup_=o,i.lastTrack_=s,Gl(r,i),o)){if(o.isMainPlaylist){if(!s||!u||s.id===u.id)return;const e=t.vhs.playlistController_,r=e.selectPlaylist();if(e.media()===r)return;return i.logger_(`track change. Switching main audio from ${u.id} to ${s.id}`),n.pause(),a.resetEverything(),void e.fastQualityChange_(r)}if("AUDIO"===e){if(!o.playlistLoader)return a.setAudio(!0),void a.resetEverything();r.setAudio(!0),a.setAudio(!1)}l!==o.playlistLoader?(r.track&&r.track(s),r.resetEverything(),ql(o.playlistLoader,i)):ql(o.playlistLoader,i)}})(n,e),t[n].getActiveGroup=((e,{mediaTypes:t})=>()=>{const n=t[e].activeTrack();return n?t[e].activeGroup(n):null})(n,e)}));const o=t.AUDIO.activeGroup();if(o){const e=(o.filter((e=>e.default))[0]||o[0]).id;t.AUDIO.tracks[e].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged(),t.AUDIO.getActiveGroup().playlistLoader?(s.setAudio(!1),i.setAudio(!0)):s.setAudio(!0)}n.on("mediachange",(()=>{["AUDIO","SUBTITLES"].forEach((e=>t[e].onGroupChanged()))})),n.on("mediachanging",(()=>{["AUDIO","SUBTITLES"].forEach((e=>t[e].onGroupChanging()))}));const l=()=>{t.AUDIO.onTrackChanged(),r.trigger({type:"usage",name:"vhs-audio-change"})};r.audioTracks().addEventListener("change",l),r.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),a.on("dispose",(()=>{r.audioTracks().removeEventListener("change",l),r.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)})),r.clearTracks("audio");for(const e in t.AUDIO.tracks)r.audioTracks().addTrack(t.AUDIO.tracks[e])})({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",(()=>{this.trigger("selectedinitialmedia")}))})),this.mainPlaylistLoader_.on("loadedplaylist",(()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){let t;if(this.excludeUnsupportedVariants_(),this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t))return;if(this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial"),"vhs-json"!==this.sourceType_||!this.initialMedia_.segments)return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)})),this.mainPlaylistLoader_.on("error",(()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})})),this.mainPlaylistLoader_.on("mediachanging",(()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()})),this.mainPlaylistLoader_.on("mediachange",(()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;Ws(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})})),this.mainPlaylistLoader_.on("playlistunchanged",(()=>{const e=this.mainPlaylistLoader_.media();"playlist-unchanged"!==e.lastExcludeReason_&&this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))})),this.mainPlaylistLoader_.on("renditiondisabled",(()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})})),this.mainPlaylistLoader_.on("renditionenabled",(()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}))}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let r=!0;const a=Object.keys(n.AUDIO);for(const e in n.AUDIO)for(const t in n.AUDIO[e])n.AUDIO[e][t].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Ql.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),a.length&&Object.keys(n.AUDIO[a[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),r=this.bufferLowWaterLine(),a=this.bufferHighWaterLine();return function({currentPlaylist:e,buffered:t,currentTime:n,nextPlaylist:r,bufferLowWaterLine:a,bufferHighWaterLine:i,duration:s,bufferBasedABR:o,log:l}){if(!r)return ds.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u=`allowing switch ${e&&e.id||"null"} -> ${r.id}`;if(!e)return l(`${u} as current playlist is not set`),!0;if(r.id===e.id)return!1;const d=Boolean(ks(t,n).length);if(!e.endList)return d||"number"!=typeof e.partTargetDuration?(l(`${u} as current playlist is live`),!0):(l(`not ${u} as current playlist is live llhls, but currentTime isn't in buffered.`),!1);const c=Cs(t,n),h=o?Co.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Co.MAX_BUFFER_LOW_WATER_LINE;if(s<h)return l(`${u} as duration < max low water line (${s} < ${h})`),!0;const p=r.attributes.BANDWIDTH,m=e.attributes.BANDWIDTH;if(p<m&&(!o||c<i)){let e=`${u} as next bandwidth < current bandwidth (${p} < ${m})`;return o&&(e+=` and forwardBuffer < bufferHighWaterLine (${c} < ${i})`),l(e),!0}if((!o||p>m)&&c>=a){let e=`${u} as forwardBuffer >= bufferLowWaterLine (${c} >= ${a})`;return o&&(e+=` and next bandwidth > current bandwidth (${p} > ${m})`),l(e),!0}return l(`not ${u} as no switching criteria met`),!1}({buffered:this.tech_.buffered(),currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:a,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",(()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")})),this.mainSegmentLoader_.on("timeout",(()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()})),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",(()=>{this.trigger("progress")})),this.mainSegmentLoader_.on("error",(()=>{const e=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:e.playlist,error:e})})),this.mainSegmentLoader_.on("appenderror",(()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")})),this.mainSegmentLoader_.on("syncinfoupdate",(()=>{this.onSyncInfoUpdate_()})),this.mainSegmentLoader_.on("timestampoffset",(()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})})),this.audioSegmentLoader_.on("syncinfoupdate",(()=>{this.onSyncInfoUpdate_()})),this.audioSegmentLoader_.on("appenderror",(()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")})),this.mainSegmentLoader_.on("ended",(()=>{this.logger_("main segment loader ended"),this.onEndOfStream()})),this.mainSegmentLoader_.on("earlyabort",(e=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:120}))}));const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const e=this.getCodecsOrExclude_();e&&this.sourceUpdater_.addOrChangeSourceBuffers(e)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",(()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)})),this.audioSegmentLoader_.on("fmp4",(()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)})),this.audioSegmentLoader_.on("ended",(()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}))}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}fastQualityChange_(e=this.selectPlaylist()){e!==this.mainPlaylistLoader_.media()?(this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything((()=>{ds.browser.IE_VERSION||ds.browser.IS_EDGE?this.tech_.setCurrentTime(this.tech_.currentTime()+.04):this.tech_.setCurrentTime(this.tech_.currentTime())}))):this.logger_("skipping fastQualityChange because new media is same as old")}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList){const e=this.seekable();if(!e.length)return!1;if(ds.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",(()=>{this.trigger("firstplay"),this.tech_.setCurrentTime(e.end(0)),this.hasPlayed_=!0})),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(e.end(0))}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,(e=>{}))}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;const n=Ql.Playlist.playlistEnd(e,t),r=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return n-r<=vs;const i=a.end(a.length-1);return i-r<=vs&&n-i<=vs}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,a=r.filter(Bs),i=1===a.length&&a[0]===e;if(1===r.length&&n!==1/0)return ds.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(i);if(i){let t=!1;r.forEach((n=>{if(n===e)return;const r=n.excludeUntil;void 0!==r&&r!==1/0&&(t=!0,delete n.excludeUntil)})),t&&(ds.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let s;s=e.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*n,e.excludeUntil=s,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const o=this.selectPlaylist();if(!o)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");const l=t.internal?this.logger_:ds.log.warn,u=t.message?" "+t.message:"";l(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${u} Switching to playlist ${o.id}.`),o.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),o.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const d=o.targetDuration/2*1e3||5e3,c="number"==typeof o.lastRequest&&Date.now()-o.lastRequest<=d;return this.switchMedia_(o,"exclude",i||c)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],r="all"===e;(r||"main"===e)&&n.push(this.mainPlaylistLoader_);const a=[];(r||"audio"===e)&&a.push("AUDIO"),(r||"subtitle"===e)&&(a.push("CLOSED-CAPTIONS"),a.push("SUBTITLES")),a.forEach((e=>{const t=this.mediaTypes_[e]&&this.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)})),["main","audio","subtitle"].forEach((t=>{const r=this[`${t}SegmentLoader_`];!r||e!==t&&"all"!==e||n.push(r)})),n.forEach((e=>t.forEach((t=>{"function"==typeof e[t]&&e[t]()}))))}setCurrentTime(e){const t=ks(this.tech_.buffered(),e);return this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media()&&this.mainPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Ql.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}onSyncInfoUpdate_(){let e;if(!this.mainPlaylistLoader_)return;let t=this.mainPlaylistLoader_.media();if(!t)return;let n=this.syncController_.getExpiredTime(t,this.duration());if(null===n)return;const r=this.mainPlaylistLoader_.main,a=Ql.Playlist.seekable(t,n,Ql.Playlist.liveEdgeDelay(r,t));if(0===a.length)return;if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),n=this.syncController_.getExpiredTime(t,this.duration()),null===n)return;if(e=Ql.Playlist.seekable(t,n,Ql.Playlist.liveEdgeDelay(r,t)),0===e.length)return}let i,s;this.seekable_&&this.seekable_.length&&(i=this.seekable_.end(0),s=this.seekable_.start(0)),e?e.start(0)>a.end(0)||a.start(0)>e.end(0)?this.seekable_=a:this.seekable_=xs([[e.start(0)>a.start(0)?e.start(0):a.start(0),e.end(0)<a.end(0)?e.end(0):a.end(0)]]):this.seekable_=a,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===i&&this.seekable_.start(0)===s||(this.logger_(`seekable updated [${Ts(this.seekable_)}]`),this.tech_.trigger("seekablechanged"))}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){const e=this.seekable();if(!e.length)return;return void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)))}const t=this.tech_.buffered();let n=Ql.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach((e=>{const t=this.mediaTypes_[e].groups;for(const e in t)t[e].forEach((e=>{e.playlistLoader&&e.playlistLoader.dispose()}))})),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=el(this.main(),t),r={},a=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=n.video||e.main.videoCodec||"avc1.4d400d"),e.main.isMuxed&&(r.video+=`,${n.audio||e.main.audioCodec||z}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||a)&&(r.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||z,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});const i={};let s;if(["video","audio"].forEach((function(t){if(r.hasOwnProperty(t)&&(n=e[t].isFmp4,a=r[t],!(n?F(a):L(a)))){const n=e[t].isFmp4?"browser":"muxer";i[n]=i[n]||[],i[n].push(r[t]),"audio"===t&&(s=n)}var n,a})),a&&s&&t.attributes.AUDIO){const e=t.attributes.AUDIO;this.main().playlists.forEach((n=>{(n.attributes&&n.attributes.AUDIO)===e&&n!==t&&(n.excludeUntil=1/0)})),this.logger_(`excluding audio group ${e} as ${s} does not support codec(s): "${r.audio}"`)}if(!Object.keys(i).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const e=[];if(["video","audio"].forEach((t=>{const n=(M(this.sourceUpdater_.codecs[t]||"")[0]||{}).type,a=(M(r[t]||"")[0]||{}).type;n&&a&&n.toLowerCase()!==a.toLowerCase()&&e.push(`"${this.sourceUpdater_.codecs[t]}" -> "${r[t]}"`)})),e.length)return void this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${e.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0})}return r}{const e=Object.keys(i).reduce(((e,t)=>(e&&(e+=", "),e+`${t} does not support codec(s): "${i[t].join(",")}"`)),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:e},playlistExclusionDuration:1/0})}}tryToCreateSourceBuffers_(){if("open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers())return;if(!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach((n=>{const r=e[n];if(-1!==t.indexOf(r.id))return;t.push(r.id);const a=el(this.main,r),i=[];!a.audio||L(a.audio)||F(a.audio)||i.push(`audio codec ${a.audio}`),!a.video||L(a.video)||F(a.video)||i.push(`video codec ${a.video}`),a.text&&"stpp.ttml.im1t"===a.text&&i.push(`text codec ${a.text}`),i.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${i.join(", ")}`))}))}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,r=Jo(M(e)),a=Qo(r),i=r.video&&M(r.video)[0]||null,s=r.audio&&M(r.audio)[0]||null;Object.keys(n).forEach((e=>{const r=n[e];if(-1!==t.indexOf(r.id)||r.excludeUntil===1/0)return;t.push(r.id);const o=[],l=el(this.mainPlaylistLoader_.main,r),u=Qo(l);if(l.audio||l.video){if(u!==a&&o.push(`codec count "${u}" !== "${a}"`),!this.sourceUpdater_.canChangeType()){const e=l.video&&M(l.video)[0]||null,t=l.audio&&M(l.audio)[0]||null;e&&i&&e.type.toLowerCase()!==i.type.toLowerCase()&&o.push(`video codec "${e.type}" !== "${i.type}"`),t&&s&&t.type.toLowerCase()!==s.type.toLowerCase()&&o.push(`audio codec "${t.type}" !== "${s.type}"`)}o.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id}: ${o.join(" && ")}`))}}))}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),function(e,t,n=0){if(!e.segments)return;let r,i=n;for(let n=0;n<e.segments.length;n++){const s=e.segments[n];if(r||(r=zl(t,i+s.duration/2)),r){if("cueIn"in s){r.endTime=i,r.adEndTime=i,i+=s.duration,r=null;continue}if(i<r.endTime){i+=s.duration;continue}r.endTime+=s.duration}else if("cueOut"in s&&(r=new(a().VTTCue)(i,i+s.duration,s.cueOut),r.adStartTime=i,r.adEndTime=i+parseFloat(s.cueOut),t.addCue(r)),"cueOutCont"in s){const[e,n]=s.cueOutCont.split("/").map(parseFloat);r=new(a().VTTCue)(i,i+s.duration,""),r.adStartTime=i-e,r.adEndTime=r.adStartTime+n,t.addCue(r)}i+=s.duration}}(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=Co.GOAL_BUFFER_LENGTH,n=Co.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,Co.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=Co.BUFFER_LOW_WATER_LINE,n=Co.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,Co.MAX_BUFFER_LOW_WATER_LINE),a=Math.max(t,Co.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?a:r)}bufferHighWaterLine(){return Co.BUFFER_HIGH_WATER_LINE}}class ru{constructor(e,t,n){const{playlistController_:r}=e,a=r.fastQualityChange_.bind(r);if(t.attributes){const e=t.attributes.RESOLUTION;this.width=e&&e.width,this.height=e&&e.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}var i,s,o;this.codecs=el(r.main(),t),this.playlist=t,this.id=n,this.enabled=(i=e.playlists,s=t.id,o=a,e=>{const t=i.main.playlists[s],n=zs(t),r=Bs(t);return void 0===e?r:(e?delete t.disabled:t.disabled=!0,e===r||n||(o(),e?i.trigger("renditionenabled"):i.trigger("renditiondisabled")),e)})}}const au=["seeking","seeked","pause","playing","error"];class iu{constructor(e){this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=ys("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),i=()=>this.resetTimeUpdate_(),s=this.playlistController_,o=["main","subtitle","audio"],l={};o.forEach((e=>{l[e]={reset:()=>this.resetSegmentDownloads_(e),updateend:()=>this.checkSegmentDownloads_(e)},s[`${e}SegmentLoader_`].on("appendsdone",l[e].updateend),s[`${e}SegmentLoader_`].on("playlistupdate",l[e].reset),this.tech_.on(["seeked","seeking"],l[e].reset)}));const u=e=>{["main","audio"].forEach((t=>{s[`${t}SegmentLoader_`][e]("appended",this.seekingAppendCheck_)}))};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),u("off"))},this.clearSeekingAppendCheck_=()=>u("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),u("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(au,i),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(au,i),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach((e=>{s[`${e}SegmentLoader_`].off("appendsdone",l[e].updateend),s[`${e}SegmentLoader_`].off("playlistupdate",l[e].reset),this.tech_.off(["seeked","seeking"],l[e].reset)})),this.checkCurrentTimeTimeout_&&a().clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&a().clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=a().setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],r=n.buffered_(),a=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e.start(n)!==t.start(n)||e.end(n)!==t.end(n))return!0;return!1}(this[`${e}Buffered_`],r);this[`${e}Buffered_`]=r,a?this.resetSegmentDownloads_(e):(this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:_s(r)}),this[`${e}StalledDownloads_`]<10||(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),"subtitle"!==e&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0})))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+vs>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const e=this.seekable(),t=this.tech_.currentTime();let n;if(this.afterSeekableWindow_(e,t,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(n=e.end(e.length-1)),this.beforeSeekableWindow_(e,t)){const t=e.start(0);n=t+(t===e.end(0)?0:vs)}if(void 0!==n)return this.logger_(`Trying to seek outside of seekable at time ${t} with seekable range ${Ts(e)}. Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0;const r=this.playlistController_.sourceUpdater_,a=this.tech_.buffered(),i=r.audioBuffer?r.audioBuffered():null,s=r.videoBuffer?r.videoBuffered():null,o=this.media(),l=o.partTargetDuration?o.partTargetDuration:2*(o.targetDuration-As),u=[i,s];for(let e=0;e<u.length;e++)if(u[e]&&Cs(u[e],t)<l)return!1;const d=Ss(a,t);return 0!==d.length&&(n=d.start(0)+vs,this.logger_(`Buffered region starts (${d.start(0)})  just beyond seek point (${t}). Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=ks(t,e);return n.length&&e+3<=n.end(0)?(this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),void this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"})):void 0}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const n=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${n}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=Ss(r,t);return a.length>0&&(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0)}afterSeekableWindow_(e,t,n,r=!1){if(!e.length)return!1;let a=e.end(e.length-1)+vs;return!n.endList&&r&&(a=e.end(e.length-1)+3*n.targetDuration),t>a}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let r;if(e.length&&t.length){const a=ks(e,n-3),i=ks(e,n),s=ks(t,n);s.length&&!i.length&&a.length&&(r={start:a.end(0),end:s.end(0)})}else Ss(e,n).length||(r=this.gapFromVideoUnderflow_(e,n));return!!r&&(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${n}`),!0)}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),r=Ss(t,n);this.resetTimeUpdate_(),0!==r.length&&n===e&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+As),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}))}gapFromVideoUnderflow_(e,t){const n=function(e){if(e.length<2)return xs();const t=[];for(let n=1;n<e.length;n++){const r=e.end(n-1),a=e.start(n);t.push([r,a])}return xs(t)}(e);for(let e=0;e<n.length;e++){const r=n.start(e),a=n.end(e);if(t-r<4&&t-r>2)return{start:r,end:a}}return null}}const su={errorInterval:30,getSource(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},ou=function(e,t){let n=0,r=0;const a=bs(su,t);e.ready((()=>{e.trigger({type:"usage",name:"vhs-error-reload-initialized"})}));const i=function(){r&&e.currentTime(r)},s=function(t){null!=t&&(r=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",i),e.src(t),e.trigger({type:"usage",name:"vhs-error-reload"}),e.play())},o=function(){if(Date.now()-n<1e3*a.errorInterval)e.trigger({type:"usage",name:"vhs-error-reload-canceled"});else{if(a.getSource&&"function"==typeof a.getSource)return n=Date.now(),a.getSource.call(e,s);ds.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function(){e.off("loadedmetadata",i),e.off("error",o),e.off("dispose",l)};e.on("error",o),e.on("dispose",l),e.reloadSourceOnError=function(t){l(),ou(e,t)}};var lu="3.0.2";const uu={PlaylistLoader:so,Playlist:Gs,utils:xo,STANDARD_PLAYLIST_SELECTOR:ol,INITIAL_PLAYLIST_SELECTOR:function(){const e=this.playlists.main.playlists.filter(Gs.isEnabled);return al(e,((e,t)=>il(e,t))),e.filter((e=>!!el(this.playlists.main,e).video))[0]||null},lastBandwidthSelector:ol,movingAverageBandwidthSelector:function(e){let t=-1,n=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){const r=this.useDevicePixelRatio&&a().devicePixelRatio||1;return t<0&&(t=this.systemBandwidth,n=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==n&&(t=e*this.systemBandwidth+(1-e)*t,n=this.systemBandwidth),sl(this.playlists.main,t,parseInt(rl(this.tech_.el(),"width"),10)*r,parseInt(rl(this.tech_.el(),"height"),10)*r,this.limitRenditionByPlayerDimensions,this.playlistController_)}},comparePlaylistBandwidth:il,comparePlaylistResolution:function(e,t){let n,r;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||a().Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(r=t.attributes.RESOLUTION.width),r=r||a().Number.MAX_VALUE,n===r&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-r},xhr:uo()};Object.keys(Co).forEach((e=>{Object.defineProperty(uu,e,{get:()=>(ds.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),Co[e]),set(t){ds.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),"number"!=typeof t||t<0?ds.log.warn(`value of Vhs.${e} must be greater than or equal to 0`):Co[e]=t}})}));const du="videojs-vhs",cu=function(e,t){const n=t.media();let r=-1;for(let t=0;t<e.length;t++)if(e[t].id===n.id){r=t;break}e.selectedIndex_=r,e.trigger({selectedIndex:r,type:"change"})};uu.canPlaySource=function(){return ds.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const hu=()=>{if(!a().localStorage)return null;const e=a().localStorage.getItem(du);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}};uu.supportsNativeHls=function(){if(!s()||!s().createElement)return!1;const e=s().createElement("video");return!!ds.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some((function(t){return/maybe|probably/i.test(e.canPlayType(t))}))}(),uu.supportsNativeDash=!!(s()&&s().createElement&&ds.getTech("Html5").isSupported())&&/maybe|probably/i.test(s().createElement("video").canPlayType("application/dash+xml")),uu.supportsTypeNatively=e=>"hls"===e?uu.supportsNativeHls:"dash"===e&&uu.supportsNativeDash,uu.isSupported=function(){return ds.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const pu=ds.getComponent("Component");class mu extends pu{constructor(e,t,n){if(super(t,n.vhs),"number"==typeof n.initialBandwidth&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=ys("VhsHandler"),t.options_&&t.options_.playerId){const e=ds.getPlayer(t.options_.playerId);this.player_=e}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(s(),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],(e=>{const t=s().fullscreenElement||s().webkitFullscreenElement||s().mozFullScreenElement||s().msFullscreenElement;t&&t.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()})),this.on(this.tech_,"seeking",(function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())})),this.on(this.tech_,"error",(function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()})),this.on(this.tech_,"play",this.play)}setOptions_(){if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=!1!==this.options_.llhls,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,"number"!=typeof this.options_.playlistExclusionDuration&&(this.options_.playlistExclusionDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){const e=hu();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=Co.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Co.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach((e=>{void 0!==this.source_[e]&&(this.options_[e]=this.source_[e])})),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio}src(e,t){if(!e)return;var n;this.setOptions_(),this.options_.src=0===(n=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(n.substring(n.indexOf(",")+1)):n,this.options_.tech=this.tech_,this.options_.externVhs=uu,this.options_.sourceType=W(t),this.options_.seekTo=e=>{this.tech_.setCurrentTime(e)},this.playlistController_=new nu(this.options_);const r=bs({liveRangeSafeTimeDelta:vs},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new iu(r),this.playlistController_.on("error",(()=>{const e=ds.players[this.tech_.options_.playerId];let t=this.playlistController_.error;"object"!=typeof t||t.code?"string"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)}));const i=this.options_.bufferBasedABR?uu.movingAverageBandwidthSelector(.55):uu.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):i.bind(this),this.playlistController_.selectInitialPlaylist=uu.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(e){this.playlistController_.selectPlaylist=e.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(e){this.playlistController_.mainSegmentLoader_.throughput.rate=e,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let e=this.playlistController_.mainSegmentLoader_.bandwidth;const t=a().navigator.connection||a().navigator.mozConnection||a().navigator.webkitConnection,n=1e7;if(this.options_.useNetworkInformationApi&&t){const r=1e3*t.downlink*1e3;e=r>=n&&e>=n?Math.max(e,r):r}return e},set(e){this.playlistController_.mainSegmentLoader_.bandwidth=e,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const e=1/(this.bandwidth||1);let t;return t=this.throughput>0?1/this.throughput:0,Math.floor(1/(e+t))},set(){ds.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>_s(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>_s(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",(()=>{this.options_.useBandwidthFromLocalStorage&&(e=>{if(!a().localStorage)return!1;let t=hu();t=t?bs(t,e):e;try{a().localStorage.setItem(du,JSON.stringify(t))}catch(e){return!1}})({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})})),this.playlistController_.on("selectedinitialmedia",(()=>{var e;(e=this).representations=()=>{const t=e.playlistController_.main(),n=Hs(t)?e.playlistController_.getAudioTrackPlaylists_():t.playlists;return n?n.filter((e=>!zs(e))).map(((t,n)=>new ru(e,t,t.id))):[]}})),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",(()=>{this.setupEme_()})),this.on(this.playlistController_,"progress",(function(){this.tech_.trigger("progress")})),this.on(this.playlistController_,"firstplay",(function(){this.ignoreNextSeekingEvent_=!0})),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=a().URL.createObjectURL(this.playlistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),(({player:e,sourceKeySystems:t,audioMedia:n,mainPlaylists:r})=>{if(!e.eme.initializeMediaKeys)return Promise.resolve();const a=(o=n?r.concat([n]):r,l=Object.keys(t),o.reduce(((e,t)=>{if(!t.contentProtection)return e;const n=l.reduce(((e,n)=>{const r=t.contentProtection[n];return r&&r.pssh&&(e[n]={pssh:r.pssh}),e}),{});return Object.keys(n).length&&e.push(n),e}),[])),i=[],s=[];var o,l;return a.forEach((t=>{s.push(new Promise(((t,n)=>{e.tech_.one("keysessioncreated",t)}))),i.push(new Promise(((n,r)=>{e.eme.initializeMediaKeys({keySystems:t},(e=>{e?r(e):n()}))})))})),Promise.race([Promise.all(i),Promise.race(s)])})({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then((()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()})).catch((e=>{this.logger_("error while creating EME key session",e),this.player_.error({message:"Failed to initialize media keys for EME",code:3})}))}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=(({player:e,sourceKeySystems:t,media:n,audioMedia:r})=>{const a=((e,t,n)=>{if(!e)return e;let r={};t&&t.attributes&&t.attributes.CODECS&&(r=Jo(M(t.attributes.CODECS))),n&&n.attributes&&n.attributes.CODECS&&(r.audio=n.attributes.CODECS);const a=$(r.video),i=$(r.audio),s={};for(const n in e)s[n]={},i&&(s[n].audioContentType=i),a&&(s[n].videoContentType=a),t.contentProtection&&t.contentProtection[n]&&t.contentProtection[n].pssh&&(s[n].pssh=t.contentProtection[n].pssh),"string"==typeof e[n]&&(s[n].url=e[n]);return bs(e,s)})(t,n,r);return!(!a||(e.currentSource().keySystems=a,a&&!e.eme&&(ds.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),1)))})({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on("keystatuschange",(e=>{if("output-restricted"!==e.status)return;const t=this.playlistController_.main();if(!t||!t.playlists)return;const n=[];t.playlists.forEach((e=>{e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height>=720&&(!e.excludeUntil||e.excludeUntil<1/0)&&(e.excludeUntil=1/0,n.push(e))})),n.length&&(ds.log.warn('DRM keystatus changed to "output-restricted." Removing the following HD playlists that will most likely fail to play and clearing the buffer. This may be due to HDCP restrictions on the stream and the capabilities of the current device.',...n),this.playlistController_.fastQualityChange_())})),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),11!==ds.browser.IE_VERSION&&t?this.createKeySessions_():this.playlistController_.sourceUpdater_.initializedEme()}setupQualityLevels_(){const e=ds.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",(()=>{!function(e,t){t.representations().forEach((t=>{e.addQualityLevel(t)})),cu(e,t.playlists)}(this.qualityLevels_,this)})),this.playlists.on("mediachange",(()=>{cu(this.qualityLevels_,this.playlists)})))}static version(){return{"@videojs/http-streaming":lu,"mux.js":"6.3.0","mpd-parser":"1.0.1","m3u8-parser":"6.0.0","aes-decrypter":"4.0.1"}}version(){return this.constructor.version()}canChangeType(){return Ml.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&a().URL.revokeObjectURL&&(a().URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return(({playlist:e,time:t,callback:n})=>{if(!n)throw new Error("getProgramTime: callback must be provided");if(!e||void 0===t)return n({message:"getProgramTime: playlist and time must be provided"});const r=((e,t)=>{if(!t||!t.segments||0===t.segments.length)return null;let n,r=0;for(let a=0;a<t.segments.length&&(n=t.segments[a],r=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:r+n.duration,!(e<=r));a++);const a=t.segments[t.segments.length-1];if(a.videoTimingInfo&&a.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>r){if(e>r+.25*a.duration)return null;n=a}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:r-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}})(t,e);if(!r)return n({message:"valid programTime was not found"});if("estimate"===r.type)return n({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:r.estimatedStart});const a={mediaSeconds:t},i=((e,t)=>{if(!t.dateTimeObject)return null;const n=t.videoTimingInfo.transmuxerPrependedSeconds,r=e-(t.videoTimingInfo.transmuxedPresentationStart+n);return new Date(t.dateTimeObject.getTime()+1e3*r)})(t,r.segment);return i&&(a.programDateTime=i.toISOString()),n(null,a)})({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,r=2){return Ao({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}}const fu={name:"videojs-http-streaming",VERSION:lu,canHandleSource(e,t={}){const n=bs(ds.options,t);return fu.canPlayType(e.type,n)},handleSource(e,t,n={}){const r=bs(ds.options,n);return t.vhs=new mu(e,t,r),t.vhs.xhr=uo(),t.vhs.src(e.src,e.type),t.vhs},canPlayType(e,t){const n=W(e);if(!n)return"";const r=fu.getOverrideNative(t);return!uu.supportsTypeNatively(n)||r?"maybe":""},getOverrideNative(e={}){const{vhs:t={}}=e,n=!(ds.browser.IS_ANY_SAFARI||ds.browser.IS_IOS),{overrideNative:r=n}=t;return r}};F("avc1.4d400d,mp4a.40.2")&&ds.getTech("Html5").registerSourceHandler(fu,0),ds.VhsHandler=mu,ds.VhsSourceHandler=fu,ds.Vhs=uu,ds.use||ds.registerComponent("Vhs",uu),ds.options.vhs=ds.options.vhs||{},ds.getPlugin&&ds.getPlugin("reloadSourceOnError")||ds.registerPlugin("reloadSourceOnError",(function(e){ou(this,e)}));const gu=async e=>ds(e)},512:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>a});const e=async()=>{const e=document.createElement("video");return e.classList.add("video-js"),e.controls=!0,e.loop=!1,e.preload="auto",e},a=await e();r()}catch(e){r(e)}}),1)},49:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>o});var a=n(885),i=n(482),s=e([a,i]);[a,i]=s.then?(await s)():s;const o=async()=>{i.Z.player.on("ended",(async()=>{await a.Z.deactivated}))};r()}catch(e){r(e)}}))},627:(e,t,n)=>{"use strict";n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>d});var a=n(238),i=n(657),s=n(504),o=n(885),l=n(482),u=e([a,i,o,l]);[a,i,o,l]=u.then?(await u)():u;const d=async()=>{l.Z.player.on("play",(async()=>{l.Z.sessionStarted||(l.Z.indixesAttention=[],o.Z.indixesAttentionValue=0,o.Z.sessionTime=0,o.Z.sessionIndexes=[],l.Z.player.pause(),l.Z.sessionStarted=!0,l.Z.videoPlayed=!0,await(0,i.Z)(),l.Z.sessionInterval=setInterval((async()=>{const e=Math.floor(o.Z.sessionTime/1e3),t=Math.floor(l.Z.player.currentTime()),n=o.Z.sessionIndexes.filter((t=>t.second==e))[0];o.Z.sessionTime+=100;const r=await(0,a.Z)();if(l.Z.indixesAttention.push(r.attention),o.Z.indixesAttentionValue=(0,s.Z)(l.Z.indixesAttention),null!=n)o.Z.sessionIndexes.reduce(((t,n)=>{if(n.second===e){const e=n.indexes;return e.push(r),[...t,{...n,indexes:e}]}return[...t,n]}),[]);else{const n=[];n.push(r);const a={playerTime:t,second:Math.floor(e),indexes:n};o.Z.sessionIndexes.push(a)}}),100),l.Z.player.play()),l.Z.videoStopedFromButton&&(l.Z.videoStopedFromButton=!1)})),l.Z.player.on("pause",(async()=>{l.Z.videoStopedFromDetector||(l.Z.videoStopedFromButton=!0)}))};r()}catch(e){r(e)}}))},490:(e,t,n)=>{"use strict";var r=n(908);e.exports=function(e,t){return void 0===t&&(t=!1),function(n,a,i){if(n)e(n);else if(a.statusCode>=400&&a.statusCode<=599){var s=i;if(t)if(r.TextDecoder){var o=(void 0===(l=a.headers&&a.headers["content-type"])&&(l=""),l.toLowerCase().split(";").reduce((function(e,t){var n=t.split("="),r=n[0],a=n[1];return"charset"===r.trim()?a.trim():e}),"utf-8"));try{s=new TextDecoder(o).decode(i)}catch(e){}}else s=String.fromCharCode.apply(null,new Uint8Array(i));e({cause:s})}else e(null,i);var l}}},603:(e,t,n)=>{"use strict";var r=n(908),a=n(434),i=n(376);l.httpHandler=n(490);var s=function(e){var t={};return e?(e.trim().split("\n").forEach((function(e){var n=e.indexOf(":"),r=e.slice(0,n).trim().toLowerCase(),a=e.slice(n+1).trim();void 0===t[r]?t[r]=a:Array.isArray(t[r])?t[r].push(a):t[r]=[t[r],a]})),t):t};function o(e,t,n){var r=e;return i(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=a({},t,{uri:e}),r.callback=n,r}function l(e,t,n){return u(t=o(e,t,n))}function u(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(n,r,a){t||(t=!0,e.callback(n,r,a))};function r(){var e=void 0;if(e=d.response?d.response:d.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(d),y)try{e=JSON.parse(e)}catch(e){}return e}function a(e){return clearTimeout(c),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,b)}function i(){if(!u){var t;clearTimeout(c),t=e.useXDR&&void 0===d.status?200:1223===d.status?204:d.status;var a=b,i=null;return 0!==t?(a={body:r(),statusCode:t,method:p,headers:{},url:h,rawRequest:d},d.getAllResponseHeaders&&(a.headers=s(d.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),n(i,a,a.body)}}var o,u,d=e.xhr||null;d||(d=e.cors||e.useXDR?new l.XDomainRequest:new l.XMLHttpRequest);var c,h=d.url=e.uri||e.url,p=d.method=e.method||"GET",m=e.body||e.data,f=d.headers=e.headers||{},g=!!e.sync,y=!1,b={body:void 0,headers:{},statusCode:0,method:p,url:h,rawRequest:d};if("json"in e&&!1!==e.json&&(y=!0,f.accept||f.Accept||(f.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(f["content-type"]||f["Content-Type"]||(f["Content-Type"]="application/json"),m=JSON.stringify(!0===e.json?m:e.json))),d.onreadystatechange=function(){4===d.readyState&&setTimeout(i,0)},d.onload=i,d.onerror=a,d.onprogress=function(){},d.onabort=function(){u=!0},d.ontimeout=a,d.open(p,h,!g,e.username,e.password),g||(d.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(c=setTimeout((function(){if(!u){u=!0,d.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}}),e.timeout)),d.setRequestHeader)for(o in f)f.hasOwnProperty(o)&&d.setRequestHeader(o,f[o]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(d.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(d),d.send(m||null),d}e.exports=l,e.exports.default=l,l.XMLHttpRequest=r.XMLHttpRequest||function(){},l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:r.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],(function(e){l["delete"===e?"del":e]=function(t,n,r){return(n=o(t,n,r)).method=e.toUpperCase(),u(n)}}))},279:(e,t,n)=>{"use strict";var r="/index.js";n.d(t,{p2:()=>U0});var a=Object.defineProperty,i=(e,t)=>{for(var n in t)a(e,n,{get:t[n],enumerable:!0})},s=(e,t,n)=>(((e,t,n)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),o=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},l=(e,t,n)=>(o(e,t,"read from private field"),n?n.call(e):t.get(e)),u=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},d=(e,t,n,r)=>(o(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),c={};i(c,{Abs:()=>Ge,Acos:()=>qe,Acosh:()=>Xe,AdadeltaOptimizer:()=>wp,AdagradOptimizer:()=>kp,AdamOptimizer:()=>Sp,AdamaxOptimizer:()=>Tp,Add:()=>Ke,AddN:()=>Ze,All:()=>Ye,Any:()=>Je,ArgMax:()=>Qe,ArgMin:()=>et,Asin:()=>tt,Asinh:()=>nt,Atan:()=>rt,Atan2:()=>it,Atanh:()=>at,AvgPool:()=>st,AvgPool3D:()=>lt,AvgPool3DGrad:()=>ut,AvgPoolGrad:()=>ot,BackendWasm:()=>xL,BatchMatMul:()=>dt,BatchToSpaceND:()=>ct,Bincount:()=>ht,BitwiseAnd:()=>pt,BroadcastArgs:()=>ft,BroadcastTo:()=>mt,Cast:()=>gt,Ceil:()=>yt,ClipByValue:()=>bt,Complex:()=>xt,ComplexAbs:()=>At,Concat:()=>vt,Conv2D:()=>wt,Conv2DBackpropFilter:()=>kt,Conv2DBackpropInput:()=>St,Conv3D:()=>Tt,Conv3DBackpropFilterV2:()=>_t,Conv3DBackpropInputV2:()=>It,Cos:()=>Ct,Cosh:()=>Et,CropAndResize:()=>Pt,Cumprod:()=>Nt,Cumsum:()=>Rt,DataStorage:()=>U,DenseBincount:()=>Dt,DepthToSpace:()=>Mt,DepthwiseConv2dNative:()=>Ot,DepthwiseConv2dNativeBackpropFilter:()=>$t,DepthwiseConv2dNativeBackpropInput:()=>Ft,Diag:()=>Lt,Dilation2D:()=>zt,Dilation2DBackpropFilter:()=>Ut,Dilation2DBackpropInput:()=>Bt,Draw:()=>Wt,ENV:()=>Ve,Einsum:()=>jt,Elu:()=>Ht,EluGrad:()=>Gt,Environment:()=>ze,Equal:()=>Xt,Erf:()=>qt,Exp:()=>Kt,ExpandDims:()=>Zt,Expm1:()=>Yt,FFT:()=>Jt,Fill:()=>Qt,FlipLeftRight:()=>en,Floor:()=>tn,FloorDiv:()=>nn,FromPixels:()=>sa,FusedBatchNorm:()=>rn,FusedConv2D:()=>ua,FusedDepthwiseConv2D:()=>da,GPGPUContext:()=>f_,GatherNd:()=>sn,GatherV2:()=>an,GraphModel:()=>_y,Greater:()=>on,GreaterEqual:()=>ln,IFFT:()=>dn,Identity:()=>un,Imag:()=>cn,IsFinite:()=>hn,IsInf:()=>pn,IsNan:()=>mn,KernelBackend:()=>W,LRN:()=>In,LRNGrad:()=>Cn,LeakyRelu:()=>fn,Less:()=>gn,LessEqual:()=>yn,LinSpace:()=>bn,Log:()=>xn,Log1p:()=>An,LogSoftmax:()=>Tn,LogicalAnd:()=>vn,LogicalNot:()=>wn,LogicalOr:()=>kn,LogicalXor:()=>Sn,LowerBound:()=>_n,MathBackendCPU:()=>Py,MathBackendWebGL:()=>OI,MatrixBandPart:()=>En,Max:()=>Nn,MaxPool:()=>Pn,MaxPool3D:()=>Mn,MaxPool3DGrad:()=>On,MaxPoolGrad:()=>Dn,MaxPoolWithArgmax:()=>$n,Maximum:()=>Rn,Mean:()=>Fn,Min:()=>Ln,Minimum:()=>zn,MirrorPad:()=>Bn,Mod:()=>Un,MomentumOptimizer:()=>Ip,Multinomial:()=>Wn,Multiply:()=>Vn,Neg:()=>jn,NonMaxSuppressionV3:()=>Gn,NonMaxSuppressionV4:()=>qn,NonMaxSuppressionV5:()=>Xn,NotEqual:()=>Hn,OP_SCOPE_SUFFIX:()=>Wi,OneHot:()=>Zn,OnesLike:()=>Kn,Optimizer:()=>vp,OptimizerConstructors:()=>Rm,Pack:()=>Yn,PadV2:()=>Jn,Pool:()=>Qn,Pow:()=>er,Prelu:()=>tr,Prod:()=>nr,RMSPropOptimizer:()=>Cp,RaggedGather:()=>rr,RaggedRange:()=>ar,RaggedTensorToTensor:()=>ir,Range:()=>sr,Rank:()=>li,Real:()=>or,RealDiv:()=>Vt,Reciprocal:()=>lr,Reduction:()=>Hh,Relu:()=>ur,Relu6:()=>fr,Reshape:()=>dr,ResizeBilinear:()=>pr,ResizeBilinearGrad:()=>mr,ResizeNearestNeighbor:()=>cr,ResizeNearestNeighborGrad:()=>hr,Reverse:()=>gr,RotateWithOffset:()=>oa,Round:()=>yr,Rsqrt:()=>br,SGDOptimizer:()=>_p,ScatterNd:()=>xr,SearchSorted:()=>vr,Select:()=>wr,Selu:()=>kr,Sigmoid:()=>Cr,Sign:()=>Ir,Sin:()=>Tr,Sinh:()=>_r,Slice:()=>Sr,Softmax:()=>Mr,Softplus:()=>Er,SpaceToBatchND:()=>Pr,SparseFillEmptyRows:()=>Or,SparseReshape:()=>$r,SparseSegmentMean:()=>Fr,SparseSegmentSum:()=>Lr,SparseToDense:()=>zr,SplitV:()=>Dr,Sqrt:()=>Nr,Square:()=>Ur,SquaredDifference:()=>Br,StaticRegexReplace:()=>Wr,Step:()=>ia,StridedSlice:()=>Vr,StringNGrams:()=>jr,StringSplit:()=>Hr,StringToHashBucketFast:()=>Gr,Sub:()=>qr,Sum:()=>Rr,Tan:()=>Xr,Tanh:()=>Kr,Tensor:()=>si,TensorBuffer:()=>ri,TensorScatterUpdate:()=>Ar,Tile:()=>Zr,TopK:()=>Yr,Transform:()=>Jr,Transpose:()=>Qr,Unique:()=>ea,Unpack:()=>ta,UnsortedSegmentSum:()=>na,UpperBound:()=>ra,Variable:()=>oi,WebGPUBackend:()=>hz,ZerosLike:()=>aa,_FusedMatMul:()=>la,abs:()=>bo,acos:()=>xo,acosh:()=>Ao,add:()=>mo,addN:()=>vo,all:()=>wo,any:()=>ko,argMax:()=>So,argMin:()=>To,asin:()=>_o,asinh:()=>Io,atan:()=>Co,atan2:()=>Eo,atanh:()=>No,avgPool:()=>qo,avgPool3d:()=>Xo,backend:()=>ho,backend_util:()=>$m,basicLSTMCell:()=>el,batchNorm:()=>rl,batchNorm2d:()=>al,batchNorm3d:()=>il,batchNorm4d:()=>sl,batchToSpaceND:()=>tl,bincount:()=>ol,bitwiseAnd:()=>ll,booleanMaskAsync:()=>Zc,broadcastArgs:()=>ul,broadcastTo:()=>dl,broadcast_util:()=>Ml,browser:()=>em,buffer:()=>Ws,cast:()=>Vs,ceil:()=>cl,clipByValue:()=>pl,clone:()=>js,complex:()=>ji,concat:()=>Ko,concat1d:()=>ml,concat2d:()=>fl,concat3d:()=>gl,concat4d:()=>yl,conv1d:()=>xl,conv2d:()=>bl,conv2dTranspose:()=>vl,conv3d:()=>wl,conv3dTranspose:()=>Sl,copyRegisteredKernels:()=>wa,cos:()=>Tl,cosh:()=>_l,cosineWindow:()=>ah,cumprod:()=>Il,cumsum:()=>Cl,customGrad:()=>$u,denseBincount:()=>El,deprecationWarn:()=>Ks,depthToSpace:()=>Nl,depthwiseConv2d:()=>Rl,deregisterOp:()=>Kf,device_util:()=>Pi,diag:()=>Pl,dilation2d:()=>Dl,disableDeprecationWarnings:()=>Xs,dispose:()=>to,disposeVariables:()=>Zs,div:()=>go,divNoNan:()=>Ul,dot:()=>Wl,dropout:()=>nh,einsum:()=>Vl,elu:()=>jl,enableDebugMode:()=>qs,enableProdMode:()=>Gs,enclosingPowerOfTwo:()=>rh,engine:()=>Ys,ensureShape:()=>Hl,env:()=>Ue,equal:()=>Ll,erf:()=>Gl,euclideanNorm:()=>du,exp:()=>cu,expandDims:()=>hu,expm1:()=>pu,eye:()=>fu,fft:()=>xc,fill:()=>hl,findBackend:()=>lo,findBackendFactory:()=>uo,floor:()=>gu,floorDiv:()=>fo,forceHalfFloat:()=>FI,fused:()=>sh,gather:()=>yu,gatherND:()=>th,gather_util:()=>lm,getBackend:()=>so,getGradient:()=>ga,getKernel:()=>fa,getKernelsForBackend:()=>ya,getThreadsCount:()=>PL,gpgpu_util:()=>GT,grad:()=>Ru,grads:()=>Pu,greater:()=>bu,greaterEqual:()=>xu,ifft:()=>Ac,imag:()=>Au,image:()=>hp,inTopKAsync:()=>ih,io:()=>Np,irfft:()=>vc,isFinite:()=>vu,isInf:()=>wu,isNaN:()=>ku,keep:()=>no,kernel_impls:()=>Hf,leakyRelu:()=>Su,less:()=>Tu,lessEqual:()=>_u,linalg:()=>pp,linspace:()=>Iu,loadGraphModel:()=>Iy,loadGraphModelSync:()=>Cy,localResponseNormalization:()=>Cu,log:()=>Eu,log1p:()=>Nu,logSigmoid:()=>Bu,logSoftmax:()=>Wu,logSumExp:()=>Vu,logicalAnd:()=>ju,logicalNot:()=>Hu,logicalOr:()=>Gu,logicalXor:()=>qu,losses:()=>mp,lowerBound:()=>Zu,matMul:()=>Zo,math:()=>Yp,max:()=>tu,maxPool:()=>Yu,maxPool3d:()=>Ju,maxPoolWithArgmax:()=>Qu,maximum:()=>ed,mean:()=>td,memory:()=>Js,meshgrid:()=>ad,min:()=>nu,minimum:()=>id,mirrorPad:()=>sd,mod:()=>od,moments:()=>ld,movingAverage:()=>Jc,mul:()=>yo,multiRNNCell:()=>ud,multinomial:()=>dd,neg:()=>Lu,nextFrame:()=>Mm,norm:()=>uu,notEqual:()=>cd,oneHot:()=>hd,ones:()=>rd,onesLike:()=>pd,op:()=>Vi,outerProduct:()=>md,pad:()=>fd,pad1d:()=>gd,pad2d:()=>yd,pad3d:()=>bd,pad4d:()=>xd,pool:()=>vd,pow:()=>ru,prelu:()=>wd,print:()=>Hs,prod:()=>kd,profile:()=>Qs,raggedGather:()=>Sd,raggedRange:()=>Td,raggedTensorToTensor:()=>_d,rand:()=>Id,randomGamma:()=>Hd,randomNormal:()=>Gd,randomStandardNormal:()=>qd,randomUniform:()=>Xd,randomUniformInt:()=>Kd,range:()=>Zd,ready:()=>io,real:()=>Yd,reciprocal:()=>Jd,registerBackend:()=>co,registerGradient:()=>xa,registerKernel:()=>ba,registerOp:()=>qf,relu:()=>Qd,relu6:()=>ec,removeBackend:()=>oo,reshape:()=>Go,reverse:()=>tc,reverse1d:()=>nc,reverse2d:()=>rc,reverse3d:()=>ac,reverse4d:()=>ic,rfft:()=>kc,round:()=>sc,rsqrt:()=>oc,scalar:()=>au,scatterND:()=>Qc,scatter_util:()=>$c,searchSorted:()=>Ku,selu:()=>lc,separableConv2d:()=>uc,serialization:()=>yp,setBackend:()=>ao,setPlatform:()=>po,setThreadsCount:()=>RL,setWasmPath:()=>IL,setWasmPaths:()=>CL,setWebGLContext:()=>yS,setdiff1dAsync:()=>dc,shared:()=>Dy,sigmoid:()=>Yo,sign:()=>cc,signal:()=>cp,sin:()=>hc,sinh:()=>pc,slice:()=>Jo,slice1d:()=>mc,slice2d:()=>fc,slice3d:()=>gc,slice4d:()=>yc,slice_util:()=>dm,softmax:()=>bc,softplus:()=>zu,spaceToBatchND:()=>Ad,sparse:()=>fp,sparseToDense:()=>eh,spectral:()=>dp,split:()=>wc,sqrt:()=>iu,square:()=>su,squaredDifference:()=>Sc,squeeze:()=>Tc,stack:()=>_c,step:()=>Ic,stridedSlice:()=>Cc,string:()=>gp,sub:()=>Uu,sum:()=>ou,sumOutType:()=>yi,tan:()=>Ec,tanh:()=>Qo,tensor:()=>Gi,tensor1d:()=>Nc,tensor2d:()=>Rc,tensor3d:()=>Pc,tensor4d:()=>Dc,tensor5d:()=>Mc,tensor6d:()=>Oc,tensorScatterUpdate:()=>Bc,tensor_util:()=>mi,test_util:()=>Ed,tidy:()=>eo,tile:()=>mu,time:()=>ro,topk:()=>Uc,train:()=>Pm,transpose:()=>Yc,truncatedNormal:()=>Wc,unique:()=>Vc,unregisterGradient:()=>va,unregisterKernel:()=>Aa,unsortedSegmentSum:()=>jc,unstack:()=>Hc,upcastType:()=>gi,upperBound:()=>Gc,util:()=>Sa,valueAndGrad:()=>Du,valueAndGrads:()=>Mu,variable:()=>qc,variableGrads:()=>Ou,version:()=>zG,version_converter:()=>Ey,version_core:()=>Nm,version_cpu:()=>aA,version_wasm:()=>DL,version_webgl:()=>$I,webgl:()=>LI,webgl_util:()=>cS,webgpu_util:()=>JL,where:()=>zl,whereAsync:()=>Kc,zeros:()=>nd,zerosLike:()=>Bl});var h=Object.create,p=Object.defineProperty,m=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty,b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),x=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},A=(e,t,n)=>(n=null!=e?h(g(e)):{},((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of f(t))!y.call(e,n)&&undefined!==n&&p(e,n,{get:()=>t[n],enumerable:!(r=m(t,n))||r.enumerable});return e})(!t&&e&&e.__esModule?n:p(n,"default",{value:e,enumerable:!0}),e)),v=b(((e,t)=>{t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},s={};function o(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=s[e])?r:(n=u(e,(0|e)<0?-1:0,!0),a&&(s[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=u(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function l(e,t){if(isNaN(e))return t?b:y;if(t){if(e<0)return b;if(e>=m)return k}else{if(e<=-f)return S;if(e+1>=f)return w}return e<0?l(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;var d=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return y;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var a=l(d(n,8)),i=y,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+o),n);if(o<8){var h=l(d(n,o));i=i.mul(h).add(l(u))}else i=(i=i.mul(a)).add(l(u))}return i.unsigned=t,i}function h(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?c(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=c,r.fromValue=h;var p=4294967296,m=p*p,f=m/2,g=o(1<<24),y=o(0);r.ZERO=y;var b=o(0,!0);r.UZERO=b;var x=o(1);r.ONE=x;var A=o(1,!0);r.UONE=A;var v=o(-1);r.NEG_ONE=v;var w=u(-1,2147483647,!1);r.MAX_VALUE=w;var k=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=k;var S=u(0,-2147483648,!1);r.MIN_VALUE=S;var T=r.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=l(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=l(d(e,6),this.unsigned),i=this,s="";;){var o=i.div(a),u=(i.sub(o.mul(a)).toInt()>>>0).toString(e);if((i=o).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return a(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(a(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(x)},T.neg=T.negate,T.add=function(e){a(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=e.high>>>16,o=65535&e.high,l=e.low>>>16,d=0,c=0,p=0,m=0;return p+=(m+=i+(65535&e.low))>>>16,c+=(p+=r+l)>>>16,d+=(c+=n+o)>>>16,d+=t+s,u((p&=65535)<<16|(m&=65535),(d&=65535)<<16|(c&=65535),this.unsigned)},T.subtract=function(e){return a(e)||(e=h(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return y;if(a(e)||(e=h(e)),n)return u(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return y;if(this.eq(S))return e.isOdd()?S:y;if(e.eq(S))return this.isOdd()?S:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,s=65535&this.low,o=e.high>>>16,d=65535&e.high,c=e.low>>>16,p=65535&e.low,m=0,f=0,b=0,x=0;return b+=(x+=s*p)>>>16,f+=(b+=i*p)>>>16,b&=65535,f+=(b+=s*c)>>>16,m+=(f+=r*p)>>>16,f&=65535,m+=(f+=i*c)>>>16,f&=65535,m+=(f+=s*d)>>>16,m+=t*p+r*c+i*d+s*o,u((b&=65535)<<16|(x&=65535),(m&=65535)<<16|(f&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(a(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?b:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return b;if(e.gt(this.shru(1)))return A;i=b}else{if(this.eq(S))return e.eq(x)||e.eq(v)?S:e.eq(S)?x:(t=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?x:v:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(S))return this.unsigned?b:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=y}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),o=s<=48?1:d(2,s-48),c=l(t),p=c.mul(e);p.isNegative()||p.gt(r);)p=(c=l(t-=o,this.unsigned)).mul(e);c.isZero()&&(c=x),i=i.add(c),r=r.sub(p)}return i},T.div=T.divide,T.modulo=function(e){return a(e)||(e=h(e)),n?u((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return u(~this.low,~this.high,this.unsigned)},T.and=function(e){return a(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return a(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return a(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return a(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}})),w=b((()=>{})),k=b((()=>{})),S=b(((e,t)=>{!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),T=b(((e,t)=>{!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),_=b(((e,t)=>{!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),I=b(((e,t)=>{!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&(i.x&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),C=b(((e,t)=>{!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,s,o=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),a=0,i=-32;i<l;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(s=s+1640531527|0,a=0==(n=o[127&i]^=r+s)?a+1:0);for(a>=128&&(o[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=o[a+34&127],n=o[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[a]=r^n;e.w=s,e.X=o,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&(i.X&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),E=b(((e,t)=>{!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),N=b((()=>{})),R=b(((e,t)=>{!function(e,r,a){var i,s=256,o="random",l=a.pow(s,6),u=a.pow(2,52),d=2*u,c=s-1;function h(t,n,c){var h=[],b=g(f((n=1==n?{entropy:!0}:n||{}).entropy?[t,y(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(s):(t=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(t)),y(t)}catch(t){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,y(r)]}}():t,3),h),x=new p(h),A=function(){for(var e=x.g(6),t=l,n=0;e<u;)e=(e+n)*s,t*=s,n=x.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return A.int32=function(){return 0|x.g(4)},A.quick=function(){return x.g(4)/4294967296},A.double=A,g(y(x.S),r),(n.pass||c||function(e,t,n,r){return r&&(r.S&&m(r,x),e.state=function(){return m(x,{})}),n?(a[o]=e,t):e})(A,b,"global"in n?n.global:this==a,n.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<s;)o[a]=a++;for(a=0;a<s;a++)o[a]=o[i=c&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=c&a+1],n=n*s+o[c&(o[a]=o[i=c&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(s)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(f(e[n],t-1))}catch(e){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[c&a]=c&(n^=19*t[c&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(a.random(),r),"object"==typeof t&&t.exports){t.exports=h;try{i=N()}catch(e){}}else"function"==typeof define&&n.amdO?define((function(){return h})):a["seed"+o]=h}("undefined"!=typeof self?self:e,[],Math)})),P=b(((e,t)=>{var n=S(),r=T(),a=_(),i=I(),s=C(),o=E(),l=R();l.alea=n,l.xor128=r,l.xorwow=a,l.xorshift7=i,l.xor4096=s,l.tychei=o,t.exports=l})),D=b((()=>{})),M=b((()=>{})),O=b((()=>{})),$=b((()=>{})),F=b((()=>{})),L=b(((e,t)=>{var a,i=(a=(a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||r,function(e){function t(){return R.buffer!=z&&X(R.buffer),U}function r(){return R.buffer!=z&&X(R.buffer),W}function i(){return R.buffer!=z&&X(R.buffer),V}function s(){return R.buffer!=z&&X(R.buffer),j}var o,l,u,d=void 0!==(e=e||{})?e:{};d.ready=new Promise((function(e,t){o=e,l=t})),"undefined"!=typeof process&&process.listeners&&(u={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var c,h,p,m=Object.assign({},d),f=[],g=(e,t)=>{throw t},y="object"==typeof window,b="function"==typeof importScripts,x="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,A=d.ENVIRONMENT_IS_PTHREAD||!1,v="";function w(e){return d.locateFile?d.locateFile(e,v):v+e}if(x){var k=D(),S=M();let e;v=b?S.dirname(v)+"/":"//",c=(e,t)=>(e=le(e)?new URL(e):S.normalize(e),k.readFileSync(e,t?void 0:"utf8")),p=e=>{var t=c(e,!0);return t.buffer||(t=new Uint8Array(t)),t},h=(e,t,n)=>{e=le(e)?new URL(e):S.normalize(e),k.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),f=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof ce))throw e})),process.on("unhandledRejection",(function(e){throw e})),g=(e,t)=>{if(ee())throw process.exitCode=e,t;(function(e){e instanceof ce||E("exiting due to exception: "+e)})(t),process.exit(e)},d.inspect=function(){return"[Emscripten Module object]"};try{e=O()}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}n.g.Worker=e.Worker}else(y||b)&&(b?v=self.location.href:"undefined"!=typeof document&&document.currentScript&&(v=document.currentScript.src),void 0!==a&&a&&(v=a),v=0!==v.indexOf("blob:")?v.substr(0,v.replace(/[?#].*/,"").lastIndexOf("/")+1):"",x||(c=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},b&&(p=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),h=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}));x&&"undefined"==typeof performance&&(n.g.performance=$().performance);var T=console.log.bind(console),_=console.warn.bind(console);x&&(T=e=>k.writeSync(1,e+"\n"),_=e=>k.writeSync(2,e+"\n"));var I,C=d.print||T,E=d.printErr||_;Object.assign(d,m),m=null,d.arguments&&(f=d.arguments),d.thisProgram&&d.thisProgram,d.quit&&(g=d.quit),Atomics.load,Atomics.store,Atomics.compareExchange,d.wasmBinary&&(I=d.wasmBinary);var N=d.noExitRuntime||!0;"object"!=typeof WebAssembly&&ie("no native wasm support detected");var R,P,L,z,B,U,W,V,j,H=!1,G="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function q(e,t,n){for(var r=(t>>>=0)+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&G)return G.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,a):e.subarray(t,a));for(var i="";t<a;){var s=e[t++];if(128&s){var o=63&e[t++];if(192!=(224&s)){var l=63&e[t++];if((s=224==(240&s)?(15&s)<<12|o<<6|l:(7&s)<<18|o<<12|l<<6|63&e[t++])<65536)i+=String.fromCharCode(s);else{var u=s-65536;i+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else i+=String.fromCharCode((31&s)<<6|o)}else i+=String.fromCharCode(s)}return i}function X(e){z=e,d.HEAP8=B=new Int8Array(e),d.HEAP16=new Int16Array(e),d.HEAP32=W=new Int32Array(e),d.HEAPU8=U=new Uint8Array(e),d.HEAPU16=new Uint16Array(e),d.HEAPU32=V=new Uint32Array(e),d.HEAPF32=new Float32Array(e),d.HEAPF64=j=new Float64Array(e)}A&&(z=d.buffer);var K=d.INITIAL_MEMORY||16777216;if(A)R=d.wasmMemory,z=d.buffer;else if(d.wasmMemory)R=d.wasmMemory;else if(!((R=new WebAssembly.Memory({initial:K/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw E("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),x&&E("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");R&&(z=R.buffer),K=z.byteLength,X(z);var Z,Y=[],J=[],Q=[];function ee(){return N}function te(){!A&&ye(J)}var ne=0,re=null,ae=null;function ie(e){d.onAbort&&d.onAbort(e),E(e="Aborted("+e+")"),H=!0,L=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw l(t),t}var se;function oe(e){return e.startsWith("data:application/octet-stream;base64,")}function le(e){return e.startsWith("file://")}function ue(e){try{if(e==se&&I)return new Uint8Array(I);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){ie(e)}}oe(se="tfjs-backend-wasm-threaded-simd.wasm")||(se=w(se));var de={};function ce(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function he(e){var t=ge.pthreads[e];(function(e,t){e||ie(void 0)})(t),ge.returnWorkerToPool(t)}function pe(e){var t=ge.getNewWorker();if(!t)return 6;ge.runningWorkers.push(t),ge.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=()=>{x&&t.ref(),t.postMessage(n,e.transferList),delete t.runPthread},t.loaded&&t.runPthread(),0}function me(e){if(A)return Te(1,1,e);L=e,ee()||(ge.terminateAllThreads(),d.onExit&&d.onExit(e),H=!0),g(e,new ce(e))}var fe=function(e,t){if(L=e,!t&&A)throw be(e),"unwind";me(e)},ge={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){A?ge.initWorker():ge.initMainThread()},initMainThread:function(){for(var e=8;e--;)ge.allocateUnusedWorker()},initWorker:function(){N=!1},setExitStatus:function(e){L=e},terminateAllThreads:function(){for(var e of Object.values(ge.pthreads))ge.returnWorkerToPool(e);for(var e of ge.unusedWorkers)e.terminate();ge.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete ge.pthreads[t],ge.unusedWorkers.push(e),ge.runningWorkers.splice(ge.runningWorkers.indexOf(e),1),e.pthread_ptr=0,x&&e.unref(),je(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){ge.tlsInitFunctions.forEach((e=>e()))},loadWasmModuleToWorker:function(e,t){e.onmessage=n=>{var r=n.data,a=r.cmd;if(e.pthread_ptr&&(ge.currentProxiedOperationCallerThread=e.pthread_ptr),r.targetThread&&r.targetThread!=Be()){var i=ge.pthreads[r.targetThread];return i?i.postMessage(r,r.transferList):E('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(ge.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===a?ke(r.queue):"spawnThread"===a?pe(r):"cleanupThread"===a?he(r.thread):"killThread"===a?function(e){var t=ge.pthreads[e];delete ge.pthreads[e],t.terminate(),je(e),ge.runningWorkers.splice(ge.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(r.thread):"cancelThread"===a?function(e){ge.pthreads[e].postMessage({cmd:"cancel"})}(r.thread):"loaded"===a?(e.loaded=!0,x&&e.unref(),t&&t(e),e.runPthread&&e.runPthread()):"print"===a?C("Thread "+r.threadId+": "+r.text):"printErr"===a?E("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"setimmediate"===r.target?e.postMessage(r):"callHandler"===a?d[r.handler](...r.args):a&&E("worker sent an unknown command "+a),ge.currentProxiedOperationCallerThread=void 0},e.onerror=e=>{throw E("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},x&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("detachedExit",(function(){})));var n=[];for(var r of["onExit","onAbort","print","printErr"])d.hasOwnProperty(r)&&n.push(r);e.postMessage({cmd:"load",handlers:n,urlOrBlob:d.mainScriptUrlOrBlob||a,wasmMemory:R,wasmModule:P})},allocateUnusedWorker:function(){var e,t=w("tfjs-backend-wasm-threaded-simd.worker.js");e=new Worker(t),ge.unusedWorkers.push(e)},getNewWorker:function(){return 0==ge.unusedWorkers.length&&(ge.allocateUnusedWorker(),ge.loadWasmModuleToWorker(ge.unusedWorkers[0])),ge.unusedWorkers.pop()}};function ye(e){for(;e.length>0;)e.shift()(d)}function be(e){if(A)return Te(2,0,e);try{fe(e)}catch(e){!function(e){if(e instanceof ce||"unwind"==e)return L;g(1,e)}(e)}}d.PThread=ge,d.establishStackSpace=function(){var e=Be(),t=r()[e+52>>>2],n=r()[e+56>>>2];Ge(t,t-n),Xe(t)};var xe,Ae=[];function ve(e,t,n,r){return A?Te(3,1,e,t,n,r):we(e,t,n,r)}function we(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return E("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(A&&0===a.length)return ve(e,t,n,r);var i={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return A?(i.cmd="spawnThread",postMessage(i,a),0):pe(i)}function ke(e){Atomics.store(r(),e>>2,1),Be()&&Ve(e),Atomics.compareExchange(r(),e>>2,1,0)}function Se(e){Se.shown||(Se.shown={}),Se.shown[e]||(Se.shown[e]=1,x&&(e="warning: "+e),E(e))}function Te(e,t){var n=arguments.length-2,r=arguments;return function(e){var t=qe(),n=e();return Xe(t),n}((()=>{for(var a=n,i=Ke(8*a),o=i>>3,l=0;l<n;l++){var u=r[2+l];s()[o+l>>>0]=u}return We(e,a,i,t)}))}d.invokeEntryPoint=function(e,t){var n=function(e){var t=Ae[e];return t||(e>=Ae.length&&(Ae.length=e+1),Ae[e]=t=Z.get(e)),t}(e)(t);ee()?ge.setExitStatus(n):He(n)},d.executeNotifiedProxyingQueue=ke,xe=x?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:()=>performance.timeOrigin+performance.now();var _e=[];function Ie(e){try{return R.grow(e-z.byteLength+65535>>>16),X(R.buffer),1}catch(e){}}function Ce(e){return A?Te(4,1,e):52}function Ee(e,t,n,r,a){return A?Te(5,1,e,t,n,r,a):70}var Ne=[null,[],[]];function Re(e,t){var n=Ne[e];0===t||10===t?((1===e?C:E)(q(n,0)),n.length=0):n.push(t)}function Pe(e,n,r,a){if(A)return Te(6,1,e,n,r,a);for(var s=0,o=0;o<r;o++){var l=i()[n>>>2],u=i()[n+4>>>2];n+=8;for(var d=0;d<u;d++)Re(e,t()[l+d>>>0]);s+=u}return i()[a>>>2]=s,0}function De(e){return d["_"+e]}function Me(e,n,r,a,i){var s={string:e=>{var n=0;if(null!=e&&0!==e){var r=1+(e.length<<2);!function(e,n,r){!function(e,t,n,r){if(!(r>0))return 0;for(var a=(n>>>=0)+r-1,i=0;i<e.length;++i){var s=e.charCodeAt(i);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127){if(n>=a)break;t[n++>>>0]=s}else if(s<=2047){if(n+1>=a)break;t[n++>>>0]=192|s>>6,t[n++>>>0]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++>>>0]=224|s>>12,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}else{if(n+3>=a)break;t[n++>>>0]=240|s>>18,t[n++>>>0]=128|s>>12&63,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}}t[n>>>0]=0}(e,t(),n,r)}(e,n=Ke(r),r)}return n},array:e=>{var t=Ke(e.length);return function(e,t){(R.buffer!=z&&X(R.buffer),B).set(e,t>>>0)}(e,t),t}},o=De(e),l=[],u=0;if(a)for(var d=0;d<a.length;d++){var c=s[r[d]];c?(0===u&&(u=qe()),l[d]=c(a[d])):l[d]=a[d]}var h,p=o.apply(null,l);return h=p,0!==u&&Xe(u),p=function(e){return"string"===n?function(e,n){return(e>>>=0)?q(t(),e,n):""}(e):"boolean"===n?!!e:e}(h),p}ge.init();var Oe,$e,Fe,Le=[null,me,be,ve,Ce,Ee,Pe],ze={__emscripten_init_main_thread_js:function(e){Ue(e,!b,1,!y),ge.threadInitTLS()},__emscripten_thread_cleanup:function(e){A?postMessage({cmd:"cleanupThread",thread:e}):he(e)},__pthread_create_js:we,_emscripten_default_pthread_stack_size:function(){return 65536},_emscripten_get_now_is_monotonic:function(){return!0},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((()=>ke(r)));else if(A)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var a=ge.pthreads[e];if(!a)return;a.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},abort:function(){ie("")},emscripten_check_blocking_allowed:function(){x||b||Se("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 4294901760},emscripten_get_now:xe,emscripten_memcpy_big:function(e,n,r){t().copyWithin(e>>>0,n>>>0,n+r>>>0)},emscripten_num_logical_cores:function(){return x?F().cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){_e.length=t;for(var r=n>>3,a=0;a<t;a++)_e[a]=s()[r+a>>>0];return(e<0?de[-e-1]:Le[e]).apply(null,_e)},emscripten_resize_heap:function(e){var n=t().length;if((e>>>=0)<=n)return!1;var r,a=4294901760;if(e>a)return!1;for(var i=1;i<=4;i*=2){var s=n*(1+.2/i);if(s=Math.min(s,e+100663296),Ie(Math.min(a,(r=Math.max(e,s))+(65536-r%65536)%65536)))return!0}return!1},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},exit:fe,fd_close:Ce,fd_seek:Ee,fd_write:Pe,memory:R||d.wasmMemory},Be=(function(){var e={env:ze,wasi_snapshot_preview1:ze};function t(e,t){var n=e.exports;if(d.asm=n,function(e){ge.tlsInitFunctions.push(e)}(d.asm._emscripten_tls_init),Z=d.asm.__indirect_function_table,function(e){J.unshift(e)}(d.asm.__wasm_call_ctors),P=t,!A){var r=ge.unusedWorkers.length;ge.unusedWorkers.forEach((function(e){ge.loadWasmModuleToWorker(e,(function(){--r||function(e){if(ne--,d.monitorRunDependencies&&d.monitorRunDependencies(ne),0==ne&&(null!==re&&(clearInterval(re),re=null),ae)){var t=ae;ae=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!I&&(y||b)){if("function"==typeof fetch&&!le(se))return fetch(se,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+se+"'";return e.arrayBuffer()})).catch((function(){return ue(se)}));if(h)return new Promise((function(e,t){h(se,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ue(se)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){E("failed to asynchronously prepare wasm: "+e),ie(e)}))}if(A||(ne++,d.monitorRunDependencies&&d.monitorRunDependencies(ne)),d.instantiateWasm)try{return d.instantiateWasm(e,t)}catch(e){E("Module.instantiateWasm callback failed with error: "+e),l(e)}(I||"function"!=typeof WebAssembly.instantiateStreaming||oe(se)||le(se)||x||"function"!=typeof fetch?r(n):fetch(se,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return E("wasm streaming compile failed: "+e),E("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(l)}(),d.___wasm_call_ctors=function(){return(d.___wasm_call_ctors=d.asm.__wasm_call_ctors).apply(null,arguments)},d._init=function(){return(d._init=d.asm.init).apply(null,arguments)},d._init_with_threads_count=function(){return(d._init_with_threads_count=d.asm.init_with_threads_count).apply(null,arguments)},d._get_threads_count=function(){return(d._get_threads_count=d.asm.get_threads_count).apply(null,arguments)},d._register_tensor=function(){return(d._register_tensor=d.asm.register_tensor).apply(null,arguments)},d._dispose_data=function(){return(d._dispose_data=d.asm.dispose_data).apply(null,arguments)},d._dispose=function(){return(d._dispose=d.asm.dispose).apply(null,arguments)},d._Abs=function(){return(d._Abs=d.asm.Abs).apply(null,arguments)},d._Acos=function(){return(d._Acos=d.asm.Acos).apply(null,arguments)},d._Acosh=function(){return(d._Acosh=d.asm.Acosh).apply(null,arguments)},d._Add=function(){return(d._Add=d.asm.Add).apply(null,arguments)},d._AddN=function(){return(d._AddN=d.asm.AddN).apply(null,arguments)},d._All=function(){return(d._All=d.asm.All).apply(null,arguments)},d._Any=function(){return(d._Any=d.asm.Any).apply(null,arguments)},d._ArgMax=function(){return(d._ArgMax=d.asm.ArgMax).apply(null,arguments)},d._ArgMin=function(){return(d._ArgMin=d.asm.ArgMin).apply(null,arguments)},d._Asin=function(){return(d._Asin=d.asm.Asin).apply(null,arguments)},d._Asinh=function(){return(d._Asinh=d.asm.Asinh).apply(null,arguments)},d._Atan=function(){return(d._Atan=d.asm.Atan).apply(null,arguments)},d._Atan2=function(){return(d._Atan2=d.asm.Atan2).apply(null,arguments)},d._Atanh=function(){return(d._Atanh=d.asm.Atanh).apply(null,arguments)},d._AvgPool=function(){return(d._AvgPool=d.asm.AvgPool).apply(null,arguments)},d._AvgPool3D=function(){return(d._AvgPool3D=d.asm.AvgPool3D).apply(null,arguments)},d._AvgPool3DGrad=function(){return(d._AvgPool3DGrad=d.asm.AvgPool3DGrad).apply(null,arguments)},d._AvgPoolGrad=function(){return(d._AvgPoolGrad=d.asm.AvgPoolGrad).apply(null,arguments)},d._BatchMatMul=function(){return(d._BatchMatMul=d.asm.BatchMatMul).apply(null,arguments)},d._Bincount=function(){return(d._Bincount=d.asm.Bincount).apply(null,arguments)},d._BitwiseAnd=function(){return(d._BitwiseAnd=d.asm.BitwiseAnd).apply(null,arguments)},d._Ceil=function(){return(d._Ceil=d.asm.Ceil).apply(null,arguments)},d._ClipByValue=function(){return(d._ClipByValue=d.asm.ClipByValue).apply(null,arguments)},d._Conv2D=function(){return(d._Conv2D=d.asm.Conv2D).apply(null,arguments)},d._Conv2DBackpropInput=function(){return(d._Conv2DBackpropInput=d.asm.Conv2DBackpropInput).apply(null,arguments)},d._Conv3D=function(){return(d._Conv3D=d.asm.Conv3D).apply(null,arguments)},d._Conv3DBackpropFilterV2=function(){return(d._Conv3DBackpropFilterV2=d.asm.Conv3DBackpropFilterV2).apply(null,arguments)},d._Conv3DBackpropInputV2=function(){return(d._Conv3DBackpropInputV2=d.asm.Conv3DBackpropInputV2).apply(null,arguments)},d._Cos=function(){return(d._Cos=d.asm.Cos).apply(null,arguments)},d._Cosh=function(){return(d._Cosh=d.asm.Cosh).apply(null,arguments)},d._CropAndResize=function(){return(d._CropAndResize=d.asm.CropAndResize).apply(null,arguments)},d._Cumprod=function(){return(d._Cumprod=d.asm.Cumprod).apply(null,arguments)},d._Cumsum=function(){return(d._Cumsum=d.asm.Cumsum).apply(null,arguments)},d._DenseBincount=function(){return(d._DenseBincount=d.asm.DenseBincount).apply(null,arguments)},d._DepthToSpace=function(){return(d._DepthToSpace=d.asm.DepthToSpace).apply(null,arguments)},d._DepthwiseConv2dNative=function(){return(d._DepthwiseConv2dNative=d.asm.DepthwiseConv2dNative).apply(null,arguments)},d._Diag=function(){return(d._Diag=d.asm.Diag).apply(null,arguments)},d._Dilation2D=function(){return(d._Dilation2D=d.asm.Dilation2D).apply(null,arguments)},d._Dilation2DBackpropFilter=function(){return(d._Dilation2DBackpropFilter=d.asm.Dilation2DBackpropFilter).apply(null,arguments)},d._Dilation2DBackpropInput=function(){return(d._Dilation2DBackpropInput=d.asm.Dilation2DBackpropInput).apply(null,arguments)},d._Elu=function(){return(d._Elu=d.asm.Elu).apply(null,arguments)},d._EluGrad=function(){return(d._EluGrad=d.asm.EluGrad).apply(null,arguments)},d._Equal=function(){return(d._Equal=d.asm.Equal).apply(null,arguments)},d._Erf=function(){return(d._Erf=d.asm.Erf).apply(null,arguments)},d._Exp=function(){return(d._Exp=d.asm.Exp).apply(null,arguments)},d._Expm1=function(){return(d._Expm1=d.asm.Expm1).apply(null,arguments)},d._FlipLeftRight=function(){return(d._FlipLeftRight=d.asm.FlipLeftRight).apply(null,arguments)},d._Floor=function(){return(d._Floor=d.asm.Floor).apply(null,arguments)},d._FloorDiv=function(){return(d._FloorDiv=d.asm.FloorDiv).apply(null,arguments)},d._FusedBatchNorm=function(){return(d._FusedBatchNorm=d.asm.FusedBatchNorm).apply(null,arguments)},d._FusedConv2D=function(){return(d._FusedConv2D=d.asm.FusedConv2D).apply(null,arguments)},d._FusedDepthwiseConv2D=function(){return(d._FusedDepthwiseConv2D=d.asm.FusedDepthwiseConv2D).apply(null,arguments)},d._Gather=function(){return(d._Gather=d.asm.Gather).apply(null,arguments)},d._GatherNd=function(){return(d._GatherNd=d.asm.GatherNd).apply(null,arguments)},d._Greater=function(){return(d._Greater=d.asm.Greater).apply(null,arguments)},d._GreaterEqual=function(){return(d._GreaterEqual=d.asm.GreaterEqual).apply(null,arguments)},d._IsFinite=function(){return(d._IsFinite=d.asm.IsFinite).apply(null,arguments)},d._IsInf=function(){return(d._IsInf=d.asm.IsInf).apply(null,arguments)},d._IsNan=function(){return(d._IsNan=d.asm.IsNan).apply(null,arguments)},d._LRN=function(){return(d._LRN=d.asm.LRN).apply(null,arguments)},d._LRNGrad=function(){return(d._LRNGrad=d.asm.LRNGrad).apply(null,arguments)},d._LeakyRelu=function(){return(d._LeakyRelu=d.asm.LeakyRelu).apply(null,arguments)},d._Less=function(){return(d._Less=d.asm.Less).apply(null,arguments)},d._LessEqual=function(){return(d._LessEqual=d.asm.LessEqual).apply(null,arguments)},d._LinSpace=function(){return(d._LinSpace=d.asm.LinSpace).apply(null,arguments)},d._Log=function(){return(d._Log=d.asm.Log).apply(null,arguments)},d._Log1p=function(){return(d._Log1p=d.asm.Log1p).apply(null,arguments)},d._LogicalAnd=function(){return(d._LogicalAnd=d.asm.LogicalAnd).apply(null,arguments)},d._LogicalNot=function(){return(d._LogicalNot=d.asm.LogicalNot).apply(null,arguments)},d._LogicalOr=function(){return(d._LogicalOr=d.asm.LogicalOr).apply(null,arguments)},d._LogicalXor=function(){return(d._LogicalXor=d.asm.LogicalXor).apply(null,arguments)},d._Max=function(){return(d._Max=d.asm.Max).apply(null,arguments)},d._MaxPool=function(){return(d._MaxPool=d.asm.MaxPool).apply(null,arguments)},d._MaxPool3D=function(){return(d._MaxPool3D=d.asm.MaxPool3D).apply(null,arguments)},d._MaxPool3DGrad=function(){return(d._MaxPool3DGrad=d.asm.MaxPool3DGrad).apply(null,arguments)},d._MaxPoolGrad=function(){return(d._MaxPoolGrad=d.asm.MaxPoolGrad).apply(null,arguments)},d._MaxPoolWithArgmax=function(){return(d._MaxPoolWithArgmax=d.asm.MaxPoolWithArgmax).apply(null,arguments)},d._Maximum=function(){return(d._Maximum=d.asm.Maximum).apply(null,arguments)},d._Mean=function(){return(d._Mean=d.asm.Mean).apply(null,arguments)},d._Min=function(){return(d._Min=d.asm.Min).apply(null,arguments)},d._Minimum=function(){return(d._Minimum=d.asm.Minimum).apply(null,arguments)},d._MirrorPad=function(){return(d._MirrorPad=d.asm.MirrorPad).apply(null,arguments)},d._Mod=function(){return(d._Mod=d.asm.Mod).apply(null,arguments)},d._Multinomial=function(){return(d._Multinomial=d.asm.Multinomial).apply(null,arguments)},d._Multiply=function(){return(d._Multiply=d.asm.Multiply).apply(null,arguments)},d._Neg=function(){return(d._Neg=d.asm.Neg).apply(null,arguments)},d._NonMaxSuppressionV3=function(){return(d._NonMaxSuppressionV3=d.asm.NonMaxSuppressionV3).apply(null,arguments)},d._NonMaxSuppressionV4=function(){return(d._NonMaxSuppressionV4=d.asm.NonMaxSuppressionV4).apply(null,arguments)},d._NonMaxSuppressionV5=function(){return(d._NonMaxSuppressionV5=d.asm.NonMaxSuppressionV5).apply(null,arguments)},d._NotEqual=function(){return(d._NotEqual=d.asm.NotEqual).apply(null,arguments)},d._OneHot=function(){return(d._OneHot=d.asm.OneHot).apply(null,arguments)},d._PadV2=function(){return(d._PadV2=d.asm.PadV2).apply(null,arguments)},d._Pow=function(){return(d._Pow=d.asm.Pow).apply(null,arguments)},d._Prelu=function(){return(d._Prelu=d.asm.Prelu).apply(null,arguments)},d._Prod=function(){return(d._Prod=d.asm.Prod).apply(null,arguments)},d._RealDiv=function(){return(d._RealDiv=d.asm.RealDiv).apply(null,arguments)},d._Reciprocal=function(){return(d._Reciprocal=d.asm.Reciprocal).apply(null,arguments)},d._Relu=function(){return(d._Relu=d.asm.Relu).apply(null,arguments)},d._Relu6=function(){return(d._Relu6=d.asm.Relu6).apply(null,arguments)},d._ResizeBilinear=function(){return(d._ResizeBilinear=d.asm.ResizeBilinear).apply(null,arguments)},d._ResizeBilinearGrad=function(){return(d._ResizeBilinearGrad=d.asm.ResizeBilinearGrad).apply(null,arguments)},d._ResizeNearestNeighbor=function(){return(d._ResizeNearestNeighbor=d.asm.ResizeNearestNeighbor).apply(null,arguments)},d._ResizeNearestNeighborGrad=function(){return(d._ResizeNearestNeighborGrad=d.asm.ResizeNearestNeighborGrad).apply(null,arguments)},d._Reverse=function(){return(d._Reverse=d.asm.Reverse).apply(null,arguments)},d._RotateWithOffset=function(){return(d._RotateWithOffset=d.asm.RotateWithOffset).apply(null,arguments)},d._Round=function(){return(d._Round=d.asm.Round).apply(null,arguments)},d._Rsqrt=function(){return(d._Rsqrt=d.asm.Rsqrt).apply(null,arguments)},d._ScatterNd=function(){return(d._ScatterNd=d.asm.ScatterNd).apply(null,arguments)},d._SearchSorted=function(){return(d._SearchSorted=d.asm.SearchSorted).apply(null,arguments)},d._SelectV2=function(){return(d._SelectV2=d.asm.SelectV2).apply(null,arguments)},d._Selu=function(){return(d._Selu=d.asm.Selu).apply(null,arguments)},d._Sigmoid=function(){return(d._Sigmoid=d.asm.Sigmoid).apply(null,arguments)},d._Sign=function(){return(d._Sign=d.asm.Sign).apply(null,arguments)},d._Sin=function(){return(d._Sin=d.asm.Sin).apply(null,arguments)},d._Sinh=function(){return(d._Sinh=d.asm.Sinh).apply(null,arguments)},d._Softmax=function(){return(d._Softmax=d.asm.Softmax).apply(null,arguments)},d._Softplus=function(){return(d._Softplus=d.asm.Softplus).apply(null,arguments)},d._SparseFillEmptyRows=function(){return(d._SparseFillEmptyRows=d.asm.SparseFillEmptyRows).apply(null,arguments)},d._SparseReshape=function(){return(d._SparseReshape=d.asm.SparseReshape).apply(null,arguments)},d._SparseSegmentReduction=function(){return(d._SparseSegmentReduction=d.asm.SparseSegmentReduction).apply(null,arguments)},d._SparseToDense=function(){return(d._SparseToDense=d.asm.SparseToDense).apply(null,arguments)},d._Sqrt=function(){return(d._Sqrt=d.asm.Sqrt).apply(null,arguments)},d._Square=function(){return(d._Square=d.asm.Square).apply(null,arguments)},d._SquaredDifference=function(){return(d._SquaredDifference=d.asm.SquaredDifference).apply(null,arguments)},d._Step=function(){return(d._Step=d.asm.Step).apply(null,arguments)},d._StridedSlice=function(){return(d._StridedSlice=d.asm.StridedSlice).apply(null,arguments)},d._Sub=function(){return(d._Sub=d.asm.Sub).apply(null,arguments)},d._Sum=function(){return(d._Sum=d.asm.Sum).apply(null,arguments)},d._Tan=function(){return(d._Tan=d.asm.Tan).apply(null,arguments)},d._Tanh=function(){return(d._Tanh=d.asm.Tanh).apply(null,arguments)},d._TensorScatterUpdate=function(){return(d._TensorScatterUpdate=d.asm.TensorScatterUpdate).apply(null,arguments)},d._Tile=function(){return(d._Tile=d.asm.Tile).apply(null,arguments)},d._TopK=function(){return(d._TopK=d.asm.TopK).apply(null,arguments)},d._Transform=function(){return(d._Transform=d.asm.Transform).apply(null,arguments)},d._Transpose=function(){return(d._Transpose=d.asm.Transpose).apply(null,arguments)},d.__FusedMatMul=function(){return(d.__FusedMatMul=d.asm._FusedMatMul).apply(null,arguments)},d._malloc=function(){return(d._malloc=d.asm.malloc).apply(null,arguments)},d._free=function(){return(d._free=d.asm.free).apply(null,arguments)},d.__emscripten_tls_init=function(){return(d.__emscripten_tls_init=d.asm._emscripten_tls_init).apply(null,arguments)},d._pthread_self=function(){return(Be=d._pthread_self=d.asm.pthread_self).apply(null,arguments)}),Ue=(d.___errno_location=function(){return(d.___errno_location=d.asm.__errno_location).apply(null,arguments)},d.__emscripten_thread_init=function(){return(Ue=d.__emscripten_thread_init=d.asm._emscripten_thread_init).apply(null,arguments)}),We=(d.__emscripten_thread_crashed=function(){return(d.__emscripten_thread_crashed=d.asm._emscripten_thread_crashed).apply(null,arguments)},d._emscripten_main_thread_process_queued_calls=function(){return(d._emscripten_main_thread_process_queued_calls=d.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},d._emscripten_main_browser_thread_id=function(){return(d._emscripten_main_browser_thread_id=d.asm.emscripten_main_browser_thread_id).apply(null,arguments)},d._emscripten_run_in_main_runtime_thread_js=function(){return(We=d._emscripten_run_in_main_runtime_thread_js=d.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)}),Ve=(d._emscripten_dispatch_to_thread_=function(){return(d._emscripten_dispatch_to_thread_=d.asm.emscripten_dispatch_to_thread_).apply(null,arguments)},d.__emscripten_proxy_execute_task_queue=function(){return(Ve=d.__emscripten_proxy_execute_task_queue=d.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)}),je=d.__emscripten_thread_free_data=function(){return(je=d.__emscripten_thread_free_data=d.asm._emscripten_thread_free_data).apply(null,arguments)},He=d.__emscripten_thread_exit=function(){return(He=d.__emscripten_thread_exit=d.asm._emscripten_thread_exit).apply(null,arguments)},Ge=d._emscripten_stack_set_limits=function(){return(Ge=d._emscripten_stack_set_limits=d.asm.emscripten_stack_set_limits).apply(null,arguments)},qe=d.stackSave=function(){return(qe=d.stackSave=d.asm.stackSave).apply(null,arguments)},Xe=d.stackRestore=function(){return(Xe=d.stackRestore=d.asm.stackRestore).apply(null,arguments)},Ke=d.stackAlloc=function(){return(Ke=d.stackAlloc=d.asm.stackAlloc).apply(null,arguments)};function Ze(e){if(e=e||f,!(ne>0)){if(A)return o(d),te(),void startWorker(d);(function(){if(d.preRun)for("function"==typeof d.preRun&&(d.preRun=[d.preRun]);d.preRun.length;)e=d.preRun.shift(),Y.unshift(e);var e;ye(Y)})(),ne>0||(d.setStatus?(d.setStatus("Running..."),setTimeout((function(){setTimeout((function(){d.setStatus("")}),1),t()}),1)):t())}function t(){Oe||(Oe=!0,d.calledRun=!0,!H&&(te(),o(d),d.onRuntimeInitialized&&d.onRuntimeInitialized(),function(){if(!A){if(d.postRun)for("function"==typeof d.postRun&&(d.postRun=[d.postRun]);d.postRun.length;)e=d.postRun.shift(),Q.unshift(e);ye(Q)}var e}()))}}if(d.dynCall_iijjiiii=function(){return(d.dynCall_iijjiiii=d.asm.dynCall_iijjiiii).apply(null,arguments)},d.dynCall_jiji=function(){return(d.dynCall_jiji=d.asm.dynCall_jiji).apply(null,arguments)},d.keepRuntimeAlive=ee,d.wasmMemory=R,d.cwrap=function(e,t,n,r){var a=(n=n||[]).every((e=>"number"===e||"boolean"===e));return"string"!==t&&a&&!r?De(e):function(){return Me(e,t,n,arguments)}},d.ExitStatus=ce,d.PThread=ge,ae=function e(){Oe||Ze(),Oe||(ae=e)},d.preInit)for("function"==typeof d.preInit&&(d.preInit=[d.preInit]);d.preInit.length>0;)d.preInit.pop()();if(Ze(),u&&($e={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!u.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!u.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)Fe=WasmBackendModule;else{if(void 0===e)throw new Error("Could not find wasm module in post.js");Fe=e}if($e){var Ye=Fe._dispose;Fe._dispose=function(){Ye(),$e.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),$e.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return e.ready});"object"==typeof e&&"object"==typeof t?t.exports=i:"function"==typeof define&&n.amdO?define([],(function(){return i})):"object"==typeof e&&(e.WasmBackendModuleThreadedSimd=i)})),z=b(((e,t)=>{t.exports.wasmWorkerContents='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};'})),B=b(((e,t)=>{var a,i=(a=(a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||r,function(e){var t,n,r,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,r){t=e,n=r})),"undefined"!=typeof process&&process.listeners&&(r={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var s,o,l,u=Object.assign({},i),d=[],c="object"==typeof window,h="function"==typeof importScripts,p="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";if(p){var f=D(),g=M();m=h?g.dirname(m)+"/":"//",s=(e,t)=>(e=U(e)?new URL(e):g.normalize(e),f.readFileSync(e,t?void 0:"utf8")),l=e=>{var t=s(e,!0);return t.buffer||(t=new Uint8Array(t)),t},o=(e,t,n)=>{e=U(e)?new URL(e):g.normalize(e),f.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),d=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof V))throw e})),process.on("unhandledRejection",(function(e){throw e})),i.inspect=function(){return"[Emscripten Module object]"}}else(c||h)&&(h?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),a&&(m=a),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",s=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(l=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),o=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var y,b=i.print||console.log.bind(console),x=i.printErr||console.warn.bind(console);Object.assign(i,u),u=null,i.arguments&&(d=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit,i.wasmBinary&&(y=i.wasmBinary),i.noExitRuntime,"object"!=typeof WebAssembly&&F("no native wasm support detected");var A,v,w,k,S,T=!1,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function I(e,t,n){for(var r=(t>>>=0)+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&_)return _.decode(e.subarray(t,a));for(var i="";t<a;){var s=e[t++];if(128&s){var o=63&e[t++];if(192!=(224&s)){var l=63&e[t++];if((s=224==(240&s)?(15&s)<<12|o<<6|l:(7&s)<<18|o<<12|l<<6|63&e[t++])<65536)i+=String.fromCharCode(s);else{var u=s-65536;i+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else i+=String.fromCharCode((31&s)<<6|o)}else i+=String.fromCharCode(s)}return i}function C(e){v=e,i.HEAP8=w=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=new Int32Array(e),i.HEAPU8=k=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=S=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var E=[],N=[],R=[],P=0,O=null,$=null;function F(e){i.onAbort&&i.onAbort(e),x(e="Aborted("+e+")"),T=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}var L,z;function B(e){return e.startsWith("data:application/octet-stream;base64,")}function U(e){return e.startsWith("file://")}function W(e){try{if(e==L&&y)return new Uint8Array(y);if(l)return l(e);throw"both async and sync fetching of the wasm failed"}catch(e){F(e)}}function V(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function j(e){for(;e.length>0;)e.shift()(i)}function H(e){try{return A.grow(e-v.byteLength+65535>>>16),C(A.buffer),1}catch(e){}}B(L="tfjs-backend-wasm.wasm")||(z=L,L=i.locateFile?i.locateFile(z,m):m+z);var G=[null,[],[]];function q(e,t){var n=G[e];0===t||10===t?((1===e?b:x)(I(n,0)),n.length=0):n.push(t)}function X(e){return i["_"+e]}function K(e,t,n,r,a){var i={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function(e,t,n){!function(e,t,n,r){if(!(r>0))return 0;for(var a=(n>>>=0)+r-1,i=0;i<e.length;++i){var s=e.charCodeAt(i);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127){if(n>=a)break;t[n++>>>0]=s}else if(s<=2047){if(n+1>=a)break;t[n++>>>0]=192|s>>6,t[n++>>>0]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++>>>0]=224|s>>12,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}else{if(n+3>=a)break;t[n++>>>0]=240|s>>18,t[n++>>>0]=128|s>>12&63,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}}t[n>>>0]=0}(e,k,t,n)}(e,t=ne(n),n)}return t},array:e=>{var t=ne(e.length);return function(e,t){w.set(e,t>>>0)}(e,t),t}},s=X(e),o=[],l=0;if(r)for(var u=0;u<r.length;u++){var d=i[n[u]];d?(0===l&&(l=ee()),o[u]=d(r[u])):o[u]=r[u]}var c,h=s.apply(null,o);return c=h,0!==l&&te(l),h=function(e){return"string"===t?function(e,t){return(e>>>=0)?I(k,e,t):""}(e):"boolean"===t?!!e:e}(c),h}var Z,Y,J,Q={abort:function(){F("")},emscripten_get_heap_max:function(){return 4294901760},emscripten_memcpy_big:function(e,t,n){k.copyWithin(e>>>0,t>>>0,t+n>>>0)},emscripten_resize_heap:function(e){var t,n=k.length,r=4294901760;if((e>>>=0)>r)return!1;for(var a=1;a<=4;a*=2){var i=n*(1+.2/a);if(i=Math.min(i,e+100663296),H(Math.min(r,(t=Math.max(e,i))+(65536-t%65536)%65536)))return!0}return!1},fd_close:function(e){return 52},fd_seek:function(e,t,n,r,a){return 70},fd_write:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var s=S[t>>>2],o=S[t+4>>>2];t+=8;for(var l=0;l<o;l++)q(e,k[s+l>>>0]);a+=o}return S[r>>>2]=a,0}},ee=(function(){var e={env:Q,wasi_snapshot_preview1:Q};function t(e,t){var n=e.exports;i.asm=n,C((A=i.asm.memory).buffer),i.asm.__indirect_function_table,function(e){N.unshift(e)}(i.asm.__wasm_call_ctors),function(e){if(P--,i.monitorRunDependencies&&i.monitorRunDependencies(P),0==P&&(null!==O&&(clearInterval(O),O=null),$)){var t=$;$=null,t()}}()}function r(e){t(e.instance)}function a(t){return function(){if(!y&&(c||h)){if("function"==typeof fetch&&!U(L))return fetch(L,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+L+"'";return e.arrayBuffer()})).catch((function(){return W(L)}));if(o)return new Promise((function(e,t){o(L,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return W(L)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){x("failed to asynchronously prepare wasm: "+e),F(e)}))}if(P++,i.monitorRunDependencies&&i.monitorRunDependencies(P),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){x("Module.instantiateWasm callback failed with error: "+e),n(e)}(y||"function"!=typeof WebAssembly.instantiateStreaming||B(L)||U(L)||p||"function"!=typeof fetch?a(r):fetch(L,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),a(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.__wasm_call_ctors).apply(null,arguments)},i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._init_with_threads_count=function(){return(i._init_with_threads_count=i.asm.init_with_threads_count).apply(null,arguments)},i._get_threads_count=function(){return(i._get_threads_count=i.asm.get_threads_count).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Acos=function(){return(i._Acos=i.asm.Acos).apply(null,arguments)},i._Acosh=function(){return(i._Acosh=i.asm.Acosh).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._All=function(){return(i._All=i.asm.All).apply(null,arguments)},i._Any=function(){return(i._Any=i.asm.Any).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._ArgMin=function(){return(i._ArgMin=i.asm.ArgMin).apply(null,arguments)},i._Asin=function(){return(i._Asin=i.asm.Asin).apply(null,arguments)},i._Asinh=function(){return(i._Asinh=i.asm.Asinh).apply(null,arguments)},i._Atan=function(){return(i._Atan=i.asm.Atan).apply(null,arguments)},i._Atan2=function(){return(i._Atan2=i.asm.Atan2).apply(null,arguments)},i._Atanh=function(){return(i._Atanh=i.asm.Atanh).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._AvgPool3D=function(){return(i._AvgPool3D=i.asm.AvgPool3D).apply(null,arguments)},i._AvgPool3DGrad=function(){return(i._AvgPool3DGrad=i.asm.AvgPool3DGrad).apply(null,arguments)},i._AvgPoolGrad=function(){return(i._AvgPoolGrad=i.asm.AvgPoolGrad).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._Bincount=function(){return(i._Bincount=i.asm.Bincount).apply(null,arguments)},i._BitwiseAnd=function(){return(i._BitwiseAnd=i.asm.BitwiseAnd).apply(null,arguments)},i._Ceil=function(){return(i._Ceil=i.asm.Ceil).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Conv3D=function(){return(i._Conv3D=i.asm.Conv3D).apply(null,arguments)},i._Conv3DBackpropFilterV2=function(){return(i._Conv3DBackpropFilterV2=i.asm.Conv3DBackpropFilterV2).apply(null,arguments)},i._Conv3DBackpropInputV2=function(){return(i._Conv3DBackpropInputV2=i.asm.Conv3DBackpropInputV2).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._Cosh=function(){return(i._Cosh=i.asm.Cosh).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumprod=function(){return(i._Cumprod=i.asm.Cumprod).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DenseBincount=function(){return(i._DenseBincount=i.asm.DenseBincount).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Diag=function(){return(i._Diag=i.asm.Diag).apply(null,arguments)},i._Dilation2D=function(){return(i._Dilation2D=i.asm.Dilation2D).apply(null,arguments)},i._Dilation2DBackpropFilter=function(){return(i._Dilation2DBackpropFilter=i.asm.Dilation2DBackpropFilter).apply(null,arguments)},i._Dilation2DBackpropInput=function(){return(i._Dilation2DBackpropInput=i.asm.Dilation2DBackpropInput).apply(null,arguments)},i._Elu=function(){return(i._Elu=i.asm.Elu).apply(null,arguments)},i._EluGrad=function(){return(i._EluGrad=i.asm.EluGrad).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Erf=function(){return(i._Erf=i.asm.Erf).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._Expm1=function(){return(i._Expm1=i.asm.Expm1).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._Floor=function(){return(i._Floor=i.asm.Floor).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._IsFinite=function(){return(i._IsFinite=i.asm.IsFinite).apply(null,arguments)},i._IsInf=function(){return(i._IsInf=i.asm.IsInf).apply(null,arguments)},i._IsNan=function(){return(i._IsNan=i.asm.IsNan).apply(null,arguments)},i._LRN=function(){return(i._LRN=i.asm.LRN).apply(null,arguments)},i._LRNGrad=function(){return(i._LRNGrad=i.asm.LRNGrad).apply(null,arguments)},i._LeakyRelu=function(){return(i._LeakyRelu=i.asm.LeakyRelu).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._LinSpace=function(){return(i._LinSpace=i.asm.LinSpace).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._Log1p=function(){return(i._Log1p=i.asm.Log1p).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._LogicalNot=function(){return(i._LogicalNot=i.asm.LogicalNot).apply(null,arguments)},i._LogicalOr=function(){return(i._LogicalOr=i.asm.LogicalOr).apply(null,arguments)},i._LogicalXor=function(){return(i._LogicalXor=i.asm.LogicalXor).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._MaxPool3D=function(){return(i._MaxPool3D=i.asm.MaxPool3D).apply(null,arguments)},i._MaxPool3DGrad=function(){return(i._MaxPool3DGrad=i.asm.MaxPool3DGrad).apply(null,arguments)},i._MaxPoolGrad=function(){return(i._MaxPoolGrad=i.asm.MaxPoolGrad).apply(null,arguments)},i._MaxPoolWithArgmax=function(){return(i._MaxPoolWithArgmax=i.asm.MaxPoolWithArgmax).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Mean=function(){return(i._Mean=i.asm.Mean).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._MirrorPad=function(){return(i._MirrorPad=i.asm.MirrorPad).apply(null,arguments)},i._Mod=function(){return(i._Mod=i.asm.Mod).apply(null,arguments)},i._Multinomial=function(){return(i._Multinomial=i.asm.Multinomial).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Neg=function(){return(i._Neg=i.asm.Neg).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Prod=function(){return(i._Prod=i.asm.Prod).apply(null,arguments)},i._RealDiv=function(){return(i._RealDiv=i.asm.RealDiv).apply(null,arguments)},i._Reciprocal=function(){return(i._Reciprocal=i.asm.Reciprocal).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._ResizeBilinearGrad=function(){return(i._ResizeBilinearGrad=i.asm.ResizeBilinearGrad).apply(null,arguments)},i._ResizeNearestNeighbor=function(){return(i._ResizeNearestNeighbor=i.asm.ResizeNearestNeighbor).apply(null,arguments)},i._ResizeNearestNeighborGrad=function(){return(i._ResizeNearestNeighborGrad=i.asm.ResizeNearestNeighborGrad).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Round=function(){return(i._Round=i.asm.Round).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SearchSorted=function(){return(i._SearchSorted=i.asm.SearchSorted).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Selu=function(){return(i._Selu=i.asm.Selu).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sign=function(){return(i._Sign=i.asm.Sign).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Sinh=function(){return(i._Sinh=i.asm.Sinh).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._Softplus=function(){return(i._Softplus=i.asm.Softplus).apply(null,arguments)},i._SparseFillEmptyRows=function(){return(i._SparseFillEmptyRows=i.asm.SparseFillEmptyRows).apply(null,arguments)},i._SparseReshape=function(){return(i._SparseReshape=i.asm.SparseReshape).apply(null,arguments)},i._SparseSegmentReduction=function(){return(i._SparseSegmentReduction=i.asm.SparseSegmentReduction).apply(null,arguments)},i._SparseToDense=function(){return(i._SparseToDense=i.asm.SparseToDense).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._Step=function(){return(i._Step=i.asm.Step).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tan=function(){return(i._Tan=i.asm.Tan).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._TensorScatterUpdate=function(){return(i._TensorScatterUpdate=i.asm.TensorScatterUpdate).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._TopK=function(){return(i._TopK=i.asm.TopK).apply(null,arguments)},i._Transform=function(){return(i._Transform=i.asm.Transform).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.___errno_location=function(){return(i.___errno_location=i.asm.__errno_location).apply(null,arguments)},i.stackSave=function(){return(ee=i.stackSave=i.asm.stackSave).apply(null,arguments)}),te=i.stackRestore=function(){return(te=i.stackRestore=i.asm.stackRestore).apply(null,arguments)},ne=i.stackAlloc=function(){return(ne=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)};function re(e){function n(){Z||(Z=!0,i.calledRun=!0,!T&&(j(N),t(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),R.unshift(e);var e;j(R)}()))}e=e||d,P>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),E.unshift(e);var e;j(E)}(),P>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),n()}),1)):n())}if(i.dynCall_iijjiiii=function(){return(i.dynCall_iijjiiii=i.asm.dynCall_iijjiiii).apply(null,arguments)},i.dynCall_jiji=function(){return(i.dynCall_jiji=i.asm.dynCall_jiji).apply(null,arguments)},i.cwrap=function(e,t,n,r){var a=(n=n||[]).every((e=>"number"===e||"boolean"===e));return"string"!==t&&a&&!r?X(e):function(){return K(e,t,n,arguments)}},$=function e(){Z||re(),Z||($=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();if(re(),r&&(Y={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!r.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!r.unhandledRejection.indexOf(e)>-1}))}),void 0!==e)J=e;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");J=WasmBackendModuleThreadedSimd}if(Y){var ae=J._dispose;J._dispose=function(){ae(),Y.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),Y.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return e.ready});"object"==typeof e&&"object"==typeof t?t.exports=i:"function"==typeof define&&n.amdO?define([],(function(){return i})):"object"==typeof e&&(e.WasmBackendModule=i)})),U=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},W=class{refCount(e){return V("refCount")}incRef(e){return V("incRef")}timerAvailable(){return!0}time(e){return V("time")}read(e){return V("read")}readSync(e){return V("readSync")}readToGPU(e,t){return V("readToGPU")}numDataIds(){return V("numDataIds")}disposeData(e,t){return V("disposeData")}write(e,t,n){return V("write")}move(e,t,n,r,a){return V("move")}createTensorFromGPUData(e,t,n){return V("createTensorFromGPUData")}memory(){return V("memory")}floatPrecision(){return V("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return V("dispose")}};function V(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function j(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,X(e,t,n)}function H(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,X(e,n,r),X(t,n,r)}function G(e,t,n){return Math.max(e,Math.min(t,n))}function q(e){return e%2==0?e:e+1}function X(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function K(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function Z(e,t){let n=Math.random();return t*n+(1-n)*e}function Y(e,t){let n=0;for(let r=0;r<e.length;r++){let a=Number(e[r])-Number(t[r]);n+=a*a}return n}function J(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Q(e,t,n=""){J(ae(e,t),(()=>n+` Shapes ${e} and ${t} must match`))}function ee(e){J(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function te(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function ne(e){return 0===e.length}function re(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}function ae(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ie(e){return e%1==0}function se(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{let t=Math.exp(2*e);return(t-1)/(t+1)}}function oe(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function le(e){let t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return j(t),t}function ue(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function de(e,t=(e=>0),n,r){return new Promise(((a,i)=>{let s=0,o=()=>{if(e())return void a();s++;let l=t(s);null!=n&&s>=n?i():null!=r?r(o,l):setTimeout(o,l)};o()}))}function ce(e,t){let n=1,r=-1;for(let t=0;t<e.length;++t)if(e[t]>=0)n*=e[t];else if(-1===e[t]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${t}`);r=t}else if(e[t]<0)throw Error(`Shapes can not be < 0. Found ${e[t]} at dim ${t}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);let a=e.slice();return a[r]=t/n,a}function he(e,t){let n=t.length;return J((e=null==e?t.map(((e,t)=>t)):[].concat(e)).every((e=>e>=-n&&e<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`)),J(e.every((e=>ie(e))),(()=>`All values in axis param must be integers but got axis ${e}`)),e.map((e=>e<0?n+e:e))}function pe(e,t){let n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:he(t,e).sort(),s=0;for(let t=0;t<e.length;++t){if(null!=i){if(i[s]===t&&1!==e[t])throw new Error(`Can't squeeze axis ${t} since its dim '${e[t]}' is not 1`);(null==i[s]||i[s]>t)&&1===e[t]&&(n.push(e[t]),r.push(t)),i[s]<=t&&s++}1!==e[t]&&(n.push(e[t]),r.push(t))}return{newShape:n,keptDims:r}}function me(e,t){return fe(e,t)}function fe(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error(`Unknown data type ${e}`);n=new Array(t)}return n}function ge(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function ye(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function be(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function xe(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error(`Unknown dtype ${e}`)}function Ae(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}function ve(e){return"string"==typeof e||e instanceof String}function we(e){return"boolean"==typeof e}function ke(e){return"number"==typeof e}function Se(e){return Array.isArray(e)?Se(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":ke(e)?"float32":ve(e)?"string":we(e)?"bool":"float32"}function Te(e){return!!(e&&e.constructor&&e.call&&e.apply)}function _e(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function Ie(e){let t=e.length;if(t<2)return[];let n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Ce(e,t,n,r=!1){let a=new Array;if(1===t.length){let i=t[0]*(r?2:1);for(let t=0;t<i;t++)a[t]=n[e+t]}else{let i=t[0],s=t.slice(1),o=s.reduce(((e,t)=>e*t))*(r?2:1);for(let t=0;t<i;t++)a[t]=Ce(e+t*o,s,n,r)}return a}function Ee(e,t,n=!1){if(0===e.length)return t[0];let r=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return Ce(0,e,t,n)}function Ne(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function Re(e,t){let n=Pe(e,t);for(let e=0;e<n.length;e++)n[e]=1;return n}function Pe(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function De(e,t){let n=e.reduce(((e,t)=>e*t),1);if(null==t||"float32"===t)return Ee(e,new Float32Array(n));if("int32"===t)return Ee(e,new Int32Array(n));if("bool"===t)return Ee(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function Me(e){e.forEach((t=>{J(Number.isInteger(t)&&t>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`))}))}function Oe(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let t=0;t<e.length-1;++t)r+=n[t]*e[t];return r}function $e(e,t,n){if(0===t)return[];if(1===t)return[e];let r=new Array(t);for(let t=0;t<r.length-1;++t)r[t]=Math.floor(e/n[t]),e-=r[t]*n[t];return r[r.length-1]=e,r}function Fe(e){return e&&e.then&&"function"==typeof e.then}var Le="tfjsflags",ze=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Be,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(Ue().getBool("IS_TEST")||Ue().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){let t=this.urlFlags[e];Ue().getBool("IS_TEST")||Ue().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(Fe(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;let e=this.getQueryParams(this.global.location.search);Le in e&&e[Le].split(",").forEach((e=>{let[t,n]=e.split(":");this.urlFlags[t]=function(e,t){let n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:""+ +n===n?+n:t}(0,n)}))}};function Be(e){let t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")))),t}function Ue(){return Ve}var We,Ve=null;function je(){if(null==We){let e;if("undefined"!=typeof window)e=window;else if(void 0!==n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}We=e}return We}function He(e,t){let n=function(){let e=je();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{let r=t();return n.set(e,r),n.get(e)}}var Ge="Abs",qe="Acos",Xe="Acosh",Ke="Add",Ze="AddN",Ye="All",Je="Any",Qe="ArgMax",et="ArgMin",tt="Asin",nt="Asinh",rt="Atan",at="Atanh",it="Atan2",st="AvgPool",ot="AvgPoolGrad",lt="AvgPool3D",ut="AvgPool3DGrad",dt="BatchMatMul",ct="BatchToSpaceND",ht="Bincount",pt="BitwiseAnd",mt="BroadcastTo",ft="BroadcastArgs",gt="Cast",yt="Ceil",bt="ClipByValue",xt="Complex",At="ComplexAbs",vt="Concat",wt="Conv2D",kt="Conv2DBackpropFilter",St="Conv2DBackpropInput",Tt="Conv3D",_t="Conv3DBackpropFilterV2",It="Conv3DBackpropInputV2",Ct="Cos",Et="Cosh",Nt="Cumprod",Rt="Cumsum",Pt="CropAndResize",Dt="DenseBincount",Mt="DepthToSpace",Ot="DepthwiseConv2dNative",$t="DepthwiseConv2dNativeBackpropFilter",Ft="DepthwiseConv2dNativeBackpropInput",Lt="Diag",zt="Dilation2D",Bt="Dilation2DBackpropInput",Ut="Dilation2DBackpropFilter",Wt="Draw",Vt="RealDiv",jt="Einsum",Ht="Elu",Gt="EluGrad",qt="Erf",Xt="Equal",Kt="Exp",Zt="ExpandDims",Yt="Expm1",Jt="FFT",Qt="Fill",en="FlipLeftRight",tn="Floor",nn="FloorDiv",rn="FusedBatchNorm",an="GatherV2",sn="GatherNd",on="Greater",ln="GreaterEqual",un="Identity",dn="IFFT",cn="Imag",hn="IsFinite",pn="IsInf",mn="IsNan",fn="LeakyRelu",gn="Less",yn="LessEqual",bn="LinSpace",xn="Log",An="Log1p",vn="LogicalAnd",wn="LogicalNot",kn="LogicalOr",Sn="LogicalXor",Tn="LogSoftmax",_n="LowerBound",In="LRN",Cn="LRNGrad",En="MatrixBandPart",Nn="Max",Rn="Maximum",Pn="MaxPool",Dn="MaxPoolGrad",Mn="MaxPool3D",On="MaxPool3DGrad",$n="MaxPoolWithArgmax",Fn="Mean",Ln="Min",zn="Minimum",Bn="MirrorPad",Un="Mod",Wn="Multinomial",Vn="Multiply",jn="Neg",Hn="NotEqual",Gn="NonMaxSuppressionV3",qn="NonMaxSuppressionV4",Xn="NonMaxSuppressionV5",Kn="OnesLike",Zn="OneHot",Yn="Pack",Jn="PadV2",Qn="Pool",er="Pow",tr="Prelu",nr="Prod",rr="RaggedGather",ar="RaggedRange",ir="RaggedTensorToTensor",sr="Range",or="Real",lr="Reciprocal",ur="Relu",dr="Reshape",cr="ResizeNearestNeighbor",hr="ResizeNearestNeighborGrad",pr="ResizeBilinear",mr="ResizeBilinearGrad",fr="Relu6",gr="Reverse",yr="Round",br="Rsqrt",xr="ScatterNd",Ar="TensorScatterUpdate",vr="SearchSorted",wr="Select",kr="Selu",Sr="Slice",Tr="Sin",_r="Sinh",Ir="Sign",Cr="Sigmoid",Er="Softplus",Nr="Sqrt",Rr="Sum",Pr="SpaceToBatchND",Dr="SplitV",Mr="Softmax",Or="SparseFillEmptyRows",$r="SparseReshape",Fr="SparseSegmentMean",Lr="SparseSegmentSum",zr="SparseToDense",Br="SquaredDifference",Ur="Square",Wr="StaticRegexReplace",Vr="StridedSlice",jr="StringNGrams",Hr="StringSplit",Gr="StringToHashBucketFast",qr="Sub",Xr="Tan",Kr="Tanh",Zr="Tile",Yr="TopK",Jr="Transform",Qr="Transpose",ea="Unique",ta="Unpack",na="UnsortedSegmentSum",ra="UpperBound",aa="ZerosLike",ia="Step",sa="FromPixels",oa="RotateWithOffset",la="_FusedMatMul",ua="FusedConv2D",da="FusedDepthwiseConv2D";function ca(...e){Ue().getBool("IS_TEST")||Ue().getBool("PROD")||console.warn(...e)}function ha(...e){Ue().getBool("IS_TEST")||Ue().getBool("PROD")||console.log(...e)}var pa=He("kernelRegistry",(()=>new Map)),ma=He("gradRegistry",(()=>new Map));function fa(e,t){let n=ka(e,t);return pa.get(n)}function ga(e){return ma.get(e)}function ya(e){let t=pa.entries(),n=[];for(;;){let{done:r,value:a}=t.next();if(r)break;let[i,s]=a,[o]=i.split("_");o===e&&n.push(s)}return n}function ba(e){let{kernelName:t,backendName:n}=e,r=ka(t,n);pa.has(r)&&ca(`The kernel '${t}' for backend '${n}' is already registered`),pa.set(r,e)}function xa(e){let{kernelName:t}=e;ma.has(t)&&Ue().getBool("DEBUG")&&ca(`Overriding the gradient for '${t}'`),ma.set(t,e)}function Aa(e,t){let n=ka(e,t);if(!pa.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);pa.delete(n)}function va(e){if(!ma.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);ma.delete(e)}function wa(e,t){ya(e).forEach((e=>{ba(Object.assign({},e,{backendName:t}))}))}function ka(e,t){return`${t}_${e}`}var Sa={};function Ta(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}x(Sa,{arraysEqual:()=>ae,arraysEqualWithNull:()=>re,assert:()=>J,assertNonNegativeIntegerDimensions:()=>Me,assertNonNull:()=>ee,assertShapesMatch:()=>Q,bytesFromStringArray:()=>Ae,bytesPerElement:()=>xe,checkConversionForErrors:()=>ge,clamp:()=>G,computeStrides:()=>Ie,convertBackendValuesAndArrayBuffer:()=>Ne,createScalarValue:()=>Ba,createShuffledIndices:()=>le,decodeString:()=>Ha,distSquared:()=>Y,encodeString:()=>ja,fetch:()=>Va,fingerPrint64:()=>za,flatten:()=>qa,getArrayFromDType:()=>fe,getTypedArrayFromDType:()=>me,hasEncodingLoss:()=>be,hexToLong:()=>Ca,indexToLoc:()=>$e,inferDtype:()=>Se,inferFromImplicitShape:()=>ce,isBoolean:()=>we,isFunction:()=>Te,isInt:()=>ie,isNumber:()=>ke,isPromise:()=>Fe,isScalarShape:()=>ne,isString:()=>ve,isTypedArray:()=>Ga,isValidDtype:()=>ye,locToIndex:()=>Oe,makeOnesTypedArray:()=>Re,makeZerosNestedTypedArray:()=>De,makeZerosTypedArray:()=>Pe,nearestDivisor:()=>_e,nearestLargerEven:()=>q,now:()=>Wa,parseAxisParam:()=>he,randUniform:()=>Z,repeatedTry:()=>de,rightPad:()=>ue,shuffle:()=>j,shuffleCombo:()=>H,sizeFromShape:()=>te,sizeToSquarishShape:()=>oe,squeezeShape:()=>pe,sum:()=>K,swap:()=>X,tanh:()=>se,toNestedArray:()=>Ee,toTypedArray:()=>Ua});var _a=A(v()),Ia=_a.default||_a;function Ca(e){return Ia.fromString(e,!0,16)}var Ea=Ca("c3a5c85c97cb3127"),Na=Ca("b492b66fbe98f273"),Ra=Ca("9ae16a3b2f90404f");function Pa(e){return e.xor(e.shru(47))}function Da(e,t,n){let r=e.slice(t,t+n);return Ia.fromBytes(Array.from(r),!0,!0)}function Ma(e,t){return Da(e,t,8)}function Oa(e,t){return Da(e,t,4)}function $a(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function Fa(e,t,n=Ca("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function La(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=$a(i.add(a).add(r),21);let s=a;return a=(a=a.add(t)).add(n),i=i.add($a(a,44)),[a.add(r),i.add(s)]}(Ma(e,t),Ma(e,t+8),Ma(e,t+16),Ma(e,t+24),n,r)}function za(e,t=e.length){let n=Ia.fromNumber(81,!0);if(t<=32)return t<=16?function(e,t=e.length){if(t>=8){let n=Ra.add(2*t),r=Ma(e,0).add(Ra),a=Ma(e,t-8);return Fa($a(a,37).mul(n).add(r),$a(r,25).add(a).mul(n),n)}if(t>=4){let n=Ra.add(2*t);return Fa(Oa(e,0).shl(3).add(t),Oa(e,t-4),n)}if(t>0){let n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return Pa(Ra.mul(n).xor(Ea.mul(r))).mul(Ra)}return Ra}(e,t):function(e,t=e.length){let n=Ra.add(2*t),r=Ma(e,0).mul(Na),a=Ma(e,8),i=Ma(e,t-8).mul(n),s=Ma(e,t-16).mul(Ra);return Fa($a(r.add(a),43).add($a(i,30)).add(s),r.add($a(a.add(Ra),18)).add(i),n)}(e,t);if(t<=64)return function(e,t=e.length){let n=Ra.add(2*t),r=Ma(e,0).mul(Ra),a=Ma(e,8),i=Ma(e,t-8).mul(n),s=Ma(e,t-16).mul(Ra),o=$a(r.add(a),43).add($a(i,30)).add(s),l=Fa(o,r.add($a(a.add(Ra),18)).add(i),n),u=Ma(e,16).mul(n),d=Ma(e,24),c=o.add(Ma(e,t-32)).mul(n),h=l.add(Ma(e,t-24)).mul(n);return Fa($a(u.add(d),43).add($a(c,30)).add(h),u.add($a(d.add(r),18)).add(c),n)}(e,t);let r=n,a=n.mul(Na).add(113),i=Pa(a.mul(Ra).add(113)).mul(Ra),s=[Ia.UZERO,Ia.UZERO],o=[Ia.UZERO,Ia.UZERO];r=r.mul(Ra).add(Ma(e,0));let l=0,u=64*(t-1>>6),d=u+(t-1&63)-63;do{r=$a(r.add(a).add(s[0]).add(Ma(e,l+8)),37).mul(Na),a=$a(a.add(s[1]).add(Ma(e,l+48)),42).mul(Na),r=r.xor(o[1]),a=a.add(s[0]).add(Ma(e,l+40)),i=$a(i.add(o[0]),33).mul(Na),s=La(e,l,s[1].mul(Na),r.add(o[0])),o=La(e,l+32,i.add(o[1]),a.add(Ma(e,l+16))),[i,r]=[r,i],l+=64}while(l!==u);let c=Na.add(i.and(255).shl(1));return l=d,o[0]=o[0].add(t-1&63),s[0]=s[0].add(o[0]),o[0]=o[0].add(s[0]),r=$a(r.add(a).add(s[0]).add(Ma(e,l+8)),37).mul(c),a=$a(a.add(s[1]).add(Ma(e,l+48)),42).mul(c),r=r.xor(o[1].mul(9)),a=a.add(s[0].mul(9).add(Ma(e,l+40))),i=$a(i.add(o[0]),33).mul(c),s=La(e,l,s[1].mul(c),r.add(o[0])),o=La(e,l+32,i.add(o[1]),a.add(Ma(e,l+16))),[i,r]=[r,i],Fa(Fa(s[0],o[0],c).add(Pa(a).mul(Ea)).add(i),Fa(s[1],o[1],c).add(r),c)}function Ba(e,t){return"string"===t?ja(e):Ua([e],t)}function Ua(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=qa(e)),Ue().getBool("DEBUG")&&ge(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){let t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error(`Unknown data type ${t}`)}function Wa(){return Ue().platform.now()}function Va(e,t){return Ue().platform.fetch(e,t)}function ja(e,t="utf-8"){return t=t||"utf-8",Ue().platform.encode(e,t)}function Ha(e,t="utf-8"){return t=t||"utf-8",Ue().platform.decode(e,t)}function Ga(e){return null!=Ue().platform.isTypedArray?Ue().platform.isTypedArray(e):Ta(e)}function qa(e,t=[],n=!1){if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||Fe(e)||null==e||Ga(e)&&n)t.push(e);else if(Array.isArray(e)||Ga(e))for(let r=0;r<e.length;++r)qa(e[r],t,n);else{let r=-1;for(let t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let a=0;a<=r;a++)qa(e[a],t,n)}return t}function Xa(e,t,n){if("float32"!==t)return!1;for(let t=0;t<e.length;t++){let r=e[t];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}var Ka=20,Za=3,Ya=7;function Ja(e,t,n,r){let a=Ie(t),i=function(e,t,n,r){let a=te(t),i=r[r.length-1],s=new Array(i).fill(0),o=t.length,l="complex64"===n?ni(e):e;if(o>1)for(let e=0;e<a/i;e++){let t=e*i;for(let e=0;e<i;e++)s[e]=Math.max(s[e],Qa(l[t+e],0,n).length)}return s}(e,t,n,a),s=t.length,o=ti(e,t,n,a,i),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${s}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(o.map((e=>"    "+e)).join("\n")),l.join("\n")}function Qa(e,t,n){let r;return r=Array.isArray(e)?`${parseFloat(e[0].toFixed(Ya))} + ${parseFloat(e[1].toFixed(Ya))}j`:ve(e)?`'${e}'`:"bool"===n?ei(e):parseFloat(e.toFixed(Ya)).toString(),ue(r,t)}function ei(e){return 0===e?"false":"true"}function ti(e,t,n,r,a,i=!0){let s="complex64"===n?2:1,o=t[0],l=t.length;if(0===l)return"complex64"===n?[Qa(ni(e)[0],0,n)]:"bool"===n?[ei(e[0])]:[e[0].toString()];if(1===l){if(o>Ka){let t=Za*s,r=Array.from(e.slice(0,t)),i=Array.from(e.slice((o-Za)*s,o*s));return"complex64"===n&&(r=ni(r),i=ni(i)),["["+r.map(((e,t)=>Qa(e,a[t],n))).join(", ")+", ..., "+i.map(((e,t)=>Qa(e,a[o-Za+t],n))).join(", ")+"]"]}return["["+("complex64"===n?ni(e):Array.from(e)).map(((e,t)=>Qa(e,a[t],n))).join(", ")+"]"]}let u=t.slice(1),d=r.slice(1),c=r[0]*s,h=[];if(o>Ka){for(let t=0;t<Za;t++){let r=t*c,i=r+c;h.push(...ti(e.slice(r,i),u,n,d,a,!1))}h.push("...");for(let t=o-Za;t<o;t++){let r=t*c,i=r+c;h.push(...ti(e.slice(r,i),u,n,d,a,t===o-1))}}else for(let t=0;t<o;t++){let r=t*c,i=r+c;h.push(...ti(e.slice(r,i),u,n,d,a,t===o-1))}let p=2===l?",":"";h[0]="["+(o>0?h[0]+p:"");for(let e=1;e<h.length-1;e++)h[e]=" "+h[e]+p;let m=",\n";for(let e=2;e<l;e++)m+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":m),h}function ni(e){let t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var ri=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=te(e),null!=n){let e=n.length;J(e===this.size,(()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||fe(t,this.size),this.strides=Ie(e)}set(e,...t){0===t.length&&(t=[0]),J(t.length===this.rank,(()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`));let n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(let n of e){if(n<0||n>=this.shape[t]){let t=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(t)}t++}let n=e[e.length-1];for(let t=0;t<e.length-1;++t)n+=this.strides[t]*e[t];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return ai().makeTensor(this.values,this.shape,this.dtype)}},ai=null,ii=null,si=class{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=te(e),this.strides=Ie(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return ii.buffer(this.shape,this.dtype,e)}bufferSync(){return ii.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Ee(this.shape,e,"complex64"===this.dtype)}arraySync(){return Ee(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();let e=ai().read(this.dataId);if("string"===this.dtype){let t=await e;try{return t.map((e=>Ha(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),ai().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=ai().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>Ha(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await ai().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(ai().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return ii.print(this,e)}clone(){return this.throwIfDisposed(),ii.clone(this)}toString(e=!1){return Ja(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),ii.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),ai().makeVariable(this,e,t,n)}};Object.defineProperty(si,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),He("Tensor",(()=>si));var oi=class extends si{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ae(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);ai().disposeTensor(this),this.dataId=e.dataId,ai().incRef(this,null)}dispose(){ai().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(oi,Symbol.hasInstance,{value:e=>e instanceof si&&null!=e.assign&&e.assign instanceof Function});var li,ui,di,ci,hi,pi,mi={};x(mi,{assertTypesMatch:()=>vi,getTensorsInContainer:()=>ki,isTensorInList:()=>wi,makeTypesMatch:()=>Ai}),(ui=li||(li={})).R0="R0",ui.R1="R1",ui.R2="R2",ui.R3="R3",ui.R4="R4",ui.R5="R5",ui.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(di||(di={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(ci||(ci={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(hi||(hi={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(pi||(pi={}));var fi={float32:hi,int32:di,bool:ci,complex64:pi};function gi(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return fi[e][t]}function yi(e){return gi(e,"int32")}function bi(e){return null!=e&&"object"==typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function xi(e){return"undefined"!=typeof GPUBuffer&&null!=e&&"object"==typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Ai(e,t){if(e.dtype===t.dtype)return[e,t];let n=gi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function vi(e,t){J(e.dtype===t.dtype,(()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`))}function wi(e,t){return t.some((t=>t.id===e.id))}function ki(e){let t=[];return Si(e,t,new Set),t}function Si(e,t,n){if(null==e)return;if(e instanceof si)return void t.push(e);if(!function(e){return Array.isArray(e)||"object"==typeof e}(e))return;let r=e;for(let e in r){let a=r[e];n.has(a)||(n.add(a),Si(a,t,n))}}function Ti(e){return null!=e.kernelName}var _i=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},Ii=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new _i}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{let{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(ca(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new class{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new class{logKernelProfile(e,t,n,r,a,i){let s="number"==typeof r?ue(`${r}ms`,9):r.error,o=ue(e,25),l=t.rank,u=t.size,d=ue(t.shape.toString(),14),c="";for(let e in a){let n=a[e];if(null!=n){let r=n.shape||t.shape,a=r.length;c+=`${e}: ${a}D ${a>0?r:""} `}}console.log(`%c${o}\t%c${s}\t%c${l}D ${d}\t%c${u}\t%c${c}\t%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}})}profileKernel(e,t,n){let r,a,i=()=>{r=n()},s=Wa();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();for(let e of r)e.dataSync();a=Promise.resolve({kernelMs:Wa()-s})}if(Ue().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let t=0;t<r.length;t++){let n=r[t];n.data().then((t=>{Xa(t,n.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((e=>e.kernelMs)),extraInfo:a.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:i}=e;n.forEach((e=>{Promise.all([e.data(),r,i]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}(this.backendInstance),!0}setupRegisteredKernels(){ya(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){ya(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){let t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(!n||n instanceof W||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{let t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId||(this.registry[e]=n,this.pendingBackendInit=null,0)))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,ca(`Initialization of backend ${e} failed`),ca(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(t){return ca(`Initialization of backend ${e} failed`),ca(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{let e=n();return t(),e}catch(e){throw t(),e}}nextTensorId(){return Ii.nextTensorId++}nextVariableId(){return Ii.nextVariableId++}clone(e){let t=Ei.runKernel(un,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{let t={x:e};return Ei.runKernel(gt,t,{dtype:"float32"})}})),[],{}),t}runKernel(e,t,n){if(null==this.backendName&&this.backend,null==fa(e,this.backendName))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let r=this.backend.numDataIds(),a=0;n.forEach((e=>{a+="complex64"===e.dtype?3:1}));let i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-i;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n,r=[],a=this.isTapeOn(),i=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;let o,l=Ti(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ti(e)){let{kernelName:t,inputs:i,attrs:s}=e;null==this.backendName&&this.backend;let l=fa(t,this.backendName);J(null!=l,(()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`)),n=()=>{let e=this.backend.numDataIds();o=l.kernelFunc({inputs:i,attrs:s,backend:this.backend});let n=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,n);let u=n.map((e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e)));if(a){let e=this.getTensorsForGradient(t,i,u);r=this.saveTensorsForBackwardMode(e)}return u}}else{let{forwardFunc:t}=e,i=e=>{a&&(r=e.map((e=>this.keep(this.clone(e)))))};n=()=>{let e=this.backend.numDataIds();o=this.tidy((()=>t(this.backend,i)));let n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}let u,{inputs:d,attrs:c}=e,h=Ti(e)?null:e.backwardsFunc;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(u=this.profiler.profileKernel(l,d,(()=>n())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(u),t=u.outputs):t=n()})),a&&this.addTapeNode(l,d,t,h,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map((e=>null!=d[e]?d[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:u.timeMs,extraInfo:u.extraInfo}),Array.isArray(o)?t:t[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){let r=ga(e);if(null!=r){let e,a=r.inputsToSave||[],i=r.outputsToSave||[];r.saveAllInputs?(J(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),e=Object.keys(t).map((e=>t[e]))):e=a.map((e=>t[e]));let s=n.filter(((e,t)=>i[t]));return e.concat(s)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&ve(e[0])&&(a=e.map((e=>ja(e))));let i=r.write(a,t,n),s=new si(t,n,i,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){let e=this.state.tensorInfo.get(i),t=Ae(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){let a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:r,dtype:a}=e,i=new si(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));let a=new oi(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*xe(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof oi||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){let t=e.size*xe(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let e of this.state.activeProfile.kernels)e.kernelTimeMs=await e.kernelTimeMs,e.extraInfo=await e.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,i){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},o=ga(e);null!=o&&(r=o.gradFunc),null!=r&&(s.gradient=e=>(e=e.map(((e,t)=>{if(null==e){let e=n[t],r=Pe(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],a,i))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=ki(e),n=new Set(t.map((e=>e.id)));for(let e=0;e<this.state.activeScope.track.length;e++){let t=this.state.activeScope.track[e];!t.kept&&!n.has(t.id)&&t.dispose()}let r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{!e.kept&&e.scopeId===r.id&&this.track(e)}))}gradients(e,t,n,r=!1){if(J(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let a=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));J(a instanceof si,(()=>"The result y returned by f() must be a tensor."));let i=function(e,t,n){let r={},a={};for(let e=0;e<t.length;e++)r[t[e].id]=!0;for(let n=0;n<e.length;n++){let i=e[n],s=i.inputs;for(let e in s){let n=s[e],o=!1;for(let e=0;e<t.length;e++)if(r[n.id]){i.outputs.forEach((e=>r[e.id]=!0)),o=!0,a[i.id]=!0;break}if(o)break}}let i={};i[n.id]=!0;let s={};for(let t=e.length-1;t>=0;t--){let n=e[t],r=n.inputs;for(let e=0;e<n.outputs.length;e++)if(i[n.outputs[e].id]){for(let e in r)i[r[e].id]=!0,s[n.id]=!0;break}}let o=[];for(let t=0;t<e.length;t++){let n=e[t];if(a[n.id]&&s[n.id]){let e={};for(let t in n.inputs){let a=n.inputs[t];r[a.id]&&(e[t]=a)}let t=Object.assign({},n);t.inputs=e,t.outputs=n.outputs,o.push(t)}}return o}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{let e={};e[a.id]=null==n?function(e){let t=Re(te(e),"float32");return Ei.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){let i=t[a],s=[];if(i.outputs.forEach((t=>{let n=e[t.id];null!=n?s.push(n):s.push(null)})),null==i.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let o=i.gradient(s);for(let t in i.inputs){if(!(t in o))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(o)}.`);let a=n((()=>o[t]()));if("float32"!==a.dtype)throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${a.dtype}'`);let s=i.inputs[t];if(!ae(a.shape,s.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${t}' has shape '${a.shape}', which does not match the shape of the input '${s.shape}'`);if(null==e[s.id])e[s.id]=a;else{let t=e[s.id];e[s.id]=r(t,a),t.dispose()}}}}(e,i,(e=>this.tidy(e)),Ni);let r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(let t of e.saved)t.dispose()})),this.state.activeTape=null),{value:a,grads:r}}))}customGrad(e){return J(Te(e),(()=>"The f passed in customGrad(f) must be a function.")),(...t)=>{J(t.every((e=>e instanceof si)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));let n,r={};return t.forEach(((e,t)=>{r[t]=e})),this.runKernelFunc({forwardFunc:(r,a)=>(n=e(...t,a),J(n.value instanceof si,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),J(Te(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(e,r)=>{let a=n.gradFunc(e,r),i=Array.isArray(a)?a:[a];J(i.length===t.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),J(i.every((e=>e instanceof si)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));let s={};return i.forEach(((e,t)=>{s[t]=()=>e})),s},inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=Wa(),n=await this.backend.time(e);return n.wallMs=Wa()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new _i;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};function Ci(){let e=je();if(null==e._tfengine){let t=new ze(e);e._tfengine=new Ii(t)}return function(e){Ve=e}(e._tfengine.ENV),function(e){ai=e}((()=>e._tfengine)),e._tfengine}Ii.nextTensorId=0,Ii.nextVariableId=0;var Ei=Ci();function Ni(e,t){let n={a:e,b:t};return Ei.runKernel(Ke,n)}var Ri,Pi={};function Di(e){Ri=e}function Mi(e){if(void 0!==Ri)return Ri;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;let t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){let t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Oi(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}x(Pi,{isBrowser:()=>Oi,isMobile:()=>Mi,mockIsMobile:()=>Di});var $i=Ue();function Fi(e,t){let n=e;if(Ga(e))return"string"===t?[]:[e.length];if(bi(e)){let t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(xi(e))return[e.buffer.size/(null==t?4:xe(t))];if(!Array.isArray(e))return[];let r=[];for(;Array.isArray(n)||Ga(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Ue().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Li(e,r,[]),r}function Li(e,t,n){if(n=n||[],!Array.isArray(e)&&!Ga(e))return void J(0===t.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`));J(t.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`)),J(e.length===t[0],(()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`));let r=t.slice(1);for(let t=0;t<e.length;++t)Li(e[t],r,n.concat(t))}function zi(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function Bi(e,t,n,r="numeric"){if(e instanceof si)return zi(r,e.dtype,t,n),e;let a=Se(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),zi(r,a,t,n),null==e||!Ga(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){let r=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}let i=Fi(e,a);!Ga(e)&&!Array.isArray(e)&&(e=[e]);let s="string"!==a?Ua(e,a):qa(e,[],!0);return Ei.makeTensor(s,i,a)}function Ui(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map(((e,a)=>Bi(e,`${t}[${a}]`,n,r)))}$i.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),$i.registerFlag("IS_BROWSER",(()=>Oi())),$i.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),$i.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),$i.registerFlag("IS_SAFARI",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor))),$i.registerFlag("PROD",(()=>!1)),$i.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>$i.getBool("DEBUG"))),$i.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),$i.registerFlag("IS_TEST",(()=>!1)),$i.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>$i.getBool("DEBUG"))),$i.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),$i.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),$i.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));var Wi="__op";function Vi(e){let t=Object.keys(e);if(1!==t.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=Wi;let a=(...e)=>{Ei.startScope(n);try{let t=r(...e);return Fe(t)&&console.error("Cannot return a Promise inside of tidy."),Ei.endScope(t),t}catch(e){throw Ei.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var ji=Vi({complex_:function(e,t){let n=Bi(e,"real","complex"),r=Bi(t,"imag","complex");Q(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:n,imag:r};return Ei.runKernel(xt,a)}});function Hi(e,t,n,r){if(null==r)r=Se(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(xi(e)||bi(e)){if("float32"!==r&&"int32"!==r)throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return Ei.backend.createTensorFromGPUData(e,t||n,r)}if(!Ga(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Me(t);let e=te(t),r=te(n);J(e===r,(()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`));for(let e=0;e<n.length;++e){let r=n[e],a=e!==n.length-1||r!==te(t.slice(e));J(n[e]===t[e]||!a,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `))}}return!Ga(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?Ua(e,r):qa(e,[],!0),Ei.makeTensor(e,t,r)}function Gi(e,t,n){return Hi(e,t,Fi(e,n),n)}var qi={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Xi=class{static join(e){return new Xi(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e||(e instanceof Array||(e=[e]),0===(e=e.map((e=>Ga(e)?e.buffer:e))).length))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let a=t+r.byteLength;this.shards.push({buffer:r,start:t,end:a}),t=a}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);let n=this.findShardForByte(e);if(-1===n)throw new Error(`Could not find start shard for byte ${e}`);let r=new ArrayBuffer(t-e),a=new Uint8Array(r),i=0;for(let r=n;r<this.shards.length;r++){let n=this.shards[r],s=e+i-n.start,o=i,l=Math.min(t,n.end)-n.start,u=new Uint8Array(n.buffer,s,l-s);if(a.set(u,o),i+=u.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;let n=function(e,t){let n=0,r=e.length;for(;n<=r;){let a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}},Ki=4;async function Zi(e,t){let n=[],r=[],a=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let i=0;i<a.length;++i){let s=a[i],o=Array.isArray(e)?e[i].tensor:e[s];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error(`Unsupported dtype in weight '${s}': ${o.dtype}`);let l={name:s,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){let e=new Promise((async e=>{let t=await o.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+Ki*t.length,r=new Uint8Array(n),a=0;for(let e=0;e<t.length;e++){let n=t[e],i=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(i,a),a+=Ki,r.set(n,a),a+=n.length}e(r)}));r.push(e)}else r.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:Ji(await Promise.all(r)),specs:n}}function Yi(e,t){let n,r=new Xi(e),a={},i=0;for(let e of t){let t,s=e.name,o=e.dtype,l=e.shape,u=te(l);if("quantization"in e){let a=e.quantization;if("uint8"===a.dtype||"uint16"===a.dtype){if(!("min"in a)||!("scale"in a))throw new Error(`Weight ${e.name} with quantization ${a.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==a.dtype)throw new Error(`Weight ${e.name} has unknown quantization dtype ${a.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${e.name} is quantized with ${a.dtype} which only supports weights of type float32 not ${o}.`)}let l=qi[a.dtype],d=r.slice(i,i+u*l),c="uint8"===a.dtype?new Uint8Array(d):new Uint16Array(d);if("float32"===o)if("uint8"===a.dtype||"uint16"===a.dtype){t=new Float32Array(c.length);for(let e=0;e<c.length;e++){let n=c[e];t[e]=n*a.scale+a.min}}else{if("float16"!==a.dtype)throw new Error(`Unsupported quantization type ${a.dtype} for weight type float32.`);void 0===n&&(n=ls()),t=n(c)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${s}': ${o}`);if("uint8"!==a.dtype&&"uint16"!==a.dtype)throw new Error(`Unsupported quantization type ${a.dtype} for weight type int32.`);t=new Int32Array(c.length);for(let e=0;e<c.length;e++){let n=c[e];t[e]=Math.round(n*a.scale+a.min)}}i+=u*l}else if("string"===o){let n=te(e.shape);t=[];for(let e=0;e<n;e++){let e=new Uint32Array(r.slice(i,i+Ki))[0];i+=Ki;let n=new Uint8Array(r.slice(i,i+e));t.push(n),i+=e}}else{let e=qi[o],n=r.slice(i,i+u*e);if("float32"===o)t=new Float32Array(n);else if("int32"===o)t=new Int32Array(n);else if("bool"===o)t=new Uint8Array(n);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${s}': ${o}`);{t=new Float32Array(n);let e=new Float32Array(t.length/2),r=new Float32Array(t.length/2);for(let n=0;n<e.length;n++)e[n]=t[2*n],r[n]=t[2*n+1];let i=Gi(e,l,"float32"),o=Gi(r,l,"float32");a[s]=ji(i,o),i.dispose(),o.dispose()}}i+=u*e}"complex64"!==o&&(a[s]=Gi(t,l,o))}return a}function Ji(e){if(null===e)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0,n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${e.constructor.name}`)}));let r=new Uint8Array(t),a=0;return n.forEach((e=>{r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var Qi="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function es(e){return Qi?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function ts(e){return Xi.join(e)}function ns(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);let t=e.split("/");return t[t.length-1]}function rs(e,t){let n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function as(e,t,n){let r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}async function is(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),as(e,n,r)}function ss(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:es(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:es(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new Xi(e.weightData).byteLength}}function os(e){let t=[];for(let n of e)t.push(...n.weights);return t}function ls(){let e=function(){let e=e=>{let t=e<<13,n=0;for(;!(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}(),t=function(){let e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){let e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{let a=new ArrayBuffer(4*r.length),i=new Uint32Array(a);for(let a=0;a<r.length;a++){let s=r[a],o=e[n[s>>10]+(1023&s)]+t[s>>10];i[a]=o}return new Float32Array(a)}}var us=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==us.instance&&(us.instance=new us),us.instance}static registerSaveRouter(e){us.getInstance().saveRouters.push(e)}static registerLoadRouter(e){us.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return us.getHandlers(e,"save")}static getLoadHandlers(e,t){return us.getHandlers(e,"load",t)}static getHandlers(e,t,n){let r=[];return("load"===t?us.getInstance().loadRouters:us.getInstance().saveRouters).forEach((t=>{let a=t(e,n);null!==a&&r.push(a)})),r}},ds=e=>us.registerSaveRouter(e),cs=e=>us.registerLoadRouter(e),hs=e=>us.getSaveHandlers(e),ps=(e,t)=>us.getLoadHandlers(e,t),ms="tensorflowjs",fs="models_store",gs="model_info_store";function ys(){if(!Ue().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function bs(e){let t=e.result;t.createObjectStore(fs,{keyPath:"modelPath"}),t.createObjectStore(gs,{keyPath:"modelPath"})}var xs=class{constructor(e){if(this.indexedDB=ys(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{let r=this.indexedDB.open(ms,1);r.onupgradeneeded=()=>bs(r),r.onsuccess=()=>{let a=r.result;if(null==t){let t=a.transaction(fs,"readonly"),r=t.objectStore(fs).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{t.weightData=Xi.join(t.weightData);let r,i,s=ss(t),o=a.transaction(gs,"readwrite"),l=o.objectStore(gs);try{r=l.put({modelPath:this.modelPath,modelArtifactsInfo:s})}catch(e){return n(e)}r.onsuccess=()=>{i=a.transaction(fs,"readwrite");let r,u=i.objectStore(fs);try{r=u.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s})}catch(e){return n(e)}r.onsuccess=()=>e({modelArtifactsInfo:s}),r.onerror=e=>{l=o.objectStore(gs);let t=l.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(r.error)),t.onerror=e=>(a.close(),n(r.error))}},r.onerror=e=>(a.close(),n(r.error)),o.oncomplete=()=>{null==i?a.close():i.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)}))}};xs.URL_SCHEME="indexeddb://";var As=e=>Ue().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(xs.URL_SCHEME)?function(e){return new xs(e)}(e.slice(xs.URL_SCHEME.length)):null;us.registerSaveRouter(As),us.registerLoadRouter(As);var vs="/",ws="tensorflowjs_models",ks="info",Ss="model_topology",Ts="weight_specs",_s="weight_data",Is="model_metadata";function Cs(e){return{info:[ws,e,ks].join(vs),topology:[ws,e,Ss].join(vs),weightSpecs:[ws,e,Ts].join(vs),weightData:[ws,e,_s].join(vs),modelMetadata:[ws,e,Is].join(vs)}}function Es(e){for(let t of Object.values(e))window.localStorage.removeItem(t)}function Ns(e){let t=e.split(vs);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(vs)}var Rs=class{constructor(e){if(!Ue().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Cs(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=ss(e),a=Xi.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Qi)return Buffer.from(e).toString("base64");let t=new Uint8Array(e),n="";for(let e=0,r=t.length;e<r;e++)n+=String.fromCharCode(t[e]);return btoa(n)}(a));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch(e){throw Es(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;let a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){let e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}let i=this.LS.getItem(this.keys.weightData);if(null==i)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(Qi){let t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n.set([t.charCodeAt(e)],e);return n.buffer}(i),t}};Rs.URL_SCHEME="localstorage://";var Ps=e=>Ue().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Rs.URL_SCHEME)?function(e){return new Rs(e)}(e.slice(Rs.URL_SCHEME.length)):null;us.registerSaveRouter(Ps),us.registerLoadRouter(Ps);var Ds="://",Ms=class{constructor(){this.managers={}}static getInstance(){return null==Ms.instance&&(Ms.instance=new Ms),Ms.instance}static registerManager(e,t){J(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(Ds)&&(e=e.slice(0,e.indexOf(Ds))),J(e.length>0,(()=>"scheme must not be an empty string."));let n=Ms.getInstance();J(null==n.managers[e],(()=>`A model store manager is already registered for scheme '${e}'.`)),n.managers[e]=t}static getManager(e){let t=Ms.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Ms.getInstance().managers)}};function Os(e){if(-1===e.indexOf(Ds))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ms.getSchemes().join(",")}`);return{scheme:e.split(Ds)[0],path:e.split(Ds)[1]}}async function $s(e,t,n=!1){J(e!==t,(()=>`Old path and new path are the same: '${e}'`));let r=us.getLoadHandlers(e);J(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${e}.`)),J(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`));let a=r[0],i=us.getSaveHandlers(t);J(i.length>0,(()=>`Copying failed because no save handler is found for destination URL ${t}.`)),J(i.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`));let s=i[0],o=Os(e).scheme,l=Os(e).path,u=o===Os(e).scheme,d=await a.load();n&&u&&await Ms.getManager(o).removeModel(l);let c=await s.save(d);return n&&!u&&await Ms.getManager(o).removeModel(l),c.modelArtifactsInfo}async function Fs(){let e=Ms.getSchemes(),t={};for(let n of e){let e=await Ms.getManager(n).listModels();for(let r in e)t[n+Ds+r]=e[r]}return t}async function Ls(e){let t=Os(e);return Ms.getManager(t.scheme).removeModel(t.path)}async function zs(e,t){return $s(e,t,!1)}async function Bs(e,t){return $s(e,t,!0)}if(Ue().get("IS_BROWSER")){Ue().setPlatform("browser",new class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!=typeof window&&Ue().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(e=>{e.source===window&&e.data.name===this.messageName&&(e.stopPropagation(),(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0))}),!0))):setTimeout(e,t)}isTypedArray(e){return Ta(e)}});try{Ms.registerManager(Rs.URL_SCHEME,new class{constructor(){J(Ue().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),J("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){let e={},t=ws+vs,n=vs+ks;for(let r=0;r<this.LS.length;++r){let a=this.LS.key(r);a.startsWith(t)&&a.endsWith(n)&&(e[Ns(a)]=JSON.parse(this.LS.getItem(a)))}return e}async removeModel(e){e=function(e){return e.startsWith(Rs.URL_SCHEME)?e.slice(Rs.URL_SCHEME.length):e}(e);let t=Cs(e);if(null==this.LS.getItem(t.info))throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(t.info));return Es(t),n}})}catch(ui){}try{Ms.registerManager(xs.URL_SCHEME,new class{constructor(){this.indexedDB=ys()}async listModels(){return new Promise(((e,t)=>{let n=this.indexedDB.open(ms,1);n.onupgradeneeded=()=>bs(n),n.onsuccess=()=>{let r=n.result,a=r.transaction(gs,"readonly"),i=a.objectStore(gs).getAll();i.onsuccess=()=>{let t={};for(let e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(r.close(),t(i.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){return e=function(e){return e.startsWith(xs.URL_SCHEME)?e.slice(xs.URL_SCHEME.length):e}(e),new Promise(((t,n)=>{let r=this.indexedDB.open(ms,1);r.onupgradeneeded=()=>bs(r),r.onsuccess=()=>{let a,i=r.result,s=i.transaction(gs,"readwrite"),o=s.objectStore(gs),l=o.get(e);l.onsuccess=()=>{if(null==l.result)return i.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let r=o.delete(e),s=()=>{a=i.transaction(fs,"readwrite");let r=a.objectStore(fs).delete(e);r.onsuccess=()=>t(l.result.modelArtifactsInfo),r.onerror=e=>n(l.error)};r.onsuccess=s,r.onerror=e=>(s(),i.close(),n(l.error))}},l.onerror=e=>(i.close(),n(l.error)),s.oncomplete=()=>{null==a?i.close():a.oncomplete=()=>i.close()}},r.onerror=e=>n(r.error)}))}})}catch(ui){}}var Us;function Ws(e,t="float32",n){return t=t||"float32",Me(e),new ri(e,t,n)}Ue().get("IS_NODE")&&!Ue().get("IS_BROWSER")&&Ue().setPlatform("node",new class{constructor(){this.util=k(),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=Ue().global.fetch?Ue().global.fetch(e,t):(null==Us&&(Us=w()),Us(e,t))}now(){let e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}});var Vs=Vi({cast_:function(e,t){let n=Bi(e,"x","cast");if(!ye(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");let r={x:n},a={dtype:t};return Ei.runKernel(gt,r,a)}}),js=Vi({clone_:function(e){let t={x:Bi(e,"x","clone","string_or_numeric")};return Ei.runKernel(un,t)}});function Hs(e,t=!1){console.log(e.toString(t))}function Gs(){Ue().set("PROD",!0)}function qs(){Ue().set("DEBUG",!0)}function Xs(){Ue().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Ks(e){Ue().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Zs(){Ei.disposeVariables()}function Ys(){return Ei}function Js(){return Ei.memory()}function Qs(e){return Ei.profile(e)}function eo(e,t){return Ei.tidy(e,t)}function to(e){ki(e).forEach((e=>e.dispose()))}function no(e){return Ei.keep(e)}function ro(e){return Ei.time(e)}function ao(e){return Ei.setBackend(e)}function io(){return Ei.ready()}function so(){return Ei.backendName}function oo(e){Ei.removeBackend(e)}function lo(e){return Ei.findBackend(e)}function uo(e){return Ei.findBackendFactory(e)}function co(e,t,n=1){return Ei.registerBackend(e,t,n)}function ho(){return Ei.backend}function po(e,t){Ue().setPlatform(e,t)}Ci(),function(e){ii=e}({buffer:Ws,cast:Vs,clone:js,print:Hs});var mo=Vi({add_:function(e,t){let n=Bi(e,"a","add"),r=Bi(t,"b","add");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(Ke,a)}}),fo=Vi({floorDiv_:function(e,t){let n=Bi(e,"a","floorDiv"),r=Bi(t,"b","floorDiv");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(nn,a)}}),go=Vi({div_:function(e,t){let n=Bi(e,"a","div"),r=Bi(t,"b","div");if([n,r]=Ai(n,r),"int32"===n.dtype&&"int32"===r.dtype)return fo(n,r);let a={a:n,b:r};return Ei.runKernel(Vt,a,{})}}),yo=Vi({mul_:function(e,t){let n=Bi(e,"a","mul"),r=Bi(t,"b","mul");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(Vn,a)}}),bo=Vi({abs_:function(e){let t=Bi(e,"x","abs");if("complex64"===t.dtype){let e={x:t};return Ei.runKernel(At,e)}{let e={x:t};return Ei.runKernel(Ge,e)}}}),xo=Vi({acos_:function(e){let t={x:Bi(e,"x","acos")};return Ei.runKernel(qe,t)}}),Ao=Vi({acosh_:function(e){let t={x:Bi(e,"x","acosh")};return Ei.runKernel(Xe,t)}}),vo=Vi({addN_:function(e){J(Array.isArray(e),(()=>"The argument passed to tf.addN() must be a list of tensors")),J(e.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`));let t=e.map(((e,t)=>Bi(e,`tensors${t}`,"addN"))),n=t[0];t.forEach((e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((e=>{if(!ae(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));let r=t;return Ei.runKernel(Ze,r)}}),wo=Vi({all_:function(e,t=null,n=!1){let r={x:Bi(e,"x","all","bool")},a={axis:t,keepDims:n};return Ei.runKernel(Ye,r,a)}}),ko=Vi({any_:function(e,t=null,n=!1){let r={x:Bi(e,"x","any","bool")},a={axis:t,keepDims:n};return Ei.runKernel(Je,r,a)}}),So=Vi({argMax_:function(e,t=0){let n={x:Bi(e,"x","argMax")},r={axis:t};return Ei.runKernel(Qe,n,r)}}),To=Vi({argMin_:function(e,t=0){let n={x:Bi(e,"x","argMin")},r={axis:t};return Ei.runKernel(et,n,r)}}),_o=Vi({asin_:function(e){let t={x:Bi(e,"x","asin")};return Ei.runKernel(tt,t)}}),Io=Vi({asinh_:function(e){let t={x:Bi(e,"x","asinh")};return Ei.runKernel(nt,t)}}),Co=Vi({atan_:function(e){let t={x:Bi(e,"x","atan")};return Ei.runKernel(rt,t)}}),Eo=Vi({atan2_:function(e,t){let n=Bi(e,"a","atan2"),r=Bi(t,"b","atan2");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(it,a)}}),No=Vi({atanh_:function(e){let t={x:Bi(e,"x","atanh")};return Ei.runKernel(at,t)}});function Ro(e,t,n,r,a="NHWC",i){return Mo(e,[...t,e[3]],n,i,r,null,null,jo(a))}function Po(e,t,n,r,a,i,s="channelsLast"){let o,[l,u]=Fo(t);if("channelsLast"===s)o=[l,u,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);o=[l,u,e[1],e[1]]}return Mo(e,o,n,r,a,i,!1,s)}function Do(e,t,n,r,a,i,s="NDHWC"){let o,l,[u,d,c]=Lo(t);if("NDHWC"===s)l="channelsLast",o=[u,d,c,e[4],e[4]];else{if("NCDHW"!==s)throw new Error(`Unknown dataFormat ${s}`);l="channelsFirst",o=[u,d,c,e[1],e[1]]}return Oo(e,o,n,r,a,!1,l,i)}function Mo(e,t,n,r,a,i,s=!1,o="channelsLast"){let[l,u,d,c]=[-1,-1,-1,-1];if("channelsLast"===o)[l,u,d,c]=e;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[l,c,u,d]=e}let h,[p,m,,f]=t,[g,y]=Fo(n),[b,x]=Fo(r),A=zo(p,b),v=zo(m,x),{padInfo:w,outHeight:k,outWidth:S}=function(e,t,n,r,a,i,s,o,l){let u,d,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};let a=function(e,t,n,r,a){null==r&&(r=$o(e,t,n));let i=e[1];return[Bo((e[0]-t+2*r)/n+1,a),Bo((i-t+2*r)/n+1,a)]}([t,n],i,r,e,o);d=a[0],c=a[1]}else if("same"===e){d=Math.ceil(t/r),c=Math.ceil(n/a);let e=Math.max(0,(d-1)*r+i-t),o=Math.max(0,(c-1)*a+s-n),l=Math.floor(e/2),h=e-l,p=Math.floor(o/2);u={top:l,bottom:h,left:p,right:o-p,type:"SAME"}}else if("valid"===e)u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((t-i+1)/r),c=Math.ceil((n-s+1)/a);else{if("object"!=typeof e)throw Error(`Unknown padding parameter: ${e}`);{let h="channelsLast"===l?e[1][0]:e[2][0],p="channelsLast"===l?e[1][1]:e[2][1],m="channelsLast"===l?e[2][0]:e[3][0],f="channelsLast"===l?e[2][1]:e[3][1];u={top:h,bottom:p,left:m,right:f,type:0===h&&0===p&&0===m&&0===f?"VALID":"EXPLICIT"},d=Bo((t-i+h+p)/r+1,o),c=Bo((n-s+m+f)/a+1,o)}}return{padInfo:u,outHeight:d,outWidth:c}}(a,u,d,g,y,A,v,i,o),T=s?f*c:f;return"channelsFirst"===o?h=[l,T,k,S]:"channelsLast"===o&&(h=[l,k,S,T]),{batchSize:l,dataFormat:o,inHeight:u,inWidth:d,inChannels:c,outHeight:k,outWidth:S,outChannels:T,padInfo:w,strideHeight:g,strideWidth:y,filterHeight:p,filterWidth:m,effectiveFilterHeight:A,effectiveFilterWidth:v,dilationHeight:b,dilationWidth:x,inShape:e,outShape:h,filterShape:t}}function Oo(e,t,n,r,a,i=!1,s="channelsLast",o){let[l,u,d,c,h]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[l,u,d,c,h]=e;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[l,h,u,d,c]=e}let p,[m,f,g,,y]=t,[b,x,A]=Lo(n),[v,w,k]=Lo(r),S=zo(m,v),T=zo(f,w),_=zo(g,k),{padInfo:I,outDepth:C,outHeight:E,outWidth:N}=function(e,t,n,r,a,i,s,o,l,u,d){let c,h,p,m;if("valid"===e&&(e=0),"number"==typeof e){c={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};let f=function(e,t,n,r,a,i){null==a&&(a=$o(e,t[0],r[0]));let s=[0,0,0,1];for(let n=0;n<3;n++)e[n]+2*a>=t[n]&&(s[n]=Bo((e[n]-t[n]+2*a)/r[n]+1,i));return s}([t,n,r,1],[o,l,u],0,[a,i,s],e,d);h=f[0],p=f[1],m=f[2]}else{if("same"!==e)throw Error(`Unknown padding parameter: ${e}`);{h=Math.ceil(t/a),p=Math.ceil(n/i),m=Math.ceil(r/s);let e=(h-1)*a+o-t,d=(p-1)*i+l-n,f=(m-1)*s+u-r,g=Math.floor(e/2),y=e-g,b=Math.floor(d/2),x=d-b,A=Math.floor(f/2);c={top:b,bottom:x,left:A,right:f-A,front:g,back:y,type:"SAME"}}}return{padInfo:c,outDepth:h,outHeight:p,outWidth:m}}(a,u,d,c,b,x,A,S,T,_,o),R=i?y*h:y;return"channelsFirst"===s?p=[l,R,C,E,N]:"channelsLast"===s&&(p=[l,C,E,N,R]),{batchSize:l,dataFormat:s,inDepth:u,inHeight:d,inWidth:c,inChannels:h,outDepth:C,outHeight:E,outWidth:N,outChannels:R,padInfo:I,strideDepth:b,strideHeight:x,strideWidth:A,filterDepth:m,filterHeight:f,filterWidth:g,effectiveFilterDepth:S,effectiveFilterHeight:T,effectiveFilterWidth:_,dilationDepth:v,dilationHeight:w,dilationWidth:k,inShape:e,outShape:p,filterShape:t}}function $o(e,t,n,r=1){let a=zo(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Fo(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Lo(e){return"number"==typeof e?[e,e,e]:e}function zo(e,t){return t<=1?e:e+(e-1)*(t-1)}function Bo(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Uo(e){let[t,n,r]=Fo(e);return 1===t&&1===n&&1===r}function Wo(e,t){return Uo(e)||Uo(t)}function Vo(e){return Fo(e).every((e=>e>0))}function jo(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Ho(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)J(ie(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`));else{if("object"!=typeof t)throw Error(`Error in ${e}: Unknown padding parameter: ${t}`);t.forEach((t=>{t.forEach((t=>{J(ie(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`))}))}))}}}var Go=Vi({reshape_:function(e,t){let n={x:Bi(e,"x","reshape","string_or_numeric")},r={shape:t};return Ei.runKernel(dr,n,r)}}),qo=Vi({avgPool_:function(e,t,n,r,a){let i=Bi(e,"x","avgPool","float32");J(Wo(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let s=i,o=!1;3===i.rank&&(o=!0,s=Go(i,[1,i.shape[0],i.shape[1],i.shape[2]])),J(4===s.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`)),Ho("avgPool",r,a);let l={x:s},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a},d=Ei.runKernel(st,l,u);return d=Vs(d,i.dtype),o?Go(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Xo=Vi({avgPool3d_:function(e,t,n,r,a,i="NDHWC"){let s=Bi(e,"x","avgPool3d","float32"),o=s,l=!1;4===s.rank&&(l=!0,o=Go(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),J(5===o.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`)),J("NDHWC"===i,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`)),J("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`)),Ho("avgPool3d",r,a);let u={x:o},d={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},c=Ei.runKernel(lt,u,d);return c=Vs(c,o.dtype),l?Go(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),Ko=Vi({concat_:function(e,t=0){J(e.length>=1,(()=>"Pass at least one tensor to concat"));let n=Ui(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)})),1===n.length)return js(n[0]);let r=n,a={axis:t};return Ei.runKernel(vt,r,a)}}),Zo=Vi({matMul_:function(e,t,n=!1,r=!1){let a=Bi(e,"a","matMul"),i=Bi(t,"b","matMul");[a,i]=Ai(a,i);let s={a,b:i},o={transposeA:n,transposeB:r};return Ei.runKernel(dt,s,o)}}),Yo=Vi({sigmoid_:function(e){let t={x:Bi(e,"x","sigmoid","float32")};return Ei.runKernel(Cr,t)}}),Jo=Vi({slice_:function(e,t,n){let r=Bi(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");let a={x:r},i={begin:t,size:n};return Ei.runKernel(Sr,a,i)}}),Qo=Vi({tanh_:function(e){let t={x:Bi(e,"x","tanh","float32")};return Ei.runKernel(Kr,t)}}),el=Vi({basicLSTMCell_:function(e,t,n,r,a,i){let s=Bi(e,"forgetBias","basicLSTMCell"),o=Bi(t,"lstmKernel","basicLSTMCell"),l=Bi(n,"lstmBias","basicLSTMCell"),u=Bi(r,"data","basicLSTMCell"),d=Bi(a,"c","basicLSTMCell"),c=Bi(i,"h","basicLSTMCell"),h=Ko([u,c],1),p=Zo(h,o),m=mo(p,l),f=m.shape[0],g=m.shape[1]/4,y=[f,g],b=Jo(m,[0,0],y),x=Jo(m,[0,g],y),A=Jo(m,[0,2*g],y),v=Jo(m,[0,3*g],y),w=mo(yo(Yo(b),Qo(x)),yo(d,Yo(mo(s,A))));return[w,yo(Qo(w),Yo(v))]}}),tl=Vi({batchToSpaceND_:function(e,t,n){let r=Bi(e,"x","batchToSpaceND"),a=t.reduce(((e,t)=>e*t));J(r.rank>=1+t.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`)),J(n.length===t.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`)),J(r.shape[0]%a==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`));let i={x:r},s={blockShape:t,crops:n};return Ei.runKernel(ct,i,s)}});function nl(e){let t;return t=0===e.rank||1===e.rank?Go(e,[1,1,1,e.size]):2===e.rank?Go(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Go(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}var rl=Vi({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);let s,o,l=Bi(e,"x","batchNorm"),u=Bi(t,"mean","batchNorm"),d=Bi(n,"variance","batchNorm");null!=a&&(s=Bi(a,"scale","batchNorm")),null!=r&&(o=Bi(r,"offset","batchNorm")),J(u.rank===d.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),J(null==o||u.rank===o.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),J(null==s||u.rank===s.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let c={x:nl(l),scale:s,offset:o,mean:u,variance:d},h={varianceEpsilon:i},p=Ei.runKernel(rn,c,h);return Go(p,l.shape)}}),al=Vi({batchNorm2d_:function(e,t,n,r,a,i){let s,o,l=Bi(e,"x","batchNorm"),u=Bi(t,"mean","batchNorm"),d=Bi(n,"variance","batchNorm");return null!=a&&(s=Bi(a,"scale","batchNorm")),null!=r&&(o=Bi(r,"offset","batchNorm")),J(2===l.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`)),J(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${u.rank}.`)),J(2===d.rank||1===d.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${d.rank}.`)),null!=s&&J(2===s.rank||1===s.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${s.rank}.`)),null!=o&&J(2===o.rank||1===o.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${o.rank}.`)),rl(l,u,d,o,s,i)}}),il=Vi({batchNorm3d_:function(e,t,n,r,a,i){let s,o,l=Bi(e,"x","batchNorm"),u=Bi(t,"mean","batchNorm"),d=Bi(n,"variance","batchNorm");return null!=a&&(s=Bi(a,"scale","batchNorm")),null!=r&&(o=Bi(r,"offset","batchNorm")),J(3===l.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`)),J(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${u.rank}.`)),J(3===d.rank||1===d.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${d.rank}.`)),null!=s&&J(3===s.rank||1===s.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${s.rank}.`)),null!=o&&J(3===o.rank||1===o.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${o.rank}.`)),rl(l,u,d,o,s,i)}}),sl=Vi({batchNorm4d_:function(e,t,n,r,a,i){let s,o,l=Bi(e,"x","batchNorm"),u=Bi(t,"mean","batchNorm"),d=Bi(n,"variance","batchNorm");return null!=a&&(s=Bi(a,"scale","batchNorm")),null!=r&&(o=Bi(r,"offset","batchNorm")),J(4===l.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`)),J(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${u.rank}.`)),J(4===d.rank||1===d.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${d.rank}.`)),null!=s&&J(4===s.rank||1===s.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${s.rank}.`)),null!=o&&J(4===o.rank||1===o.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${o.rank}.`)),rl(l,u,d,o,s,i)}}),ol=Vi({bincount_:function(e,t,n){let r=Bi(e,"x","bincount"),a=Bi(t,"weights","bincount");J("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),J(n>=0,(()=>`size must be non-negative, but got ${n}.`)),J(a.size===r.size||0===a.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`));let i={x:r,weights:a},s={size:n};return Ei.runKernel(ht,i,s)}}),ll=Vi({bitwiseAnd_:function(e,t){let n=Bi(e,"x","bitwiseAnd"),r=Bi(t,"y","bitwiseAnd");if(!ae(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);let a={a:n,b:r};return Ei.runKernel(pt,a)}}),ul=Vi({broadcastArgs_:function(e,t){let n=Bi(e,"s0","broadcastArgs","int32"),r=Bi(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);let a={s0:n,s1:r};return Ei.runKernel(ft,a)}}),dl=Vi({broadcastTo_:function(e,t){let n=Bi(e,"broadcastTo","x"),r=n.shape;if(Me(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){let e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=Go(n,e)}let a=n.shape,i=Array.from(t);for(let e=t.length-1;e>=0;e--)if(a[e]===t[e])i[e]=1;else if(1!==n.shape[e])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(0===i.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0)).length)return js(n);let s={x:n},o={reps:i};return Ei.runKernel(Zr,s,o)}}),cl=Vi({ceil_:function(e){let t={x:Bi(e,"x","ceil","float32")};return Ei.runKernel(yt,t)}});function hl(e,t,n){Me(e);let r={shape:e,value:t,dtype:n=n||Se(t)};return Ei.runKernel(Qt,{},r)}var pl=Vi({clipByValue_:function(e,t,n){let r=Bi(e,"x","clipByValue");if(J(t<=n,(()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`)),t===n)return hl(r.shape,t,r.dtype);let a={x:r},i={clipValueMin:t,clipValueMax:n};return Ei.runKernel(bt,a,i)}}),ml=Vi({concat1d_:function(e){return Ko(e,0)}}),fl=Vi({concat2d_:function(e,t){return Ko(e,t)}}),gl=Vi({concat3d_:function(e,t){return Ko(e,t)}}),yl=Vi({concat4d_:function(e,t){return Ko(e,t)}}),bl=Vi({conv2d_:function(e,t,n,r,a="NHWC",i=[1,1],s){let o=Bi(e,"x","conv2d","float32"),l=Bi(t,"filter","conv2d","float32"),u=o,d=!1;3===o.rank&&(d=!0,u=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]])),J(4===u.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`)),J(4===l.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`)),Ho("conv2d",r,s);let c="NHWC"===a?u.shape[3]:u.shape[1];J(c===l.shape[2],(()=>`Error in conv2d: depth of input (${c}) must match input depth for filter ${l.shape[2]}.`)),J(Wo(n,i),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`)),J(Vo(i),(()=>"Error in conv2D: Dilated rates should be larger than 0.")),J(Vo(n),(()=>"Error in conv2D: Strides should be larger than 0."));let h={x:u,filter:l},p={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s},m=Ei.runKernel(wt,h,p);return d?Go(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),xl=Vi({conv1d_:function(e,t,n,r,a="NWC",i=1,s){let o=Bi(e,"x","conv1d"),l=Bi(t,"filter","conv1d"),u=o,d=!1;2===o.rank&&(d=!0,u=Go(o,[1,o.shape[0],o.shape[1]])),J(3===u.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`)),J(3===l.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`)),Ho("conv1d",r,s),J(u.shape[2]===l.shape[1],(()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`)),J(Wo(n,i),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`)),J(Vo(i),(()=>"Error in conv1D: Dilated rates should be larger than 0.")),J(Vo(n),(()=>"Error in conv1D: Stride should be larger than 0.")),J("NWC"===a,(()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`));let c=Go(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=Go(u,[u.shape[0],1,u.shape[1],u.shape[2]]),p=bl(h,c,[1,n],r,"NHWC",[1,i],s);return Go(p,d?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}}),Al=Vi({conv2DBackpropInput_:function(e,t,n,r,a,i="NHWC",s){J(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let o=e,l=t,u=!1;3===t.rank&&(u=!0,l=Go(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),J(4===o.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`)),J(4===l.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`)),J(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));let d="NHWC"===i?o[3]:o[1],c="NHWC"===i?l.shape[3]:l.shape[1];J(d===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${n.shape[2]}.`)),J(c===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[3]}.`)),Ho("conv2dDerInput",a,s);let h={dy:l,filter:n},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:s,inputShape:o},m=Ei.runKernel(St,h,p);return u?Go(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),vl=Vi({conv2dTranspose_:function(e,t,n,r,a,i){let s=Bi(e,"x","conv2dTranspose"),o=Bi(t,"filter","conv2dTranspose");return Al(n,s,o,r,a,"NHWC",i)}}),wl=Vi({conv3d_:function(e,t,n,r,a="NDHWC",i=[1,1,1]){let s=Bi(e,"x","conv3d"),o=Bi(t,"filter","conv3d"),l=s,u=!1;4===s.rank&&(u=!0,l=Go(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),J(5===l.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`)),J(5===o.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`)),J(l.shape[4]===o.shape[3],(()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`)),J(Wo(n,i),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`)),J("NDHWC"===a,(()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`)),J(Vo(i),(()=>"Error in conv3D: Dilated rates should be larger than 0.")),J(Vo(n),(()=>"Error in conv3D: Strides should be larger than 0."));let d={x:l,filter:o},c={strides:n,pad:r,dataFormat:a,dilations:i},h=Ei.runKernel(Tt,d,c);return u?Go(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),kl=Vi({conv3DBackpropInput_:function(e,t,n,r,a){J(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let i=e,s=t,o=!1;4===t.rank&&(o=!0,s=Go(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);let l=i[4],u=s.shape[4];J(5===i.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`)),J(5===s.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`)),J(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),J(l===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`)),J(u===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`));let d={dy:s,filter:n},c={pad:a,strides:r,inputShape:i},h=Ei.runKernel(It,d,c);return o?Go(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),Sl=Vi({conv3dTranspose_:function(e,t,n,r,a){let i=Bi(e,"x","conv3dTranspose"),s=Bi(t,"filter","conv3dTranspose");return kl(n,i,s,r,a)}}),Tl=Vi({cos_:function(e){let t={x:Bi(e,"x","cos","float32")};return Ei.runKernel(Ct,t)}}),_l=Vi({cosh_:function(e){let t={x:Bi(e,"x","cosh","float32")};return Ei.runKernel(Et,t)}}),Il=Vi({cumprod_:function(e,t=0,n=!1,r=!1){let a={x:Bi(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Ei.runKernel(Nt,a,i)}}),Cl=Vi({cumsum_:function(e,t=0,n=!1,r=!1){let a={x:Bi(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Ei.runKernel(Rt,a,i)}}),El=Vi({denseBincount_:function(e,t,n,r=!1){let a=Bi(e,"x","denseBincount"),i=Bi(t,"weights","denseBincount");J("int32"===a.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`)),J(a.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`)),J(n>=0,(()=>`size must be non-negative, but got ${n}.`)),J(i.size===a.size||0===i.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${i.shape}.`));let s={x:a,weights:i},o={size:n,binaryOutput:r};return Ei.runKernel(Dt,s,o)}}),Nl=Vi({depthToSpace_:function(e,t,n="NHWC"){let r=Bi(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];J(t>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`)),J(a*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${a} and ${t}  for depthToSpace with input shape\n    ${r.shape}`)),J(i*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${t} for depthToSpace with input shape\n        ${r.shape}`)),J(s%(t*t)==0,(()=>`Dimension size must be evenly divisible by ${t*t} but is ${s} for depthToSpace with input shape ${r.shape}`));let o={x:r},l={blockSize:t,dataFormat:n};return Ei.runKernel(Mt,o,l)}}),Rl=Vi({depthwiseConv2d_:function(e,t,n,r,a="NHWC",i=[1,1],s){let o=Bi(e,"x","depthwiseConv2d","float32"),l=Bi(t,"filter","depthwiseConv2d","float32"),u=o,d=!1;3===o.rank&&(d=!0,u=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]])),J(4===u.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`)),J(4===l.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`));let c="NHWC"===a?u.shape[3]:u.shape[1];J(c===l.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c}) must match the inChannels dimension in filter ${l.shape[2]}.`)),Ho("depthwiseConv2d",r,s);let h={x:u,filter:l},p={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s},m=Ei.runKernel(Ot,h,p);return d?Go(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),Pl=Vi({diag_:function(e){let t={x:Bi(e,"x","diag")};return Ei.runKernel(Lt,t)}}),Dl=Vi({dilation2d_:function(e,t,n,r,a=[1,1],i="NHWC"){let s=Bi(e,"x","dilation2d"),o=Bi(t,"filter","dilation2d");J(3===s.rank||4===s.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`)),J(3===o.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`)),J("NHWC"===i,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`));let l=s,u=!1;3===s.rank&&(l=Go(s,[1,s.shape[0],s.shape[1],s.shape[2]]),u=!0),J(l.shape[3]===o.shape[2],(()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${o.shape[2]}`));let d={x:l,filter:o},c={strides:n,pad:r,dilations:a},h=Ei.runKernel(zt,d,c);return u?Go(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),Ml={};function Ol(e,t){let n=e.length,r=[];for(let a=0;a<n;a++){let i=n-1-a,s=e[i]||1;(t[t.length-1-a]||1)>1&&1===s&&r.unshift(i)}return r}function $l(e,t){let n=[];for(let r=0;r<t.length;r++){let a=e[e.length-r-1],i=t.length-r-1,s=t[i];(null==a||1===a&&s>1)&&n.unshift(i)}return n}function Fl(e,t){let n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let i=e[e.length-a-1];null==i&&(i=1);let s=t[t.length-a-1];if(null==s&&(s=1),1===i)r[n-a-1]=s;else if(1===s)r[n-a-1]=i;else{if(i!==s)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);r[n-a-1]=i}}return r}x(Ml,{assertAndGetBroadcastShape:()=>Fl,getBroadcastDims:()=>Ol,getReductionAxes:()=>$l});var Ll=Vi({equal_:function(e,t){let n=Bi(e,"a","equal","string_or_numeric"),r=Bi(t,"b","equal","string_or_numeric");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(Xt,a)}}),zl=Vi({where_:function(e,t,n){let r=Bi(t,"a","where"),a=Bi(n,"b","where"),i=Bi(e,"condition","where","bool"),s=Fl(Fl(i.shape,r.shape),a.shape),o={condition:dl(i,s),t:dl(r,s),e:dl(a,s)};return Ei.runKernel(wr,o)}}),Bl=Vi({zerosLike_:function(e){let t={x:Bi(e,"x","zerosLike")};return Ei.runKernel(aa,t)}}),Ul=Vi({divNoNan_:function(e,t){let n=Bi(e,"a","div"),r=Bi(t,"b","div");[n,r]=Ai(n,r);let a=go(n,r),i=Bl(a),s=Ll(r,i);return zl(s,i,a)}}),Wl=Vi({dot_:function(e,t){let n=Bi(e,"t1","dot"),r=Bi(t,"t2","dot");J(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));let a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(J(a===i,(()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`)),1===n.rank&&1===r.rank){let e=Go(n,[1,-1]),t=Go(r,[-1,1]),a=Zo(e,t);return Go(a,[])}if(1===n.rank&&2===r.rank){let e=Go(n,[1,-1]),t=Go(r,[r.shape[0],r.shape[1]]),a=Zo(e,t);return Go(a,[a.size])}if(2===n.rank&&1===r.rank){let e=Go(r,[-1,1]),t=Zo(n,e);return Go(t,[t.size])}{let e=Go(r,[r.shape[0],r.shape[1]]);return Zo(n,e)}}}),Vl=Vi({einsum_:function(e,...t){let n=t.map(((e,t)=>Bi(e,`tensors${t}`,"einsum"))),r={equation:e};return Ei.runKernel(jt,n,r)}}),jl=Vi({elu_:function(e){let t={x:Bi(e,"x","elu","float32")};return Ei.runKernel(Ht,t)}}),Hl=Vi({ensureShape_:function(e,t){let n=Bi(e,"x","ensureShape","string_or_numeric");if(!re(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}}),Gl=Vi({erf_:function(e){let t=Bi(e,"x","erf");J("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=Vs(t,"float32"));let n={x:t};return Ei.runKernel(qt,n)}});function ql(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Xl(e,t,n){let r=e.length+t.length,a=[],i=0,s=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?a.push(e[i++]):a.push(t[s++]);return a}function Kl(e,t){let n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((t=>e[t]))]}function Zl(e,t){return Xl(e,t.map((e=>1)),t)}function Yl(e,t,n){J(ql(t,n),(()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`))}function Jl(e,t){if(ql(e,t))return null;let n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function Ql(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))}function eu(e,t){let n=[];for(let r=t-e;r<t;++r)n.push(r);return n}var tu=Vi({max_:function(e,t=null,n=!1){let r={x:Bi(e,"x","max")},a={reductionIndices:t,keepDims:n};return Ei.runKernel(Nn,r,a)}}),nu=Vi({min_:function(e,t=null,n=!1){let r={x:Bi(e,"x","min")},a={axis:t,keepDims:n};return Ei.runKernel(Ln,r,a)}}),ru=Vi({pow_:function(e,t){let n=Bi(e,"base","pow"),r=Bi(t,"exp","pow");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(er,a)}});function au(e,t){if((Ga(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Ga(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Hi(e,[],[],t)}var iu=Vi({sqrt_:function(e){let t={x:Bi(e,"x","sqrt","float32")};return Ei.runKernel(Nr,t)}}),su=Vi({square_:function(e){let t=Bi(e,"x","square");return Ei.runKernel("Square",{x:t},{})}}),ou=Vi({sum_:function(e,t=null,n=!1){let r=Bi(e,"x","sum");"bool"===r.dtype&&(r=Vs(r,"int32"));let a={x:r},i={axis:t,keepDims:n};return Ei.runKernel(Rr,a,i)}});function lu(e,t,n=null){if(0===e.rank)return bo(e);if(1!==e.rank&&null===n)return lu(Go(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return ou(bo(e),n);if(t===1/0)return tu(bo(e),n);if(t===-1/0)return nu(bo(e),n);if("euclidean"===t||2===t)return iu(ou(ru(bo(e),au(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return tu(ou(bo(e),n[0]),n[1]-1);if(t===1/0)return tu(ou(bo(e),n[1]),n[0]);if(t===-1/0)return nu(ou(bo(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return iu(ou(su(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}var uu=Vi({norm_:function(e,t="euclidean",n=null,r=!1){let a=lu(e=Bi(e,"x","norm"),t,n),i=a.shape;if(r){let t=he(n,e.shape);i=Zl(a.shape,t)}return Go(a,i)}}),du=Vi({euclideanNorm_:function(e,t=null,n=!1){return uu(e,"euclidean",t,n)}}),cu=Vi({exp_:function(e){let t={x:Bi(e,"x","exp")};return Ei.runKernel(Kt,t)}}),hu=Vi({expandDims_:function(e,t=0){let n=Bi(e,"x","expandDims","string_or_numeric");J(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));let r={input:n},a={dim:t};return Ei.runKernel(Zt,r,a)}}),pu=Vi({expm1_:function(e){let t={x:Bi(e,"x","expm1")};return Ei.runKernel(Yt,t)}}),mu=Vi({tile_:function(e,t){let n=Bi(e,"x","tile","string_or_numeric");J(n.rank===t.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`));let r={x:n},a={reps:t};return Ei.runKernel(Zr,r,a)}}),fu=Vi({eye_:function(e,t,n,r="float32"){null==t&&(t=e);let a=Ws([e,t],r),i=e<=t?e:t;for(let e=0;e<i;++e)a.set(1,e,e);let s=Go(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return mu(hu(s,0),[n[0],1,1]);if(2===n.length)return mu(hu(hu(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return mu(hu(hu(hu(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}}),gu=Vi({floor_:function(e){let t={x:Bi(e,"x","floor","float32")};return Ei.runKernel(tn,t)}}),yu=Vi({gather_:function(e,t,n=0,r=0){let a={x:Bi(e,"x","gather"),indices:Bi(t,"indices","gather","int32")},i={axis:n,batchDims:r};return Ei.runKernel(an,a,i)}}),bu=Vi({greater_:function(e,t){let n=Bi(e,"a","greater","string_or_numeric"),r=Bi(t,"b","greater","string_or_numeric");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(on,a)}}),xu=Vi({greaterEqual_:function(e,t){let n=Bi(e,"a","greaterEqual","string_or_numeric"),r=Bi(t,"b","greaterEqual","string_or_numeric");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(ln,a)}}),Au=Vi({imag_:function(e){let t={input:Bi(e,"input","imag")};return Ei.runKernel(cn,t)}}),vu=Vi({isFinite_:function(e){let t={x:Bi(e,"x","isFinite")};return Ei.runKernel(hn,t)}}),wu=Vi({isInf_:function(e){let t={x:Bi(e,"x","isInf")};return Ei.runKernel(pn,t)}}),ku=Vi({isNaN_:function(e){let t={x:Bi(e,"x","isNaN")};return Ei.runKernel(mn,t)}}),Su=Vi({leakyRelu_:function(e,t=.2){let n={x:Bi(e,"x","leakyRelu")},r={alpha:t};return Ei.runKernel(fn,n,r)}}),Tu=Vi({less_:function(e,t){let n=Bi(e,"a","less","string_or_numeric"),r=Bi(t,"b","less","string_or_numeric");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(gn,a)}}),_u=Vi({lessEqual_:function(e,t){let n=Bi(e,"a","lessEqual","string_or_numeric"),r=Bi(t,"b","lessEqual","string_or_numeric");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(yn,a)}});function Iu(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");let r={start:e,stop:t,num:n};return Ei.runKernel(bn,{},r)}var Cu=Vi({localResponseNormalization_:function(e,t=5,n=1,r=1,a=.5){let i=Bi(e,"x","localResponseNormalization");J(4===i.rank||3===i.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${i.rank}.`)),J(ie(t),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`));let s=i,o=!1;3===i.rank&&(o=!0,s=Go(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},u={depthRadius:t,bias:n,alpha:r,beta:a},d=Ei.runKernel(In,l,u);return o?Go(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Eu=Vi({log_:function(e){let t={x:Bi(e,"x","log","float32")};return Ei.runKernel(xn,t)}}),Nu=Vi({log1p_:function(e){let t={x:Bi(e,"x","log1p")};return Ei.runKernel(An,t)}});function Ru(e){return J(Te(e),(()=>"The f passed in grad(f) must be a function")),(t,n)=>{let r=Bi(t,"x","tf.grad","string_or_numeric"),a=null!=n?Bi(n,"dy","tf.grad"):null;return Ei.tidy((()=>{let{value:t,grads:n}=Ei.gradients((()=>e(r)),[r],a);return null!=a&&Q(t.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Fu(n),n[0]}))}}function Pu(e){return J(Te(e),(()=>"The f passed in grads(f) must be a function")),(t,n)=>{J(Array.isArray(t),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));let r=Ui(t,"args","tf.grads","string_or_numeric"),a=null!=n?Bi(n,"dy","tf.grads"):null;return Ei.tidy((()=>{let{value:t,grads:n}=Ei.gradients((()=>e(...r)),r,a);return null!=a&&Q(t.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Fu(n),n}))}}function Du(e){return J(Te(e),(()=>"The f passed in valueAndGrad(f) must be a function")),(t,n)=>{J(t instanceof si,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),J(null==n||n instanceof si,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));let{grads:r,value:a}=Ei.gradients((()=>e(t)),[t],n);return Fu(r),{grad:r[0],value:a}}}function Mu(e){return J(Te(e),(()=>"The f passed in valueAndGrads(f) must be a function")),(t,n)=>{J(Array.isArray(t)&&t.every((e=>e instanceof si)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),J(null==n||n instanceof si,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));let r=Ei.gradients((()=>e(...t)),t,n);return null!=n&&Q(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Fu(r.grads),r}}function Ou(e,t){J(Te(e),(()=>"The f passed in variableGrads(f) must be a function")),J(null==t||Array.isArray(t)&&t.every((e=>e instanceof oi)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));let n=null!=t;if(!n){t=[];for(let e in Ei.registeredVariables)t.push(Ei.registeredVariables[e])}let r=n?t.filter((e=>!e.trainable)):null,a=t.length;J((t=t.filter((e=>e.trainable))).length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`));let{value:i,grads:s}=Ei.gradients(e,t,null,!0);J(s.some((e=>null!=e)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),J(0===i.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`));let o={};return t.forEach(((e,t)=>{null!=s[t]&&(o[e.name]=s[t])})),null!=r&&r.forEach((e=>o[e.name]=null)),{value:i,grads:o}}function $u(e){return Ei.customGrad(e)}function Fu(e){if(e.filter((e=>null==e)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var Lu=Vi({neg_:function(e){let t={x:Bi(e,"x","neg")};return Ei.runKernel(jn,t)}}),zu=Vi({softplus_:function(e){let t={x:Bi(e,"x","softplus")};return Ei.runKernel(Er,t)}}),Bu=Vi({logSigmoid_:function(e){let t=Bi(e,"x","logSigmoid");return $u((e=>({value:Lu(zu(Lu(e))),gradFunc:t=>yo(t,Yo(Lu(e)))})))(t)}}),Uu=Vi({sub_:function(e,t){let n=Bi(e,"a","sub"),r=Bi(t,"b","sub");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(qr,a)}}),Wu=Vi({logSoftmax_:function(e,t=-1){let n=Bi(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return $u(((e,n)=>{let r=tu(e,t,!0),a=Uu(e,r),i=Uu(Vs(a,"float32"),Eu(ou(cu(a),t,!0)));return n([i]),{value:i,gradFunc:(e,n)=>{let[r]=n,a=cu(r);return Uu(e,yo(ou(e,t,!0),a))}}}))(n)}}),Vu=Vi({logSumExp_:function(e,t=null,n=!1){let r=Bi(e,"x","logSumExp"),a=he(t,r.shape),i=tu(r,a,!0),s=Uu(r,i),o=cu(s),l=ou(o,a),u=Eu(l),d=mo(Go(i,u.shape),u);if(n){let e=Zl(d.shape,a);return Go(d,e)}return d}}),ju=Vi({logicalAnd_:function(e,t){let n=Bi(e,"a","logicalAnd","bool"),r=Bi(t,"b","logicalAnd","bool");Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(vn,a)}}),Hu=Vi({logicalNot_:function(e){let t={x:Bi(e,"x","logicalNot","bool")};return Ei.runKernel(wn,t)}}),Gu=Vi({logicalOr_:function(e,t){let n=Bi(e,"a","logicalOr","bool"),r=Bi(t,"b","logicalOr","bool");Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(kn,a)}}),qu=Vi({logicalXor_:function(e,t){let n=Bi(e,"a","logicalXor","bool"),r=Bi(t,"b","logicalXor","bool");return Fl(n.shape,r.shape),ju(Gu(e,t),Hu(ju(e,t)))}}),Xu=2147483648,Ku=Vi({searchSorted_:function(e,t,n="left"){let r=Bi(e,"sortedSequence","searchSorted"),a=Bi(t,"values","searchSorted"),i=r.shape[r.shape.length-1],s=a.shape[a.shape.length-1],o=Go(r,[-1,i]),l=Go(a,[-1,s]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(te(l.shape)>=Xu)throw new Error(`values tensor size must less than ${Xu}`);if(o.shape[1]>=Xu)throw new Error(`trailing dim_size must less than ${Xu} for int32 output type, was ${o.shape[1]}`);let u={sortedSequence:o,values:l},d={side:n};return Ei.runKernel(vr,u,d)}});function Zu(e,t){return Ku(e,t,"left")}var Yu=Vi({maxPool_:function(e,t,n,r,a){let i=Bi(e,"x","maxPool"),s=i,o=!1;3===i.rank&&(o=!0,s=Go(i,[1,i.shape[0],i.shape[1],i.shape[2]])),J(4===s.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`)),J(Wo(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),Ho("maxPool",r,a);let l={x:s},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a},d=Ei.runKernel(Pn,l,u);return o?Go(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Ju=Vi({maxPool3d_:function(e,t=[1,1,1],n,r,a,i="NDHWC"){let s=Bi(e,"x","maxPool3d"),o=s,l=!1;4===s.rank&&(l=!0,o=Go(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),J(5===o.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`)),J("NDHWC"===i,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`)),Ho("maxPool3d",r,a);let u={x:o},d={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},c=Ei.runKernel(Mn,u,d);return l?Go(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),Qu=Vi({maxPoolWithArgmax_:function(e,t,n,r,a=!1){let i={x:Bi(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},o=Ei.runKernel($n,i,s);return{result:o[0],indexes:o[1]}}}),ed=Vi({maximum_:function(e,t){let n=Bi(e,"a","maximum"),r=Bi(t,"b","maximum");[n,r]=Ai(n,r),"bool"===n.dtype&&(n=Vs(n,"int32"),r=Vs(r,"int32")),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(Rn,a)}}),td=Vi({mean_:function(e,t=null,n=!1){let r={x:Bi(e,"x","mean")},a={axis:t,keepDims:n};return Ei.runKernel(Fn,r,a)}});function nd(e,t="float32"){if(Me(e),"complex64"===t){let t=nd(e,"float32"),n=nd(e,"float32");return ji(t,n)}let n=Pe(te(e),t);return Ei.makeTensor(n,e,t)}function rd(e,t="float32"){if(Me(e),"complex64"===t){let t=rd(e,"float32"),n=nd(e,"float32");return ji(t,n)}let n=Re(te(e),t);return Ei.makeTensor(n,e,t)}function ad(e,t,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===e)return[];let r=Bi(e,"x","meshgrid",e instanceof si?e.dtype:"float32");if(void 0===t)return[r];let a=Bi(t,"y","meshgrid",t instanceof si?t.dtype:"float32"),i=te(r.shape),s=te(a.shape);return"xy"===n?(r=Go(r,[1,-1]),a=Go(a,[-1,1]),[Zo(rd([s,1],r.dtype),r),Zo(a,rd([1,i],a.dtype))]):(r=Go(r,[-1,1]),a=Go(a,[1,-1]),[Zo(r,rd([1,s],r.dtype)),Zo(rd([i,1],a.dtype),a)])}var id=Vi({minimum_:function(e,t){let n=Bi(e,"a","minimum"),r=Bi(t,"b","minimum");[n,r]=Ai(n,r),"bool"===n.dtype&&(n=Vs(n,"int32"),r=Vs(r,"int32")),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(zn,a)}}),sd=Vi({mirrorPad_:function(e,t,n){J("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));let r=Bi(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");J(t.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`));let a="reflect"===n?1:0;for(let e=0;e<r.rank;e++)J(2===t[e].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),J(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(()=>`Padding in dimension ${e} cannot be greater than or equal to ${r.shape[e]-a} or less than 0 for input of shape ${r.shape}`));let i={paddings:t,mode:n},s={x:r};return Ei.runKernel(Bn,s,i)}}),od=Vi({mod_:function(e,t){let n=Bi(e,"a","mod"),r=Bi(t,"b","mod");[n,r]=Ai(n,r);let a={a:n,b:r};return Ei.runKernel(Un,a)}}),ld=Vi({moments_:function(e,t=null,n=!1){let r=he(t,(e=Bi(e,"x","moments")).shape),a=td(e,r,n),i=a.shape;n||(i=Zl(a.shape,r));let s=su(Uu(Vs(e,"float32"),Go(a,i)));return{mean:a,variance:td(s,r,n)}}}),ud=Vi({multiRNNCell_:function(e,t,n,r){let a=Bi(t,"data","multiRNNCell"),i=Ui(n,"c","multiRNNCell"),s=Ui(r,"h","multiRNNCell"),o=a,l=[];for(let t=0;t<e.length;t++){let n=e[t](o,i[t],s[t]);l.push(n[0]),l.push(n[1]),o=n[1]}let u=[],d=[];for(let e=0;e<l.length;e+=2)u.push(l[e]),d.push(l[e+1]);return[u,d]}}),dd=Vi({multinomial_:function(e,t,n,r=!1){let a=Bi(e,"logits","multinomial"),i=a.size,s=a.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(s>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${s}`);n=n||Math.random();let o={logits:1===s?Go(a,[1,-1]):a},l={numSamples:t,seed:n,normalized:r},u=Ei.runKernel(Wn,o,l);return 1===s?Go(u,[u.size]):u}}),cd=Vi({notEqual_:function(e,t){let n=Bi(e,"a","notEqual","string_or_numeric"),r=Bi(t,"b","notEqual","string_or_numeric");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(Hn,a)}}),hd=Vi({oneHot_:function(e,t,n=1,r=0,a="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let i={indices:Bi(e,"indices","oneHot","int32")},s={dtype:a,depth:t,onValue:n,offValue:r};return Ei.runKernel(Zn,i,s)}}),pd=Vi({onesLike_:function(e){let t={x:Bi(e,"x","onesLike")};return Ei.runKernel(Kn,t)}}),md=Vi({outerProduct_:function(e,t){let n=Bi(e,"v1","outerProduct"),r=Bi(t,"v2","outerProduct");J(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));let a=Go(n,[-1,1]),i=Go(r,[1,-1]);return Zo(a,i)}}),fd=Vi({pad_:function(e,t,n=0){let r=Bi(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:t,constantValue:n},i={x:r};return Ei.runKernel(Jn,i,a)}}),gd=Vi({pad1d_:function(e,t,n=0){return J(2===t.length,(()=>"Invalid number of paddings. Must be length of 2.")),fd(e,[t],n)}}),yd=Vi({pad2d_:function(e,t,n=0){return J(2===t.length&&2===t[0].length&&2===t[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),fd(e,t,n)}}),bd=Vi({pad3d_:function(e,t,n=0){return J(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),fd(e,t,n)}}),xd=Vi({pad4d_:function(e,t,n=0){return J(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),fd(e,t,n)}}),Ad=Vi({spaceToBatchND_:function(e,t,n){let r=Bi(e,"x","spaceToBatchND");J(r.rank>=1+t.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`)),J(n.length===t.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`)),J(r.shape.reduce(((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`));let a={x:r},i={blockShape:t,paddings:n};return Ei.runKernel(Pr,a,i)}}),vd=Vi({pool_:function(e,t,n,r,a,i,s){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");let o=Bi(e,"x","maxPool"),l=o,u=!1;3===o.rank&&(u=!0,l=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]])),J(Wo(i,a),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`));let d,c=Po(l.shape,t,i,a,r),h=[c.dilationHeight,c.dilationWidth];d="same"===r?function(e,t){let n=e.map(((e,n)=>e+(e-1)*(t[n]-1))).map((e=>e-1)),r=n.map((e=>Math.floor(e/2))),a=n.map(((e,t)=>e-r[t]));return n.map(((e,t)=>[r[t],a[t]]))}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];let p=1===h[0]&&1===h[1],[m,f]=function(e,t,n){let r=n.map((e=>e[0])),a=n.map((e=>e[1])),i=e.concat(r,a),s=t.map(((e,t)=>(e-i[t]%e)%e)),o=a.map(((e,t)=>e+s[t])),l=t.map(((e,t)=>[r[t],o[t]])),u=t.map(((e,t)=>[0,s[t]]));return[l,u]}([c.inHeight,c.inWidth],h,d),g=p?r:"valid",y=p?l:Ad(l,h,m),b=("avg"===n?()=>qo(y,t,i,g,s):()=>Yu(y,t,i,g,s))(),x=p?b:tl(b,h,f);return u?Go(x,[x.shape[1],x.shape[2],x.shape[3]]):x}}),wd=Vi({prelu_:function(e,t){let n={x:Bi(e,"x","prelu"),alpha:Bi(t,"alpha","prelu")};return Ei.runKernel(tr,n)}}),kd=Vi({prod_:function(e,t=null,n=!1){let r=Bi(e,"x","prod");"bool"===r.dtype&&(r=Vs(r,"int32"));let a={x:r},i={axis:t,keepDims:n};return Ei.runKernel(nr,a,i)}}),Sd=Vi({raggedGather_:function(e,t,n,r){let a={paramsNestedSplits:e.map(((e,t)=>Bi(e,`tensors${t}`,"raggedGather","int32"))),paramsDenseValues:Bi(t,"paramsDenseValues","raggedGather"),indices:Bi(n,"indices","raggedGather","int32")},i={outputRaggedRank:r},s=Ei.runKernel(rr,a,i);return{outputNestedSplits:s.slice(0,s.length-1),outputDenseValues:s[s.length-1]}}}),Td=Vi({raggedRange_:function(e,t,n){let r=Bi(e,"starts","raggedRange"),a={starts:r,limits:Bi(t,"limits","raggedRange",r.dtype),deltas:Bi(n,"deltas","raggedRange",r.dtype)},i=Ei.runKernel(ar,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}}),_d=Vi({raggedTensorToTensor_:function(e,t,n,r,a){let i=Bi(e,"shape","raggedTensorToTensor","int32"),s=Bi(t,"values","raggedTensorToTensor"),o={shape:i,values:s,defaultValue:Bi(n,"defaultValue","raggedTensorToTensor",s.dtype),rowPartitionTensors:r.map(((e,t)=>Bi(e,`tensors${t}`,"raggedTensorToTensor","int32")))},l={rowPartitionTypes:a};return Ei.runKernel(ir,o,l)}}),Id=Vi({rand_:function(e,t,n){Me(e);let r=te(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);a=new Uint8Array(r)}for(let e=0;e<r;e++)a[e]=t();return Ei.makeTensor(a,e,n)}}),Cd=A(P()),Ed={};x(Ed,{TEST_EPSILON_FLOAT16:()=>Rd,createVideoElement:()=>Wd,encodeStrings:()=>Ud,expectArrayBuffersEqual:()=>Bd,expectArraysClose:()=>Pd,expectArraysEqual:()=>$d,expectNumbersClose:()=>Fd,expectPromiseToFail:()=>Od,expectValuesInRange:()=>zd,play:()=>Vd,testEpsilon:()=>Dd});var Nd=.001,Rd=.1;function Pd(e,t,n){return null==n&&(n=Dd()),Md(e,t,((e,t)=>Ld(e,t,n)))}function Dd(){return 32===Ei.backend.floatPrecision()?Nd:Rd}function Md(e,t,n){let r=!0;if((Ga(e)||Ga(t))&&(r=!1),Ga(e)&&Ga(t)&&(r=!0),r){let n=e.constructor.name,r=t.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(e)&&Array.isArray(t)){let n=Fi(e),r=Fi(t);if(!ae(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}let a=Ga(e)?e:qa(e),i=Ga(t)?t:qa(t);if(a.length!==i.length)throw new Error(`Arrays have different lengths actual: ${a.length} vs expected: ${i.length}.\nActual:   ${a}.\nExpected: ${i}.`);for(let e=0;e<i.length;++e){let t=a[e],r=i[e];if(!n(t,r))throw new Error(`Arrays differ: actual[${e}] = ${t}, expected[${e}] = ${r}.\nActual:   ${a}.\nExpected: ${i}.`)}"undefined"!=typeof expect&&expect().nothing()}function Od(e,t){e().then((()=>t.fail()),(()=>t())),"undefined"!=typeof expect&&expect().nothing()}function $d(e,t){let n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return ve(e)||ve(e[0])||ve(t)||ve(t[0])?Md(e,n,((e,t)=>e==t)):Md(e,t,((e,t)=>Ld(e,t,0)))}function Fd(e,t,n){if(null==n&&(n=Dd()),!Ld(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);"undefined"!=typeof expect&&expect().nothing()}function Ld(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function zd(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function Bd(e,t){let n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let e=0;e<r.length;e++)if(n[e]!==r[e])throw new Error(`Expected ArrayBuffer value at ${e} to be ${r[e]} but got ${n[e]} instead`)}function Ud(e){for(let t=0;t<e.length;t++){let n=e[t];Array.isArray(n)?Ud(n):e[t]=ja(n)}return e}function Wd(e){let t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((e=>{t.addEventListener("loadeddata",(n=>e(t))),t.load()}))}async function Vd(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise((t=>{e.requestVideoFrameCallback(t)}))}var jd=class{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);let i=a||Math.random();this.random=Cd.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){let e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,i;do{r=2*this.random()-1,a=2*this.random()-1,i=r*r+a*a}while(i>=1||0===i);let s=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*a*s,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},Hd=Vi({randomGamma_:function(e,t,n=1,r="float32",a){if(Me(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);let i=new class{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;let a=r||Math.random();this.randu=Cd.alea(a.toString()),this.randn=new jd(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,a,i;for(;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-i+Math.log(i)),a=this.randu(),a<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}(t,n,r,a),s=Ws(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=i.nextValue();return s.toTensor()}}),Gd=Vi({randomNormal_:function(e,t=0,n=1,r,a){if(Me(e),null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);let i=new jd(t,n,r,!1,a),s=Ws(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=i.nextValue();return s.toTensor()}}),qd=Vi({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error(`Unsupported data type ${t}`);return Gd(e,0,1,t,n)}}),Xd=Vi({randomUniform_:function(e,t=0,n=1,r="float32",a){Me(e);let i=Ws(e,r),s=new class{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Cd.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}(t,n,null,a);for(let e=0;e<i.values.length;e++)i.values[e]=s.nextValue();return i.toTensor()}}),Kd=Vi({randomUniformInt_:function(e,t,n,r){return Xd(e,t,n,"int32",r)}});function Zd(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");let a={start:e,stop:t,step:n,dtype:r};return Ei.runKernel(sr,{},a)}var Yd=Vi({real_:function(e){let t={input:Bi(e,"input","real")};return Ei.runKernel(or,t)}}),Jd=Vi({reciprocal_:function(e){let t={x:Bi(e,"x","reciprocal")};return Ei.runKernel(lr,t)}}),Qd=Vi({relu_:function(e){let t={x:Bi(e,"x","relu")};return Ei.runKernel(ur,t)}}),ec=Vi({relu6_:function(e){let t={x:Bi(e,"x","relu6")};return Ei.runKernel(fr,t)}}),tc=Vi({reverse_:function(e,t){let n={x:Bi(e,"x","reverse")},r={dims:t};return Ei.runKernel(gr,n,r)}}),nc=Vi({reverse1d_:function(e){let t=Bi(e,"x","reverse");return J(1===t.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`)),tc(t,0)}}),rc=Vi({reverse2d_:function(e,t){let n=Bi(e,"x","reverse");return J(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),tc(n,t)}}),ac=Vi({reverse3d_:function(e,t){let n=Bi(e,"x","reverse");return J(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),tc(n,t)}}),ic=Vi({reverse4d_:function(e,t){let n=Bi(e,"x","reverse");return J(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),tc(n,t)}}),sc=Vi({round_:function(e){let t={x:Bi(e,"x","round")};return Ei.runKernel(yr,t)}}),oc=Vi({rsqrt_:function(e){let t={x:Bi(e,"x","rsqrt","float32")};return Ei.runKernel(br,t)}}),lc=Vi({selu_:function(e){let t={x:Bi(e,"x","selu")};return Ei.runKernel(kr,t)}}),uc=Vi({separableConv2d_:function(e,t,n,r,a,i=[1,1],s="NHWC"){let o=Bi(e,"x","separableConv2d"),l=Bi(t,"depthwiseFilter","separableConv2d"),u=Bi(n,"pointwiseFilter","separableConv2d"),d=o,c=!1;if(3===o.rank&&(c=!0,d=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");J(4===d.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`)),J(4===l.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`)),J(4===u.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`)),J(1===u.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`)),J(1===u.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`));let h=l.shape[2],p=l.shape[3];J(u.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${u.shape[2]}.`));let m=Rl(d,l,r,a,s,i),f=bl(m,u,1,"valid",s);return c?Go(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),dc=async function(e,t){let n=Bi(e,"x","setdiff1d"),r=Bi(t,"y","setdiff1d");J(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),J(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),J(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));let a=await n.data(),i=await r.data(),s=new Set(i),o=0;for(let e=0;e<a.length;e++)s.has(a[e])||o++;let l=new ri([o],n.dtype),u=new ri([o],"int32");for(let e=0,t=0;e<a.length;e++)s.has(a[e])||(l.values[t]=a[e],u.values[t]=e,t++);return[l.toTensor(),u.toTensor()]},cc=Vi({sign_:function(e){let t={x:Bi(e,"x","sign")};return Ei.runKernel(Ir,t)}}),hc=Vi({sin_:function(e){let t={x:Bi(e,"x","sin","float32")};return Ei.runKernel(Tr,t)}}),pc=Vi({sinh_:function(e){let t={x:Bi(e,"x","sinh")};return Ei.runKernel(_r,t)}}),mc=Vi({slice1d_:function(e,t,n){let r=Bi(e,"x","slice1d");return J(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),Jo(r,[t],[n])}}),fc=Vi({slice2d_:function(e,t,n){let r=Bi(e,"x","slice2d");return J(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),Jo(r,t,n)}}),gc=Vi({slice3d_:function(e,t,n){let r=Bi(e,"x","slice3d");return J(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),Jo(r,t,n)}}),yc=Vi({slice4d_:function(e,t,n){let r=Bi(e,"x","slice4d");return J(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),Jo(r,t,n)}}),bc=Vi({softmax_:function(e,t=-1){let n=Bi(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);let r={logits:n},a={dim:t};return Ei.runKernel(Mr,r,a)}}),xc=Vi({fft_:function(e){J("complex64"===e.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`));let t={input:e};return Ei.runKernel(Jt,t)}}),Ac=Vi({ifft_:function(e){J("complex64"===e.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`));let t={input:e};return Ei.runKernel(dn,t)}}),vc=Vi({irfft_:function(e){let t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){let a=Go(e,[r,n]);t=Ac(a)}else{let a=[r,2*(n-1)],i=Go(Yd(e),[r,n]),s=Go(Au(e),[r,n]),o=tc(Jo(i,[0,1],[r,n-2]),1),l=yo(tc(Jo(s,[0,1],[r,n-2]),1),au(-1)),u=Ko([i,o],1),d=Ko([s,l],1),c=Go(ji(u,d),[a[0],a[1]]);t=Ac(c)}if(t=Yd(t),3===e.rank&&0!==e.shape[0]){let n=t,r=e.shape[0];t=Go(t,[r,t.shape[0]/r,t.shape[1]]),n.dispose()}return t}}),wc=Vi({split_:function(e,t,n=0){let r={x:Bi(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Ei.runKernel(Dr,r,a)}}),kc=Vi({rfft_:function(e,t){J("float32"===e.dtype,(()=>`The dtype for rfft() must be real value but got ${e.dtype}`));let n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){let a=e.shape.map((e=>0)),i=e.shape.map((e=>e));i[e.shape.length-1]=t,n=Jo(e,a,i),r=t}else if(null!=t&&t>r){let a=e.shape.map((e=>e));a[e.shape.length-1]=t-r,n=Ko([e,nd(a)],e.shape.length-1),r=t}else n=e;let i=Bl(n),s=Go(ji(n,i),[a,r]),o=xc(s),l=Math.floor(r/2)+1,u=Yd(o),d=Au(o),c=wc(u,[l,r-l],u.shape.length-1),h=wc(d,[l,r-l],d.shape.length-1),p=n.shape.slice();return p[n.shape.length-1]=l,Go(ji(c[0],h[0]),p)}}),Sc=Vi({squaredDifference_:function(e,t){let n=Bi(e,"a","squaredDifference"),r=Bi(t,"b","squaredDifference");[n,r]=Ai(n,r),Fl(n.shape,r.shape);let a={a:n,b:r};return Ei.runKernel(Br,a,{})}}),Tc=Vi({squeeze_:function(e,t){let n=Bi(e,"x","squeeze","string_or_numeric");return Go(n,pe(n.shape,t).newShape)}}),_c=Vi({stack_:function(e,t=0){let n=Ui(e,"tensors","stack","string_or_numeric");J(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&J(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));let r=n,a={axis:t};return Ei.runKernel(Yn,r,a)}}),Ic=Vi({step_:function(e,t=0){let n={x:Bi(e,"x","step")},r={alpha:t};return Ei.runKernel(ia,n,r)}}),Cc=Vi({stridedSlice_:function(e,t,n,r,a=0,i=0,s=0,o=0,l=0){let u={x:Bi(e,"x","stridedSlice","string_or_numeric")},d={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};return Ei.runKernel(Vr,u,d)}}),Ec=Vi({tan_:function(e){let t={x:Bi(e,"x","tan","float32")};return Ei.runKernel(Xr,t)}});function Nc(e,t){ee(e);let n=Fi(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Hi(e,null,n,t)}function Rc(e,t,n){if(ee(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");let r=Fi(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Hi(e,t,r,n)}function Pc(e,t,n){if(ee(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");let r=Fi(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Hi(e,t,r,n)}function Dc(e,t,n){if(ee(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");let r=Fi(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Hi(e,t,r,n)}function Mc(e,t,n){if(ee(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");let r=Fi(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Hi(e,t,r,n)}function Oc(e,t,n){if(ee(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");let r=Fi(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Hi(e,t=t||r,r,n)}var $c={};function Fc(e,t,n){let r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(i+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(i+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(let e=0;e<a;++e)if(n.shape[e]!==t.shape[e])throw new Error(i+` updates.shape[${e}] (${n.shape[e]}) != indices.shape[${e}] (${t.shape[e]}).`);for(let t=0;t<n.rank-a;++t)if(n.shape[t+a]!==e[t+r])throw new Error(i+` updates.shape[${t+a}] (${n.shape[t+a]}) != shape[${t+a}] (${e[t+a]})`)}function Lc(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}Fc(n,t,e)}function zc(e,t,n){let r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,s=1;for(let e=a;e<i;++e)s*=n[e];let o=a<1?1:a;return{sliceRank:a,numUpdates:te(t.shape)/o,sliceSize:s,strides:[...Ie(n.slice(0,a)),1],outputSize:te(n)}}x($c,{calculateShapes:()=>zc,validateInput:()=>Lc,validateUpdateShape:()=>Fc});var Bc=Vi({tensorScatterUpdate_:function(e,t,n){let r=Bi(e,"tensor","tensorScatterupdate"),a=Bi(t,"indices","tensorScatterupdate","int32"),i=Bi(n,"updates","tensorScatterupdate");if(Lc(i,a,r.shape),r.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${i.dtype}.`);let s={tensor:r,indices:a,updates:i};return Ei.runKernel(Ar,s,{})}}),Uc=Vi({topk_:function(e,t=1,n=!0){let r=Bi(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);let i={x:r},s={k:t,sorted:n},[o,l]=Ei.runKernel(Yr,i,s);return{values:o,indices:l}}}),Wc=Vi({truncatedNormal_:function(e,t=0,n=1,r,a){if(Me(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");let i=new jd(t,n,r,!0,a),s=Ws(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=i.nextValue();return s.toTensor()}}),Vc=Vi({unique_:function(e,t=0){let n=Bi(e,"x","unique","string_or_numeric");J(n.rank>0,(()=>"The input tensor must be at least 1D"));let r={x:n},a={axis:t},[i,s]=Ei.runKernel(ea,r,a);return{values:i,indices:s}}}),jc=Vi({unsortedSegmentSum_:function(e,t,n){let r=Bi(e,"x","unsortedSegmentSum"),a=Bi(t,"segmentIds","unsortedSegmentSum","int32");J(ie(n),(()=>"numSegments must be of dtype int"));let i={x:r,segmentIds:a},s={numSegments:n};return Ei.runKernel(na,i,s)}}),Hc=Vi({unstack_:function(e,t=0){let n=Bi(e,"x","unstack","string_or_numeric");J(t>=-n.shape.length&&t<n.shape.length,(()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`));let r={value:n},a={axis:t};return Ei.runKernel(ta,r,a)}});function Gc(e,t){return Ku(e,t,"right")}function qc(e,t=!0,n,r){return Ei.makeVariable(e,t,n,r)}function Xc(e,t){let n=[];for(let e=0;e<t.length;e++)t[e]&&n.push(e);let r=Ws(e,"int32"),a=Ws([n.length,e.length],"int32");for(let t=0;t<n.length;t++){let i=r.indexToLoc(n[t]),s=t*e.length;a.values.set(i,s)}return a.toTensor()}var Kc=async function(e){let t=Bi(e,"condition","whereAsync","bool"),n=await t.data(),r=Xc(t.shape,n);return e!==t&&t.dispose(),r},Zc=async function(e,t,n){let r=Bi(e,"tensor","boolMask"),a=Bi(t,"mask","boolMask","bool"),i=null==n?0:n,s=a.rank,o=r.shape;J(s>0,(()=>"mask cannot be scalar")),Q(o.slice(i,i+s),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let e=i;e<i+s;e++)l*=o[e];let u=o.slice(0,i).concat([l],o.slice(i+s)),d=Go(r,u),c=Go(a,[-1]),h=await Kc(c),p=Tc(h,[1]),m=yu(d,p,i);return e!==r&&r.dispose(),t!==a&&a.dispose(),p.dispose(),d.dispose(),c.dispose(),h.dispose(),m},Yc=Vi({transpose_:function(e,t,n){let r=Bi(e,"x","transpose");if(null==t&&(t=r.shape.map(((e,t)=>t)).reverse()),J(r.rank===t.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`)),t.forEach((e=>{J(e>=0&&e<r.rank,(()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`))})),r.rank<=1)return r.clone();let a={x:r},i={perm:t};return"complex64"===r.dtype?eo((()=>{let e=Yd(r),t=Au(r);return e=Ei.runKernel(Qr,{x:e},i),t=Ei.runKernel(Qr,{x:t},i),n&&(t=Lu(t)),ji(e,t)})):Ei.runKernel(Qr,a,i)}}),Jc=Vi({movingAverage_:function(e,t,n,r,a=!0){let i=Bi(e,"v","movingAverage"),s=Bi(t,"x","movingAverage"),o=Bi(n,"decay","movingAverage");vi(i,s),J(ae(i.shape,s.shape),(()=>"Shape mismatch in v and x"));let l=au(1),u=Uu(l,o),d=yo(Uu(s,i),u);if(a){J(null!=r,(()=>"When using zeroDebias: true, step is required."));let e=Bi(r,"step","movingAverage");d=go(d,Uu(l,ru(o,e)))}return mo(i,d)}}),Qc=Vi({scatterND_:function(e,t,n){Me(n);let r=Bi(e,"indices","scatterND","int32"),a=Bi(t,"updates","scatterND");Lc(a,r,n);let i={indices:r,updates:a},s={shape:n};return Ei.runKernel(xr,i,s)}}),eh=Vi({sparseToDense_:function(e,t,n,r=0){Me(n);let a=Bi(e,"sparseIndices","sparseToDense","int32"),i=Bi(t,"sparseValues","sparseToDense","string_or_numeric"),s=Bi(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);let a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${i}.`);let s=t.size;if(0!==t.rank&&(1!==t.rank||s!==a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,s);let o={sparseIndices:a,sparseValues:i,defaultValue:s},l={outputShape:n};return Ei.runKernel(zr,o,l)}}),th=Vi({gatherND_:function(e,t){let n=Bi(t,"indices","gatherND","int32"),r={params:Bi(e,"x","gatherND","string_or_numeric"),indices:n};return Ei.runKernel(sn,r)}}),nh=Vi({dropout_:function(e,t,n,r){let a=Bi(e,"x","dropout");if(J("float32"===a.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`)),J(t>=0&&t<1,(()=>`rate must be a float in the range [0, 1), but got ${t}.`)),0===t)return e instanceof si?a.clone():a;let i=function(e,t){if(null==t)return e.shape.slice();if(ae(e.shape,t))return t;if(e.shape.length===t.length){let n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),s=1-t,o=go(gu(mo(Xd(i,0,1,"float32",r),s)),s);return yo(a,o)}});function rh(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function ah(e,t,n){let r=1-e%2,a=new Float32Array(e);for(let i=0;i<e;++i){let s=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(s)}return Nc(a,"float32")}var ih=async function(e,t,n=1){let r=Bi(e,"predictions","inTopK"),a=Bi(t,"targets","inTopK");J(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),J(r.rank-1===a.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${a.rank}`)),Q(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let i=r.shape[r.shape.length-1];J(n>0&&n<=i,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${n}`));let s=await r.data(),o=await a.data(),[l,u]=[s.length/i,i],d=me("bool",l);for(let e=0;e<l;e++){let t=e*u,r=s.subarray(t,t+u),a=[];for(let e=0;e<r.length;e++)a.push({value:r[e],index:e});a.sort(((e,t)=>t.value-e.value)),d[e]=0;for(let t=0;t<n;t++)if(a[t].index===o[e]){d[e]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),Gi(d,a.shape,"bool")},sh={};x(sh,{conv2d:()=>hh,depthwiseConv2d:()=>fh,matMul:()=>gh});var oh=Vi({conv2DBackpropFilter_:function(e,t,n,r,a,i="NHWC",s){let o=e;3===e.rank&&(o=Go(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=Go(t,[1,t.shape[0],t.shape[1],t.shape[2]])),J(4===o.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`)),J(4===l.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`)),J(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));let u="NHWC"===i?o.shape[3]:o.shape[1],d="NHWC"===i?l.shape[3]:l.shape[1];J(u===n[2],(()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`)),J(d===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${n[3]}).`)),Ho("conv2dDerFilter",a,s);let c={x:o,dy:l},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:s,filterShape:n};return Ei.runKernel(kt,c,h)}});function lh(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return yo(e,Ic(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function uh(e,t){let n=t,r=$l(e.shape,t.shape);return r.length>0&&(n=ou(n,r)),Go(n,e.shape)}function dh(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Qd(e);if("elu"===t)return jl(e);if("relu6"===t)return ec(e);if("prelu"===t)return wd(e,n);if("leakyrelu"===t)return Su(e,r);if("sigmoid"===t)return Yo(e);throw new Error(`Unknown fused activation ${t}.`)}var ch=(e,t)=>!(e>0)||"linear"===t,hh=Vi({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:o,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",!1===ch(Ei.state.gradientDepth,l)){J("NHWC"===a,(()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let c=bl(e,t,n,r,a,i,s);return null!=o&&(c=mo(c,o)),dh(c,l,u,d)}let c=Bi(e,"x","conv2d","float32"),h=Bi(t,"filter","conv2d","float32"),p=c,m=!1;3===c.rank&&(m=!0,p=Go(c,[1,c.shape[0],c.shape[1],c.shape[2]])),J(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),J(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),Ho("fused conv2d",r,s);let f="NHWC"===a?p.shape[3]:p.shape[1];J(h.shape[2]===f,(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${h.shape[2]}.`)),J(Wo(n,i),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`));let g,y,b=Mo(p.shape,h.shape,n,i,r,s);if(null!=o&&(g=Bi(o,"bias","fused conv2d"),[g]=Ai(g,c),"NHWC"===a?Fl(b.outShape,g.shape):(J(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),J(0===g.shape.length||g.shape[0]===b.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${b.outChannels})`)))),null!=u){let e=u.shape;if(J(e.length<=1||3===e.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${e.length}.`)),1===e.length)J(1===e[0]||e[0]===b.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the number of output channels (${b.outChannels}).`));else if(3===e.length)try{Fl(e,b.outShape)}catch(t){let n=`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(n)}y=Bi(u,"prelu weights","fused conv2d")}let x=(e,t)=>{J("NHWC"===a,(()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`));let[s,o,u,d]=t,c=lh(e,u,l);J(Uo(i),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`));let h=[Al(o.shape,c,s,n,r),oh(o,c,s.shape,n,r)];if(null!=d){let e=uh(d,c);h.push(e)}return h},A={x:p,filter:h,bias:g,preluActivationWeights:y},v={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:d};return null==o?$u(((e,t,n)=>{let r=Ei.runKernel(ua,A,v);return n([t,e,r]),m&&(r=Go(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}))(p,h):$u(((e,t,n,r)=>{let a=Ei.runKernel(ua,A,v);return r([t,e,a,n]),m&&(a=Go(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:x}}))(p,h,g)}}),ph=Vi({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a,i=[1,1],s){let o=e;3===e.rank&&(o=Go(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=Go(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u={x:o,dy:l},d={strides:r,pad:a,dimRoundingMode:s,dilations:i,filterShape:n};return Ei.runKernel($t,u,d)}}),mh=Vi({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a,i=[1,1],s){let o=t,l=!1;3===t.rank&&(l=!0,o=Go(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u={dy:o,filter:n},d={strides:r,pad:a,dimRoundingMode:s,dilations:i,inputShape:e},c=Ei.runKernel(Ft,u,d);return l?Go(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),fh=Vi({fusedDepthwiseConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:o,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(!1===ch(Ei.state.gradientDepth,l)){let c=Rl(e,t,n,r,a,i,s);return null!=o&&(c=mo(c,o)),dh(c,l,u,d)}let c=Bi(e,"x","depthwiseConv2d","float32"),h=Bi(t,"filter","depthwiseConv2d","float32"),p=c,m=!1;3===c.rank&&(m=!0,p=Go(c,[1,c.shape[0],c.shape[1],c.shape[2]])),J(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),J(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),J(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==i&&(i=[1,1]),J(Wo(n,i),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`)),Ho("fused depthwiseConv2d",r,s);let f,g,y=Mo(p.shape,h.shape,n,i,r,s,!0);null!=o&&(f=Bi(o,"bias","fused conv2d"),[f]=Ai(f,c),Fl(y.outShape,f.shape)),null!=u&&(g=Bi(u,"prelu weights","fused depthwiseConv2d"));let b=(e,t)=>{J(Uo(i),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`));let[a,o,u,d]=t,c=lh(e,u,l),h=mh(o.shape,c,a,n,r,i,s),p=ph(o,c,a.shape,n,r,i,s);return null!=d?[h,p,uh(f,c)]:[h,p]},x={x:p,filter:h,bias:f,preluActivationWeights:g},A={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:d};return null==o?$u(((e,t,n)=>{let r=Ei.runKernel(da,x,A);return n([t,e,r]),m&&(r=Go(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}))(p,h):$u(((e,t,n,r)=>{let a=Ei.runKernel(da,x,A);return r([t,e,a,n]),m&&(a=Go(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:b}}))(p,h,f)}}),gh=Vi({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:o=.2}){if(!1===ch(Ei.state.gradientDepth,i)){let l=Zo(e,t,n,r);return null!=a&&(l=mo(l,a)),dh(l,i,s,o)}let l=Bi(e,"a","fused matMul"),u=Bi(t,"b","fused matMul");[l,u]=Ai(l,u);let d=n?l.shape[l.rank-2]:l.shape[l.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=r?u.shape[u.rank-2]:u.shape[u.rank-1],m=l.shape.slice(0,-2),f=u.shape.slice(0,-2),g=te(m),y=te(f);J(d===c,(()=>`Error in fused matMul: inner shapes (${d}) and (${c}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${r} must match.`));let b,x,A=Fl(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([h,p]),v=Go(l,n?[g,d,h]:[g,h,d]),w=Go(u,r?[y,p,c]:[y,c,p]);null!=a&&(b=Bi(a,"bias","fused matMul"),[b]=Ai(b,l),Fl(A,b.shape)),null!=s&&(x=Bi(s,"prelu weights","fused matMul"));let k=(e,t)=>{let s,o,[l,u,d,c]=t,h=lh(Go(e,d.shape),d,i);return n||r?!n&&r?(s=Zo(h,u,!1,!1),o=Zo(h,l,!0,!1)):n&&!r?(s=Zo(u,h,!1,!0),o=Zo(l,h,!1,!1)):(s=Zo(u,h,!0,!0),o=Zo(h,l,!0,!0)):(s=Zo(h,u,!1,!0),o=Zo(l,h,!0,!1)),null!=a?[s,o,uh(c,h)]:[s,o]},S={a:v,b:w,bias:b,preluActivationWeights:x},T={transposeA:n,transposeB:r,activation:i,leakyreluAlpha:o};return null==a?$u(((e,t,n)=>{let r=Ei.runKernel(la,S,T);return n([e,t,r]),{value:Go(r,A),gradFunc:k}}))(v,w):$u(((e,t,n,r)=>{let a=Ei.runKernel(la,S,T);return r([e,t,a,n]),{value:Go(a,A),gradFunc:k}}))(v,w,b)}}),yh=Vi({hammingWindow_:function(e){return ah(e,.54,.46)}}),bh=Vi({hannWindow_:function(e){return ah(e,.5,.5)}}),xh=Vi({frame_:function(e,t,n,r=!1,a=0){let i=0,s=[];for(;i+t<=e.size;)s.push(Jo(e,i,t)),i+=n;if(r)for(;i<e.size;){let r=i+t-e.size,o=Ko([Jo(e,i,t-r),hl([r],a)]);s.push(o),i+=n}return 0===s.length?Rc([],[0,t]):Go(Ko(s),[s.length,t])}}),Ah=Vi({stft_:function(e,t,n,r,a=bh){null==r&&(r=rh(t));let i=xh(e,t,n),s=yo(i,a(t));return kc(s,r)}}),vh=Vi({cropAndResize_:function(e,t,n,r,a="bilinear",i=0){let s=Bi(e,"image","cropAndResize"),o=Bi(t,"boxes","cropAndResize","float32"),l=Bi(n,"boxInd","cropAndResize","int32"),u=o.shape[0];J(4===s.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`)),J(2===o.rank&&4===o.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${o.shape}.`)),J(1===l.rank&&l.shape[0]===u,(()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${o.shape}.`)),J(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),J(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),J("bilinear"===a||"nearest"===a,(()=>`method must be bilinear or nearest, but was ${a}`));let d={image:s,boxes:o,boxInd:l},c={method:a,extrapolationValue:i,cropSize:r};return Ei.runKernel(Pt,d,c)}}),wh=Vi({flipLeftRight_:function(e){let t=Bi(e,"image","flipLeftRight","float32");J(4===t.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`));let n={image:t};return Ei.runKernel(en,n,{})}}),kh=Vi({grayscaleToRGB_:function(e){let t=Bi(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];J(t.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`)),J(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));let a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,mu(t,a)}}),Sh=Vi({rotateWithOffset_:function(e,t,n=0,r=.5){let a=Bi(e,"image","rotateWithOffset","float32");J(4===a.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`));let i={image:a},s={radians:t,fillValue:n,center:r};return Ei.runKernel(oa,i,s)}});function Th(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);let s=e.shape[0];return n=Math.min(n,s),J(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),J(2===e.rank,(()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`)),J(4===e.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`)),J(1===t.rank,(()=>"scores must be a 1D tensor")),J(t.shape[0]===s,(()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${t.shape[0]}`)),J(0<=i&&i<=1,(()=>`softNmsSigma must be in [0, 1], but was '${i}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var _h=Vi({nonMaxSuppression_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let i=Bi(e,"boxes","nonMaxSuppression","float32"),s=Bi(t,"scores","nonMaxSuppression","float32"),o=Th(i,s,n,r,a),l={maxOutputSize:n=o.maxOutputSize,iouThreshold:r=o.iouThreshold,scoreThreshold:a=o.scoreThreshold};return Ei.runKernel(Gn,{boxes:i,scores:s},l)}});function Ih(e,t,n){let r=function(e,t,n){return function(e,t,n){let r=0,a=e.length,i=0,s=!1;for(;r<a;){i=r+(a-r>>>1);let o=n(t,e[i]);o>0?r=i+1:(a=i,s=!o)}return s?r:-r-1}(e,t,n||Ch)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Ch(e,t){return e>t?1:e<t?-1:0}function Eh(e,t,n,r,a){return Ph(e,t,n,r,a,0)}function Nh(e,t,n,r,a,i){return Ph(e,t,n,r,a,0,!1,i,!0)}function Rh(e,t,n,r,a,i){return Ph(e,t,n,r,a,i,!0)}function Ph(e,t,n,r,a,i,s=!1,o=!1,l=!1){let u=[];for(let e=0;e<t.length;e++)t[e]>a&&u.push({score:t[e],boxIndex:e,suppressBeginIndex:0});u.sort(Oh);let d=i>0?-.5/i:0,c=[],h=[];for(;c.length<n&&u.length>0;){let t=u.pop(),{score:n,boxIndex:i,suppressBeginIndex:s}=t;if(n<a)break;let o=!1;for(let n=c.length-1;n>=s;--n){let s=Dh(e,i,c[n]);if(s>=r){o=!0;break}if(t.score=t.score*Mh(r,d,s),t.score<=a)break}t.suppressBeginIndex=c.length,o||(t.score===n?(c.push(i),h.push(t.score)):t.score>a&&Ih(u,t,Oh))}let p=c.length,m=n-p;o&&m>0&&(c.push(...new Array(m).fill(0)),h.push(...new Array(m).fill(0)));let f={selectedIndices:c};return s&&(f.selectedScores=h),l&&(f.validOutputs=p),f}function Dh(e,t,n){let r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),d=Math.min(a[1],a[3]),c=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(o-i)*(l-s),m=(c-u)*(h-d);if(p<=0||m<=0)return 0;let f=Math.max(i,u),g=Math.max(s,d),y=Math.min(o,c),b=Math.min(l,h),x=Math.max(y-f,0)*Math.max(b-g,0);return x/(p+m-x)}function Mh(e,t,n){let r=Math.exp(t*n*n);return n<=e?r:0}function Oh(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}var $h=Vi({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=0){let s=Bi(e,"boxes","nonMaxSuppression"),o=Bi(t,"scores","nonMaxSuppression"),l=Th(s,o,n,r,a,i),u={boxes:s,scores:o},d={maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:a=l.scoreThreshold,softNmsSigma:i=l.softNmsSigma},c=Ei.runKernel(Xn,u,d);return{selectedIndices:c[0],selectedScores:c[1]}}}),Fh=Vi({nonMaxSuppressionPadded_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=!1){let s=Bi(e,"boxes","nonMaxSuppression"),o=Bi(t,"scores","nonMaxSuppression"),l=Th(s,o,n,r,a,null),u={boxes:s,scores:o},d={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:i},c=Ei.runKernel(qn,u,d);return{selectedIndices:c[0],validOutputs:c[1]}}}),Lh=Vi({resizeBilinear_:function(e,t,n=!1,r=!1){let a=Bi(e,"images","resizeBilinear");J(3===a.rank||4===a.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`)),J(2===t.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`)),J(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let i=a,s=!1;3===a.rank&&(s=!0,i=Go(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=t,o={images:i},l={alignCorners:n,halfPixelCenters:r,size:t},u=Ei.runKernel(pr,o,l);return s?Go(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),zh=Vi({resizeNearestNeighbor_:function(e,t,n=!1,r=!1){let a=Bi(e,"images","resizeNearestNeighbor");J(3===a.rank||4===a.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`)),J(2===t.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`)),J("float32"===a.dtype||"int32"===a.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),J(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let i=a,s=!1;3===a.rank&&(s=!0,i=Go(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=t,o={images:i},l={alignCorners:n,halfPixelCenters:r,size:t},u=Ei.runKernel(cr,o,l);return s?Go(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Bh=Vi({threshold_:function(e,t="binary",n=!1,r=.5){let a,i,s,o,l=Bi(e,"image","threshold"),u=l.shape[0]*l.shape[1],d=yo(Nc([r]),255);if(J(3===l.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${l.rank}.`)),J(3===l.shape[2]||1===l.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${l.shape[2]}.`)),J("int32"===l.dtype||"float32"===l.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${l.dtype}.`)),J("otsu"===t||"binary"===t,(()=>`Method must be binary or otsu, but was ${t}`)),3===l.shape[2]){[a,i,s]=wc(l,[1,1,1],-1);let e=yo(a,.2989),t=yo(i,.587),n=yo(s,.114);o=mo(mo(e,t),n)}else o=e;"otsu"===t&&(d=function(e,t){let n,r,a,i,s,o,l=Nc([-1]),u=Nc([0]),d=Nc([0]);for(let c=0;c<e.size-1;c++){n=Jo(e,0,c+1),r=Jo(e,c+1),s=go(ou(n),t),o=go(ou(r),t);let h=ou(yo(n,Zd(0,n.size)));a=go(h,ou(n));let p=hl(r.shape,n.size),m=mo(Zd(0,r.size),p),f=yo(r,m);i=go(ou(f),ou(r));let g=Uu(a,i),y=Uu(a,i),b=yo(s,o);d=yo(yo(b,g),y);let x=bu(d,u);u=zl(x,d,u),l=zl(x,Nc([c]),l)}return l}(ol(Vs(sc(o),"int32"),Gi([]),256),u));let c=n?_u(o,d):bu(o,d);return Vs(yo(c,255),"int32")}}),Uh=Vi({transform_:function(e,t,n="nearest",r="constant",a=0,i){let s=Bi(e,"image","transform","float32"),o=Bi(t,"transforms","transform","float32");J(4===s.rank,(()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`)),J(2===o.rank&&(o.shape[0]===s.shape[0]||1===o.shape[0])&&8===o.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),J(null==i||2===i.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`));let l={image:s,transforms:o},u={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Ei.runKernel(Jr,l,u)}}),Wh=Vi({bandPart_:function(e,t,n){let r=Bi(e,"a","bandPart");J(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));let a,i,s=r.shape,[o,l]=r.shape.slice(-2);"number"==typeof t?(J(t%1==0,(()=>`bandPart(): numLower must be an integer, got ${t}.`)),J(t<=o,(()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${o}).`)),a=Bi(t<0?o:t,"numLower","bandPart")):(J("int32"===t.dtype,(()=>"bandPart(): numLower's dtype must be an int32.")),a=zl(Tu(t,0),o,id(t,o))),"number"==typeof n?(J(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`)),J(n<=l,(()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${l}).`)),i=Bi(n<0?l:n,"numUpper","bandPart")):(J("int32"===n.dtype,(()=>"bandPart(): numUpper's dtype must be an int32.")),i=zl(Tu(n,0),l,id(n,l)));let u=Go(Zd(0,o,1,"int32"),[-1,1]),d=Zd(0,l,1,"int32"),c=Uu(u,d),h=ju(_u(c,a),xu(c,Lu(i))),p=nd([o,l],r.dtype);return Go(_c(Hc(Go(r,[-1,o,l])).map((e=>zl(h,e,p)))),s)}}),Vh=Vi({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,J(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));let n=e[0].shape[0];for(let t=1;t<e.length;++t)J(e[t].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`))}else t=!0,e=wc(e,e.shape[0],0).map((e=>Tc(e,[0])));J(e.length<=e[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`));let n=[],r=e;for(let t=0;t<e.length;++t)n.push(Ei.tidy((()=>{let e=r[t];if(t>0)for(let r=0;r<t;++r){let t=yo(ou(yo(n[r],e)),n[r]);e=Uu(e,t)}return go(e,uu(e,"euclidean"))})));return t?_c(n,0):n}});function jh(e,t=!1){return Ei.tidy((()=>{J(2===e.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`));let n=e.shape[0],r=e.shape[1],a=fu(n),i=js(e),s=Rc([[1]],[1,1]),o=js(s),l=n>=r?r:n;for(let e=0;e<l;++e){let t=i,l=o,u=a;[o,i,a]=Ei.tidy((()=>{let t=Jo(i,[e,e],[n-e,1]),l=uu(t),u=Jo(i,[e,e],[1,1]),d=zl(bu(u,0),Rc([[-1]]),Rc([[1]])),c=Uu(u,yo(d,l)),h=go(t,c);o=1===h.shape[0]?js(s):Ko([s,Jo(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);let p=Lu(go(Zo(d,c),l)),m=Jo(i,[e,0],[n-e,r]),f=yo(p,o),g=Yc(o);if(0===e)i=Uu(m,Zo(f,Zo(g,m)));else{let t=Uu(m,Zo(f,Zo(g,m)));i=Ko([Jo(i,[0,0],[e,r]),t],0)}let y=Yc(f),b=Jo(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Uu(b,Zo(Zo(b,o),y));else{let t=Uu(b,Zo(Zo(b,o),y));a=Ko([Jo(a,[0,0],[n,e]),t],1)}return[o,i,a]})),to([t,l,u])}return!t&&n>r&&(a=Jo(a,[0,0],[n,r]),i=Jo(i,[0,0],[r,r])),[a,i]}))}var Hh,Gh=Vi({qr_:function(e,t=!1){if(J(e.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`)),2===e.rank)return jh(e,t);{let n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=Hc(Go(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((e=>{let[n,r]=jh(e,t);a.push(n),i.push(r)})),[Go(_c(a,0),e.shape),Go(_c(i,0),e.shape)]}}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Hh||(Hh={}));var qh=Vi({computeWeightedLoss_:function(e,t,n=Hh.SUM_BY_NONZERO_WEIGHTS){let r=Bi(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Bi(t,"weights","computeWeightedLoss"));let i=null==a?r:yo(r,a);if(n===Hh.NONE)return i;if(n===Hh.SUM)return ou(i);if(n===Hh.MEAN){if(null==a)return td(i);{let e=r.size/a.size,t=go(ou(i),ou(a));return e>1?go(t,au(e)):t}}if(n===Hh.SUM_BY_NONZERO_WEIGHTS){if(null==a)return go(ou(i),au(r.size));{let e=yo(a,rd(r.shape)),t=Vs(ou(cd(e,au(0))),"float32");return go(ou(i),t)}}throw Error(`Unknown reduction: ${n}`)}}),Xh=Vi({absoluteDifference_:function(e,t,n,r=Hh.SUM_BY_NONZERO_WEIGHTS){let a=Bi(e,"labels","absoluteDifference"),i=Bi(t,"predictions","absoluteDifference"),s=null;null!=n&&(s=Bi(n,"weights","absoluteDifference")),Q(a.shape,i.shape,"Error in absoluteDifference: ");let o=bo(Uu(a,i));return qh(o,s,r)}}),Kh=Vi({cosineDistance_:function(e,t,n,r,a=Hh.SUM_BY_NONZERO_WEIGHTS){let i=Bi(e,"labels","cosineDistance"),s=Bi(t,"predictions","cosineDistance"),o=null;null!=r&&(o=Bi(r,"weights","cosineDistance")),Q(i.shape,s.shape,"Error in cosineDistance: ");let l=au(1),u=Uu(l,ou(yo(i,s),n,!0));return qh(u,o,a)}}),Zh=Vi({hingeLoss_:function(e,t,n,r=Hh.SUM_BY_NONZERO_WEIGHTS){let a=Bi(e,"labels","hingeLoss"),i=Bi(t,"predictions","hingeLoss"),s=null;null!=n&&(s=Bi(n,"weights","hingeLoss")),Q(a.shape,i.shape,"Error in hingeLoss: ");let o=au(1);a=Uu(yo(au(2),a),o);let l=Qd(Uu(o,yo(a,i)));return qh(l,s,r)}}),Yh=Vi({huberLoss_:function(e,t,n,r=1,a=Hh.SUM_BY_NONZERO_WEIGHTS){let i=Bi(e,"labels","huberLoss"),s=Bi(t,"predictions","huberLoss"),o=null;null!=n&&(o=Bi(n,"weights","huberLoss")),Q(i.shape,s.shape,"Error in huberLoss: ");let l=au(r),u=bo(Uu(s,i)),d=id(u,l),c=Uu(u,d),h=mo(yo(au(.5),su(d)),yo(l,c));return qh(h,o,a)}}),Jh=Vi({logLoss_:function(e,t,n,r=1e-7,a=Hh.SUM_BY_NONZERO_WEIGHTS){let i=Bi(e,"labels","logLoss"),s=Bi(t,"predictions","logLoss"),o=null;null!=n&&(o=Bi(n,"weights","logLoss")),Q(i.shape,s.shape,"Error in logLoss: ");let l=au(1),u=au(r),d=Lu(yo(i,Eu(mo(s,u)))),c=yo(Uu(l,i),Eu(mo(Uu(l,s),u))),h=Uu(d,c);return qh(h,o,a)}}),Qh=Vi({meanSquaredError_:function(e,t,n,r=Hh.SUM_BY_NONZERO_WEIGHTS){let a=Bi(e,"labels","meanSquaredError"),i=Bi(t,"predictions","meanSquaredError"),s=null;null!=n&&(s=Bi(n,"weights","meanSquaredError")),Q(a.shape,i.shape,"Error in meanSquaredError: ");let o=Sc(a,i);return qh(o,s,r)}}),ep=Vi({sigmoidCrossEntropy_:function(e,t,n,r=0,a=Hh.SUM_BY_NONZERO_WEIGHTS){let i=Bi(e,"multiClassLabels","sigmoidCrossEntropy"),s=Bi(t,"logits","sigmoidCrossEntropy"),o=null;if(null!=n&&(o=Bi(n,"weights","sigmoidCrossEntropy")),Q(i.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){let e=au(r),t=au(1),n=au(.5);i=mo(yo(i,Uu(t,e)),yo(n,e))}let l=function(e,t){let n=Bi(e,"labels","sigmoidCrossEntropyWithLogits"),r=Bi(t,"logits","sigmoidCrossEntropyWithLogits");Q(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");let a=Qd(r),i=yo(r,n),s=Nu(cu(Lu(bo(r))));return mo(Uu(a,i),s)}(i,s);return qh(l,o,a)}}),tp=Vi({softmaxCrossEntropy_:function(e,t,n,r=0,a=Hh.SUM_BY_NONZERO_WEIGHTS){let i=Bi(e,"onehotLabels","softmaxCrossEntropy"),s=Bi(t,"logits","softmaxCrossEntropy"),o=null;if(null!=n&&(o=Bi(n,"weights","softmaxCrossEntropy")),Q(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){let e=au(r),t=au(1),n=au(i.shape[1]);i=mo(yo(i,Uu(t,e)),go(e,n))}let l=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return $u(((e,t,r)=>{let a=Vu(t,[n],!0),i=Uu(Vs(t,"float32"),a);r([e,i]);let s=Lu(yo(i,e));return{value:ou(s,[n]),gradFunc:(e,t)=>{let[r,a]=t,i=Zl(e.shape,[n]);return[yo(Go(e,i),Uu(Vs(r,"float32"),cu(a))),yo(Go(e,i),Uu(cu(a),Vs(r,"float32")))]}}}))(e,t)}(i,s);return qh(l,o,a)}}),np=Vi({sparseFillEmptyRows_:function(e,t,n,r){let a=Bi(e,"indices","sparseFillEmptyRows","int32"),i=Bi(t,"values","sparseFillEmptyRows"),s=Bi(n,"denseShape","sparseFillEmptyRows","int32"),o=Bi(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${a.shape}`);if(1!==i.rank)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(1!==s.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${s.shape}`);if(0!==o.rank)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);let l={indices:a,values:i,denseShape:s,defaultValue:o},u=Ei.runKernel(Or,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}}),rp=Vi({sparseReshape_:function(e,t,n){let r=Bi(e,"inputIndices","sparseReshape","int32"),a=Bi(t,"inputShape","sparseReshape","int32"),i=Bi(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==a.rank)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(1!==i.rank)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);let s={inputIndices:r,inputShape:a,newShape:i},o=Ei.runKernel($r,s);return{outputIndices:o[0],outputShape:o[1]}}}),ap=Vi({sparseSegmentMean_:function(e,t,n){let r=Bi(e,"data","sparseSegmentMean"),a=Bi(t,"indices","sparseSegmentMean","int32"),i=Bi(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${a.shape}`);if(1!==i.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${i.shape}`);let s={data:r,indices:a,segmentIds:i};return Ei.runKernel(Fr,s)}}),ip=Vi({sparseSegmentSum_:function(e,t,n){let r=Bi(e,"data","sparseSegmentSum"),a=Bi(t,"indices","sparseSegmentSum","int32"),i=Bi(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${a.shape}`);if(1!==i.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${i.shape}`);let s={data:r,indices:a,segmentIds:i};return Ei.runKernel(Lr,s)}}),sp=Vi({stringNGrams_:function(e,t,n,r,a,i,s,o){let l=Bi(e,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);let u=Bi(t,"dataSplits","stringNGrams");if("int32"!==u.dtype)throw new Error("Data splits must be of datatype int32");let d={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:s,preserveShortSequences:o},c={data:l,dataSplits:u},h=Ei.runKernel(jr,c,d);return{nGrams:h[0],nGramsSplits:h[1]}}}),op=Vi({stringSplit_:function(e,t,n=!0){let r=Bi(e,"input","stringSplit","string"),a=Bi(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==a.rank)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let i={skipEmpty:n},s={input:r,delimiter:a},o=Ei.runKernel(Hr,s,i);return{indices:o[0],values:o[1],shape:o[2]}}}),lp=Vi({stringToHashBucketFast_:function(e,t){let n=Bi(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let a={input:n};return Ei.runKernel(Gr,a,r)}}),up=Vi({staticRegexReplace_:function(e,t,n,r=!0){let a=Bi(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:r};return Ei.runKernel(Wr,{x:a},i)}}),dp={fft:xc,ifft:Ac,rfft:kc,irfft:vc},cp={hammingWindow:yh,hannWindow:bh,frame:xh,stft:Ah},hp={flipLeftRight:wh,grayscaleToRGB:kh,resizeNearestNeighbor:zh,resizeBilinear:Lh,rotateWithOffset:Sh,cropAndResize:vh,nonMaxSuppression:_h,nonMaxSuppressionAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let i=Bi(e,"boxes","nonMaxSuppressionAsync"),s=Bi(t,"scores","nonMaxSuppressionAsync"),o=Th(i,s,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;let l=await Promise.all([i.data(),s.data()]),u=l[0],d=l[1],{selectedIndices:c}=Eh(u,d,n,r,a);return i!==e&&i.dispose(),s!==t&&s.dispose(),Nc(c,"int32")},nonMaxSuppressionWithScore:$h,nonMaxSuppressionWithScoreAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=0){let s=Bi(e,"boxes","nonMaxSuppressionAsync"),o=Bi(t,"scores","nonMaxSuppressionAsync"),l=Th(s,o,n,r,a,i);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,i=l.softNmsSigma;let u=await Promise.all([s.data(),o.data()]),d=u[0],c=u[1],{selectedIndices:h,selectedScores:p}=Rh(d,c,n,r,a,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:Nc(h,"int32"),selectedScores:Nc(p)}},nonMaxSuppressionPadded:Fh,nonMaxSuppressionPaddedAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=!1){let s=Bi(e,"boxes","nonMaxSuppressionAsync"),o=Bi(t,"scores","nonMaxSuppressionAsync"),l=Th(s,o,n,r,a,null),u=l.maxOutputSize,d=l.iouThreshold,c=l.scoreThreshold,[h,p]=await Promise.all([s.data(),o.data()]),{selectedIndices:m,validOutputs:f}=Nh(h,p,u,d,c,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:Nc(m,"int32"),validOutputs:au(f,"int32")}},threshold:Bh,transform:Uh},pp={bandPart:Wh,gramSchmidt:Vh,qr:Gh},mp={absoluteDifference:Xh,computeWeightedLoss:qh,cosineDistance:Kh,hingeLoss:Zh,huberLoss:Yh,logLoss:Jh,meanSquaredError:Qh,sigmoidCrossEntropy:ep,softmaxCrossEntropy:tp},fp={sparseFillEmptyRows:np,sparseReshape:rp,sparseSegmentMean:ap,sparseSegmentSum:ip},gp={stringNGrams:sp,stringSplit:op,stringToHashBucketFast:lp,staticRegexReplace:up},yp={};x(yp,{Serializable:()=>bp,SerializationMap:()=>xp,registerClass:()=>Ap});var bp=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},xp=class{constructor(){this.classNameMap={}}static getMap(){return null==xp.instance&&(xp.instance=new xp),xp.instance}static register(e){xp.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function Ap(e){J(null!=e.className,(()=>"Class being registered does not have the static className property defined.")),J("string"==typeof e.className,(()=>"className is required to be a string, but got type "+typeof e.className)),J(e.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),xp.register(e)}var vp=class extends bp{minimize(e,t=!1,n){let{value:r,grads:a}=this.computeGradients(e,n);if(null!=n){let e=n.map((e=>({name:e.name,tensor:a[e.name]})));this.applyGradients(e)}else this.applyGradients(a);return to(a),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Ou(e,t)}dispose(){null!=this.iterations_&&to(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:au(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(vp,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});var wp=class extends vp{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Ei.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{let r=Ei.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:eo((()=>Bl(r).variable(!1)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:eo((()=>Bl(r).variable(!1)))});let a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;let i=this.accumulatedGrads[n].variable,s=this.accumulatedUpdates[n].variable;eo((()=>{let e=mo(yo(i,this.rho),yo(su(a),1-this.rho)),t=yo(go(iu(mo(s,this.epsilon)),iu(mo(i,this.epsilon))),a),n=mo(yo(s,this.rho),yo(su(t),1-this.rho));i.assign(e),s.assign(n);let o=mo(yo(t,-this.learningRate),r);r.assign(o)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(to(this.accumulatedGrads.map((e=>e.variable))),to(this.accumulatedUpdates.map((e=>e.variable))))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){let t=(e=await this.extractIterations(e)).length/2;this.accumulatedGrads=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)}))),this.accumulatedUpdates=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}},kp=class extends vp{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{let r=Ei.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:eo((()=>hl(r.shape,this.initialAccumulatorValue).variable(!1)))});let a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;let i=this.accumulatedGrads[n].variable;eo((()=>{let e=mo(i,su(a));i.assign(e);let t=mo(yo(go(a,iu(mo(e,Ei.backend.epsilon()))),-this.learningRate),r);r.assign(t)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&to(this.accumulatedGrads.map((e=>e.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),this.accumulatedGrads=e.map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}},Sp=class extends vp{static get className(){return"Adam"}constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],eo((()=>{this.accBeta1=au(t).variable(),this.accBeta2=au(n).variable()})),null==r&&(this.epsilon=Ei.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);eo((()=>{let n=Uu(1,this.accBeta1),r=Uu(1,this.accBeta2);t.forEach(((t,a)=>{let i=Ei.registeredVariables[t];null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:`${t}/m`,variable:eo((()=>Bl(i).variable(!1)))}),null==this.accumulatedSecondMoment[a]&&(this.accumulatedSecondMoment[a]={originalName:`${t}/v`,variable:eo((()=>Bl(i).variable(!1)))});let s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;let o=this.accumulatedFirstMoment[a].variable,l=this.accumulatedSecondMoment[a].variable,u=mo(yo(o,this.beta1),yo(s,1-this.beta1)),d=mo(yo(l,this.beta2),yo(su(s),1-this.beta2)),c=go(u,n),h=go(d,r);o.assign(u),l.assign(d);let p=mo(yo(go(c,mo(iu(h),this.epsilon)),-this.learningRate),i);i.assign(p)})),this.accBeta1.assign(yo(this.accBeta1,this.beta1)),this.accBeta2.assign(yo(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&to(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedSecondMoment&&to(this.accumulatedSecondMoment.map((e=>e.variable)))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),eo((()=>{this.accBeta1.assign(ru(this.beta1,this.iterations_+1)),this.accBeta2.assign(ru(this.beta2,this.iterations_+1))}));let t=e.length/2;this.accumulatedFirstMoment=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)}))),this.accumulatedSecondMoment=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}},Tp=class extends vp{static get className(){return"Adamax"}constructor(e,t,n,r=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],eo((()=>{this.iteration=au(0).variable(),this.accBeta1=au(t).variable()})),null==r&&(this.epsilon=Ei.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);eo((()=>{let n=Uu(1,this.accBeta1),r=go(-this.learningRate,mo(yo(this.iteration,this.decay),1));t.forEach(((t,a)=>{let i=Ei.registeredVariables[t];null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:`${t}/m`,variable:Bl(i).variable(!1)}),null==this.accumulatedWeightedInfNorm[a]&&(this.accumulatedWeightedInfNorm[a]={originalName:`${t}/v`,variable:Bl(i).variable(!1)});let s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;let o=this.accumulatedFirstMoment[a].variable,l=this.accumulatedWeightedInfNorm[a].variable,u=mo(yo(o,this.beta1),yo(s,1-this.beta1)),d=yo(l,this.beta2),c=bo(s),h=ed(d,c);o.assign(u),l.assign(h);let p=mo(yo(go(r,n),go(u,mo(h,this.epsilon))),i);i.assign(p)})),this.iteration.assign(mo(this.iteration,1)),this.accBeta1.assign(yo(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&to(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedWeightedInfNorm&&to(this.accumulatedWeightedInfNorm.map((e=>e.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}},_p=class extends vp{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{let r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;let a=Ei.registeredVariables[t];eo((()=>{let e=mo(yo(this.c,r),a);a.assign(e)}))})),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=no(au(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}},Ip=class extends _p{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=au(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{let r=Ei.registeredVariables[t];null==this.accumulations[n]&&(this.accumulations[n]={originalName:`${t}/momentum`,variable:eo((()=>Bl(r).variable(!1)))});let a=this.accumulations[n].variable,i=Array.isArray(e)?e[n].tensor:e[t];null!=i&&eo((()=>{let e,t=mo(yo(this.m,a),i);e=this.useNesterov?mo(yo(this.c,mo(i,yo(t,this.m))),r):mo(yo(this.c,t),r),a.assign(t),r.assign(e)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&to(this.accumulations.map((e=>e.variable)))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),this.accumulations=e.map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}},Cp=class extends vp{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,r=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,null==r&&(this.epsilon=Ei.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{let r=Ei.registeredVariables[t],a=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:eo((()=>Bl(r).variable(a)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:eo((()=>Bl(r).variable(a)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:eo((()=>Bl(r).variable(a)))});let i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;let s=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;eo((()=>{let e=mo(yo(s,this.decay),yo(su(i),1-this.decay));if(this.centered){let t=this.accumulatedMeanGrads[n].variable,a=mo(yo(t,this.decay),yo(i,1-this.decay)),l=go(yo(i,this.learningRate),iu(Uu(e,mo(su(a),this.epsilon)))),u=mo(yo(o,this.momentum),l);s.assign(e),t.assign(a),o.assign(u);let d=Uu(r,u);r.assign(d)}else{let e=mo(yo(s,this.decay),yo(su(i),1-this.decay)),t=mo(yo(o,this.momentum),go(yo(i,this.learningRate),iu(mo(e,this.epsilon))));s.assign(e),o.assign(t);let n=Uu(r,t);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&to(this.accumulatedMeanSquares.map((e=>e.variable))),null!=this.accumulatedMeanGrads&&this.centered&&to(this.accumulatedMeanGrads.map((e=>e.variable))),null!=this.accumulatedMoments&&to(this.accumulatedMoments.map((e=>e.variable)))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedMoments=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}},Ep=[wp,kp,Sp,Tp,Ip,Cp,_p],Np={};function Rp(e){return new Promise((e=>setTimeout(e))).then(e)}x(Np,{CompositeArrayBuffer:()=>Xi,browserFiles:()=>Mp,browserHTTPRequest:()=>Vp,concatenateArrayBuffers:()=>ts,copyModel:()=>zs,decodeWeights:()=>Yi,encodeWeights:()=>Zi,fromMemory:()=>qp,fromMemorySync:()=>Xp,getLoadHandlers:()=>ps,getModelArtifactsForJSON:()=>is,getModelArtifactsForJSONSync:()=>as,getModelArtifactsInfoForJSON:()=>ss,getSaveHandlers:()=>hs,getWeightSpecs:()=>os,http:()=>Wp,isHTTPScheme:()=>Bp,listModels:()=>Fs,loadWeights:()=>Fp,moveModel:()=>Bs,registerLoadRouter:()=>cs,registerSaveRouter:()=>ds,removeModel:()=>Ls,weightsLoaderFactory:()=>Lp,withSaveHandler:()=>Kp,withSaveHandlerSync:()=>Zp});var Pp=class{constructor(e){if(!Ue().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Pp.URL_SCHEME)&&(e=e.slice(Pp.URL_SCHEME.length)),(null==e||0===e.length)&&(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=Xi.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let t=rs(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),a=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=r,await Rp((()=>a.dispatchEvent(new MouseEvent("click")))),null!=e.weightData){let e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await Rp((()=>e.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:ss(e)}}}};Pp.URL_SCHEME="downloads://";var Dp=class{constructor(e){if(null==e||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise(((e,t)=>{let n=new FileReader;n.onload=n=>{let r=JSON.parse(n.target.result),a=r.modelTopology;if(null==a)return void t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void e({modelTopology:a});let i=is(r,(e=>this.loadWeights(e)));e(i)},n.onerror=e=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(e){let t=[],n=[];for(let r of e)t.push(...r.weights),n.push(...r.paths);let r=this.checkManifestAndWeightFiles(e),a=n.map((e=>this.loadWeightsFile(e,r[e])));return Promise.all(a).then((e=>[t,e]))}loadWeightsFile(e,t){return new Promise(((n,r)=>{let a=new FileReader;a.onload=e=>{let t=e.target.result;n(t)},a.onerror=t=>r(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)}))}checkManifestAndWeightFiles(e){let t=[],n=this.weightsFiles.map((e=>ns(e.name))),r={};for(let a of e)a.paths.forEach((e=>{let a=ns(e);if(-1!==t.indexOf(a))throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(t.push(a),-1===n.indexOf(a))throw new Error(`Weight file with basename '${a}' is not provided.`);r[e]=this.weightsFiles[n.indexOf(a)]}));if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}};function Mp(e){return new Dp(e)}function Op(e,t,n,r){var a;J(null!=(a=e)&&Array.isArray(a)&&a.length>0,(()=>"promises must be a none empty array")),function(e,t){J(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${e}`)),J(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${t}`)),J(t>=e,(()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction ${t}`))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(e.map((a=>(a.then((a=>{let s=n+ ++i/e.length*(r-n);return t(s),a})),a))))}async function $p(e,t){null==t&&(t={});let n=null==t.fetchFunc?Ue().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),a=(null==t.onProgress?await Promise.all(r):await Op(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(a):await Op(a,t.onProgress,.5,1)}async function Fp(e,t="",n,r){return Lp((e=>$p(e,{requestInit:r})))(e,t,n)}function Lp(e){return async(t,n="",r)=>{let a=t.map((()=>!1)),i={},s=null!=r?r.map((()=>!1)):[],o=[];if(t.forEach(((e,t)=>{let n=0;e.weights.forEach((e=>{let l="quantization"in e?e.quantization.dtype:e.dtype,u=qi[l]*te(e.shape),d=()=>{a[t]=!0,null==i[t]&&(i[t]=[]),i[t].push({manifestEntry:e,groupOffset:n,sizeBytes:u})};null!=r?r.forEach(((t,n)=>{t===e.name&&(d(),s[n]=!0)})):d(),o.push(e.name),n+=u}))})),!s.every((e=>e))){let e=r.filter(((e,t)=>!s[t]));throw new Error(`Could not find weights in manifest with names: ${e.join(", ")}. \nManifest JSON has weights with names: ${o.join(", ")}.`)}let l=a.reduce(((e,t,n)=>(t&&e.push(n),e)),[]),u=[];l.forEach((e=>{t[e].paths.forEach((e=>{let t=n+(n.endsWith("/")?"":"/")+e;u.push(t)}))}));let d=await e(u),c={},h=0;return l.forEach((e=>{let n=t[e].paths.length,r=new Xi(d.slice(h,h+n));i[e].forEach((e=>{let t=Yi(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(let e in t)c[e]=t[e]})),h+=n})),c}}us.registerSaveRouter((e=>Ue().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Pp.URL_SCHEME)?function(e="model"){return new Pp(e)}(e.slice(Pp.URL_SCHEME.length)):null));var zp=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(J("function"==typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=Ue().platform.fetch,J(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&J(2===e.length,(()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`)),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=rs(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){let n=Xi.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}let r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:ss(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){let e,t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);try{e=await t.json()}catch(e){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}let n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return is(e,(e=>this.loadWeights(e)))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){let t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),a=this.weightPathPrefix||n,i=os(e),s=[],o=[];for(let t of e)for(let e of t.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):s.push(a+e+r);return this.weightUrlConverter&&s.push(...await Promise.all(o)),[i,await $p(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})]}};function Bp(e){return null!=e.match(zp.URL_SCHEME_REGEX)}zp.URL_SCHEME_REGEX=/^https?:\/\//;var Up=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>Bp(e))):Bp(e),n)return Wp(e,t)}return null};function Wp(e,t){return new zp(e,t)}function Vp(e,t){return Wp(e,t)}us.registerSaveRouter(Up),us.registerLoadRouter(Up);var jp=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},Hp=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},Gp=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}};function qp(e,t,n,r){return new Gp(Xp(...arguments))}function Xp(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new jp(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new jp({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new jp({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Kp(e){return new Hp(e)}function Zp(e){return new Hp(e)}var Yp={};x(Yp,{confusionMatrix:()=>Qp});var Jp,Qp=Vi({confusionMatrix_:function(e,t,n){let r=Bi(e,"labels","confusionMatrix"),a=Bi(t,"predictions","confusionMatrix");J(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),J(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),J(1===a.rank,(()=>`Expected the rank of predictions to be 1, but got ${a.rank}`)),J(r.shape[0]===a.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`)),J(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));let i=hd(Vs(r,"int32"),n),s=hd(Vs(a,"int32"),n),o=Yc(i),l=Zo(o,s);return Vs(l,"int32")}}),em={};x(em,{draw:()=>sm,fromPixels:()=>om,fromPixelsAsync:()=>rm,toPixels:()=>im});var tm=!1;function nm(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,i=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);o=!0}if(null!=fa(sa,Ei.backendName)){let n={pixels:e},r={numChannels:t};return Ei.runKernel(sa,n,r)}let l,u,[d,c]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height];if(s)l=e.getContext("2d").getImageData(0,0,d,c).data;else if(r||n)l=e.data;else if(i||a||o){if(null==Jp)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Jp=new OffscreenCanvas(1,1).getContext("2d")}else Jp=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Jp.canvas.width=d,Jp.canvas.height=c,Jp.drawImage(e,0,0,d,c),l=Jp.getImageData(0,0,d,c).data}if(4===t)u=new Int32Array(l);else{let e=d*c;u=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)u[n*t+e]=l[4*n+e]}return Pc(u,[c,d,t],"int32")}async function rm(e,t=3){let n=null;if(Ue().getBool("WRAP_TO_IMAGEBITMAP")&&function(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}(e)){let t;try{t=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch(e){t=null}n=null!=t&&t.width===e.width&&t.height===e.height?t:e}else n=e;return nm(n,t)}function am(e){if(2!==e.rank&&3!==e.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);let t=2===e.rank?1:e.shape[2];if(t>4||2===t)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if("float32"!==e.dtype&&"int32"!==e.dtype)throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}async function im(e,t){let n=Bi(e,"img","toPixels");if(!(e instanceof si)){let e=n;n=Vs(e,"int32"),e.dispose()}am(n);let[r,a]=n.shape.slice(0,2),i=2===n.rank?1:n.shape[2],s=await n.data(),o="float32"===n.dtype?255:1,l=new Uint8ClampedArray(a*r*4);for(let e=0;e<r*a;++e){let t=[0,0,0,255];for(let r=0;r<i;r++){let a=s[e*i+r];if("float32"===n.dtype){if(a<0||a>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${a}.`)}else if("int32"===n.dtype&&(a<0||a>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${a}.`);1===i?(t[0]=a*o,t[1]=a*o,t[2]=a*o):t[r]=a*o}let r=4*e;l[r+0]=Math.round(t[0]),l[r+1]=Math.round(t[1]),l[r+2]=Math.round(t[2]),l[r+3]=Math.round(t[3])}if(null!=t){tm||(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),tm=!0),t.width=a,t.height=r;let e=t.getContext("2d"),n=new ImageData(l,a,r);e.putImageData(n,0,0)}return n!==e&&n.dispose(),l}function sm(e,t,n){let r=Bi(e,"img","draw");if(!(e instanceof si)){let e=r;r=Vs(e,"int32"),e.dispose()}am(r),function(e){let t=(null==e?void 0:e.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}(null==n?void 0:n.imageOptions);let a={image:r},i={canvas:t,options:n};Ei.runKernel(Wt,a,i)}var om=Vi({fromPixels_:nm}),lm={};function um(e,t){let n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===te(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);let a=t.shape,i=a[a.length-1],s=1;for(let e=0;e<a.length-1;++e)s*=a[e];let o=e.shape,l=a.slice();l.pop();let u=1;for(let e=i;e<n;++e)u*=o[e],l.push(o[e]);let d=[...Ie(e.shape).map((e=>e/u)),1].slice(0,i);return[l,s,u,d]}x(lm,{prepareAndValidate:()=>um});var dm={};x(dm,{assertParamsValid:()=>pm,computeFlatOffset:()=>_m,computeOutShape:()=>fm,getNormalizedAxes:()=>xm,isSliceContinous:()=>Tm,maskToAxes:()=>mm,parseSliceParams:()=>Im,sliceInfo:()=>Cm,startForAxis:()=>km,startIndicesWithElidedDims:()=>Am,stopForAxis:()=>Sm,stopIndicesWithElidedDims:()=>vm,stridesForAxis:()=>wm,stridesWithElidedDims:()=>gm});var cm=-2,hm=-1;function pm(e,t,n){let r=e.shape.length;J(r===t.length,(()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`)),J(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let a=0;a<r;++a)J(t[a]+n[a]<=e.shape[a],(()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`))}function mm(e){let t=[],n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function fm(e,t,n){let r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function gm(e,t,n,r){let a=[...e];for(let e=a.length;e<r.length;e++)a.push(1);for(let e=0;e<n;e++)0===e?a[t]=1:(a.splice(t,0,1),a.pop());return a}function ym(e,t,n){return n<=e?n:n-(t-1)}function bm(e,t){let n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function xm(e,t,n,r,a,i,s,o,l){let u=e.length,d=new Array(u),c=new Array(u),h=new Array(u);if(t.length&&n>0){let l=t[0],u=n+1;d=Am(s,l,u,r,e),c=vm(o,l,u,a,e),h=gm(i,l,u,e)}else for(let t=0;t<u;t++)d[t]=km(s,r,i,e,t,l),c[t]=Sm(o,a,i,e,t,l),h[t]=wm(i,t,l);return{begin:d,end:c,strides:h}}function Am(e,t,n,r,a){let i=[...a],s=bm(n,t);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let s=ym(t,n,a),o=r[s];e&1<<s&&(o=0),i[a]=o}return i}function vm(e,t,n,r,a){let i=[...a],s=bm(n,t);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let s=ym(t,n,a),o=r[s];e&1<<s&&(o=Number.MAX_SAFE_INTEGER),i[a]=o}for(let e=0;e<i.length;e++){let t=a[e];i[e]<0&&(i[e]+=t),i[e]=G(0,i[e],a[e])}return i}function wm(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function km(e,t,n,r,a,i){let s=t[a],o=n[a]||1;(e&1<<a||i&1<<a||null==s)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);let l=r[a];return s<0&&(s+=l),s=G(0,s,l-1),s}function Sm(e,t,n,r,a,i){let s=t[a],o=n[a]||1;(e&1<<a||i&1<<a||null==s)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);let l=r[a];return s<0&&(s+=l),s=o>0?G(0,s,l):G(-1,s,l-1),s}function Tm(e,t,n){let r=n.length;for(let e=0;e<n.length;e++)if(n[e]>1){r=e;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function _m(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Im(e,t,n){let r,a,i=e.shape.length;return r="number"==typeof t?[t,...new Array(i-1).fill(0)]:t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice(),r.forEach((e=>{J(-1!==e,(()=>"slice() does not support negative begin indexing."))})),a=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,a=a.map(((t,n)=>t>=0?t:(J(-1===t,(()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`)),e.shape[n]-r[n]))),[r,a]}function Cm(e,t,n,r,a,i,s,o,l){let u;if(null==r?(u=new Array(t.length),u.fill(1)):u=r,null!=s&&s&s-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1,c={dims:u.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:u.slice(),beginMask:a,endMask:i,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};for(let e=0;e<c.dims;e++)d&&1<<e&o&&c.numAddAxisAfterEllipsis++,1<<e&s&&(d=!0);d||(c.ellipsisMask|=1<<c.dims,c.dims++);let h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){let a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(cm),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(hm),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(c,h);let p=!0,m=!0,f=!0,g=[],y=[];for(let t=0;t<e.length;++t){if(0===h.strides[t])throw Error(`strides[${t}] must be non-zero`);let n=!!(h.shrinkAxisMask&1<<t),r=e[t];if(-1===r){g.push(n?1:-1);continue}let a=[h.beginMask&1<<t,h.endMask&1<<t],i=[h.strides[t]>0?0:-1,h.strides[t]>0?r:r-1];if(n&&h.strides[t]<=0)throw Error("only stride 1 allowed on non-range indexing.");f=f&&1===h.strides[t];let s=!!(h.beginMask&1<<t&&h.endMask&1<<t);if(h.beginValid&&h.endValid){if(n){let e=h.begin[t]<0?r+h.begin[t]:h.begin[t];if(h.begin[t]=e,h.end[t]=h.begin[t]+1,e<0||e>=r)throw Error(`slice index ${h.begin[t]} of dimension ${t} out of bounds.`)}else h.begin[t]=Em(h.begin[t],0,h.strides[t],r,a,i),h.end[t]=Em(h.end[t],1,h.strides[t],r,a,i);let e=1===h.strides[t]&&0===h.begin[t]&&h.end[t]===r;p=p&&e,m=m&&(0===t&&1===h.strides[t]||e)}else p=p&&1===h.strides[t]&&s,m=m&&(0===t&&1===h.strides[t]||s);let o,l=!1;if(h.beginValid&&h.endValid?(o=h.end[t]-h.begin[t],l=!0):n?(o=1,l=!0):s&&r>=0&&(o=h.strides[t]<0?-r:r,l=!0),l){let e;e=0===o||o<0!=h.strides[t]<0?0:Math.trunc(o/h.strides[t])+(o%h.strides[t]!=0?1:0),g.push(e)}else g.push(-1)}for(let e=0;e<h.finalShapeGatherIndices.length;++e){let t=h.finalShapeGatherIndices[e];t>=0?y.push(g[t]):t===cm&&y.push(1)}return{finalShapeSparse:y.filter(((e,t)=>h.finalShapeGatherIndices[t]!==cm)),finalShape:y,isIdentity:p,sliceDim0:m,isSimpleSlice:f,begin:h.begin,end:h.end,strides:h.strides}}function Em(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];{let t=e<0?r+e:e;return t<i[0]?i[0]:t>i[1]?i[1]:t}}var Nm="4.7.0",Rm=class{static sgd(e){return new _p(e)}static momentum(e,t,n=!1){return new Ip(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,a=!1){return new Cp(e,t,n,r,a)}static adam(e=.001,t=.9,n=.999,r=null){return new Sp(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new wp(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,a=0){return new Tp(e,t,n,r,a)}static adagrad(e,t=.1){return new kp(e,t)}},Pm=Rm,Dm="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function Mm(){return new Promise((e=>Dm((()=>e()))))}var Om,$m={};function Fm(e,t){let n=e[0].length;e.forEach(((e,t)=>{J(e.length===n,(()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`))})),J(t>=0&&t<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));let r=e[0];e.forEach(((e,a)=>{for(let i=0;i<n;i++)J(i===t||e[i]===r[i],(()=>`Error in concat${n}D: Shape of tensors[${a}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${a}.`))}))}function Lm(e,t){let n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}function zm(e,t,n){let r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let a=1;a<n.length;++a){let i=n[a],s=r[r.length-n.length+a],o=r[s];if(i>=0)if(o>=0){if(o!==i)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${a+e}] = ${i} but shape[${a+e}] = ${o}`)}else r[s]=i}return r}function Bm(e){let t={FIRST_DIM_SIZE:Om.FIRST_DIM_SIZE,VALUE_ROWIDS:Om.VALUE_ROWIDS,ROW_LENGTHS:Om.ROW_LENGTHS,ROW_SPLITS:Om.ROW_SPLITS,ROW_LIMITS:Om.ROW_LIMITS,ROW_STARTS:Om.ROW_STARTS},n=[];for(let r of e){if(!(r in t))break;n.push(t[r])}return n}function Um(e){return 0===e.length?0:e[0]===Om.FIRST_DIM_SIZE?e.length-1:e.length}function Wm(e,t){if(null==e||null==t)return;let n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let a=0;a<Math.min(n,r-1);++a){let n=e[a],r=t[a+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${a-e.length}] = ${n} but ragged tensor input.flatValues.shape[${a-e.length}] = ${r}`)}}x($m,{ERF_A1:()=>ef,ERF_A2:()=>tf,ERF_A3:()=>nf,ERF_A4:()=>rf,ERF_A5:()=>af,ERF_P:()=>Qm,PARALLELIZE_THRESHOLD:()=>Vm,RowPartitionType:()=>Om,SELU_SCALE:()=>Jm,SELU_SCALEALPHA:()=>Ym,applyActivation:()=>dh,assertAndGetBroadcastShape:()=>Fl,assertAxesAreInnerMostDims:()=>Yl,assertParamsConsistent:()=>Fm,assignToTypedArray:()=>cf,axesAreInnerMostDims:()=>ql,calculateShapes:()=>zc,checkEinsumDimSizes:()=>Af,checkPadOnDimRoundingMode:()=>Ho,combineLocations:()=>Xl,combineRaggedTensorToTensorShapes:()=>zm,complexWithEvenIndex:()=>lf,complexWithOddIndex:()=>uf,computeConv2DInfo:()=>Mo,computeConv3DInfo:()=>Oo,computeDefaultPad:()=>$o,computeDilation2DInfo:()=>Ro,computeOptimalWindowSize:()=>jm,computeOutAndReduceShapes:()=>Kl,computeOutShape:()=>Lm,computePool2DInfo:()=>Po,computePool3DInfo:()=>Do,convertConv2DDataFormat:()=>jo,decodeEinsumEquation:()=>bf,eitherStridesOrDilationsAreOne:()=>Wo,expandShapeToKeepDim:()=>Zl,exponent:()=>pf,exponents:()=>hf,fromStringArrayToUint8:()=>Wf,fromUint8ToStringArray:()=>Uf,getAxesPermutation:()=>Jl,getBroadcastDims:()=>Ol,getComplexWithIndex:()=>df,getEinsumComputePath:()=>vf,getEinsumPermutation:()=>xf,getFusedBiasGradient:()=>uh,getFusedDyActivation:()=>lh,getImageCenter:()=>Hm,getInnerMostAxes:()=>eu,getPermuted:()=>qm,getRaggedRank:()=>Um,getReductionAxes:()=>$l,getReshaped:()=>Gm,getReshapedPermuted:()=>Xm,getRowPartitionTypesHelper:()=>Bm,getSliceBeginCoords:()=>Km,getSliceSize:()=>Zm,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>Tf,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>_f,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>If,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>Nf,getSparseReshapeInputOutputMismatchErrorMessage:()=>Pf,getSparseReshapeInputOutputMultipleErrorMessage:()=>Rf,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>Cf,getSparseReshapeNegativeOutputDimErrorMessage:()=>Ef,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>$f,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>Df,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>Mf,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>Of,getUndoAxesPermutation:()=>Ql,isIdentityPermutation:()=>wf,log:()=>ha,mergeRealAndImagArrays:()=>sf,prepareAndValidate:()=>um,prepareSplitSize:()=>Sf,segment_util:()=>Ff,shouldFuse:()=>ch,slice_util:()=>dm,splitRealAndImagArrays:()=>of,stridesOrDilationsArePositive:()=>Vo,tupleValuesAreOne:()=>Uo,upcastType:()=>gi,validateDefaultValueShape:()=>Wm,validateInput:()=>Lc,validateUpdateShape:()=>Fc,warn:()=>ca}),function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Om||(Om={}));var Vm=30;function jm(e){return e<=Vm?e:_e(e,Math.floor(Math.sqrt(e)))}function Hm(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Gm(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);let n=t.length;for(let r=0;r<n;++r)a=a.concat([e[r+1]/t[r],t[r]]);a=a.concat(e.slice(n+1))}return a}function qm(e,t,n=!0){let r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{let n=[],a=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?a.push(r):n.push(r);r.push(...n),r.push(0),r.push(...a)}return r}function Xm(e,t,n,r=!0){let a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let n=1;n<e.length;++n)n<=t.length?r?a.push(t[n-1]*e[n]):a.push(e[n]/t[n-1]):a.push(e[n]);return a}function Km(e,t){let n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function Zm(e,t,n){let r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var Ym=1.7580993408473768,Jm=1.0507009873554805,Qm=.3275911,ef=.254829592,tf=-.284496736,nf=1.421413741,rf=-1.453152027,af=1.061405429;function sf(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);let n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function of(e){let t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function lf(e){let t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=0;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}}function uf(e){let t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=2;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}}function df(e,t){return{real:e[2*t],imag:e[2*t+1]}}function cf(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function hf(e,t){let n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){let i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function pf(e,t,n){let r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var mf="->",ff=/->/g,gf=",",yf="...";function bf(e,t){let n=((e=e.replace(/\s/g,"")).length-e.replace(ff,"").length)/mf.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${mf}").`);let[r,a]=e.split(mf);J(-1===r.indexOf(yf),(()=>`The ellipsis notation ("${yf}") is not supported yet.`));let i=r.split(gf),s=i.length;if(t!==s)throw new Error(`Expected ${s} input tensors, received ${t}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let o=[];for(let e=0;e<a.length;++e){let t=a[e];if(!i.some((e=>-1!==e.indexOf(t))))throw new Error(`Output subscripts contain the label ${t} not present in the input subscripts.`);-1===o.indexOf(t)&&o.push(t)}for(let e=0;e<r.length;++e){let t=r[e];-1===o.indexOf(t)&&t!==gf&&o.push(t)}let l=new Array(i.length);for(let e=0;e<s;++e){if(new Set(i[e].split("")).size!==i[e].length)throw new Error(`Found duplicate axes in input component ${i[e]}. Support for duplicate axes in input is not implemented yet.`);l[e]=[];for(let t=0;t<i[e].length;++t)l[e].push(o.indexOf(i[e][t]))}let u=o.length,d=[];for(let e=a.length;e<u;++e)d.push(e);return{allDims:o,summedDims:d,idDims:l}}function xf(e,t){let n=new Array(e);n.fill(-1);for(let e=0;e<t.length;++e)n[t[e]]=e;let r=[];for(let t=0;t<e;++t)-1===n[t]&&r.push(t);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:r}}function Af(e,t,n){let r=new Array(e);for(let e=0;e<n.length;++e){let a=n[e].shape;for(let n=0;n<t[e].length;++n)void 0===r[t[e][n]]?r[t[e][n]]=a[n]:J(r[t[e][n]]===a[n],(()=>`Expected dimension ${r[t[e][n]]} at axis ${n} of input shaped ${JSON.stringify(a)}, but got dimension ${a[n]}`))}}function vf(e,t){let n=e,r=[],a=0;0===e.length&&n.push(-1),a=e.length+1;for(let e=0;e<a;++e)r.push([]);let i=[];for(let e=0;e<n.length;++e){let a=kf(t,n[e]);for(let t of a)-1===i.indexOf(t)&&(r[e].push(t),i.push(t))}return{path:n,steps:r}}function wf(e){return e.every(((e,t)=>e===t))}function kf(e,t){let n=[];for(let r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function Sf(e,t,n=0){let r=[];if("number"==typeof t)J(e.shape[n]%t==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{J(t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0)<=1,(()=>"There should be only one negative value in split array."));let a=t.indexOf(-1);if(-1!==a){let r=t.reduce(((e,t)=>t>0?e+t:e));t[a]=e.shape[n]-r}J(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r}function Tf(e){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${e}`}function _f(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function If(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function Cf(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Ef(e,t){return`size ${e} must be non-negative, not ${t}`}function Nf(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Rf(e,t){return`Input to reshape is a SparseTensor with ${te(e)}\n  dense values, but the requested shape requires a multiple of ${te(t)}. inputShape=${e} outputShape= ${t}`}function Pf(e,t){return`Input to reshape is a tensor with ${te(e)} dense values, but the requested shape has ${te(t)}. inputShape=${e} outputShape=${t}`}function Df(){return"segment ids must be >= 0"}function Mf(){return"segment ids are not increasing"}function Of(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function $f(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}var Ff={};function Lf(e,t){let n,r=!1;for(e<=Vm?(n=e,r=!0):n=_e(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=_e(e,n+1);return n}function zf(e,t,n){let r=[],a=e.length;for(let i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Bf(e,t,n,r){let a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${i}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(e.shape[n]!==t.shape[n])throw new Error(`x.shape[${n}]: ${e.shape[n]} should be equal to indices.shape[${n}]: ${t.shape[n]}.`);let s=e.shape[n],o=[],l=1,u=1,d=1;for(let t=0;t<r;++t)o.push(e.shape[t]),l*=e.shape[t];for(let t=r;t<n;t++)o.push(e.shape[t]),u*=e.shape[t];for(let e=r;e<a;e++)o.push(t.shape[e]);for(let t=n+1;t<i;t++)o.push(e.shape[t]),d*=e.shape[t];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:s,outputShape:o}}function Uf(e){try{return e.map((e=>Ha(e)))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Wf(e){return e.map((e=>ja(e)))}x(Ff,{collectGatherOpShapeInfo:()=>Bf,computeOutShape:()=>zf,segOpComputeOptimalWindowSize:()=>Lf});var Vf,jf,Hf={};x(Hf,{nonMaxSuppressionV3Impl:()=>Eh,nonMaxSuppressionV4Impl:()=>Nh,nonMaxSuppressionV5Impl:()=>Rh,whereImpl:()=>Xc}),function(){for(let e of Ep)Ap(e)}(),Ue().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(Vf||(Vf={})),function(e){let t;var n;(n=t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[n.LEGACY=0]="LEGACY",n[n.V1=1]="V1",n[n.V2=2]="V2"}(jf||(jf={}));var Gf={};function qf(e,t){let n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};Gf[e]=n}function Xf(e){return Gf[e]}function Kf(e){delete Gf[e]}function Zf(e,t,n,r,a){let i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){let e=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?e+1:i.inputIndexEnd,o=e<0?t.inputNames.length+e:e;if("tensor"===i.type)return Yf(t.inputNames[o],n,r,a);if("tensors"===i.type){let i=t.inputs.slice(e,s);return t.inputNames.slice(e,s).filter(((e,t)=>{var n;return"NoOp"!==(null===(n=i[t])||void 0===n?void 0:n.op)})).map((e=>Yf(e,n,r,a)))}let l=Yf(t.inputNames[o],n,r,a),u=l.dataSync();return"number"===i.type?u[0]:Sa.toNestedArray(l.shape,u)}let s=t.attrParams[e];return s&&s.value}function Yf(e,t,n,r){let[a,i]=tg(e,n);if(null!=r){let e=r.getHashTableHandleByName(a);if(null!=e)return e}let s=n.currentContextIds.find((e=>!!t[eg(a,e)]));return void 0!==s?t[eg(a,s)][i]:void 0}function Jf(e,t,n){return t[eg(e,n.currentContextId)]}function Qf(e,t){let[n,r,a]=tg(e,t);return[eg(n,t&&t.currentContextId),r,a]}function eg(e,t){return t?`${e}-${t}`:e}function tg(e,t){if(""===e)return["",0,void 0];let n=null!=t&&null!=t.parseNodeNameCache;if(n){let n=t.parseNodeNameCache.get(e);if(null!=n)return n}let r,a=e.split(":");if(1===a.length)r=[e,0,void 0];else{let e=a[0],t=3===a.length?a[1]:void 0;r=[e,Number(a[a.length-1]),t]}return n&&t.parseNodeNameCache.set(e,r),r}function ng(e,t,n){let r=Zf("pad",e,t,n);if("explicit"===r){r=Zf("explicitPaddings",e,t,n);let a=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)a[e][0]=r[2*e],a[e][1]=r[2*e+1];return a}return r}function rg(e){return e.kept?e:js(e)}var ag={};x(ag,{json:()=>ig});var ig=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],sg={};x(sg,{json:()=>og});var og=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],lg={};x(lg,{json:()=>ug});var ug=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],dg={};x(dg,{json:()=>cg});var cg=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],hg={};x(hg,{json:()=>pg});var pg=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],mg={};x(mg,{json:()=>fg});var fg=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],gg={};x(gg,{json:()=>yg});var yg=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],bg={};x(bg,{json:()=>xg});var xg=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Ag={};x(Ag,{json:()=>vg});var vg=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],wg={};x(wg,{json:()=>kg});var kg=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Sg={};x(Sg,{json:()=>Tg});var Tg=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],_g={};x(_g,{json:()=>Ig});var Ig=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Cg={};x(Cg,{json:()=>Eg});var Eg=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Ng={};x(Ng,{json:()=>Rg});var Rg=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Pg={};x(Pg,{json:()=>Dg});var Dg=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Mg={};x(Mg,{json:()=>Og});var Og=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],$g={};x($g,{json:()=>Fg});var Fg=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Lg={};x(Lg,{json:()=>zg});var zg=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Bg={};x(Bg,{json:()=>Ug});var Ug=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Wg=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let e=[].concat(...[ag,sg,lg,dg,hg,mg,gg,bg,Ag,wg,Sg,_g,Cg,Ng,Pg,Mg,$g,Lg,Bg].map((e=>e.json)));this.opMappers=e.reduce(((e,t)=>(e[t.tfOpName]=t,e)),{})}transformGraph(e,t={}){let n=e.node,r=[],a=[],i=[],s=n.reduce(((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?a.push(e[t.name]):(null==t.input||0===t.input.length)&&i.push(e[t.name]),e)),{}),o=[],l=[],u={},d={};null!=t&&(u=this.mapSignatureEntries(t.inputs),d=this.mapSignatureEntries(t.outputs));let c=Object.keys(s);c.forEach((e=>{let t=s[e];t.inputNames.forEach(((e,n)=>{let[r,,a]=Qf(e),i=s[r];if(null!=i.outputs){let e=i.outputs.indexOf(a);if(-1!==e){let a=`${r}:${e}`;t.inputNames[n]=a}}t.inputs.push(i),i.children.push(t)}))})),0===Object.keys(d).length?c.forEach((e=>{let t=s[e];0===t.children.length&&l.push(t)})):Object.keys(d).forEach((e=>{let[t]=Qf(e),n=s[t];null!=n&&(n.signatureKey=d[e],l.push(n))})),Object.keys(u).length>0?Object.keys(u).forEach((e=>{let[t]=Qf(e),n=s[t];n&&(n.signatureKey=u[e],o.push(n))})):o=r;let h={};null!=e.library&&null!=e.library.function&&(h=e.library.function.reduce(((e,t)=>(e[t.signature.name]=this.mapFunction(t),e)),{}));let p={nodes:s,inputs:o,outputs:l,weights:a,placeholders:r,signature:t,functions:h};return i.length>0&&(p.initNodes=i),p}mapSignatureEntries(e){return Object.keys(e||{}).reduce(((t,n)=>(t[e[n].name]=n,t)),{})}mapNode(e){let t=Xf(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});let n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((e=>e.startsWith("^")?e.slice(1):e)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce(((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e)),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce(((t,n)=>{let r,a=n.type;switch(n.type){case"string":r=jg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=jg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":r=ey(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=ey(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":r=Gg(e.attr,n.tfName,n.defaultValue||0),void 0===r&&n.tfDeprecatedName&&(r=Gg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":r=Qg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=Qg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":r=Hg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=Hg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":r=ny(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=ny(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":r=Jg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=Jg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":r=ty(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=ty(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":r=Kg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=Kg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":r=Zg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=Zg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":r=Xg(e.attr,n.tfName,n.defaultValue),void 0===r&&n.tfDeprecatedName&&(r=Xg(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${e.op}`)}return t[n.name]={value:r,type:a},t}),{})),n}mapFunction(e){let t=e.nodeDef,n=[],r={};null!=t&&(r=t.reduce(((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e)),{}));let a=[],i=[];e.signature.inputArg.forEach((e=>{let[t]=Qf(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:qg(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,a.push(n),r[t]=n})),Object.keys(r).forEach((e=>{let t=r[e];t.inputNames.forEach(((e,n)=>{let[a,,i]=Qf(e),s=r[a];if(null!=s.outputs){let e=s.outputs.indexOf(i);if(-1!==e){let r=`${a}:${e}`;t.inputNames[n]=r}}t.inputs.push(s),s.children.push(t)}))}));let s=e.ret;e.signature.outputArg.forEach((e=>{let[t,n]=Qf(s[e.name]),a=r[t];null!=a&&(a.defaultOutput=n,i.push(a))}));let o=this.mapArgsToSignature(e);return{nodes:r,inputs:a,outputs:i,weights:n,placeholders:[],signature:o}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e)),{}),outputs:e.signature.outputArg.reduce(((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t)),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}};function Vg(e,t){let n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){let t=Ue().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function jg(e,t,n,r=!1){let a=e[t];return null!=a?Vg(a.s,r):n}function Hg(e,t,n){let r=e[t];return r?r.b:n}function Gg(e,t,n){let r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function qg(e){switch("string"==typeof e&&(e=Vf[e]),e){case Vf.DT_FLOAT:case Vf.DT_HALF:return"float32";case Vf.DT_INT32:case Vf.DT_INT64:case Vf.DT_INT8:case Vf.DT_UINT8:return"int32";case Vf.DT_BOOL:return"bool";case Vf.DT_DOUBLE:return"float32";case Vf.DT_STRING:return"string";default:return null}}function Xg(e,t,n){let r=e[t];return r&&r.func?r.func.name:n}function Kg(e,t,n){let r=e[t];return r&&r.type?qg(r.type):n}function Zg(e,t,n){let r=e[t];return r&&r.list&&r.list.type?r.list.type.map((e=>qg(e))):n}function Yg(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((e=>"number"==typeof e.size?e.size:parseInt(e.size,10))):[]}function Jg(e,t,n){let r=e[t];return r&&r.shape?Yg(r.shape):n}function Qg(e,t,n){let r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((e=>"number"==typeof e?e:parseInt(e,10))):n}function ey(e,t,n,r=!1){let a=e[t];return a&&a.list&&a.list.s?a.list.s.map((e=>Vg(e,r))):n}function ty(e,t,n){let r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((e=>Yg(e))):n}function ny(e,t,n){let r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var ry={};function ay(e,t,n=""){if("number"!=typeof e&&"number"!=typeof t){Sa.assert(e.length===t.length,(()=>n+` Shapes ${e} and ${t} must match`));for(let r=0;r<e.length;r++){let a=e[r],i=t[r];Sa.assert(a<0||i<0||a===i,(()=>n+` Shapes ${e} and ${t} must match`))}}}function iy(e){return!("number"==typeof e||e.some((e=>e<0)))}function sy(e,t,n){let r=oy(e,n),a=!iy(r);if(a&&0===t.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach((e=>{r=oy(e.shape,r)})),!iy(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function oy(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);let n=[];for(let r=0;r<e.length;++r){let a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:i}return n}x(ry,{OP_SCOPE_SUFFIX:()=>Wi,abs:()=>bo,acos:()=>xo,acosh:()=>Ao,add:()=>mo,addN:()=>vo,all:()=>wo,any:()=>ko,argMax:()=>So,argMin:()=>To,asin:()=>_o,asinh:()=>Io,atan:()=>Co,atan2:()=>Eo,atanh:()=>No,avgPool:()=>qo,avgPool3d:()=>Xo,basicLSTMCell:()=>el,batchNorm:()=>rl,batchNorm2d:()=>al,batchNorm3d:()=>il,batchNorm4d:()=>sl,batchToSpaceND:()=>tl,bincount:()=>ol,bitwiseAnd:()=>ll,booleanMaskAsync:()=>Zc,broadcastArgs:()=>ul,broadcastTo:()=>dl,buffer:()=>Ws,cast:()=>Vs,ceil:()=>cl,clipByValue:()=>pl,clone:()=>js,complex:()=>ji,concat:()=>Ko,concat1d:()=>ml,concat2d:()=>fl,concat3d:()=>gl,concat4d:()=>yl,conv1d:()=>xl,conv2d:()=>bl,conv2dTranspose:()=>vl,conv3d:()=>wl,conv3dTranspose:()=>Sl,cos:()=>Tl,cosh:()=>_l,cosineWindow:()=>ah,cumprod:()=>Il,cumsum:()=>Cl,denseBincount:()=>El,depthToSpace:()=>Nl,depthwiseConv2d:()=>Rl,diag:()=>Pl,dilation2d:()=>Dl,div:()=>go,divNoNan:()=>Ul,dot:()=>Wl,dropout:()=>nh,einsum:()=>Vl,elu:()=>jl,enclosingPowerOfTwo:()=>rh,ensureShape:()=>Hl,equal:()=>Ll,erf:()=>Gl,euclideanNorm:()=>du,exp:()=>cu,expandDims:()=>hu,expm1:()=>pu,eye:()=>fu,fft:()=>xc,fill:()=>hl,floor:()=>gu,floorDiv:()=>fo,fused:()=>sh,gather:()=>yu,gatherND:()=>th,greater:()=>bu,greaterEqual:()=>xu,ifft:()=>Ac,imag:()=>Au,image:()=>hp,inTopKAsync:()=>ih,irfft:()=>vc,isFinite:()=>vu,isInf:()=>wu,isNaN:()=>ku,leakyRelu:()=>Su,less:()=>Tu,lessEqual:()=>_u,linalg:()=>pp,linspace:()=>Iu,localResponseNormalization:()=>Cu,log:()=>Eu,log1p:()=>Nu,logSigmoid:()=>Bu,logSoftmax:()=>Wu,logSumExp:()=>Vu,logicalAnd:()=>ju,logicalNot:()=>Hu,logicalOr:()=>Gu,logicalXor:()=>qu,losses:()=>mp,lowerBound:()=>Zu,matMul:()=>Zo,max:()=>tu,maxPool:()=>Yu,maxPool3d:()=>Ju,maxPoolWithArgmax:()=>Qu,maximum:()=>ed,mean:()=>td,meshgrid:()=>ad,min:()=>nu,minimum:()=>id,mirrorPad:()=>sd,mod:()=>od,moments:()=>ld,movingAverage:()=>Jc,mul:()=>yo,multiRNNCell:()=>ud,multinomial:()=>dd,neg:()=>Lu,norm:()=>uu,notEqual:()=>cd,oneHot:()=>hd,ones:()=>rd,onesLike:()=>pd,op:()=>Vi,outerProduct:()=>md,pad:()=>fd,pad1d:()=>gd,pad2d:()=>yd,pad3d:()=>bd,pad4d:()=>xd,pool:()=>vd,pow:()=>ru,prelu:()=>wd,print:()=>Hs,prod:()=>kd,raggedGather:()=>Sd,raggedRange:()=>Td,raggedTensorToTensor:()=>_d,rand:()=>Id,randomGamma:()=>Hd,randomNormal:()=>Gd,randomStandardNormal:()=>qd,randomUniform:()=>Xd,randomUniformInt:()=>Kd,range:()=>Zd,real:()=>Yd,reciprocal:()=>Jd,relu:()=>Qd,relu6:()=>ec,reshape:()=>Go,reverse:()=>tc,reverse1d:()=>nc,reverse2d:()=>rc,reverse3d:()=>ac,reverse4d:()=>ic,rfft:()=>kc,round:()=>sc,rsqrt:()=>oc,scalar:()=>au,scatterND:()=>Qc,searchSorted:()=>Ku,selu:()=>lc,separableConv2d:()=>uc,setdiff1dAsync:()=>dc,sigmoid:()=>Yo,sign:()=>cc,signal:()=>cp,sin:()=>hc,sinh:()=>pc,slice:()=>Jo,slice1d:()=>mc,slice2d:()=>fc,slice3d:()=>gc,slice4d:()=>yc,softmax:()=>bc,softplus:()=>zu,spaceToBatchND:()=>Ad,sparse:()=>fp,sparseToDense:()=>eh,spectral:()=>dp,split:()=>wc,sqrt:()=>iu,square:()=>su,squaredDifference:()=>Sc,squeeze:()=>Tc,stack:()=>_c,step:()=>Ic,stridedSlice:()=>Cc,string:()=>gp,sub:()=>Uu,sum:()=>ou,tan:()=>Ec,tanh:()=>Qo,tensor:()=>Gi,tensor1d:()=>Nc,tensor2d:()=>Rc,tensor3d:()=>Pc,tensor4d:()=>Dc,tensor5d:()=>Mc,tensor6d:()=>Oc,tensorScatterUpdate:()=>Bc,tile:()=>mu,topk:()=>Uc,transpose:()=>Yc,truncatedNormal:()=>Wc,unique:()=>Vc,unsortedSegmentSum:()=>jc,unstack:()=>Hc,upperBound:()=>Gc,variable:()=>qc,where:()=>zl,whereAsync:()=>Kc,zeros:()=>nd,zerosLike:()=>Bl});var ly=class{get id(){return this.idTensor.id}constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach((e=>{if(n!==e.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);ay(t,e.shape,"TensorList shape mismatch: "),no(e)})),this.idTensor=au(0),this.maxNumElements=r,no(this.idTensor)}copy(){return new ly([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach((t=>{(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);ay(e,this.elementShape,"TensorList shape mismatch: ");let r=sy(this.elementShape,this.tensors,e);return eo((()=>{let e=this.tensors.map((e=>Go(e,r)));return _c(e,0)}))}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");let n=sy(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,ay(r.shape,e,"TensorList shape mismatch: "),Go(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(ay(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");no(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);let t=new ly([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw new Error(`element at index ${e} is null.`);ay(this.tensors[e].shape,t,"TensorList shape mismatch: ");let r=sy(this.elementShape,this.tensors,t);return Go(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);ay(this.elementShape,t.shape,"TensorList shape mismatch: "),no(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);ay(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());let r=sy(this.elementShape,this.tensors,n);return 0===e.length?Gi([],[0].concat(r)):eo((()=>{let t=e.map((e=>Go(this.tensors[e],r)));return _c(t,0)}))}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);ay(this.elementShape,t,"TensorList shape mismatch: ");let n=sy(this.elementShape,this.tensors,t);return 0===this.size()?Gi([],[0].concat(n)):eo((()=>{let e=this.tensors.map((e=>Go(e,n)));return Ko(e,0)}))}},uy=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{let r=Zf("thenBranch",e,t,n),a=Zf("elseBranch",e,t,n),i=Zf("cond",e,t,n),s=Zf("args",e,t,n);return(await i.data())[0]?n.functionMap[r].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{let r=Zf("body",e,t,n),a=Zf("cond",e,t,n),i=Zf("args",e,t,n),s=await n.functionMap[a].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),o=i.map((e=>e.id)),l=await s[0].data();s.forEach((e=>{!e.kept&&-1===o.indexOf(e.id)&&e.dispose()}));let u=i;for(;l[0];){let e=u;u=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);let t=u.map((e=>e.id));e.forEach((e=>{!e.kept&&-1===o.indexOf(e.id)&&-1===t.indexOf(e.id)&&e.dispose()}));let i=await n.functionMap[a].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await i[0].data(),i.forEach((e=>{!e.kept&&-1===o.indexOf(e.id)&&-1===t.indexOf(e.id)&&e.dispose()}))}return u}case"LoopCond":return[rg(Zf("pred",e,t,n))];case"Switch":{let r=Zf("pred",e,t,n),a=Zf("data",e,t,n);return a.kept||(a=rg(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{let r=e.inputNames.find((e=>void 0!==Yf(e,t,n)));return r?[rg(Yf(r,t,n))]:void 0}case"Enter":{let r=Zf("frameName",e,t,n),a=Zf("tensor",e,t,n);return n.enterFrame(r),[rg(a)]}case"Exit":{let r=Zf("tensor",e,t,n);return n.exitFrame(),[rg(r)]}case"NextIteration":{let r=Zf("tensor",e,t,n);return n.nextIteration(),[rg(r)]}case"TensorArrayV3":{let r=Zf("size",e,t,n),a=Zf("dtype",e,t,n),i=Zf("elementShape",e,t,n),s=Zf("dynamicSize",e,t,n),o=Zf("clearAfterRead",e,t,n),l=Zf("identicalElementShapes",e,t,n),u=Zf("name",e,t,n),d=new class{constructor(e,t,n,r,a,i,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=i,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=au(0),no(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach((t=>{(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);let t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map((e=>this.read(e)))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);let n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},\n          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),ay(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,no(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach(((e,n)=>this.write(e,t[n])))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return Gi([],[0].concat(this.elementShape));let n=this.readMany(e);return ay(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),_c(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(0===this.size())return Gi([],[0].concat(this.elementShape));let t=[];for(let e=0;e<this.size();e++)t.push(e);let n=this.readMany(t);return ay(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Ko(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);let n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,Hc(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0,r=e.map((e=>(n+=e,n)));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);let a=0===n?0:t.size/n,i=[];eo((()=>{t=Go(t,[1,n,a]);for(let n=0;n<e.length;++n){let s=[0,0===n?0:r[n-1],0],o=[1,e[n],a];i[n]=Go(Jo(t,s,o),this.elementShape)}return i}));let s=[];for(let t=0;t<e.length;t++)s[t]=t;this.writeMany(s,i)}}(u,a,r,i,l,s,o);return n.addTensorArray(d),[d.idTensor,au(1)]}case"TensorArrayWriteV3":{let r=Zf("tensorArrayId",e,t,n),a=Zf("index",e,t,n),i=Zf("tensor",e,t,n),s=n.getTensorArray(r.id);return s.write(a,i),[s.idTensor]}case"TensorArrayReadV3":{let r=Zf("tensorArrayId",e,t,n),a=Zf("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{let r=Zf("tensorArrayId",e,t,n),a=Zf("indices",e,t,n),i=Zf("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,i)]}case"TensorArrayScatterV3":{let r=Zf("tensorArrayId",e,t,n),a=Zf("indices",e,t,n),i=Zf("tensor",e,t,n),s=n.getTensorArray(r.id);return s.scatter(a,i),[s.idTensor]}case"TensorArrayConcatV3":{let r=Zf("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),i=Zf("dtype",e,t,n);return[a.concat(i)]}case"TensorArraySplitV3":{let r=Zf("tensorArrayId",e,t,n),a=Zf("tensor",e,t,n),i=Zf("lengths",e,t,n),s=n.getTensorArray(r.id);return s.split(i,a),[s.idTensor]}case"TensorArraySizeV3":{let r=Zf("tensorArrayId",e,t,n);return[au(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{let r=Zf("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{let r=Zf("tensorListId",e,t,n),a=Zf("index",e,t,n),i=Zf("tensor",e,t,n),s=n.getTensorList(r.id);return s.setItem(a,i),[s.idTensor]}case"TensorListGetItem":{let r=Zf("tensorListId",e,t,n),a=Zf("index",e,t,n),i=Zf("elementShape",e,t,n),s=Zf("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,i,s)]}case"TensorListScatterV2":case"TensorListScatter":{let r=Zf("indices",e,t,n),a=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let a=Math.max(...t);if(null!=r&&-1!==r&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);let i=new ly([],n,e.dtype,r),s=Hc(e,0);return t.forEach(((e,t)=>{i.setItem(e,s[t])})),i}(Zf("tensor",e,t,n),r,Zf("elementShape",e,t,n),Zf("numElements",e,t,n));return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let r,a=Zf("elementShape",e,t,n),i=Zf("elementDType",e,t,n);r="TensorListReserve"===e.op?"numElements":"maxNumElements";let s=Zf(r,e,t,n),o=function(e,t,n,r){return new ly([],e,t,r)}(a,i,0,"TensorListReserve"===e.op?-1:s);return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{let r=Zf("tensorListId",e,t,n),a=Zf("indices",e,t,n),i=Zf("elementShape",e,t,n),s=Zf("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,s,i)]}case"TensorListStack":{let r=Zf("tensorListId",e,t,n),a=Zf("elementShape",e,t,n),i=Zf("elementDType",e,t,n),s=Zf("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,i,s)]}case"TensorListFromTensor":{let r=function(e,t,n){let r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);ay(e.shape.slice(1),t,"TensorList shape mismatch: ");let a=Hc(e);return new ly(a,t,r)}(Zf("tensor",e,t,n),Zf("elementShape",e,t,n),Zf("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let r=Zf("tensorListId",e,t,n),a=n.getTensorList(r.id),i=Zf("dtype",e,t,n),s=Zf("elementShape",e,t,n);return[a.concat(i,s)]}case"TensorListPushBack":{let r=Zf("tensorListId",e,t,n),a=Zf("tensor",e,t,n),i=n.getTensorList(r.id);return i.pushBack(a),[i.idTensor]}case"TensorListPopBack":{let r=Zf("tensorListId",e,t,n),a=Zf("elementShape",e,t,n),i=Zf("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,i)]}case"TensorListSplit":{let r=Zf("tensor",e,t,n),a=Zf("elementShape",e,t,n),i=function(e,t,n){let r=0,a=t.map((e=>(r+=e,r)));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${e.shape}`);let i=oy(e.shape.slice(1),n),s=0===r?0:e.size/r,o=eo((()=>{let n=[];e=Go(e,[1,r,s]);for(let r=0;r<t.length;++r){let o=[0,0===r?0:a[r-1],0],l=[1,t[r],s];n[r]=Go(Jo(e,o,l),i)}return e.dispose(),n})),l=new ly([],n,e.dtype,t.length);for(let e=0;e<o.length;e++)l.setItem(e,o[e]);return l}(r,Zf("lengths",e,t,n),a);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{let r=Zf("tensorListId",e,t,n);return[au(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{let r=Zf("tensorListId",e,t,n),a=Zf("size",e,t,n),i=n.getTensorList(r.id).resize(a);return n.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};function dy(e,t,n){let[r,a]=Zf("fusedOps",e,t,n),i="biasadd"===r,s=!i,o="prelu"===a,l="fusedbatchnorm"===r,u=Zf("numArgs",e,t,n);if(i){if(o&&2!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&i&&1!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let d=Zf("strides",e,t,n),c=ng(e,t,n),h=Zf("dataFormat",e,t,n).toUpperCase(),p=Zf("dilations",e,t,n),[m,f]=Zf("args",e,t,n);return s&&(f=m,m=void 0),{stride:d,pad:c,dataFormat:h,dilations:p,biasArg:m,preluArg:f,activationFunc:a,leakyreluAlpha:Zf("leakyreluAlpha",e,t,n)}}function cy(e,t,n){return{boxes:Zf("boxes",e,t,n),scores:Zf("scores",e,t,n),maxOutputSize:Zf("maxOutputSize",e,t,n),iouThreshold:Zf("iouThreshold",e,t,n),scoreThreshold:Zf("scoreThreshold",e,t,n),softNmsSigma:Zf("softNmsSigma",e,t,n)}}var hy=async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{let a=r.getHashTableHandleByName(e.name);if(null!=a)return[a];{let a=Zf("keyDType",e,t,n),i=Zf("valueDType",e,t,n),s=new class{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=au(0),this.tensorMap=new Map,no(this.handle)}clearAndClose(){this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return au(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),eo((()=>{let e=Hc(t),r=n.length,a=e.length;Sa.assert(r===a,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${a} elements.`));for(let t=0;t<r;t++){let r=n[t],a=e[t];no(a),this.tensorMap.set(r,a)}return this.handle}))}async find(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return eo((()=>{let e=[];for(let r=0;r<n.length;r++){let a=n[r],i=this.findWithDefault(a,t);e.push(i)}return _c(e)}))}findWithDefault(e,t){let n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}(a,i);return r.addHashTable(e.name,s),[s.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let a=Zf("tableHandle",e,t,n,r),i=Zf("keys",e,t,n),s=Zf("values",e,t,n);return[await r.getHashTableById(a.id).import(i,s)]}case"LookupTableFind":case"LookupTableFindV2":{let a=Zf("tableHandle",e,t,n,r),i=Zf("keys",e,t,n),s=Zf("defaultValue",e,t,n);return[await r.getHashTableById(a.id).find(i,s)]}case"LookupTableSize":case"LookupTableSizeV2":{let a=Zf("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};function py(e,t,n,r,a=eo){let i=((e,t,n)=>{switch(e.category){case"arithmetic":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(Zf("a",e,t,n),Zf("b",e,t,n))];case"AddN":return[r.addN(Zf("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(Zf("a",e,t,n),Zf("b",e,t,n))];case"Mul":return[r.mul(Zf("a",e,t,n),Zf("b",e,t,n))];case"RealDiv":case"Div":return[r.div(Zf("a",e,t,n),Zf("b",e,t,n))];case"DivNoNan":return[r.divNoNan(Zf("a",e,t,n),Zf("b",e,t,n))];case"FloorDiv":return[r.floorDiv(Zf("a",e,t,n),Zf("b",e,t,n))];case"Sub":return[r.sub(Zf("a",e,t,n),Zf("b",e,t,n))];case"Minimum":return[r.minimum(Zf("a",e,t,n),Zf("b",e,t,n))];case"Maximum":return[r.maximum(Zf("a",e,t,n),Zf("b",e,t,n))];case"Pow":return[r.pow(Zf("a",e,t,n),Zf("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(Zf("a",e,t,n),Zf("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"basic_math":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(Zf("x",e,t,n))];case"Acos":return[r.acos(Zf("x",e,t,n))];case"Acosh":return[r.acosh(Zf("x",e,t,n))];case"Asin":return[r.asin(Zf("x",e,t,n))];case"Asinh":return[r.asinh(Zf("x",e,t,n))];case"Atan":return[r.atan(Zf("x",e,t,n))];case"Atan2":return[r.atan2(Zf("x",e,t,n),Zf("y",e,t,n))];case"Atanh":return[r.atanh(Zf("x",e,t,n))];case"Ceil":return[r.ceil(Zf("x",e,t,n))];case"Complex":return[r.complex(Zf("real",e,t,n),Zf("imag",e,t,n))];case"Cos":return[r.cos(Zf("x",e,t,n))];case"Cosh":return[r.cosh(Zf("x",e,t,n))];case"Elu":return[r.elu(Zf("x",e,t,n))];case"Erf":return[r.erf(Zf("x",e,t,n))];case"Exp":return[r.exp(Zf("x",e,t,n))];case"Expm1":return[r.expm1(Zf("x",e,t,n))];case"Floor":return[r.floor(Zf("x",e,t,n))];case"Log":return[r.log(Zf("x",e,t,n))];case"Log1p":return[r.log1p(Zf("x",e,t,n))];case"Imag":return[r.imag(Zf("x",e,t,n))];case"Neg":return[r.neg(Zf("x",e,t,n))];case"Reciprocal":return[r.reciprocal(Zf("x",e,t,n))];case"Real":return[r.real(Zf("x",e,t,n))];case"Relu":return[r.relu(Zf("x",e,t,n))];case"Round":return[r.round(Zf("x",e,t,n))];case"Selu":return[r.selu(Zf("x",e,t,n))];case"Sigmoid":return[r.sigmoid(Zf("x",e,t,n))];case"Sin":return[r.sin(Zf("x",e,t,n))];case"Sign":return[r.sign(Zf("x",e,t,n))];case"Sinh":return[r.sinh(Zf("x",e,t,n))];case"Softplus":return[r.softplus(Zf("x",e,t,n))];case"Sqrt":return[r.sqrt(Zf("x",e,t,n))];case"Square":return[r.square(Zf("x",e,t,n))];case"Tanh":return[r.tanh(Zf("x",e,t,n))];case"Tan":return[r.tan(Zf("x",e,t,n))];case"ClipByValue":return[r.clipByValue(Zf("x",e,t,n),Zf("clipValueMin",e,t,n),Zf("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(Zf("x",e,t,n))];case"Rsqrt":return[r.rsqrt(Yf(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(Zf("x",e,t,n),Zf("alpha",e,t,n))];case"Prelu":return[r.prelu(Zf("x",e,t,n),Zf("alpha",e,t,n))];case"IsNan":return[r.isNaN(Yf(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(Yf(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(Yf(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"control":return uy(e,t,n);case"convolution":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Conv1D":{let a=Zf("stride",e,t,n),i=Zf("pad",e,t,n),s=Zf("dataFormat",e,t,n).toUpperCase(),o=Zf("dilation",e,t,n);return[r.conv1d(Zf("x",e,t,n),Zf("filter",e,t,n),a,i,s,o)]}case"Conv2D":{let a=Zf("strides",e,t,n),i=ng(e,t,n),s=Zf("dataFormat",e,t,n).toUpperCase(),o=Zf("dilations",e,t,n);return[r.conv2d(Zf("x",e,t,n),Zf("filter",e,t,n),[a[1],a[2]],i,s,[o[1],o[2]])]}case"_FusedConv2D":{let{stride:a,pad:i,dataFormat:s,dilations:o,biasArg:l,preluArg:u,activationFunc:d,leakyreluAlpha:c}=dy(e,t,n);return[r.fused.conv2d({x:Zf("x",e,t,n),filter:Zf("filter",e,t,n),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:d,preluActivationWeights:u,leakyreluAlpha:c})]}case"FusedDepthwiseConv2dNative":{let{stride:a,pad:i,dataFormat:s,dilations:o,biasArg:l,preluArg:u,activationFunc:d,leakyreluAlpha:c}=dy(e,t,n);return[r.fused.depthwiseConv2d({x:Zf("x",e,t,n),filter:Zf("filter",e,t,n),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:d,preluActivationWeights:u,leakyreluAlpha:c})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let a=Zf("outputShape",e,t,n),i=Zf("strides",e,t,n),s=ng(e,t,n);return[r.conv2dTranspose(Zf("x",e,t,n),Zf("filter",e,t,n),a,[i[1],i[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let a=Zf("strides",e,t,n),i=ng(e,t,n),s=Zf("dilations",e,t,n),o=Zf("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(Zf("input",e,t,n),Zf("filter",e,t,n),[a[1],a[2]],i,o,[s[1],s[2]])]}case"Conv3D":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("dataFormat",e,t,n).toUpperCase(),o=Zf("dilations",e,t,n);return[r.conv3d(Zf("x",e,t,n),Zf("filter",e,t,n),[a[1],a[2],a[3]],i,s,[o[1],o[2],o[3]])]}case"AvgPool":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("kernelSize",e,t,n);return[r.avgPool(Zf("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i)]}case"MaxPool":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("kernelSize",e,t,n);return[r.maxPool(Zf("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("kernelSize",e,t,n),o=Zf("includeBatchInIndex",e,t,n),{result:l,indexes:u}=r.maxPoolWithArgmax(Zf("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i,o);return[l,u]}case"AvgPool3D":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("kernelSize",e,t,n);return[r.avgPool3d(Zf("x",e,t,n),[s[1],s[2],s[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("kernelSize",e,t,n);return[r.maxPool3d(Zf("x",e,t,n),[s[1],s[2],s[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{let a=Zf("strides",e,t,n),i=Zf("pad",e,t,n),s=Zf("dilations",e,t,n),o=a[1],l=a[2],u=s[1],d=s[2];return[r.dilation2d(Zf("x",e,t,n),Zf("filter",e,t,n),[o,l],i,[u,d],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"creation":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Fill":{let a=Zf("shape",e,t,n),i=Zf("dtype",e,t,n),s=Zf("value",e,t,n);return[r.fill(a,s,i)]}case"LinSpace":{let a=Zf("start",e,t,n),i=Zf("stop",e,t,n),s=Zf("num",e,t,n);return[r.linspace(a,i,s)]}case"Multinomial":{let a=Zf("logits",e,t,n),i=Zf("numSamples",e,t,n),s=Zf("seed",e,t,n);return[r.multinomial(a,i,s)]}case"OneHot":{let a=Zf("indices",e,t,n),i=Zf("depth",e,t,n),s=Zf("onValue",e,t,n),o=Zf("offValue",e,t,n),l=Zf("dtype",e,t,n);return[r.oneHot(a,i,s,o,l)]}case"Ones":return[r.ones(Zf("shape",e,t,n),Zf("dtype",e,t,n))];case"OnesLike":return[r.onesLike(Zf("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(Zf("shape",e,t,n),Zf("dtype",e,t,n),Zf("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(Zf("shape",e,t,n),Zf("minval",e,t,n),Zf("maxval",e,t,n),Zf("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(Zf("shape",e,t,n),Zf("minval",e,t,n),Zf("maxval",e,t,n),Zf("seed",e,t,n))];case"Range":{let a=Zf("start",e,t,n),i=Zf("stop",e,t,n),s=Zf("step",e,t,n);return[r.range(a,i,s,Zf("dtype",e,t,n))]}case"TruncatedNormal":{let a=Zf("shape",e,t,n),i=Zf("mean",e,t,n),s=Zf("stdDev",e,t,n),o=Zf("seed",e,t,n);return[r.truncatedNormal(a,i,s,Zf("dtype",e,t,n),o)]}case"Zeros":return[r.zeros(Zf("shape",e,t,n),Zf("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(Zf("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"dynamic":return(async(e,t,n,r,a=ry)=>{switch(e.op){case"NonMaxSuppressionV5":{let{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=cy(e,t,n),d=await a.image.nonMaxSuppressionWithScoreAsync(r,i,s,o,l,u);return[d.selectedIndices,d.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=cy(e,t,n),u=Zf("padToMaxOutputSize",e,t,n),d=await a.image.nonMaxSuppressionPaddedAsync(r,i,s,o,l,u);return[d.selectedIndices,d.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=cy(e,t,n);return[await a.image.nonMaxSuppressionAsync(r,i,s,o,l)]}case"Where":{let r=a.cast(Zf("condition",e,t,n),"bool"),i=[await a.whereAsync(r)];return r.dispose(),i}case"ListDiff":return a.setdiff1dAsync(Zf("x",e,t,n),Zf("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"evaluation":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"LowerBound":{let a=Zf("sortedSequence",e,t,n),i=Zf("values",e,t,n);return[r.lowerBound(a,i)]}case"TopKV2":{let a=Zf("x",e,t,n),i=Zf("k",e,t,n),s=Zf("sorted",e,t,n),o=r.topk(a,i,s);return[o.values,o.indices]}case"UpperBound":{let a=Zf("sortedSequence",e,t,n),i=Zf("values",e,t,n);return[r.upperBound(a,i)]}case"Unique":{let a=Zf("x",e,t,n),i=r.unique(a);return[i.values,i.indices]}case"UniqueV2":{let a=Zf("x",e,t,n),i=Zf("axis",e,t,n),s=r.unique(a,i);return[s.values,s.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"image":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"ResizeBilinear":{let a=Zf("images",e,t,n),i=Zf("size",e,t,n),s=Zf("alignCorners",e,t,n),o=Zf("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],s,o)]}case"ResizeNearestNeighbor":{let a=Zf("images",e,t,n),i=Zf("size",e,t,n),s=Zf("alignCorners",e,t,n),o=Zf("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(a,[i[0],i[1]],s,o)]}case"CropAndResize":{let a=Zf("image",e,t,n),i=Zf("boxes",e,t,n),s=Zf("boxInd",e,t,n),o=Zf("cropSize",e,t,n),l=Zf("method",e,t,n),u=Zf("extrapolationValue",e,t,n);return[r.image.cropAndResize(a,i,s,o,l,u)]}case"ImageProjectiveTransformV3":{let a=Zf("images",e,t,n),i=Zf("transforms",e,t,n),s=Zf("outputShape",e,t,n),o=Zf("fillValue",e,t,n),l=Zf("interpolation",e,t,n),u=Zf("fillMode",e,t,n);return[r.image.transform(a,i,l.toLowerCase(),u.toLowerCase(),o,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"graph":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":let a=Zf("default",e,t,n);return[Yf(e.name,t,n)||a];case"Placeholder":return[Yf(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[rg(Zf("x",e,t,n))];case"IdentityN":return Zf("x",e,t,n).map((e=>rg(e)));case"Shape":return[r.tensor1d(Zf("x",e,t,n).shape,"int32")];case"ShapeN":return Zf("x",e,t,n).map((e=>r.tensor1d(e.shape)));case"Size":return[r.scalar(Zf("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(Zf("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":let i=Zf("x",e,t,n),s=Zf("data",e,t,n),o=Zf("message",e,t,n),l=Zf("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<s.length;e++)console.log(Array.prototype.slice.call(s[e].dataSync()).slice(0,l));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"logical":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Equal":return[r.equal(Zf("a",e,t,n),Zf("b",e,t,n))];case"NotEqual":return[r.notEqual(Zf("a",e,t,n),Zf("b",e,t,n))];case"Greater":return[r.greater(Zf("a",e,t,n),Zf("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(Zf("a",e,t,n),Zf("b",e,t,n))];case"Less":return[r.less(Zf("a",e,t,n),Zf("b",e,t,n))];case"LessEqual":return[r.lessEqual(Zf("a",e,t,n),Zf("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(Zf("a",e,t,n),Zf("b",e,t,n))];case"LogicalNot":return[r.logicalNot(Zf("a",e,t,n))];case"LogicalOr":return[r.logicalOr(Zf("a",e,t,n),Zf("b",e,t,n))];case"Select":case"SelectV2":return[r.where(Zf("condition",e,t,n),Zf("a",e,t,n),Zf("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(Zf("a",e,t,n),Zf("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"matrices":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(Zf("a",e,t,n),Zf("b",e,t,n),Zf("transposeA",e,t,n),Zf("transposeB",e,t,n))];case"Einsum":return[r.einsum(Zf("equation",e,t,n),...Zf("tensors",e,t,n))];case"Transpose":return[r.transpose(Zf("x",e,t,n),Zf("perm",e,t,n))];case"_FusedMatMul":let[a,i]=Zf("fusedOps",e,t,n),s="biasadd"===a,o="prelu"===i,l=Zf("numArgs",e,t,n),u=Zf("leakyreluAlpha",e,t,n);if(s){if(o&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[d,c]=Zf("args",e,t,n);return[r.fused.matMul({a:Zf("a",e,t,n),b:Zf("b",e,t,n),transposeA:Zf("transposeA",e,t,n),transposeB:Zf("transposeB",e,t,n),bias:d,activation:i,preluActivationWeights:c,leakyreluAlpha:u})];case"MatrixBandPart":return[r.linalg.bandPart(Zf("a",e,t,n),Zf("numLower",e,t,n),Zf("numUpper",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"normalization":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(Zf("x",e,t,n),Zf("axis",e,t,n),Zf("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(Zf("x",e,t,n),Zf("mean",e,t,n),Zf("variance",e,t,n),Zf("offset",e,t,n),Zf("scale",e,t,n),Zf("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(Zf("x",e,t,n),Zf("radius",e,t,n),Zf("bias",e,t,n),Zf("alpha",e,t,n),Zf("beta",e,t,n))];case"Softmax":return[r.softmax(Zf("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(Zf("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"ragged":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"RaggedGather":{let{outputNestedSplits:a,outputDenseValues:i}=r.raggedGather(Zf("paramsNestedSplits",e,t,n),Zf("paramsDenseValues",e,t,n),Zf("indices",e,t,n),Zf("outputRaggedRank",e,t,n));return a.concat(i)}case"RaggedRange":{let{rtNestedSplits:a,rtDenseValues:i}=r.raggedRange(Zf("starts",e,t,n),Zf("limits",e,t,n),Zf("splits",e,t,n));return[a,i]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(Zf("shape",e,t,n),Zf("values",e,t,n),Zf("defaultValue",e,t,n),Zf("rowPartitionTensors",e,t,n),Zf("rowPartitionTypes",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"reduction":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Max":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.max(Zf("x",e,t,n),a,i)]}case"Mean":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.mean(Zf("x",e,t,n),a,i)]}case"Min":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.min(Zf("x",e,t,n),a,i)]}case"Sum":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.sum(Zf("x",e,t,n),a,i)]}case"All":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.all(Zf("x",e,t,n),a,i)]}case"Any":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.any(Zf("x",e,t,n),a,i)]}case"ArgMax":{let a=Zf("axis",e,t,n);return[r.argMax(Zf("x",e,t,n),a)]}case"ArgMin":{let a=Zf("axis",e,t,n);return[r.argMin(Zf("x",e,t,n),a)]}case"Prod":{let a=Zf("axis",e,t,n),i=Zf("keepDims",e,t,n);return[r.prod(Zf("x",e,t,n),a,i)]}case"Cumprod":{let a=Zf("axis",e,t,n),i=Zf("exclusive",e,t,n),s=Zf("reverse",e,t,n);return[r.cumprod(Zf("x",e,t,n),a,i,s)]}case"Cumsum":{let a=Zf("axis",e,t,n),i=Zf("exclusive",e,t,n),s=Zf("reverse",e,t,n);return[r.cumsum(Zf("x",e,t,n),a,i,s)]}case"Bincount":let a=Zf("x",e,t,n),i=Zf("weights",e,t,n),s=Zf("size",e,t,n);return[r.bincount(a,i,s)];case"DenseBincount":{let a=Zf("x",e,t,n),i=Zf("weights",e,t,n),s=Zf("size",e,t,n),o=Zf("binaryOutput",e,t,n);return[r.denseBincount(a,i,s,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"slice_join":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"ConcatV2":case"Concat":{let a=Zf("n",e,t,n),i=Zf("axis",e,t,n),s=Zf("tensors",e,t,n);return s=s.slice(0,a),[r.concat(s,i)]}case"Gather":{let a=Zf("x",e,t,n),i=Zf("indices",e,t,n);return[r.gather(a,r.cast(i,"int32"),0)]}case"GatherV2":{let a=Zf("axis",e,t,n),i=Zf("batchDims",e,t,n),s=Zf("x",e,t,n),o=Zf("indices",e,t,n);return[r.gather(s,r.cast(o,"int32"),a,i)]}case"Reverse":{let a=Zf("dims",e,t,n),i=[];for(let e=0;e<a.length;e++)a[e]&&i.push(e);let s=Zf("x",e,t,n);return[r.reverse(s,i)]}case"ReverseV2":{let a=Zf("axis",e,t,n),i=Zf("x",e,t,n);return[r.reverse(i,a)]}case"Slice":{let a=Zf("begin",e,t,n),i=Zf("size",e,t,n);return[r.slice(Zf("x",e,t,n),a,i)]}case"StridedSlice":{let a=Zf("begin",e,t,n),i=Zf("end",e,t,n),s=Zf("strides",e,t,n),o=Zf("beginMask",e,t,n),l=Zf("endMask",e,t,n),u=Zf("ellipsisMask",e,t,n),d=Zf("newAxisMask",e,t,n),c=Zf("shrinkAxisMask",e,t,n),h=Zf("x",e,t,n);return[r.stridedSlice(h,a,i,s,o,l,u,d,c)]}case"Pack":return eo((()=>{let a=Zf("axis",e,t,n),i=Zf("tensors",e,t,n),s=i[0].shape,o=r.squeeze(i[0]).shape,l=i.map((e=>{let t=Sa.arraysEqual(e.shape,s);if(!t&&!Sa.arraysEqual(r.squeeze(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,s)}));return[r.stack(l,a)]}));case"Unpack":{let a=Zf("axis",e,t,n),i=Zf("tensor",e,t,n);return r.unstack(i,a)}case"Tile":{let a=Zf("reps",e,t,n);return[r.tile(Zf("x",e,t,n),a)]}case"Split":case"SplitV":{let a=Zf("axis",e,t,n),i=Zf("numOrSizeSplits",e,t,n),s=Zf("x",e,t,n);return r.split(s,i,a)}case"ScatterNd":{let a=Zf("indices",e,t,n),i=Zf("values",e,t,n),s=Zf("shape",e,t,n);return[r.scatterND(a,i,s)]}case"GatherNd":{let a=Zf("x",e,t,n),i=Zf("indices",e,t,n);return[r.gatherND(a,i)]}case"SparseToDense":{let a=Zf("sparseIndices",e,t,n),i=Zf("outputShape",e,t,n),s=Zf("sparseValues",e,t,n),o=Zf("defaultValue",e,t,n);return[r.sparseToDense(a,s,i,s.dtype===o.dtype?o:r.cast(o,s.dtype))]}case"TensorScatterUpdate":{let a=Zf("indices",e,t,n),i=Zf("values",e,t,n),s=Zf("tensor",e,t,n);return[r.tensorScatterUpdate(s,a,i)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"sparse":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"SparseFillEmptyRows":{let{outputIndices:a,outputValues:i,emptyRowIndicator:s,reverseIndexMap:o}=r.sparse.sparseFillEmptyRows(Zf("indices",e,t,n),Zf("values",e,t,n),Zf("denseShape",e,t,n),Zf("defaultValue",e,t,n));return[a,i,s,o]}case"SparseReshape":{let{outputIndices:a,outputShape:i}=r.sparse.sparseReshape(Zf("inputIndices",e,t,n),Zf("inputShape",e,t,n),Zf("newShape",e,t,n));return[a,i]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(Zf("data",e,t,n),Zf("indices",e,t,n),Zf("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(Zf("data",e,t,n),Zf("indices",e,t,n),Zf("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"spectral":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"FFT":return[r.fft(Zf("x",e,t,n))];case"IFFT":return[r.ifft(Zf("x",e,t,n))];case"RFFT":return[r.rfft(Zf("x",e,t,n))];case"IRFFT":return[r.irfft(Zf("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"string":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(Zf("input",e,t,n),Zf("pattern",e,t,n),Zf("rewrite",e,t,n),Zf("replaceGlobal",e,t,n))];case"StringNGrams":{let{nGrams:a,nGramsSplits:i}=r.string.stringNGrams(Zf("data",e,t,n),Zf("dataSplits",e,t,n),Zf("separator",e,t,n),Zf("nGramWidths",e,t,n),Zf("leftPad",e,t,n),Zf("rightPad",e,t,n),Zf("padWidth",e,t,n),Zf("preserveShortSequences",e,t,n));return[a,i]}case"StringSplit":{let{indices:a,values:i,shape:s}=r.string.stringSplit(Zf("input",e,t,n),Zf("delimiter",e,t,n),Zf("skipEmpty",e,t,n));return[a,i,s]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(Zf("input",e,t,n),Zf("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"transformation":return a((()=>((e,t,n,r=ry)=>{switch(e.op){case"Cast":return[r.cast(Zf("x",e,t,n),Zf("dtype",e,t,n))];case"ExpandDims":{let a=Zf("axis",e,t,n);return[r.expandDims(Zf("x",e,t,n),a)]}case"Squeeze":{let a=Zf("axis",e,t,n);return[r.squeeze(Zf("x",e,t,n),a)]}case"Reshape":return[r.reshape(Zf("x",e,t,n),Zf("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(Zf("x",e,t,n),Zf("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(Zf("x",e,t,n),Zf("padding",e,t,n),Zf("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(Zf("x",e,t,n),Zf("padding",e,t,n),Zf("constantValue",e,t,n))];case"SpaceToBatchND":{let a=Zf("blockShape",e,t,n),i=Zf("paddings",e,t,n);return[r.spaceToBatchND(Zf("x",e,t,n),a,i)]}case"BatchToSpaceND":{let a=Zf("blockShape",e,t,n),i=Zf("crops",e,t,n);return[r.batchToSpaceND(Zf("x",e,t,n),a,i)]}case"DepthToSpace":{let a=Zf("blockSize",e,t,n),i=Zf("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(Zf("x",e,t,n),a,i)]}case"BroadcastTo":return[r.broadcastTo(Zf("x",e,t,n),Zf("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(Zf("s0",e,t,n),Zf("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"hash_table":return hy(e,t,n,r);case"custom":let i=Xf(e.op);if(i&&i.customExecutor)return i.customExecutor(new class{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((e=>this.getInput(e))),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce(((e,t)=>(e[t]=this.getAttr(t),e)),{}))}getInput(e){return Yf(e,this.tensorMap,this.context)}getAttr(e,t){let n=this.node.rawAttrs[e];if(null!=n.tensor)return Yf(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Gg(this.node.rawAttrs,e,t);if(null!=n.s)return jg(this.node.rawAttrs,e,t);if(null!=n.b)return Hg(this.node.rawAttrs,e,t);if(null!=n.shape)return Jg(this.node.rawAttrs,e,t);if(null!=n.type)return Kg(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Qg(this.node.rawAttrs,e,t);if(null!=n.list.s)return ey(this.node.rawAttrs,e,t);if(null!=n.list.shape)return ty(this.node.rawAttrs,e,t);if(null!=n.list.b)return ny(this.node.rawAttrs,e,t);if(null!=n.list.type)return Zg(this.node.rawAttrs,e,t)}return t}}(e,t,n));throw TypeError(`Custom op ${e.op} is not registered.`);default:throw TypeError(`Unknown op '${e.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return Sa.isPromise(i)?i.then((e=>[].concat(e))):[].concat(i)}var my=class{constructor(e={},t={},n={},r={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let e=[];for(let t=0;t<this.contexts.length-1;t++){let n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map((e=>0===e.id&&0===e.iterationId?"":`${e.frameName}-${e.iterationId}`)).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;let e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(let t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(let t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}};function fy(e,t,n,r){let a=new Set,i=[],s=null,o=null,l=new Set,u=new Set(Object.keys(e).map((e=>tg(e)[0])));r=r||[];let d=new Set(r.map((e=>tg(e.name)[0]))),c=[...t];for(;c.length>0;){let e=c.pop();if((Ay(e)||vy(e)||wy(e))&&null==s&&(s=e,o=s.children.map((e=>e.name)).filter((e=>a.has(e)))),a.add(e.name),null==n[e.name]&&!u.has(e.name)&&!d.has(e.name)){if(0===e.inputs.length){i.push(e.name);continue}e.inputs.forEach((e=>{l.has(e.name)||(l.add(e.name),c.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:s,syncInputs:o}}var gy=class extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}},yy=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),by=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),xy=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Ay(e){return yy.has(e.op)}function vy(e){return by.has(e.op)}function wy(e){return xy.has(e.op)}var ky=class{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){let t=Object.keys(e).map((t=>e[t].map((e=>e.id))));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((e=>e.signatureKey||e.name))}get outputNodes(){return this._outputs.map((e=>{let t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t}))}get functions(){return Object.keys(this._functions).reduce(((e,t)=>(e[t]=this._functions[t].signature,e)),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach((t=>{this._functionExecutorMap[t]=new ky(e.functions[t],this)}))}getCompilationKey(e,t){let n=e.map((e=>e.name)).sort(),r=t.map((e=>e.name)).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){let n=fy(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:a,syncInputs:i}=n;if(null!=a)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(r.length>0){let n=t.map((e=>e.name)),a=Object.keys(e);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${a}]. Missing the following inputs: [${r}]`)}let s=function(e,t){let{usedNodes:n,inputs:r}=t,a=Object.keys(r).map((e=>tg(e)[0])).map((t=>e.nodes[t])),i=e.initNodes||[],s=e=>n.has("string"==typeof e?e:e.name);function o(e){return[...new Map(e.map((e=>[e.name,e]))).values()]}let l=o([...a,...e.weights,...i]).filter(s),u=o([...l,...Object.values(e.nodes)]).filter(s),d=new Map(u.map((e=>[e.name,e]))),c={};for(let e of u){c[e.name]=c[e.name]||0;for(let t of e.children)s(t)||(c[t.name]=Number.POSITIVE_INFINITY),c[t.name]=(c[t.name]||0)+1}let h=Object.entries(c).filter((([,e])=>0===e)).map((([e])=>e)),p=[...h];for(;h.length>0;){let e=h.pop(),t=d.get(e);for(let e of t.children.filter(s))0==--c[e.name]&&(p.push(e.name),h.push(e.name))}let m=function(e,t){let n=new Map(e.map((e=>[e.name,e]))),r=t.map((e=>e.name)),a=new Set(r);for(;r.length>0;){let e=r.pop(),t=n.get(e);for(let e of t.children)!n.has(e.name)||a.has(e.name)||(a.add(e.name),r.push(e.name))}return e.filter((e=>a.has(e.name)))}(p.map((e=>d.get(e))),l);return function(e,t){let n=new Map(e.map(((e,t)=>[e.name,t]))),r=new Set(t.map((e=>e.name))),a=e=>r.has("string"==typeof e?e:e.name),i=new Set(e.map((e=>e.name))),s=e=>i.has("string"==typeof e?e:e.name);for(let t of e){for(let e of t.children.filter(s)){if(!n.has(e.name))throw new gy(`Child ${e.name} of node ${t.name} is unreachable.`);if(n.get(t.name)>n.get(e.name))throw new gy(`Node ${t.name} is scheduled to run after its child ${e.name}.`)}if(!a(t))for(let e of t.inputs){if(!n.has(e.name))throw new gy(`Input ${e.name} of node ${t.name} is unreachable.`);if(n.get(e.name)>n.get(t.name))throw new gy(`Node ${t.name} is scheduled to run before its input ${e.name}.`)}}}(m,l),m}(this.graph,n),o=function(e){let t=new Map(e.map(((e,t)=>[e.name,t]))),n=Number.MAX_SAFE_INTEGER,r=e.map(((e,t)=>Ay(e)?n:t)),a=e=>{let n=r[t.get(e.name)];return null==n?-1:n},i=e.map(((e,t)=>e.children.map(a).reduce(((e,t)=>Math.max(e,t)),r[t]))),s=new Map;for(let t=0;t<e.length;++t){let r=i[t];if(r===n)continue;let a=e[t],o=e[r];s.has(o.name)||s.set(o.name,[]),s.get(o.name).push(a)}return s}(s);return{orderedNodes:s,nodeLiveUntilMap:o}}cloneAndKeepTensor(e){if(null==e)return null;let t=e.clone();return no(t),t}cloneTensorList(e){return e?e.map((e=>this.cloneAndKeepTensor(e))):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,this.cloneTensorList(t)])))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);let n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);let r=n.map((e=>this.graph.nodes[tg(e)[0]])),a=t.map((e=>tg(e)[0])),i=new Set(a),s=a.map((e=>this.graph.nodes[e]));0===s.length&&(s=this._outputs);let o=this.getCompilationKey(r,s),l=this.compiledMap.get(o);null==l&&(l=this.compile(e,s),this.compiledMap.set(o,l));try{this.keepIntermediateTensors=Ue().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e){this.keepIntermediateTensors=!1,console.warn(e.message)}let u={},d={};return eo((()=>{let n=new my(this.weightMap,u,d,this.functionExecutorMap,this.parseNodeNameCache),r=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach((t=>{let[a,i]=tg(t,n),s=[];s[i]=e[t],r[a]=s,this.keepIntermediateTensors&&(this.clonedTensorsMap[a]=this.cloneTensorList(s))}));let a=this.getFrozenTensorIds(r),{orderedNodes:s,nodeLiveUntilMap:o}=l;for(let e of s){if(r[e.name])continue;let t=py(e,r,n,this._resourceManager);if(Sa.isPromise(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.keepIntermediateTensors&&(this.clonedTensorsMap[e.name]=this.cloneTensorList(t)),this.checkTensorForDisposalWithNodeLiveUntilInfo(e,r,n,a,i,o.get(e.name))}return null==this.parent&&n.dispose(a),t.map((e=>Yf(e,r,n)))}))}getFrozenTensorIds(e){let t=[].concat.apply([],Object.keys(e).map((t=>e[t])).map((e=>e.map((e=>e.id)))));return new Set(t)}checkTensorForDisposal(e,t,n,r,a,i,s){if(!Ay(t)&&!i.has(e)){for(let r of n[e])null!=r&&(s[r.id]=(s[r.id]||0)+t.children.length);for(let e of t.inputs){if(Ay(e))continue;let t=Jf(e.name,n,r);if(null!=t)for(let e of t){if(!e||e.kept||a.has(e.id))continue;let t=s[e.id];1===t?(e.dispose(),delete s[e.id]):null!=t&&s[e.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,n,r,a,i){function s(e){return Ay(e)||a.has(e.name)}if(!Ay(e)&&null!=i)for(let e of i){if(s(e))continue;let a=Jf(e.name,t,n);for(let e of a)!e||e.kept||r.has(e.id)||e.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((e=>{for(let t of e)t&&!t.isDisposed&&t.dispose()})),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,n=!1,r={},a={}){this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Ue().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e){this.keepIntermediateTensors=!1,console.warn(e.message)}let i=new my(this.weightMap,r,a,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let s=await this.executeWithControlFlow(e,i,t,n),o=t.map((e=>Yf(e,s,i))),l=o.map((e=>e.id)),u=Object.keys(e).map((t=>e[t].id)),d=new Set([...l,...u,...this.weightIds]);return Object.values(s).forEach((e=>{e.forEach((e=>{e&&!e.isDisposed&&!d.has(e.id)&&e.dispose()}))})),null==this.parent&&i.dispose(d),o}async executeFunctionAsync(e,t,n){let r=e.reduce(((e,t,n)=>(e[this.inputs[n].name]=t,e)),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){let a=Object.keys(e),i=a.map((e=>this.graph.nodes[tg(e)[0]])),s=n.map((e=>tg(e)[0])),o=new Set(s),l=s.map((e=>this.graph.nodes[e]));0===l.length&&(l=this._outputs);let{usedNodes:u,missingInputs:d,dynamicNode:c,syncInputs:h}=fy(e,l,this.weightMap,this._initNodes),p=[...i,...this.graph.weights,...this._initNodes||[]].map((e=>({node:e,contexts:t.currentContext}))),m=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{let[n,r]=tg(t),a=[];a[r]=e[t],m[n]=a}));let f={},g=this.getFrozenTensorIds(m),y={};for(;p.length>0;){let e=this.processStack(i,p,t,m,y,g,o,f,u);await Promise.all(e)}null==c&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let b=l.filter((e=>!Ay(e)&&!Yf(e.name,m,t))).map((e=>e.name));if(b.length>0){let e="";throw null!=c&&(e=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${a}]. Consider providing the following inputs: [${d}]. ${e}`)}return m}processStack(e,t,n,r,a,i,s,o,l){let u=[];for(;t.length>0;){let e=t.pop();n.currentContext=e.contexts;let d="";if("Enter"===e.node.op&&Zf("isConstant",e.node,r,n)&&([d]=Qf(e.node.name,n)),null==r[e.node.name]){let c=py(e.node,r,n,this._resourceManager);d||([d]=Qf(e.node.name,n));let h=n.currentContext;Sa.isPromise(c)?u.push(c.then((u=>(r[d]=u,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(u)),n.currentContext=h,this.checkTensorForDisposal(d,e.node,r,n,i,s,o),this.processChildNodes(e.node,t,n,r,a,l),u)))):(r[d]=c,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(c)),this.checkTensorForDisposal(d,e.node,r,n,i,s,o),this.processChildNodes(e.node,t,n,r,a,l))}else this.processChildNodes(e.node,t,n,r,a,l)}return u}processChildNodes(e,t,n,r,a,i){e.children.forEach((e=>{let[s]=Qf(e.name,n);a[s]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((e=>!!Yf(e,r,n)))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((e=>!!Yf(e,r,n)))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}dispose(){Object.keys(this.weightMap).forEach((e=>this.weightMap[e].forEach((e=>e.dispose()))))}checkInputShapeAndType(e){Object.keys(e).forEach((t=>{let n=e[t],[r]=tg(t),a=this.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){let e=a.attrParams.shape.value,t=e.length===n.shape.length&&n.shape.every(((t,n)=>-1===e[n]||e[n]===t));Sa.assert(t,(()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${e}], but was [${n.shape}]`))}a.attrParams.dtype&&a.attrParams.dtype.value&&Sa.assert(n.dtype===a.attrParams.dtype.value,(()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(e){var t,n;let r={};for(let a in e){let i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}checkInputs(e){let t=Object.keys(e).filter((e=>{let[t]=tg(e);return null==this.graph.nodes[t]}));if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map((e=>{var t,n;let r=null===(n=null===(t=this._signature)||void 0===t?void 0:t.outputs)||void 0===n?void 0:n[e];return null!=r?r.name:e}),{})}checkOutputs(e){e.forEach((e=>{let[t]=tg(e);if(!this.graph.nodes[t])throw new Error(`The output '${e}' is not found in the graph`)}))}},Sy="?tfjs-format=file",Ty="model.json",_y=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},n=Np){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,null==t&&(this.loadOptions={}),this.resourceManager=new class{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(let e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(let e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}}findIOHandler(){let e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{let t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let e=this.handler.load();return Sa.isPromise(e)?e.then((e=>this.loadSync(e))):this.loadSync(e)}loadSync(e){this.artifacts=e;let t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){let e=this.artifacts.userDefinedMetadata;null!=e.signature&&(n=e.signature),null!=e.structuredOutputKeys&&(this.structuredOutputKeys=e.structuredOutputKeys)}this.signature=n,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;let r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new ky(Wg.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){let t=Wg.Instance.transformGraph(e.modelInitializer);this.initializer=new ky(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if("string"==typeof e){let t=this.io.getSaveHandlers(e);if(0===t.length)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Error(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){let t={};return(e instanceof si?[e]:e).forEach(((e,n)=>t[this.structuredOutputKeys[n]]=e)),t}return e}predict(e,t){let n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){let n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof si||Array.isArray(e))){let n=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=n)for(let t in n){let r=n[t];null!=r.resourceId&&(e[t]=this.resourceIdToCapturedInput[r.resourceId])}return e}e=Array.isArray(e)?e:[e];let n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce(((t,n)=>{var a,i,s;let o=null===(s=null===(i=null===(a=this.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[n])||void 0===s?void 0:s.resourceId;return t[n]=null!=o?this.resourceIdToCapturedInput[o]:e[r++],t}),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){let t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){let a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}}execute(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce(((t,n)=>(t[n]=[e[n]],t)),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&to(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};async function Iy(e,t={},n=Np){if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&"string"==typeof e&&(e=function(e){return e.endsWith("/")||(e+="/"),`${e}${Ty}${Sy}`}(e));let r=new _y(e,t,n);return await r.load(),r}function Cy(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let t;if(e instanceof Array){let[n,r]=e;if(!n)throw new Error("modelJSON must be the first element of the array");if(!(r&&r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");let a=Np.getWeightSpecs(n.weightsManifest),i=Np.getModelArtifactsForJSONSync(n,a,r);t=Np.fromMemorySync(i)}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=Np.fromMemorySync(e)}let n=new _y(t);return n.load(),n}var Ey="4.7.0";function Ny(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Sa.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the CPU backend.`))}))}var Ry=Hf.whereImpl,Py=class extends W{nextDataId(){return Py.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new U(this,Ys())}write(e,t,n){this.firstUse&&(this.firstUse=!1,Ue().get("IS_NODE")&&$m.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));let r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&Sa.isString(n[0])){let a=n.map((e=>Sa.encodeString(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){this.data.get(e).refCount++}decRef(e){this.data.has(e)&&this.data.get(e).refCount--}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){let e=this.readSync(n.real.dataId),t=this.readSync(n.imag.dataId);return $m.mergeRealAndImagArrays(e,t)}return Sa.convertBackendValuesAndArrayBuffer(this.data.get(e).values,t)}bufferSync(e){let t=this.readSync(e.dataId);if("string"===e.dtype)try{let n=t.map((e=>Sa.decodeString(e)));return Ws(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ws(e.shape,e.dtype,t)}makeOutput(e,t,n){return Ys().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let t=Sa.now();return e(),{kernelMs:Sa.now()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ny([e],"where");let t=this.readSync(e.dataId);return Ry(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}};Py.nextDataId=0;var Dy={};function My(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}x(Dy,{addImpl:()=>Ky,bincountImpl:()=>Qy,bincountReduceImpl:()=>eb,bitwiseAndImpl:()=>tb,castImpl:()=>jy,ceilImpl:()=>ob,concatImpl:()=>db,equalImpl:()=>cb,expImpl:()=>mb,expm1Impl:()=>yb,floorDivImpl:()=>kb,floorImpl:()=>Ab,gatherNdImpl:()=>_b,gatherV2Impl:()=>Ib,greaterEqualImpl:()=>Rb,greaterImpl:()=>Cb,lessEqualImpl:()=>Fb,lessImpl:()=>Mb,linSpaceImpl:()=>Bb,logImpl:()=>Ub,maxImpl:()=>jb,maximumImpl:()=>Hb,minimumImpl:()=>Xb,multiplyImpl:()=>Yb,negImpl:()=>tx,notEqualImpl:()=>rx,prodImpl:()=>ux,raggedGatherImpl:()=>hx,raggedRangeImpl:()=>mx,raggedTensorToTensorImpl:()=>xx,rangeImpl:()=>Ax,rsqrtImpl:()=>vx,scatterImpl:()=>Sx,sigmoidImpl:()=>Tx,simpleAbsImpl:()=>My,sliceImpl:()=>Cx,sparseFillEmptyRowsImpl:()=>Rx,sparseReshapeImpl:()=>Px,sparseSegmentReductionImpl:()=>Dx,sqrtImpl:()=>Mx,squaredDifferenceImpl:()=>Fx,staticRegexReplaceImpl:()=>Bx,stridedSliceImpl:()=>Vx,stringNGramsImpl:()=>Hx,stringSplitImpl:()=>qx,stringToHashBucketFastImpl:()=>Xx,subImpl:()=>Kx,tileImpl:()=>Qx,topKImpl:()=>nA,transposeImpl:()=>sx,uniqueImpl:()=>rA});var Oy={kernelName:Ge,backendName:"cpu",kernelFunc:e=>{let{x:t}=e.inputs,n=e.backend;Ny(t,"abs");let r=new Float32Array(Sa.sizeFromShape(t.shape));return r=My(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function $y(e){return(t,n,r,a,i)=>{let s=$m.assertAndGetBroadcastShape(t,n),o=s.length,l=Sa.computeStrides(s),u=Sa.sizeFromShape(s),d=Sa.getTypedArrayFromDType(i,u),c=t.length,h=n.length,p=Sa.computeStrides(t),m=Sa.computeStrides(n),f=$m.getBroadcastDims(t,s),g=$m.getBroadcastDims(n,s);if(f.length+g.length===0)for(let t=0;t<d.length;++t)d[t]=e(r[t%r.length],a[t%a.length]);else for(let t=0;t<d.length;++t){let n=Sa.indexToLoc(t,o,l),i=n.slice(-c);f.forEach((e=>i[e]=0));let s=Sa.locToIndex(i,c,p),u=n.slice(-h);g.forEach((e=>u[e]=0));let y=Sa.locToIndex(u,h,m);d[t]=e(r[s],a[y])}return[d,s]}}function Fy(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",s)},o}var Ly={kernelName:xt,backendName:"cpu",kernelFunc:Fy};function zy(e,t,n="float32"){if("complex64"===n)return Fy({inputs:{real:zy(e,t,"float32"),imag:zy(e,t,"float32")},backend:e});let r=Sa.makeZerosTypedArray(Sa.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function By(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Uy={kernelName:un,backendName:"cpu",kernelFunc:By};function Wy(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Vy={kernelName:or,backendName:"cpu",kernelFunc:Wy};function jy(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){let r=Sa.toTypedArray([0],n),[a,i]=$y(((e,t)=>e!==t?1:0))(t,[],e,r,"bool");return[i,"bool",a]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Hy(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:i}=r;if("complex64"===i){if("complex64"===a.dtype)return By({inputs:{x:a},backend:n});let e=zy(n,a.shape,a.dtype),t=Hy({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=Fy({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){let e=Wy({inputs:{input:a},backend:n}),t=Hy({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!Sa.hasEncodingLoss(a.dtype,i)){let e=By({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}let s=n.data.get(a.dataId).values,[o,l,u]=jy(s,a.shape,a.dtype,i);return n.makeTensorInfo(o,l,u)}var Gy={kernelName:gt,backendName:"cpu",kernelFunc:Hy};function qy(e,t,n,r){return null==n?({inputs:n,backend:a})=>{let{a:i,b:s}=n,o=a;Ny([i,s],e);let l=o.data.get(i.dataId).values,u=o.data.get(s.dataId).values,d="string"===i.dtype?$m.fromUint8ToStringArray(l):l,c="string"===i.dtype?$m.fromUint8ToStringArray(u):u,h=r||i.dtype,[p,m]=t(i.shape,s.shape,d,c,h);return o.makeTensorInfo(m,h,p)}:({inputs:e,backend:a})=>{let{a:i,b:s}=e,o=a;if("complex64"===i.dtype||"complex64"===s.dtype){let e=Hy({inputs:{x:i},backend:o,attrs:{dtype:"complex64"}}),t=o.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,l=o.data.get(r.dataId).values,u=o.data.get(a.dataId).values,d=Hy({inputs:{x:s},backend:o,attrs:{dtype:"complex64"}}),c=o.data.get(d.dataId),h=c.complexTensorInfos.real,p=c.complexTensorInfos.imag,m=o.data.get(h.dataId).values,f=o.data.get(p.dataId).values,[g,y,b]=n(i.shape,s.shape,l,u,m,f),x=o.makeTensorInfo(b,"float32",g),A=o.makeTensorInfo(b,"float32",y),v=Fy({inputs:{real:x,imag:A},backend:o});return o.disposeIntermediateTensorInfo(e),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(A),v}{let e=o.data.get(i.dataId).values,n=o.data.get(s.dataId).values,a=r||i.dtype,[l,u]=t(i.shape,s.shape,e,n,a);return o.makeTensorInfo(u,a,l)}}}function Xy(e){return(t,n,r,a,i,s)=>{let o=$m.assertAndGetBroadcastShape(t,n),l=Sa.sizeFromShape(o),u=o.length,d=Sa.computeStrides(o),c=Sa.getTypedArrayFromDType("float32",l),h=Sa.getTypedArrayFromDType("float32",l),p=$m.getBroadcastDims(t,o),m=$m.getBroadcastDims(n,o),f=$m.mergeRealAndImagArrays(r,a),g=$m.mergeRealAndImagArrays(i,s),y=t.length,b=Sa.computeStrides(t),x=n.length,A=Sa.computeStrides(n);if(p.length+m.length===0)for(let t=0;t<c.length;t++){let n=t%f.length,r=t%g.length,a=e(f[2*n],f[2*n+1],g[2*r],g[2*r+1]);c[t]=a.real,h[t]=a.imag}else for(let t=0;t<c.length;t++){let n=Sa.indexToLoc(t,u,d),r=n.slice(-y);p.forEach((e=>r[e]=0));let a=Sa.locToIndex(r,y,b),i=n.slice(-x);m.forEach((e=>i[e]=0));let s=Sa.locToIndex(i,x,A),o=e(f[2*a],f[2*a+1],g[2*s],g[2*s+1]);c[t]=o.real,h[t]=o.imag}return[c,h,o]}}var Ky=$y(((e,t)=>e+t)),Zy=Xy(((e,t,n,r)=>({real:e+n,imag:t+r}))),Yy=qy(Ke,Ky,Zy),Jy={kernelName:Ke,backendName:"cpu",kernelFunc:Yy};function Qy(e,t,n,r,a){let i=Sa.sizeFromShape(r),s=Sa.makeZerosTypedArray(a,n);for(let n=0;n<e.length;n++){let r=e[n];if(r<0)throw new Error("Input x must be non-negative!");r>=a||(s[r]+=i>0?t[n]:1)}return s}function eb(e,t,n,r=!1){let a=e.shape[0],i=e.shape[1],s=Ws([a,n],t.dtype);for(let o=0;o<a;o++)for(let a=0;a<i;a++){let i=e.get(o,a);if(i<0)throw new Error("Input x must be non-negative!");i>=n||(r?s.set(1,o,i):t.size>0?s.set(s.get(o,i)+t.get(o,a),o,i):s.set(s.get(o,i)+1,o,i))}return s}var tb=$y(((e,t)=>e&t)),nb=qy(pt,tb),rb={kernelName:pt,backendName:"cpu",kernelFunc:nb};function ab(e){return(t,n,r)=>{let a=Sa.getArrayFromDType(n,t.length);for(let n=0;n<t.length;++n)a[n]=e(t[n],r);return a}}function ib(e,t,n){return sb(e,ab(t),n)}function sb(e,t,n){return({inputs:r,attrs:a,backend:i})=>{let{x:s}=r;Ny(s,e);let o,l=i,u=l.data.get(s.dataId).values;if("string"===s.dtype){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");o=$m.fromUint8ToStringArray(u)}else o=u;let d=n||s.dtype,c=t(o,d,a);return l.makeTensorInfo(s.shape,d,c)}}var ob=ab((e=>Math.ceil(e))),lb=sb(yt,ob),ub={kernelName:yt,backendName:"cpu",kernelFunc:lb};function db(e,t,n,r){let a=Sa.getArrayFromDType(n,Sa.sizeFromShape(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{let n=Sa.sizeFromShape(e.shape);a.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{let i="string"===n?$m.fromUint8ToStringArray(e.vals):e.vals,s=0;for(let n=0;n<e.shape[0];++n){let o=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[o+t]=i[s++]}r+=e.shape[1]}))}return a}var cb=$y(((e,t)=>e===t?1:0)),hb=qy(Xt,cb,null,"bool"),pb={kernelName:Xt,backendName:"cpu",kernelFunc:hb},mb=ab((e=>Math.exp(e))),fb=sb(Kt,mb,"float32"),gb={kernelName:Kt,backendName:"cpu",kernelFunc:fb},yb=ab((e=>Math.expm1(e))),bb=sb(Yt,yb),xb={kernelName:Yt,backendName:"cpu",kernelFunc:bb},Ab=ab((e=>Math.floor(e))),vb=sb(tn,Ab),wb={kernelName:tn,backendName:"cpu",kernelFunc:vb},kb=$y(((e,t)=>Math.floor(e/t))),Sb=qy(nn,kb,null,"int32"),Tb={kernelName:nn,backendName:"cpu",kernelFunc:Sb};function _b(e,t,n,r,a,i,s,o,l){let u=Ws([r,i],n);for(let n=0;n<r;n++){let r=[],d=0;for(let t=0;t<a;t++){let i=e[n*a+t];d+=i*s[t],r.push(i)}if(d<0||d>=l/i)throw new Error(`Invalid indices: ${r} does not index into ${o}`);for(let e=0;e<i;e++)u.values[n*i+e]=t.get(...t.indexToLoc(d*i+e))}return u}function Ib(e,t,n){let r=Ws(n,e.dtype);for(let n=0;n<r.size;++n){let a=r.indexToLoc(n).slice(),i=a[0],s=a[2],o=t.locToIndex([i,s]);a[2]=t.values[o];let l=e.locToIndex(a);0<=l&&l<e.values.length&&(r.values[n]=e.values[l])}return r}var Cb=$y(((e,t)=>e>t?1:0)),Eb=qy(on,Cb,null,"bool"),Nb={kernelName:on,backendName:"cpu",kernelFunc:Eb},Rb=$y(((e,t)=>e>=t?1:0)),Pb=qy(ln,Rb,null,"bool"),Db={kernelName:ln,backendName:"cpu",kernelFunc:Pb},Mb=$y(((e,t)=>e<t?1:0)),Ob=qy(gn,Mb,null,"bool"),$b={kernelName:gn,backendName:"cpu",kernelFunc:Ob},Fb=$y(((e,t)=>e<=t?1:0)),Lb=qy(yn,Fb,null,"bool"),zb={kernelName:yn,backendName:"cpu",kernelFunc:Lb};function Bb(e,t,n){let r=(t-e)/(n-1),a=Sa.makeZerosTypedArray(n,"float32");a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+r;return a}var Ub=ab((e=>Math.log(e))),Wb=sb(xn,Ub),Vb={kernelName:xn,backendName:"cpu",kernelFunc:Wb};function jb(e,t,n,r){let a=Sa.getTypedArrayFromDType(r,Sa.sizeFromShape(n));for(let n=0;n<a.length;++n){let r=n*t,i=e[r];for(let n=0;n<t;++n){let t=e[r+n];(Number.isNaN(t)||t>i)&&(i=t)}a[n]=i}return a}var Hb=$y(((e,t)=>Math.max(e,t))),Gb=qy(Rn,Hb),qb={kernelName:Rn,backendName:"cpu",kernelFunc:Gb},Xb=$y(((e,t)=>Math.min(e,t))),Kb=qy(zn,Xb),Zb={kernelName:zn,backendName:"cpu",kernelFunc:Kb},Yb=$y(((e,t)=>e*t)),Jb=Xy(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),Qb=qy(Vn,Yb,Jb),ex={kernelName:Vn,backendName:"cpu",kernelFunc:Qb};function tx(e,t,n){let r=Sa.createScalarValue(-1,n);return Yb([],t,r,e,n)}var nx={kernelName:jn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t;Ny(r,"neg");let a=n.data.get(r.dataId).values,[i,s]=tx(a,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,i)}},rx=$y(((e,t)=>e!==t?1:0)),ax=qy(Hn,rx,null,"bool"),ix={kernelName:Hn,backendName:"cpu",kernelFunc:ax};function sx(e,t,n,r,a){let i=t.length,s=Sa.sizeFromShape(t),o=Sa.computeStrides(t),l=Sa.computeStrides(a),u=Sa.getTypedArrayFromDType(n,Sa.sizeFromShape(a));for(let t=0;t<s;++t){let n=Sa.indexToLoc(t,i,o),a=new Array(n.length);for(let e=0;e<a.length;e++)a[e]=n[r[e]];u[Sa.locToIndex(a,i,l)]=e[t]}return u}function ox(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:i}=n;Ny(a,"transpose");let s=a.shape.length,o=new Array(s);for(let e=0;e<o.length;e++)o[e]=a.shape[i[e]];let l=sx(r.data.get(a.dataId).values,a.shape,a.dtype,i,o);return{dataId:r.write(l,o,a.dtype),shape:o,dtype:a.dtype}}var lx={kernelName:Qr,backendName:"cpu",kernelFunc:ox};function ux(e,t,n,r){let[a,i]=$m.computeOutAndReduceShapes(e,r),s=gi(t,"int32"),o=Sa.makeZerosTypedArray(Sa.sizeFromShape(a),s),l=Sa.sizeFromShape(i);for(let e=0;e<o.length;++e){let t=e*l,r=1;for(let e=0;e<l;++e)r*=n[t+e];o[e]=r}return{outVals:o,outShape:a,outDtype:s}}var dx={kernelName:nr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;Ny(a,"prod");let o=a.shape.length,l=Sa.parseAxisParam(i,a.shape),u=$m.getAxesPermutation(l,o),d=l,c=a,h=[];null!=u&&(c=ox({inputs:{x:a},backend:n,attrs:{perm:u}}),h.push(c),d=$m.getInnerMostAxes(d.length,o));let p=n.data.get(c.dataId).values,{outVals:m,outShape:f,outDtype:g}=ux(c.shape,c.dtype,p,d),y=f;return s&&(y=$m.expandShapeToKeepDim(f,l)),h.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(y,g,m)}};function cx(e,t){let n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function hx(e,t,n,r,a,i,s,o){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach(((e,r)=>{if(e<0||e>=n){let a=Sa.indexToLoc(r,t.length,Sa.computeStrides(t)).join(",");throw new Error(`indices[${a}] = ${e} is not in [0, ${n})`)}}))}(i,s,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");let l=r[0],{outSplits:u,valueSlices:d,numValues:c}=function(e,t,n,r){let a=[],i=0,s=t.length-1+n.length,o=new Array(s).fill(null).map((()=>[0]));!function(e,t){for(let n=0;n<e.length;++n){let r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let e=0;e<t.length-1;++e){l*=t[e];let n=t[e+1];for(let t=1;t<l+1;++t)o[e].push(t*n)}for(let r=0;r<e.length;++r){let s=e[r],l=e[r]+1;for(let e=0;e<n.length;++e){let r=n[e],a=e+t.length-1;if(a>=0){let e=o[a],t=e[e.length-1]-r[s];for(let e=s;e<l;++e)o[a].push(r[e+1]+t)}s=r[s],l=r[l]}l!==s&&(a.push([s,l]),i+=l-s)}return{outSplits:o,valueSlices:a,numValues:i}}(i,s,e,l),h=function(e){let t=[];for(let n=0;n<e.length;++n){let r=e[n].length,a=Sa.getArrayFromDType("int32",r);t.push(a),e[n].forEach(((e,t)=>a[t]=e))}return t}(u),p=function(e,t,n,r,a){let i=t.slice();i[0]=a;let s=Sa.getArrayFromDType(n,Sa.sizeFromShape(i)),o=e.length;return function(e,t,n,r,a,i){let s=cx(t,2)[1],o=cx(i,2)[1],l=0;for(let t of n)for(let n=t[0];n<t[1];++n){for(let t=0;t<r;++t)a[l*o+t]=e[n*s+t];++l}}(e,t,r,0===o?0:o/t[0],s,i),[s,i]}(n,r,a,d,c);return[h,p[0],p[1]]}var px=2147483647;function mx(e,t,n,r,a,i,s){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");let o=0===t.length,l=0===a.length,u=0===s.length,d=[];o||d.push(t[0]),l||d.push(a[0]),u||d.push(s[0]);for(let e=1;e<d.length;++e)if(d[e]!==d[e-1])throw new Error("starts, limits, and deltas must have the same shape");let c=0===d.length?1:d[0],h=Sa.getArrayFromDType("int32",c+1);h[0]=0;for(let t=0;t<c;++t){let n,a=o?e[0]:e[t],s=l?r[0]:r[t],d=u?i[0]:i[t];if(0===d)throw new Error("Requires delta != 0");if(d>0&&s<a||d<0&&s>a)n=0;else if(n=Math.ceil(Math.abs((s-a)/d)),n>px)throw new Error(`Requires ((limit - start) / delta) <= ${px}`);h[t+1]=h[t]+n}let p=h[c],m=Sa.getArrayFromDType(n,p),f=0;for(let t=0;t<c;++t){let n=h[t+1]-h[t],r=o?e[0]:e[t],a=u?i[0]:i[t];for(let e=0;e<n;++e)m[f++]=r,r+=a}return[h,m]}var fx=$m.RowPartitionType,gx=class{constructor(e,t,n,r,a,i,s,o,l,u){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=a,this.defaultValue=i,this.defaultValueShape=s,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=$m.getRowPartitionTypesHelper(u),this.raggedRank=$m.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===fx.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===fx.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){let t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case fx.VALUE_ROWIDS:return gx.getMaxWidthValueRowID(t);case fx.ROW_SPLITS:return gx.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${fx[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){let t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){let t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){let t=e.length;if(0===t)return 0;let n=0,r=e[0],a=0;for(let i=1;i<t;++i){let t=e[i];t!==r&&(r=t,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}tensorShapeFromTensor(e,t,n=!0){if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return bx(e,n)}calculateOutputSize(e){let t=this.valuesShape,n=this.defaultValueShape;$m.validateDefaultValueShape(n,t);let r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=$m.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(let e=1;e<=this.raggedRank;++e)a[e]<0&&(a[e]=this.getMaxWidth(e));return a}calculateFirstParentOutputIndex(e,t,n){let r=Math.min(e,n),a=[],i=0;for(let e=0;e<r;++e,i+=t)a.push(i);for(let t=r;t<e;++t)a.push(-1);return Sa.assert(a.length===e,(()=>"Final length of result must be equal to firstDimension.")),a}calculateOutputIndexRowSplit(e,t,n,r){let a=e.length,i=[];for(let s=0;s<a-1;++s){let a=e[s+1]-e[s],o=Math.min(r,a),l=t[s];-1===l&&(o=0);for(let e=0;e<o;++e)i.push(l),l+=n;for(let e=0;e<a-o;++e)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,r){let a=e.length,i=[];if(0===a)return[];let s=0,o=e[0];if(o>=t.length)throw new Error(`Got currentValueRowId=${o}, which is not less than ${t.length}`);let l=t[o];i.push(l);for(let u=1;u<a;++u){let a=e[u];if(a===o)l>=0&&(++s,s<r?l+=n:l=-1);else{if(s=0,o=a,a>=t.length)throw new Error(`Got nextValueRowId=${a} which is not less than ${t.length}`);l=t[a]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,r){let a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case fx.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case fx.ROW_SPLITS:if(a.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${a.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error(`Unsupported partition type: ${fx[i]}`)}}getFirstDimensionSize(){let e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");let t=this.rowPartitionTypes[0];switch(t){case fx.FIRST_DIM_SIZE:return e[0];case fx.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case fx.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${fx[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let e=n.length-2;e>=0;--e)n[e]=n[e+1]*t[e+1];let r=bx(t,!1),a=Sa.getArrayFromDType(this.valuesDType,Sa.sizeFromShape(r));if(n[0]*t[0]>0){let i=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e)i=this.calculateOutputIndex(e-1,i,n[e],t[e]);this.setOutput(this.raggedRank,i,a,r)}return[r,a]}setOutput(e,t,n,r){if(0===n.length)return;let a=this.values,i=n,s=r.slice();s=s.slice(e+1);let o=Sa.sizeFromShape(s),l=t.length,u=this.defaultValue;if(u.length!==o&&1!==u.length){let e=this.defaultValueShape;eo((()=>{let t=Go(u,e);u=dl(t,s).dataSync()}))}let d=0,c=0,h=0;for(let e=0;e<=l;++e){let r=e<l?t[e]:-1;if(r!==h){if(c<h){let e=a.subarray(d*o);yx(i.subarray(c*o),e,(h-c)*o)}if(e>=l){let e=n.length;r=Math.floor(e/o)}if(r>h)if(1===this.defaultValue.length)i.subarray(h*o,r*o).fill(this.defaultValue[0]),h=r;else for(;r>h;)yx(i.slice(h*o),u,o),++h;r<0?(d=e+1,c=h):(d=e,c=h,h=c+1)}else++h}}};function yx(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function bx(e,t){let n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function xx(e,t,n,r,a,i,s,o,l,u){return new gx(e,t,n,r,a,i,s,o,l,u).compute()}function Ax(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Sa.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((t-e)/n)),i=Sa.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(let e=1;e<i.length;e++)i[e]=i[e-1]+n;return i}var vx=ab((e=>1/Math.sqrt(e))),wx=sb(br,vx),kx={kernelName:br,backendName:"cpu",kernelFunc:wx};function Sx(e,t,n,r,a,i,s,o,l,u){let d=[r/a,a],c=e.values,h=t.values;if(0===r)return Ws(n,t.dtype);let p=l instanceof ri?l:Ws(d,t.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let e=0;e<i;e++){let i=[],l=0;for(let t=0;t<s;t++){let n=c[e*s+t];i.push(n),l+=n*o[t]}if(l<0||l>=r/a)throw new Error(`Invalid indices: ${i} does not index into ${n}`);for(let n=0;n<a;n++)u?p.values[l*a+n]+=h[e*a+n]:p.values[l*a+n]=0===t.rank?h[0]:h[e*a+n]}return p}var Tx=ab((e=>1/(1+Math.exp(-e)))),_x=ib(Cr,(e=>1/(1+Math.exp(-e)))),Ix={kernelName:Cr,backendName:"cpu",kernelFunc:_x};function Cx(e,t,n,r,a){let i=dm.isSliceContinous(r,t,n),s=Sa.sizeFromShape(n),o=Sa.computeStrides(r);if(i){let n=dm.computeFlatOffset(t,o);return"string"===a?e.slice(n,n+s):e.subarray(n,n+s)}let l=Ws(r,a,"string"===a?$m.fromUint8ToStringArray(e):e),u=Ws(n,a);for(let e=0;e<u.size;++e){let n=u.indexToLoc(e),r=n.map(((e,n)=>e+t[n]));u.set(l.get(...r),...n)}return"string"===a?$m.fromStringArrayToUint8(u.values):u.values}function Ex(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r;Ny(a,"slice");let[o,l]=dm.parseSliceParams(a,i,s);dm.assertParamsValid(a,o,l);let u=Cx(n.data.get(a.dataId).values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,u)}var Nx={kernelName:Sr,backendName:"cpu",kernelFunc:Ex};function Rx(e,t,n,r,a,i,s){let o=t[0],l=i[0],u=new Array(l),d=new Array(o),c=t[1];if(0===l){if(0!==o)throw new Error($m.getSparseFillEmptyRowsIndicesDenseShapeMismatch(o));return[Sa.getArrayFromDType(n,0),[0,c],Sa.getArrayFromDType(a,0),u,d]}let h=!0,p=0,m=new Array(l).fill(0);for(let t=0;t<o;++t){let n=e[t*c];if(n<0)throw new Error($m.getSparseFillEmptyRowsNegativeIndexErrorMessage(t,n));if(n>=l)throw new Error($m.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(t,n,l));++m[n],h=h&&n>=p,p=n}let f=!0;for(let e=0;e<l;++e){let t=0===m[e];u[e]=t,f=f&&!t,m[e]=Math.max(m[e],1),e>0&&(m[e]+=m[e-1])}if(f&&h){let t=e,n=r;for(let e=0;e<o;++e)d[e]=e;return[t,[o,c],n,u,d]}{let t=m[l-1],i=Sa.getArrayFromDType(n,t*c),h=Sa.getArrayFromDType(a,t),p=new Array(l).fill(0);for(let t=0;t<o;++t){let n=e[t*c],a=p[n],s=(0===n?0:m[n-1])+a;p[n]++;for(let n=0;n<c;++n)i[s*c+n]=e[t*c+n];h[s]=r[t],d[t]=s}for(let e=0;e<l;++e)if(0===p[e]){let t=0===e?0:m[e-1];i[t*c+0]=e;for(let e=1;e<c;++e)i[t*c+e]=0;h[t]=s}return[i,[t,c],h,u,d]}}function Px(e,t,n,r,a){let i=Sa.sizeFromShape(r),s=t[0],o=a.length,l=[],u=1,d=-1;for(let e=0;e<o;++e){let t=a[e];if(-1===t){if(-1!==d)throw new Error($m.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(d,e));d=e,l.push(1)}else{if(t<0)throw new Error($m.getSparseReshapeNegativeOutputDimErrorMessage(e,t));u*=t,l.push(t)}}if(-1!==d){if(u<=0)throw new Error($m.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let e=Math.trunc(i/u);if(u*e!==i)throw new Error($m.getSparseReshapeInputOutputMultipleErrorMessage(r,l));l[d]=e}if(Sa.sizeFromShape(l)!==i)throw new Error($m.getSparseReshapeInputOutputMismatchErrorMessage(r,l));let c=r.length,h=[];if(c>0){h[c-1]=1;for(let e=c-2;e>=0;--e)h[e]=h[e+1]*r[e+1]}let p=[];if(o>0){p[o-1]=1;for(let e=o-2;e>=0;--e)p[e]=p[e+1]*l[e+1]}let m=Sa.getArrayFromDType(n,s*o);for(let t=0;t<s;++t){let n=0;for(let r=0;r<c;++r)n+=e[t*c+r]*h[r];for(let e=0;e<o;++e)m[t*o+e]=Math.trunc(n/p[e]),n%=p[e]}return[m,[s,o],l]}function Dx(e,t,n,r,a,i=!1,s=0){let o=r.length,l=[t[0],e.length/t[0]],u=l[1],d=o>0?a[o-1]+1:0;if(d<0)throw new Error($m.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let c=t.slice();c[0]=d;let h=c.reduce(((e,t)=>e*t),1),p=Sa.getArrayFromDType(n,h);if(0===o)return d>0&&p.fill(s),[p,c];if(d<=0)throw new Error($m.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let m=0,f=1,g=0,y=a[m];for(;;){let t=0;if(f<o){if(t=a[f],y===t){++f;continue}if(y>=t)throw new Error($m.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=d)throw new Error($m.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,d));y>g&&p.fill(s,g*u,y*u);for(let t=m;t<f;++t){let n=r[t];if(n<0||n>=l[0])throw new Error($m.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(t,r[t],l[0]));for(let t=0;t<u;t++)p[y*u+t]+=e[n*u+t]}if(i)for(let e=0;e<u;e++)p[y*u+e]/=f-m;if(m=f,++f,g=y+1,y=t,f>o)break}return g<d&&p.fill(s,g*u,d*u),[p,c]}var Mx=ab((e=>Math.sqrt(e))),Ox=ib(Nr,(e=>Math.sqrt(e))),$x={kernelName:Nr,backendName:"cpu",kernelFunc:Ox},Fx=$y(((e,t)=>{let n=e-t;return n*n})),Lx=qy(Br,Fx),zx={kernelName:Br,backendName:"cpu",kernelFunc:Lx},Bx=ab(((e,t)=>{let{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)})),Ux=sb(Wr,Bx),Wx={kernelName:Wr,backendName:"cpu",kernelFunc:Ux};function Vx(e,t,n,r){let a=Ws(e,t.dtype);for(let e=0;e<a.size;e++){let i=a.indexToLoc(e),s=new Array(i.length);for(let e=0;e<s.length;e++)s[e]=i[e]*n[e]+r[e];a.set(t.get(...s),...i)}return a}var jx=class{constructor(e,t,n,r,a,i){this.separator=Sa.encodeString(e),this.nGramWidths=t,this.leftPad=Sa.encodeString(n),this.rightPad=Sa.encodeString(r),this.padWidth=a,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){let n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,i){for(let s=0;s<a;++s){let o=this.getPadWidth(i),l=Math.max(0,o-s),u=Math.max(0,o-(a-(s+1))),d=i-(l+u),c=t+(l>0?0:s-o),h=0;h+=l*this.leftPad.length;for(let t=0;t<d;++t)h+=e[c+t].length;h+=u*this.rightPad.length,h+=(l+u+d-1)*this.separator.length,n[r+s]=new Uint8Array(h);let p=n[r+s],m=0,f=e=>e.forEach((e=>p[m++]=e));for(let e=0;e<l;++e)f(this.leftPad),f(this.separator);for(let t=0;t<d-1;++t)f(e[c+t]),f(this.separator);if(d>0){f(e[c+d-1]);for(let e=0;e<u;++e)f(this.separator),f(this.rightPad)}else{for(let e=0;e<u-1;++e)f(this.rightPad),f(this.separator);f(this.rightPad)}}}compute(e,t){let n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error(`Invalid split value ${t[a]}, must be in [${e}, ${n}]`);e=t[a]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}let a=r-1,i=Sa.getArrayFromDType("int32",r);if(0===n||0===r){let e=new Array(n);for(let e=0;e<=a;++e)i[e]=0;return[e,i]}i[0]=0;for(let e=1;e<=a;++e){let n=t[e]-t[e-1],r=0;this.nGramWidths.forEach((e=>{r+=this.getNumNGrams(n,e)})),this.preserveShort&&n>0&&0===r&&(r=1),i[e]=i[e-1]+r}let s=new Array(i[a]);for(let n=0;n<a;++n){let r=t[n],a=i[n];if(this.nGramWidths.forEach((i=>{let o=t[n+1]-t[n],l=this.getNumNGrams(o,i);this.createNGrams(e,r,s,a,l,i),a+=l})),this.preserveShort&&a===i[n]){let i=t[n+1]-t[n];if(0===i)continue;let o=i+2*this.padWidth,l=1;this.createNGrams(e,r,s,a,l,o)}}return[s,i]}};function Hx(e,t,n,r,a,i,s,o){return new jx(n,r,a,i,s,o).compute(e,t)}function Gx(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){let a=t[0],i=e.indexOf(a);for(;-1!==i;){let t=e.subarray(0,i);(!n||0!==t.length)&&r.push(t),i=(e=e.subarray(i+1)).indexOf(a)}return void((!n||0!==e.length)&&r.push(e))}let a=0;for(let i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){let t=e.subarray(a,i);(!n||0!==t.length)&&r.push(t),a=i+1}}function qx(e,t,n){let r=e.length,a=[],i=0,s=0,o=new Array(r);for(let l=0;l<r;++l){let r=a.length;Gx(e[l],t,n,a);let u=a.length-r;o[l]=u,i+=u,s=Math.max(s,u)}let l=Sa.getArrayFromDType("int32",2*i),u=new Array(i),d=[r,s],c=0;for(let e=0;e<r;++e)for(let t=0;t<o[e];++t)l[2*c]=e,l[2*c+1]=t,u[c]=a[c],++c;return[l,u,d]}function Xx(e,t){let n=Sa.getArrayFromDType("int32",e.length);for(let r=0;r<e.length;++r)n[r]=Sa.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var Kx=$y(((e,t)=>e-t)),Zx=Xy(((e,t,n,r)=>({real:e-n,imag:t-r}))),Yx=qy(qr,Kx,Zx),Jx={kernelName:qr,backendName:"cpu",kernelFunc:Yx};function Qx(e,t){let n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];let r=Ws(n,e.dtype);for(let t=0;t<r.values.length;++t){let n=r.indexToLoc(t),a=new Array(e.rank);for(let t=0;t<a.length;t++)a[t]=n[t]%e.shape[t];let i=e.locToIndex(a);r.values[t]=e.values[i]}return r}var eA=(e,t)=>{let n=t.value-e.value;return 0===n?e.index-t.index:n};function tA(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){let a=r-n+1,i=t-n+1,s=Math.log(a),o=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*o*(a-o)/a)*Math.sign(i-a/2);tA(e,t,Math.max(n,Math.floor(t-i*o/a+l)),Math.min(r,Math.floor(t+(a-i)*o/a+l)))}let a=e[t],i=n,s=r;for(Sa.swap(e,n,t),eA(e[r],a)>0&&Sa.swap(e,n,r);i<s;){for(Sa.swap(e,i,s),i++,s--;eA(e[i],a)<0;)i+=1;for(;eA(e[s],a)>0;)s-=1}0===eA(e[n],a)?Sa.swap(e,n,s):(s+=1,Sa.swap(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}function nA(e,t,n,r,a){let i=t[t.length-1],[s,o]=[e.length/i,i],l=Sa.getTypedArrayFromDType(n,s*r),u=Sa.getTypedArrayFromDType("int32",s*r);for(let t=0;t<s;t++){let n=t*o,i=e.subarray(n,n+o),s=new Array(i.length);i.forEach(((e,t)=>s[t]={value:e,index:t})),r<s.length&&(tA(s,r),s=s.slice(0,r)),a&&s.sort(eA);let d=t*r,c=l.subarray(d,d+r),h=u.subarray(d,d+r);for(let e=0;e<r;e++)c[e]=s[e].value,h[e]=s[e].index}let d=t.slice();return d[d.length-1]=r,[Ws(d,n,l),Ws(d,"int32",u)]}function rA(e,t,n,r){let a=Sa.parseAxisParam(t,n)[0],i=[1,n[0],1];for(let e=0;e<a;e++)i[0]*=n[e];i[1]=n[a];for(let e=a+1;e<n.length;e++)i[2]*=n[e];let s=new Map,o=new Int32Array(n[a]),l=new ri(i,r,e),u=[],d=1===i[0]&&1===i[2];for(let t=0;t<n[a];t++){let n;if(d)n=e[t].toString();else{let e=[];for(let n=0;n<i[0];n++)for(let r=0;r<i[2];r++)e.push(l.get(n,t,r));n=e.join(",")}let r=s.get(n);if(null!=r)o[t]=r;else{let e=s.size;s.set(n,e),o[t]=e,u.push(t)}}let c=i.slice();c[1]=s.size;let h=new ri(c,r);u.forEach(((e,t)=>{for(let n=0;n<i[0];n++)for(let r=0;r<i[2];r++)h.set(l.get(n,e,r),n,t,r)}));let p=n.slice();return p[a]=c[1],{outputValues:h.values,outputShape:p,indices:o}}var aA="4.7.0";co("cpu",(()=>new Py),1);var iA=ib(Ht,(e=>e>=0?e:Math.exp(e)-1)),sA={kernelName:Ht,backendName:"cpu",kernelFunc:iA};function oA(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r;Ny([a],"leakyRelu");let s=Sa.sizeFromShape(a.shape),o=n.data.get(a.dataId).values,l=Sa.getTypedArrayFromDType("float32",s);for(let e=0;e<o.length;e++)l[e]=o[e]<0?i*o[e]:o[e];return n.makeTensorInfo(a.shape,"float32",l)}var lA={kernelName:fn,backendName:"cpu",kernelFunc:oA},uA=$y(((e,t)=>e<0?t*e:e));function dA(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t;Ny([r,a],"prelu");let i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,[o,l]=uA(r.shape,a.shape,i,s,"float32");return n.makeTensorInfo(l,"float32",o)}var cA={kernelName:tr,backendName:"cpu",kernelFunc:dA},hA=ib(ur,(e=>Math.max(0,e))),pA={kernelName:ur,backendName:"cpu",kernelFunc:hA},mA=ib(fr,(e=>Math.min(Math.max(0,e),6))),fA={kernelName:fr,backendName:"cpu",kernelFunc:mA};function gA(e,t,n,r,a){if("linear"===n)return By({inputs:{x:t},backend:e});if("relu"===n)return hA({inputs:{x:t},backend:e});if("elu"===n)return iA({inputs:{x:t},backend:e});if("relu6"===n)return mA({inputs:{x:t},backend:e});if("prelu"===n)return dA({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return oA({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return _x({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function yA(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,s=Sa.sizeFromShape(a.shape),o=Sa.inferFromImplicitShape(i,s),l=Sa.sizeFromShape(o);Sa.assert(s===l,(()=>`The new shape (${o}) has ${l} elements and the old shape (${a.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(a.dataId);let u=n.data.get(a.dataId);if(null!=u.complexTensorInfos){let e=u.complexTensorInfos.real,t=u.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:a.dataId,shape:o,dtype:a.dtype}}var bA={kernelName:dr,backendName:"cpu",kernelFunc:yA};function xA(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i}=t,{transposeA:s,transposeB:o}=r;Ny([a,i],"matMul");let l=a.shape.length,u=i.shape.length,d=s?a.shape[l-2]:a.shape[l-1],c=o?i.shape[u-1]:i.shape[u-2],h=s?a.shape[l-1]:a.shape[l-2],p=o?i.shape[u-2]:i.shape[u-1],m=a.shape.slice(0,-2),f=i.shape.slice(0,-2),g=Sa.sizeFromShape(m),y=Sa.sizeFromShape(f),b=Ml.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,p]);Sa.assert(d===c,(()=>`Error in matMul: inner shapes (${d}) and (${c}) of Tensors with shapes ${a.shape} and ${i.shape} and transposeA=${s} and transposeB=${o} must match.`));let x=o?[y,p,c]:[y,c,p],A=yA({inputs:{x:a},backend:n,attrs:{shape:s?[g,d,h]:[g,h,d]}}),v=yA({inputs:{x:i},backend:n,attrs:{shape:x}}),w=s?A.shape[1]:A.shape[2],k=s?A.shape[2]:A.shape[1],S=o?v.shape[1]:v.shape[2],T=Math.max(g,y),_=n.data.get(A.dataId).values,I=n.data.get(v.dataId).values,C=Sa.computeStrides(A.shape),E=Sa.computeStrides(v.shape),[N,R,P]=s?[C[0],1,C[1]]:[C[0],C[1],1],[D,M,O]=o?[1,E[1],E[0]]:[E[1],1,E[0]],$=k*S,F=Ws([T,k,S],A.dtype),L=F.values,z=n.blockSize;for(let e=0;e<T;e++){let t=e%g,n=e%y;for(let r=0;r<k;r+=z){let a=Math.min(r+z,k);for(let i=0;i<S;i+=z){let s=Math.min(i+z,S);for(let o=0;o<w;o+=z){let l=Math.min(o+z,w);for(let u=r;u<a;u++)for(let r=i;r<s;r++){let a=0;for(let e=o;e<l;e++)a+=_[t*N+u*R+e*P]*I[e*D+r*M+n*O];L[e*$+(u*S+r)]+=a}}}}}return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(v),n.makeTensorInfo(b,F.dtype,F.values)}var AA={kernelName:dt,backendName:"cpu",kernelFunc:xA},vA={kernelName:la,backendName:"cpu",kernelFunc:function(e){let t,n,r,{inputs:a,backend:i,attrs:s}=e,{a:o,b:l,bias:u,preluActivationWeights:d}=a,{transposeA:c,transposeB:h,activation:p,leakyreluAlpha:m}=s,f=[];t=xA({inputs:{a:o,b:l},attrs:{transposeA:c,transposeB:h},backend:i}),u&&(n=Yy({inputs:{a:t,b:u},backend:i}),f.push(t),t=n),p&&(r=gA(i,t,p,d,m),f.push(t),t=r);for(let e of f)i.disposeIntermediateTensorInfo(e);return t}},wA=ib(qe,(e=>Math.acos(e))),kA={kernelName:qe,backendName:"cpu",kernelFunc:wA},SA=ib(Xe,(e=>Math.acosh(e))),TA={kernelName:Xe,backendName:"cpu",kernelFunc:SA},_A={kernelName:Ze,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,r=t;Ny(t,"addN");let a=r.map((e=>n.data.get(e.dataId).values)),i=Ws(r[0].shape,r[0].dtype),s=i.values;for(let e=0;e<r.length;e++){let t=a[e];for(let e=0;e<s.length;e++)s[e]+=t[e]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}},IA={kernelName:Ye,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;Ny(a,"all");let o=Sa.parseAxisParam(i,a.shape),l=o,u=$m.getAxesPermutation(l,a.shape.length),d=a;null!=u&&(d=ox({inputs:{x:a},backend:n,attrs:{perm:u}}),l=$m.getInnerMostAxes(l.length,a.shape.length)),$m.assertAxesAreInnerMostDims("all",l,d.shape.length);let[c,h]=$m.computeOutAndReduceShapes(d.shape,l),p=Sa.sizeFromShape(h),m=Sa.makeZerosTypedArray(Sa.sizeFromShape(c),d.dtype),f=n.data.get(d.dataId).values;for(let e=0;e<m.length;++e){let t=e*p,n=f[t];for(let e=0;e<p;++e){let r=f[t+e];n=n&&r}m[e]=n}null!=u&&n.disposeIntermediateTensorInfo(d);let g=n.makeTensorInfo(c,d.dtype,m);if(s){let e=yA({inputs:{x:g},backend:n,attrs:{shape:$m.expandShapeToKeepDim(c,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}},CA={kernelName:Je,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;Ny(a,"any");let o=Sa.parseAxisParam(i,a.shape),l=o,u=$m.getAxesPermutation(l,a.shape.length),d=a;null!=u&&(d=ox({inputs:{x:a},backend:n,attrs:{perm:u}}),l=$m.getInnerMostAxes(l.length,a.shape.length)),$m.assertAxesAreInnerMostDims("any",l,d.shape.length);let[c,h]=$m.computeOutAndReduceShapes(d.shape,l),p=Sa.sizeFromShape(h),m=Sa.makeZerosTypedArray(Sa.sizeFromShape(c),d.dtype),f=n.data.get(d.dataId).values;for(let e=0;e<m.length;++e){let t=e*p,n=f[t];for(let e=0;e<p;++e){let r=f[t+e];n=n||r}m[e]=n}null!=u&&n.disposeIntermediateTensorInfo(d);let g=n.makeTensorInfo(c,d.dtype,m);if(s){let e=yA({inputs:{x:g},backend:n,attrs:{shape:$m.expandShapeToKeepDim(c,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}},EA={kernelName:Qe,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;Ny(a,"argMax");let s=Sa.parseAxisParam(i,a.shape),o=$m.getAxesPermutation(s,a.shape.length),l=a,u=[];null!=o&&(l=ox({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=$m.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],$m.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[d,c]=$m.computeOutAndReduceShapes(l.shape,s),h=Sa.sizeFromShape(d),p=Sa.makeZerosTypedArray(h,"int32"),m=Sa.sizeFromShape(c),f=n.data.get(l.dataId).values;for(let e=0;e<p.length;++e){let t=e*m,n=f[t],r=0;for(let e=0;e<m;++e){let a=f[t+e];a>n&&(n=a,r=e)}p[e]=r}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(d,"int32",p)}},NA={kernelName:et,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;Ny(a,"argMin");let s=Sa.parseAxisParam(i,a.shape),o=$m.getAxesPermutation(s,a.shape.length),l=a,u=[];null!=o&&(l=ox({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=$m.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],$m.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[d,c]=$m.computeOutAndReduceShapes(l.shape,s),h=Sa.sizeFromShape(d),p=Sa.makeZerosTypedArray(h,"int32"),m=Sa.sizeFromShape(c),f=n.data.get(l.dataId).values;for(let e=0;e<p.length;++e){let t=e*m,n=f[t],r=0;for(let e=0;e<m;++e){let a=f[t+e];a<n&&(n=a,r=e)}p[e]=r}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(d,"int32",p)}},RA=ib(tt,(e=>Math.asin(e))),PA={kernelName:tt,backendName:"cpu",kernelFunc:RA},DA=ib(nt,(e=>Math.asinh(e))),MA={kernelName:nt,backendName:"cpu",kernelFunc:DA},OA=ib(rt,(e=>Math.atan(e))),$A={kernelName:rt,backendName:"cpu",kernelFunc:OA},FA=$y(((e,t)=>Math.atan2(e,t))),LA=qy(it,FA),zA={kernelName:it,backendName:"cpu",kernelFunc:LA},BA=ib(at,(e=>Math.atanh(e))),UA={kernelName:at,backendName:"cpu",kernelFunc:BA};function WA(e,t,n,r,a,i){let s=a.strideHeight,o=a.strideWidth,l=a.dilationHeight,u=a.dilationWidth,d=a.effectiveFilterHeight,c=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,m="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=Ws(a.outShape,n),g=f.values,y=a.outShape[1]*a.outShape[2]*a.outShape[3],b=a.outShape[2]*a.outShape[3],x=a.outShape[3];for(let t=0;t<a.batchSize;++t){let n=t*y,f=t*r[0];for(let t=0;t<a.inChannels;++t)for(let y=0;y<a.outHeight;++y){let A=y*s-h,v=Math.max(0,A),w=Math.min(a.inHeight,d+A),k=n+y*b;for(let n=0;n<a.outWidth;++n){let s=n*o-p,d=Math.max(0,s),h=Math.min(a.inWidth,c+s),y=m,b=0,A=0;for(let n=v;n<w;n+=l){let a=f+n*r[1];for(let n=d;n<h;n+=u){let s=e[a+n*r[2]+t];"max"===i&&s>y?y=s:"avg"===i&&(b+=s,A++)}if(isNaN(y))break}g[k+n*x+t]="avg"===i?b/A:y}}}return f}function VA(e,t,n,r,a=!1,i=!1){let s=Ws(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,d=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,m=r.padInfo.left,f=Ws(t,n,e);for(let e=0;e<r.batchSize;++e)for(let t=0;t<r.inChannels;++t)for(let n=0;n<r.outHeight;++n){let g=n*o-p,y=g;for(;y<0;)y+=u;let b=Math.min(r.inHeight,c+g);for(let o=0;o<r.outWidth;++o){let c=o*l-m,p=c;for(;p<0;)p+=d;let x=Math.min(r.inWidth,h+c),A=Number.NEGATIVE_INFINITY,v=-1;for(let n=y;n<b;n+=u){let s=n-g;for(let o=p;o<x;o+=d){let l=o-c,u=f.get(e,n,o,t);u>A&&(A=u,v=a?i?((e*r.inHeight+n)*r.inWidth+o)*r.inChannels+t:(n*r.inWidth+o)*r.inChannels+t:s*h+l)}}s.set(v,e,n,o,t)}}return s}function jA(e,t,n,r,a,i){let s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,u=a.dilationDepth,d=a.dilationHeight,c=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,m=a.effectiveFilterWidth,f=a.padInfo.front,g=a.padInfo.top,y=a.padInfo.left,b="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Ws(a.outShape,n),A=x.values,v=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],k=a.outShape[3]*a.outShape[4],S=a.outShape[4];for(let t=0;t<a.batchSize;++t){let n=t*v,x=t*r[0];for(let t=0;t<a.inChannels;++t)for(let v=0;v<a.outDepth;++v){let T=v*s-f,_=T;for(;_<0;)_+=u;let I=Math.min(a.inDepth,h+T),C=n+v*w;for(let n=0;n<a.outHeight;++n){let s=n*o-g,h=s;for(;h<0;)h+=d;let f=Math.min(a.inHeight,p+s),v=C+n*k;for(let n=0;n<a.outWidth;++n){let s=n*l-y,o=s;for(;o<0;)o+=c;let p=Math.min(a.inWidth,m+s),g=v+n*S,w=b,k=0,T=0;for(let n=_;n<I;n+=u){let a=x+n*r[1];for(let n=h;n<f;n+=d){let s=a+n*r[2];for(let n=o;n<p;n+=c){let a=e[s+n*r[3]+t];if("max"===i&&a>w?w=a:"avg"===i&&(k+=a,T++),isNaN(w))break}if(isNaN(w))break}if(isNaN(w))break}A[g+t]="avg"===i?k/Math.max(T,1):w}}}}return x}var HA={kernelName:st,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;Ny(a,"avgPool");let{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;Sa.assert($m.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));let u,d=$m.computePool2DInfo(a.shape,i,s,1,o,l);if(1===d.filterWidth&&1===d.filterHeight&&Sa.arraysEqual(d.inShape,d.outShape))u=By({inputs:{x:a},backend:n});else{let e=n.data.get(a.dataId).values,t=Sa.computeStrides(a.shape),r=WA(e,a.shape,a.dtype,t,d,"avg");u=n.makeTensorInfo(d.outShape,a.dtype,r.values)}return u}},GA={kernelName:lt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r;Ny(a,"avgPool3d");let d=$m.computePool3DInfo(a.shape,i,s,1,o,l,u),c=jA(n.data.get(a.dataId).values,a.shape,a.dtype,Sa.computeStrides(a.shape),d,"avg");return n.makeTensorInfo(c.shape,"float32",c.values)}},qA={kernelName:ut,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r;Ny([a,i],"avgPool3DGrad");let d=$m.computePool3DInfo(i.shape,s,o,1,l,u),c=d.strideDepth,h=d.strideHeight,p=d.strideWidth,m=d.filterDepth,f=d.filterHeight,g=d.filterWidth,y=d.dilationDepth,b=d.dilationHeight,x=d.dilationWidth,A=d.effectiveFilterDepth,v=d.effectiveFilterHeight,w=d.effectiveFilterWidth,k=A-1-d.padInfo.front,S=w-1-d.padInfo.left,T=v-1-d.padInfo.top,_=Ws(i.shape,"float32"),I=1/(m*f*g),C=n.bufferSync(a);for(let e=0;e<d.batchSize;++e)for(let t=0;t<d.inChannels;++t)for(let n=0;n<d.inDepth;++n)for(let r=0;r<d.inHeight;++r)for(let a=0;a<d.inWidth;++a){let i=n-k,s=r-T,o=a-S,l=0;for(let n=0;n<A;n+=y){let r=(i+n)/c;if(!(r<0||r>=d.outDepth||Math.floor(r)!==r))for(let n=0;n<v;n+=b){let a=(s+n)/h;if(!(a<0||a>=d.outHeight||Math.floor(a)!==a))for(let n=0;n<w;n+=x){let i=(o+n)/p;i<0||i>=d.outWidth||Math.floor(i)!==i||(l+=C.get(e,r,a,i,t))}}}_.set(l*I,e,n,r,a,t)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}},XA={kernelName:ot,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;Ny([a,i],"avgPoolGrad");let{filterSize:o,strides:l,pad:u}=r,d=$m.computePool2DInfo(s.shape,o,l,1,u),c=d.strideHeight,h=d.strideWidth,p=d.filterHeight,m=d.filterWidth,f=d.dilationHeight,g=d.dilationWidth,y=d.effectiveFilterHeight,b=d.effectiveFilterWidth,x=b-1-d.padInfo.left,A=y-1-d.padInfo.top,v=Ws(s.shape,"float32"),w=1/(p*m),k=n.data.get(a.dataId).values,S=Ws(a.shape,"float32",k);for(let e=0;e<d.batchSize;++e)for(let t=0;t<d.inChannels;++t)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){let a=n-A,i=r-x,s=0;for(let n=0;n<y;n+=f){let r=(a+n)/c;if(!(r<0||r>=d.outHeight||Math.floor(r)!==r))for(let n=0;n<b;n+=g){let a=(i+n)/h;a<0||a>=d.outWidth||Math.floor(a)!==a||(s+=S.get(e,r,a,t))}}v.set(s*w,e,n,r,t)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},KA={kernelName:rn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,scale:i,offset:s,mean:o,variance:l}=t;Sa.assert(o.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Sa.assert(null==s||o.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Sa.assert(null==i||o.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),Ny([a,o,l,i,s],"batchNorm");let{varianceEpsilon:u}=r;null==u&&(u=.001);let d=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,h=n.data.get(l.dataId).values,p=i?n.data.get(i.dataId).values:new Float32Array([1]),m=s?n.data.get(s.dataId).values:new Float32Array([0]),f=new Float32Array(d.length),g=m.length,y=p.length,b=h.length,x=c.length,A=0,v=0,w=0,k=0;for(let e=0;e<d.length;++e)f[e]=m[A++]+(d[e]-c[v++])*p[w++]/Math.sqrt(h[k++]+u),A>=g&&(A=0),v>=x&&(v=0),w>=y&&(w=0),k>=b&&(k=0);return n.makeTensorInfo(a.shape,a.dtype,f)}},ZA={kernelName:ct,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;Ny([a],"batchToSpaceND");let o=i.reduce(((e,t)=>e*t)),l=$m.getReshaped(a.shape,i,o),u=$m.getPermuted(l.length,i.length),d=$m.getReshapedPermuted(a.shape,i,o),c=$m.getSliceBeginCoords(s,i.length),h=$m.getSliceSize(d,s,i.length),p=yA({inputs:{x:a},backend:n,attrs:{shape:l}}),m=ox({inputs:{x:p},backend:n,attrs:{perm:u}}),f=yA({inputs:{x:m},backend:n,attrs:{shape:d}}),g=Ex({inputs:{x:f},backend:n,attrs:{begin:c,size:h}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),g}},YA={kernelName:ht,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=Qy(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,o)}},JA={kernelName:ft,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,o=$m.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},QA=ib(bt,((e,t)=>{let n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),ev={kernelName:bt,backendName:"cpu",kernelFunc:QA},tv={kernelName:At,backendName:"cpu",kernelFunc:e=>{let{x:t}=e.inputs,n=e.backend,r=new Float32Array(Sa.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,s=a.complexTensorInfos.imag,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values;for(let e=0;e<o.length;e++){let t=o[e],n=l[e];r[e]=Math.hypot(t,n)}return n.makeOutput(r,t.shape,"float32")}};function nv(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var rv={kernelName:cn,backendName:"cpu",kernelFunc:nv};function av(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=Sa.parseAxisParam(a,t[0].shape)[0],s=t.map((e=>e.shape));$m.assertParamsConsistent(s,i);let o=$m.computeOutShape(t.map((e=>e.shape)),i);if(0===Sa.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);let l=t.filter((e=>Sa.sizeFromShape(e.shape)>0));if(1===l.length)return By({inputs:{x:l[0]},backend:n});if("complex64"===l[0].dtype){let e=l.map((e=>Wy({inputs:{input:e},backend:n}))),t=l.map((e=>nv({inputs:{input:e},backend:n}))),r=av({inputs:e,backend:n,attrs:{axis:i}}),a=av({inputs:t,backend:n,attrs:{axis:i}}),s=Fy({inputs:{real:r,imag:a},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),s}let u=l.map((e=>{let t=[-1,Sa.sizeFromShape(e.shape.slice(i))];return yA({inputs:{x:e},backend:n,attrs:{shape:t}})})),d=u.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));o=$m.computeOutShape(u.map((e=>e.shape)),1);let c=1===u[0].shape[0],h=db(d,o,t[0].dtype,c),p=$m.computeOutShape(l.map((e=>e.shape)),i),m=n.makeTensorInfo(p,t[0].dtype,h);return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),m}var iv={kernelName:vt,backendName:"cpu",kernelFunc:av};function sv(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:u,dimRoundingMode:d}=r;Ny([a,i],"conv2d");let c=$m.convertConv2DDataFormat(l),h=$m.computeConv2DInfo(a.shape,i.shape,s,u,o,d,!1,c),p=h.filterHeight,m=h.filterWidth,f=h.dilationHeight,g=h.dilationWidth,y=h.padInfo.left,b=h.padInfo.top,x="channelsLast"===h.dataFormat,A=new ri(h.outShape,a.dtype),v=Sa.computeStrides(a.shape),w=Sa.computeStrides(i.shape),k=v[0],S=x?v[1]:v[2],T=x?v[2]:1,_=x?1:v[1],I=A.strides[0],C=x?A.strides[1]:A.strides[2],E=x?A.strides[2]:1,N=x?1:A.strides[1],R=n.data.get(a.dataId).values,P=n.data.get(i.dataId).values,D=A.values;for(let e=0;e<h.batchSize;++e){let t=e*k,n=e*I;for(let e=0;e<h.outHeight;++e){let r=n+e*C,a=e*h.strideHeight-b;for(let e=0;e<p;++e){let n=a+e*f;if(n<0||n>=h.inHeight)continue;let i=e*w[0],s=t+n*S;for(let e=0;e<h.outWidth;++e){let t=r+e*E,n=e*h.strideWidth-y;for(let e=0;e<m;++e){let r=n+e*g;if(r<0||r>=h.inWidth)continue;let a=s+r*T,o=i+e*w[1];for(let e=0;e<h.inChannels;++e){let n=R[a+e*_];for(let e=0;e<h.outChannels;++e)D[t+e*N]+=n*P[o+e];o+=h.outChannels}}}}}}return n.makeTensorInfo(A.shape,A.dtype,D)}var ov={kernelName:wt,backendName:"cpu",kernelFunc:sv},lv={kernelName:kt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:d}=r;Ny([a,i],"conv2dBackpropFilter");let c=$m.convertConv2DDataFormat(l),h=$m.computeConv2DInfo(a.shape,d,s,1,o,u,!1,c),{strideHeight:p,strideWidth:m,filterHeight:f,filterWidth:g}=h,y="channelsLast"===h.dataFormat,b=new ri(h.filterShape,"float32"),x=h.padInfo.left,A=h.padInfo.top,v=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,k=new ri(a.shape,a.dtype,v),S=new ri(i.shape,i.dtype,w);for(let e=0;e<f;++e){let t=Math.max(0,Math.ceil((A-e)/p)),n=Math.min(h.outHeight,(h.inHeight+A-e)/p);for(let r=0;r<g;++r){let a=Math.max(0,Math.ceil((x-r)/m)),i=Math.min(h.outWidth,(h.inWidth+x-r)/m);for(let s=0;s<h.inChannels;++s)for(let o=0;o<h.outChannels;++o){let l=0;for(let u=0;u<h.batchSize;++u)for(let d=t;d<n;++d){let t=e+d*p-A;for(let e=a;e<i;++e){let n=r+e*m-x;l+=y?k.get(u,t,n,s)*S.get(u,d,e,o):k.get(u,s,t,n)*S.get(u,o,d,e)}}b.set(l,e,r,s,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},uv={kernelName:St,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:s,strides:o,pad:l,dataFormat:u,dimRoundingMode:d}=r;Ny([a,i],"conv2dBackpropInput");let c=Sa.computeStrides(i.shape),h=Sa.computeStrides(a.shape),p=$m.convertConv2DDataFormat(u),m=$m.computeConv2DInfo(s,i.shape,o,1,l,d,!1,p),f=new ri(m.inShape,"float32"),g=f.values,y=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,[x,A,v]=c,{batchSize:w,filterHeight:k,filterWidth:S,inChannels:T,inHeight:_,inWidth:I,outChannels:C,outHeight:E,outWidth:N,strideHeight:R,strideWidth:P}=m;p=m.dataFormat;let D=k-1-m.padInfo.top,M=S-1-m.padInfo.left,O="channelsLast"===p,$=f.strides[0],F=O?f.strides[1]:f.strides[2],L=O?f.strides[2]:1,z=O?1:f.strides[1],B=h[0],U=O?h[1]:h[2],W=O?h[2]:1,V=O?1:h[1];for(let e=0;e<w;++e)for(let t=0;t<T;++t)for(let n=0;n<_;++n){let r=n-D,a=Math.max(0,Math.ceil(r/R)),i=Math.min(E,(k+r)/R);for(let s=0;s<I;++s){let o=s-M,l=Math.max(0,Math.ceil(o/P)),u=Math.min(N,(S+o)/P),d=0;for(let n=a;n<i;++n){let a=n*R-r;for(let r=l;r<u;++r){let i=B*e+U*n+W*r,s=x*(k-1-a)+A*(S-1-(r*P-o))+v*t;for(let e=0;e<C;++e)d+=y[i+V*e]*b[s+e]}}g[$*e+F*n+L*s+z*t]=d}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},dv={kernelName:Tt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r;Ny([a,i],"conv3d");let u=$m.computeConv3DInfo(a.shape,i.shape,s,l,o),{filterDepth:d,filterHeight:c,filterWidth:h,dilationDepth:p,dilationHeight:m,dilationWidth:f,padInfo:g}=u,y=g.front,b=g.left,x=g.top,A=new ri(u.outShape,a.dtype),v=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,k=A.values,S=Sa.computeStrides(a.shape),T=Sa.computeStrides(i.shape);for(let e=0;e<u.batchSize;++e){let t=e*S[0],n=e*A.strides[0];for(let e=0;e<u.outDepth;++e){let r=n+e*A.strides[1],a=e*u.strideDepth-y;for(let e=0;e<d;++e){let n=a+e*p;if(n<0||n>=u.inDepth)continue;let i=e*T[0],s=t+n*S[1];for(let e=0;e<u.outHeight;++e){let t=r+e*A.strides[2],n=e*u.strideHeight-x;for(let e=0;e<c;++e){let r=n+e*m;if(r<0||r>=u.inHeight)continue;let a=i+e*T[1],o=s+r*S[2];for(let e=0;e<u.outWidth;++e){let n=t+e*u.outChannels,r=e*u.strideWidth-b;for(let e=0;e<h;++e){let t=r+e*f;if(t<0||t>=u.inWidth)continue;let i=a+e*T[2],s=o+t*u.inChannels,l=i;for(let e=0;e<u.inChannels;++e){let t=v[s+e];for(let e=0;e<u.outChannels;++e)k[n+e]+=t*w[l+e];l+=u.outChannels}}}}}}}}return n.makeTensorInfo(A.shape,A.dtype,A.values)}},cv={kernelName:_t,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r;Ny([a,i],"conv3dBackpropFilterV2");let u=Sa.computeStrides(a.shape),d=Sa.computeStrides(i.shape),c=$m.computeConv3DInfo(a.shape,l,s,1,o),h=c.strideDepth,p=c.strideHeight,m=c.strideWidth,f=c.filterDepth,g=c.filterHeight,y=c.filterWidth,b=new ri(c.filterShape,"float32"),x=b.values,[A,v,w,k]=b.strides,S=n.data.get(i.dataId).values,[T,_,I,C]=d,E=n.data.get(a.dataId).values,[N,R,P,D]=u,M=c.padInfo.front,O=c.padInfo.left,$=c.padInfo.top;for(let e=0;e<f;++e){let t=Math.max(0,Math.ceil((M-e)/h)),n=Math.min(c.outDepth,(c.inDepth+M-e)/h),r=e*A;for(let a=0;a<g;++a){let i=Math.max(0,Math.ceil(($-a)/p)),s=Math.min(c.outHeight,(c.inHeight+$-a)/p),o=a*v+r;for(let r=0;r<y;++r){let l=Math.max(0,Math.ceil((O-r)/m)),u=Math.min(c.outWidth,(c.inWidth+O-r)/m),d=r*w+o;for(let o=0;o<c.inChannels;++o){let f=o*k+d;for(let d=0;d<c.outChannels;++d){let g=0;for(let f=0;f<c.batchSize;++f){let c=f*N,y=f*T;for(let f=t;f<n;++f){let t=(e+f*h-M)*R+c,n=f*_+y;for(let e=i;e<s;++e){let i=(a+e*p-$)*P+t,s=e*I+n;for(let e=l;e<u;++e){let t=e*C+s;g+=E[(r+e*m-O)*D+i+o]*S[t+d]}}}}x[f+d]=g}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},hv={kernelName:It,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r;Ny([a],"conv3dBackpropInputV2");let u=Sa.computeStrides(a.shape),d=Sa.computeStrides(i.shape),c=$m.computeConv3DInfo(l,i.shape,o,1,s),h=new ri(c.inShape,"float32"),p=h.values,[m,f,g,y]=h.strides,b=n.data.get(a.dataId).values,[x,A,v,w]=u,k=n.data.get(i.dataId).values,[S,T,_,I]=d,{batchSize:C,filterDepth:E,filterHeight:N,filterWidth:R,inChannels:P,inDepth:D,inHeight:M,inWidth:O,outChannels:$,outDepth:F,outHeight:L,outWidth:z,strideDepth:B,strideHeight:U,strideWidth:W}=c,V=E-1-c.padInfo.front,j=N-1-c.padInfo.top,H=R-1-c.padInfo.left;for(let e=0;e<C;++e)for(let t=0;t<P;++t)for(let n=0;n<D;++n){let r=n-V,a=Math.max(0,Math.ceil(r/B)),i=Math.min(F,(E+r)/B);for(let s=0;s<M;++s){let o=s-j,l=Math.max(0,Math.ceil(o/U)),u=Math.min(L,(N+o)/U);for(let d=0;d<O;++d){let c=d-H,h=Math.max(0,Math.ceil(c/W)),C=Math.min(z,(R+c)/W),P=0;for(let n=a;n<i;++n){let a=n*B-r;for(let r=l;r<u;++r){let i=r*U-o;for(let s=h;s<C;++s){let o=x*e+A*n+v*r+w*s,l=S*(E-1-a)+T*(N-1-i)+_*(R-1-(s*W-c))+I*t;for(let e=0;e<$;++e)P+=b[o+e]*k[l+e]}}}p[m*e+f*n+g*s+y*d+t]=P}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},pv=ib(Ct,(e=>Math.cos(e))),mv={kernelName:Ct,backendName:"cpu",kernelFunc:pv},fv=ib(Et,(e=>Math.cosh(e))),gv={kernelName:Et,backendName:"cpu",kernelFunc:fv},yv={kernelName:Pt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:u}=r,[d,c,h,p]=a.shape,m=i.shape[0],[f,g]=o,y=Ws([m,f,g,p],"float32"),b=n.data.get(i.dataId).values,x=n.data.get(s.dataId).values,A=n.data.get(a.dataId).values,v=Sa.computeStrides(a.shape),w=Sa.computeStrides(y.shape);for(let e=0;e<m;e++){let t=4*e,n=b[t],r=b[t+1],a=b[t+2],i=b[t+3],s=x[e];if(s>=d)continue;let o=f>1?(a-n)*(c-1)/(f-1):0,m=g>1?(i-r)*(h-1)/(g-1):0;for(let t=0;t<f;t++){let d=f>1?n*(c-1)+t*o:.5*(n+a)*(c-1);if(d<0||d>c-1)for(let n=0;n<g;n++)for(let r=0;r<p;r++){let a=r+n*w[2]+t*w[1]+e*w[0];y.values[a]=u}else if("bilinear"===l){let n=Math.floor(d),a=Math.ceil(d),o=d-n;for(let l=0;l<g;l++){let d=g>1?r*(h-1)+l*m:.5*(r+i)*(h-1);if(d<0||d>h-1){for(let n=0;n<p;n++){let r=n+l*w[2]+t*w[1]+e*w[0];y.values[r]=u}continue}let c=Math.floor(d),f=Math.ceil(d),b=d-c;for(let r=0;r<p;r++){let i=r+c*v[2]+n*v[1]+s*v[0],u=A[i];i=r+f*v[2]+n*v[1]+s*v[0];let d=A[i];i=r+c*v[2]+a*v[1]+s*v[0];let h=A[i];i=r+f*v[2]+a*v[1]+s*v[0];let p=u+(d-u)*b,m=h+(A[i]-h)*b;i=r+l*w[2]+t*w[1]+e*w[0],y.values[i]=p+(m-p)*o}}}else for(let n=0;n<g;++n){let a=g>1?r*(h-1)+n*m:.5*(r+i)*(h-1);if(a<0||a>h-1){for(let r=0;r<p;r++){let a=r+n*w[2]+t*w[1]+e*w[0];y.values[a]=u}continue}let o=Math.round(a),l=Math.round(d);for(let r=0;r<p;r++){let a=r+o*v[2]+l*v[1]+s*v[0],i=r+n*w[2]+t*w[1]+e*w[0];y.values[i]=A[a]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},bv={kernelName:Nt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;Ny(a,"cumprod");let l=$m.getAxesPermutation([i],a.shape.length),u=a;null!=l&&(u=ox({inputs:{x:a},backend:n,attrs:{perm:l}}));let d=$m.getInnerMostAxes(1,a.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);let c=gi(u.dtype,"int32"),h=Sa.makeOnesTypedArray(Sa.sizeFromShape(u.shape),c),p=n.data.get(u.dataId).values,m=u.shape[u.shape.length-1],f=o?(e,t)=>e+m-t-1:(e,t)=>e+t;for(let e=0;e<p.length;e+=m)for(let t=0;t<m;t++){let n=f(e,t);if(0===t)h[n]=s?1:p[n];else{let r=f(e,t-1);h[n]=s?p[r]*h[r]:p[n]*h[r]}}let g=n.makeTensorInfo(u.shape,c,h);if(null!=l){let e=ox({inputs:{x:g},backend:n,attrs:{perm:$m.getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),e}return g}},xv={kernelName:Rt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;Ny(a,"cumsum");let l=$m.getAxesPermutation([i],a.shape.length),u=a;null!=l&&(u=ox({inputs:{x:a},backend:n,attrs:{perm:l}}));let d=$m.getInnerMostAxes(1,a.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);let c=gi(u.dtype,"int32"),h=Sa.makeZerosTypedArray(Sa.sizeFromShape(u.shape),c),p=n.data.get(u.dataId).values,m=u.shape[u.shape.length-1],f=o?(e,t)=>e+m-t-1:(e,t)=>e+t;for(let e=0;e<p.length;e+=m)for(let t=0;t<m;t++){let n=f(e,t);if(0===t)h[n]=s?0:p[n];else{let r=f(e,t-1);h[n]=s?p[r]+h[r]:p[n]+h[r]}}let g=n.makeTensorInfo(u.shape,c,h);if(null!=l){let e=ox({inputs:{x:g},backend:n,attrs:{perm:$m.getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),e}return g}},Av={kernelName:Dt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r;if(1===a.shape.length){let e=Qy(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,e)}if(2===a.shape.length){let e=eb(n.bufferSync(a),n.bufferSync(i),s,o);return n.makeTensorInfo(e.shape,i.dtype,e.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}},vv={kernelName:Mt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r;Sa.assert("NHWC"===s,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`));let o=a.shape[0],l=a.shape[1],u=a.shape[2],d=a.shape[3],c=l*i,h=u*i,p=d/(i*i),m=n.data.get(a.dataId).values,f=new Float32Array(o*c*h*p),g=0;for(let e=0;e<o;++e)for(let t=0;t<c;++t){let n=Math.floor(t/i),r=t%i;for(let t=0;t<h;++t){let a=Math.floor(t/i),s=(r*i+t%i)*p;for(let t=0;t<p;++t){let r=t+s+d*(a+u*(n+l*e));f[g++]=m[r]}}}return n.makeTensorInfo([o,c,h,p],a.dtype,f)}};function wv(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:u}=r;Ny([a,i],"depthwiseConv2DNative");let d=Sa.computeStrides(a.shape),c=Sa.computeStrides(i.shape),h=l;null==h&&(h=[1,1]),Sa.assert($m.eitherStridesOrDilationsAreOne(s,h),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${h}'`));let p=$m.computeConv2DInfo(a.shape,i.shape,s,h,o,u,!0),{filterHeight:m,filterWidth:f,dilationHeight:g,dilationWidth:y,padInfo:b}=p,x=b.left,A=b.top,v=p.outChannels/p.inChannels,w=new ri(p.outShape,a.dtype),k=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,T=w.values;for(let e=0;e<p.batchSize;++e){let t=e*d[0],n=e*w.strides[0];for(let e=0;e<p.outHeight;++e){let r=n+e*w.strides[1],a=e*p.strideHeight-A;for(let e=0;e<m;++e){let n=a+e*g;if(n<0||n>=p.inHeight)continue;let i=e*c[0],s=t+n*d[1];for(let e=0;e<p.outWidth;++e){let t=r+e*w.strides[2],n=e*p.strideWidth-x;for(let e=0;e<f;++e){let r=n+e*y;if(r<0||r>=p.inWidth)continue;let a=i+e*c[1],o=s+r*p.inChannels,l=t,u=a;for(let e=0;e<p.inChannels;++e){let t=k[o+e];for(let e=0;e<v;++e)T[l+e]+=t*S[u+e];l+=v,u+=v}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var kv={kernelName:Ot,backendName:"cpu",kernelFunc:wv},Sv={kernelName:$t,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,filterShape:d}=r;Ny([a,i],"depthwiseConv2dNativeBackpropFilter");let c=$m.computeConv2DInfo(a.shape,d,s,o,l,u,!0),{strideHeight:h,strideWidth:p,filterHeight:m,filterWidth:f}=c,g=new ri(c.filterShape,"float32"),y=c.padInfo.left,b=c.padInfo.top,x=c.outChannels/c.inChannels,A=n.data.get(a.dataId).values,v=new ri(a.shape,a.dtype,A),w=n.data.get(i.dataId).values,k=new ri(i.shape,i.dtype,w);for(let e=0;e<m;++e){let t=Math.max(0,Math.ceil((b-e)/h)),n=Math.min(c.outHeight,(c.inHeight+b-e)/h);for(let r=0;r<f;++r){let a=Math.max(0,Math.ceil((y-r)/p)),i=Math.min(c.outWidth,(c.inWidth+y-r)/p);for(let s=0;s<c.outChannels;++s){let o=Math.trunc(s/x),l=s%x,u=0;for(let l=0;l<c.batchSize;++l)for(let d=t;d<n;++d){let t=e+d*h-b;for(let e=a;e<i;++e){let n=r+e*p-y;u+=v.get(l,t,n,o)*k.get(l,d,e,s)}}g.set(u,e,r,o,l)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},Tv={kernelName:Ft,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,inputShape:d}=r;Ny([a,i],"depthwiseConv2DNativeBackpropInput");let c=Sa.computeStrides(a.shape),h=Sa.computeStrides(i.shape),p=$m.computeConv2DInfo(d,i.shape,s,o,l,u,!0),m=new ri(p.inShape,"float32"),f=m.values,[g,y,b]=m.strides,x=n.data.get(a.dataId).values,[A,v,w]=c,k=n.data.get(i.dataId).values,[S,T,_]=h,{batchSize:I,filterHeight:C,filterWidth:E,inChannels:N,inHeight:R,inWidth:P,outChannels:D,outHeight:M,outWidth:O,strideHeight:$,strideWidth:F}=p,L=C-1-p.padInfo.top,z=E-1-p.padInfo.left,B=D/N;for(let e=0;e<I;++e)for(let t=0;t<N;++t)for(let n=0;n<R;++n){let r=n-L,a=Math.max(0,Math.ceil(r/$)),i=Math.min(M,(C+r)/$);for(let s=0;s<P;++s){let o=s-z,l=Math.max(0,Math.ceil(o/F)),u=Math.min(O,(E+o)/F),d=0;for(let n=a;n<i;++n){let a=n*$-r;for(let r=l;r<u;++r){let i=A*e+v*n+w*r,s=S*(C-1-a)+T*(E-1-(r*F-o))+_*t;for(let e=0;e<B;++e)d+=x[i+(t*B+e)]*k[s+e]}}f[g*e+y*n+b*s+t]=d}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},_v={kernelName:Lt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,a=Sa.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,s=Ws([a,a],r.dtype),o=s.values;for(let e=0;e<i.length;e++)o[e*a+e]=i[e];let l=[...r.shape,...r.shape];return n.makeTensorInfo(l,s.dtype,s.values)}},Iv={kernelName:zt,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a}=e,{strides:i,pad:s,dilations:o}=n,l=t,u=l.data.get(r.dataId).values,d=r.shape.length,c=l.data.get(a.dataId).values,h=a.shape.length,{batchSize:p,inHeight:m,inWidth:f,inChannels:g,outHeight:y,outWidth:b,padInfo:x,strideHeight:A,strideWidth:v,filterHeight:w,filterWidth:k,dilationHeight:S,dilationWidth:T,outShape:_}=$m.computeDilation2DInfo(r.shape,a.shape,i,s,"NHWC",o),I=Sa.sizeFromShape(_),C=_.length,E=Sa.getArrayFromDType(r.dtype,I);for(let e=0;e<p;++e)for(let t=0;t<y;++t){let n=t*A-x.top;for(let i=0;i<b;++i){let s=i*v-x.left;for(let o=0;o<g;++o){let l=Number.MIN_SAFE_INTEGER;for(let t=0;t<w;++t){let i=n+t*S;if(i>=0&&i<m)for(let n=0;n<k;++n){let p=s+n*T;if(p>=0&&p<f){let s=Sa.locToIndex([e,i,p,o],d,Sa.computeStrides(r.shape)),m=Sa.locToIndex([t,n,o],h,Sa.computeStrides(a.shape)),f=u[s]+c[m];f>l&&(l=f)}}}E[Sa.locToIndex([e,t,i,o],C,Sa.computeStrides(_))]=l}}}return{dataId:l.write(Sa.toTypedArray(E,r.dtype),_,r.dtype),shape:_,dtype:r.dtype}}},Cv={kernelName:Ut,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:i}=e,{strides:s,pad:o,dilations:l}=n,u=t,d=Sa.toNestedArray(r.shape,u.data.get(r.dataId).values),c=Sa.toNestedArray(a.shape,u.data.get(a.dataId).values),{batchSize:h,inHeight:p,inWidth:m,inChannels:f,outHeight:g,outWidth:y,padInfo:b,strideHeight:x,strideWidth:A,filterHeight:v,filterWidth:w,dilationHeight:k,dilationWidth:S,outShape:T}=$m.computeDilation2DInfo(r.shape,a.shape,s,o,"NHWC",l);Sa.assert(i.rank===T.length,(()=>`Error in ${Ut}, dy must have the same rank as output ${T.length}, but got ${i.rank}`));let _=Sa.toNestedArray(T,u.data.get(i.dataId).values),I=Sa.makeZerosNestedTypedArray(a.shape,a.dtype);for(let e=0;e<h;++e)for(let t=0;t<g;++t){let n=t*x-b.top;for(let r=0;r<y;++r){let a=r*A-b.left;for(let i=0;i<f;++i){let s=Number.MIN_SAFE_INTEGER,o=0,l=0;for(let t=0;t<v;++t){let r=n+t*k;if(r>=0&&r<p)for(let n=0;n<w;++n){let u=a+n*S;if(u>=0&&u<m){let a=d[e][r][u][i]+c[t][n][i];a>s&&(s=a,o=t,l=n)}}}I[o][l][i]+=_[e][t][r][i]}}}return{dataId:u.write(Sa.toTypedArray(I,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},Ev={kernelName:Bt,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:i}=e,{strides:s,pad:o,dilations:l}=n,u=t,d=Sa.toNestedArray(r.shape,u.data.get(r.dataId).values),c=Sa.toNestedArray(a.shape,u.data.get(a.dataId).values),{batchSize:h,inHeight:p,inWidth:m,inChannels:f,outHeight:g,outWidth:y,padInfo:b,strideHeight:x,strideWidth:A,filterHeight:v,filterWidth:w,dilationHeight:k,dilationWidth:S,outShape:T}=$m.computeDilation2DInfo(r.shape,a.shape,s,o,"NHWC",l);Sa.assert(i.rank===T.length,(()=>`Error in ${Bt}, dy must have the same rank as output ${T.length}, but got ${i.rank}`));let _=Sa.toNestedArray(T,u.data.get(i.dataId).values),I=Sa.makeZerosNestedTypedArray(r.shape,r.dtype);for(let e=0;e<h;++e)for(let t=0;t<g;++t){let n=t*x-b.top;for(let r=0;r<y;++r){let a=r*A-b.left;for(let i=0;i<f;++i){let s=Number.MIN_SAFE_INTEGER,o=n<0?0:n,l=a<0?0:a;for(let t=0;t<v;++t){let r=n+t*k;if(r>=0&&r<p)for(let n=0;n<w;++n){let u=a+n*S;if(u>=0&&u<m){let a=d[e][r][u][i]+c[t][n][i];a>s&&(s=a,o=r,l=u)}}}I[e][o][l][i]+=_[e][t][r][i]}}}return{dataId:u.write(Sa.toTypedArray(I,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Nv={kernelName:Wt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:i,options:s}=r,{contextOptions:o,imageOptions:l}=s||{},u=(null==l?void 0:l.alpha)||1,d=(null==o?void 0:o.contextType)||"2d";if("2d"!==d)throw new Error(`Context type ${o.contextType} is not supported by the CPU backend.`);let c=i.getContext(d,(null==o?void 0:o.contextAttributes)||{});if(null==c)throw new Error(`Could not get the context with ${d} type.`);let[h,p]=a.shape.slice(0,2),m=2===a.shape.length?1:a.shape[2],f=n.data.get(a.dataId).values,g="float32"===a.dtype?255:1,y=new Uint8ClampedArray(p*h*4);for(let e=0;e<h*p;++e){let t=[0,0,0,255*u];for(let n=0;n<m;n++){let r=f[e*m+n];if("float32"===a.dtype){if(r<0||r>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${r}.`)}else if("int32"===a.dtype&&(r<0||r>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${r}.`);1===m?(t[0]=r*g,t[1]=r*g,t[2]=r*g):t[n]=r*g}let n=4*e;y[n+0]=Math.round(t[0]),y[n+1]=Math.round(t[1]),y[n+2]=Math.round(t[2]),y[n+3]=Math.round(t[3])}i.width=p,i.height=h;let b=new ImageData(y,p,h);return c.putImageData(b,0,0),a}};function Rv(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{axis:s,keepDims:o}=a;Ny(i,"sum"),t="bool"===i.dtype?Hy({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):By({inputs:{x:i},backend:r});let l=t.shape.length,u=Sa.parseAxisParam(s,t.shape),d=$m.getAxesPermutation(u,l),c=u,h=t;null!=d&&(h=ox({inputs:{x:t},backend:r,attrs:{perm:d}}),c=$m.getInnerMostAxes(c.length,l)),$m.assertAxesAreInnerMostDims("sum",c,h.shape.length);let[p,m]=$m.computeOutAndReduceShapes(h.shape,c),f=zy(r,p,$m.upcastType(h.dtype,"int32")),g=Sa.sizeFromShape(m),y=r.data.get(f.dataId).values,b=r.data.get(h.dataId).values;for(let e=0;e<y.length;++e){let t=e*g,n=0;for(let e=0;e<g;++e)n+=b[t+e];y[e]=n}if(o){let e=f;f=yA({inputs:{x:f},backend:r,attrs:{shape:$m.expandShapeToKeepDim(f.shape,u)}}),r.disposeIntermediateTensorInfo(e)}return r.disposeIntermediateTensorInfo(t),null!=d&&r.disposeIntermediateTensorInfo(h),f}var Pv={kernelName:Rr,backendName:"cpu",kernelFunc:Rv},Dv={kernelName:jt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=$m.decodeEinsumEquation(a,i.length);$m.checkEinsumDimSizes(s.length,l,i);let{path:u,steps:d}=$m.getEinsumComputePath(o,l),c=d.length,h=null,p=s.length,m=[];for(let e=0;e<c;++e){for(let t of d[e]){let e,{permutationIndices:r,expandDims:a}=$m.getEinsumPermutation(p,l[t]);$m.isIdentityPermutation(r)?e=i[t]:(e=ox({inputs:{x:i[t]},backend:n,attrs:{perm:r}}),m.push(e));let s=e.shape.slice();for(let e=0;e<a.length;++e)s.splice(a[e],0,1);Sa.arraysEqual(e.shape,s)||(e=yA({inputs:{x:e},backend:n,attrs:{shape:s}}),m.push(e)),null===h?h=e:(h=Qb({inputs:{a:e,b:h},backend:n}),m.push(h))}e<c-1&&(u[e]>=0&&(h=Rv({inputs:{x:h},backend:n,attrs:{axis:u[e]-(s.length-p),keepDims:!1}}),m.push(h)),p--)}for(let e of m)e!==h&&n.disposeIntermediateTensorInfo(e);return h}},Mv={kernelName:Gt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t;Ny([r,a],"eluGrad");let i=new Float32Array(Sa.sizeFromShape(a.shape)),s=n.data.get(a.dataId).values,o=n.data.get(r.dataId).values;for(let e=0;e<s.length;++e){let t=s[e];i[e]=t>=0?o[e]:o[e]*(t+1)}return n.makeTensorInfo(a.shape,"float32",i)}},Ov=$m.ERF_P,$v=$m.ERF_A1,Fv=$m.ERF_A2,Lv=$m.ERF_A3,zv=$m.ERF_A4,Bv=$m.ERF_A5,Uv=ib(qt,(e=>{let t=Math.sign(e),n=Math.abs(e),r=1/(1+Ov*n);return t*(1-((((Bv*r+zv)*r+Lv)*r+Fv)*r+$v)*r*Math.exp(-n*n))})),Wv={kernelName:qt,backendName:"cpu",kernelFunc:Uv};function Vv(e){let{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:i}=r,s=a.shape.length,o=a.shape.slice(),l=i;return i<0&&(Sa.assert(-(s+1)<=i,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),l=s+i+1),o.splice(l,0,1),yA({inputs:{x:a},backend:n,attrs:{shape:o}})}var jv={kernelName:Zt,backendName:"cpu",kernelFunc:Vv},Hv=$y(((e,t)=>e/t)),Gv=qy(Vt,Hv),qv={kernelName:Vt,backendName:"cpu",kernelFunc:Gv};function Xv(e,t,n){let r=e.shape,a=r[0],i=r[1],s=n.data.get(e.dataId),o=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,u=[a,i],d=Sa.sizeFromShape(u),c=Sa.getTypedArrayFromDType("float32",d),h=Sa.getTypedArrayFromDType("float32",d);for(let e=0;e<a;e++){let r=Ex({inputs:{x:o},backend:n,attrs:{begin:[e,0],size:[1,i]}}),a=Ex({inputs:{x:l},backend:n,attrs:{begin:[e,0],size:[1,i]}}),s=Fy({inputs:{real:r,imag:a},backend:n}),{real:u,imag:d}=Kv(s,t,n),p=$m.mergeRealAndImagArrays(u,d);for(let t=0;t<i;t++){let n=$m.getComplexWithIndex(p,t);c[e*i+t]=n.real,h[e*i+t]=n.imag}n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s)}let p=n.makeTensorInfo(u,"float32",c),m=n.makeTensorInfo(u,"float32",h),f=Fy({inputs:{real:p,imag:m},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),f}function Kv(e,t,n){let r=Sa.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0==(e&e-1)}(r)){let a=Zv(i,s,r,t,n),o=[e.shape[0],e.shape[1]];if(t){let e=n.makeTensorInfo(o,"float32",a.real),t=n.makeTensorInfo(o,"float32",a.imag),i=n.makeTensorInfo([],"float32",Sa.createScalarValue(r,"float32")),s=By({inputs:{x:i},backend:n}),l=qv.kernelFunc({inputs:{a:e,b:i},backend:n}),u=qv.kernelFunc({inputs:{a:t,b:s},backend:n}),d=n.data.get(l.dataId).values,c=n.data.get(u.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),{real:d,imag:c}}return a}{let e=function(e,t,n){let r=new Float32Array(2*t);for(let a=0;a<t;a++){let i=0,s=0;for(let r=0;r<t;r++){let o=$m.exponent(a*r,t,n),l=$m.getComplexWithIndex(e,r);i+=l.real*o.real-l.imag*o.imag,s+=l.real*o.imag+l.imag*o.real}n&&(i/=t,s/=t),$m.assignToTypedArray(r,i,s,a)}return r}($m.mergeRealAndImagArrays(i,s),r,t);return $m.splitRealAndImagArrays(e)}}function Zv(e,t,n,r,a){if(1===n)return{real:e,imag:t};let i=$m.mergeRealAndImagArrays(e,t),s=n/2,o=$m.complexWithEvenIndex(i),l=o.real,u=o.imag,d=[l.length],c=a.makeTensorInfo(d,"float32",l),h=a.makeTensorInfo(d,"float32",u),p=Fy({inputs:{real:c,imag:h},backend:a}),m=$m.complexWithOddIndex(i),f=m.real,g=m.imag,y=[f.length],b=a.makeTensorInfo(y,"float32",f),x=a.makeTensorInfo(y,"float32",g),A=Fy({inputs:{real:b,imag:x},backend:a}),v=Zv(l,u,s,r,a),w=v.real,k=v.imag,S=[w.length],T=a.makeTensorInfo(S,"float32",w),_=a.makeTensorInfo(S,"float32",k),I=Fy({inputs:{real:T,imag:_},backend:a}),C=Zv(f,g,s,r,a),E=C.real,N=C.imag,R=[E.length],P=a.makeTensorInfo(R,"float32",E),D=a.makeTensorInfo(R,"float32",N),M=Fy({inputs:{real:P,imag:D},backend:a}),O=$m.exponents(n,r),$=[O.real.length],F=a.makeTensorInfo($,"float32",O.real),L=a.makeTensorInfo($,"float32",O.imag),z=Fy({inputs:{real:F,imag:L},backend:a}),B=Qb({inputs:{a:z,b:M},backend:a}),U=Yy({inputs:{a:I,b:B},backend:a}),W=Yx({inputs:{a:I,b:B},backend:a}),V=Wy({inputs:{input:U},backend:a}),j=Wy({inputs:{input:W},backend:a}),H=nv({inputs:{input:U},backend:a}),G=nv({inputs:{input:W},backend:a}),q=av({inputs:[V,j],backend:a,attrs:{axis:0}}),X=av({inputs:[H,G],backend:a,attrs:{axis:0}}),K=a.data.get(q.dataId).values,Z=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(c),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(X),{real:K,imag:Z}}var Yv={kernelName:Jt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t,a=Sa.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=yA({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),o=Xv(s,!1,n),l=yA({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}};function Jv(e){let{backend:t,attrs:n}=e,{shape:r,value:a,dtype:i}=n,s=i||Sa.inferDtype(a),o=Sa.getArrayFromDType(s,Sa.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,s,o)}var Qv={kernelName:Qt,backendName:"cpu",kernelFunc:Jv},ew={kernelName:en,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,a=n,i=Sa.getTypedArrayFromDType(r.dtype,Sa.sizeFromShape(r.shape)),[s,o,l,u]=r.shape,d=a.data.get(r.dataId).values;for(let e=0;e<s;e++){let t=e*l*o*u;for(let e=0;e<o;e++){let n=e*(l*u);for(let e=0;e<l;e++){let r=e*u;for(let a=0;a<u;a++){let s=Math.round(l-e-1),o=t+n+r+a,c=d[o];s>=0&&s<l&&(c=d[t+n+s*u+a]),i[o]=c}}}}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},tw={kernelName:ua,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:d,dilations:c,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=r,f=sv({inputs:{x:a,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:d,dilations:c,dimRoundingMode:h}});if(s){let e=f;if("NCHW"===d&&1===s.shape.length&&1!==s.shape[0]){let e=yA({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});f=Yy({inputs:{a:f,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else f=Yy({inputs:{a:f,b:s},backend:n});n.disposeIntermediateTensorInfo(e)}if(p){let e=f;if("NCHW"===d&&"prelu"===p&&1===o.shape.length&&1!==o.shape[0]){let e=yA({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});f=gA(n,f,p,e,m),n.disposeIntermediateTensorInfo(e)}else f=gA(n,f,p,o,m);n.disposeIntermediateTensorInfo(e)}return f}},nw={kernelName:da,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:d,dilations:c,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=r,f=wv({inputs:{x:a,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:d,dilations:c,dimRoundingMode:h}});if(s){let e=f;f=Yy({inputs:{a:f,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){let e=f;f=gA(n,f,p,o,m),n.disposeIntermediateTensorInfo(e)}return f}},rw={kernelName:sn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=Sa.sizeFromShape(r.shape),s=a.shape,o=s[s.length-1],[l,u,d,c]=$m.prepareAndValidate(r,a);if(0===u)return n.makeTensorInfo(l,r.dtype,[]);let h=_b(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,u,o,d,c,r.shape,i);return n.makeTensorInfo(l,r.dtype,h.values)}},aw={kernelName:an,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r;Ny([a,i],"gatherV2");let l=Sa.parseAxisParam(s,a.shape)[0],u=n.data.get(i.dataId).values,d=a.shape[l];for(let e=0;e<u.length;++e){let t=u[e];Sa.assert(t<=d-1&&t>=0,(()=>`GatherV2: the index value ${t} is not in [0, ${d-1}]`))}let c=o;null==o&&(c=0);let h=Sa.sizeFromShape(i.shape),p=$m.segment_util.collectGatherOpShapeInfo(a,i,l,c),m=yA({inputs:{x:a},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),f=yA({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,h/p.batchSize]}}),g=[p.batchSize,p.outerSize,h/p.batchSize,p.sliceSize],y=n.bufferSync(f),b=Ib(n.bufferSync(m),y,g);return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(p.outputShape,b.dtype,b.values)}},iw={kernelName:dn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t,a=Sa.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=yA({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),o=Xv(s,!0,n),l=yA({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}},sw=ib(hn,(e=>Number.isFinite(e)?1:0),"bool"),ow={kernelName:hn,backendName:"cpu",kernelFunc:sw},lw=ib(pn,(e=>Math.abs(e)===1/0?1:0),"bool"),uw={kernelName:pn,backendName:"cpu",kernelFunc:lw},dw=ib(mn,(e=>Number.isNaN(e)?1:0),"bool"),cw={kernelName:mn,backendName:"cpu",kernelFunc:dw},hw={kernelName:bn,backendName:"cpu",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=Bb(r,a,i);return t.makeTensorInfo([s.length],"float32",s)}},pw=ib(An,(e=>Math.log1p(e))),mw={kernelName:An,backendName:"cpu",kernelFunc:pw},fw=$y(((e,t)=>e&&t)),gw=qy(vn,fw,null,"bool"),yw={kernelName:vn,backendName:"cpu",kernelFunc:gw},bw=ib(wn,(e=>e?0:1),"bool"),xw={kernelName:wn,backendName:"cpu",kernelFunc:bw},Aw=$y(((e,t)=>e||t)),vw=qy(kn,Aw,null,"bool"),ww={kernelName:kn,backendName:"cpu",kernelFunc:vw},kw={kernelName:In,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r;Ny(a,"LRN");let u=a.shape[3],d=u-1,c=n.data.get(a.dataId).values,h=Sa.sizeFromShape(a.shape),p=new Float32Array(h);function m(e){let t=e%u,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,d),a=0;for(;n<=r;n++){let e=c[n];a+=e*e}return a}for(let e=0;e<h;e++){let t=m(e),n=c[e]*Math.pow(s+o*t,-l);p[e]=n}return n.makeTensorInfo(a.shape,a.dtype,p)}},Sw={kernelName:Cn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:u,beta:d}=r;Ny(s,"LRNGrad");let c=Sa.sizeFromShape(s.shape),h=s.shape[3],p=n.data.get(s.dataId).values,m=n.data.get(a.dataId).values,f=n.data.get(i.dataId).values,g=new Float32Array(c),y=c;for(let e=0;e<y;e++){let t=e%h,n=e-t+Math.max(0,t-o),r=e-t+Math.min(h,t+o+1),a=0;for(let e=n;e<r;e++)a+=Math.pow(m[e],2);a=u*a+l;for(let t=n;t<r;t++){let n=-2*u*d*m[t]*f[e]/a;e===t&&(n+=Math.pow(a,-d)),n*=p[e],g[t]+=n}}return n.makeTensorInfo(s.shape,a.dtype,g)}};function Tw(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r,o=n,l=a.shape,u=l.length,d=Sa.parseAxisParam(i,l),c=d,h=$m.getAxesPermutation(c,u),p=o.data.get(a.dataId).values;if(null!=h){let e=new Array(u);for(let t=0;t<e.length;t++)e[t]=l[h[t]];p=sx(p,l,a.dtype,h,e),c=$m.getInnerMostAxes(c.length,u),l=e}Ny(a,"max"),$m.assertAxesAreInnerMostDims("max",c,u);let[m,f]=$m.computeOutAndReduceShapes(l,c),g=jb(p,Sa.sizeFromShape(f),m,a.dtype),y=o.write(g,m,a.dtype),b=m;return s&&(b=$m.expandShapeToKeepDim(m,d)),{dataId:y,shape:b,dtype:a.dtype}}var _w={kernelName:Nn,backendName:"cpu",kernelFunc:Tw},Iw={kernelName:Pn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;Ny(a,"maxPool");let{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;Sa.assert($m.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));let u,d=$m.computePool2DInfo(a.shape,i,s,1,o,l);if(1===d.filterWidth&&1===d.filterHeight&&Sa.arraysEqual(d.inShape,d.outShape))u=By({inputs:{x:a},backend:n});else{let e=n.data.get(a.dataId).values,t=Sa.computeStrides(a.shape),r=WA(e,a.shape,a.dtype,t,d,"max");u=n.makeTensorInfo(d.outShape,a.dtype,r.values)}return u}},Cw={kernelName:Mn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r;Ny(a,"maxPool3d");let d=$m.computePool3DInfo(a.shape,i,s,1,o,l,u),c=jA(n.data.get(a.dataId).values,a.shape,a.dtype,Sa.computeStrides(a.shape),d,"max");return n.makeTensorInfo(c.shape,"float32",c.values)}},Ew={kernelName:On,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r;Ny([a,i],"maxPool3DGrad");let d=$m.computePool3DInfo(i.shape,s,o,1,l,u),c=function(e,t){let n=Ws(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,d=t.effectiveFilterHeight,c=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,m=t.padInfo.left;for(let f=0;f<t.batchSize;++f)for(let g=0;g<t.inChannels;++g)for(let y=0;y<t.outDepth;++y){let b=y*r-h,x=b;for(;x<0;)x+=s;let A=Math.min(t.inDepth,u+b);for(let r=0;r<t.outHeight;++r){let u=r*a-p,h=u;for(;h<0;)h+=o;let v=Math.min(t.inHeight,d+u);for(let a=0;a<t.outWidth;++a){let p=a*i-m,w=p;for(;w<0;)w+=l;let k=Math.min(t.inWidth,c+p),S=Number.NEGATIVE_INFINITY,T=-1;for(let t=x;t<A;t+=s){let n=t-b;for(let r=h;r<v;r+=o){let a=r-u;for(let i=w;i<k;i+=l){let s=i-p,o=e.get(f,t,r,i,g);o>=S&&(S=o,T=n*d*c+a*d+s)}}}n.set(T,f,y,r,a,g)}}}return n}(n.bufferSync(i),d),h=d.strideDepth,p=d.strideHeight,m=d.strideWidth,f=d.dilationDepth,g=d.dilationHeight,y=d.dilationWidth,b=d.effectiveFilterDepth,x=d.effectiveFilterHeight,A=d.effectiveFilterWidth,v=b-1-d.padInfo.front,w=A-1-d.padInfo.left,k=x-1-d.padInfo.top,S=Ws(i.shape,"float32"),T=n.bufferSync(a);for(let e=0;e<d.batchSize;++e)for(let t=0;t<d.inChannels;++t)for(let n=0;n<d.inDepth;++n)for(let r=0;r<d.inHeight;++r)for(let a=0;a<d.inWidth;++a){let i=n-v,s=r-k,o=a-w,l=0;for(let n=0;n<b;n+=f){let r=(i+n)/h;if(!(r<0||r>=d.outDepth||Math.floor(r)!==r))for(let a=0;a<x;a+=g){let i=(s+a)/p;if(!(i<0||i>=d.outHeight||Math.floor(i)!==i))for(let s=0;s<A;s+=y){let u=(o+s)/m;if(u<0||u>=d.outWidth||Math.floor(u)!==u)continue;let h=b*x*A-1-c.get(e,r,i,u,t)===n*x*A+a*A+s?1:0;0!==h&&(l+=T.get(e,r,i,u,t)*h)}}}S.set(l,e,n,r,a,t)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}},Nw={kernelName:Dn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;Ny([i,s],"maxPoolGrad");let{filterSize:l,strides:u,pad:d,dimRoundingMode:c}=r,h=$m.computePool2DInfo(o.shape,l,u,1,d,c),p=n.data.get(o.dataId).values,m=Ws(h.outShape,o.dtype,VA(p,o.shape,o.dtype,h).values),f=h.strideHeight,g=h.strideWidth,y=h.dilationHeight,b=h.dilationWidth,x=h.effectiveFilterHeight,A=h.effectiveFilterWidth,v=A-1-h.padInfo.left,w=x-1-h.padInfo.top,k=Ws(o.shape,"float32"),S=n.data.get(a.dataId).values,T=Ws(a.shape,"float32",S);for(let e=0;e<h.batchSize;++e)for(let t=0;t<h.inChannels;++t)for(let n=0;n<h.inHeight;++n)for(let r=0;r<h.inWidth;++r){let a=n-w,i=r-v,s=0;for(let n=0;n<x;n+=y){let r=(a+n)/f;if(!(r<0||r>=h.outHeight||Math.floor(r)!==r))for(let a=0;a<A;a+=b){let o=(i+a)/g;if(o<0||o>=h.outWidth||Math.floor(o)!==o)continue;let l=x*A-1-m.get(e,r,o,t)===n*A+a?1:0;0!==l&&(s+=T.get(e,r,o,t)*l)}}k.set(s,e,n,r,t)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}},Rw={kernelName:$n,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:i,pad:s,includeBatchInIndex:o}=t,l=n;Ny(r,"MaxPoolWithArgmax");let u=l.data.get(r.dataId).values,d=$m.computePool2DInfo(r.shape,a,i,[1,1],s),[c,h]=function(e,t,n,r,a){let i=WA(e,0,n,Sa.computeStrides(t),a,"max"),s=VA(e,t,n,a,!0,r);return[i.values,s.values]}(u,r.shape,r.dtype,o,d),p=l.write(c,d.outShape,r.dtype),m=l.write(h,d.outShape,r.dtype);return[{dataId:p,shape:d.outShape,dtype:r.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}},Pw={kernelName:Fn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=Sa.parseAxisParam(i,a.shape),l=$m.computeOutAndReduceShapes(a.shape,o)[1],u=Sa.sizeFromShape(l),d=[],c=n.makeTensorInfo([],"float32",new Float32Array([u]));d.push(c);let h=Hy({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});d.push(h);let p=Gv({inputs:{a:h,b:c},backend:n});d.push(p);let m=Rv({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:s}});return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),m}},Dw={kernelName:Ln,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;Ny(a,"min");let o=Sa.parseAxisParam(i,a.shape),l=o,u=$m.getAxesPermutation(l,a.shape.length),d=a;null!=u&&(d=ox({inputs:{x:a},backend:n,attrs:{perm:u}}),l=$m.getInnerMostAxes(l.length,a.shape.length)),$m.assertAxesAreInnerMostDims("min",l,d.shape.length);let[c,h]=$m.computeOutAndReduceShapes(d.shape,l),p=Sa.sizeFromShape(h),m=Sa.makeZerosTypedArray(Sa.sizeFromShape(c),d.dtype),f=n.data.get(d.dataId).values;for(let e=0;e<m.length;++e){let t=e*p,n=f[t];for(let e=0;e<p;++e){let r=f[t+e];(Number.isNaN(r)||r<n)&&(n=r)}m[e]=n}null!=u&&n.disposeIntermediateTensorInfo(d);let g=n.makeTensorInfo(c,d.dtype,m);if(s){let e=yA({inputs:{x:g},backend:n,attrs:{shape:$m.expandShapeToKeepDim(c,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}},Mw={kernelName:Bn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,mode:s}=r;Ny(a,"mirrorPad");let o=i.map(((e,t)=>e[0]+a.shape[t]+e[1])),l=i.map((e=>e[0])),u=i.map(((e,t)=>e[0]+a.shape[t])),d="reflect"===s?0:1,c=n.data.get(a.dataId).values,h=a.shape.length,p=Sa.computeStrides(a.shape),m=Sa.sizeFromShape(o),f=o.length,g=Sa.computeStrides(o),y=Sa.getTypedArrayFromDType(a.dtype,m);for(let e=0;e<m;e++){let t=Sa.indexToLoc(e,f,g);for(let e=0;e<f;e++)t[e]<l[e]?t[e]=2*l[e]-t[e]-d:t[e]>=u[e]&&(t[e]=2*(u[e]-1)-t[e]+d);t=t.map(((e,t)=>e-l[t]));let n=Sa.locToIndex(t,h,p);y[e]=c[n]}return{dataId:n.write(y,o,a.dtype),shape:o,dtype:a.dtype}}},Ow=$y(((e,t)=>{let n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),$w=qy(Un,Ow),Fw={kernelName:Un,backendName:"cpu",kernelFunc:$w},Lw=A(P());function zw(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=a.shape.length,o=i;if(-1===o&&(o=s-1),o!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${o}`);let l=Sa.parseAxisParam([o],a.shape),u=Tw({inputs:{x:a},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),d=$m.expandShapeToKeepDim(u.shape,l),c=yA({inputs:{x:u},backend:n,attrs:{shape:d}}),h=Yx({inputs:{a,b:c},backend:n}),p=fb({inputs:{x:h},backend:n}),m=Rv({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),f=yA({inputs:{x:m},backend:n,attrs:{shape:d}}),g=Gv({inputs:{a:p,b:f},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),g}var Bw={kernelName:Mr,backendName:"cpu",kernelFunc:zw},Uw={kernelName:Wn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r;Ny(a,"multinomial");let l=o?a:zw({inputs:{logits:a},backend:n,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],c=n.data.get(l.dataId).values,h=[u,i],p=Sa.makeZerosTypedArray(Sa.sizeFromShape(h),"int32");for(let e=0;e<u;++e){let t=e*d,n=new Float32Array(d-1);n[0]=c[t];for(let e=1;e<n.length;++e)n[e]=n[e-1]+c[t+e];let r=Lw.alea(s.toString()),a=e*i;for(let e=0;e<i;++e){let t=r();p[a+e]=n.length;for(let r=0;r<n.length;r++)if(t<n[r]){p[a+e]=r;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",p)}},Ww=Hf.nonMaxSuppressionV3Impl,Vw={kernelName:Gn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r;Ny(a,"NonMaxSuppression");let u=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,{selectedIndices:c}=Ww(u,d,s,o,l);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}},jw=Hf.nonMaxSuppressionV4Impl,Hw={kernelName:qn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:u}=r;Ny(a,"NonMaxSuppressionPadded");let d=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,{selectedIndices:h,validOutputs:p}=jw(d,c,s,o,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Gw=Hf.nonMaxSuppressionV5Impl,qw={kernelName:Xn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r;Ny(a,"NonMaxSuppressionWithScore");let d=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,h=s,p=o,m=l,f=u,{selectedIndices:g,selectedScores:y}=Gw(d,c,h,p,m,f);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}},Xw={kernelName:Zn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r;Ny(a,"oneHot");let u=Sa.sizeFromShape(a.shape),d=new Float32Array(u*s);d.fill(l);let c=n.data.get(a.dataId).values;for(let e=0;e<u;++e)c[e]>=0&&c[e]<s&&(d[e*s+c[e]]=o);return n.makeTensorInfo([...a.shape,s],i,d)}};function Kw(e){let{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){let e=Wy({inputs:{input:r},backend:n}),t=Kw({inputs:{x:e},backend:n}),a=nv({inputs:{input:r},backend:n}),i=Kw({inputs:{x:a},backend:n}),s=Fy({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return Jv({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var Zw={kernelName:aa,backendName:"cpu",kernelFunc:Kw},Yw={kernelName:Kn,backendName:"cpu",kernelFunc:function e(t){let{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){let t=Wy({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=nv({inputs:{input:a},backend:r}),s=Kw({inputs:{x:i},backend:r}),o=Fy({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}return Jv({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Jw(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return Vv({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let i=t[0].shape,s=t[0].dtype;t.forEach((e=>{Sa.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),Sa.assert(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));let o=[],l=av({inputs:t.map((e=>{let t=Vv({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t})),backend:n,attrs:{axis:a}});return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}var Qw={kernelName:Yn,backendName:"cpu",kernelFunc:Jw},ek={kernelName:Jn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;Ny(a,"pad");let o=i.map(((e,t)=>e[0]+a.shape[t]+e[1])),l=i.map((e=>e[0])),u=n.data.get(a.dataId).values,d=Sa.sizeFromShape(a.shape),c=a.shape.length,h=Sa.computeStrides(a.shape),p=Sa.sizeFromShape(o),m=o.length,f=Sa.computeStrides(o),g=Sa.getTypedArrayFromDType(a.dtype,p);0!==s&&g.fill(s);for(let e=0;e<d;e++){let t=Sa.indexToLoc(e,c,h).map(((e,t)=>e+l[t]));g[Sa.locToIndex(t,m,f)]=u[e]}return{dataId:n.write(g,o,a.dtype),shape:o,dtype:a.dtype}}},tk=$y(((e,t)=>Math.pow(e,t))),nk=qy(er,tk),rk={kernelName:er,backendName:"cpu",kernelFunc:nk},ak={kernelName:rr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:o}=r,l=a.map((e=>n.data.get(e.dataId).values)),u=a.map((e=>e.shape)),d=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,[h,p,m]=hx(l,u,d,i.shape,i.dtype,c,s.shape),f=h.map((e=>n.makeTensorInfo([e.length],"int32",e))),g=n.makeTensorInfo(m,i.dtype,p);return f.concat([g])}},ik={kernelName:ar,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[u,d]=mx(s,r.shape,r.dtype,o,a.shape,l,i.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([d.length],r.dtype,d)]}},sk={kernelName:ir,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,u=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,h=o.map((e=>n.data.get(e.dataId).values)),p=o.map((e=>e.shape)),[m,f]=xx(u,a.shape,d,i.shape,i.dtype,c,s.shape,h,p,l);return n.makeTensorInfo(m,i.dtype,f)}},ok={kernelName:sr,backendName:"cpu",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:a,dtype:i,step:s}=n,o=Ax(r,a,s,i);return t.makeTensorInfo([o.length],i,o)}},lk=ib(lr,(e=>1/e)),uk={kernelName:lr,backendName:"cpu",kernelFunc:lk},dk={kernelName:pr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r;Ny(a,"resizeBilinear");let l=Sa.computeStrides(a.shape),[u,d]=o,[c,h,p,m]=a.shape,f=n.data.get(a.dataId).values,g=new Float32Array(Sa.sizeFromShape([c,u,d,m])),y=[i&&u>1?h-1:h,i&&d>1?p-1:p],b=[i&&u>1?u-1:u,i&&d>1?d-1:d],x=0,A=y[0]/b[0],v=y[1]/b[1];for(let e=0;e<c;e++)for(let t=0;t<u;t++){let n;n=s?A*(t+.5)-.5:A*t;let r=Math.max(0,Math.floor(n)),a=n-r,i=Math.min(h-1,Math.ceil(n)),o=e*l[0]+r*l[1],u=e*l[0]+i*l[1];for(let e=0;e<d;e++){let t;t=s?v*(e+.5)-.5:v*e;let n=Math.max(0,Math.floor(t)),r=t-n,i=Math.min(p-1,Math.ceil(t)),d=o+n*l[2],c=u+n*l[2],h=o+i*l[2],y=u+i*l[2];for(let e=0;e<m;e++){let t=f[d+e],n=f[c+e],i=t+(f[h+e]-t)*r,s=i+(n+(f[y+e]-n)*r-i)*a;g[x++]=s}}}return n.makeTensorInfo([c,u,d,m],"float32",g)}},ck={kernelName:mr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r;Ny([i,a],"resizeBilinearGrad");let o=Sa.computeStrides(a.shape),[l,u,d,c]=a.shape,[,h,p]=i.shape,m=new Float32Array(l*u*d*c),f=[s&&h>1?u-1:u,s&&p>1?d-1:d],g=[s&&h>1?h-1:h,s&&p>1?p-1:p],y=f[0]/g[0],b=f[1]/g[1],x=n.data.get(i.dataId).values,A=0;for(let e=0;e<l;e++){let t=e*o[0];for(let e=0;e<h;e++){let n=e*y,r=Math.floor(n),a=Math.min(Math.ceil(n),u-1),i=t+r*o[1],s=t+a*o[1],l=n-r,h=1-l;for(let e=0;e<p;e++){let t=e*b,n=Math.floor(t),r=Math.min(Math.ceil(t),d-1),a=t-n,u=1-a,p=i+n*o[2],f=i+r*o[2],g=s+n*o[2],y=s+r*o[2],v=h*u,w=h*a,k=l*u,S=l*a;for(let e=0;e<c;e++){let t=x[A++];m[p+e]+=t*v,m[f+e]+=t*w,m[g+e]+=t*k,m[y+e]+=t*S}}}}return n.makeTensorInfo([l,d,u,c],"float32",m)}},hk={kernelName:cr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r;Ny(a,"resizeNearestNeighbor");let l=Sa.computeStrides(a.shape),[u,d]=o,[c,h,p,m]=a.shape,f=n.data.get(a.dataId).values,g=new Float32Array(c*u*d*m),y=[i&&u>1?h-1:h,i&&d>1?p-1:p],b=[i&&u>1?u-1:u,i&&d>1?d-1:d],x=y[0]/b[0],A=y[1]/b[1],v=0;for(let e=0;e<c;e++){let t=e*l[0];for(let e=0;e<u;e++){let n=s?x*(e+.5):x*e,r=Math.min(h-1,i?Math.round(n):Math.floor(n));s&&(r=Math.max(0,r));let a=t+r*l[1];for(let e=0;e<d;e++){let t=s?A*(e+.5):A*e,n=Math.min(p-1,i?Math.round(t):Math.floor(t));s&&(n=Math.max(0,n));let r=a+n*l[2];for(let e=0;e<m;e++){let t=f[r+e];g[v++]=t}}}}return n.makeTensorInfo([c,u,d,m],a.dtype,g)}},pk={kernelName:hr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r;Ny([i,a],"resizeNearestNeighborGrad");let o=Sa.computeStrides(a.shape),l=Sa.computeStrides(i.shape),[u,d,c,h]=a.shape,[,p,m]=i.shape,f=new Float32Array(u*d*c*h),g=n.data.get(i.dataId).values,y=[s&&p>1?d-1:d,s&&m>1?c-1:c],b=[s&&p>1?p-1:p,s&&m>1?m-1:m],x=y[0]/b[0],A=y[1]/b[1],v=1/x,w=1/A,k=2*Math.ceil(v)+2,S=2*Math.ceil(w)+2;for(let e=0;e<u;e++){let t=e*o[0];for(let e=0;e<d;e++){let n=t+e*o[1],r=Math.floor(e*v),a=Math.floor(r-k/2);for(let r=0;r<c;r++){let i=n+r*o[2],u=Math.floor(r*w),y=Math.floor(u-S/2);for(let n=0;n<h;n++){let o=0;for(let i=0;i<k;i++){let u=i+a;if(u<0||u>=p)continue;let h=t+u*l[1],f=u*x;if(e===Math.min(d-1,s?Math.round(f):Math.floor(f)))for(let e=0;e<S;e++){let t=e+y;if(t<0||t>=m)continue;let a=h+t*l[2],i=t*A;r===Math.min(c-1,s?Math.round(i):Math.floor(i))&&(o+=g[a+n])}}f[i+n]=o}}}}return n.makeTensorInfo(a.shape,a.dtype,f)}},mk={kernelName:gr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r;Ny(a,"reverse");let s=a.shape.length,o=Sa.parseAxisParam(i,a.shape);if(0===s)return By({inputs:{x:a},backend:n});let l=new ri(a.shape,a.dtype),u=n.bufferSync(a);for(let e=0;e<l.size;e++){let t=l.indexToLoc(e),n=t.slice();o.forEach((e=>n[e]=a.shape[e]-1-n[e])),l.set(u.get(...n),...t)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},fk={kernelName:oa,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:i,center:s}=t,o=n,l=Sa.getTypedArrayFromDType(r.dtype,Sa.sizeFromShape(r.shape)),[u,d,c,h]=r.shape,[p,m]=$m.getImageCenter(s,d,c),f=Math.sin(a),g=Math.cos(a),y=o.data.get(r.dataId).values;for(let e=0;e<u;e++){let t=e*c*d*h;for(let e=0;e<d;e++){let n=e*(c*h);for(let r=0;r<c;r++){let a=r*h;for(let s=0;s<h;s++){let o=[u,e,r,s],b=o[2],x=o[1],A=(b-p)*g-(x-m)*f,v=(b-p)*f+(x-m)*g;A=Math.round(A+p),v=Math.round(v+m);let w=i;"number"!=typeof i&&(w=3===s?255:i[s]),A>=0&&A<c&&v>=0&&v<d&&(w=y[t+v*(c*h)+A*h+s]),l[t+n+a+s]=w}}}}return{dataId:o.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},gk=ib(yr,(e=>{let t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1})),yk={kernelName:yr,backendName:"cpu",kernelFunc:gk},bk={kernelName:xr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:d,outputSize:c}=$m.calculateShapes(i,a,s),h=Sx(n.bufferSync(a),n.bufferSync(i),s,c,u,l,o,d,0,!0);return n.makeTensorInfo(s,h.dtype,h.values)}};function xk(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function Ak(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}var vk={kernelName:vr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=function(e,t,n,r,a,i){let s=Sa.getArrayFromDType("int32",n*a);for(let o=0;o<n;++o){let n=e.slice(o*r,(o+1)*r),l=o*a;for(let e=0;e<a;++e)s[l+e]="left"===i?xk(n,t[e+l]):Ak(n,t[e+l])}return s}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],s);return n.makeTensorInfo(i.shape,"int32",o)}},wk={kernelName:wr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t;Ny([r,a,i],"select");let s=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,d=gi(a.dtype,i.dtype),c=Sa.makeZerosTypedArray(Sa.sizeFromShape(a.shape),d),h=0,p=0===s||s>1||1===a.shape.length?1:Sa.sizeFromShape(a.shape.slice(1));for(let e=0;e<o.length;e++)for(let t=0;t<p;t++)1===o[e]?c[h++]=l[e]:c[h++]=u[e];return n.makeTensorInfo(a.shape,d,c)}},kk=$m.SELU_SCALEALPHA,Sk=$m.SELU_SCALE,Tk=ib(kr,(e=>e>=0?Sk*e:kk*(Math.exp(e)-1))),_k={kernelName:kr,backendName:"cpu",kernelFunc:Tk},Ik=ib(Ir,(e=>e<0?-1:e>0?1:0)),Ck={kernelName:Ir,backendName:"cpu",kernelFunc:Ik},Ek=ib(Tr,(e=>Math.sin(e))),Nk={kernelName:Tr,backendName:"cpu",kernelFunc:Ek},Rk=ib(_r,(e=>Math.sinh(e))),Pk={kernelName:_r,backendName:"cpu",kernelFunc:Rk},Dk=Math.log(1.1920928955078125e-7)+2,Mk=ib(Er,(e=>{let t,n=e>-Dk,r=e<Dk,a=Math.exp(e);return t=r?a:n?e:Math.log(1+a),t})),Ok={kernelName:Er,backendName:"cpu",kernelFunc:Mk},$k={kernelName:Pr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;Ny([a],"spaceToBatchND");let o=Sa.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let e=1+i.length;e<a.shape.length;++e)l.push([0,0]);let u=ek.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),d=$m.getReshaped(u.shape,i,o,!1),c=$m.getPermuted(d.length,i.length,!1),h=$m.getReshapedPermuted(u.shape,i,o,!1),p=yA({inputs:{x:u},backend:n,attrs:{shape:d}}),m=ox({inputs:{x:p},backend:n,attrs:{perm:c}}),f=yA({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),f}},Fk={kernelName:Or,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:s}=t;if(1!==i.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${i.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==a.shape.length)throw new Error(`Values must be a vector, saw:\n        ${a.shape}`);if(0!==s.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${s.shape}`);let o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,d=n.data.get(s.dataId).values[0],[c,h,p,m,f]=Rx(o,r.shape,r.dtype,l,a.dtype,u,d);return[n.makeTensorInfo(h,r.dtype,c),n.makeTensorInfo([h[0]],a.dtype,p),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map((e=>Number(e))))),n.makeTensorInfo([f.length],r.dtype,new Int32Array(f))]}},Lk={kernelName:$r,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==a.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${a.shape}`);if(1!==i.shape.length)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(n.data.get(a.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(i.dataId).values),[u,d,c]=Px(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(d,r.dtype,u),n.makeTensorInfo([c.length],i.dtype,new Int32Array(c))]}},zk={kernelName:Fr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${i.shape}`);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");let s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[u,d]=Dx(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(d,r.dtype,u)}},Bk={kernelName:Lr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${i.shape}`);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");let s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[u,d]=Dx(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(d,r.dtype,u)}},Uk={kernelName:zr,backendName:"cpu",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=n,{outputShape:l}=a,{sliceRank:u,numUpdates:d,sliceSize:c,strides:h,outputSize:p}=$m.calculateShapes(s,i,l),m=!1,f=r.bufferSync(i);switch(s.dtype){case"bool":t=Sx(f,r.bufferSync(s),l,p,c,d,u,h,!!r.data.get(o.dataId).values[0],m);break;case"float32":case"int32":t=Sx(f,r.bufferSync(s),l,p,c,d,u,h,r.data.get(o.dataId).values[0],m);break;case"string":t=Sx(f,r.bufferSync(s),l,p,c,d,u,h,Sa.decodeString(r.data.get(o.dataId).values[0]),m);break;default:throw new Error(`Unsupported type ${s.dtype}`)}return r.makeTensorInfo(l,t.dtype,t.values)}},Wk={kernelName:Dr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=Sa.parseAxisParam(s,a.shape)[0],l=$m.prepareSplitSize(a,i,o),u=new Array(a.shape.length).fill(0),d=a.shape.slice();return l.map((e=>{let t=[...d];t[o]=e;let r=Ex({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},Vk={kernelName:Ur,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{let{x:n}=e,r=t;Ny(n,"square");let a=r.data.get(n.dataId).values,i=new Float32Array(a.length);for(let e=0;e<a.length;++e){let t=a[e];i[e]=t*t}return{dataId:r.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},jk=ib(ia,((e,t)=>{let n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),Hk={kernelName:ia,backendName:"cpu",kernelFunc:jk},Gk={kernelName:Vr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:s,strides:o,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:c,shrinkAxisMask:h}=r;Ny(a,"stridedSlice");let p,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:x,end:A,strides:v}=dm.sliceInfo(a.shape,i,s,o,l,u,d,c,h);if(g)p=yA({inputs:{x:a},backend:n,attrs:{shape:f}});else if(y||b){Sa.assert(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));let e=dm.computeOutShape(x,A,v),t=Ex({inputs:{x:a},backend:n,attrs:{begin:x,size:e}});p=yA({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{let e=Vx(m,n.bufferSync(a),v,x);p=n.makeTensorInfo(f,e.dtype,e.values)}return p}},qk={kernelName:jr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:d,dataSplits:c}=t,h=n.data.get(d.dataId).values,p=n.data.get(c.dataId).values,[m,f]=Hx(h,p,a,i,s,o,l,u);return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(c.shape,"int32",f)]}},Xk={kernelName:Hr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:s}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(0!==s.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);let o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values[0],[u,d,c]=qx(o,l,a),h=d.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(c))]}},Kk={kernelName:Gr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let s=Xx(n.data.get(i.dataId).values,a);return n.makeTensorInfo(i.shape,"int32",s)}},Zk=ib(Xr,(e=>Math.tan(e))),Yk={kernelName:Xr,backendName:"cpu",kernelFunc:Zk},Jk=ib(Kr,(e=>Math.tanh(e))),Qk={kernelName:Ar,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:i}=t,{sliceRank:s,numUpdates:o,sliceSize:l,strides:u,outputSize:d}=$m.calculateShapes(i,a,r.shape),c=n.bufferSync(a),h=n.bufferSync(i),p=n.bufferSync(r),m=Sx(c,h,r.shape,d,l,o,s,u,p,!1);return n.makeTensorInfo(r.shape,m.dtype,m.values)}},eS={kernelName:Zr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;Ny(a,"tile");let s=Qx(n.bufferSync(a),i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}},tS={kernelName:Yr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r;Ny(a,"topk");let o=n.data.get(a.dataId).values,[l,u]=nA(o,a.shape,a.dtype,i,s);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}},nS={kernelName:Jr,backendName:"cpu",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:i}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:u}=n,[d,c,h,p]=a.shape,[m,f]=null!=u?u:[c,h],g=[d,m,f,p],y=Sa.computeStrides(a.shape),b=y[0],x=y[1],A=y[2],v=Sa.computeStrides(g),w=v[0],k=v[1],S=v[2],T=Sa.getTypedArrayFromDType(a.dtype,Sa.sizeFromShape(g));T.fill(l);let _=r.data.get(a.dataId).values,I=r.data.get(i.dataId).values;for(let e=0;e<d;++e){let t=1===i.shape[0]?I:I.subarray(8*e,8*e+8);for(let n=0;n<m;++n)for(let r=0;r<f;++r)for(let a=0;a<p;++a){let i,u=t[6]*r+t[7]*n+1;if(0===u)continue;let d=(t[0]*r+t[1]*n+t[2])/u,p=(t[3]*r+t[4]*n+t[5])/u,m=rS(d,h,o),f=rS(p,c,o);switch(s){case"nearest":i=iS(_,c,h,b,x,A,e,f,m,a,l);break;case"bilinear":i=sS(_,c,h,b,x,A,e,f,m,a,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}T[e*w+n*k+r*S+a]=i}return r.makeTensorInfo(g,a.dtype,T)}return{dataId:r.write(T,g,a.dtype),shape:a.shape,dtype:a.dtype}}};function rS(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{let e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return Sa.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{let e=t-1;n-=t*Math.trunc(n/e)}return Sa.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Sa.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function aS(e,t,n,r,a,i,s,o,l,u,d){return 0<=o&&o<t&&0<=l&&l<n?e[s*r+o*a+l*i+u]:d}function iS(e,t,n,r,a,i,s,o,l,u,d){return aS(e,t,n,r,a,i,s,Math.round(o),Math.round(l),u,d)}function sS(e,t,n,r,a,i,s,o,l,u,d){let c=Math.floor(o),h=Math.floor(l),p=c+1,m=h+1;return(p-o)*((m-l)*aS(e,t,n,r,a,i,s,c,h,u,d)+(l-h)*aS(e,t,n,r,a,i,s,c,m,u,d))+(o-c)*((m-l)*aS(e,t,n,r,a,i,s,p,h,u,d)+(l-h)*aS(e,t,n,r,a,i,s,p,m,u,d))}var oS={kernelName:ea,backendName:"cpu",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;Ny(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:o,outputShape:l,indices:u}=rA(s,a,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,o),r.makeTensorInfo([u.length],"int32",u)]}},lS={kernelName:ta,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:i}=r;i<0&&(i+=a.shape.length);let s=a.shape.length,o=a.shape[i],l=new Array(s-1),u=0;for(let e=0;e<s;e++)e!==i&&(l[u++]=a.shape[e]);let d=new Array(s).fill(0),c=a.shape.slice();c[i]=1;let h=new Array(o);for(let e=0;e<h.length;e++){d[i]=e;let t=Ex({inputs:{x:a},backend:n,attrs:{begin:d,size:c}});h[e]=yA({inputs:{x:t},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(t)}return h}},uS={kernelName:na,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r;Ny(a,"unsortedSegmentSum");let o=[],l=[],u=a.shape.length-i.shape.length,d=i;for(let e=0;e<u;++e){let t=Vv({inputs:{input:d},backend:n,attrs:{dim:e+1}});d=t,l.push(t)}for(let e=0;e<s;++e){let t=Sa.createScalarValue(e,"int32"),r=n.makeTensorInfo([],"int32",t),i=hb({inputs:{a:r,b:d},backend:n}),s=Hy({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),u=Qb({inputs:{a:s,b:a},backend:n}),c=Rv({inputs:{x:u},backend:n,attrs:{axis:0,keepDims:!1}});o.push(c),l.push(r),l.push(i),l.push(s),l.push(u),l.push(c)}let c=Jw({inputs:o,backend:n,attrs:{axis:0}});return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}},dS=[vA,Oy,kA,TA,Jy,_A,IA,CA,EA,NA,PA,MA,$A,zA,UA,HA,GA,qA,XA,AA,KA,ZA,YA,rb,JA,Gy,ub,ev,Ly,tv,iv,ov,lv,uv,dv,cv,hv,mv,gv,yv,bv,xv,Av,vv,kv,Sv,Tv,_v,Iv,Cv,Ev,Nv,Dv,sA,Mv,pb,Wv,gb,jv,xb,Yv,Qv,ew,wb,Tb,tw,nw,rw,aw,Nb,Db,Uy,iw,rv,ow,uw,cw,lA,$b,zb,hw,Vb,mw,yw,xw,ww,kw,Sw,_w,qb,Iw,Cw,Ew,Nw,Rw,Pw,Dw,Zb,Mw,Fw,Uw,ex,nx,Vw,Hw,qw,ix,Xw,Yw,Qw,ek,rk,cA,dx,ak,ik,sk,ok,Vy,qv,uk,pA,fA,bA,dk,ck,hk,pk,mk,fk,yk,kx,bk,vk,wk,_k,Ix,Ck,Nk,Pk,Nx,Bw,Ok,$k,Fk,Lk,zk,Bk,Uk,Wk,$x,Vk,zx,Wx,Hk,Gk,qk,Xk,Kk,Jx,Pv,Yk,{kernelName:Kr,backendName:"cpu",kernelFunc:Jk},Qk,eS,tS,nS,lx,oS,lS,uS,Zw];for(let e of dS)ba(e);var cS={};x(cS,{assertNotComplex:()=>AT,bindCanvasToFramebuffer:()=>ZS,bindColorTextureToFramebuffer:()=>YS,bindTextureToProgramUniformSampler:()=>KS,bindTextureUnit:()=>HS,bindVertexBufferToProgramAttribute:()=>jS,callAndCheck:()=>kS,canBeRepresented:()=>_S,createFragmentShader:()=>NS,createFramebuffer:()=>VS,createProgram:()=>OS,createStaticIndexBuffer:()=>zS,createStaticVertexBuffer:()=>LS,createTexture:()=>US,createVertexShader:()=>ES,getBatchDim:()=>rT,getExtensionOrThrow:()=>CS,getFramebufferErrorMessage:()=>eT,getMaxTexturesInShader:()=>hT,getNumChannels:()=>BS,getProgramUniformLocation:()=>XS,getProgramUniformLocationOrThrow:()=>qS,getRowsCols:()=>aT,getShapeAs3D:()=>iT,getTextureShapeFromLogicalShape:()=>sT,getWebGLDisjointQueryTimerVersion:()=>pT,getWebGLErrorMessage:()=>IS,getWebGLMaxTextureSize:()=>uT,hasExtension:()=>mT,isCapableOfRenderingToFloatTexture:()=>gT,isDownloadFloatTextureEnabled:()=>yT,isReshapeFree:()=>lT,isWebGLFenceEnabled:()=>xT,isWebGLVersionEnabled:()=>fT,linkProgram:()=>$S,logShaderSourceAndInfoLog:()=>MS,resetMaxTextureSize:()=>dT,resetMaxTexturesInShader:()=>cT,unbindColorTextureFromFramebuffer:()=>JS,unbindTextureUnit:()=>GS,validateFramebuffer:()=>QS,validateProgram:()=>FS,validateTextureSize:()=>WS});var hS,pS,mS,fS={},gS={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function yS(e,t){fS[e]=t}function bS(e,t){if(!(e in fS)||null!=t){let n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=null==t?function(e){if(!Ue().getBool("IS_SAFARI")&&"undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete fS[e]}),!1),Ue().getBool("SOFTWARE_WEBGL_ENABLED")&&(gS.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",gS)||n.getContext("experimental-webgl",gS):n.getContext("webgl2",gS)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;fS[e]=n}let n=fS[e];return null==n||n.isContextLost()?(delete fS[e],bS(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),fS[e])}function xS(e,t){return[t,e]}function AS(e){let t=Sa.sizeFromShape(e),n=Math.ceil(t/4);return Sa.sizeToSquarishShape(n)}function vS(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function wS(e,t){let n,r,a,i,s,o,l,u,d,c,h=e;return 2===Ue().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,s=h.RED,l=4,u=1,d=h.HALF_FLOAT,c=h.FLOAT,o=h.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,s=e.RGBA,l=4,u=4,d=null!=t?t.HALF_FLOAT_OES:null,c=e.FLOAT,o=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:s,downloadTextureFormat:o,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:c}}function kS(e,t){let n=t();return Ue().getBool("DEBUG")&&function(e){let t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+IS(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(hS||(hS={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(pS||(pS={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(mS||(mS={}));var SS=5.96e-8,TS=65504;function _S(e){return!!(Ue().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||SS<Math.abs(e)&&Math.abs(e)<TS)}function IS(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function CS(e,t){return tT(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}function ES(e,t){let n=tT(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(kS(e,(()=>e.shaderSource(n,t))),kS(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function NS(e,t){let n=tT(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(kS(e,(()=>e.shaderSource(n,t))),kS(e,(()=>e.compileShader(n))),Ue().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw MS(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var RS,PS,DS=/ERROR: [0-9]+:([0-9]+):/g;function MS(e,t){let n=DS.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);let r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,s=a.map(((e,t)=>Sa.rightPad((t+1).toString(),i)+e)),o=0;for(let e=0;e<s.length;e++)o=Math.max(s[e].length,o);let l=s.slice(0,r-1),u=s.slice(r-1,r),d=s.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${Sa.rightPad(u[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}function OS(e){return tT(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}function $S(e,t){if(kS(e,(()=>e.linkProgram(t))),!Ue().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function FS(e,t){if(kS(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function LS(e,t){let n=tT(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return kS(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),kS(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}function zS(e,t){let n=tT(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return kS(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),kS(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}function BS(){return 2===Ue().getNumber("WEBGL_VERSION")?1:4}function US(e){return tT(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}function WS(e,t){let n=Ue().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}function VS(e){return tT(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}function jS(e,t,n,r,a,i,s){let o=e.getAttribLocation(t,n);return-1!==o&&(kS(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),kS(e,(()=>e.vertexAttribPointer(o,a,e.FLOAT,!1,i,s))),kS(e,(()=>e.enableVertexAttribArray(o))),!0)}function HS(e,t,n){nT(e,n),kS(e,(()=>e.activeTexture(e.TEXTURE0+n))),kS(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}function GS(e,t){nT(e,t),kS(e,(()=>e.activeTexture(e.TEXTURE0+t))),kS(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function qS(e,t,n){return tT(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}function XS(e,t,n){return e.getUniformLocation(t,n)}function KS(e,t,n,r){kS(e,(()=>HS(e,t,r))),kS(e,(()=>e.uniform1i(n,r)))}function ZS(e){kS(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),kS(e,(()=>e.viewport(0,0,e.canvas.width,e.canvas.height))),kS(e,(()=>e.scissor(0,0,e.canvas.width,e.canvas.height)))}function YS(e,t,n){kS(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),kS(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function JS(e,t){kS(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),kS(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function QS(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+eT(e,t))}function eT(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function tT(e,t,n){let r=kS(e,(()=>t()));if(null==r)throw new Error(n);return r}function nT(e,t){let n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)}function rT(e,t=2){return Sa.sizeFromShape(e.slice(0,e.length-t))}function aT(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function iT(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[rT(e),...aT(e)]),t}function sT(e,t=!1){let n=Ue().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Ue().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&Ue().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map(((t,n)=>n>=e.length-2?Sa.nearestLargerEven(e[n]):e[n]))).length&&(e=[2,e[0]])),2!==e.length&&(e=Sa.squeezeShape(e).newShape);let a=Sa.sizeFromShape(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);let s=null!=i&&Math.max(...i)>r&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(null==i||s)if(t){let t=rT(e),n=2,r=2;e.length&&([n,r]=aT(e)),a=t*(n/2)*(r/2),i=Sa.sizeToSquarishShape(a).map((e=>2*e))}else i=Sa.sizeToSquarishShape(a);return i}function oT(e){return e%2==0}function lT(e,t){if(e=e.slice(-2),t=t.slice(-2),Sa.arraysEqual(e,t)||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){let n=e[e.length-1],r=t[t.length-1];if(n===r||oT(n)&&oT(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&oT(e[0])&&oT(t[0])}function uT(e){if(null==RS){let t=bS(e);RS=t.getParameter(t.MAX_TEXTURE_SIZE)}return RS}function dT(){RS=null}function cT(){PS=null}function hT(e){if(null==PS){let t=bS(e);PS=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,PS)}function pT(e){if(0===e)return 0;let t,n=bS(e);return t=mT(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:mT(n,"EXT_disjoint_timer_query")?1:0,t}function mT(e,t){return null!=e.getExtension(t)}function fT(e){try{if(null!=bS(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function gT(e){if(0===e)return!1;let t=bS(e);if(1===e){if(!mT(t,"OES_texture_float"))return!1}else if(!mT(t,"EXT_color_buffer_float"))return!1;return bT(t)}function yT(e){if(0===e)return!1;let t=bS(e);if(1!==e){if(mT(t,"EXT_color_buffer_float"))return bT(t);let e="EXT_color_buffer_half_float";if(mT(t,e)){let n=t.getExtension(e);return function(e,t){let n=wS(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);let a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);let i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!(!mT(t,"OES_texture_float")||!mT(t,"WEBGL_color_buffer_float"))&&bT(t)}function bT(e){let t=wS(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);let a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function xT(e){return 2===e&&null!=bS(e).fenceSync}function AT(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Sa.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the WebGL backend.`))}))}var vT=Ue();function wT(){let e,t,n,r,a,i,s,o,l,u;return 2===Ue().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",s="out vec4 outputColor;",o=Ue().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",s="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:s,defineSpecialNaN:o,defineSpecialInf:l,defineRound:u}}function kT(e,t,n="index"){let r=Sa.computeStrides(t);return r.map(((t,a)=>`int ${e[a]} = ${n} / ${t}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${t}`:`index -= ${e[a]} * ${t}`};`)).join("")}function ST(e,t,n="index"){let r=Sa.computeStrides(t);return r.map(((t,a)=>`int ${e[a]} = ${n} / outShapeStrides[${a}]; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * outShapeStrides[${a}]`:`index -= ${e[a]} * outShapeStrides[${a}]`};`)).join("")}function TT(e){let t=Sa.computeStrides(e).map((e=>e.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}vT.registerFlag("HAS_WEBGL",(()=>vT.getNumber("WEBGL_VERSION")>0)),vT.registerFlag("WEBGL_VERSION",(()=>fT(2)?2:fT(1)?1:0)),vT.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),vT.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===vT.get("WEBGL_VERSION"))),vT.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),vT.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),vT.registerFlag("WEBGL_PACK",(()=>vT.getBool("HAS_WEBGL"))),vT.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_CLIP",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_PACK_REDUCE",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_LAZILY_UNPACK",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_CONV_IM2COL",(()=>vT.getBool("WEBGL_PACK"))),vT.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>uT(vT.getNumber("WEBGL_VERSION")))),vT.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>hT(vT.getNumber("WEBGL_VERSION")))),vT.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{let e=vT.getNumber("WEBGL_VERSION");return 0===e?0:pT(e)})),vT.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>vT.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Pi.isMobile())),vT.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>gT(vT.getNumber("WEBGL_VERSION")))),vT.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!vT.getBool("WEBGL_FORCE_F16_TEXTURES")&&vT.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),vT.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>yT(vT.getNumber("WEBGL_VERSION")))),vT.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>xT(vT.getNumber("WEBGL_VERSION")))),vT.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>vT.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),vT.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),vT.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>Pi.isMobile()?1:-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),vT.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),vT.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),vT.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),vT.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),vT.registerFlag("WEBGL_EXP_CONV",(()=>!1)),vT.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>vT.getBool("IS_TEST"))),vT.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),vT.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),vT.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),vT.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var _T="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:IT}=$m;function CT(e,t,n){let r=[];if(e.forEach((e=>{let t=Sa.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(r.push(`uniform sampler2D ${e.name};`),r.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){let{uniformShape:t}=LT(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push(`uniform int ${e.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${e.name}Shape;`)}r.push(`uniform ivec2 ${e.name}TexShape;`)}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{r.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)}));let a,i,s=r.join("\n"),o=e.map((e=>function(e,t,n=!1,r){let a="";a+=n?NT(e,r):ET(e,r);let i=e.shapeInfo.logicalShape,s=t.logicalShape;return i.length<=s.length&&(a+=n?function(e,t){let n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,l=IT(e.shapeInfo.logicalShape,t.logicalShape),u=FT(o),d=o-s,c=["x","y","z","w","u","v"];n=0===s?"":o<2&&l.length>=1?"coords = 0;":l.map((e=>`coords.${c[e+d]} = 0;`)).join("\n");let h="";h=o<2&&s>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${c[t+d]}`)).join(", ");let p="return outputValue;",m=1===Sa.sizeFromShape(e.shapeInfo.logicalShape),f=1===Sa.sizeFromShape(t.logicalShape);if(1!==s||m||f){if(m&&!f)p=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){let e=s-2,t=s-1;l.indexOf(e)>-1&&l.indexOf(t)>-1?p="return vec4(outputValue.x);":l.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${u} coords = getOutputCoords();\n      ${n}\n      vec4 outputValue = get${a}(${h});\n      ${p}\n    }\n  `}(e,t):function(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,s=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&Sa.arraysEqual(s,i))return`\n      float ${a}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;let u,d=FT(l),c=IT(e.shapeInfo.logicalShape,t.logicalShape),h=l-o,p=["x","y","z","w","u","v"];u=0===o?"":l<2&&c.length>=1?"coords = 0;":c.map((e=>`coords.${p[e+h]} = 0;`)).join("\n");let m="";return m=l<2&&o>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${p[t+h]}`)).join(", "),`\n    float ${a}() {\n      ${d} coords = getOutputCoords();\n      ${u}\n      return get${r}(${m});\n    }\n  `}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),l=t.texShape,u=wT(),d=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(u),c=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${RT}\n    ${PT}\n    ${DT}\n  `}(u);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `:1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,t,n);case 2:return function(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Sa.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;let a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),s=i,o="",l="b, r, c";for(let t=2;t<e.length-1;t++)s*=e[e.length-t-1],o=`\n      int b${t} = index / ${s};\n      index -= b${t} * ${s};\n    `+o,l=`b${t}, `+l;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec${e.length}(${l});\n    }\n  `}(e,t,n)}}(t.logicalShape,l,n.enableShapeUniforms),i=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(u)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `:1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}(0,t,n);case 2:return function(e,t,n){return Sa.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${ST(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`;let r=kT(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(e,t,n);case 4:return function(e,t,n){if(n)return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${ST(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `;let r=kT(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t,n);case 5:return function(e,t){let n=kT(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){let n=kT(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}(t.logicalShape,l,n.enableShapeUniforms),i=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(u)),n.packedInputs&&(c+=MT),[c,d,i,s,a,o,n.userCode].join("\n")}function ET(e,t=!1){let n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;let[a,i]=e.shapeInfo.texShape;if(1===a&&1===i)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;let s=OT(n);if(t)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `;let[o,l]=e.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${o}, ${l}, ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 1:return function(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${$T(e)}\n      }\n    `;let a=e.shapeInfo.texShape,i=a[0],s=a[1];if(1===s&&1===i)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;let o=OT(n);return 1===s?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:1===i?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${s}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:t?`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${i}, ${s}, index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Sa.arraysEqual(n,i)){if(t)return`\n      float ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;let e=i[0];return`\n    float ${a}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${i[1]}.0, ${e}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}let{newShape:s,keptDims:o}=Sa.squeezeShape(n),l=s;if(l.length<n.length){let n=["row","col"];return`\n      ${ET(zT(e,l),t)}\n      float ${a}(int row, int col) {\n        return ${a}(${BT(n,o)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${$T(e)}\n      }\n    `;let u=i[0],d=i[1],c=OT(r);return 1===d?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${c}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:1===u?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${c}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `:t?`\n      float ${a}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${c};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n  float ${a}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${c};\n    vec2 uv = uvFromFlat(${u}, ${d}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(e,t);case 3:return function(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],s=n[2],{newShape:o,keptDims:l}=Sa.squeezeShape(n),u=o;if(u.length<n.length){let n=["row","col","depth"];return`\n        ${ET(zT(e,u),t)}\n        float ${a}(int row, int col, int depth) {\n          return ${a}(${BT(n,l)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${i}, ${s}, 1)));\n        ${$T(e)}\n      }\n    `;let d=e.shapeInfo.texShape,c=d[0],h=d[1],p=e.shapeInfo.flatOffset;if(h===i&&null==p)return t?`\n      float ${a}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${a}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${s}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${c}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(h===s&&null==p)return t?`\n      float ${a}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;let m=OT(r);return t?`\n    float ${a}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${m};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `:`\n      float ${a}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${i} + col * ${s} + depth + ${m};\n        vec2 uv = uvFromFlat(${c}, ${h}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(e,t);case 4:return function(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],s=n[2]*i,o=n[1]*s,{newShape:l,keptDims:u}=Sa.squeezeShape(n);if(l.length<n.length){let n=["row","col","depth","depth2"];return`\n      ${ET(zT(e,l),t)}\n      float ${a}(int row, int col, int depth, int depth2) {\n        return ${a}(${BT(n,u)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${o}, ${s}, ${i}, 1)));\n        ${$T(e)}\n      }\n    `;let d=e.shapeInfo.flatOffset,c=e.shapeInfo.texShape,h=c[0],p=c[1],m=`int stride2 = ${r}Shape[3];`,f=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(p===o&&null==d)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        ${m}\n        ${f}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${s}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===i&&null==d)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;let y=OT(r);return t?`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${m}\n      ${f}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${s} +\n          depth * ${i} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${p}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(e,t);case 5:return function(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,s=t[2]*i,o=t[1]*s,{newShape:l,keptDims:u}=Sa.squeezeShape(t);if(l.length<t.length){let t=["row","col","depth","depth2","depth3"];return`\n      ${ET(zT(e,l))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${BT(t,u)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${o}, ${s}, ${i}, ${a})) +\n          depth3;\n        ${$T(e)}\n      }\n    `;let d=e.shapeInfo.flatOffset,c=e.shapeInfo.texShape,h=c[0],p=c[1];return p===o&&null==d?`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${s}, ${i}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:p===a&&null==d?`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${s} + depth * ${i} +\n          depth2 * ${a} + depth3 + ${OT(n)};\n      vec2 uv = uvFromFlat(${h}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);case 6:return function(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:i}=Sa.squeezeShape(t);if(a.length<t.length){let t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${ET(zT(e,a))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${BT(t,i)});\n      }\n    `}let s=t[5],o=t[4]*s,l=t[3]*o,u=t[2]*l,d=t[1]*u;if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${d}, ${u}, ${l}, ${o})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${s}, 1)));\n        ${$T(e)}\n      }\n    `;let c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1];return m===d&&null==c?`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${u}, ${l}, ${o}, ${s})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${m}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:m===s&&null==c?`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${m}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${d} + col * ${u} + depth * ${l} +\n          depth2 * ${o} + depth3 * ${s} + depth4 + ${OT(n)};\n      vec2 uv = uvFromFlat(${p}, ${m}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function NT(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){let t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${wT().texture2D}(${t}, halfCR);\n    }\n  `}(e);case 1:return function(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=wT();if(t)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${i.texture2D}(${n}, uv);\n    }\n  `;let s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${s[0]}, ${s[1]}, index);\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=i[0],o=i[1],l=wT();if(null!=i&&Sa.arraysEqual(n,i))return t?`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${s}.0);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `;if(t)return`\n    vec4 ${a}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `;let u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${a}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(n[1]/2)}, ${u[0]}, ${u[1]}, row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `}(e,t);case 3:return function(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){let r=[1,2],i=["b","row","col"];return`\n        ${NT(zT(e,n.slice(1)),t)}\n        vec4 ${a}(int b, int row, int col) {\n          return ${a}(${BT(i,r)});\n        }\n      `}let o=wT();if(t)return`\n    vec4 ${a}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `;let l=s[0],u=s[1],d=Math.ceil(n[2]/2);return`\n    vec4 ${a}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${l}, ${u}, ${d*Math.ceil(n[1]/2)}, ${d}, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `}(e,t);default:return function(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=wT();if(t)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);\n    }\n  `;let i=e.shapeInfo.logicalShape,s=i.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=l[0],d=l[1],c=Math.ceil(i[s-1]/2),h=c*Math.ceil(i[s-2]/2),p="int b, int row, int col",m=`b * ${h} + (row / 2) * ${c} + (col / 2)`;for(let e=2;e<s-1;e++)p=`int b${e}, `+p,h*=i[s-e-1],m=`b${e} * ${h} + `+m;return`\n    vec4 ${r}(${p}) {\n      int index = ${m};\n      int texR = index / ${d};\n      int texC = index - texR * ${d};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});\n      return ${a.texture2D}(${n}, uv);\n    }\n  `}(e,t)}}var RT="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",PT="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",DT="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",MT="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function OT(e){return`offset${e}`}function $T(e){let t=e.name,n=Sa.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function FT(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function LT(e,t,n){let{newShape:r,keptDims:a}=Sa.squeezeShape(t),i=t.length,s=e&&3===i&&1===t[0],o=s?t.slice(1):r,l=!e&&i>1&&!Sa.arraysEqual(t,n)&&r.length<i||s;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:a}}function zT(e,t){let n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function BT(e,t){return t.map((t=>e[t])).join(", ")}function UT(e,t,n){let r,a,i,s=[],o=[],l=null,u=null;u=e.getUniformLocation(n,"NAN",!1),1===Ue().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));let d=!1;for(let r of t.variableNames){let a={name:r,uniform:e.getUniformLocation(n,r,d),offset:e.getUniformLocation(n,`offset${r}`,d)};t.enableShapeUniforms&&(a.shape=e.getUniformLocation(n,`${r}Shape`,d),a.texShape=e.getUniformLocation(n,`${r}TexShape`,d)),s.push(a)}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",d),i=e.getUniformLocation(n,"outShapeStrides",d),a=e.getUniformLocation(n,"outTexShape",d)),t.customUniforms)for(let r of t.customUniforms)o.push(e.getUniformLocation(n,r.name,d));return{variablesLocations:s,customUniformLocations:o,infLoc:l,nanLoc:u,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function WT(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{let r=e.logicalShape,a=t[n],i=a.shape;if(!Sa.arraysEqual(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(e.isUniform&&a.isUniform)return;let s=e.texShape,o=a.isUniform?null:a.texData.texShape;if(!Sa.arraysEqual(s,o))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${o} must match`)}))}function VT(e){return Ue().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var jT={R:0,G:1,B:2,A:3},HT=class{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=wT();this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let i="";for(let e=0;e<n.length;e++){let t=n[e];i+=`\n          if(offset == ${e}) {\n            result = values[${jT[t]}];\n          }`}this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":TT(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${n.length});\n\n        flatIndex = idiv(flatIndex, ${n.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${r.texture2D}(A, uv);\n          ${i}\n        }\n        ${r.output} = vec4(${a}, 0., 0., 0.);\n      }\n    `}},GT={};function qT(e){let t=wT();return ES(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function XT(e){return LS(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function KT(e){return zS(e,new Uint16Array([0,1,2,2,1,3]))}function ZT(e,t,n,r,a,i){WS(t,n);let s=US(e),o=e.TEXTURE_2D;return kS(e,(()=>e.bindTexture(o,s))),kS(e,(()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),kS(e,(()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),kS(e,(()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST))),kS(e,(()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===Ue().getNumber("WEBGL_VERSION")?kS(e,(()=>e.texImage2D(o,0,r,t,n,0,a,i,null))):kS(e,(()=>e.texStorage2D(o,1,r,t,n))),kS(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:s,texShape:[n,t]}}function YT(e){return e.internalFormatFloat}function JT(e,t,n,r){let[a,i]=xS(t,n);return ZT(e,a,i,YT(r),r.textureFormatFloat,e.FLOAT)}function QT(e){return e.internalFormatHalfFloat}function e_(e,t,n,r){let[a,i]=xS(t,n);return ZT(e,a,i,QT(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function t_(e){return e.downloadTextureFormat}function n_(e,t,n,r){let[a,i]=xS(t,n);return ZT(e,a,i,t_(r),e.RGBA,e.UNSIGNED_BYTE)}function r_(e){return e.internalFormatPackedFloat}function a_(e,t,n,r){let[a,i]=vS(t,n);return ZT(e,a,i,r_(r),e.RGBA,e.FLOAT)}function i_(e){return e.internalFormatPackedHalfFloat}function s_(e,t,n,r){let[a,i]=vS(t,n);return ZT(e,a,i,i_(r),e.RGBA,r.textureTypeHalfFloat)}function o_(e,t,n){return kS(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),jS(e,t,"clipSpacePos",n,3,20,0)&&jS(e,t,"uv",n,2,20,12)}function l_(e,t,n,r,a,i){let s,o,l;kS(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),a instanceof Uint8Array?(s=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(n*r*4),o=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),2===Ue().getNumber("WEBGL_VERSION")?kS(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,s))):kS(e,(()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,o,s))),kS(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function u_(e,t,n){kS(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===Ue().getNumber("WEBGL_VERSION")?kS(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):kS(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===Ue().getNumber("WEBGL_VERSION")?kS(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):kS(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),kS(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function d_(e,t,n,r){let a=e.createBuffer();kS(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a)));let i=16*t*n;return kS(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ))),kS(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),kS(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),a}function c_(e,t,n){let r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function h_(e,t,n,r){let[a,i]=xS(t,n),s=new Uint8Array(function(e,t){return 4*e}(t*n));return kS(e,(()=>e.readPixels(0,0,a,i,r.downloadTextureFormat,e.UNSIGNED_BYTE,s))),new Float32Array(s.buffer)}function p_(e,t,n,r,a,i,s,o){let l=e,u=new Float32Array(function(e,t){let[n,r]=vS(e,t);return n*r*4}(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function m_(e,t,n){let r=new Float32Array(t*n*4);return kS(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}x(GT,{bindVertexProgramAttributeStreams:()=>o_,createBufferFromOutputTexture:()=>d_,createFloat16MatrixTexture:()=>e_,createFloat16PackedMatrixTexture:()=>s_,createFloat32MatrixTexture:()=>JT,createIndexBuffer:()=>KT,createPackedMatrixTexture:()=>a_,createUnsignedBytesMatrixTexture:()=>n_,createVertexBuffer:()=>XT,createVertexShader:()=>qT,downloadByteEncodedFloatMatrixFromOutputTexture:()=>h_,downloadFloat32MatrixFromBuffer:()=>c_,downloadMatrixFromPackedOutputTexture:()=>m_,downloadPackedMatrixFromBuffer:()=>p_,getInternalFormatForFloat16MatrixTexture:()=>QT,getInternalFormatForFloat16PackedMatrixTexture:()=>i_,getInternalFormatForFloat32MatrixTexture:()=>YT,getInternalFormatForPackedMatrixTexture:()=>r_,getInternalFormatForUnsignedBytesMatrixTexture:()=>t_,uploadDenseMatrixToTexture:()=>l_,uploadPixelDataToTexture:()=>u_});var f_=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let t=Ue().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,yS(t,e)):this.gl=bS(t),e=this.gl,2===Ue().getNumber("WEBGL_VERSION")){let t=e;this.createVertexArray=()=>kS(t,(()=>t.createVertexArray())),this.bindVertexArray=e=>kS(t,(()=>t.bindVertexArray(e))),this.deleteVertexArray=e=>kS(t,(()=>t.deleteVertexArray(e))),this.getVertexArray=()=>kS(t,(()=>t.getParameter(t.VERTEX_ARRAY_BINDING)))}else if(null!=e){let t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>kS(e,(()=>t.createVertexArrayOES())),this.bindVertexArray=n=>kS(e,(()=>t.bindVertexArrayOES(n))),this.deleteVertexArray=n=>kS(e,(()=>t.deleteVertexArrayOES(n))),this.getVertexArray=()=>kS(e,(()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Ue().getNumber("WEBGL_VERSION")){let e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=CS(this.gl,e),mT(this.gl,t))this.textureHalfFloatExtension=CS(this.gl,t);else if(Ue().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),mT(this.gl,r))this.colorBufferHalfFloatExtension=CS(this.gl,r);else if(Ue().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",mT(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!mT(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=XT(this.gl),this.indexBuffer=KT(this.gl),this.framebuffer=VS(this.gl),this.textureConfig=wS(this.gl,this.textureHalfFloatExtension)}get debug(){return Ue().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;kS(e,(()=>e.finish())),kS(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),kS(e,(()=>e.deleteFramebuffer(this.framebuffer))),kS(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),kS(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),kS(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),JT(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),e_(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),n_(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),u_(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),l_(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),s_(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),a_(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(JS(this.gl,this.framebuffer),this.outputTexture=null),kS(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>h_(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,a,i){return p_(this.gl,e,0,0,0,a,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return c_(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);let r=d_(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Ue().getBool("WEBGL_FENCE_API_ENABLED")){let r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>m_(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();let t=this.gl;null==this.vertexShader&&(this.vertexShader=qT(t));let n=OS(t);kS(t,(()=>t.attachShader(n,this.vertexShader))),kS(t,(()=>t.attachShader(n,e))),$S(t,n);let r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&FS(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);let t=this.gl;kS(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),o_(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(kS(this.gl,(()=>this.gl.deleteProgram(e))),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&FS(this.gl,this.program),kS(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?qS(this.gl,e,t):XS(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),kS(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),KS(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();let[r,a]=vS(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&FS(this.gl,this.program),QS(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}kS(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),kS(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=CS(this.gl,2===Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){let e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}let e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){let e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await Sa.repeatedTry((()=>this.disposed||this.isQueryAvailable(e,Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){let t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{let t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){let t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{let t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){let e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){let{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in Ue().platform&&(n=Ue().platform.setTimeoutCustom.bind(Ue().platform)),Sa.repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),YS(this.gl,e,this.framebuffer),this.debug&&QS(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(YS(this.gl,this.outputTexture,this.framebuffer),this.debug&&QS(this.gl)):JS(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);let n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();let r=this.gl;YS(r,e,this.framebuffer),this.debug&&QS(r),this.outputTexture=e,kS(r,(()=>r.viewport(0,0,t,n))),kS(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),kS(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{addImpl:g_,bincountImpl:y_,bincountReduceImpl:b_,bitwiseAndImpl:x_,castImpl:A_,ceilImpl:v_,concatImpl:w_,equalImpl:k_,expImpl:S_,expm1Impl:T_,floorImpl:__,gatherNdImpl:I_,gatherV2Impl:C_,greaterImpl:E_,greaterEqualImpl:N_,lessImpl:R_,lessEqualImpl:P_,linSpaceImpl:D_,logImpl:M_,maxImpl:O_,maximumImpl:$_,minimumImpl:F_,multiplyImpl:L_,negImpl:z_,notEqualImpl:B_,prodImpl:U_,raggedGatherImpl:W_,raggedRangeImpl:V_,raggedTensorToTensorImpl:j_,rangeImpl:H_,rsqrtImpl:G_,scatterImpl:q_,sigmoidImpl:X_,simpleAbsImpl:K_,sliceImpl:Z_,sparseFillEmptyRowsImpl:Y_,sparseReshapeImpl:J_,sparseSegmentReductionImpl:Q_,sqrtImpl:eI,staticRegexReplaceImpl:tI,stridedSliceImpl:nI,stringNGramsImpl:rI,stringSplitImpl:aI,stringToHashBucketFastImpl:iI,subImpl:sI,tileImpl:oI,topKImpl:lI,transposeImpl:uI,uniqueImpl:dI}=Dy;function cI(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>`${e}.${t}`))}function hI(e,t){return 1===t?[e]:cI(e,t)}var pI=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length);let n="";for(let e=0;e<4;e++){let t="thisRC = rc;";e%2==1&&(t+="thisRC.z += 1;"),e>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${e>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${e}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${e>0?"}":""}\n      `}this.userCode=`\n      ${function(e,t){return`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${t?function(e,t,n="index"){let r=function(e,t){let n=e.length,r=e.map((e=>`${t}[${e}]`)),a=new Array(n-1);a[n-2]=r[n-1];for(let e=n-3;e>=0;--e)a[e]=`(${a[e+1]} * ${r[e+1]})`;return a}(e.map(((e,t)=>t)),t);return r.map(((t,a)=>`int ${e[a]} = ${n} / ${r[a]}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${r[a]}`:`index -= ${e[a]} * ${r[a]}`};`)).join("")}(["r","c","d"],"inputShape"):kT(["r","c","d"],e)}\n      return ivec3(r, c, d);\n    }\n  `}(t,this.enableShapeUniforms)}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":TT(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}};function mI(e,t,n,r,a){let i,s=function(e,t){switch(e){case mS.PACKED_2X2_FLOAT32:return r_(t);case mS.PACKED_2X2_FLOAT16:return i_(t);case mS.UNPACKED_FLOAT32:return YT(t);case mS.UNPACKED_FLOAT16:return QT(t);case mS.PACKED_4X1_UNSIGNED_BYTE:return t_(t);default:throw new Error(`Unknown physical texture type ${e}`)}}(t,r);if(a){let[t,n]=vS(e[0],e[1]);i=t*n}else{let[t,n]=xS(e[0],e[1]);i=t*n}let o=function(e,t){let n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}(n,s);return i*o}function fI(e,t){if(e===pS.UPLOAD)return mS.PACKED_2X2_FLOAT32;if(e===pS.RENDER||null==e)return function(e){return Ue().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?mS.PACKED_2X2_FLOAT32:mS.UNPACKED_FLOAT32:e?mS.PACKED_2X2_FLOAT16:mS.UNPACKED_FLOAT16}(t);if(e===pS.DOWNLOAD||e===pS.PIXELS)return mS.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function gI(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}var yI=class{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}},bI="if (isnan(x)) return x;",xI="return x;",AI="return abs(x);",vI="return (x >= 0.0) ? x : (exp(x) - 1.0);",wI=bI+"\n  return (x < 0.0) ? 0.0 : x;\n",kI=bI+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",SI="return x;",TI="return 1.0 / (1.0 + exp(-1.0 * x));",_I="return x;",II="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",CI="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",EI="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",NI="return 1.0 / (1.0 + exp(-1.0 * x));",RI=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}},PI=Hf.whereImpl,DI={},MI=Ue().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),OI=class extends W{nextDataId(){return OI.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Ue().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof f_)t=e;else{let n=bS(Ue().getNumber("WEBGL_VERSION"),e);t=new f_(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let e=bS(Ue().getNumber("WEBGL_VERSION"));t=new f_(e),this.binaryCache=function(e){return e in DI||(DI[e]={}),DI[e]}(Ue().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){let r=fI(t,n),a=gI(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);let i,s=mI(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let e=this.freeTextures[a].pop();return this.usedTextures[a].push(e),e}return r===mS.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===mS.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===mS.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===mS.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===mS.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),i}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;let a=fI(n,r),i=gI(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);let s=mI(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=Ue().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;let l=this.usedTextures[i],u=l&&l.indexOf(e);if(null==u||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(let e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(let e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}(this.gpgpu),this.numMBBeforeWarning=null==Ue().global.screen?1024:Ue().global.screen.height*Ue().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new U(this,Ys())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,a,i){let s=this.makeTensorInfo(t,n),o=this.texData.get(s.dataId);o.isPacked=!1,o.texture={texture:e,texShape:[r,a]},o.texShape=[r,a];let l=iT(t),u=new HT(l,!1,i),d=this.runWebGLProgram(u,[s],n,[[r,a]]);return d.shape=t,o.texture=null,this.disposeIntermediateTensorInfo(s),d.dataId}write(e,t,n){if((Ue().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ue().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:pS.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,r,a){if(Ue().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:pS.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:i,shape:s,isPacked:o}=t;if(null!=i){let t;t=o?new RI(s,SI):new yI(s,SI);let n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;let l,u,d=null!=this.activeTimers;if(d&&(l=Sa.now()),"complex64"===r){let e=this.readSync(a.real.dataId),t=this.readSync(a.imag.dataId);u=$m.mergeRealAndImagArrays(e,t)}else u=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=Sa.now()-l),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){let t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}let t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:i,complexTensorInfos:s,isPacked:o}=t;if(null!=a){let t;t=o?new RI(r,SI):new yI(r,SI);let n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:i}],i),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(Ue().getBool("DEBUG")&&!Ue().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Ue().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,u,d=null;if("complex64"!==i&&Ue().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);let t=this.texData.get(l.dataId);d=this.gpgpu.createBufferFromTexture(t.texture.texture,...AS(r))}if(this.pendingRead.set(e,[]),"complex64"!==i&&await this.gpgpu.createAndWaitForFence(),"complex64"===i){let e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]),t=e[0],n=e[1];u=$m.mergeRealAndImagArrays(t,n)}else if(null==d)u=this.getValuesFromTexture(e);else{let e=Sa.sizeFromShape(r);u=this.gpgpu.downloadFloat32MatrixFromBuffer(d,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=d){let e=this.gpgpu.gl;kS(e,(()=>e.deleteBuffer(d)))}let c=this.convertAndCacheOnCPU(e,u),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach((e=>e(c))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ys().removeDataId(e,this),this.pendingDeletes--),c}readToGPU(e,t={}){let n=this.texData.get(e),{values:r,shape:a,slice:i,dtype:s,isPacked:o,texture:l}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=o?new RI(a,SI):new yI(a,SI);let r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:s}],s),i=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),i}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let u=this.decode(e,t.customTexShape),d=Ys().makeTensorFromTensorInfo(u),c=this.texData.get(u.dataId);return Object.assign({tensorRef:d},c.texture)}bufferSync(e){let t=this.readSync(e.dataId);if("string"===e.dtype)try{let n=t.map((e=>Sa.decodeString(e)));return Ws(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ws(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){let n=e[t];if(!_S(n))throw Ue().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${n} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=Sa.sizeFromShape(t);if(Ue().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...AS(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}let i=Ue().getBool("WEBGL_PACK")&&!0===r,s=i?iT(t):t,o=i?new class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=pS.DOWNLOAD;let t=wT();this.outputShape=e,this.userCode=`\n      ${_T}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}(s):new class{constructor(e){this.variableNames=["A"],this.outTexUsage=pS.DOWNLOAD;let t=wT();this.outputShape=e,this.userCode=`\n      ${_T}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}(s),l=this.runWebGLProgram(o,[{shape:s,dtype:n,dataId:e}],"float32"),u=this.texData.get(l.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(l),d}timerAvailable(){return Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){let t=this.activeTimers,n=[],r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();let a=Sa.flatten(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),i=Sa.flatten(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);let s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let e=await Promise.all(a);s.kernelMs=Sa.sum(e),s.getExtraProfileInfo=()=>e.map(((e,t)=>({name:i[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Sa.now(),endMs:null}}endTimer(e){return Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Sa.now(),e)}async getQueryTime(e){if(Ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:t,dtype:n,texShape:r,usage:a,isPacked:i,slice:s}=this.texData.get(e),o=s&&s.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,i)));let u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=MI){return Ue().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&Sa.sizeFromShape(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){$m.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let t=e.dataSync();return PI(e.shape,t)}packedUnaryOp(e,t,n){let r=new RI(e.shape,t),a=this.compileAndRun(r,[e],n);return Ys().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){let t=K_(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Ue().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,AI,e.dtype);let t=new yI(e.shape,AI),n=this.compileAndRun(t,[e]);return Ys().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&Sa.isString(n[0])){let a=n.map((e=>Sa.encodeString(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return Ys().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){let t=new class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length);let t=e.length,n=hI("rc",t),r=FT(t),a=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),s=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${a});\n\n        setOutput(getChannel(packedInput, ${s}));\n      }\n    `}}(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){let t=new class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=VT(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{let e=hI("rc",this.rank),t=FT(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode=`\n        void main() {\n          ${t} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${a}));\n          }\n        }\n      `}}getSourceCoordsArr(e){let t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let t=2;t<this.rank;t++)a=`${e[e.length-1-t]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";let t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${t[0]};\n      int c = ${t[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(e){let t=this.getSourceCoordsArr(e);return 1===this.rank?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),\n            cEdge ? 0. : getA(${t[1]}),\n            rEdge ? 0. : getA(${t[2]}),\n            rEdge || cEdge ? 0. : getA(${t[3]})`}}(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){let n=[rT(e.shape),...aT(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[rT(t),...aT(t)],i=new pI(a,n),s=[n],o=this.runWebGLProgram(i,[r],e.dtype,s,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){let n=this.texData.get(e),{isPacked:r,shape:a,dtype:i}=n;if(null!=t){let e=Sa.sizeFromShape(a),n=t[0]*t[1]*4;Sa.assert(e<=n,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}let s,o=iT(a);s=r?new class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=hS.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=wT();this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?ST(["r","c","d"],e):kT(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}(o):new class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=hS.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=wT();this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?ST(["r","c","d"],e):kT(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}(o);let l=[null!=t?t:AS(o)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(s,[{shape:o,dtype:i,dataId:e}],i,l,!0,t).dataId}}runWebGLProgram(e,t,n,r,a=!1,i){let s=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(s.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===hS.DENSE){let t=null!=i?i:AS(e.outputShape);o.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===Sa.sizeFromShape(s.shape))return o.values=Sa.getTypedArrayFromDType(s.dtype,0),s;let l=[],u=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Sa.sizeFromShape(t.shape)<=Ue().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!lT(n.shape,t.shape)){let e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),l.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);let d,c={shape:s.shape,texData:o,isUniform:!1},h=function(e,t,n){let r="";t.concat(n).forEach((t=>{let a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){let i=t.texData.texShape,{useSqueezeShape:s,uniformShape:o,keptDims:l}=LT(e.packedInputs,t.shape,i),u="",d="",c="";if(1===o.length&&e.packedInputs){let e=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];u=`${e[0]>1}_${e[1]>1}`}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){let e=Sa.computeStrides(o);c=`${e[0]===i[1]}_${e[e.length-1]===i[1]}`}}else d=`${o[0]>1}_${o[1]>1}`;let h=t.shape.length,p=2===o.length&&Sa.arraysEqual(t.shape,i),m=1===Sa.sizeFromShape(t.shape),f=$m.getBroadcastDims(t.shape,n.shape),g=!e.packedInputs&&h===n.shape.length&&Sa.arraysEqual(i,n.texData.texShape),y=e.packedInputs||o.length>2?"":`${i[0]>1}_${i[1]>1}`;r+=`${h}_${g}_${s?l:""}_${o.length}_${m}_${f}_${p}_${u}_${d}_${c}_${y}_${a}`}else{let e=t.isUniform?"uniform":t.texData.texShape;r+=`${t.shape}_${e}_${a}`}}));let a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a+`${Ue().getNumber("WEBGL_VERSION")}`,i}(e,u,c),p=this.getAndSaveBinary(h,(()=>function(e,t,n,r){let a=n.map(((e,n)=>{let r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((e=>e.shapeInfo)),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=CT(a,s,t),l=NS(e.gl,o),u=e.createProgram(l);return Ue().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:u,inShapeInfos:i,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(u),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:u,inShapeInfos:i,outShapeInfo:s},UT(e,t,u)))}(this.gpgpu,e,u,c))),m=null!=this.activeTimers;m&&(d=this.startTimer()),Ue().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(WT(t.inShapeInfos,n),WT([t.outShapeInfo],[r]));let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,s[0],s[1]):e.setOutputMatrixTexture(i.texture,s[0],s[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===Ue().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let r=0;r<n.length;++r){let a=n[r],{uniform:i,offset:s,shape:o,texShape:l}=t.variablesLocations[r];if(o){let{uniformShape:n}=LT(t.program.packedInputs,a.shape,a.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(o,new Int32Array(n));break;case 2:e.gl.uniform2iv(o,new Int32Array(n));break;case 3:e.gl.uniform3iv(o,new Int32Array(n));break;case 4:e.gl.uniform4iv(o,new Int32Array(n))}}if(l&&e.gl.uniform2i(l,a.texData.texShape[0],a.texData.texShape[1]),null!=i){if(a.isUniform){if(Sa.sizeFromShape(a.shape)<2)e.gl.uniform1f(i,a.uniformValues[0]);else{let t=a.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(i,t)}continue}null!=a.texData.slice&&null!=s&&e.gl.uniform1i(s,a.texData.slice.flatOffset),e.setInputMatrixTexture(a.texData.texture.texture,i,r)}}let o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape))}if(t.outShapeStridesLocation){let n=Sa.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let n=0;n<t.program.customUniforms.length;++n){let r=t.program.customUniforms[n],i=t.customUniformLocations[n],s=a[n];if("float"===r.type)e.gl.uniform1fv(i,s);else if("vec2"===r.type)e.gl.uniform2fv(i,s);else if("vec3"===r.type)e.gl.uniform3fv(i,s);else if("vec4"===r.type)e.gl.uniform4fv(i,s);else if("int"===r.type)e.gl.uniform1iv(i,s);else if("ivec2"===r.type)e.gl.uniform2iv(i,s);else if("ivec3"===r.type)e.gl.uniform3iv(i,s);else{if("ivec4"!==r.type)throw Error(`uniform type ${r.type} is not supported yet.`);e.gl.uniform4iv(i,s)}}e.executeProgram()}(this.gpgpu,p,u,c,r),l.forEach((e=>this.disposeIntermediateTensorInfo(e))),m&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));let f=Ue().get("WEBGL_FLUSH_THRESHOLD");if(f>0){let e=Sa.now();e-this.lastGlFlushTime>f&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!Ue().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===a){let e=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),e}return s}compileAndRun(e,t,n,r,a=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Ue().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=eo((()=>{if(!Ue().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=Ue().getBool("DEBUG");Ue().set("DEBUG",!1);let t=this.abs(au(1e-8)).dataSync()[0];if(Ue().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){let t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:i,usage:s,isPacked:o}=t;if(null!=i)return;let l,u=null!=this.activeTimers;u&&(l=Sa.now());let d=t.texShape;if(null==d&&(d=sT(n,o),t.texShape=d),null!=a){let e,i=iT(n),s=d[1],c=d[0],h=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(o||!h)&&([s,c]=vS(d[0],d[1])),e=o?new class{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=wT();this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let a=0;a<=1;a++){let i=2*t+a;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${a};\n          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${t};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${i}] = values[0];\n            } else if (offset == 1) {\n              result[${i}] = values[1];\n            } else if (offset == 2) {\n              result[${i}] = values[2];\n            } else {\n              result[${i}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":TT(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${a};\n        }\n    `}}(i,h):new HT(i,h);let p=h?[c,s]:d,m=this.makeTensorInfo(p,r),f=this.texData.get(m.dataId);f.usage=h?pS.PIXELS:pS.UPLOAD,f.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(m.dataId),s,c,a);let g=[[c,s]],y=!0,b=this.runWebGLProgram(e,[m],r,g,y),x=this.texData.get(b.dataId);t.texShape=x.texShape,t.isPacked=x.isPacked,t.usage=x.usage,Ue().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(t.texture=x.texture,t.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(m),u&&(this.uploadWaitMs+=Sa.now()-l)}else{let e=this.acquireTexture(d,s,r,o);t.texture=e}}convertAndCacheOnCPU(e,t){let n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){let n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){let e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Sa.bytesPerElement(t)}checkCompileCompletion(){for(let[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){let e=[];if(this.gpgpu.parallelCompilationExtension){for(let[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(let[,t]of Object.entries(this.binaryCache)){let n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(e){throw e}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Mm(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(MS(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);let{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:o}=UT(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.outShapeLocation=i,e.outShapeStridesLocation=s,e.outTexShapeLocation=o}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";let{texture:r,height:a,width:i,channels:s}=e,o=Ys().backend;if(!o.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let l=o.writeTexture(r,t,n,a,i,s);return Ys().makeTensorFromDataId(l,t,n,o)}};OI.nextDataId=0;var $I="4.7.0";function FI(){Ue().set("WEBGL_FORCE_F16_TEXTURES",!0)}Pi.isBrowser()&&co("webgl",(()=>new OI),2);var LI={forceHalfFloat:FI},zI="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",BI=class{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=$m.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=VT(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}},UI="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",WI=class{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=$m.assertAndGetBroadcastShape(t,n);let a=this.outputShape.length;this.enableShapeUniforms=VT(a);let i="";if(r)if(0===a||1===Sa.sizeFromShape(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i=`\n          ${FT(a)} coords = getOutputCoords();\n        `,1===a)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{let e=hI("coords",a);this.enableShapeUniforms?i+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= outShape[${a} - 2];\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= outShape[${a} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:i+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= ${this.outputShape[a-2]};\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= ${this.outputShape[a-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${i}\n\n        setOutput(result);\n      }\n    `}};function VI(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var jI={kernelName:un,backendName:"webgl",kernelFunc:VI};function HI(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(i.dataId),o=VI({inputs:{x:r},backend:n}),l=VI({inputs:{x:a},backend:n});return s.complexTensorInfos={real:o,imag:l},i}var GI={kernelName:xt,backendName:"webgl",kernelFunc:HI},qI="return (a < 0.) ? b * a : a;",XI="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",KI={kernelName:fn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r,s=n.makeTensorInfo([],"float32",Sa.createScalarValue(i,"float32")),o=Ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new WI(XI,a.shape,s.shape):new BI(qI,a.shape,s.shape),l=n.runWebGLProgram(o,[a,s],"float32");return n.disposeIntermediateTensorInfo(s),l}},ZI="return (a < 0.) ? b * a : a;",YI="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",JI={kernelName:tr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=Ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new WI(YI,r.shape,a.shape):new BI(ZI,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},QI="if (isnan(x)) return x;";function eC({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:i})=>{let s,{x:o}=a,l=i,u=r||o.dtype;if(l.shouldExecuteOnCPU([o])&&null!=n){let e=l.texData.get(o.dataId),t=n(e.values,u);return l.makeTensorInfo(o.shape,u,t)}return s=Ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new RI(o.shape,t):new yI(o.shape,e),l.runWebGLProgram(s,[o],u)}}function tC({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:i}){return({inputs:s,backend:o})=>{let{a:l,b:u}=s,d=o;if(r&&"complex64"===l.dtype){let t=d.texData.get(l.dataId),n=d.texData.get(u.dataId),[r,a]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((t=>{let[n,r]=t,a={dataId:n.dataId,dtype:n.dtype,shape:l.shape},i={dataId:r.dataId,dtype:r.dtype,shape:u.shape},s=new BI(e,l.shape,u.shape);return d.runWebGLProgram(s,[a,i],gi(n.dtype,r.dtype))})),i=HI({inputs:{real:r,imag:a},backend:d});return d.disposeIntermediateTensorInfo(r),d.disposeIntermediateTensorInfo(a),i}let c,h=i||gi(l.dtype,u.dtype);if(("string"===l.dtype||"string"===u.dtype||d.shouldExecuteOnCPU([l,u]))&&null!=a){let e=d.texData.get(l.dataId).values,t=d.texData.get(u.dataId).values,n="string"===l.dtype?$m.fromUint8ToStringArray(e):e,r="string"===l.dtype?$m.fromUint8ToStringArray(t):t,[i,s]=a(l.shape,u.shape,n,r,h),o=d.makeTensorInfo(s,h);return d.texData.get(o.dataId).values=i,o}return c=Ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new WI(t,l.shape,u.shape,n):new BI(e,l.shape,u.shape),d.runWebGLProgram(c,[l,u],h)}}function nC(e,t=!1){if("linear"===e)return t?_I:xI;if("relu"===e)return t?CI:wI;if("elu"===e)return t?II:vI;if("relu6"===e)return t?EI:kI;if("prelu"===e)return t?YI:ZI;if("leakyrelu"===e)return t?XI:qI;if("sigmoid"===e)return t?NI:TI;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}var rC=class{constructor(e,t,n,r=!1,a=!1,i=!1,s=null,o=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=VT(this.outputShape.length);let u=r?e[1]:e[2],d=Math.ceil(u/2),c=r?"i * 2, rc.y":"rc.y, i * 2",h=a?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",g="";s&&(f=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${s}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${s}\n        }`:`vec4 activation(vec4 x) {\n          ${s}\n        }`,g="result = activation(result);");let y=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let b="rc.x",x="rc.x";e[0]<t[0]?b=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(x=`imod(rc.x, ${t[0]})`),this.userCode=`\n      ${f}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${d}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ${b};\n        int batchB = ${x};\n        for (int i = 0; i < ${d}; i++) {\n          vec4 a = getMatrixA(batchA, ${c});\n          vec4 b = getMatrixB(batchB, ${h});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${m[0]});\n          result += (${p[1]} * ${m[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}},aC={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},iC=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=$m.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}},sC="return a * b;";function oC(e){let t,{inputs:n,backend:r}=e,{a,b:i}=n,s=$m.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){let e=r.texData.get(a.dataId),t=r.texData.get(i.dataId),n=new iC(aC.REAL,a.shape,i.shape),s=new iC(aC.IMAG,a.shape,i.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:a.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:i.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:i.shape}],l=r.runWebGLProgram(n,o,"float32"),u=r.runWebGLProgram(s,o,"float32"),d=HI({inputs:{real:l,imag:u},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(u),d}if(r.shouldExecuteOnCPU([a,i])){let e=r.texData.get(a.dataId),t=r.texData.get(i.dataId),[n,o]=L_(a.shape,i.shape,e.values,t.values,s),l=r.makeTensorInfo(o,s);return r.texData.get(l.dataId).values=n,l}return t=Ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new WI(sC,a.shape,i.shape):new BI(sC,a.shape,i.shape),r.runWebGLProgram(t,[a,i],s)}var lC={kernelName:Vn,backendName:"webgl",kernelFunc:oC};function uC(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,s=n,o=Sa.sizeFromShape(a.shape),l=Sa.inferFromImplicitShape(i,o),u=Sa.sizeFromShape(l);Sa.assert(o===u,(()=>`The new shape (${l}) has ${u} elements and the old shape (${a.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`));let d=s.texData.get(a.dataId);return!d.isPacked||lT(a.shape,l)||null!==d.texture&&lT(d.shape,l)?(s.incRef(a.dataId),{dataId:a.dataId,shape:l,dtype:a.dtype}):function(e,t,n){let r=[rT(e.shape),...aT(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[rT(t),...aT(t)],s=new pI(i,r),o=[r],l=n.runWebGLProgram(s,[a],e.dtype,o,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}(a,l,s)}var dC={kernelName:dr,backendName:"webgl",kernelFunc:uC},cC=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];let s=4*Math.floor(n/4),o=n%4,l="sumValue += dot(values, ones);";if(null!=t){let e=1/t;l=`sumValue += dot(values * ${Sa.isInt(e)?e.toPrecision(2):e}, ones);`}let u="";a%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===o}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}},hC=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];let s="0.0",o="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",o="min"):"max"===t&&(s="-1.0 / 1e-20",o="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");let u=4*Math.floor(n/4),d=n%4,c=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${o}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${o}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,h="vec4";"all"===t?(s="1.0",c="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(s="0.0",c="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let p="";a%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${s};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${s});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${u}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${u};\n        if (${1===d}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${c}\n        } else if (${2===d}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${c}\n        } else if (${3===d}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${c}\n        }\n        setOutput(${l});\n      }\n    `}};function pC(e,t,n,r){let a=function(e){let t=[];for(;0===t.length||1!==t[t.length-1].outSize;){let n=t.length?t[t.length-1].outSize:e[1],r=$m.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e;for(let s=0;s<a.length;s++){let o,l,{inSize:u,windowSize:d,outSize:c}=a[s];o="mean"===n?0===s?new cC({windowSize:d,inSize:u,batchSize:e.shape[0],outSize:c},u):new cC({windowSize:d,inSize:u,batchSize:e.shape[0],outSize:c}):new hC({windowSize:d,inSize:u,batchSize:e.shape[0],outSize:c},n),l=i,i=r.runWebGLProgram(o,[i],t),l.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(l)}return i}var mC=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;let r=FT(this.rank),a=function(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let t=0;t<e.length;t++)r[e[t]]=n[t];return r.join()}(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${a}));\n    }\n    `}},fC=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let r=FT(this.rank),a=cI("rc",this.rank),i=new Array(this.rank);for(let e=0;e<t.length;e++)i[t[e]]=a[e];let s=`vec2(${i.slice(-2).join()})`,o=`++${a[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${s})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${o}) {\n        result[1] = ${l};\n      }\n      --${a[this.rank-1]};\n      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${o}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}};function gC(e,t,n){let r=Ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fC(e.shape,t):new mC(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function yC(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;return function(e,t,n,r){let a=t,i=e.shape.length,s=Sa.parseAxisParam(a,e.shape),o=s,l=$m.getAxesPermutation(o,i),u=null!=l,d=e;u&&(d=gC(e,l,r),o=$m.getInnerMostAxes(o.length,i)),$m.assertAxesAreInnerMostDims("sum",o,i);let[c,h]=$m.computeOutAndReduceShapes(d.shape,o),p=c;n&&(p=$m.expandShapeToKeepDim(c,s));let m=Sa.sizeFromShape(h),f=uC({inputs:{x:d},attrs:{shape:[Sa.sizeFromShape(e.shape)/m,m]},backend:r}),g=pC(f,yi(e.dtype),"sum",r),y=uC({inputs:{x:g},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(g),u&&r.disposeIntermediateTensorInfo(d),y}(a,i,s,n)}var bC={kernelName:Rr,backendName:"webgl",kernelFunc:yC};function xC(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{perm:s}=a,o=r,l=i.shape.length,u=new Array(l);for(let e=0;e<u.length;e++)u[e]=i.shape[s[e]];if(o.shouldExecuteOnCPU([i])){let e=o.texData.get(i.dataId).values,n=uI(e,i.shape,i.dtype,s,u);t=o.makeTensorInfo(u,i.dtype),o.texData.get(t.dataId).values=n}else t=gC(i,s,o);return t}var AC={kernelName:Qr,backendName:"webgl",kernelFunc:xC},vC=1e3;function wC({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}){let u=e.shape.length,d=t.shape.length,c=n?e.shape[u-2]:e.shape[u-1],h=r?t.shape[d-1]:t.shape[d-2],p=n?e.shape[u-1]:e.shape[u-2],m=r?t.shape[d-2]:t.shape[d-1],f=e.shape.slice(0,-2),g=t.shape.slice(0,-2),y=Sa.sizeFromShape(f),b=Sa.sizeFromShape(g),x=Ml.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([p,m]);Sa.assert(c===h,(()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`));let A,v=n?[y,c,p]:[y,p,c],w=r?[b,m,h]:[b,h,m],k=uC({inputs:{x:e},backend:a,attrs:{shape:v}}),S=uC({inputs:{x:t},backend:a,attrs:{shape:w}}),T=[k,S],_=Math.max(y,b),I=n?k.shape[1]:k.shape[2],C=null!=i,E=null!=s,N="leakyrelu"===l,R=null!=l?nC(l,!0):null;if((1===p||1===m)&&I>vC&&!1===(C||E||N||null!=R)){let e=k,t=S;n&&(e=xC({inputs:{x:k},backend:a,attrs:{perm:[0,2,1]}}),T.push(e)),r&&(t=xC({inputs:{x:S},backend:a,attrs:{perm:[0,2,1]}}),T.push(t));let i=1===m,s=e;1!==m&&(s=uC({inputs:{x:e},backend:a,attrs:{shape:[_,I,1]}}),T.push(s));let o=1===m?2:1,l=t;i&&(l=uC({inputs:{x:t},backend:a,attrs:{shape:[_,1,I]}}),T.push(l));let u=oC({inputs:{a:s,b:l},backend:a});A=yC({inputs:{x:u},backend:a,attrs:{axis:o,keepDims:!0}}),T.push(u)}else{let l=gi(e.dtype,t.dtype),u=new rC(v,w,[_,p,m],n,r,C,R,E,N),d=[k,S];if(null!=i&&d.push(i),E&&d.push(s),N){let e=a.makeTensorInfo([],"float32",Sa.createScalarValue(o,"float32"));d.push(e),T.push(e)}A=a.runWebGLProgram(u,d,l)}let P=uC({inputs:{x:A},backend:a,attrs:{shape:x}});T.push(A);for(let e of T)a.disposeIntermediateTensorInfo(e);return P}var kC={kernelName:la,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:c}=r;return wC({a,b:i,transposeA:l,transposeB:u,backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:c,activation:d})}},SC="return abs(x);",TC={kernelName:Ge,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r}=e,{x:a}=n;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){let e=r.texData.get(a.dataId),t=K_(e.values);return r.makeTensorInfo(a.shape,a.dtype,t)}return t=Ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new RI(a.shape,SC):new yI(a.shape,SC),r.runWebGLProgram(t,[a],a.dtype)}},_C=eC({opSnippet:bI+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),IC={kernelName:qe,backendName:"webgl",kernelFunc:_C},CC=eC({opSnippet:bI+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),EC={kernelName:Xe,backendName:"webgl",kernelFunc:CC},NC="return a + b;",RC=tC({opSnippet:NC,packedOpSnippet:NC,supportsComplex:!0,cpuKernelImpl:g_}),PC={kernelName:Ke,backendName:"webgl",kernelFunc:RC},DC={kernelName:Ze,backendName:"webgl",kernelFunc:function e(t){let{inputs:n,backend:r}=t,a=n;if(1===a.length)return VI({inputs:{x:a[0]},backend:r});if(a.length>Ue().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let t=Math.floor(a.length/2),n=e({inputs:a.slice(0,t),backend:r}),i=e({inputs:a.slice(t),backend:r});return e({inputs:[n,i],backend:r})}let i=a.map((e=>e.dtype)).reduce(((e,t)=>gi(e,t))),s=a.map((e=>e.shape)),o=Ue().getBool("WEBGL_PACK")?new class{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));let n=[];this.variableNames.forEach((e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)}));let r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}(a[0].shape,s):new class{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));let n=[];this.variableNames.forEach((e=>{n.push(`float v${e} = get${e}AtOutCoords();`)}));let r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}(a[0].shape,s);return r.runWebGLProgram(o,a,i)}},MC={kernelName:Ye,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=Sa.parseAxisParam(i,a.shape),u=l,d=$m.getAxesPermutation(u,o),c=a;null!=d&&(c=xC({inputs:{x:a},backend:n,attrs:{perm:d}}),u=$m.getInnerMostAxes(u.length,o)),$m.assertAxesAreInnerMostDims("all",u,o);let h,[p,m]=$m.computeOutAndReduceShapes(c.shape,u),f=uC({inputs:{x:c},backend:n,attrs:{shape:[-1,Sa.sizeFromShape(m)]}}),g=pC(f,f.dtype,"all",n);return h=uC(s?{inputs:{x:g},backend:n,attrs:{shape:$m.expandShapeToKeepDim(p,l)}}:{inputs:{x:g},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(c),h}},OC={kernelName:Je,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=Sa.parseAxisParam(i,a.shape),u=l,d=$m.getAxesPermutation(u,o),c=a;null!=d&&(c=xC({inputs:{x:a},backend:n,attrs:{perm:d}}),u=$m.getInnerMostAxes(u.length,o)),$m.assertAxesAreInnerMostDims("any",u,o);let h,[p,m]=$m.computeOutAndReduceShapes(c.shape,u),f=uC({inputs:{x:c},backend:n,attrs:{shape:[-1,Sa.sizeFromShape(m)]}}),g=pC(f,f.dtype,"any",n);return h=uC(s?{inputs:{x:g},backend:n,attrs:{shape:$m.expandShapeToKeepDim(p,l)}}:{inputs:{x:g},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(c),h}},$C=class{constructor(e,t,n){this.variableNames=["A"];let{windowSize:r,batchSize:a,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];let s="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${o};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${s} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}},FC=class{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Sa.assert(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));let a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");let s,o,l=this.outputShape,u=l.length,d=FT(u),c=hI("coords",u);if(1===i){o=u+1;let e=FT(o);s=`\n        ${e} sourceLocR = ${e}(${c.join()}, 0);\n        ++${c[u-1]};\n        ${e} sourceLocG = ${e}(${c.join()}, 0);\n        ++${c[u-2]};\n        ${e} sourceLocA = ${e}(${c.join()}, 0);\n        --${c[u-1]};\n        ${e} sourceLocB = ${e}(${c.join()}, 0);\n        --${c[u-2]};`}else o=u,s=`\n        ${d} sourceLocR = coords;\n        ++${c[u-1]};\n        ${d} sourceLocG = coords;\n        ++${c[u-2]};\n        ${d} sourceLocA = coords;\n        --${c[u-1]};\n        ${d} sourceLocB = coords;\n        --${c[u-2]};`;let h=["x","y","z","w","u","v"].slice(0,o),p="."+h[o-1],m=h.map((e=>"int "+e)),f=hI("sourceLocR",o-1).concat("inIdx.r"),g=hI("sourceLocG",o-1).concat("inIdx.g"),y=hI("sourceLocB",o-1).concat("inIdx.b"),b=hI("sourceLocA",o-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",A=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${f.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,v=`vec4(\n            getAChannel(${f.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,w=r?"":`\n      float getBestIndicesAChannel(${m.join()}) {\n        return getChannel(getBestIndicesA(${h.join()}),\n                                          vec2(${h.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${m.join()}) {\n        return getChannel(getA(${h.join()}),\n                               vec2(${h.slice(-2).join()}));\n      }\n      ${w}\n      void main() {\n        ${d} coords = getOutputCoords();\n        bool hasNextCol = ${c[u-1]} < ${l[u-1]-1};\n        bool hasNextRow = ${c[u-2]} < ${l[u-2]-1};\n        ${s}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${v};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${A}\n          vec4 candidate = ${v};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}};function LC(e,t,n,r=null){let a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);let s=$m.computeOptimalWindowSize(i),o={windowSize:s,inSize:i,batchSize:a,outSize:Math.ceil(i/s)},l=new $C(o,n,null==r),u=[t];null!=r&&u.push(r);let d=e.runWebGLProgram(l,u,"int32");if(1===d.shape[1])return d;let c=LC(e,t,n,d);return e.disposeIntermediateTensorInfo(d),c}function zC(e,t,n,r=null){let a=null!=r?r.shape:t.shape,i=a[a.length-1],s=$m.computeOptimalWindowSize(i),o=new FC(a,s,n,null==r),l=null==r?[t]:[t,r],u=e.runWebGLProgram(o,l,"int32");if(u.shape.length===t.shape.length){let r=zC(e,t,n,u);return e.disposeIntermediateTensorInfo(u),r}return u}function BC(e,t,n,r){let a=[n];if($m.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Ue().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let n=[],i=e.texData.get(t.dataId),s=t;null!==i&&i.isPacked&&(s=e.unpackTensor(t),n.push(s));let[o,l]=$m.computeOutAndReduceShapes(s.shape,a),u=Sa.sizeFromShape(l),d=uC({inputs:{x:s},backend:e,attrs:{shape:[-1,u]}});n.push(d);let c=LC(e,d,r);n.push(c);let h=uC({inputs:{x:c},backend:e,attrs:{shape:o}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),h}return zC(e,t,r)}var UC={kernelName:Qe,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r,s=Sa.parseAxisParam(i,a.shape),o=$m.getAxesPermutation(s,a.shape.length),l=a,u=[];null!=o&&(l=xC({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=$m.getInnerMostAxes(s.length,l.shape.length)),$m.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let d=BC(n,l,s[0],"max");return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}},WC={kernelName:et,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r,s=Sa.parseAxisParam(i,a.shape),o=$m.getAxesPermutation(s,a.shape.length),l=a,u=[];null!=o&&(l=xC({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=$m.getInnerMostAxes(s.length,l.shape.length)),$m.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let d=BC(n,l,s[0],"min");return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}},VC=eC({opSnippet:bI+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),jC={kernelName:tt,backendName:"webgl",kernelFunc:VC},HC=eC({opSnippet:bI+"return log(x + sqrt(x * x + 1.0));"}),GC={kernelName:nt,backendName:"webgl",kernelFunc:HC},qC=eC({opSnippet:bI+"\n  return atan(x);\n"}),XC={kernelName:rt,backendName:"webgl",kernelFunc:qC},KC=tC({opSnippet:zI+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+UI+"\n  return result;\n"}),ZC={kernelName:it,backendName:"webgl",kernelFunc:KC},YC=eC({opSnippet:bI+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),JC={kernelName:at,backendName:"webgl",kernelFunc:YC},QC=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;let m="avg"===t,f=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,y="0.0";if(m||(y="-1.0 / 1e-20"),n){let t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${s}, ${o});\n        const ivec2 pads = ivec2(${h}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${d};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${c};\n                wC += ${u}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?a?f:g:`wR * ${c} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(b="avgValue / max(count, 1.0)");let x=4*Math.floor(i/4),A=i%4,v=`\n      if (${m}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${s}, ${o});\n      const ivec2 pads = ivec2(${h}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${d};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${x}; wC += 4) {\n            int xC = xCCorner + wC * ${u};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              getValue(batch, xR, xC + 3 * ${u}, d)\n            );\n\n            ${v}\n          }\n\n          int xC = xCCorner + ${x};\n          if (${1===A}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${v}\n          } else if (${2===A}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${v}\n          } else if (${3===A}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              initializationValue\n            );\n\n            ${v}\n          }\n        }\n        setOutput(${b});\n      }\n    `}},eE=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,s=e.strideDepth,o=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,f=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;let b="avg"===t,x="0.0";if(b||(x="-1.0 / 1e-20"),n){let t=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${s}, ${o}, ${l});\n        const ivec3 pads = ivec3(${f}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${u}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${d}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${m};\n                  wC += ${c}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${t} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +\n                      wR * ${m} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let A=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(A="avgValue / max(count, 1.0)");let v=4*Math.floor(i/4),w=i%4,k=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${s}, ${o}, ${l});\n      const ivec3 pads = ivec3(${f}, ${g}, ${y});\n      const float initializationValue = ${x};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${x});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${u}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${d}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${v}; wC += 4) {\n              int xC = xCCorner + wC * ${c};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${c}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${c}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${c}, ch)\n              );\n\n              ${k}\n            }\n\n            int xC = xCCorner + ${v};\n            if (${1===w}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${2===w}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${c}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${3===w}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${c}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${c}, ch),\n                initializationValue\n              );\n\n              ${k}\n            }\n          }\n        }\n        setOutput(${A});\n      }\n    `}},tE={kernelName:st,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;AT(a,"avgPool");let{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;Sa.assert($m.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));let u=$m.computePool2DInfo(a.shape,i,s,1,o,l);if(1===u.filterWidth&&1===u.filterHeight&&Sa.arraysEqual(u.inShape,u.outShape))return VI({inputs:{x:a},backend:n});let d=new QC(u,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},nE={kernelName:lt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r,d=$m.computePool3DInfo(a.shape,i,s,[1,1,1],o,l,u),c=new eE(d,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}},rE={kernelName:ut,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:u,dimRoundingMode:d}=r,c=$m.computePool3DInfo(s.shape,o,l,[1,1,1],u,d),h=new class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=c-1-e.padInfo.top,f=h-1-e.padInfo.left,g=1/(t*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${m}, ${f});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${o}) {\n          float dyD = float(dyDCorner + wD) / ${a}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${i}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${u}) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(c);return n.runWebGLProgram(h,[a],s.dtype)}},aE={kernelName:ot,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;AT([a,i],"avgPoolGrad");let{filterSize:o,strides:l,pad:u}=r,d=$m.computePool2DInfo(s.shape,o,l,1,u),c=new class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=o-1-e.padInfo.top,d=l-1-e.padInfo.left,c=1/(t*n);this.userCode=`\n      const ivec2 pads = ivec2(${u}, ${d});\n      const float avgMultiplier = float(${c});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${o};\n            wR += ${i}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${s}) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(d);return n.runWebGLProgram(c,[a],s.dtype)}},iE={kernelName:dt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i}=t,{transposeA:s,transposeB:o}=r;return wC({a,b:i,transposeA:s,transposeB:o,backend:n})}},sE={kernelName:rn,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,mean:a,variance:i,offset:s,scale:o}=e;Sa.assert(a.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Sa.assert(null==s||a.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Sa.assert(null==o||a.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=n;null==l&&(l=.001);let u=[r,a,i],d=null;null!=s&&(d=s.shape,u.push(s));let c=null;null!=o&&(c=o.shape,u.push(o));let h=Ue().getBool("WEBGL_PACK_NORMALIZATION")?new class{constructor(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],$m.assertAndGetBroadcastShape(e,t),$m.assertAndGetBroadcastShape(e,n);let s="vec4(0.0)";null!=r&&($m.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=a&&($m.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${s};\n        vec4 scale = ${o};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${i}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}(r.shape,a.shape,i.shape,d,c,l):new class{constructor(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],$m.assertAndGetBroadcastShape(e,t),$m.assertAndGetBroadcastShape(e,n);let s="0.0";null!=r&&($m.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="1.0";null!=a&&($m.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${s};\n        float scale = ${o};\n        float inv = scale * inversesqrt(variance + float(${i}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}(r.shape,a.shape,i.shape,d,c,l);return t.runWebGLProgram(h,u,u[0].dtype)}},oE=["x","y","z","w","u","v"];function lE(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r,[o,l]=dm.parseSliceParams(a,i,s);if(dm.assertParamsValid(a,o,l),0===Sa.sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){let e=n.texData.get(a.dataId),t=Z_(e.values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,t)}let{isPacked:u}=n.texData.get(a.dataId),d=dm.isSliceContinous(a.shape,o,l);if(u||!d){let e=Ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let t=FT(this.rank),n=hI("coords",this.rank),r=hI("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${a})`,s=`\n      result.x = ${i};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${i};\n        --${r[this.rank-1]};\n      }\n    `,o=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${i};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${i};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map(((e,t)=>`start[${t}]`)).join()});`:e.map(((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`)).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${s}\n        ${o}\n        setOutput(result);\n      }\n    `}}(l):new class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let t=FT(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n,r=function(e){if(1===e)return"sourceLoc";if(e<=6)return oE.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);n=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${e.map(((e,t)=>`sourceLoc.${oE[t]} = start[${t}] + coords.${oE[t]};`)).join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${n}\n        setOutput(getSource(${r}));\n      }\n    `}}(l),t=[o];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),function(e,t,n,r){let a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),s=r.texData.get(i.dataId);Object.assign(s,a),s.refCount=1,s.shape=n,s.dtype=e.dtype;let o=dm.computeFlatOffset(t,Sa.computeStrides(e.shape));a.slice&&(o+=a.slice.flatOffset),s.slice={flatOffset:o,origDataId:a.slice&&a.slice.origDataId||e.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}(a,o,l,n)}var uE={kernelName:Sr,backendName:"webgl",kernelFunc:lE},dE={kernelName:ct,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;Sa.assert(a.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));let o=i.reduce(((e,t)=>e*t)),l=$m.getReshaped(a.shape,i,o),u=$m.getPermuted(l.length,i.length),d=$m.getReshapedPermuted(a.shape,i,o),c=$m.getSliceBeginCoords(s,i.length),h=$m.getSliceSize(d,s,i.length),p=[],m=uC({inputs:{x:a},backend:n,attrs:{shape:l}}),f=xC({inputs:{x:m},backend:n,attrs:{perm:u}}),g=uC({inputs:{x:f},backend:n,attrs:{shape:d}}),y=lE({inputs:{x:g},backend:n,attrs:{begin:c,size:h}});return p.push(m),p.push(f),p.push(g),p.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}},cE={kernelName:ht,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=n.readSync(a.dataId),l=n.readSync(i.dataId),u=y_(o,l,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,u)}},hE={kernelName:pt,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r}=e,{a,b:i}=n,s=Ue().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Ue().getNumber("WEBGL_VERSION");if(r.shouldExecuteOnCPU([a,i])||1===o){let e=r.texData.get(a.dataId).values,t=r.texData.get(i.dataId).values,[n,s]=x_(a.shape,i.shape,e,t,a.dtype),o=r.makeTensorInfo(s,a.dtype);return r.texData.get(o.dataId).values=n,o}return t=s?new WI("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",a.shape,i.shape,!1):new BI("\n  return float(int(a.r) & int(b.r));\n",a.shape,i.shape),r.runWebGLProgram(t,[a,i],a.dtype)}},pE={kernelName:ft,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.readSync(r.dataId),s=n.readSync(a.dataId),o=$m.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},mE=tC({opSnippet:"return float(a != b);",cpuKernelImpl:B_,dtype:"bool"}),fE={kernelName:Hn,backendName:"webgl",kernelFunc:mE};function gE(e){let{inputs:t,backend:n}=e,{input:r}=t;return VI({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var yE={kernelName:or,backendName:"webgl",kernelFunc:gE},bE={kernelName:gt,backendName:"webgl",kernelFunc:function e(t){let{inputs:n,backend:r,attrs:a}=t,{x:i}=n,{dtype:s}=a;if("complex64"===s){if("complex64"===i.dtype)return VI({inputs:{x:i},backend:r});let t=nd(i.shape),n=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),a=HI({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),a}if("complex64"===i.dtype){let t=gE({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(t),n}if(!Sa.hasEncodingLoss(i.dtype,s)){let e=VI({inputs:{x:i},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if(r.shouldExecuteOnCPU([i])){let e=r.texData.get(i.dataId).values,[t,n,a]=A_(e,i.shape,i.dtype,s);return r.makeTensorInfo(t,n,a)}if("int32"===s)return function(e,t){let n=new yI(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===s){let e=r.makeTensorInfo([],"bool",Sa.getTypedArrayFromDType("bool",1)),t=mE({inputs:{a:i,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}},xE="return ceil(x);",AE=eC({opSnippet:xE,packedOpSnippet:xE,cpuKernelImpl:v_}),vE={kernelName:yt,backendName:"webgl",kernelFunc:AE},wE={kernelName:bt,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{clipValueMin:s,clipValueMax:o}=a;t=Ue().getBool("WEBGL_PACK_CLIP")?new class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}(i.shape):new class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}(i.shape);let l=[[s],[o]];return r.runWebGLProgram(t,[i],i.dtype,l)}};function kE(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var SE={kernelName:At,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),i=new class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}(r.shape),s=[kE(r,a.complexTensorInfos.real),kE(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,s,s[0].dtype)}},TE=class{constructor(e){this.outputShape=[],this.outputShape=$m.computeOutShape(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));let t=new Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];let n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){let r=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${r}));`)}let r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}},_E=class{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=$m.computeOutShape(e,t);let n=this.outputShape,r=n.length,a=FT(r),i=hI("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>`T${t}`));let o=new Array(e.length-1);o[0]=e[0][t];for(let n=1;n<o.length;n++)o[n]=o[n-1]+e[n][t];let l=s[t],u=s.slice(-2),d=s.join(),c=`if (${l} < ${o[0]}) {\n        return getChannel(\n            getT0(${d}), vec2(${u.join()}));\n        }`;for(let e=1;e<o.length;e++){let t=o[e-1];c+=`\n        if (${l} < ${o[e]}  && ${l} >= ${o[e-1]}) {\n          return getChannel(\n            getT${e}(${IE(s,l,t)}),\n            vec2(${IE(u,l,t)}));\n        }`}let h=o.length,p=o[o.length-1];c+=`\n        return getChannel(\n          getT${h}(${IE(s,l,p)}),\n          vec2(${IE(u,l,p)}));`,this.userCode=`\n      float getValue(${s.map((e=>"int "+e))}) {\n        ${c}\n      }\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${i}), 0., 0., 0.);\n\n        ${i[r-1]} = ${i[r-1]} + 1;\n        if (${i[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${i});\n        }\n\n        ${i[r-2]} = ${i[r-2]} + 1;\n        if (${i[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${i});\n        }\n\n        ${i[r-1]} = ${i[r-1]} - 1;\n        if (${i[r-2]} < ${n[r-2]} &&\n            ${i[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${i});\n        }\n        setOutput(result);\n      }\n    `}};function IE(e,t,n){let r=e.indexOf(t);return e.map(((e,t)=>t===r?`${e} - ${n}`:e)).join()}function CE(e){let{inputs:t,backend:n}=e,{input:r}=t;return VI({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var EE={kernelName:cn,backendName:"webgl",kernelFunc:CE};function NE(e,t,n){let r=e[0].dtype;if("complex64"===r){let r=e.map((e=>gE({inputs:{input:e},backend:n}))),a=e.map((e=>CE({inputs:{input:e},backend:n}))),i=NE(r,t,n),s=NE(a,t,n),o=HI({inputs:{real:i,imag:s},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),a.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){let a=e.map((e=>{let r=[-1,Sa.sizeFromShape(e.shape.slice(t))];return uC({inputs:{x:e},backend:n,attrs:{shape:r}})})),i=a.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),s=$m.computeOutShape(a.map((e=>e.shape)),1),o=1===a[0].shape[0],l=w_(i,s,r,o),u=$m.computeOutShape(e.map((e=>e.shape)),t),d=n.makeTensorInfo(u,r,l);return a.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}let i=e.filter((e=>Sa.sizeFromShape(e.shape)>0)),s=Ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(1===i.length){let t=s?new yI(e[0].shape,SI):new RI(e[0].shape,SI);return n.runWebGLProgram(t,e,r)}let o=Ue().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>o){let e=[];for(let r=0;r<i.length;r+=o){let a=i.slice(r,r+o);e.push(NE(a,t,n))}let r=NE(e,t,n);for(let t of e)n.disposeIntermediateTensorInfo(t);return r}if(s){let e=new _E(i.map((e=>e.shape)),t);return n.runWebGLProgram(e,i,r)}let{tensors2D:l,outShape:u}=function(e,t,n){let r=$m.computeOutShape(e.map((e=>e.shape)),t);return{tensors2D:e.map((e=>uC({inputs:{x:e},attrs:{shape:[-1,Sa.sizeFromShape(e.shape.slice(t))]},backend:n}))),outShape:r}}(i,t,n),d=new TE(l.map((e=>e.shape))),c=n.runWebGLProgram(d,l,r);l.forEach((e=>n.disposeIntermediateTensorInfo(e)));let h=uC({inputs:{x:c},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(c),h}function RE(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=Sa.parseAxisParam(a,t[0].shape)[0],s=t.map((e=>e.shape));$m.assertParamsConsistent(s,i);let o=$m.computeOutShape(t.map((e=>e.shape)),i);if(0===Sa.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);let l=t.filter((e=>Sa.sizeFromShape(e.shape)>0));return 1===l.length?VI({inputs:{x:l[0]},backend:n}):NE(l,i,n)}var PE={kernelName:vt,backendName:"webgl",kernelFunc:RE},DE=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let i=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,p=4*Math.floor(e.inChannels/4),m=e.inChannels%4,f="channelsLast"===e.dataFormat,g=f?1:2,y=f?2:3,b=f?3:1,x="",A="";n&&(x=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,A="result = activation(result);");let v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${x}\n\n      const ivec2 strides = ivec2(${o}, ${l});\n      const ivec2 pads = ivec2(${i}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${c}; wR++) {\n          int xR = xRCorner + wR * ${u};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${d};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${f}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===m}) {\n\n              if (${f}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===m}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===m}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${v}\n        ${A}\n        setOutput(result);\n      }\n    `}},ME=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=VT(this.outputShape.length);let i=e.padInfo.left,s=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,u=e.filterWidth,d=u,c="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<u;e++)c+=`\n           vec4 xTexelC${2*e};\n           int xTexelC${2*e}Ready;\n           vec4 xTexelC${2*e+1};\n           int xTexelC${2*e+1}Ready;\n           vec4 xC${e};`;c+=`\n     for (int r = 0; r < ${l}; r++) {\n      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {\n       `;for(let e=0;e<u;e++)c+=`\n           xTexelC${2*e} = vec4(0.0);\n           xTexelC${2*e}Ready = 0;\n           xTexelC${2*e+1} = vec4(0.0);\n           xTexelC${2*e+1}Ready = 0;\n           xC${e} = vec4(0.0);`;c+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let t=0;t<(d+1)/2;t++){let n=2*t;if(c+=`\n           xC = xCCorner + ${n*o};\n           `,1===s){if(n<u&&(i%2==1?(c+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n               `,c+=1===o&&n>0?`\n                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);\n                   } else {\n                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);\n                   }\n                   `):c+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xC${n} = xTexelC${n};\n                 `,n+1<u)){let e=i%2==0?Sa.nearestLargerEven(o):o;o%2==0&&i%2==1||o%2!=0&&i%2!=1?(c+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${n+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${n+1}Ready = 1;\n                   }\n                   `,c+=o>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);\n                     } else {\n                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);\n                     }\n                     `:`\n                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);\n                     `):c+=1===e?`\n                     xC${n+1} = xTexelC${n};\n                     `:`\n                     xCOffset = xC + ${e};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${n+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${n+1}Ready = 1;\n                     }\n\n                     xC${n+1} = xTexelC${n+1};\n                     `}}else n<u&&(i%2==1?(c+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n               `,n+1<u&&(c+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);\n                 `)):(c+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(\n                   xTexelC${n}.xy, xTexelC${n+1}.xy);\n               `,n+1<u&&(c+=`\n                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n                 `)));n<u&&(c+=`\n             wTexel = getW(r, ${n}, d1, d2);\n             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${e.inChannels}) {\n               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,n+1<u&&(c+=`\n               wTexel = getW(r, ${n+1}, d1, d2);\n               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${e.inChannels}) {\n                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}c+="\n     }\n   ",c+="\n     }\n   ",c+="\n     }\n   ";let h="",p="";n&&(h=r?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:a?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,p="result = activation(result);");let m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${h}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${c}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${m}\n         ${p}\n         setOutput(result);\n       }\n     `}};function OE(e,t){let n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function $E({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){let l,u=e.shape,d=r.texData.get(e.dataId),c=n.inChannels,h=u[0]*u[1]*u[2],p=n.outChannels,m="channelsLast"===n.dataFormat,f=[];if(null!=i){let e=OE(i.shape,m);null!=e&&(i=uC({inputs:{x:i},backend:r,attrs:{shape:e}}),f.push(i))}if(null!=a){let e=OE(a.shape,m);null!=e&&(a=uC({inputs:{x:a},backend:r,attrs:{shape:e}}),f.push(a))}if((1!==h&&1!==p||!(c>vC))&&d.isPacked&&m&&null!=d.texture&&u[2]%2!=0&&Sa.arraysEqual(d.shape.slice(-3),u.slice(-3))){let c=u[0]*u[1]*(u[2]+1),h={dataId:e.dataId,shape:[1,c,n.inChannels],dtype:e.dtype},p=d.shape;d.shape=d.shape.slice(),d.shape[d.shape.length-2]++,Sa.assert(lT(d.shape,h.shape),(()=>`packed reshape ${d.shape} to ${h.shape} isn't free`));let m=uC({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});f.push(m);let g=wC({a:h,b:m,backend:r,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s}),y=r.texData.get(g.dataId);Sa.assert(y.isPacked,(()=>"batchMatMul result is expected to be packed")),d.shape=p,y.shape=n.outShape,l=VI({inputs:{x:g},backend:r}),l.shape=n.outShape,f.push(g)}else{let u=n.outHeight*n.outWidth,d=uC({inputs:{x:e},backend:r,attrs:{shape:m?[n.batchSize,u,n.inChannels]:[n.batchSize,n.inChannels,u]}}),c=uC({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=wC({a:m?d:c,b:m?c:d,transposeA:!m,transposeB:!1,backend:r,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s});l=uC({inputs:{x:h},backend:r,attrs:{shape:n.outShape}}),f.push(d),f.push(c),f.push(h)}for(let e of f)r.disposeIntermediateTensorInfo(e);return l}function FE({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){let{filterWidth:l,filterHeight:u,inChannels:d,outWidth:c,outHeight:h,dataFormat:p}=n,m="channelsLast"===p,f=l*u*d,g=h*c,y=[n.batchSize,f,g],b=[];if(null!=i){let e=OE(i.shape,m);null!=e&&(i=uC({inputs:{x:i},backend:r,attrs:{shape:e}}),b.push(i))}if(null!=a){let e=OE(a.shape,m);null!=e&&(a=uC({inputs:{x:a},backend:r,attrs:{shape:e}}),b.push(a))}let x=uC({inputs:{x:t},backend:r,attrs:{shape:[1,f,Sa.sizeFromShape(t.shape)/f]}});b.push(x);let A=new class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=VT(this.outputShape.length);let{dataFormat:n}=t,r=wT(),a="channelsLast"===n,i=a?1:2,s=a?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,l="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)l+=`\n          blockIndex = rc.z + ${t};\n          pos = rc.y + ${e};\n\n          ${o}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${i}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${s}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${a}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*e+t}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*e+t}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${l}\n\n        ${r.output} = result;\n      }\n    `}}(y,n),v=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],w=r.runWebGLProgram(A,[e],"float32",v),k=uC({inputs:{x:w},backend:r,attrs:{shape:y}});b.push(w),b.push(k);let S=null!=a,T=null!=i,_="leakyrelu"===o,I=o?nC(o,!0):null,C=new rC(m?k.shape:x.shape,m?x.shape:k.shape,m?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],!0,!1,S,I,T,_),E=m?[k,x]:[x,k];if(a&&E.push(a),T&&E.push(i),_){let e=r.makeTensorInfo([],"float32",Sa.createScalarValue(s,"float32"));E.push(e),b.push(e)}let N=r.runWebGLProgram(C,E,"float32"),R=uC({inputs:{x:N},backend:r,attrs:{shape:n.outShape}});b.push(N);for(let e of b)r.disposeIntermediateTensorInfo(e);return R}var LE,zE={kernelName:wt,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i,filter:s}=n,{strides:o,pad:l,dataFormat:u,dilations:d,dimRoundingMode:c}=a,h=$m.convertConv2DDataFormat(u),p=$m.computeConv2DInfo(i.shape,s.shape,o,d,l,c,!1,h);if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(p.strideWidth<=2&&"channelsLast"===h&&Ue().getBool("WEBGL_EXP_CONV")){let e=new ME(p),n=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];t=r.runWebGLProgram(e,[i,s],"float32",n)}else if(Ue().getBool("WEBGL_CONV_IM2COL"))t=FE({x:i,filter:s,convInfo:p,backend:r});else{let e=new DE(p);t=r.runWebGLProgram(e,[i,s],"float32")}else t=$E({x:i,filter:s,convInfo:p,backend:r});let m=uC({inputs:{x:t},backend:r,attrs:{shape:p.outShape}});return r.disposeIntermediateTensorInfo(t),m}},BE={kernelName:kt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:d}=r,c=$m.convertConv2DDataFormat(l),h=$m.computeConv2DInfo(a.shape,d,s,1,o,u,!1,c),p=new class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${a};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              ${i?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);"}\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(h);return n.runWebGLProgram(p,[a,i],"float32")}},UE={kernelName:St,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:s,strides:o,pad:l,dataFormat:u,dimRoundingMode:d}=r,c=$m.convertConv2DDataFormat(u),h=$m.computeConv2DInfo(s,i.shape,o,1,l,d,!1,c);if(Ue().getBool("WEBGL_PACK")&&"channelsLast"===c){let e=[[h.strideHeight,h.strideWidth]],t=new class{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=VT(this.outputShape.length);let t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode=`\n      const ivec2 pads = ivec2(${r}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            int wCPerm = ${n} - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    `}}(h);return n.runWebGLProgram(t,[a,i],"float32",e)}{let e=new class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=i?1:2,u=i?2:3,d=i?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${d}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${i}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(h);return n.runWebGLProgram(e,[a,i],"float32")}}},WE={kernelName:Tt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,u=$m.computeConv3DInfo(a.shape,i.shape,s,l,o),d=new class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,c=e.filterHeight,h=e.filterWidth,p=4*Math.floor(e.inChannels/4),m=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${a}, ${i}, ${s});\n      const ivec3 pads = ivec3(${t}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${d}; wF++) {\n          int xF = xFCorner + wF * ${o};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${c}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===m}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(u);return n.runWebGLProgram(d,[a,i],"float32")}},VE={kernelName:_t,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r,u=$m.computeConv3DInfo(a.shape,l,s,1,o),d=new class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,s=e.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${t} - ${a};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${i};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${s};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(u);return n.runWebGLProgram(d,[a,i],"float32")}},jE={kernelName:It,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r,u=$m.computeConv3DInfo(l,i.shape,o,1,s),d=new class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${o}, ${l}, ${u});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${a}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${i}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(u);return n.runWebGLProgram(d,[a,i],"float32")}},HE=eC({opSnippet:QI+"\n  return cos(x);\n",packedOpSnippet:`\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ${UI}\n  return result;\n`}),GE={kernelName:Ct,backendName:"webgl",kernelFunc:HE},qE=eC({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),XE={kernelName:Et,backendName:"webgl",kernelFunc:qE},KE={kernelName:Pt,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:u}=r,d=new class{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[i,s,o,l]=e,[u]=t,[d,c]=n;this.outputShape=[u,d,c,l];let h="bilinear"===r?1:0,[p,m]=[s-1+".0",o-1+".0"],[f,g,y]=d>1?[""+(s-1)/(d-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,x,A]=c>1?[""+(o-1)/(c-1),"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`\n      const float height_ratio = float(${f});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${i}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${x};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${a}));\n          return;\n        }\n        float in_x = ${A};\n        if( in_x < 0.0 || in_x > ${m} ) {\n          setOutput(float(${a}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}(a.shape,i.shape,o,l,u);return n.runWebGLProgram(d,[a,i,s],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(LE||(LE={}));var ZE=class{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let a=this.outputShape.length,i=this.op===LE.Prod?"1.0":"0.0",s=n?i:`getX(${YE(a,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1],l="",u="";n?(l=r?"end != "+(o-1):"end != 0",u=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${o}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${FT(a)} coords = getOutputCoords();\n        int end = ${JE(a,"coords",this.op)};\n        float val = ${s};\n        int pow2 = int(pow(2.0, index));\n        if (${l}) {\n          int idx = ${u};\n          ${JE(a,"coords",this.op)} = idx;\n          val ${this.op}= getX(${YE(a,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}};function YE(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function JE(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function QE(e,t,n,r,a,i){let s=t.shape.length,o=$m.getAxesPermutation([r],s),l=t;null!=o&&(l=xC({inputs:{x:t},backend:n,attrs:{perm:o}}));let u=$m.getInnerMostAxes(1,s)[0];if(u!==s-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let d=l.shape[u],c=VI({inputs:{x:l},backend:n});for(let t=0;t<=Math.ceil(Math.log2(d))-1;t++){let r=new ZE(e,l.shape,!1,i),a=[[t]],s=c;c=n.runWebGLProgram(r,[c],c.dtype,a),n.disposeIntermediateTensorInfo(s)}if(a){let t=new ZE(e,l.shape,a,i),r=c;c=n.runWebGLProgram(t,[c],c.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=o){let e=xC({inputs:{x:c},backend:n,attrs:{perm:$m.getUndoAxesPermutation(o)}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),e}return c}var eN={kernelName:Nt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return QE(LE.Prod,a,n,i,s,o)}},tN={kernelName:Rt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return QE(LE.Sum,a,n,i,s,o)}},nN={kernelName:Dt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r;if(1===a.shape.length){let e=n.readSync(a.dataId),t=n.readSync(i.dataId),r=y_(e,t,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,r)}if(2===a.shape.length){let e=n.bufferSync(a),t=n.bufferSync(i),r=b_(e,t,s,o);return n.makeTensorInfo(r.shape,i.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}},rN={kernelName:Mt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r,o=a.shape[0],l=("NHWC"===s?a.shape[1]:a.shape[2])*i,u=("NHWC"===s?a.shape[2]:a.shape[3])*i,d=("NHWC"===s?a.shape[3]:a.shape[1])/(i*i),c="NHWC"===s?[o,l,u,d]:[o,d,l,u],h=new class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}(c,i,s);return n.runWebGLProgram(h,[a],a.dtype)}},aN=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=VT(this.outputShape.length);let i=e.filterHeight,s=e.filterWidth,o=e.outChannels/e.inChannels,l="",u="";n&&(l=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,u="result = activation(result);");let d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${i}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${d}\n        ${u}\n        setOutput(result);\n      }\n    `}},iN=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=VT(this.outputShape.length);let i=e.outChannels/e.inChannels,s=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,c=d,h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<d;e++)h+=`\n          vec4 xTexelC${2*e};\n          int xTexelC${2*e}Ready;\n          vec4 xTexelC${2*e+1};\n          int xTexelC${2*e+1}Ready;\n          vec4 xC${e};`;h+=`\n    for (int r = 0; r < ${u}; r++) {\n      `;for(let e=0;e<d;e++)h+=`\n          xTexelC${2*e} = vec4(0.0);\n          xTexelC${2*e}Ready = 0;\n          xTexelC${2*e+1} = vec4(0.0);\n          xTexelC${2*e+1}Ready = 0;\n          xC${e} = vec4(0.0);`;h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let e=0;e<(c+1)/2;e++){let t=2*e;if(h+=`\n          xC = xCCorner + ${t*l};\n          `,1===o){if(t<d&&(s%2==1?(h+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,h+=1===l&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):h+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<d)){let e=s%2==0?Sa.nearestLargerEven(l):l;l%2==0&&s%2==1||l%2!=0&&s%2!=1?(h+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,h+=l>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${t+1} = vec4(previous.zw, xTexelC${t+1}.xy);\n                    } else {\n                     xC${t+1} = vec4(0.0, 0.0, xTexelC${t+1}.xy);\n                    }\n                    `:`\n                    xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                    `):h+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<d&&(s%2==1?(h+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<d&&(h+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(h+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<d&&(h+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<d&&(h+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<d&&(h+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}h+="\n    }\n  ",h+="\n      }\n    ";let p="",m="";n&&(p=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,m="result = activation(result);");let f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${i};\n        int q = d2 - d1 * ${i};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${h}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${f}\n        ${m}\n        setOutput(result);\n      }\n    `}},sN={kernelName:Ot,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:u}=r,d=l;null==d&&(d=[1,1]),Sa.assert($m.eitherStridesOrDilationsAreOne(s,d),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${d}'`));let c,h=$m.computeConv2DInfo(a.shape,i.shape,s,d,o,u,!0);c=Ue().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?new iN(h):new aN(h);let p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(c,[a,i],"float32",p)}},oN={kernelName:$t,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,filterShape:d}=r,c=$m.computeConv2DInfo(a.shape,d,s,o,l,u,!0),h=new class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${i} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${a};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(c);return n.runWebGLProgram(h,[a,i],"float32")}},lN={kernelName:Ft,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,inputShape:d}=r,c=$m.computeConv2DInfo(d,i.shape,s,o,l,u,!0),h=new class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${i}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${o}; dm++) {\n              int d2 = d1 * ${o} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(c);return n.runWebGLProgram(h,[a,i],"float32")}},uN={kernelName:Lt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],i=Sa.sizeFromShape(r.shape),s=uC({inputs:{x:r},backend:n,attrs:{shape:[i]}}),o=new class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}(i),l=n.runWebGLProgram(o,[s],s.dtype),u=uC({inputs:{x:l},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),u}},dN={kernelName:zt,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i,filter:s}=n,{strides:o,pad:l,dilations:u}=a,d=$m.computeDilation2DInfo(i.shape,s.shape,o,l,"NHWC",u),c=new class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:i,filterHeight:s,filterWidth:o,dilationHeight:l,dilationWidth:u}=e,{top:d,left:c}=r;this.userCode=`\n      const ivec2 strides = ivec2(${a}, ${i});\n      const ivec2 pads = ivec2(${d}, ${c});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${s}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${o}; w++) {\n              int wIn = wBeg + w * ${u};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}(d);t=r.runWebGLProgram(c,[i,s],"float32");let h=uC({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),h}},cN={kernelName:jt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=$m.decodeEinsumEquation(a,i.length);$m.checkEinsumDimSizes(s.length,l,i);let{path:u,steps:d}=$m.getEinsumComputePath(o,l),c=d.length,h=null,p=s.length,m=[];for(let e=0;e<c;++e){for(let t of d[e]){let e,{permutationIndices:r,expandDims:a}=$m.getEinsumPermutation(p,l[t]);$m.isIdentityPermutation(r)?e=i[t]:(e=xC({inputs:{x:i[t]},backend:n,attrs:{perm:r}}),m.push(e));let s=e.shape.slice();for(let e=0;e<a.length;++e)s.splice(a[e],0,1);Sa.arraysEqual(e.shape,s)||(e=uC({inputs:{x:e},backend:n,attrs:{shape:s}}),m.push(e)),null===h?h=e:(h=oC({inputs:{a:e,b:h},backend:n}),m.push(h))}e<c-1&&(u[e]>=0&&(h=yC({inputs:{x:h},backend:n,attrs:{axis:u[e]-(s.length-p),keepDims:!1}}),m.push(h)),p--)}for(let e of m)e!==h&&n.disposeIntermediateTensorInfo(e);return h}},hN=eC({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),pN={kernelName:Ht,backendName:"webgl",kernelFunc:hN},mN={kernelName:Gt,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=Ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new WI("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new BI("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},fN=tC({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:k_}),gN={kernelName:Xt,backendName:"webgl",kernelFunc:fN},yN=eC({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${$m.ERF_P};\n  float a1 = ${$m.ERF_A1};\n  float a2 = ${$m.ERF_A2};\n  float a3 = ${$m.ERF_A3};\n  float a4 = ${$m.ERF_A4};\n  float a5 = ${$m.ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),bN={kernelName:qt,backendName:"webgl",kernelFunc:yN},xN=eC({opSnippet:QI+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:S_,dtype:"float32"}),AN={kernelName:Kt,backendName:"webgl",kernelFunc:xN};function vN(e){let{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:i}=t,s=i.shape.length,o=i.shape.slice(),l=a;return a<0&&(Sa.assert(-(s+1)<=a,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),l=s+a+1),o.splice(l,0,1),uC({inputs:{x:i},backend:r,attrs:{shape:o}})}var wN={kernelName:Zt,backendName:"webgl",kernelFunc:vN},kN="return exp(x) - 1.0;",SN=eC({opSnippet:kN,packedOpSnippet:kN,cpuKernelImpl:T_}),TN={kernelName:Yt,backendName:"webgl",kernelFunc:SN},_N=class{constructor(e,t,n){this.variableNames=["real","imag"];let r=t[1];this.outputShape=t;let a,i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0";if("real"===e)a="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}};function IN(e,t,n){let r=n.texData.get(e.dataId),a=Sa.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],s=uC({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),o=s.shape,l=new _N("real",o,t),u=new _N("imag",o,t),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],c=n.runWebGLProgram(l,d,"float32"),h=n.runWebGLProgram(u,d,"float32"),p=HI({inputs:{real:c,imag:h},backend:n});n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h);let m=uC({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(p),m}var CN={kernelName:Jt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t;return IN(r,!1,n)}},EN=class{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}};function NN(e){let{backend:t,attrs:n}=e,{shape:r,value:a}=n,{dtype:i}=n;if(i=i||Sa.inferDtype(a),"string"===i){let e=Sa.getArrayFromDType(i,Sa.sizeFromShape(r));return e.fill(a),t.makeTensorInfo(r,i,e)}{let e=new EN(r,a),n=[[a]];return t.runWebGLProgram(e,[],i,n)}}var RN,PN={kernelName:Qt,backendName:"webgl",kernelFunc:NN},DN={kernelName:en,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{let{image:n}=e,r=t,a=new class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},MN="return floor(x);",ON=eC({opSnippet:MN,packedOpSnippet:MN,cpuKernelImpl:__}),$N={kernelName:tn,backendName:"webgl",kernelFunc:ON},FN=tC({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),LN={kernelName:nn,backendName:"webgl",kernelFunc:FN},zN={kernelName:sa,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{pixels:a}=t,{numChannels:i}=r,s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,[l,u]=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],d=[u,l],c=[u,l,i];if(o||s){let e=Ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==RN||e!==BN)&&(BN=e,RN=document.createElement("canvas").getContext("2d",{willReadFrequently:BN})),RN.canvas.width=l,RN.canvas.height=u,RN.drawImage(a,0,0,l,u),a=RN.canvas}let h=n.makeTensorInfo(d,"int32");n.texData.get(h.dataId).usage=pS.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),a);let p=Ue().getBool("WEBGL_PACK")?new class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let t=wT(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}(c):new class{constructor(e){this.variableNames=["A"];let t=wT(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}(c),m=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),m}},BN=Ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU"),UN={kernelName:ua,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i,filter:s,bias:o,preluActivationWeights:l}=n,{strides:u,pad:d,dataFormat:c,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=a,g=$m.convertConv2DDataFormat(c),y=$m.computeConv2DInfo(i.shape,s.shape,u,h,d,p,!1,g),b=[],x=null!=o,A=null!=l,v="leakyrelu"===m,w=()=>{let e=[i,s],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){let t=uC({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(x&&e.push(t(o,c)),A&&e.push(t(l,c)),v){let t=r.makeTensorInfo([],"float32",Sa.createScalarValue(f,"float32"));e.push(t),b.push(t)}return e};if(1!==y.filterHeight||1!==y.filterWidth||1!==y.dilationHeight||1!==y.dilationWidth||1!==y.strideHeight||1!==y.strideWidth||"SAME"!==y.padInfo.type&&"VALID"!==y.padInfo.type)if(y.strideWidth<=2&&"channelsLast"===g&&Ue().getBool("WEBGL_EXP_CONV")){let e=m?nC(m,!0):null,n=new ME(y,x,e,A,v),a=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],i=w();t=r.runWebGLProgram(n,i,"float32",a)}else if(Ue().getBool("WEBGL_CONV_IM2COL"))t=FE({x:i,filter:s,convInfo:y,backend:r,bias:o,activation:m,preluActivationWeights:l,leakyreluAlpha:f});else{let e=m?nC(m,!1):null,n=new DE(y,x,e,A,v),a=w();t=r.runWebGLProgram(n,a,"float32")}else t=$E({x:i,filter:s,convInfo:y,backend:r,bias:o,activation:m,preluActivationWeights:l,leakyreluAlpha:f});let k=uC({inputs:{x:t},backend:r,attrs:{shape:y.outShape}});return b.push(t),b.forEach((e=>r.disposeIntermediateTensorInfo(e))),k}},WN={kernelName:da,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dilations:d,dimRoundingMode:c,activation:h,leakyreluAlpha:p}=r,m=[],f=d;null==f&&(f=[1,1]),Sa.assert($m.eitherStridesOrDilationsAreOne(l,f),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`));let g,y=$m.computeConv2DInfo(a.shape,i.shape,l,f,u,c,!0),b=Ue().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,x=h?nC(h,b):null,A=[a,i],v=null!=s,w=null!=o,k="leakyrelu"===h;if(v&&A.push(s),w&&A.push(o),k){let e=n.makeTensorInfo([],"float32",Sa.createScalarValue(p,"float32"));A.push(e),m.push(e)}g=b?new iN(y,v,x,w,k):new aN(y,v,x,w,k);let S=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],T=n.runWebGLProgram(g,A,"float32",S);return m.forEach((e=>n.disposeIntermediateTensorInfo(e))),T}},VN={kernelName:sn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=a.shape,s=i[i.length-1],o=Sa.sizeFromShape(r.shape),[l,u,d,c]=$m.prepareAndValidate(r,a),h=uC({inputs:{x:a},backend:n,attrs:{shape:[u,s]}}),p=uC({inputs:{x:r},backend:n,attrs:{shape:[Sa.sizeFromShape(r.shape)/d,d]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){let e=n.readSync(a.dataId),t=n.bufferSync(r),i=I_(e,t,r.dtype,u,s,d,c,r.shape,o);return n.makeTensorInfo(l,r.dtype,i.values)}let m=new class{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;let a=FT(n.length),i="\n    int index;";for(let e=0;e<this.sliceDim;e++)i+=`\n          index = round(getIndices(coords[0], ${e}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[e]};\n          flattenIndex += index * ${this.strides[e]};`;this.userCode=`\n         void main() {\n          ${a} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${i}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}(s,c,[u,d],r.shape),f=n.runWebGLProgram(m,[p,h],p.dtype),g=uC({inputs:{x:f},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}};function jN(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r,l=Sa.parseAxisParam(s,a.shape)[0];if(Ue().get("DEBUG")){let e=n.readSync(i.dataId),t=a.shape[l];for(let n=0;n<e.length;++n){let r=e[n];Sa.assert(r<=t-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${t-1}]`))}}let u=$m.segment_util.collectGatherOpShapeInfo(a,i,l,o),d=Sa.sizeFromShape(i.shape),c=[],h=uC({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=uC({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,d/u.batchSize]}});c.push(h),c.push(p);let m=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){let e=n.bufferSync(p),t=n.bufferSync(h),r=C_(t,e,m);return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(u.outputShape,r.dtype,r.values)}let f=new class{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;let n=FT(this.rank),r=function(e,t){let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let t=0;t<e.length;t++)2===t?r.push("index"):r.push(`${n[t]}`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}(h.shape,m),g=n.runWebGLProgram(f,[h,p],h.dtype);c.push(g);let y=uC({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}var HN={kernelName:an,backendName:"webgl",kernelFunc:jN},GN=tC({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:E_,dtype:"bool"}),qN={kernelName:on,backendName:"webgl",kernelFunc:GN},XN=tC({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:N_}),KN={kernelName:ln,backendName:"webgl",kernelFunc:XN},ZN={kernelName:dn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t;return IN(r,!0,n)}},YN=eC({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),JN={kernelName:hn,backendName:"webgl",kernelFunc:YN},QN=eC({opSnippet:"return float(isinf(x));",dtype:"bool"}),eR={kernelName:pn,backendName:"webgl",kernelFunc:QN},tR=eC({opSnippet:"return float(isnan(x));",dtype:"bool"}),nR={kernelName:mn,backendName:"webgl",kernelFunc:tR},rR=tC({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:R_,dtype:"bool"}),aR={kernelName:gn,backendName:"webgl",kernelFunc:rR},iR=tC({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:P_,dtype:"bool"}),sR={kernelName:yn,backendName:"webgl",kernelFunc:iR},oR={kernelName:bn,backendName:"webgl",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=D_(r,a,i);return t.makeTensorInfo([s.length],"float32",s)}},lR=eC({opSnippet:QI+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:M_}),uR={kernelName:xn,backendName:"webgl",kernelFunc:lR},dR=eC({opSnippet:QI+"\n  return log(1.0 + x);\n"}),cR={kernelName:An,backendName:"webgl",kernelFunc:dR},hR=tC({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),pR={kernelName:vn,backendName:"webgl",kernelFunc:hR},mR=eC({opSnippet:"return float(!(x >= 1.0));"}),fR={kernelName:wn,backendName:"webgl",kernelFunc:mR},gR=tC({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),yR={kernelName:kn,backendName:"webgl",kernelFunc:gR},bR={kernelName:In,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r,u=Ue().getBool("WEBGL_PACK_NORMALIZATION")?new class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let i=t,s=e[3]-1;this.outputShape=e;let o,l=`float(${n}) + float(${r}) * sum`;o=.5===a?`inversesqrt(${l})`:1===a?`1.0/(${l})`:`exp(log(${l}) * float(-${a}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${i};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${i}; j <= ${i}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${s}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${o};\n        setOutput(result);\n      }\n    `}}(a.shape,i,s,o,l):new class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];let i=t,s=e[3]-1;this.outputShape=e;let o,l=`float(${n}) + float(${r}) * sum`;o=.5===a?`inversesqrt(${l})`:1===a?`1.0/(${l})`:`exp(log(${l}) * float(-${a}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${i}; j <= ${i}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${s}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${o};\n        setOutput(val);\n      }\n    `}}(a.shape,i,s,o,l);return n.runWebGLProgram(u,[a],a.dtype)}},xR={kernelName:Cn,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:u,beta:d}=r,c=new class{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${a})\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${a});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}(a.shape,o,l,u,d);return n.runWebGLProgram(c,[a,i,s],a.dtype)}};function AR(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r,o=a.shape.length,l=Sa.parseAxisParam(i,a.shape),u=l,d=$m.getAxesPermutation(u,o),c=null!=d,h=n.shouldExecuteOnCPU([a]),p=a;if(c){if(h){let e=n.texData.get(p.dataId).values,t=new Array(o);for(let e=0;e<t.length;e++)t[e]=a.shape[d[e]];let r=uI(e,a.shape,a.dtype,d,t);p=n.makeTensorInfo(t,a.dtype),n.texData.get(p.dataId).values=r}else p=gC(a,d,n);u=$m.getInnerMostAxes(u.length,o)}$m.assertAxesAreInnerMostDims("max",u,o);let m,[f,g]=$m.computeOutAndReduceShapes(p.shape,u),y=f;if(s&&(y=$m.expandShapeToKeepDim(f,l)),h){let e=n.texData.get(p.dataId).values,t=O_(e,Sa.sizeFromShape(g),y,a.dtype);m=n.makeTensorInfo(y,a.dtype),n.texData.get(m.dataId).values=t}else m=function(e,t,n,r){let a=Sa.sizeFromShape(t),i=uC({inputs:{x:e},attrs:{shape:[Sa.sizeFromShape(e.shape)/a,a]},backend:r}),s=pC(i,e.dtype,"max",r),o=uC({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}(p,g,y,n);return c&&n.disposeIntermediateTensorInfo(p),m}var vR={kernelName:Nn,backendName:"webgl",kernelFunc:AR},wR=tC({opSnippet:zI+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+UI+"\n  return result;\n",cpuKernelImpl:$_}),kR={kernelName:Rn,backendName:"webgl",kernelFunc:wR},SR={kernelName:Pn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;AT(a,"maxPool");let{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;Sa.assert($m.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));let u=$m.computePool2DInfo(a.shape,i,s,1,o,l);if(1===u.filterWidth&&1===u.filterHeight&&Sa.arraysEqual(u.inShape,u.outShape))return VI({inputs:{x:a},backend:n});let d=new QC(u,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},TR={kernelName:Mn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dataFormat:l,dimRoundingMode:u}=r,d=$m.computePool3DInfo(a.shape,i,s,[1,1,1],o,u,l),c=new eE(d,"max",!1);return n.runWebGLProgram(c,[a],a.dtype)}},_R={kernelName:On,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:u,dimRoundingMode:d}=r,c=$m.computePool3DInfo(s.shape,o,l,[1,1,1],u,d),h=new eE(c,"max",!0),p=n.runWebGLProgram(h,[s],s.dtype),m=new class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=o-1-e.padInfo.front,c=l-1-e.padInfo.top,h=u-1-e.padInfo.left,p=o*l*u-1;this.userCode=`\n      const ivec3 pads = ivec3(${d}, ${c}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${o};\n           wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${t}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${i}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${u};\n                wC += ${s}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${u} +\n                  wR * ${u} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(c),f=n.runWebGLProgram(m,[a,p],s.dtype);return n.disposeIntermediateTensorInfo(p),f}},IR={kernelName:Dn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;AT([i,s],"maxPoolGrad");let{filterSize:l,strides:u,pad:d,dimRoundingMode:c}=r,h=$m.computePool2DInfo(o.shape,l,u,1,d,c),p=new QC(h,"max",!0),m=n.runWebGLProgram(p,[o],o.dtype),f=new class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,s=a-1-e.padInfo.top,o=i-1-e.padInfo.left,l=a*i-1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${t}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${i}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${i} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}(h),g=n.runWebGLProgram(f,[a,m],o.dtype);return n.disposeIntermediateTensorInfo(m),g}},CR={kernelName:$n,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:i,pad:s,includeBatchInIndex:o}=t,l=n;Sa.assert(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));let u=[1,1];Sa.assert($m.eitherStridesOrDilationsAreOne(i,u),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`));let d=$m.computePool2DInfo(r.shape,a,i,u,s),[c,h]=function(e,t,n,r){let a=new QC(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new QC(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(r,o,d,l);return[c,h]}},ER={kernelName:Fn,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{keepDims:a,axis:i}=t,s=n,o=r.shape.length,l=Sa.parseAxisParam(i,r.shape),u=l,d=$m.getAxesPermutation(u,o),c=null!=d,h=s.shouldExecuteOnCPU([r]),p=[],m=r;if(c){if(h){let e=s.texData.get(m.dataId).values,t=new Array(o);for(let e=0;e<t.length;e++)t[e]=r.shape[d[e]];let n=uI(e,r.shape,r.dtype,d,t);m=s.makeTensorInfo(t,r.dtype),s.texData.get(m.dataId).values=n}else m=gC(r,d,s);p.push(m),u=$m.getInnerMostAxes(u.length,o)}$m.assertAxesAreInnerMostDims("sum",u,o);let[f,g]=$m.computeOutAndReduceShapes(m.shape,u),y=f;a&&(y=$m.expandShapeToKeepDim(f,l));let b=function(e,t,n,r){let a=Sa.sizeFromShape(t),i=uC({inputs:{x:e},attrs:{shape:[Sa.sizeFromShape(e.shape)/a,a]},backend:r}),s=pC(i,"float32","mean",r),o=uC({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}(m,g,y,s);for(let e of p)s.disposeIntermediateTensorInfo(e);return b}},NR={kernelName:Ln,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=Sa.parseAxisParam(i,a.shape),u=l,d=$m.getAxesPermutation(u,o),c=a;null!=d&&(c=xC({inputs:{x:a},backend:n,attrs:{perm:d}}),u=$m.getInnerMostAxes(u.length,a.shape.length)),$m.assertAxesAreInnerMostDims("min",u,o);let h,[p,m]=$m.computeOutAndReduceShapes(c.shape,u),f=uC({inputs:{x:c},backend:n,attrs:{shape:[-1,Sa.sizeFromShape(m)]}}),g=pC(f,f.dtype,"min",n);return h=uC(s?{inputs:{x:g},backend:n,attrs:{shape:$m.expandShapeToKeepDim(p,l)}}:{inputs:{x:g},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(c),h}},RR=tC({opSnippet:zI+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+UI+"\n  return result;\n",cpuKernelImpl:F_}),PR={kernelName:zn,backendName:"webgl",kernelFunc:RR},DR={kernelName:Bn,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{paddings:a,mode:i}=n,s=Ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));let r=e.length,a=FT(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=hI("rc",r),l=hI("source",r),u=`${o[r-1]} < ${this.outputShape[r-1]}`,d=1===r?"source":`vec2(${l.slice(-2).join()})`,c="reflect"===n?0:1,h="";if(1===r){let e=`\n        ${a} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${c};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${c};\n        }\n        source -= start;\n      `;h=`\n        ${a} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${d});\n        ${o[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${d});\n        }\n      `}else{let e=`\n        ${a} source = rc;\n        ${a} lt = ${a}(lessThan(source, start));\n        ${a} gte = ${a}(greaterThanEqual(source, end));\n        ${a} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${c}) +\n                gte * ((end - 1) * 2 - source + ${c});\n        source -= start;\n      `;h=`\n        ${a} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${d});\n        ${o[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${d});\n        }\n        rc = outputLoc;\n        ${o[r-2]} += 1;\n        if(${o[r-2]} < ${this.outputShape[r-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${l.join()}), ${d});\n          ${o[r-1]} += 1;\n          if(${u}) {\n            ${e}\n            result[3] = getChannel(getX(${l.join()}), ${d});\n          }\n        }\n      `}this.userCode=`\n      const ${a} start = ${a}(${i});\n      const ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}(r.shape,a,i):new class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));let r=e.length,a=FT(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${a} start = ${a}(${i});\n      ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${a} coords = outC - start;\n        setOutput(getX(${o}));\n      }\n    `:`\n        int start = ${i};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}(r.shape,a,i);return t.runWebGLProgram(s,[r],r.dtype)}},MR=tC({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+UI+"\n  return result;\n"}),OR={kernelName:Un,backendName:"webgl",kernelFunc:MR},$R=tC({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),FR={kernelName:Vt,backendName:"webgl",kernelFunc:$R},LR="return a - b;",zR=tC({opSnippet:LR,packedOpSnippet:LR,supportsComplex:!0,cpuKernelImpl:sI}),BR={kernelName:qr,backendName:"webgl",kernelFunc:zR};function UR(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=Sa.parseAxisParam([i],a.shape),o=AR({inputs:{x:a},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),l=$m.expandShapeToKeepDim(o.shape,s),u=uC({inputs:{x:o},backend:n,attrs:{shape:l}}),d=zR({inputs:{a,b:u},backend:n}),c=xN({inputs:{x:d},backend:n}),h=yC({inputs:{x:c},backend:n,attrs:{axis:s,keepDims:!1}}),p=uC({inputs:{x:h},backend:n,attrs:{shape:l}}),m=$R({inputs:{a:c,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),m}var WR={kernelName:Mr,backendName:"webgl",kernelFunc:UR},VR={kernelName:Wn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r,l=o?a:UR({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),u=l.shape[0],d=l.shape[1],c=new class{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}}(u,d,i),h=[[s]],p=n.runWebGLProgram(c,[l],"int32",h);return o||n.disposeIntermediateTensorInfo(l),p}},jR=bI+"\n  return -x;\n",HR={kernelName:jn,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r}=e,{x:a}=n;if(r.shouldExecuteOnCPU([a])){let e=r.texData.get(a.dataId),[t,n]=z_(e.values,a.shape,a.dtype);return r.makeTensorInfo(n,a.dtype,t)}return t=Ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new RI(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new yI(a.shape,jR),r.runWebGLProgram(t,[a],a.dtype)}},GR=Hf.nonMaxSuppressionV3Impl,qR={kernelName:Gn,backendName:"webgl",kernelFunc:function(e){$m.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r,u=n.readSync(a.dataId),d=n.readSync(i.dataId),{selectedIndices:c}=GR(u,d,s,o,l);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}},XR=Hf.nonMaxSuppressionV4Impl,KR={kernelName:qn,backendName:"webgl",kernelFunc:function(e){$m.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:u}=r,d=n.readSync(a.dataId),c=n.readSync(i.dataId),{selectedIndices:h,validOutputs:p}=XR(d,c,s,o,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},ZR=Hf.nonMaxSuppressionV5Impl,YR={kernelName:Xn,backendName:"webgl",kernelFunc:function(e){$m.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r,d=n.readSync(a.dataId),c=n.readSync(i.dataId),h=s,p=o,m=l,f=u,{selectedIndices:g,selectedScores:y}=ZR(d,c,h,p,m,f);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}},JR={kernelName:Zn,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r,u=Sa.sizeFromShape(a.shape),d=new class{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}(u,s,o,l),c=uC({inputs:{x:a},backend:n,attrs:{shape:[u]}}),h=n.runWebGLProgram(d,[c],i);n.disposeIntermediateTensorInfo(c);let p=uC({inputs:{x:h},backend:n,attrs:{shape:[...a.shape,s]}});return n.disposeIntermediateTensorInfo(h),p}};function QR(e){let{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){let e=gE({inputs:{input:r},backend:n}),t=QR({inputs:{x:e},backend:n}),a=CE({inputs:{input:r},backend:n}),i=QR({inputs:{x:a},backend:n}),s=HI({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return NN({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var eP={kernelName:aa,backendName:"webgl",kernelFunc:QR},tP={kernelName:Kn,backendName:"webgl",kernelFunc:function e(t){let{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){let t=gE({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=CE({inputs:{input:a},backend:r}),s=QR({inputs:{x:i},backend:r}),o=HI({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}return NN({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},nP={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return vN({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let i=t[0].shape,s=t[0].dtype;t.forEach((e=>{Sa.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),Sa.assert(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));let o=[],l=RE({inputs:t.map((e=>{let t=vN({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t})),backend:n,attrs:{axis:a}});return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}},rP=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;if(0===Sa.sizeFromShape(a.shape))return NN({backend:n,attrs:{shape:i.map(((e,t)=>e[0]+a.shape[t]+e[1])),value:s,dtype:a.dtype}});let o=Ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));let r=e.length,a=FT(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=hI("rc",r),l=hI("source",r),u=`${o[r-1]} < ${this.outputShape[r-1]}`,d=1===r?"source":`vec2(${l.slice(-2).join()})`,c=[`${a} rc = outputLoc;`,`${o[r-1]} += 1;\n       if(${u}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${o[r-2]} += 1;\n       if(${o[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${o[r-1]} += 1;\n         if(${u}) {`],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="";for(let e=0,t=1===r?2:4;e<t;e++)p+=`\n        ${c[e]}\n        if (${h}) {\n          result[${e}] = float(value);\n        } else {\n          ${a} source = rc - start;\n          result[${e}] = getChannel(getX(${l.join()}), ${d});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${a} start = ${a}(${i});\n      const ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}(a.shape,i,s):new class{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));let r=e.length,a=FT(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${a} start = ${a}(${i});\n      ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${a} coords = outC - start;\n          setOutput(getX(${o}));\n        }\n      }\n    `:`\n        int start = ${i};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}(a.shape,i,s),l=[[s]];return n.runWebGLProgram(o,[a],a.dtype,l)},aP={kernelName:Jn,backendName:"webgl",kernelFunc:rP},iP=tC({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+UI+"\n  return result;\n"}),sP={kernelName:er,backendName:"webgl",kernelFunc:iP},oP={kernelName:nr,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{axis:s,keepDims:o}=a,l=i.shape.length,u=[],d=Sa.parseAxisParam(s,i.shape),c=d,h=$m.getAxesPermutation(c,l),p=i;if(null!=h&&(p=xC({inputs:{x:i},backend:r,attrs:{perm:h}}),c=$m.getInnerMostAxes(c.length,l),u.push(p)),$m.assertAxesAreInnerMostDims("prod",c,l),r.shouldExecuteOnCPU([p])){let e=r.texData.get(p.dataId).values,{outVals:n,outShape:a,outDtype:i}=U_(p.shape,p.dtype,e,c);t=r.makeTensorInfo(a,i,n)}else{let[e,n]=$m.computeOutAndReduceShapes(p.shape,c),a=Sa.sizeFromShape(n),s=uC({inputs:{x:p},backend:r,attrs:{shape:[-1,a]}}),o=pC(s,yi(i.dtype),"prod",r);t=uC({inputs:{x:o},backend:r,attrs:{shape:e}}),u.push(s),u.push(o)}if(o){u.push(t);let e=$m.expandShapeToKeepDim(t.shape,d);t=uC({inputs:{x:t},backend:r,attrs:{shape:e}})}return u.forEach((e=>r.disposeIntermediateTensorInfo(e))),t}},lP={kernelName:rr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:o}=r,l=a.map((e=>n.readSync(e.dataId))),u=a.map((e=>e.shape)),d=n.readSync(i.dataId),c=n.readSync(s.dataId),[h,p,m]=W_(l,u,d,i.shape,i.dtype,c,s.shape,o),f=h.map((e=>n.makeTensorInfo([e.length],"int32",e))),g=n.makeTensorInfo(m,i.dtype,p);return f.concat([g])}},uP={kernelName:ar,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[u,d]=V_(s,r.shape,r.dtype,o,a.shape,l,i.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([d.length],r.dtype,d)]}},dP={kernelName:ir,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,u=n.readSync(a.dataId),d=n.readSync(i.dataId),c=n.readSync(s.dataId),h=o.map((e=>n.readSync(e.dataId))),p=o.map((e=>e.shape)),[m,f]=j_(u,a.shape,d,i.shape,i.dtype,c,s.shape,h,p,l);return n.makeTensorInfo(m,i.dtype,f)}},cP=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:s}=n,o=H_(r,a,i,s);return t.makeTensorInfo([o.length],s,o)},hP={kernelName:sr,backendName:"webgl",kernelFunc:cP},pP=eC({opSnippet:"return 1.0 / x;"}),mP={kernelName:lr,backendName:"webgl",kernelFunc:pP},fP=eC({opSnippet:bI+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),gP={kernelName:ur,backendName:"webgl",kernelFunc:fP},yP=eC({opSnippet:bI+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),bP={kernelName:fr,backendName:"webgl",kernelFunc:yP},xP={kernelName:pr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,u]=o,d=Ue().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,s,o,l]=e;this.outputShape=[i,t,n,l];let u,d=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];u=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${d[0]/c[0]},\n          ${d[1]/c[1]},\n          ${d[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${u};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}(a.shape,l,u,i,s):new class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[i,s,o,l]=e;this.outputShape=[i,t,n,l];let u,d=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];u=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${d[0]/c[0]},\n          ${d[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${u};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}(a.shape,l,u,i,s);return n.runWebGLProgram(d,[a],"float32")}},AP={kernelName:mr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,o=new class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,i,s]=e,o=[n&&i>1?r-1:r,n&&s>1?a-1:a],l=[n&&i>1?i-1:i,n&&s>1?s-1:s],u=o[0]/l[0],d=o[1]/l[1],c=1/u,h=1/d,p=2*Math.ceil(c)+2,m=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${d});\n\n        const float invHeightScale = float(${c});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${m});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${i}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${s}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}(i.shape,a.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}},vP={kernelName:cr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,u]=o,d=Ue().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,s,o,l]=e;this.outputShape=[i,t,n,l];let u,d=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";u=a?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${d[0]/c[0]},\n          ${d[1]/c[1]},\n          ${d[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${u};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}(a.shape,l,u,i,s):new class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[i,s,o,l]=e;this.outputShape=[i,t,n,l];let u,d=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";u=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${d[0]/c[0]},\n          ${d[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${u};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}(a.shape,l,u,i,s);return n.runWebGLProgram(d,[a],a.dtype)}},wP={kernelName:hr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,o=new class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,i,s]=e,o=[n&&i>1?r-1:r,n&&s>1?a-1:a],l=[n&&i>1?i-1:i,n&&s>1?s-1:s],u=o[0]/l[0],d=o[1]/l[1],c=1/u,h=1/d,p=2*Math.ceil(c)+2,m=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${d});\n\n        const float invHeightScale = float(${c});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${m});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${i}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${s}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${o[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${o[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${a}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}(i.shape,a.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}},kP={kernelName:gr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,s=a.shape.length,o=Sa.parseAxisParam(i,a.shape);if(0===s)return VI({inputs:{x:a},backend:n});let l=Ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new class{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let r=hI("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,i=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,s=FT(n);var o;function l(n){let r=e.map(((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:`${r[n]}`}(a,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${a}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${s} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${o=r.slice(),l(o)};\n          if(${a}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",l(e)}(r.slice())};\n          }\n          if(${i}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",l(e)}(r.slice())};\n            if(${a}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",l(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}(a.shape,o):new class{constructor(e,t){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);let r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),a=FT(n);this.userCode=`\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}(a.shape,o);return n.runWebGLProgram(l,[a],a.dtype)}},SP={kernelName:oa,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:i,center:s}=t,o=n,l=new class{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],r=e[2];this.outputShape=e;let a="";a="number"==typeof t?`float outputValue = ${t.toFixed(2)};`:`\n        vec3 fill = vec3(${t.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${a}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}(r.shape,i),[u,d]=$m.getImageCenter(s,r.shape[1],r.shape[2]),c=[[u,d,Math.sin(a),Math.cos(a)]];return o.runWebGLProgram(l,[r],r.dtype,c)}},TP=eC({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),_P={kernelName:yr,backendName:"webgl",kernelFunc:TP},IP=eC({opSnippet:"return inversesqrt(x);",cpuKernelImpl:G_}),CP={kernelName:br,backendName:"webgl",kernelFunc:IP},EP=class{constructor(e,t,n,r,a,i,s=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;let l=FT(a.length),u=FT(i.length),d="";1===n?d="i":2===n&&(d="i, j");let c=`getIndices(${d})`,h="";1===r?h="i":2===r&&(h="i, coords[1]");let p=`getUpdates(${h})`,m="";o&&(m="coords[0], coords[1]");let f=`getDefaultValue(${m})`,g=t>1?"strides[j]":"strides";this.userCode=`\n        ${l} strides = ${l}(${a});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(${c});\n              flattenedIndex += index * ${g};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${p};\n              found = true;\n            }\n          }\n          setOutput(mix(${f}, sum, float(found)));\n        }\n      `}},NP={kernelName:xr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:d,outputSize:c}=$m.calculateShapes(i,a,s),h=[c/u,u];if(0===c)return n.makeTensorInfo(s,a.dtype);let p,m=uC({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),f=uC({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));p=Ue().getBool("WEBGL_PACK")?new class{constructor(e,t,n,r,a,i,s=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;let l=FT(a.length),u=FT(i.length),d="";1===n?d="i":2===n&&(d="i, j");let c=`getIndices(${d})`,h="";1===r?h="i":2===r&&(h="i, coords[1]");let p=`getUpdates(${h})`,m="";o&&(m="coords[0], coords[1]");let f=`getDefaultValue(${m})`,g=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`\n        ${l} strides = ${l}(${a});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ${e}; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ${t}; j+=2) {\n              ivec4 index = round(${c});\n              flattenedIndex += index.xz * ${g};\n              if (j + 1 < ${t}) {\n                flattenedIndex += index.yw * ${y};\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ${p};\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(${f}, sum, found));\n        }\n      `}}(l,o,m.shape.length,f.shape.length,d,h):new EP(l,o,m.shape.length,f.shape.length,d,h);let y=n.runWebGLProgram(p,[f,m,g],f.dtype),b=uC({inputs:{x:y},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}},RP={kernelName:vr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=new class{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let a=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,i=2===Ue().getNumber("WEBGL_VERSION")?"while (left < right) {":a,s="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${i}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${s} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}(a.shape[0],a.shape[1],i.shape[1],s),l=[[a.shape[1]]];return n.runWebGLProgram(o,[a,i],"int32",l)}},PP={kernelName:wr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,s=new class{constructor(e,t,n){let r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)a="resRC",r="resRC";else{let n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[];for(let r=0;r<t.length;r++)s.push(`${n[r]}`),r<e&&i.push(`${n[r]}`);r=i.join(),a=s.join()}let i=FT(n);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${a}));\n        } else {\n          setOutput(getB(${a}));\n        }\n      }\n    `}}(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(s,[r,a,i],gi(a.dtype,i.dtype))}},DP=eC({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${$m.SELU_SCALEALPHA};\n  float scale = ${$m.SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),MP={kernelName:kr,backendName:"webgl",kernelFunc:DP},OP=eC({opSnippet:QI+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:X_}),$P={kernelName:Cr,backendName:"webgl",kernelFunc:OP},FP=eC({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),LP={kernelName:Ir,backendName:"webgl",kernelFunc:FP},zP=eC({opSnippet:QI+"\n  return sin(x);\n",packedOpSnippet:`\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ${UI}\n  return result;\n`}),BP={kernelName:Tr,backendName:"webgl",kernelFunc:zP},UP=eC({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),WP={kernelName:_r,backendName:"webgl",kernelFunc:UP},VP=eC({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),jP={kernelName:Er,backendName:"webgl",kernelFunc:VP},HP={kernelName:Pr,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;Sa.assert(a.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));let o=i.reduce(((e,t)=>e*t)),l=[[0,0]];l.push(...s);for(let e=1+i.length;e<a.shape.length;++e)l.push([0,0]);let u=[],d=rP({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),c=$m.getReshaped(d.shape,i,o,!1),h=$m.getPermuted(c.length,i.length,!1),p=$m.getReshapedPermuted(d.shape,i,o,!1),m=uC({inputs:{x:d},backend:n,attrs:{shape:c}}),f=xC({inputs:{x:m},backend:n,attrs:{perm:h}}),g=uC({inputs:{x:f},backend:n,attrs:{shape:p}});return u.push(d),u.push(m),u.push(f),u.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}},GP={kernelName:Or,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:s}=t;if(1!==i.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${i.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==a.shape.length)throw new Error(`Values must be a vector, saw:\n         ${a.shape}`);if(0!==s.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${s.shape}`);let o=n.readSync(r.dataId),l=n.readSync(a.dataId),u=n.readSync(i.dataId),d=n.readSync(s.dataId)[0],[c,h,p,m,f]=Y_(o,r.shape,r.dtype,l,a.dtype,u,d);return[n.makeTensorInfo(h,r.dtype,c),n.makeTensorInfo([h[0]],a.dtype,p),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map((e=>Number(e))))),n.makeTensorInfo([f.length],r.dtype,new Int32Array(f))]}},qP={kernelName:$r,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==a.shape.length)throw new Error(`Input shape should be a vector but received shape ${a.shape}`);if(1!==i.shape.length)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(n.readSync(a.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(i.dataId)),[u,d,c]=J_(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(d,r.dtype,u),n.makeTensorInfo([c.length],i.dtype,new Int32Array(c))]}},XP={kernelName:Fr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${i.shape}`);let s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[u,d]=Q_(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(d,r.dtype,u)}},KP={kernelName:Lr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${i.shape}`);let s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[u,d]=Q_(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(d,r.dtype,u)}},ZP={kernelName:zr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=$m.calculateShapes(i,a,o);if("string"===i.dtype){let e=n.bufferSync(a),t=n.bufferSync(i),r=Sa.decodeString(n.readSync(s.dataId)[0]),p=q_(e,t,o,h,d,u,l,c,r,!1);return n.makeTensorInfo(o,p.dtype,p.values)}let p=new EP(u,l,a.shape.length,i.shape.length,c,[h,1],!1),m=n.runWebGLProgram(p,[i,a,s],i.dtype),f=uC({inputs:{x:m},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),f}},YP={kernelName:Dr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=Sa.parseAxisParam(s,a.shape)[0],l=$m.prepareSplitSize(a,i,o),u=a.shape.length,d=new Array(u).fill(0),c=a.shape.slice();return l.map((e=>{let t=[...c];t[o]=e;let r=lE({inputs:{x:a},backend:n,attrs:{begin:d,size:t}});return d[o]+=e,r}))}},JP="return sqrt(x);",QP=eC({opSnippet:JP,packedOpSnippet:JP,cpuKernelImpl:eI}),eD={kernelName:Nr,backendName:"webgl",kernelFunc:QP},tD=eC({opSnippet:"return x * x;"}),nD={kernelName:Ur,backendName:"webgl",kernelFunc:tD},rD="return (a - b) * (a - b);",aD=tC({opSnippet:rD,packedOpSnippet:rD}),iD={kernelName:Br,backendName:"webgl",kernelFunc:aD},sD={kernelName:Wr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");let i=n.readSync(a.dataId),s=$m.fromUint8ToStringArray(i),o=tI(s,"string",r);return n.makeTensorInfo(a.shape,"string",o)}},oD={kernelName:ia,backendName:"webgl",kernelFunc:function({inputs:e,attrs:t,backend:n}){let{x:r}=e,a=bI+`\n    return x > 0.0 ? 1.0 : float(${t.alpha});\n  `,i=new yI(r.shape,a);return n.runWebGLProgram(i,[r],r.dtype)}},lD={kernelName:Vr,backendName:"webgl",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{begin:s,end:o,strides:l,beginMask:u,endMask:d,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=a,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:x,end:A,strides:v}=dm.sliceInfo(i.shape,s,o,l,u,d,c,h,p);if(g)t=uC({inputs:{x:i},backend:r,attrs:{shape:f}});else if(y||b){Sa.assert(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));let e=dm.computeOutShape(x,A,v),n=lE({inputs:{x:i},backend:r,attrs:{begin:x,size:e}});t=uC({inputs:{x:n},backend:r,attrs:{shape:f}}),r.disposeIntermediateTensorInfo(n)}else if(r.shouldExecuteOnCPU([i])){let e=r.readSync(i.dataId),n=Ws(i.shape,i.dtype,e),a=nI(m,n,v,x);t=r.makeTensorInfo(f,i.dtype,a.values)}else{let e=new class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;let r=n.length,a=FT(n.length),i=FT(n.length),s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map(((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${a} begin = ${a}(${e});\n      ${a} strides = ${a}(${t});\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${s}));\n      }\n    `}}(x,v,m);t=r.runWebGLProgram(e,[i],i.dtype)}let w=uC({inputs:{x:t},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(t),w}},uD={kernelName:jr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:d,dataSplits:c}=t,h=n.readSync(d.dataId),p=n.readSync(c.dataId),[m,f]=rI(h,p,a,i,s,o,l,u);return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(c.shape,"int32",f)]}},dD={kernelName:Hr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:s}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(0!==s.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);let o=n.readSync(i.dataId),l=n.readSync(s.dataId)[0],[u,d,c]=aI(o,l,a),h=d.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(c))]}},cD={kernelName:Gr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let s=n.readSync(i.dataId),o=iI(s,a);return n.makeTensorInfo(i.shape,"int32",o)}},hD=eC({opSnippet:"return tan(x);"}),pD={kernelName:Xr,backendName:"webgl",kernelFunc:hD},mD=eC({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),fD={kernelName:Kr,backendName:"webgl",kernelFunc:mD},gD={kernelName:Ar,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:i,updates:s}=t,{}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:d,outputSize:c}=$m.calculateShapes(s,i,a.shape),h=[c/u,u];if(0===c)return n.makeTensorInfo(a.shape,i.dtype);let p=uC({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),m=uC({inputs:{x:s},backend:n,attrs:{shape:[l,u]}}),f=uC({inputs:{x:a},backend:n,attrs:{shape:h}}),g=new EP(l,o,p.shape.length,m.shape.length,d,h,!1,!0),y=n.runWebGLProgram(g,[m,p,f],f.dtype),b=uC({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),b}};function yD(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;if("string"===a.dtype||a.shape.length>5){let e=n.readSync(a.dataId),t="string"===a.dtype?e.map((e=>Sa.decodeString(e))):e,r=Ws(a.shape,a.dtype,t),s=oI(r,i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}let s=new class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;let r=FT(this.rank),a=function(e){let t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let t=0;t<e.length;t++)r.push(`imod(${n[t]}, ${e[t]})`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${a}));\n      }\n    `}}(a.shape,i);return n.runWebGLProgram(s,[a],a.dtype)}var bD={kernelName:Zr,backendName:"webgl",kernelFunc:yD},xD=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}};function AD(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function vD(e){let t=1;for(;t<e;)t*=2;return t}var wD,kD,SD,TD={kernelName:Yr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r,o=Ue().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Ue().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=a.shape,d=u[u.length-1];if(n.shouldExecuteOnCPU([a])||d<o||i>l){let e=n.readSync(a.dataId),[t,r]=lI(e,u,a.dtype,i,s);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===i)return u[u.length-1]=0,[n.makeTensorInfo(u,a.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(1===d)return[a,NN({attrs:{shape:u,dtype:"int32",value:0},backend:n})];let c=n.texData.get(a.dataId),h=null!==c&&c.isPacked,p=h?n.unpackTensor(a):a,m=Sa.sizeFromShape(u)/d,f=uC({inputs:{x:p},attrs:{shape:[m,d]},backend:n});h&&AD(n,p);let g=vD(i),y=vD(d),b=null,x=()=>null===b?[f,f]:[f,b],A=(e,t,r)=>{let a=x(),i=new class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}(r),s=[[d],[null===b?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=b;b=n.runWebGLProgram(i,a,"int32",s),AD(n,o)};for(let e=1;e<g;e*=2){let t=2*e;for(let n=e;n>=1;n/=2)A(t,n,[m,y])}for(let e=y;e>g;e/=2){let t=x(),r=new xD([m,e/2]),a=[[d],[null===b?1:0],[g]],i=b;b=n.runWebGLProgram(r,t,"int32",a),AD(n,i);let s=g/2,o=2*s;for(let e=s;e>=1;e/=2)A(o,e,b.shape)}let v=b;b=lE({inputs:{x:b},backend:n,attrs:{begin:0,size:[m,i]}}),AD(n,v);let w=jN({inputs:{x:f,indices:b},backend:n,attrs:{axis:1,batchDims:1}});AD(n,f);let k=u.slice(0,-1);k.push(i),v=b,b=uC({inputs:{x:b},attrs:{shape:k},backend:n}),AD(n,v);let S=w;return w=uC({inputs:{x:w},attrs:{shape:k},backend:n}),AD(n,S),[w,b]}},_D={kernelName:Jr,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:i}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:u}=r,[d,c,h,p]=a.shape,[m,f]=null!=u?u:[c,h],g=[d,m,f,p],y=new class{constructor(e,t,n,r,a,i){this.variableNames=["Image","Transforms"],this.outputShape=i;let s,o="nearest"===n?1:2;switch(r){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${s} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${s} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${s} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${a});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${a});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${t}));\n                float mapY = mapCoord(inY, float(${e}));\n\n                if (${o} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}(c,h,s,o,l,g);return n.runWebGLProgram(y,[a,i],"float32")}},ID={kernelName:ea,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;AT(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:o,outputShape:l,indices:u}=dI(s,a,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,o),r.makeTensorInfo([u.length],"int32",u)]}},CD={kernelName:ta,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:i}=r;i<0&&(i+=a.shape.length);let s=a,o=s.shape.length,l=a.shape[i],u=new Array(o-1),d=0;for(let e=0;e<o;e++)e!==i&&(u[d++]=s.shape[e]);let c=[],h=new Array(o).fill(0),p=s.shape.slice();p[i]=1;let m=new Array(l);for(let e=0;e<m.length;e++){h[i]=e;let t=lE({inputs:{x:s},backend:n,attrs:{begin:h,size:p}}),r=uC({inputs:{x:t},backend:n,attrs:{shape:u}});m[e]=r,c.push(t)}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),m}},ED={kernelName:na,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r,o=a.shape.length,l=[],u=0,d=$m.getAxesPermutation([u],o),c=a;null!=d&&(c=xC({inputs:{x:a},backend:n,attrs:{perm:d}}),l.push(c),u=$m.getInnerMostAxes(1,o)[0]);let h=$m.segment_util.computeOutShape(c.shape,u,s),p=Sa.sizeFromShape([c.shape[u]]),m=uC({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}});l.push(m);let f=yi(a.dtype),g=(e,t,r,a,i)=>{let s=e.shape[0],o=e.shape[1],u=$m.segment_util.segOpComputeOptimalWindowSize(o,i),d={windowSize:u,inSize:o,batchSize:s,numSegments:i},c=new class{constructor(e,t){this.variableNames=["x","segmentIds"];let n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,s=i*Math.ceil(a/n);this.outputShape=[r,s];let o=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ",d="";a%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return initializationValue;\n        }\n      `);let c="";a%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${d}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${c}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${i})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${i})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}(d,t),h=n.compileAndRun(c,[e,r],a);if(l.push(h),h.shape[1]===i)return h;let p=cP({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),m=yD({inputs:{x:p},backend:n,attrs:{reps:[o/u]}});return l.push(p),l.push(m),g(h,t,m,a,i)},y=uC({inputs:{x:g(m,"unsortedSegmentSum",i,f,s)},backend:n,attrs:{shape:h}}),b=y;if(null!=d){l.push(y);let e=$m.getUndoAxesPermutation(d);b=xC({inputs:{x:b},backend:n,attrs:{perm:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),b}},ND=[kC,TC,IC,EC,PC,DC,MC,OC,UC,WC,jC,GC,XC,ZC,JC,tE,nE,rE,aE,iE,sE,dE,cE,hE,pE,bE,vE,wE,GI,SE,PE,zE,BE,UE,WE,VE,jE,GE,XE,KE,eN,tN,nN,rN,sN,oN,lN,uN,dN,cN,pN,mN,gN,bN,AN,wN,TN,CN,PN,DN,$N,LN,zN,UN,WN,VN,HN,qN,KN,jI,ZN,EE,JN,eR,nR,KI,aR,sR,oR,uR,cR,pR,fR,yR,bR,xR,vR,kR,SR,TR,_R,IR,CR,ER,NR,PR,DR,OR,VR,lC,HR,qR,KR,YR,fE,JR,tP,nP,aP,sP,JI,oP,lP,uP,dP,hP,yE,FR,mP,gP,bP,dC,xP,AP,vP,wP,kP,SP,_P,CP,NP,RP,PP,MP,$P,LP,BP,WP,uE,WR,jP,HP,GP,qP,XP,KP,ZP,YP,eD,nD,iD,sD,oD,lD,uD,dD,cD,BR,bC,pD,fD,gD,bD,TD,_D,AC,ID,CD,ED,eP];for(let e of ND)ba(e);!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(wD||(wD={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(kD||(kD={}));var RD={kernelName:la,backendName:"wasm",setupFunc:function(e){SD=e.wasm.cwrap(la,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i,bias:s,preluActivationWeights:o}=t;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");let{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:c}=r,h=n.dataIdMap.get(a.dataId).id,p=n.dataIdMap.get(i.dataId).id,m=0;if(null!=s){let e=n.dataIdMap.get(s.dataId);if(1!==e.shape.length)throw new Error(`_FusedMatMul only supports rank-1 bias but got rank ${e.shape.length}.`);m=e.id}let f=null==o?0:n.dataIdMap.get(o.dataId).id,g=kD[d];if(null==g)throw new Error(`${d} activation not yet supported for FusedConv2D in the wasm backend.`);let y=l?a.shape[2]:a.shape[1],b=u?i.shape[1]:i.shape[2],x=Ml.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),A=n.makeOutput([...x,y,b],a.dtype),v=n.dataIdMap.get(A.dataId).id,w=new Uint8Array(new Int32Array(a.shape).buffer),k=new Uint8Array(new Int32Array(i.shape).buffer);return SD(h,w,a.shape.length,p,k,i.shape.length,l,u,g,m,f,c||0,v),A}};function PD(e,t){let n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){let{backend:r,inputs:{x:a}}=e,i=r.dataIdMap.get(a.dataId).id,s=r.makeOutput(a.shape,t||a.dtype),o=r.dataIdMap.get(s.dataId).id;return 0===Sa.sizeFromShape(s.shape)||n(i,wD[a.dtype],o),s}}}var DD=PD(Ge),MD=PD(qe),OD=PD(Xe);function $D(e,t,n){let r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:a}=e,{a:i,b:s}=a,o=t.dataIdMap.get(i.dataId).id,l=t.dataIdMap.get(s.dataId).id,u=null!=n?n:i.dtype,d=$m.assertAndGetBroadcastShape(i.shape,s.shape),c=t.makeOutput(d,u);if(0===Sa.sizeFromShape(d))return c;let h=new Uint8Array(new Int32Array(i.shape).buffer),p=new Uint8Array(new Int32Array(s.shape).buffer),m=t.dataIdMap.get(c.dataId).id;return r(o,h,i.shape.length,l,p,s.shape.length,wD[i.dtype],m),c}}}var FD,LD=$D(Ke),zD={kernelName:Ze,backendName:"wasm",setupFunc:function(e){FD=e.wasm.cwrap(Ze,null,["array","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n}=e,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Sa.sizeFromShape(r.shape))return r;let a=t.map((e=>n.dataIdMap.get(e.dataId).id)),i=new Uint8Array(new Int32Array(a).buffer),s=n.dataIdMap.get(r.dataId).id;return FD(i,a.length,wD[r.dtype],s),r}};function BD(e){let{inputs:{x:t},backend:n}=e;if("string"===t.dtype)return Gi(n.readSync(t.dataId),t.shape,t.dtype);let r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var UD,WD={kernelName:un,backendName:"wasm",kernelFunc:BD};function VD(e){let{inputs:t,backend:n,attrs:r}=e,[a,i]=function(e,t){let n=[],r=[];for(let a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(let e=0;e<r.length;++e){let t=-1;for(let n=0;n<r.length;++n)r[n]>=e&&(-1===t||r[t]>r[n])&&(t=n);r[t]=e}return[n,r]}(t.x.shape,r.perm),s=!0;for(let e=0;e<i.length;e++)i[e]!==e&&(s=!1);let o=function(e,t){let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),l={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(s){let e=BD({inputs:t,backend:n});return e.shape=o,e}let u=n.makeOutput(o,l.dtype),d=n.dataIdMap.get(l.dataId).id,c=n.dataIdMap.get(u.dataId).id,h=new Uint8Array(new Int32Array(i).buffer),p=new Uint8Array(new Int32Array(l.shape).buffer);return UD(d,p,l.shape.length,wD[l.dtype],c,h,i.length),u}var jD,HD={kernelName:Qr,backendName:"wasm",kernelFunc:VD,setupFunc:function(e){UD=e.wasm.cwrap(Qr,null,["number","array","number","number","number","array","number"])}};function GD(e,t,n){let r=e.shape,a=e.shape.length,i=Sa.parseAxisParam(t,r),s=i,o=$m.getAxesPermutation(s,a),l=null,u=!1;if(null!=o){let t=new Array(a);for(let e=0;e<t.length;e++)t[e]=r[o[e]];s=$m.getInnerMostAxes(s.length,a),l=VD({inputs:{x:e},attrs:{perm:o},backend:n});let i=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(l.dataId).id!==i&&(u=!0)}return{transposed:l,originalAxes:i,axes:s,inputWasTransposed:u}}var qD,XD={kernelName:Ye,backendName:"wasm",setupFunc:function(e){jD=e.wasm.cwrap(Ye,null,["number, number, number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=s,{transposed:u,axes:d,originalAxes:c,inputWasTransposed:h}=GD(s,a,t);h&&(l=u,o=t.dataIdMap.get(u.dataId).id);let p=l.shape.length;$m.assertAxesAreInnerMostDims("all",d,p);let[m,f]=$m.computeOutAndReduceShapes(l.shape,d),g=Sa.sizeFromShape(f),y=t.makeOutput(m,s.dtype);if(0!==Sa.sizeFromShape(l.shape)){let e=t.dataIdMap.get(y.dataId).id;jD(o,g,e)}if(h&&t.disposeData(u.dataId),i){let e=$m.expandShapeToKeepDim(y.shape,c);y.shape=e}return y}},KD={kernelName:Je,backendName:"wasm",setupFunc:function(e){qD=e.wasm.cwrap(Je,null,["number, number, number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=s,{transposed:u,axes:d,originalAxes:c,inputWasTransposed:h}=GD(s,a,t);h&&(l=u,o=t.dataIdMap.get(u.dataId).id);let p=l.shape.length;$m.assertAxesAreInnerMostDims("any",d,p);let[m,f]=$m.computeOutAndReduceShapes(l.shape,d),g=Sa.sizeFromShape(f),y=t.makeOutput(m,s.dtype);if(0!==Sa.sizeFromShape(l.shape)){let e=t.dataIdMap.get(y.dataId).id;qD(o,g,e)}if(h&&t.disposeData(u.dataId),i){let e=$m.expandShapeToKeepDim(y.shape,c);y.shape=e}return y}};function ZD(e){let t;return{kernelName:e,backendName:"wasm",setupFunc:function(n){t=n.wasm.cwrap(e,null,["number","number","number","number","number"])},kernelFunc:function(e){let{backend:n,inputs:r,attrs:a}=e,{axis:i}=a,{x:s}=r,o=n.dataIdMap.get(s.dataId).id,l=o,u=s,{transposed:d,axes:c,inputWasTransposed:h}=GD(s,i,n);if(h){let e=n.dataIdMap.get(d.dataId).id;e!==o&&(u=d,l=e)}let p=u.shape.slice(0,-1),m=n.makeOutput(p,"int32"),f=n.dataIdMap.get(m.dataId).id,g=Sa.sizeFromShape(m.shape),y=u.shape[c[0]];return t(l,wD[u.dtype],g,y,f),h&&n.disposeData(d.dataId),m}}}var YD,JD,QD,eM,tM=ZD(Qe),nM=ZD(et),rM=PD(tt),aM=PD(nt),iM=PD(rt),sM=$D(it),oM=PD(at),lM={kernelName:st,backendName:"wasm",setupFunc:function(e){YD=e.wasm.cwrap(st,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,i=r.dataIdMap.get(a.dataId).id,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=n,d=$m.computePool2DInfo(a.shape,s,o,1,l,u),c=d.filterHeight,h=d.filterWidth,p=d.padInfo.top,m=d.padInfo.right,f=d.padInfo.bottom,g=d.padInfo.left,y=d.strideHeight,b=d.strideWidth,x=d.inChannels;if("channelsLast"!==d.dataFormat)throw new Error(`wasm backend does not support dataFormat:'${d.dataFormat}'. Please use 'channelsLast'.`);if(1!==d.dilationWidth||1!==d.dilationHeight)throw new Error(`was backend only supports average pooling with dilation = [1, 1], got [${d.dilationHeight}, ${d.dilationWidth}].`);let A=r.makeOutput(d.outShape,"float32"),v=r.dataIdMap.get(A.dataId).id;return YD(i,a.shape[0],a.shape[1],a.shape[2],c,h,p,m,f,g,y,b,x,v),A}},uM={kernelName:lt,backendName:"wasm",setupFunc:function(e){JD=e.wasm.cwrap("AvgPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r,d=$m.computePool3DInfo(a.shape,i,s,1,o,l,u),c=n.makeOutput(d.outShape,a.dtype);return JD(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inChannels,d.inDepth,d.inHeight,d.inWidth,d.outDepth,d.outHeight,d.outWidth,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),c}},dM={kernelName:ut,backendName:"wasm",setupFunc:function(e){QD=e.wasm.cwrap("AvgPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r,d=$m.computePool3DInfo(i.shape,s,o,1,l,u),c=n.makeOutput(i.shape,i.dtype);return QD(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inChannels,d.inDepth,d.inHeight,d.inWidth,d.outDepth,d.outHeight,d.outWidth,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left,d.filterDepth,d.filterHeight,d.filterWidth),c}},cM={kernelName:ot,backendName:"wasm",setupFunc:function(e){eM=e.wasm.cwrap("AvgPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l}=r,u=$m.computePool2DInfo(i.shape,s,o,1,l),d=n.makeOutput(i.shape,i.dtype);return eM(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,u.batchSize,u.inChannels,u.inHeight,u.inWidth,u.outHeight,u.outWidth,u.strideHeight,u.strideWidth,u.dilationHeight,u.dilationWidth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.top,u.padInfo.left,u.filterHeight,u.filterWidth),d}};function hM(e){let{inputs:t,attrs:n}=e,{x:r}=t,{shape:a}=n,i=Sa.sizeFromShape(r.shape),s=Sa.inferFromImplicitShape(a,i);return Sa.assert(i===Sa.sizeFromShape(s),(()=>`new shape: ${s}, old shape: ${r.shape}. New shape and old shape must have the same number of elements.`)),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:s,dtype:r.dtype}}var pM,mM={kernelName:dr,backendName:"wasm",kernelFunc:hM},fM={kernelName:dt,backendName:"wasm",setupFunc:function(e){pM=e.wasm.cwrap(dt,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i}=t,{transposeA:s,transposeB:o}=r;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");let l=a.shape.length,u=i.shape.length,d=s?a.shape[l-2]:a.shape[l-1],c=o?i.shape[u-1]:i.shape[u-2],h=s?a.shape[l-1]:a.shape[l-2],p=o?i.shape[u-2]:i.shape[u-1],m=a.shape.slice(0,-2),f=i.shape.slice(0,-2),g=Sa.sizeFromShape(m),y=Sa.sizeFromShape(f),b=Ml.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,p]);Sa.assert(d===c,(()=>`Error in matMul: inner shapes (${d}) and (${c}) of Tensors with shapes ${a.shape} and ${i.shape} and transposeA=${s} and transposeB=${o} must match.`));let x=o?[y,p,c]:[y,c,p],A=hM({inputs:{x:a},backend:n,attrs:{shape:s?[g,d,h]:[g,h,d]}}),v=hM({inputs:{x:i},backend:n,attrs:{shape:x}}),w=n.dataIdMap.get(A.dataId).id,k=n.dataIdMap.get(v.dataId).id,S=s?A.shape[2]:A.shape[1],T=o?v.shape[1]:v.shape[2],_=Math.max(g,y),I=n.makeOutput([_,S,T],A.dtype),C=n.dataIdMap.get(I.dataId).id,E=new Uint8Array(new Int32Array(A.shape).buffer),N=new Uint8Array(new Int32Array(v.shape).buffer);return pM(w,E,A.shape.length,k,N,v.shape.length,s,o,C),n.disposeData(A.dataId),n.disposeData(v.dataId),I.shape=b,I}};function gM(e){let{inputs:{x:t},attrs:{begin:n,size:r},backend:a}=e,[i,s]=dm.parseSliceParams(t,n,r),o=dm.isSliceContinous(t.shape,i,s),l=a.readSync(t.dataId),u=a.makeOutput(s,t.dtype),d=Sa.computeStrides(t.shape),c=a.dataIdMap.get(u.dataId);if(o){let e=dm.computeFlatOffset(i,d);return"string"===t.dtype?c.stringBytes=l.slice(e,e+Sa.sizeFromShape(s)):a.typedArrayFromHeap(u).set(l.subarray(e,e+Sa.sizeFromShape(s))),u}if("string"===t.dtype){let e=Cx(l,i,s,t.shape,t.dtype);return c.stringBytes=e,u}let h=a.typedArrayFromHeap(u),p=t.shape.length;if(2===p)!function(e,t,n,r,a){let i=0,s=r[0],o=r[1],l=s+a[0];for(let r=s;r<l;r++){let s=r*t+o;n.set(e.subarray(s,s+a[1]),i),i+=a[1]}}(l,d[0],h,i,s);else if(3===p)!function(e,t,n,r,a,i){let s=0,o=a[0],l=a[1],u=a[2],d=o+i[0],c=l+i[1];for(let a=o;a<d;a++)for(let o=l;o<c;o++){let l=a*t+o*n+u;r.set(e.subarray(l,l+i[2]),s),s+=i[2]}}(l,d[0],d[1],h,i,s);else if(4===p)!function(e,t,n,r,a,i,s){let o=0,l=i[0],u=i[1],d=i[2],c=l+s[0],h=u+s[1],p=d+s[2],m=i[3];for(let i=l;i<c;i++)for(let l=u;l<h;l++)for(let u=d;u<p;u++){let d=i*t+l*n+u*r+m;a.set(e.subarray(d,d+s[3]),o),o+=s[3]}}(l,d[0],d[1],d[2],h,i,s);else{let e=Cx(l,i,s,t.shape,t.dtype);h.set(e)}return u}var yM,bM={kernelName:Sr,backendName:"wasm",kernelFunc:gM},xM={kernelName:ct,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r,o=i.reduce(((e,t)=>e*t)),l=$m.getReshaped(a.shape,i,o),u=$m.getPermuted(l.length,i.length),d=$m.getReshapedPermuted(a.shape,i,o),c=$m.getSliceBeginCoords(s,i.length),h=$m.getSliceSize(d,s,i.length),p=hM({inputs:{x:a},backend:n,attrs:{shape:l}}),m=VD({inputs:{x:p},backend:n,attrs:{perm:u}}),f=gM({inputs:{x:hM({inputs:{x:m},backend:n,attrs:{shape:d}})},backend:n,attrs:{begin:c,size:h}});return n.disposeData(p.dataId),n.disposeData(m.dataId),n.disposeData(p.dataId),f}},AM={kernelName:ht,backendName:"wasm",setupFunc:function(e){yM=e.wasm.cwrap(ht,null,["number","number","boolean","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:i}=n,{size:s}=r,o=0!==i.shape.reduce(((e,t)=>e*t),1),l=1===a.shape.length?[s]:[a.shape[0],s],u=t.makeOutput(l,i.dtype);function d(e){return t.dataIdMap.get(e.dataId).id}return yM(d(a),s,o,d(i),wD[i.dtype],d(u)),u}},vM=$D(pt),wM={kernelName:ft,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.typedArrayFromHeap(r),s=n.typedArrayFromHeap(a),o=$m.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return n.makeOutput([o.length],"int32",void 0,new Int32Array(o))}};function kM(e){let{inputs:{x:t},attrs:{dtype:n},backend:r}=e,a=r.makeOutput(t.shape,n),i=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(i),a}var SM,TM={kernelName:gt,backendName:"wasm",kernelFunc:kM},_M=PD(yt),IM={kernelName:bt,backendName:"wasm",setupFunc:function(e){SM=e.wasm.cwrap(bt,null,["number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:i,clipValueMax:s}=r,o=n.dataIdMap.get(a.dataId).id,l=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(l.dataId).id;return SM(o,i,s,u),l}};function CM(e){let{inputs:t,backend:n}=e,r=Sa.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map((e=>e.shape));$m.assertParamsConsistent(a,r);let i=$m.computeOutShape(t.map((e=>e.shape)),r),s=t.filter((e=>Sa.sizeFromShape(e.shape)>0));if(1===s.length)return BD({inputs:{x:s[0]},backend:n});let o=n.makeOutput(i,t[0].dtype);if(0===Sa.sizeFromShape(i))return o;if("string"===s[0].dtype){let e=s.map((e=>{let t=[-1,Sa.sizeFromShape(e.shape.slice(r))];return hM({inputs:{x:e},backend:n,attrs:{shape:t}})})),a=e.map((e=>({vals:n.readSync(e.dataId),shape:e.shape})));i=$m.computeOutShape(e.map((e=>e.shape)),1);let l=1===e[0].shape[0],u=db(a,i,t[0].dtype,l),d=$m.computeOutShape(s.map((e=>e.shape)),r);return o.shape=d,n.dataIdMap.get(o.dataId).stringBytes=$m.fromStringArrayToUint8(u),e.forEach((e=>n.disposeData(e.dataId))),o}let l=Sa.sizeFromShape(s[0].shape.slice(0,r)),u=0,d=s.map((e=>{let t=Sa.sizeFromShape(e.shape.slice(r));return u+=t,t})),c=s.map((e=>n.typedArrayFromHeap(e))),h=n.typedArrayFromHeap(o);for(let e=0;e<l;e++){let t=e*u;for(let n=0;n<c.length;n++){let r=d[n],a=e*r,i=c[n].subarray(a,a+r);h.set(i,t),t+=r}}return o}var EM,NM,RM,PM,DM,MM,OM,$M={kernelName:vt,backendName:"wasm",kernelFunc:CM},FM={kernelName:wt,backendName:"wasm",setupFunc:function(e){EM=e.wasm.cwrap(wt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:i}=t,s=r.dataIdMap.get(a.dataId).id,o=r.dataIdMap.get(i.dataId).id,{strides:l,dilations:u,pad:d,dimRoundingMode:c,dataFormat:h}=n,p=$m.convertConv2DDataFormat(h),m=$m.computeConv2DInfo(a.shape,i.shape,l,u,d,c,!1,p),f=m.filterHeight,g=m.filterWidth,y=m.padInfo.top,b=m.padInfo.right,x=m.padInfo.bottom,A=m.padInfo.left,v=m.dilationHeight,w=m.dilationWidth,k=m.strideHeight,S=m.strideWidth,T=m.inChannels,_=m.outChannels,I="SAME"===m.padInfo.type?1:0;if("channelsLast"!==m.dataFormat)throw new Error(`wasm backend Conv2D does not support dataFormat:'${m.dataFormat}'. Please use 'channelsLast'.`);let C=r.makeOutput(m.outShape,"float32"),E=r.dataIdMap.get(C.dataId).id;return EM(s,a.shape[0],a.shape[1],a.shape[2],o,f,g,y,b,x,A,I,v,w,k,S,T,_,E),C}},LM={kernelName:St,backendName:"wasm",setupFunc:function(e){NM=e.wasm.cwrap(St,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{dy:a,filter:i}=n,{strides:s,pad:o,dataFormat:l,dimRoundingMode:u,inputShape:d}=r,c=$m.convertConv2DDataFormat(l),h=$m.computeConv2DInfo(d,i.shape,s,1,o,u,!1,c),{batchSize:p,filterHeight:m,filterWidth:f,inChannels:g,inHeight:y,inWidth:b,outChannels:x,outHeight:A,outWidth:v,strideHeight:w,strideWidth:k}=h,S=m-1-h.padInfo.top,T=f-1-h.padInfo.left,_="channelsLast"===h.dataFormat,I=Sa.computeStrides(h.inShape),C=Sa.computeStrides(a.shape),[E,N,R]=Sa.computeStrides(i.shape),P=I[0],D=_?I[1]:I[2],M=_?I[2]:1,O=_?1:I[1],$=C[0],F=_?C[1]:C[2],L=_?C[2]:1,z=_?1:C[1],B=t.makeOutput(h.inShape,"float32"),U=t.dataIdMap.get(B.dataId).id,W=t.dataIdMap.get(a.dataId).id,V=t.dataIdMap.get(i.dataId).id;return NM(W,V,p,m,f,y,b,g,A,v,x,w,k,S,T,E,N,R,P,D,M,O,$,F,L,z,U),B}},zM={kernelName:Tt,backendName:"wasm",setupFunc:function(e){RM=e.wasm.cwrap(Tt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r;if("float32"!==a.dtype)throw new Error(`Tensor x must have dtype float32, got ${a.dtype}`);if("float32"!==i.dtype)throw new Error(`Tensor filter must have dtype float32, got ${i.dtype}`);let u=$m.computeConv3DInfo(a.shape,i.shape,s,l,o),d=n.makeOutput(u.outShape,a.dtype);return RM(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(d.dataId).id,u.batchSize,u.inDepth,u.inHeight,u.inWidth,u.inChannels,u.outDepth,u.outHeight,u.outWidth,u.outChannels,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.filterDepth,u.filterHeight,u.filterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left),d}},BM={kernelName:_t,backendName:"wasm",setupFunc:function(e){PM=e.wasm.cwrap(_t,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r;if("float32"!==a.dtype)throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if("float32"!==i.dtype)throw new Error(`Tensor filter must have dtype float32, got ${i.dtype}`);let u=$m.computeConv3DInfo(a.shape,l,s,1,o),d=n.makeOutput(u.filterShape,i.dtype);return PM(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(d.dataId).id,u.batchSize,u.inDepth,u.inHeight,u.inWidth,u.inChannels,u.outDepth,u.outHeight,u.outWidth,u.outChannels,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.filterDepth,u.filterHeight,u.filterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left),d}},UM={kernelName:It,backendName:"wasm",setupFunc:function(e){DM=e.wasm.cwrap(It,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r;if("float32"!==a.dtype)throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if("float32"!==i.dtype)throw new Error(`Tensor filter must have dtype float32, got ${i.dtype}`);let u=$m.computeConv3DInfo(l,i.shape,o,1,s),d=n.makeOutput(u.inShape,a.dtype);return DM(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,u.batchSize,u.inDepth,u.inHeight,u.inWidth,u.inChannels,u.outDepth,u.outHeight,u.outWidth,u.outChannels,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.filterDepth,u.filterHeight,u.filterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left),d}},WM=PD(Ct),VM=PD(Et);!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(MM||(MM={}));var jM,HM,GM,qM,XM,KM,ZM,YM,JM,QM,eO={kernelName:Pt,backendName:"wasm",setupFunc:function(e){OM=e.wasm.cwrap(Pt,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){let t,{backend:n,inputs:r,attrs:a}=e,{method:i,extrapolationValue:s,cropSize:o}=a,{image:l,boxes:u,boxInd:d}=r,c=u.shape[0],[h,p]=o,m=[c,h,p,l.shape[3]],f=n.dataIdMap.get(l.dataId);"float32"!==l.dtype&&(t=kM({backend:n,inputs:{x:l},attrs:{dtype:"float32"}}),f=n.dataIdMap.get(t.dataId));let g=f.id,y=n.dataIdMap.get(u.dataId).id,b=n.dataIdMap.get(d.dataId).id,x=n.makeOutput(m,"float32"),A=n.dataIdMap.get(x.dataId).id,v=new Uint8Array(new Int32Array(l.shape).buffer);return OM(g,y,b,c,v,h,p,MM[i],s,A),null!=t&&n.disposeData(t.dataId),x}},tO={kernelName:Nt,backendName:"wasm",setupFunc:function(e){jM=e.wasm.cwrap(Nt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r,l=a.shape.length;Sa.assert("float32"===a.dtype||"int32"===a.dtype,(()=>`cumprod does not support ${a.dtype} tensors in the WASM backend`));let u=$m.getAxesPermutation([i],l),d=a;null!==u&&(d=VD({inputs:{x:a},attrs:{perm:u},backend:n}));let c=$m.getInnerMostAxes(1,l)[0];$m.assertAxesAreInnerMostDims("cumprod",[c],l);let h=n.makeOutput(d.shape,d.dtype),p=d.shape[c],m=n.dataIdMap.get(d.dataId).id,f=n.dataIdMap.get(h.dataId).id;jM(m,s?1:0,o?1:0,p,f,wD[a.dtype]);let g=h;return null!==u&&(g=VD({inputs:{x:h},attrs:{perm:$m.getUndoAxesPermutation(u)},backend:n}),n.disposeData(d.dataId),n.disposeData(h.dataId)),g}},nO={kernelName:Rt,backendName:"wasm",setupFunc:function(e){HM=e.wasm.cwrap(Rt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r,l=a.shape.length;Sa.assert("float32"===a.dtype||"int32"===a.dtype,(()=>`cumsum does not support ${a.dtype} tensors in the WASM backend`));let u=$m.getAxesPermutation([i],l),d=a;null!==u&&(d=VD({inputs:{x:a},attrs:{perm:u},backend:n}));let c=$m.getInnerMostAxes(1,l)[0];$m.assertAxesAreInnerMostDims("cumsum",[c],l);let h=n.makeOutput(d.shape,d.dtype),p=d.shape[c],m=n.dataIdMap.get(d.dataId).id,f=n.dataIdMap.get(h.dataId).id;HM(m,s?1:0,o?1:0,p,f,wD[a.dtype]);let g=h;return null!==u&&(g=VD({inputs:{x:h},attrs:{perm:$m.getUndoAxesPermutation(u)},backend:n}),n.disposeData(d.dataId),n.disposeData(h.dataId)),g}},rO={kernelName:Dt,backendName:"wasm",setupFunc:function(e){GM=e.wasm.cwrap("DenseBincount",null,["number","array","number","number","boolean","number","number","boolean","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:i}=n,{size:s,binaryOutput:o}=r,l=0!==i.shape.reduce(((e,t)=>e*t),1),u=1===a.shape.length?[s]:[a.shape[0],s],d=t.makeOutput(u,i.dtype);function c(e){return t.dataIdMap.get(e.dataId).id}return GM(c(a),new Uint8Array(new Int32Array(a.shape).buffer),a.shape.length,s,l,c(i),wD[i.dtype],o,c(d)),d}},aO={kernelName:Mt,backendName:"wasm",setupFunc:function(e){qM=e.wasm.cwrap(Mt,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{blockSize:i,dataFormat:s}=r,o=a.shape[0],l=("NHWC"===s?a.shape[1]:a.shape[2])*i,u=("NHWC"===s?a.shape[2]:a.shape[3])*i,d=("NHWC"===s?a.shape[3]:a.shape[1])/(i*i),c="NHWC"===s?[o,l,u,d]:[o,d,l,u],h=t.makeOutput(c,"float32"),p=t.dataIdMap.get(a.dataId).id,m=new Uint8Array(new Int32Array(Sa.computeStrides(a.shape)).buffer),f=new Uint8Array(new Int32Array(c).buffer),g=new Uint8Array(new Int32Array(Sa.computeStrides(c)).buffer),y=t.dataIdMap.get(h.dataId).id;return qM(p,i,"NHWC"===s?1:0,m,a.shape.length-1,f,g,c.length,y),h}},iO={kernelName:Ot,backendName:"wasm",setupFunc:function(e){XM=e.wasm.cwrap(Ot,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:i}=t,s=r.dataIdMap.get(a.dataId).id,o=r.dataIdMap.get(i.dataId).id,{strides:l,dilations:u,pad:d,dimRoundingMode:c}=n,h=null==u?[1,1]:u,p=$m.computeConv2DInfo(a.shape,i.shape,l,h,d,c,!0),m=p.filterHeight,f=p.filterWidth,g=p.padInfo.top,y=p.padInfo.right,b=p.padInfo.bottom,x=p.padInfo.left,A=p.dilationHeight,v=p.dilationWidth,w=p.strideHeight,k=p.strideWidth,S=p.inChannels,T=p.outChannels,_="SAME"===p.padInfo.type?1:0;if("channelsLast"!==p.dataFormat)throw new Error(`wasm backend DepthwiseConv2dNative does not support dataFormat:'${p.dataFormat}'. Please use 'channelsLast'.`);let I=r.makeOutput(p.outShape,"float32"),C=r.dataIdMap.get(I.dataId).id;return XM(s,a.shape[0],a.shape[1],a.shape[2],o,m,f,g,y,b,x,_,A,v,w,k,S,T,C),I}},sO={kernelName:Lt,backendName:"wasm",setupFunc:function(e){KM=e.wasm.cwrap("Diag",null,["number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,a=Sa.sizeFromShape(r.shape),i=n.makeOutput([...r.shape,...r.shape],r.dtype);return KM(n.dataIdMap.get(r.dataId).id,wD[r.dtype],a,n.dataIdMap.get(i.dataId).id),i}},oO={kernelName:zt,backendName:"wasm",setupFunc:function(e){ZM=e.wasm.cwrap(zt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r;if(a.dtype!==i.dtype)throw new Error(`Dilation2D error: x must have the same dtype as filter. Got ${a.dtype} and ${i.dtype}`);let u=$m.computeDilation2DInfo(a.shape,i.shape,s,o,"NHWC",l),d=n.makeOutput(u.outShape,a.dtype);return ZM(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(d.dataId).id,wD[a.dtype],u.batchSize,u.inChannels,u.inHeight,u.inWidth,u.outHeight,u.outWidth,u.strideHeight,u.strideWidth,u.dilationHeight,u.dilationWidth,u.filterHeight,u.filterWidth,u.padInfo.top,u.padInfo.left),d}},lO={kernelName:Ut,backendName:"wasm",setupFunc:function(e){YM=e.wasm.cwrap(Ut,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,dy:s}=t,{strides:o,pad:l,dilations:u}=r;if(a.dtype!==i.dtype||a.dtype!==s.dtype)throw new Error(`Dilation2DBackpropFilter error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${i.dtype}, and ${s.dtype}`);let d=$m.computeDilation2DInfo(a.shape,i.shape,o,l,"NHWC",u),c=n.makeOutput(i.shape,i.dtype);return YM(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,wD[a.dtype],d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.filterHeight,d.filterWidth,d.padInfo.top,d.padInfo.left),c}},uO={kernelName:Bt,backendName:"wasm",setupFunc:function(e){JM=e.wasm.cwrap(Bt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,dy:s}=t,{strides:o,pad:l,dilations:u}=r;if(a.dtype!==i.dtype||a.dtype!==s.dtype)throw new Error(`Dilation2DBackpropInput error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${i.dtype}, and ${s.dtype}`);let d=$m.computeDilation2DInfo(a.shape,i.shape,o,l,"NHWC",u),c=n.makeOutput(a.shape,a.dtype);return JM(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,wD[a.dtype],d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.filterHeight,d.filterWidth,d.padInfo.top,d.padInfo.left),c}},dO=PD(Ht),cO={kernelName:Gt,backendName:"wasm",setupFunc:function(e){QM=e.wasm.cwrap(Gt,null,["number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=n.makeOutput(a.shape,"float32"),s=e=>n.dataIdMap.get(e.dataId).id;return QM(s(a),s(r),s(i)),i}},hO=$D(Xt,0,"bool"),pO=PD(qt),mO=PD(Kt,"float32");function fO(e){let{inputs:t,attrs:n,backend:r}=e,{input:a}=t,{dim:i}=n,s=a.shape.length,o=a.shape.slice(),l=i;return i<0&&(Sa.assert(-(s+1)<=i,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),l=s+i+1),o.splice(l,0,1),hM({inputs:{x:a},backend:r,attrs:{shape:o}})}var gO={kernelName:Zt,backendName:"wasm",kernelFunc:fO},yO=PD(Yt,"float32");function bO(e){let{attrs:{shape:t,value:n,dtype:r},backend:a}=e,i=a.makeOutput(t,r);return a.typedArrayFromHeap(i).fill(n),i}var xO,AO,vO,wO,kO,SO,TO,_O,IO,CO,EO,NO,RO,PO,DO,MO,OO,$O,FO,LO,zO={kernelName:Qt,backendName:"wasm",kernelFunc:bO},BO={kernelName:en,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n}=e,{image:r}=t,a=n.makeOutput(r.shape,r.dtype),i=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,[o,l,u,d]=r.shape;return xO(i,o,l,u,d,s),a},setupFunc:function(e){xO=e.wasm.cwrap(en,null,["number","number","number","number","number","number"])}},UO=PD(tn),WO=$D(nn),VO={kernelName:rn,backendName:"wasm",setupFunc:function(e){AO=e.wasm.cwrap(rn,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{varianceEpsilon:a}=r,{x:i,mean:s,variance:o,offset:l,scale:u}=n,d=t.dataIdMap.get(i.dataId).id,c=t.dataIdMap.get(s.dataId).id,h=t.dataIdMap.get(o.dataId).id,p=null!=l?t.dataIdMap.get(l.dataId).id:0,m=null!=u?t.dataIdMap.get(u.dataId).id:0,f=t.makeOutput(i.shape,i.dtype);if(0===Sa.sizeFromShape(i.shape))return f;let g=t.dataIdMap.get(f.dataId).id;return AO(d,c,h,p,m,a,g),f}},jO={kernelName:ua,backendName:"wasm",setupFunc:function(e){vO=e.wasm.cwrap(ua,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dilations:d,dataFormat:c,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=n,f=$m.computeConv2DInfo(a.shape,i.shape,l,d,u,h),g=kD[p];if(null==g)throw new Error(`${p} activation not yet supported for FusedConv2D in the wasm backend.`);let y=r.dataIdMap.get(a.dataId).id,b=r.dataIdMap.get(i.dataId).id,x=f.outChannels,A=0;if(null!=s){let e=r.dataIdMap.get(s.dataId);if(1!==e.shape.length)throw new Error(`FusedConv2D only supports rank-1 bias but got rank ${e.shape.length}.`);if(e.shape[0]!==x)throw new Error(`FusedConv2D bias shape (${e.shape}) does not match the number of output channels (${x})`);A=e.id}let v=f.filterHeight,w=f.filterWidth,k=f.padInfo.top,S=f.padInfo.right,T=f.padInfo.bottom,_=f.padInfo.left,I=f.dilationHeight,C=f.dilationWidth,E=f.strideHeight,N=f.strideWidth,R=f.inChannels,P="SAME"===f.padInfo.type?1:0,D=f.batchSize,M=f.inHeight,O=f.inWidth;if("NHWC"!==c)throw new Error(`wasm backend FusedConv2D does not support dataFormat:'${c}'. Please use 'NHWC'.`);let $=r.makeOutput(f.outShape,"float32"),F=r.dataIdMap.get($.dataId).id,L=null==o?0:r.dataIdMap.get(o.dataId).id;return vO(y,D,M,O,b,v,w,A,k,S,T,_,P,I,C,E,N,R,x,g,L,m||0,F),$}},HO={kernelName:da,backendName:"wasm",setupFunc:function(e){wO=e.wasm.cwrap(da,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dilations:d,dataFormat:c,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=n,f=$m.computeConv2DInfo(a.shape,i.shape,l,d,u,h,!0),g=kD[p];if(null==g)throw new Error(`${p} activation not yet supported for FusedDepthwiseConv2D in the wasm backend.`);let y=r.dataIdMap.get(a.dataId).id,b=r.dataIdMap.get(i.dataId).id,x=f.outChannels,A=0;if(null!=s){let e=r.dataIdMap.get(s.dataId);if(1!==e.shape.length)throw new Error(`FusedDepthwiseConv2D only supports rank-1 bias but got rank ${e.shape.length}.`);if(e.shape[0]!==x)throw new Error(`FusedDepthwiseConv2D bias shape (${e.shape}) does not match the number of output channels (${x})`);A=e.id}let v=f.filterHeight,w=f.filterWidth,k=f.padInfo.top,S=f.padInfo.right,T=f.padInfo.bottom,_=f.padInfo.left,I=f.dilationHeight,C=f.dilationWidth,E=f.strideHeight,N=f.strideWidth,R=f.inChannels,P="SAME"===f.padInfo.type?1:0,D=f.batchSize,M=f.inHeight,O=f.inWidth;if("NHWC"!==c)throw new Error(`wasm backend FusedDepthwiseConv2D does not support dataFormat:'${c}'. Please use 'NHWC'.`);let $=r.makeOutput(f.outShape,"float32"),F=r.dataIdMap.get($.dataId).id,L=null==o?0:r.dataIdMap.get(o.dataId).id;return wO(y,D,M,O,b,v,w,A,k,S,T,_,P,I,C,E,N,R,x,g,L,m||0,F),$}},GO={kernelName:sn,backendName:"wasm",setupFunc:function(e){kO=e.wasm.cwrap(sn,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){let{backend:t,inputs:n}=e,{params:r,indices:a}=n,[i,s,o,l]=lm.prepareAndValidate(r,a),u=t.makeOutput(i,r.dtype);if(0===s)return u;let d=a.shape,c=d[d.length-1],h=t.dataIdMap.get(r.dataId).id,p=t.dataIdMap.get(a.dataId).id,m=new Uint8Array(new Int32Array(l).buffer),f=t.dataIdMap.get(u.dataId).id;return kO(h,wD[r.dtype],p,s,c,o,m,f),u}},qO={kernelName:an,backendName:"wasm",setupFunc:function(e){SO=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,indices:i}=n,{axis:s,batchDims:o}=r,l=Sa.parseAxisParam(s,a.shape)[0],u=t.readSync(i.dataId),d=a.shape[l];for(let e=0;e<u.length;++e){let t=u[e];Sa.assert(t<=d-1&&t>=0,(()=>`GatherV2: the index value ${t} is not in [0, ${d-1}]`))}let c=$m.segment_util.collectGatherOpShapeInfo(a,i,l,o),h=hM({inputs:{x:a},attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]},backend:t}),p=Sa.sizeFromShape(i.shape),m=hM({inputs:{x:i},attrs:{shape:[c.batchSize,p/c.batchSize]},backend:t}),f=[c.batchSize,c.outerSize,p/c.batchSize,c.sliceSize],g=t.makeOutput(f,a.dtype);if(0===Sa.sizeFromShape(a.shape))return g;let y=h.shape.length-1,b=t.dataIdMap.get(h.dataId).id,x=t.dataIdMap.get(m.dataId).id,A=t.dataIdMap.get(g.dataId).id,v=new Uint8Array(new Int32Array(Sa.computeStrides(h.shape)).buffer),w=new Uint8Array(new Int32Array(Sa.computeStrides(f)).buffer);return SO(b,wD[a.dtype],v,y,x,c.batchSize,w,A),t.disposeData(h.dataId),t.disposeData(m.dataId),g.shape=c.outputShape,g}},XO=$D(on,0,"bool"),KO=$D(ln,0,"bool"),ZO=PD(hn,"bool"),YO=PD(pn,"bool"),JO=PD(mn,"bool"),QO={kernelName:fn,backendName:"wasm",setupFunc:function(e){TO=e.wasm.cwrap(fn,null,["number","number","number","number"])},kernelFunc:function(e){let{inputs:{x:t},attrs:{alpha:n},backend:r}=e,a=r.dataIdMap.get(t.dataId).id,i=r.makeOutput(t.shape,"float32");if(0!==Sa.sizeFromShape(t.shape)){let e=r.dataIdMap.get(i.dataId).id;TO(a,wD[t.dtype],n,e)}return i}},e$=$D(gn,0,"bool"),t$=$D(yn,0,"bool"),n$={kernelName:bn,backendName:"wasm",setupFunc:function(e){_O=e.wasm.cwrap(bn,null,["number","number","number","number"])},kernelFunc:function(e){let{attrs:t,backend:n}=e,{start:r,stop:a,num:i}=t,s=Math.floor(i),o=n.makeOutput([s],"float32");return _O(n.dataIdMap.get(o.dataId).id,r,a,s),o}},r$=PD(xn),a$=PD(An),i$=$D(vn,0,"bool"),s$=PD(wn),o$=$D(kn,0,"bool"),l$=$D(Sn,0,"bool"),u$={kernelName:In,backendName:"wasm",setupFunc:function(e){IO=e.wasm.cwrap(In,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r;if("float32"!==a.dtype)throw new Error("LRN error: x must have dtype float32");let u=n.makeOutput(a.shape,a.dtype);return IO(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(u.dataId).id,a.shape[3],i,s,o,l),u}},d$={kernelName:Cn,backendName:"wasm",setupFunc:function(e){CO=e.wasm.cwrap(Cn,null,["number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:u,beta:d}=r;if("float32"!==a.dtype||"float32"!==i.dtype||"float32"!==s.dtype)throw new Error("LRNGrad error: x, y, and dy must have dtype float32");let c=n.makeOutput(a.shape,a.dtype);return CO(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,s.shape[3],o,l,u,d),c}},c$={kernelName:Nn,backendName:"wasm",setupFunc:function(e){EO=e.wasm.cwrap(Nn,null,["number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{reductionIndices:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=s,{transposed:u,axes:d,originalAxes:c,inputWasTransposed:h}=GD(s,a,t);h&&(l=u,o=t.dataIdMap.get(u.dataId).id);let p=l.shape.length;$m.assertAxesAreInnerMostDims("max",d,p);let[m,f]=$m.computeOutAndReduceShapes(l.shape,d),g=Sa.sizeFromShape(f),y=t.makeOutput(m,s.dtype);if(0!==Sa.sizeFromShape(l.shape)){let e=t.dataIdMap.get(y.dataId).id;EO(o,wD[s.dtype],g,e)}if(h&&t.disposeData(u.dataId),i){let e=$m.expandShapeToKeepDim(y.shape,c);y.shape=e}return y}},h$=$D(Rn),p$={kernelName:Pn,backendName:"wasm",setupFunc:function(e){NO=e.wasm.cwrap(Pn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,i=r.dataIdMap.get(a.dataId).id;Sa.assert("float32"===a.dtype,(()=>`Error in MaxPool: only float32 input is supported. Got ${a.dtype}.`));let{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=n,d=$m.computePool2DInfo(a.shape,s,o,1,l,u),c=d.filterHeight,h=d.filterWidth,p=d.padInfo.top,m=d.padInfo.right,f=d.padInfo.bottom,g=d.padInfo.left,y=d.dilationHeight,b=d.dilationWidth,x=d.strideHeight,A=d.strideWidth,v=d.inChannels,w=d.outChannels;if("channelsLast"!==d.dataFormat)throw new Error(`wasm backend does not support dataFormat:'${d.dataFormat}'. Please use 'channelsLast'.`);let k=r.makeOutput(d.outShape,"float32"),S=r.dataIdMap.get(k.dataId).id;return NO(i,a.shape[0],a.shape[1],a.shape[2],c,h,p,m,f,g,y,b,x,A,v,w,S),k}},m$={kernelName:Mn,backendName:"wasm",setupFunc:function(e){RO=e.wasm.cwrap("MaxPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r,d=$m.computePool3DInfo(a.shape,i,s,1,o,l,u),c=n.makeOutput(d.outShape,a.dtype);return RO(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inChannels,d.inDepth,d.inHeight,d.inWidth,d.outDepth,d.outHeight,d.outWidth,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),c}},f$={kernelName:On,backendName:"wasm",setupFunc:function(e){PO=e.wasm.cwrap("MaxPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r,d=$m.computePool3DInfo(i.shape,s,o,1,l,u),c=n.makeOutput(i.shape,i.dtype);return PO(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inChannels,d.inDepth,d.inHeight,d.inWidth,d.outDepth,d.outHeight,d.outWidth,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),c}},g$={kernelName:Dn,backendName:"wasm",setupFunc:function(e){DO=e.wasm.cwrap("MaxPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r,d=$m.computePool2DInfo(i.shape,s,o,1,l,u),c=n.makeOutput(i.shape,i.dtype);return DO(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.top,d.padInfo.left),c}},y$={kernelName:$n,backendName:"wasm",setupFunc:function(e){MO=e.wasm.cwrap("MaxPoolWithArgmax",null,["number","number","number","number","boolean","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:l}=r;Sa.assert(4===a.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${a.shape.length}.`));let u=[1,1];Sa.assert($m.eitherStridesOrDilationsAreOne(s,u),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`));let d=$m.computePool2DInfo(a.shape,i,s,[1,1],o),c=n.makeOutput(d.outShape,a.dtype),h=n.makeOutput(d.outShape,"int32");return MO(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,n.dataIdMap.get(h.dataId).id,wD[a.dtype],l,d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.top,d.padInfo.left),[c,h]}},b$={kernelName:Fn,backendName:"wasm",setupFunc:function(e){OO=e.wasm.cwrap(Fn,null,["number, number, number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=o,u=s,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=GD(s,a,t),m=c;if(p){let e=t.dataIdMap.get(d.dataId).id;e!==o&&(u=d,l=e,m=$m.getInnerMostAxes(m.length,u.shape.length))}$m.assertAxesAreInnerMostDims("mean",m,u.shape.length);let[f,g]=$m.computeOutAndReduceShapes(u.shape,m),y=Sa.sizeFromShape(g),b=u;"float32"!==u.dtype&&(b=kM({backend:t,inputs:{x:u},attrs:{dtype:"float32"}}),l=t.dataIdMap.get(b.dataId).id);let x=t.makeOutput(f,"float32");if(0!==Sa.sizeFromShape(u.shape)){let e=t.dataIdMap.get(x.dataId).id;OO(l,y,e)}if(p&&t.disposeData(d.dataId),i){let e=$m.expandShapeToKeepDim(x.shape,h);x.shape=e}return"float32"!==u.dtype&&t.disposeData(b.dataId),x}},x$={kernelName:Ln,backendName:"wasm",setupFunc:function(e){$O=e.wasm.cwrap(Ln,null,["number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=o,u=s,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=GD(s,a,t);if(p){let e=t.dataIdMap.get(d.dataId).id;e!==o&&(u=d,l=e)}let m=u.shape.length;$m.assertAxesAreInnerMostDims("min",c,m);let[f,g]=$m.computeOutAndReduceShapes(u.shape,c),y=Sa.sizeFromShape(g),b=t.makeOutput(f,u.dtype);if(0!==Sa.sizeFromShape(u.shape)){let e=t.dataIdMap.get(b.dataId).id;$O(l,wD[s.dtype],y,e)}if(p&&t.disposeData(d.dataId),i){let e=$m.expandShapeToKeepDim(b.shape,h);b.shape=e}return b}},A$=$D(zn);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(FO||(FO={}));var v$,w$={kernelName:Bn,backendName:"wasm",kernelFunc:function(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,mode:a}}=e,i=r.map(((e,n)=>e[0]+t.shape[n]+e[1])),s=n.dataIdMap.get(t.dataId).id,o=n.makeOutput(i,t.dtype),l=n.dataIdMap.get(o.dataId).id,u=new Uint8Array(new Int32Array(t.shape).buffer),d=r.map((e=>e[0])),c=r.map((e=>e[1])),h=new Uint8Array(new Int32Array(d).buffer),p=new Uint8Array(new Int32Array(c).buffer);return LO(s,u,t.shape.length,wD[t.dtype],h,p,FO[a],l),o},setupFunc:function(e){LO=e.wasm.cwrap(Bn,null,["number","array","number","number","array","array","number","number"])}};function k$(e){let{backend:t,inputs:{logits:n},attrs:{dim:r}}=e,a=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(i.dataId).id,o=n.shape[r],l=Sa.sizeFromShape(n.shape)/o;return 0===Sa.sizeFromShape(i.shape)||v$(a,s,o,l),i}var S$,T$,_$={kernelName:Mr,backendName:"wasm",setupFunc:function(e){v$=e.wasm.cwrap(Mr,null,["number","number","number","number"])},kernelFunc:k$},I$={kernelName:Wn,backendName:"wasm",setupFunc:function(e){S$=e.wasm.cwrap(Wn,null,["number","number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r;if("float32"!==a.dtype)throw new Error(`Tensor logits must have dtype float32, got ${a.dtype}`);let l=o?a:k$({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),[u,d]=l.shape,c=n.makeOutput([u,i],"int32");return S$(n.dataIdMap.get(l.dataId).id,u,d,i,s,n.dataIdMap.get(c.dataId).id),o||n.disposeData(l.dataId),c}},C$=$D(Un),E$=$D(Vn),N$=PD(jn);function R$(e,t){let n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],i=n[2],s=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:i,pValidOutputs:s}}var P$,D$,M$,O$,$$,F$,L$,z$,B$,U$,W$,V$,j$,H$,G$,q$,X$,K$,Z$,Y$={kernelName:Gn,backendName:"wasm",setupFunc:function(e){T$=e.wasm.cwrap(Gn,"number",["number","number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:i,scoreThreshold:s}=r,{boxes:o,scores:l}=n,u=t.dataIdMap.get(o.dataId).id,d=t.dataIdMap.get(l.dataId).id,c=T$(u,d,i,a,s),{pSelectedIndices:h,selectedSize:p,pSelectedScores:m,pValidOutputs:f}=R$(t,c);return t.wasm._free(m),t.wasm._free(f),t.makeOutput([p],"int32",h)}},J$={kernelName:qn,backendName:"wasm",setupFunc:function(e){P$=e.wasm.cwrap(qn,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:i,scoreThreshold:s,padToMaxOutputSize:o}=r,{boxes:l,scores:u}=n,d=t.dataIdMap.get(l.dataId).id,c=t.dataIdMap.get(u.dataId).id,h=P$(d,c,i,a,s,o),{pSelectedIndices:p,selectedSize:m,pSelectedScores:f,pValidOutputs:g}=R$(t,h);return t.wasm._free(f),[t.makeOutput([m],"int32",p),t.makeOutput([],"int32",g)]}},Q$={kernelName:Xn,backendName:"wasm",setupFunc:function(e){D$=e.wasm.cwrap(Xn,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:i,scoreThreshold:s,softNmsSigma:o}=r,{boxes:l,scores:u}=n,d=t.dataIdMap.get(l.dataId).id,c=t.dataIdMap.get(u.dataId).id,h=D$(d,c,i,a,s,o),{pSelectedIndices:p,selectedSize:m,pSelectedScores:f,pValidOutputs:g}=R$(t,h);return t.wasm._free(g),[t.makeOutput([m],"int32",p),t.makeOutput([m],"float32",f)]}},eF=$D(Hn,0,"bool"),tF={kernelName:Zn,backendName:"wasm",setupFunc:function(e){M$=e.wasm.cwrap(Zn,null,["number","number","number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r,u=n.makeOutput([...a.shape,s],i),d=n.dataIdMap.get(u.dataId).id,c=n.dataIdMap.get(a.dataId).id;return M$(c,s,o,l,d),u}},nF={kernelName:Kn,backendName:"wasm",kernelFunc:function(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}},rF={kernelName:Yn,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return fO({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let i=t[0].shape,s=t[0].dtype;t.forEach((e=>{Sa.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),Sa.assert(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));let o=[],l=CM({inputs:t.map((e=>{let t=fO({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t})),backend:n,attrs:{axis:a}});return o.forEach((e=>n.disposeData(e.dataId))),l}},aF={kernelName:Jn,backendName:"wasm",kernelFunc:function(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,constantValue:a}}=e,i=r.map(((e,n)=>e[0]+t.shape[n]+e[1]));if(0===Sa.sizeFromShape(t.shape))return bO({backend:n,attrs:{shape:i,value:a,dtype:t.dtype}});let s=n.dataIdMap.get(t.dataId).id,o=n.makeOutput(i,t.dtype),l=n.dataIdMap.get(o.dataId).id,u=new Uint8Array(new Int32Array(t.shape).buffer),d=r.map((e=>e[0])),c=r.map((e=>e[1])),h=new Uint8Array(new Int32Array(d).buffer),p=new Uint8Array(new Int32Array(c).buffer);return O$(s,u,t.shape.length,wD[t.dtype],h,p,a,l),o},setupFunc:function(e){O$=e.wasm.cwrap(Jn,null,["number","array","number","number","array","array","number","number"])}},iF=$D(er),sF={kernelName:tr,backendName:"wasm",setupFunc:function(e){$$=e.wasm.cwrap(tr,null,["number","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,o=i,l=r,u=l;"float32"!==l.dtype&&(u=kM({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),o=n.dataIdMap.get(u.dataId).id);let d=n.makeOutput(r.shape,"float32"),c=n.dataIdMap.get(d.dataId).id;return $$(o,s,c),"float32"!==l.dtype&&n.disposeData(u.dataId),d}},oF={kernelName:nr,backendName:"wasm",setupFunc:function(e){F$=e.wasm.cwrap(nr,null,["number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=o,u=s,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=GD(s,a,t),m=c;if(p){let e=t.dataIdMap.get(d.dataId).id;e!==o&&(u=d,l=e,m=$m.getInnerMostAxes(m.length,u.shape.length))}$m.assertAxesAreInnerMostDims("prod",m,u.shape.length);let[f,g]=$m.computeOutAndReduceShapes(u.shape,m),y=Sa.sizeFromShape(g),b=t.makeOutput(f,u.dtype);if(0!==Sa.sizeFromShape(u.shape)){let e=t.dataIdMap.get(b.dataId).id;F$(l,y,wD[b.dtype],e)}if(p&&t.disposeData(d.dataId),i){let e=$m.expandShapeToKeepDim(b.shape,h);b.shape=e}return b}},lF={kernelName:sr,backendName:"wasm",kernelFunc:e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:s}=n,o=Ax(r,a,i,s),l=t.makeOutput([o.length],s);return t.typedArrayFromHeap(l).set(o),l}},uF=$D(Vt),dF=PD(lr),cF=PD(ur),hF=PD(fr),pF={kernelName:pr,backendName:"wasm",setupFunc:function(e){L$=e.wasm.cwrap(pr,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let t,{backend:n,inputs:r,attrs:a}=e,{images:i}=r,{alignCorners:s,halfPixelCenters:o,size:l}=a,[u,d]=l,[c,h,p,m]=i.shape,f=[c,u,d,m],g=n.dataIdMap.get(i.dataId);"float32"!==g.dtype&&(t=kM({backend:n,inputs:{x:i},attrs:{dtype:"float32"}}),g=n.dataIdMap.get(t.dataId));let y=g.id,b=n.makeOutput(f,"float32");if(0===Sa.sizeFromShape(i.shape))return b;let x=n.dataIdMap.get(b.dataId).id;return L$(y,c,h,p,m,u,d,s?1:0,o?1:0,x),null!=t&&n.disposeData(t.dataId),b}},mF={kernelName:mr,backendName:"wasm",setupFunc:function(e){z$=e.wasm.cwrap(mr,null,["number","number","number","array","array","boolean"])},kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{images:i,dy:s}=n,{alignCorners:o}=a,l=r.makeOutput(i.shape,"float32"),u=r.dataIdMap.get(i.dataId);return"float32"!==u.dtype&&(t=kM({backend:r,inputs:{x:i},attrs:{dtype:"float32"}}),u=r.dataIdMap.get(t.dataId)),z$(r.dataIdMap.get(i.dataId).id,r.dataIdMap.get(s.dataId).id,r.dataIdMap.get(l.dataId).id,new Uint8Array(new Int32Array(i.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),o),null!=t&&r.disposeData(t.dataId),l}},fF={kernelName:cr,backendName:"wasm",setupFunc:function(e){B$=e.wasm.cwrap(cr,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,u]=o,[d,c,h,p]=a.shape,m=[d,l,u,p],f=t.makeOutput(m,"float32");if(0===Sa.sizeFromShape(a.shape))return f;let g,y=t.dataIdMap.get(a.dataId);"float32"!==y.dtype&&(g=kM({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),y=t.dataIdMap.get(g.dataId));let b=y.id,x=t.dataIdMap.get(f.dataId).id;return B$(b,d,c,h,p,l,u,i?1:0,s?1:0,x),null!=g&&t.disposeData(g.dataId),f}},gF={kernelName:hr,backendName:"wasm",setupFunc:function(e){U$=e.wasm.cwrap(hr,null,["number","number","number","array","array","boolean"])},kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{images:i,dy:s}=n,{alignCorners:o}=a,l=r.makeOutput(i.shape,"float32"),u=r.dataIdMap.get(i.dataId);return"float32"!==u.dtype&&(t=kM({backend:r,inputs:{x:i},attrs:{dtype:"float32"}}),u=r.dataIdMap.get(t.dataId)),U$(r.dataIdMap.get(i.dataId).id,r.dataIdMap.get(s.dataId).id,r.dataIdMap.get(l.dataId).id,new Uint8Array(new Int32Array(i.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),o),null!=t&&r.disposeData(t.dataId),l}},yF={kernelName:gr,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,s=Sa.parseAxisParam(i,a.shape);if(0===a.shape.length)return BD({inputs:{x:a},backend:n});let o=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(o.dataId).id,d=new Uint8Array(new Int32Array(s).buffer),c=new Uint8Array(new Int32Array(a.shape).buffer);W$(l,d,s.length,c,a.shape.length,u);let h=hM({inputs:{x:o},attrs:{shape:a.shape},backend:n});return n.disposeData(o.dataId),h},setupFunc:function(e){W$=e.wasm.cwrap(gr,null,["number","array","number","array","number","number"])}},bF={kernelName:oa,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{radians:i,fillValue:s,center:o}=r,l=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(l.dataId).id,[c,h,p,m]=a.shape,[f,g]=$m.getImageCenter(o,h,p),y="number"==typeof s?[s,s,s,0===s?0:255]:[...s,255],b=new Uint8Array(new Int32Array(y).buffer);return V$(u,c,h,p,m,i,f,g,b,y.length,d),l},setupFunc:function(e){V$=e.wasm.cwrap(oa,null,["number","number","number","number","number","number","number","number","array","number","number"])}},xF=PD(yr),AF=PD(br),vF={kernelName:xr,backendName:"wasm",setupFunc:function(e){j$=e.wasm.cwrap(xr,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{indices:a,updates:i}=n,{shape:s}=r,o=t.makeOutput(s,i.dtype);if(0===Sa.sizeFromShape(s))return o;let{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=$c.calculateShapes(i,a,s),p=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,f=new Uint8Array(new Int32Array(c).buffer),g=t.dataIdMap.get(o.dataId).id;return j$(p,m,wD[i.dtype],l,u,d,f,h,g),o}},wF={kernelName:vr,backendName:"wasm",setupFunc:function(e){H$=e.wasm.cwrap(vr,null,["number","number","number","number","number","number","bool","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r;if(a.dtype!==i.dtype)throw new Error(`SearchSorted error: sorted_sequence must have the same dtype as values. Got ${a.dtype} and ${i.dtype}`);let o=n.makeOutput(i.shape,"int32");function l(e){return n.dataIdMap.get(e.dataId).id}return H$(l(a),l(i),a.shape[0],a.shape[1],i.shape[1],wD[a.dtype],"left"===s,l(o)),o}},kF={kernelName:wr,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,s=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(i.dataId).id,u=n.makeOutput(a.shape,a.dtype),d=n.dataIdMap.get(u.dataId).id,c=r.shape.length,h=a.shape.length,p=0===c||c>1||1===h?1:Sa.sizeFromShape(a.shape.slice(1));return G$(s,o,l,p,d),u},setupFunc:function(e){G$=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},SF=PD(kr),TF={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){q$=e.wasm.cwrap(Cr,null,["number","number"])},kernelFunc:function(e){let{backend:t,inputs:{x:n}}=e,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(a.dataId).id;return 0===Sa.sizeFromShape(a.shape)||q$(r,i),a}},_F=PD(Ir),IF=PD(Tr),CF=PD(_r),EF=PD(Er),NF={kernelName:Pr,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r,o=Sa.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let e=1+i.length;e<a.shape.length;++e)l.push([0,0]);let u=aF.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),d=$m.getReshaped(u.shape,i,o,!1),c=$m.getPermuted(d.length,i.length,!1),h=$m.getReshapedPermuted(u.shape,i,o,!1),p=hM({inputs:{x:u},backend:n,attrs:{shape:d}}),m=VD({inputs:{x:p},backend:n,attrs:{perm:c}}),f=hM({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeData(u.dataId),n.disposeData(p.dataId),n.disposeData(m.dataId),f}},RF={kernelName:Or,backendName:"wasm",setupFunc:function(e){X$=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){let t,{backend:n,inputs:r}=e,{indices:a,values:i,denseShape:s,defaultValue:o}=r,l=a.shape[0],u=a.shape[1],d=n.readSync(s.dataId)[0],c=[l+d,u],h=n.dataIdMap.get(a.dataId).id,p=n.dataIdMap.get(i.dataId).id,m=n.dataIdMap.get(o.dataId).id,f=n.makeOutput(c,a.dtype),g=n.dataIdMap.get(f.dataId).id,y=n.makeOutput(c.slice(0,1),i.dtype),b=n.dataIdMap.get(y.dataId).id,x=n.makeOutput([d],"bool"),A=n.dataIdMap.get(x.dataId).id,v=n.makeOutput([l],a.dtype),w=n.dataIdMap.get(v.dataId).id,k=n.makeOutput([4],"int32"),S=n.dataIdMap.get(k.dataId).id,T=X$(h,p,wD[i.dtype],l,d,u,m,g,b,A,w,S),_=n.readSync(k.dataId);switch(_[0]){case 1:t=$m.getSparseFillEmptyRowsIndicesDenseShapeMismatch(_[1]);break;case 2:t=$m.getSparseFillEmptyRowsNegativeIndexErrorMessage(_[1],_[2]);break;case 3:t=$m.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(_[1],_[2],_[3]);break;default:t=""}if(n.disposeData(k.dataId),t)throw n.disposeData(f.dataId),n.disposeData(y.dataId),n.disposeData(x.dataId),n.disposeData(v.dataId),new Error(t);let I=f,C=y;return T!==c[0]&&(I=gM({inputs:{x:f},attrs:{begin:0,size:[T,u]},backend:n}),C=gM({inputs:{x:y},attrs:{begin:0,size:T},backend:n}),n.disposeData(f.dataId),n.disposeData(y.dataId)),[I,C,x,v]}},PF={kernelName:$r,backendName:"wasm",setupFunc:function(e){K$=e.wasm.cwrap($r,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n}=e,{inputIndices:r,inputShape:a,newShape:i}=n;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==a.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${a.shape}`);if(1!==i.shape.length)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=t.dataIdMap.get(r.dataId).id,o=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(i.dataId).id,u=r.shape[0],d=Sa.sizeFromShape(i.shape),c=t.makeOutput([u,d],r.dtype),h=t.dataIdMap.get(c.dataId).id,p=t.makeOutput([d],i.dtype),m=t.dataIdMap.get(p.dataId).id,f=t.makeOutput([3],"int32"),g=t.dataIdMap.get(f.dataId).id;K$(s,o,l,u,h,m,g);let y,b=t.readSync(f.dataId);switch(b[0]){case 0:y=$m.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(b[1],b[2]);break;case 1:y=$m.getSparseReshapeNegativeOutputDimErrorMessage(b[1],b[2]);break;case 2:y=$m.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:{let e=Array.from(t.readSync(a.dataId)),n=Array.from(t.readSync(p.dataId));y=$m.getSparseReshapeInputOutputMultipleErrorMessage(e,n);break}case 4:{let e=Array.from(t.readSync(a.dataId)),n=Array.from(t.readSync(p.dataId));y=$m.getSparseReshapeInputOutputMismatchErrorMessage(e,n);break}default:y=""}if(t.disposeData(f.dataId),y)throw t.disposeData(c.dataId),t.disposeData(p.dataId),new Error(y);return[c,p]}};function DF(e){Z$=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function MF(e,t){let{backend:n,inputs:r}=e,{data:a,indices:i,segmentIds:s}=r,o=i.shape[0],l=n.readSync(s.dataId,o-1,o)[0],u=o>0?l+1:0;if(u<0)throw new Error($m.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let d=a.shape.slice();d[0]=u;let c=n.dataIdMap.get(a.dataId).id,h=n.dataIdMap.get(i.dataId).id,p=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(d,a.dtype),f=n.dataIdMap.get(m.dataId).id,g=n.makeOutput([4],"int32"),y=n.dataIdMap.get(g.dataId).id;Z$(c,wD[a.dtype],a.shape[0],h,p,f,y,t,0);let b,x=n.readSync(g.dataId);switch(x[0]){case 0:b=$m.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break;case 1:b=$m.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break;case 2:b=$m.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(x[1],x[2]);break;case 3:b=$m.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(x[1],x[2],x[3]);break;default:b=""}if(n.disposeData(g.dataId),b)throw n.disposeData(m.dataId),new Error(b);return m}var OF,$F,FF,LF,zF,BF,UF,WF,VF={kernelName:Fr,backendName:"wasm",setupFunc:DF,kernelFunc:function(e){return MF(e,!0)}},jF={kernelName:Lr,backendName:"wasm",setupFunc:DF,kernelFunc:function(e){return MF(e,!1)}},HF={kernelName:zr,backendName:"wasm",setupFunc:function(e){OF=e.wasm.cwrap(zr,null,["number","number","number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=n,{outputShape:o}=r,l=t.makeOutput(o,s.dtype);if(0===Sa.sizeFromShape(o))return l;let{sliceRank:u,numUpdates:d,sliceSize:c,strides:h,outputSize:p}=$m.calculateShapes(i,a,o),m=t.dataIdMap.get(a.dataId).id,f=t.dataIdMap.get(i.dataId).id,g=t.dataIdMap.get(s.dataId).id,y=new Uint8Array(new Int32Array(h).buffer),b=t.dataIdMap.get(l.dataId).id;return OF(m,f,i.shape.length,g,wD[s.dtype],u,d,c,y,p,b),l}},GF={kernelName:Dr,backendName:"wasm",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=n,o=Sa.parseAxisParam(s,a.shape)[0],l=$m.prepareSplitSize(a,i,o),u=new Array(a.shape.length).fill(0),d=a.shape.slice();return l.map((e=>{let t=[...d];t[o]=e;let n=gM({inputs:{x:a},attrs:{begin:u,size:t},backend:r});return u[o]+=e,n}))}},qF=PD(Nr),XF=PD(Ur),KF=$D(Br),ZF={kernelName:ia,backendName:"wasm",setupFunc:function(e){$F=e.wasm.cwrap(ia,null,["number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{alpha:a}=r,{x:i}=n,s=t.dataIdMap.get(i.dataId).id,o=t.makeOutput(i.shape,i.dtype),l=t.dataIdMap.get(o.dataId).id;return $F(s,a,wD[i.dtype],l),o}},YF={kernelName:Vr,backendName:"wasm",setupFunc:function(e){FF=e.wasm.cwrap(Vr,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){let t,{backend:n,inputs:r,attrs:a}=e,{x:i}=r,{begin:s,end:o,strides:l,beginMask:u,endMask:d,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=a,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:x,end:A,strides:v}=dm.sliceInfo(i.shape,s,o,l,u,d,c,h,p);if(g)t=hM({inputs:{x:i},backend:n,attrs:{shape:f}});else if(y||b){Sa.assert(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));let e=dm.computeOutShape(x,A,v),r=gM({inputs:{x:i},backend:n,attrs:{begin:x,size:e}});t=hM({inputs:{x:r},backend:n,attrs:{shape:f}}),n.disposeData(r.dataId)}else{let e=n.makeOutput(m,"float32"),r=n.dataIdMap.get(i.dataId).id,a=new Uint8Array(new Int32Array(Sa.computeStrides(i.shape)).buffer),s=new Uint8Array(new Int32Array(x).buffer),o=new Uint8Array(new Int32Array(A).buffer),l=new Uint8Array(new Int32Array(v).buffer),u=new Uint8Array(new Int32Array(m).buffer),d=new Uint8Array(new Int32Array(Sa.computeStrides(m)).buffer),c=n.dataIdMap.get(e.dataId).id;FF(r,a,i.shape.length,s,o,l,u,d,m.length,c),t=hM({inputs:{x:e},backend:n,attrs:{shape:f}}),n.disposeData(e.dataId)}return t}},JF={kernelName:jr,backendName:"wasm",kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{data:a,dataSplits:i}=n,{separator:s,nGramWidths:o,leftPad:l,rightPad:u,padWidth:d,preserveShortSequences:c}=r,h=t.readSync(a.dataId),p=t.readSync(i.dataId),[m,f]=Hx(h,p,s,o,l,u,d,c),g=t.makeOutput([m.length],"string");t.dataIdMap.get(g.dataId).stringBytes=m;let y=t.makeOutput(i.shape,"int32");return t.typedArrayFromHeap(y).set(f),[g,y]}},QF={kernelName:Hr,backendName:"wasm",kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{input:a,delimiter:i}=n,{skipEmpty:s}=r,o=t.readSync(a.dataId),l=t.readSync(i.dataId),[u,d,c]=qx(o,l[0],s),h=d.length,p=t.makeOutput([h,2],"int32");t.typedArrayFromHeap(p).set(u);let m=t.makeOutput([h],"string");t.dataIdMap.get(m.dataId).stringBytes=d;let f=t.makeOutput([2],"int32");return t.typedArrayFromHeap(f).set(c),[p,m,f]}},eL={kernelName:Gr,backendName:"wasm",kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{input:a}=n,{numBuckets:i}=r,s=Xx(t.readSync(a.dataId),i),o=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(o).set(s),o}},tL=$D(qr),nL={kernelName:Rr,backendName:"wasm",setupFunc:function(e){LF=e.wasm.cwrap(Rr,null,["number","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:i}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=o,u=s,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=GD(s,a,t),m=c;if(p){let e=t.dataIdMap.get(d.dataId).id;e!==o&&(u=d,l=e,m=$m.getInnerMostAxes(m.length,u.shape.length))}$m.assertAxesAreInnerMostDims("sum",m,u.shape.length);let[f,g]=$m.computeOutAndReduceShapes(u.shape,m),y=Sa.sizeFromShape(g),b=t.makeOutput(f,u.dtype);if(0!==Sa.sizeFromShape(u.shape)){let e=t.dataIdMap.get(b.dataId).id;LF(l,y,wD[b.dtype],e)}if(p&&t.disposeData(d.dataId),i){let e=$m.expandShapeToKeepDim(b.shape,h);b.shape=e}return b}},rL=PD(Xr),aL=PD(Kr),iL={kernelName:Ar,backendName:"wasm",setupFunc:function(e){zF=e.wasm.cwrap(Ar,null,["number","number","number","number","number","number","array","number","number","number"])},kernelFunc:function(e){let{backend:t,inputs:n,attrs:r}=e,{tensor:a,indices:i,updates:s}=n,{}=r,o=t.makeOutput(a.shape,a.dtype);if(0===Sa.sizeFromShape(a.shape))return o;let{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=$c.calculateShapes(s,i,a.shape),p=t.dataIdMap.get(i.dataId).id,m=t.dataIdMap.get(s.dataId).id,f=t.dataIdMap.get(a.dataId).id,g=new Uint8Array(new Int32Array(c).buffer),y=t.dataIdMap.get(o.dataId).id;return zF(p,m,wD[s.dtype],l,u,d,g,h,y,f),o}},sL={kernelName:Zr,backendName:"wasm",setupFunc:function(e){BF=e.wasm.cwrap(Zr,null,["number","array","number","array","number","number"])},kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,i=n.dataIdMap.get(a.dataId).id,{reps:s}=r,o=new Array(a.shape.length);for(let e=0;e<o.length;e++)o[e]=a.shape[e]*s[e];let l=new Uint8Array(new Int32Array(a.shape).buffer),u=new Uint8Array(new Int32Array(o).buffer),d=n.makeOutput(o,a.dtype),c=n.dataIdMap.get(d.dataId).id;return BF(i,l,a.shape.length,u,o.length,wD[d.dtype],c),d}},oL={kernelName:Yr,backendName:"wasm",setupFunc:function(e){UF=e.wasm.cwrap(Yr,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{k:a,sorted:i}=n,s=t.dataIdMap.get(r.dataId).id,o=new Uint8Array(new Int32Array(r.shape).buffer),l=r.shape.slice();l[l.length-1]=a;let u=t.makeOutput(l,r.dtype),d=t.dataIdMap.get(u.dataId).id,c=t.makeOutput(l,"int32"),h=t.dataIdMap.get(c.dataId).id;return UF(s,o,r.shape.length,wD[r.dtype],a,i,d,h),[u,c]}},lL={kernelName:Jr,backendName:"wasm",setupFunc:function(e){WF=e.wasm.cwrap(Jr,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])},kernelFunc:function(e){let t,{backend:n,inputs:r,attrs:a}=e,{image:i,transforms:s}=r,{interpolation:o,fillMode:l,fillValue:u,outputShape:d}=a,[c,h,p,m]=i.shape,[f,g]=null!=d?d:[h,p],y=[c,f,g,m],b=new Uint8Array(new Int32Array(Sa.computeStrides(i.shape)).buffer),x=new Uint8Array(new Int32Array(Sa.computeStrides(y)).buffer),A=n.makeOutput(y,i.dtype),v=n.dataIdMap.get(A.dataId).id,w=n.dataIdMap.get(i.dataId).id,k=n.dataIdMap.get(s.dataId).id,S="nearest"===o?1:2;switch(l){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}return WF(w,k,s.shape[0]>1,c,f,g,m,p,h,b,i.shape.length-1,x,y.length-1,S,t,u,v),A}},uL={kernelName:ea,backendName:"wasm",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t,{outputValues:s,outputShape:o,indices:l}=rA(r.readSync(i.dataId),a,i.shape,i.dtype);return[r.makeOutput(o,i.dtype,void 0,s),r.makeOutput([l.length],"int32",void 0,l)]}},dL={kernelName:ta,backendName:"wasm",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:i}=r;i<0&&(i+=a.shape.length);let s=a.shape[i],o=a.shape.length,l=new Array(o-1),u=0;for(let e=0;e<o;e++)e!==i&&(l[u++]=a.shape[e]);let d=new Array(s),c=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(let e=0;e<d.length;e++)c[i]=e,d[e]=gM({inputs:{x:a},attrs:{begin:c,size:h},backend:n});return d.map((({dataId:e,dtype:t})=>({dataId:e,dtype:t,shape:l})))}},cL={kernelName:aa,backendName:"wasm",kernelFunc:function(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}},hL=[RD,DD,MD,OD,LD,zD,XD,KD,tM,nM,rM,aM,iM,sM,oM,lM,cM,uM,dM,fM,xM,AM,vM,wM,TM,_M,IM,$M,FM,LM,zM,BM,UM,WM,VM,eO,tO,nO,rO,aO,iO,sO,oO,lO,uO,dO,cO,hO,pO,mO,gO,yO,zO,BO,UO,WO,VO,jO,HO,GO,qO,XO,KO,WD,ZO,YO,JO,QO,e$,t$,n$,a$,r$,i$,s$,o$,l$,u$,d$,c$,h$,p$,m$,f$,g$,y$,b$,x$,A$,w$,I$,C$,E$,N$,Y$,J$,Q$,eF,tF,nF,rF,aF,iF,sF,oF,lF,uF,dF,cF,hF,mM,pF,mF,fF,gF,yF,bF,xF,AF,vF,wF,kF,SF,TF,_F,IF,CF,bM,_$,EF,NF,RF,PF,VF,jF,HF,GF,qF,XF,KF,ZF,YF,JF,QF,eL,tL,nL,rL,aL,iL,sL,oL,lL,HD,uL,dL,cL];for(let e of hL)ba(e);var pL=Ue();pL.registerFlag("WASM_HAS_SIMD_SUPPORT",(async()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))}catch(e){return!1}})),pL.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",(async()=>{if(pL.get("IS_NODE"))return!1;try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}}));var mL=A(L()),fL=A(z()),gL=A(B()),yL=mL.default||mL,bL=gL.default||gL,xL=class extends W{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.initWithThreadsCount(EL),NL=this.wasm.tfjs.getThreadsCount(),this.dataIdMap=new U(this,Ys())}write(e,t,n){let r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){let t=Sa.now();return e(),{kernelMs:Sa.now()-t}}move(e,t,n,r,a){let i=this.dataIdNextNumber++;if("string"===r){let s=t;return void this.dataIdMap.set(e,{id:i,stringBytes:s,shape:n,dtype:r,memoryOffset:null,refCount:a})}let s=Sa.sizeFromShape(n),o=s*Sa.bytesPerElement(r),l=this.wasm._malloc(o)>>>0;this.dataIdMap.set(e,{id:i,memoryOffset:l,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(i,s,l),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,o),l)}async read(e){return this.readSync(e)}readSync(e,t,n){let{memoryOffset:r,dtype:a,shape:i,stringBytes:s}=this.dataIdMap.get(e);if("string"===a)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Sa.sizeFromShape(i);let o=Sa.bytesPerElement(a);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error(`Unknown dtype ${t}`)}}(this.wasm.HEAPU8.slice(r+t*o,r+n*o).buffer,a)}disposeData(e,t=!1){if(this.dataIdMap.has(e)){let n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}refCount(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}incRef(e){let t=this.dataIdMap.get(e);null!=t&&t.refCount++}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n,r){let a;if(null==n)a=this.write(null!=r?r:null,e,t);else{let r=this.dataIdNextNumber++;a={id:r},this.dataIdMap.set(a,{id:r,memoryOffset:n,shape:e,dtype:t,refCount:1});let i=Sa.sizeFromShape(e);this.wasm.tfjs.registerTensor(r,i,n)}return{dataId:a,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){let r=this.wasm.HEAPU8.buffer,{memoryOffset:a}=this.dataIdMap.get(n),i=Sa.sizeFromShape(e);switch(t){case"float32":return new Float32Array(r,a,i);case"int32":return new Int32Array(r,a,i);case"bool":return new Uint8Array(r,a,i);default:throw new Error(`Unknown dtype ${t}`)}}};function AL(e,t,n){if(null!=wL)return wL;let r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=SL&&null!=SL[r]?SL[r]:n+r}var vL=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],wL=null,kL=null,SL={},TL=!1,_L=!1;function IL(e,t=!1){if(Ks("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),TL)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");wL=e,_L=t}function CL(e,t=!1){if(TL)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)kL=e;else{SL=e;let t=vL.filter((e=>null==SL[e]));if(t.length>0)throw new Error(`There were no entries found for the following binaries: ${t.join(",")}. Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found.`)}_L=t}var EL=-1,NL=-1;function RL(e){EL=e}function PL(){if(-1===NL)throw new Error("WASM backend not initialized.");return NL}var DL="4.7.0";co("wasm",(async()=>{let{wasm:e}=await async function(){let[e,t]=await Promise.all([Ue().getAsync("WASM_HAS_SIMD_SUPPORT"),Ue().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise(((n,r)=>{let a={locateFile:(n,r)=>{if(n.endsWith(".worker.js")){let e=fL.wasmWorkerContents.replace(/\n/g,"\\n"),t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}return n.endsWith(".wasm")?AL(e,t,null!=kL?kL:r):r+n}};_L&&(a.instantiateWasm=function(e){return(t,n)=>(Sa.fetch(e,{credentials:"same-origin"}).then((r=>{r.ok||t.env.a(`failed to load wasm binary file at '${e}'`),r.arrayBuffer().then((e=>{WebAssembly.instantiate(e,t).then((e=>{n(e.instance,e.module)}))}))})),{})}(AL(e,t,null!=kL?kL:"")));let i,s=!1;a.onAbort=()=>{s||TL||(TL=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},t&&e&&null==wL?(a.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+yL.toString()],{type:"text/javascript"}),i=yL(a)):i=bL(a),i.then((e=>{s=!0,TL=!1,e.tfjs={init:e.cwrap("init",null,[]),initWithThreadsCount:e.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:e.cwrap("get_threads_count","number",[]),registerTensor:e.cwrap("register_tensor",null,["number","number","number"]),disposeData:e.cwrap("dispose_data",null,["number"]),dispose:e.cwrap("dispose",null,[])},n({wasm:e})})).catch(r)}))}();return new xL(e)}),2);var ML=Ue();function OL(e,t){return`${e}_${t}`}function $L(e,t,n,r){return`${e}_${t}_${n}_${r}`}function FL(e){if("rgba8unorm"===e)return 16;throw new Error(`${e} is not supported!`)}function LL(e,t){if(Math.max(...e)>5)throw new Error("Cannot symbolically compute strides for rank > 6 tensor.");let n=e.length,r=e.map((e=>`${t}.${"xyzwuv"[e]}`)),a=new Array(n-1);a[n-2]=r[n-1];for(let e=n-3;e>=0;--e)a[e]=`(${a[e+1]} * ${r[e+1]})`;return a}ML.registerFlag("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE",(()=>15)),ML.registerFlag("WEBGPU_CPU_FORWARD",(()=>!0)),ML.registerFlag("WEBGPU_MATMUL_PROGRAM_TYPE",(()=>-1)),ML.registerFlag("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE",(()=>!0)),ML.registerFlag("WEBGPU_USE_LOW_POWER_GPU",(()=>!1)),ML.registerFlag("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e3)),ML.registerFlag("WEBGPU_USE_PROFILE_TOOL",(()=>!1)),ML.registerFlag("WEBGPU_IMPORT_EXTERNAL_TEXTURE",(()=>!0)),ML.registerFlag("WEBGPU_USE_NAIVE_CONV2D_DEBUG",(()=>!1)),ML.registerFlag("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL",(()=>0)),ML.registerFlag("WEBGPU_CONV_SEPARATE_IM2COL_SHADER",(()=>!1)),ML.registerFlag("WEBGPU_PRINT_SHADER",(()=>"")),ML.registerFlag("WEBGPU_ENGINE_COMPILE_ONLY",(()=>!1));var zL=(e,t,n)=>"int32"===n?`atomicAdd(${e}, bitcast<i32>(${t}));`:`\n          {\n            var oldValue = 0;\n            loop {\n              let newValueF32 = bitcast<f32>(oldValue) + (${t});\n              let newValue = bitcast<i32>(newValueF32);\n              let res = atomicCompareExchangeWeak(${e}, oldValue, newValue);\n              if res.exchanged {\n                break;\n              }\n              oldValue = res.old_value;\n            }\n          }`,BL=(e,t="f32")=>{switch(e){case 1:return`${t}`;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component ${t} is not supported.`)}};function UL(e){if(e<=1)return"i32";if(2===e)return"vec2<i32>";if(3===e)return"vec3<i32>";if(4===e)return"vec4<i32>";if(5===e)return"vec5";if(6===e)return"vec6";throw Error(`GPU for rank ${e} is not yet supported`)}function WL(e){if(0===e)return"x";if(1===e)return"y";if(2===e)return"z";if(3===e)return"w";if(4===e)return"u";if(5===e)return"v";throw Error(`Index ${e} is not yet supported`)}function VL(...e){let t;switch(e.length){case 0:t="\n        fn main()\n      ";break;case 1:t=`\n        fn main(${e[0]} : i32)\n      `;break;default:throw Error("Unreachable")}return t}function jL(e,t){let n;return n=`\n     ${function(e){return`\n  @compute @workgroup_size(${e.workgroupSize[0]}, ${e.workgroupSize[1]}, ${e.workgroupSize[2]})\n`}(t)}\n      fn _start(@builtin(local_invocation_id) LocalId : vec3<u32>,\n                @builtin(global_invocation_id) GlobalId : vec3<u32>,\n                @builtin(local_invocation_index) LocalIndex: u32,\n                @builtin(workgroup_id) WorkgroupId : vec3<u32>,\n                @builtin(num_workgroups) NumWorkgroups : vec3<u32>) {\n        localId = LocalId;\n        localIndex = LocalIndex;\n        globalId = GlobalId;\n        numWorkgroups = NumWorkgroups;\n        workgroupId = WorkgroupId;\n        ${e?"main(getGlobalIndex());":"main();"};\n      }\n    `,n}var HL="\n  struct vec5 {x: i32, y: i32, z: i32, w: i32, u: i32};\n  struct vec6 {x: i32, y: i32, z: i32, w: i32, u: i32, v: i32};\n\n  // Checks whether coordinates lie within the bounds of the shape.\n  fn coordsInBounds2D(coord : vec2<i32>, shape : vec2<i32>) -> bool {\n    return all(coord >= vec2<i32>(0)) && all(coord < shape);\n  }\n  fn coordsInBounds3D(coord : vec3<i32>, shape : vec3<i32>) -> bool {\n    return all(coord >= vec3<i32>(0)) && all(coord < shape);\n  }\n  fn coordsInBounds4D(coord : vec4<i32>, shape : vec4<i32>) -> bool {\n    return all(coord >= vec4<i32>(0)) && all(coord < shape);\n  }\n\n  fn getIndexFromCoords1D(coord : i32, shape : i32) -> i32 {\n    return coord;\n  }\n  fn getIndexFromCoords2D(coords : vec2<i32>, shape : vec2<i32>) -> i32 {\n    return dot(coords, vec2<i32>(shape.y, 1));\n  }\n  fn getIndexFromCoords3D(coords : vec3<i32>, shape : vec3<i32>) -> i32 {\n    return dot(coords, vec3<i32>(shape.y * shape.z, shape.z, 1));\n  }\n  fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n    return dot(coords, vec4<i32>(\n        shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n  }\n  fn getIndexFromCoords5D(coords : vec5, shape : vec5) -> i32 {\n    let shapeStrides: vec5 = vec5(shape.y * shape.z * shape.w * shape.u, shape.z * shape.w * shape.u, shape.w * shape.u, shape.u, 1);\n    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u;\n  }\n  fn getIndexFromCoords6D(coords : vec6, shape : vec6) -> i32 {\n    let shapeStrides: vec6 = vec6(shape.y * shape.z * shape.w * shape.u * shape.v, shape.z * shape.w * shape.u * shape.v, shape.w * shape.u * shape.v, shape.u * shape.v, shape.v, 1);\n    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u + coords.v*shapeStrides.v;\n  }\n\n  fn idiv(a: i32, b: i32, sign: f32) -> i32 {\n    var res: i32 = a / b;\n    let modulo: i32 = a % b;\n    if (sign < 0. && modulo != 0) {\n      res = res - 1;\n    }\n    return res;\n  }\n\n  // NaN defination in IEEE 754-1985 is :\n  //   - sign = either 0 or 1.\n  //   - biased exponent = all 1 bits.\n  //   - fraction = anything except all 0 bits (since all 0 bits represents infinity).\n  // https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers\n  fn isnan(val: f32) -> bool {\n    let floatToUint: u32 = bitcast<u32>(val);\n    return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n  }\n  fn isnanVec4(val : vec4<f32>) -> vec4<bool> {\n    let floatToUint: vec4<u32> = bitcast<vec4<u32>>(val);\n    return (floatToUint & vec4<u32>(0x7fffffffu)) > vec4<u32>(0x7f800000u);\n  }\n",GL="\n  fn isinf(val: f32) -> bool {\n    return abs(val) == uniforms.INFINITY;\n  }\n";function qL(e,t=""){let n=e.length,r=""!==t?`get${t.charAt(0).toUpperCase()+t.slice(1)}CoordsFromIndex`:"getCoordsFromIndex",a=""!==t?`${t.charAt(0).toLowerCase()+t.slice(1)}ShapeStrides`:"outShapeStrides";if(n<=1)return`fn ${r}(index : i32) -> i32 { return index; }`;let i,s=Sa.computeStrides(e),o=UL(n),l=[];for(let e=0;e<n;e++)l.push(`d${e}`);return 1===s.length?`    fn ${r}(index : i32) -> vec2<i32> {\n      let d0 = index / uniforms.${a}; let d1 = index - d0 * uniforms.${a};\n      return vec2<i32>(d0, d1);\n    }`:(i="var index2 = index;"+s.map(((e,t)=>`let ${l[t]} = index2 / uniforms.${a}.${WL(t)}; ${t===s.length-1?`let ${l[t+1]} = index2 - ${l[t]} * uniforms.${a}.${WL(t)}`:`index2 = index2 - ${l[t]} * uniforms.${a}.${WL(t)}`};`)).join(""),`\n    fn ${r}(index : i32) -> ${o} {\n      ${i}\n      return ${o}(${l.join(",")});\n    }\n  `)}function XL(e){let t="";switch(e){case 0:case 1:t+="\n        fn getOutputIndexFromCoords(coords : i32) -> i32 {\n          return coords;\n        }\n        ";break;case 2:t+="\n        fn getOutputIndexFromCoords(coords : vec2<i32>) -> i32 {\n          return dot(coords, vec2<i32>(uniforms.outShapeStrides, 1));\n        }\n        ";break;case 3:t+="\n        fn getOutputIndexFromCoords(coords : vec3<i32>) -> i32 {\n          return dot(coords, vec3<i32>(uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, 1));\n        }\n        ";break;case 4:t+="\n        fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n          return dot(coords, vec4<i32>(\n            uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, uniforms.outShapeStrides.z, 1));\n        }\n        ";break;case 5:t+="\n        fn getOutputIndexFromCoords(coords : vec5) -> i32 {\n          return coords.x * uniforms.outShapeStrides.x +\n              coords.y * uniforms.outShapeStrides.y +\n              coords.z * uniforms.outShapeStrides.z +\n              coords.w * uniforms.outShapeStrides.w +\n              coords.u;\n        }\n        ";break;case 6:t+="\n        fn getOutputIndexFromCoords(coords : vec6) -> i32 {\n          return coords.x * uniforms.outShapeStrides.x +\n              coords.y * uniforms.outShapeStrides.y +\n              coords.z * uniforms.outShapeStrides.z +\n              coords.w * uniforms.outShapeStrides.w +\n              coords.u * uniforms.outShapeStrides.u +\n              coords.v;\n        }\n        ";break;default:Sa.assert(!1,(()=>`Unsupported ${e}D shape`))}return t}function KL(e){return 1===e.dispatch[1]&&1===e.dispatch[2]}function ZL(e,t=1){if("float32"===e)return BL(t,"f32");if("int32"===e||"bool"===e)return BL(t,"i32");throw new Error(`type ${e} is not supported.`)}function YL(e){return!(e.dispatchLayout.hasOwnProperty("y")&&0!==e.dispatchLayout.y.length||e.dispatchLayout.hasOwnProperty("z")&&0!==e.dispatchLayout.z.length)}var JL={};x(JL,{GPUBytesPerElement:()=>oz,MatMulProgramType:()=>QL,assertNotComplex:()=>uz,computeDispatch:()=>nz,computeWorkPerThreadForConv2d:()=>iz,computeWorkgroupInfoForMatMul:()=>rz,computeWorkgroupSizeForConv2d:()=>az,flatDispatchLayout:()=>sz,isWebGPUSupported:()=>lz,tilesFitEvenlyIntoShape:()=>tz});var QL,ez=e=>{let t=1;for(let n=0;n<e.length;n++)t*=e[n];return t};function tz(e,t){if(e.length!==t.length)throw new Error(`Cannot compute whether rank ${e.length} tiles fit evenly into rank ${t.length} shape - ranks must match.`);return t.every(((t,n)=>t%e[n]==0))}function nz(e,t,n=[1,1,1],r=[1,1,1]){let[a,i,s]=[Math.ceil(ez(e.x.map((e=>t[e])))/(n[0]*r[0])),e.y?Math.ceil(ez(e.y.map((e=>t[e])))/(n[1]*r[1])):1,e.z?Math.ceil(ez(e.z.map((e=>t[e])))/(n[2]*r[2])):1];return[a,i,s]}function rz(e,t,n,r=!1){let a=[8,8,1],i=[4,4,1];return r||(e<=8&&(i[1]=1),t<=16&&n<=16&&(a[0]=4)),{workgroupSize:a,elementsPerThread:i}}function az(e,t,n=!1){if(n)return[8,8,1];let r=ez(e.x.map((e=>t[e]))),a=ez(e.y.map((e=>t[e])));return r<=4?[4,16,1]:a<=4?[16,4,1]:[16,16,1]}function iz(e,t,n=!1){if(n)return[4,4,1];let r=ez(e.x.map((e=>t[e]))),a=ez(e.y.map((e=>t[e])));return r<=4?[1,2,1]:a<=4?[2,1,1]:[2,2,1]}function sz(e){return{x:e.map(((e,t)=>t))}}function oz(e){if("float32"===e||"int32"===e||"bool"===e||"string"===e)return 4;if("complex64"===e)return 8;throw new Error(`Unknown dtype ${e}`)}function lz(){return("undefined"!=typeof window||"undefined"!=typeof WorkerGlobalScope)&&!!navigator.gpu}function uz(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Sa.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the WebGPU backend.`))}))}!function(e){e[e.MatMulReduceProgram=0]="MatMulReduceProgram",e[e.MatMulSplitKProgram=1]="MatMulSplitKProgram",e[e.MatMulSmallOutputSizeProgram=2]="MatMulSmallOutputSizeProgram",e[e.MatMulPackedProgram=3]="MatMulPackedProgram",e[e.MatMulMax=4]="MatMulMax"}(QL||(QL={}));var dz,cz=Ue().getNumber("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD"),hz=class extends W{nextDataId(){return hz.nextDataId++}constructor(e,t){if(super(),this.commandQueueOwnedIds=new WeakSet,this.dispatchCountInPass=0,this.disposed=!1,this.downloadWaitMs=0,this.tensorDataPendingDisposal=[],this.queryResolveBuffer=null,this.querySet=null,this.querySetCount=2,this.stagingPendingDisposal=[],this.uniformPendingDisposal=[],this.uploadWaitMs=0,this.hasReadSyncWarned=!1,this.hasTimestampQueryWarned=!1,!lz())throw new Error("WebGPU is not supported on this device");this.pipelineCache={},this.device=e,this.queue=e.queue,this.commandEncoder=null,this.computePassEncoder=null,this.adapterInfo=new class{constructor(e){e&&(this.vendor=e.vendor,this.architecture=e.architecture,this.intelGPUGeneration=this.getIntelGPUGeneration())}getIntelGPUGeneration(){if(this.isIntel()){if(this.architecture.startsWith("gen"))return Number(this.architecture.match(/\d+/));if(this.architecture.startsWith("xe"))return 12}return 0}isIntel(){return"intel"===this.vendor}}(t),this.supportTimestampQuery=this.device.features.has("timestamp-query"),this.thresholdToIncreaseWorkgroups=this.adapterInfo.intelGPUGeneration>=12?16:8,this.bufferManager=new class{constructor(e){this.device=e,this.numUsedBuffers=0,this.numFreeBuffers=0,this.freeBuffers=new Map,this.usedBuffers=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireBuffer(e,t,n=!1,r=!0){let a,i=OL(e,t);return r?(this.freeBuffers.has(i)||this.freeBuffers.set(i,[]),this.freeBuffers.get(i).length>0?(a=this.freeBuffers.get(i).pop(),this.numFreeBuffers--):(a=this.device.createBuffer({size:e,usage:t,mappedAtCreation:n}),this.numBytesAllocated+=e)):(a=this.device.createBuffer({size:e,usage:t,mappedAtCreation:n}),this.numBytesAllocated+=e),this.usedBuffers.has(i)||this.usedBuffers.set(i,[]),this.usedBuffers.get(i).push(a),this.numUsedBuffers++,this.numBytesUsed+=e,a}releaseBuffer(e,t=!0){if(0===this.freeBuffers.size)return;let n=e.size,r=OL(n,e.usage),a=this.usedBuffers.get(r),i=a.indexOf(e);if(i<0)throw new Error("Cannot find the buffer in buffer manager");a[i]=a[a.length-1],a.pop(),this.numUsedBuffers--,this.numBytesUsed-=n,t?(this.freeBuffers.get(r).push(e),this.numFreeBuffers++):(e.destroy(),this.numBytesAllocated-=n)}getNumUsedBuffers(){return this.numUsedBuffers}getNumFreeBuffers(){return this.numFreeBuffers}dispose(){this.freeBuffers.forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),this.usedBuffers.forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),this.freeBuffers=new Map,this.usedBuffers=new Map,this.numUsedBuffers=0,this.numFreeBuffers=0,this.numBytesUsed=0,this.numBytesAllocated=0}}(this.device),this.textureManager=new class{constructor(e){this.device=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures=new Map,this.usedTextures=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireTexture(e,t,n,r){let a=e*t*FL(n),i=$L(e,t,n,r);if(this.freeTextures.has(i)||this.freeTextures.set(i,[]),this.usedTextures.has(i)||this.usedTextures.set(i,[]),this.numBytesUsed+=a,this.numUsedTextures++,this.freeTextures.get(i).length>0){this.numFreeTextures--;let e=this.freeTextures.get(i).shift();return this.usedTextures.get(i).push(e),e}this.numBytesAllocated+=a;let s=this.device.createTexture({size:[e,t],format:n,usage:r});return this.usedTextures.get(i).push(s),s}releaseTexture(e){if(0===this.freeTextures.size)return;let t=e.width,n=e.height,r=e.format,a=$L(t,n,r,e.usage);this.freeTextures.has(a)||this.freeTextures.set(a,[]),this.freeTextures.get(a).push(e),this.numFreeTextures++,this.numUsedTextures--;let i=this.usedTextures.get(a),s=i.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1);let o=t*n*FL(r);this.numBytesUsed-=o}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){this.freeTextures.forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),this.usedTextures.forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),this.freeTextures=new Map,this.usedTextures=new Map,this.numUsedTextures=0,this.numFreeTextures=0,this.numBytesUsed=0,this.numBytesAllocated=0}}(this.device),this.tensorMap=new U(this,Ys()),Ue().getBool("WEBGPU_USE_PROFILE_TOOL")&&(this.dummyCanvas=document.createElement("canvas"),this.dummyCanvas.width=1,this.dummyCanvas.height=1,this.dummyContext=this.dummyCanvas.getContext("webgpu"),this.dummyContext.configure({device:e,format:"bgra8unorm"}),document.body.appendChild(this.dummyCanvas))}floatPrecision(){return 32}disposeData(e,t=!1){if(!this.tensorMap.has(e))return!0;let n=this.tensorMap.get(e);return t?n.refCount=0:n.refCount--,!(n.refCount>0||(null!=n.complexTensorInfos&&(this.disposeData(n.complexTensorInfos.real.dataId),this.disposeData(n.complexTensorInfos.imag.dataId)),this.commandQueueOwnedIds.has(e)?(this.tensorDataPendingDisposal.push(e),0):(this.releaseResource(e),this.tensorMap.delete(e),0)))}memory(){return{numBytesInGPU:this.bufferManager.numBytesUsed,numBytesAllocatedInGPU:this.bufferManager.numBytesAllocated,unreliable:!1}}releaseResource(e){let t=this.tensorMap.get(e);if(t&&t.resource){if(t.external)return void(t.resource=null);t.resource instanceof GPUBuffer?this.bufferManager.releaseBuffer(t.resource):t.resource instanceof GPUTexture&&this.textureManager.releaseTexture(t.resource),t.resource=null}}refCount(e){return this.tensorMap.has(e)?this.tensorMap.get(e).refCount:0}incRef(e){this.tensorMap.get(e).refCount++}decRef(e){this.tensorMap.has(e)&&this.tensorMap.get(e).refCount--}write(e,t,n){if("complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let r={id:this.nextDataId()};return this.tensorMap.set(r,{dtype:n,shape:t,values:e,refCount:1}),r}move(e,t,n,r,a){if("complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.tensorMap.set(e,{dtype:r,shape:n,values:t,refCount:a})}submitQueue(){this.queue.submit([this.commandEncoder.finish()]),this.commandEncoder=null,this.dispatchCountInPass=0,this.commandQueueOwnedIds=new WeakSet,this.tensorDataPendingDisposal.forEach((e=>{this.releaseResource(e),this.tensorMap.delete(e)})),this.uniformPendingDisposal.forEach((e=>this.bufferManager.releaseBuffer(e))),this.stagingPendingDisposal.forEach((e=>this.bufferManager.releaseBuffer(e,!1))),this.tensorDataPendingDisposal=[],this.uniformPendingDisposal=[],this.stagingPendingDisposal=[]}ensureCommandEncoderReady(){this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder())}endComputePassEncoder(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}async checkCompileCompletionAsync(){let e;try{e=await Promise.all(Object.values(this.pipelineCache))}catch(e){throw new Error(e.message)}Object.keys(this.pipelineCache).map(((t,n)=>{this.pipelineCache[t]=e[n]}))}async getBufferData(e){if(Ue().getBool("WEBGPU_ENGINE_COMPILE_ONLY"))return console.warn("The data may be invalid since WEBGPU_ENGINE_COMPILE_ONLY is true, this can only be called when WEBGPU_ENGINE_COMPILE_ONLY is false"),null;let t=e.size,n=this.bufferManager.acquireBuffer(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,n,0,t),this.submitQueue(),await n.mapAsync(GPUMapMode.READ);let r=n.getMappedRange().slice(0);return n.unmap(),null!=n&&this.bufferManager.releaseBuffer(n),Ue().getBool("WEBGPU_USE_PROFILE_TOOL")&&(Sa.assert(void 0!==this.dummyContext,(()=>"Fail to get context for profiling tool")),this.dummyContext.getCurrentTexture()),r}convertAndCacheOnCPU(e,t){let n=this.tensorMap.get(e);return n.values=t,n.values}readSync(e){let t=this.tensorMap.get(e),{values:n,complexTensorInfos:r}=t;if(null!=n||"string"===t.dtype)return n;if("complex64"===t.dtype){let t=this.readSync(r.real.dataId),n=this.readSync(r.imag.dataId),a=Sa.convertBackendValuesAndArrayBuffer($m.mergeRealAndImagArrays(t,n).buffer,"float32");return this.convertAndCacheOnCPU(e,a),a}this.hasReadSyncWarned||(this.hasReadSyncWarned=!0,console.warn("The performance of synchronously reading data from GPU to CPU is poor on the webgpu backend, please use asynchronous APIs instead."));let a=["opaque","premultiplied"],i=t.resource,s=i.size;Sa.assert(s%4==0,(()=>"Because there is 4 bytes for one pixel, buffer size must be multiple of 4."));let o=s/4,l=new ArrayBuffer(s),u=256,d=256,c=a.map((e=>new OffscreenCanvas(u,d))),h=new OffscreenCanvas(u,d);this.endComputePassEncoder(),c.map(((e,t)=>{let n=e.getContext("webgpu");return n.configure({device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.COPY_DST,alphaMode:a[t]}),n.getCurrentTexture()})).map(((e,t)=>{let n=(n,r,s)=>{this.ensureCommandEncoderReady(),this.commandEncoder.copyBufferToTexture({buffer:i,bytesPerRow:1024,offset:s},{texture:e},{width:n,height:r}),this.submitQueue();let o=h.getContext("2d",{willReadFrequently:!0});o.clearRect(0,0,n,r),o.drawImage(c[t],0,0);let u=o.getImageData(0,0,n,r).data,d=a[t],p=new Uint8ClampedArray(l,s,n*r*4);for(let e=0;e<p.length;e+=4)if("premultiplied"===d)p[e+3]=u[e+3];else{let t=u[e];p[e]=u[e+2],p[e+1]=u[e+1],p[e+2]=t}},r=Math.floor(o/(u*d)),s=u,p=d,m=0;for(let e=0;e<r;e++)n(s,p,m),m+=u*d*4;let f=o%(u*d);p=Math.floor(f/u),p>0&&(n(s,p,m),m+=p*(4*u)),s=f%u,s>0&&n(s,1,m)}));let p=Sa.convertBackendValuesAndArrayBuffer(l,t.dtype);return this.convertAndCacheOnCPU(e,p),p}async read(e){if(!this.tensorMap.has(e))throw new Error(`Tensor ${e} was not registered!`);let t,n=this.tensorMap.get(e),{values:r}=n;if(null!=r)return r;if("complex64"===n.dtype){let e=await Promise.all([this.read(n.complexTensorInfos.real.dataId),this.read(n.complexTensorInfos.imag.dataId)]),r=e[0],a=e[1];t=$m.mergeRealAndImagArrays(r,a)}else{let e=await this.getBufferData(n.resource);t=Sa.convertBackendValuesAndArrayBuffer(e,n.dtype)}return this.convertAndCacheOnCPU(e,t),t}copyBuffer(e){let t=e.size,n=e.usage,r=this.bufferManager.acquireBuffer(t,n);return this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,r,0,t),this.submitQueue(),r}createTensorFromGPUData(e,t,n){let r=e.buffer;if("complex64"===n)throw new Error("Cannot write to a complex64 dtype. ");let a={id:this.nextDataId()};this.tensorMap.set(a,{dtype:n,shape:t,values:null,refCount:1,external:e.zeroCopy});let i=this.tensorMap.get(a),s=oz(i.dtype)*Sa.sizeFromShape(i.shape);if(e.buffer.size<s)throw new Error(`GPUBuffer size(${e.buffer.size}) is smaller than tensor size(${s})!`);if((e.buffer.usage&(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))!=(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))throw new Error("GPUBuffer.usage should include GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC!");return!0!==e.zeroCopy&&(r=this.copyBuffer(r)),i.resource=r,Ys().makeTensorFromDataId(a,t,n,this)}readToGPU(e){let t=this.tensorMap.get(e),{values:n,dtype:r,shape:a,resource:i}=t;if("complex64"===r)throw new Error("Does not support reading buffer for complex64 dtype.");if(null==i)throw null!=n?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let s=i,o=s.size,l=s.usage,u=this.bufferManager.acquireBuffer(o,l);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(i,0,u,0,o),this.submitQueue();let d=this.makeTensorInfo(a,r),c=Ys().makeTensorFromTensorInfo(d);return this.tensorMap.get(d.dataId).resource=u,{tensorRef:c,buffer:u}}bufferSync(e){let t=this.readSync(e.dataId);if("string"===e.dtype)try{let n=t.map((e=>Sa.decodeString(e)));return Ws(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ws(e.shape,e.dtype,t)}async time(e){!this.supportTimestampQuery&&!this.hasTimestampQueryWarned&&(console.warn("This device doesn't support timestamp-query extension. Start Chrome browser with flag --disable-dawn-features=disallow_unsafe_apis to try it again. Otherwise, zero will be shown for the kernel time when profiling mode is enabled."),this.hasTimestampQueryWarned=!0);let t=this.activeTimers,n=[],r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();let a=Sa.flatten(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),i=Sa.flatten(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);let s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},o=await Promise.all(a);return s.kernelMs=Sa.sum(o),s.getExtraProfileInfo=()=>o.map(((e,t)=>({name:i[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", "),this.uploadWaitMs=0,this.downloadWaitMs=0,s}makeTensorInfo(e,t,n){return"string"===t&&null!=n&&n.length>0&&Sa.isString(n[0])&&(n=n.map((e=>Sa.encodeString(e)))),{dataId:this.write(n,e,t),shape:e,dtype:t}}tensorToBinding(e){if(!e)return null;let t=this.tensorMap.get(e.dataId).resource;return t instanceof GPUBuffer?{buffer:t}:t instanceof GPUTexture?t.createView():t}uploadToGPU(e){let t=this.tensorMap.get(e);if(null!=t.resource)return;let n,r=oz(t.dtype)*Sa.sizeFromShape(t.shape),a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;if(t.values){if(n=this.bufferManager.acquireBuffer(r,a,!0),"unmapped"===n.mapState){let e=this.bufferManager.acquireBuffer(r,GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,!0,!1),a=e.getMappedRange();"int32"===t.dtype||"bool"===t.dtype?new Int32Array(a).set(t.values):new Float32Array(a).set(t.values),e.unmap(),this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,n,0,r),this.stagingPendingDisposal.push(e)}else{let e=n.getMappedRange();"int32"===t.dtype||"bool"===t.dtype?new Int32Array(e).set(t.values):new Float32Array(e).set(t.values),n.unmap()}t.values=null}else n=this.bufferManager.acquireBuffer(r,a);t.resource=n}makeUniforms(e){let t=0,n=0,r=[],a=1;e.forEach((e=>{let i;switch(0===e.data.length&&(e.data=[1]),e.data.length){case 1:i=4;break;case 2:i=8;break;case 3:case 4:case 5:case 6:i=16;break;default:Sa.assert(!1,(()=>`Unsupported ${e.data.length}D shape`))}(5===n||6===n)&&(i=16),i>a&&(a=i),t=Math.ceil(t/i)*i,n=e.data.length,r.push(t),t+=4*e.data.length})),t=Math.ceil(t/a)*a;let i=new ArrayBuffer(t);e.forEach(((e,t)=>{let n=r[t];"int32"===e.type?new Int32Array(i,n,e.data.length).set(e.data):"uint32"===e.type?new Uint32Array(i,n,e.data.length).set(e.data):new Float32Array(i,n,e.data.length).set(e.data)}));let s=this.bufferManager.acquireBuffer(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);return this.queue.writeBuffer(s,0,i,0,t),this.uniformPendingDisposal.push(s),{offset:0,size:t,buffer:s}}runWebGPUProgram(e,t,n,r,a){if(a||(a=this.makeTensorInfo(e.outputShape,n)),0===Sa.sizeFromShape(a.shape))return this.tensorMap.get(a.dataId).values=Sa.getTypedArrayFromDType(a.dtype,0),a;this.uploadToGPU(a.dataId),e.dispatch=((e,t)=>{let n=e.limits.maxComputeWorkgroupsPerDimension,r=t.dispatchLayout,a=t.dispatch;if(a.every((e=>e<=n)))return a;Sa.assert(a[0]>n&&void 0===r.y&&void 0===r.z,(()=>"Dispatch size exceeds WebGPU limits in Y or Z dimension."));let i=Math.ceil(Math.sqrt(a[0]));return i>n?(i=Math.ceil(Math.cbrt(a[0])),Sa.assert(i<=n,(()=>"Total dispatch size exceeds WebGPU maximum.")),[i,i,i]):[i,i,1]})(this.device,e);let i=t.map(((t,n)=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");return this.uploadToGPU(t.dataId),{dtype:this.tensorMap.get(t.dataId).dtype,shape:t.shape,name:e.variableNames[n]}}));e.shaderKey=function(e,t,n){let r=e.shaderKey;if(e.isFromPixels)return r;let a=[],i=[];t.forEach((e=>{a.push(e.shape),i.push(e.dtype)})),a.push(n.shape),i.push(n.dtype);let s=t.map((e=>$m.getBroadcastDims(e.shape,n.shape))),o=t.map((e=>Sa.arraysEqual(e.shape,n.shape))).join("_"),l=s.map((e=>e.join("_"))).join(";"),u=KL(e)?"flatDispatch":"";return r+="_"+(e.workgroupSize?e.workgroupSize.join(","):"")+a.map((e=>e.length)).join(",")+i.join(",")+e.variableNames.join(",")+l+o+u,r}(e,i,a);let s=Ue().getBool("WEBGPU_ENGINE_COMPILE_ONLY");return e.shaderKey in this.pipelineCache||(this.pipelineCache[e.shaderKey]=((e,t,n,r,a)=>{let i=function(e,t,n){let r=[],a=n.workgroupSize[0]*n.workgroupSize[1]*n.workgroupSize[2];if(n.outputComponent=n.outputComponent?n.outputComponent:1,r.push(`\n\n      var<private> localId: vec3<u32>;\n      var<private> localIndex: u32;\n      var<private> globalId: vec3<u32>;\n      var<private> numWorkgroups: vec3<u32>;\n      var<private> workgroupId: vec3<u32>;\n\n      // Only used when the y/z dimension of workgroup size is 1.\n      fn getGlobalIndex() -> i32 {\n        ${KL(n)?"  return i32(globalId.x);":`  return i32((workgroupId.z * numWorkgroups.x * numWorkgroups.y +\n                workgroupId.y * numWorkgroups.x + workgroupId.x) * ${a}u +\n                localIndex);\n        `}\n      }\n    `),n.isFromPixels){r.push(`\n        struct Uniform {\n          size            : i32,\n          numChannels     : i32,\n          outShapeStrides : vec2<i32>,\n        };\n\n        @group(0) @binding(0) var<storage, read_write> result: array<${ZL(t.dtype,n.outputComponent)}>;\n        @group(0) @binding(2) var<uniform> uniforms: Uniform;\n      `);let e=YL(n);return[HL,r.join("\n"),qL(t.shape),n.getUserCode(),jL(e,n)].join("\n")}let i,s,o="struct Uniforms { NAN : f32, INFINITY : f32, ";n.variableNames.forEach(((t,n)=>{let r=UL(e[n].shape.length);o+=`${t.charAt(0).toLowerCase()+t.slice(1)}Shape : ${r}, `,i=e[n].shape.length-1,s=UL(i),o+=`${t.charAt(0).toLowerCase()+t.slice(1)}ShapeStrides: ${s}, `}));let l=UL(t.shape.length);o+=`outShape : ${l}, `,i=t.shape.length-1,s=UL(i),o+=`\n         outShapeStrides: ${s}, `,n.size&&(o+="size : i32, "),n.uniforms&&(o+=n.uniforms),o+="};",o=function(e){return e=e.replace(/(\w+)\s*:\s*vec(5|6)/g,(e=>"@align(16) "+e)),e=e.replace(/vec(5|6)\s*,\s*(\w+)/g,((e,t,n)=>`vec${t}, @align(16) ${n}`)),e}(o),r.push(o),n.atomic?r.push("\n      @group(0) @binding(0) var<storage, read_write> result: array<atomic<i32>>;\n    "):r.push(`\n      @group(0) @binding(0) var<storage, read_write> result: array<${ZL(t.dtype,n.outputComponent)}>;\n    `),n.variableNames.forEach(((t,a)=>{r.push(`\n      @group(0) @binding(${1+a}) var<storage, read> ${t}: array<${n.variableComponents?ZL(e[a].dtype,n.variableComponents[a]):ZL(e[a].dtype,n.outputComponent)}>;\n        `)})),""!==o&&r.push(`\n      @group(0) @binding(${1+n.variableNames.length}) var<uniform> uniforms: Uniforms;\n      `);let u=function(e,t){let{x:n,y:r=[],z:a=[]}=t,i=e.length,s=n.length+r.length+a.length;if(s!==i)return"";if(n.length===i)return`fn getOutputCoords() -> ${UL(i)}{\n    let globalIndex = getGlobalIndex();\n    return getCoordsFromIndex(globalIndex);\n  }\n  `;let o="",l=[n,r,a];for(let e=0;e<l.length;e++){let t=l[e];if(0!==t.length)if(1===t.length)o+=`let d${t[0]} = i32(globalId[${e}]);`;else{let n=LL(t,"uniforms.outShape");o+=`var index${e} = i32(globalId[${e}]);`;for(let r=0;r<n.length;r++)o+=`let d${t[r]} = index${e} / ${n[r]};`,r===n.length-1?o+=`let d${t[r+1]} = index${e} - d${t[r]} * ${n[r]};`:o+=`index${e} = index${e} - d${t[r]} * ${n[r]};`}}let u=[];for(let e=0;e<s;e++)u.push(`d${e}`);let d=UL(s),c=`fn getOutputCoords() -> ${d} {\n  ${o}\n`;return 0===u.length?c+=`return ${d}(0); }`:c+=`return ${d}(${u.join(",")}); }`,c}(t.shape,n.dispatchLayout),d=[HL,r.join("\n")+GL,qL(t.shape),u,XL(t.shape.length)];n.atomic||d.push(function(e,t,n){let r=e.length,a=ZL(t,n),i=`fn setOutputAtIndex(flatIndex : i32, value : ${BL(n)}) {\n      result[flatIndex] = ${a}(value);\n    }\n\n    fn setOutputAtIndexI32(flatIndex : i32, value : ${BL(n,"i32")}) {\n      result[flatIndex] = ${a}(value);\n    }\n    `;if(r>=2){let e=["d0","d1","d2","d3","d4","d5"].slice(0,r),t=UL(r);i+=`\n      fn setOutputAtCoords(${e.map((e=>`${e} : i32`)).join(", ")}, value : ${BL(n)}) {\n        let flatIndex = getOutputIndexFromCoords(${t}(${e.join(", ")}));\n        setOutputAtIndex(flatIndex${1===n?"":` / ${n}`}, value);\n      }\n      fn setOutputAtCoordsI32(${e.map((e=>`${e} : i32`)).join(", ")}, value : ${BL(n,"i32")}) {\n        let flatIndex = getOutputIndexFromCoords(${t}(${e.join(", ")}));\n        setOutputAtIndexI32(flatIndex${1===n?"":` / ${n}`}, value);\n      }\n    `}return i}(t.shape,t.dtype,n.outputComponent)),n.variableNames.forEach(((t,n)=>{d.push(`${qL(e[n].shape,t)}`)}));let c=e.map(((e,r)=>function(e,t,n,r){let a=function(e,t){let n=e.name,r=e.shape.length,a=UL(r),i="get"+n.charAt(0).toUpperCase()+n.slice(1),s=["d0","d1","d2","d3","d4","d5"].slice(0,r),o=s.map((e=>`${e} : i32`)).join(", ");if(r<1)return`\n      fn ${i}() -> ${BL(t)} {\n        return ${BL(t)}(${n}[0]);\n      }\n    `;let l=`uniforms.${n.charAt(0).toLowerCase()+n.slice(1)}Shape`,u=`${r}D`;return 0===r&&(u="1D"),`\n    fn ${i}(${o}) -> ${BL(t)} {\n      return ${BL(t)}(${n}[getIndexFromCoords${u}(${a}(${s.join(",")}),\n        ${l})${1===t?"":` / ${t}`}]);\n    }\n   `}(e,n);return e.shape.length<=t.length&&(a+=function(e,t,n,r){let a=e.name,i=a.charAt(0).toUpperCase()+a.slice(1),s="get"+i+"ByOutput",o=e.shape.length,l=t.length,u=UL(l);if(Sa.arraysEqual(e.shape,t)&&r)return`\n    fn ${s}Index(globalIndex : i32) -> ${BL(n)} {\n      return ${BL(n)}(${a}[globalIndex]);\n    }\n\n    fn ${s}Coords(coords : ${u}) -> ${BL(n)} {\n      return ${BL(n)}(${a}[${l>1?"getOutputIndexFromCoords(coords)":"coords"}${1===n?"":` / ${n}`}]);\n    }\n    `;let d=$m.getBroadcastDims(e.shape,t),c=l-o,h="";if(0===o)return`\n    fn ${s}Index(globalIndex : i32) -> ${BL(n)}{\n      return get${i}();\n    }\n\n    fn ${s}Coords(coords : ${u}) -> ${BL(n)}{\n      return get${i}();\n    }\n  `;h=l<2&&d.length>=1?"coords = 0;":d.map((e=>`coords.${WL(e+c)} = 0;`)).join("\n");let p="";p=l<2&&o>0?"coords":l>1?`${UL(o)}(${e.shape.map(((e,t)=>`coords.${WL(t+c)}`)).join(", ")})`:"coords";let m=`uniforms.${a.charAt(0).toLowerCase()+a.slice(1)}Shape`,f=`${o}D`;return`\n  fn ${s}Index(globalIndex : i32) -> ${BL(n)} {\n    var coords = getCoordsFromIndex(globalIndex);\n    ${h}\n    return ${BL(n)}(${a}[getIndexFromCoords${f}(${p}, ${m})${1===n?"":` / ${n}`}]);\n  }\n\n  fn ${s}Coords(coordsIn : ${u}) -> ${BL(n)} {\n    var coords = coordsIn;\n    ${h}\n    return ${BL(n)}(${a}[getIndexFromCoords${f}(${p}, ${m})${1===n?"":` / ${n}`}]);\n  }\n`}(e,t,n,r)),a}(e,t.shape,n.variableComponents?n.variableComponents[r]:n.outputComponent,n.dispatchLayout.x.length===t.shape.length))).join("\n");d.push(c),d.push(n.getUserCode());let h=YL(n);return d.push(jL(h,n)),d.join("\n")}(n,{dtype:r.dtype,shape:r.shape},t),s=e.createShaderModule({code:i,label:t.constructor.name}),o=Ue().get("WEBGPU_PRINT_SHADER");if(""!==o){o=o.toLowerCase();let e=o.split(",");("all"===o||e.some((e=>t.shaderKey.toLowerCase().includes(e))))&&(console.group(t.shaderKey),console.debug(i),console.groupEnd())}return a?e.createComputePipelineAsync({compute:{module:s,entryPoint:"_start"},label:t.constructor.name,layout:"auto"}):e.createComputePipeline({compute:{module:s,entryPoint:"_start"},label:t.constructor.name,layout:"auto"})})(this.device,e,i,a,s)),e.pipeline=this.pipelineCache[e.shaderKey],s||this.recordAndSubmit(e,a,t,r),a}recordAndSubmit(e,t,n,r){if(e.pipeline instanceof Promise)throw new Error("Please call checkCompileCompletionAsync to ensure parallel compilation is done!");let a=[],i=[];if(!e.isFromPixels){a.push({type:"float32",data:[NaN]},{type:"float32",data:[1/0]}),i=n.concat(t).map((e=>e.shape));let r="int32";if(i.map((e=>{a.push({type:r,data:e});let t=Sa.computeStrides(e);a.push({type:r,data:t})})),e.size){let t=Sa.sizeFromShape(e.outputShape);a.push({type:r,data:[e.outputComponent?t/e.outputComponent:t]})}}r&&(a=[...a,...r]);let s=[this.tensorToBinding(t),...n.map((e=>this.tensorToBinding(e))),this.makeUniforms(a)];n.forEach((e=>{this.commandQueueOwnedIds.add(e.dataId)})),this.commandQueueOwnedIds.add(t.dataId);let o=this.device.createBindGroup({layout:e.pipeline.getBindGroupLayout(0),entries:s.map(((e,t)=>({binding:t,resource:e})))}),l=null!=this.activeTimers;this.ensureCommandEncoderReady();let u={};l&&this.supportTimestampQuery?(this.endComputePassEncoder(),null==this.querySet&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.querySetCount})),u.timestampWrites=[{querySet:this.querySet,queryIndex:0,location:"beginning"},{querySet:this.querySet,queryIndex:1,location:"end"}],this.computePassEncoder=this.commandEncoder.beginComputePass(u)):this.computePassEncoder||(this.computePassEncoder=this.commandEncoder.beginComputePass(u)),this.computePassEncoder.setPipeline(e.pipeline),this.computePassEncoder.setBindGroup(0,o),this.computePassEncoder.dispatchWorkgroups(e.dispatch[0],e.dispatch[1],e.dispatch[2]),this.dispatchCountInPass++,(l||Ue().get("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE")<=this.dispatchCountInPass)&&(this.endComputePassEncoder(),l?this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime()}):this.submitQueue())}async getQueryTime(){if(!this.supportTimestampQuery)return 0;null==this.queryResolveBuffer&&(this.queryResolveBuffer=this.bufferManager.acquireBuffer(8*this.querySetCount,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.QUERY_RESOLVE)),this.commandEncoder.resolveQuerySet(this.querySet,0,this.querySetCount,this.queryResolveBuffer,0);let e=this.bufferManager.acquireBuffer(8*this.querySetCount,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,8*this.querySetCount),this.submitQueue(),await e.mapAsync(GPUMapMode.READ);let t=new BigUint64Array(e.getMappedRange()),n=Number(t[1]-t[0])/1e6;return e.unmap(),this.bufferManager.releaseBuffer(e),n}shouldExecuteOnCPU(e,t=cz){return Ue().getBool("WEBGPU_CPU_FORWARD")&&e.every((e=>null==this.tensorMap.get(e.dataId).resource&&Sa.sizeFromShape(e.shape)<t))}numDataIds(){return this.tensorMap.numDataIds()-this.tensorDataPendingDisposal.length}dispose(){this.disposed||(null!=this.querySet&&this.querySet.destroy(),this.bufferManager.dispose(),this.textureManager.dispose(),this.disposed=!0)}};hz.nextDataId=0,lz()&&co("webgpu",(async()=>{let e={powerPreference:Ue().get("WEBGPU_USE_LOW_POWER_GPU")?"low-power":"high-performance"},t=await navigator.gpu.requestAdapter(e),n={};t.features.has("timestamp-query")&&(n.requiredFeatures=["timestamp-query"]);let r=t.limits;n.requiredLimits={maxComputeWorkgroupStorageSize:r.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.maxStorageBufferBindingSize,maxBufferSize:r.maxBufferSize,maxComputeWorkgroupSizeX:r.maxComputeWorkgroupSizeX,maxComputeInvocationsPerWorkgroup:r.maxComputeInvocationsPerWorkgroup};let a=await t.requestDevice(n),i=await t.requestAdapterInfo();return new hz(a,i)}),3),function(e){e[e.ADD=0]="ADD",e[e.ATAN2=1]="ATAN2",e[e.COMPLEX_MULTIPLY_IMAG=2]="COMPLEX_MULTIPLY_IMAG",e[e.COMPLEX_MULTIPLY_REAL=3]="COMPLEX_MULTIPLY_REAL",e[e.DIV=4]="DIV",e[e.ELU_DER=5]="ELU_DER",e[e.EQUAL=6]="EQUAL",e[e.GREATER=7]="GREATER",e[e.GREATER_EQUAL=8]="GREATER_EQUAL",e[e.INT_DIV=9]="INT_DIV",e[e.LESS=10]="LESS",e[e.LESS_EQUAL=11]="LESS_EQUAL",e[e.LOGICAL_AND=12]="LOGICAL_AND",e[e.LOGICAL_OR=13]="LOGICAL_OR",e[e.MAX=14]="MAX",e[e.MIN=15]="MIN",e[e.MOD=16]="MOD",e[e.MUL=17]="MUL",e[e.NOT_EQUAL=18]="NOT_EQUAL",e[e.POW=19]="POW",e[e.PRELU=20]="PRELU",e[e.SQUARED_DIFFERENCE=21]="SQUARED_DIFFERENCE",e[e.SUB=22]="SUB"}(dz||(dz={}));var pz,mz="return a + b;",fz="var resultTemp = atan2(a, b);",gz="return areal * breal - aimag * bimag;",yz="return areal * bimag + aimag * breal;",bz="return a / b;",xz="return select(a * (b + 1.0), a, b >= 0.);",Az="return select(a * (b + vec4<f32>(1.0)), a, b >= vec4<f32>(0.));",vz="return f32(a == b);",wz="return vec4<f32>(a == b);",kz="return f32(a > b);",Sz="return vec4<f32>(a > b);",Tz="return f32(a >= b);",_z="return vec4<f32>(a >= b);",Iz="\n  let s = sign(a) * sign(b);\n  let ia = i32(round(a));\n  let ib = i32(round(b));\n  return f32(idiv(ia, ib, s));\n",Cz="\n  let ia = vec4<i32>(round(a));\n  let ib = vec4<i32>(round(b));\n  let cond = ib != vec4<i32>(0);\n  var resultTemp = vec4<i32>(0);\n  let s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    resultTemp[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    resultTemp[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    resultTemp[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    resultTemp[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4<f32>(resultTemp);\n",Ez="return f32(a < b);",Nz="return vec4<f32>(a < b);",Rz="return f32(a <= b);",Pz="return vec4<f32>(a <= b);",Dz="return f32(a >= 1.0 && b >= 1.0);",Mz="return (vec4<f32>(a >= vec4<f32>(1.0)) *\n  vec4<f32>(b >= vec4<f32>(1.0)));",Oz="return f32(a >= 1.0 || b >= 1.0);",$z="return min(vec4<f32>(a >= vec4<f32>(1.0)) +\n  vec4<f32>(b >= vec4<f32>(1.0)), vec4<f32>(1.0));",Fz="var resultTemp = max(a, b);",Lz="var resultTemp = min(a, b);",zz="\n  let isNaN = b == 0.;\n  var resultTemp = a % b;\n  resultTemp = select((resultTemp + b) % b, resultTemp,\n      (a < 0. && b < 0.) || (a >= 0. && b > 0.));\n",Bz="\n  let isNaN = !vec4<bool>(b);\n  var resultTemp = vec4<f32>(a % b);\n  if (!((a[0] < 0. && b[0] < 0.) || (a[0] >= 0. && b[0] > 0.))) {\n    resultTemp[0] = (resultTemp[0] + b[0]) % b[0];\n  }\n  if (!((a[1] < 0. && b[1] < 0.) || (a[1] >= 0. && b[1] > 0.))) {\n    resultTemp[1] = (resultTemp[1] + b[1]) % b[1];\n  }\n  if (!((a[2] < 0. && b[2] < 0.) || (a[2] >= 0. && b[2] > 0.))) {\n    resultTemp[2] = (resultTemp[2] + b[2]) % b[2];\n  }\n  if (!((a[3] < 0. && b[3] < 0.) || (a[3] >= 0. && b[3] > 0.))) {\n    resultTemp[3] = (resultTemp[3] + b[3]) % b[3];\n  }\n",Uz="return a * b;",Wz="\n  var resultTemp = f32(a != b);\n  let valueForNaN = 1.0;\n",Vz="\n  var resultTemp = vec4<f32>(a != b);\n  let valueForNaN = 1.0;\n",jz="\n  let isNaN = a < 0.0 && floor(b) < b;\n  if (b == 0.0) {\n    return 1.0;\n  }\n  var resultTemp = select(sign(a) * pow(abs(a), b), pow(abs(a), b),\n      round(abs(b) % 2.0) != 1.0);\n",Hz="\n  let isModRound1Bool = vec4<i32>(round(abs(b) % vec4<f32>(2.0))) == vec4<i32>(1);\n  let isModRound1 = vec4<f32>(isModRound1Bool);\n  let multiplier = sign(a) * isModRound1 + (vec4<f32>(1.0) - isModRound1);\n  var resultTemp = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  let isExpZero = b == vec4<f32>(0.0);\n  if (isExpZero.r) {\n    resultTemp.r = 1.0;\n  }\n  if (isExpZero.g) {\n    resultTemp.g = 1.0;\n  }\n  if (isExpZero.b) {\n    resultTemp.b = 1.0;\n  }\n  if (isExpZero.a) {\n    resultTemp.a = 1.0;\n  }\n  let isNaN = (a < vec4<f32>(0.0)) & (floor(b) < b);\n",Gz="if (a < 0.0) { return b * a; }  return a;",qz="\n  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));\n  return (aLessThanZero * (b * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);\n",Xz="return (a - b) * (a - b);",Kz="return a - b;";function Zz(e,t){let n;do{switch(e){case dz.ATAN2:n=fz;break;case dz.MAX:n=Fz;break;case dz.MIN:n=Lz;break;case dz.MOD:n=t?Bz:zz;break;case dz.NOT_EQUAL:n=t?Vz:Wz;break;case dz.POW:n=t?Hz:jz;break;default:continue}let r,a,i;return t?(r="isnanVec4",a="vec4<f32>",i="vec4<bool>"):(r="isnan",a="f32",i="bool"),`\n      let aIsNaN = ${r}(a);\n      let aPostLegalization = select(a, ${a}(42), aIsNaN);\n      let bIsNaN = ${r}(b);\n      let bPostLegalization = select(b, ${a}(42), bIsNaN);\n      let isNaN = false;\n      let valueForNaN = uniforms.NAN;\n      {\n        let a = aPostLegalization;\n        let b = bPostLegalization;\n        ${n}\n        return select(\n            resultTemp, ${a}(valueForNaN),\n            ${i}(isNaN) | aIsNaN | bIsNaN);\n      }\n    `}while(0);switch(e){case dz.ADD:return mz;case dz.COMPLEX_MULTIPLY_IMAG:return yz;case dz.COMPLEX_MULTIPLY_REAL:return gz;case dz.DIV:return bz;case dz.ELU_DER:return t?Az:xz;case dz.EQUAL:return t?wz:vz;case dz.GREATER:return t?Sz:kz;case dz.GREATER_EQUAL:return t?_z:Tz;case dz.INT_DIV:return t?Cz:Iz;case dz.LESS:return t?Nz:Ez;case dz.LESS_EQUAL:return t?Pz:Rz;case dz.LOGICAL_AND:return t?Mz:Dz;case dz.LOGICAL_OR:return t?$z:Oz;case dz.MUL:return Uz;case dz.PRELU:return t?qz:Gz;case dz.SQUARED_DIFFERENCE:return Xz;case dz.SUB:return Kz}return`\n    ${n}\n    return resultTemp;\n  `}!function(e){e[e.ABS=0]="ABS",e[e.ACOS=1]="ACOS",e[e.ACOSH=2]="ACOSH",e[e.ASIN=3]="ASIN",e[e.ASINH=4]="ASINH",e[e.ATAN=5]="ATAN",e[e.ATANH=6]="ATANH",e[e.CEIL=7]="CEIL",e[e.COS=8]="COS",e[e.COSH=9]="COSH",e[e.ELU=10]="ELU",e[e.ERF=11]="ERF",e[e.EXP=12]="EXP",e[e.EXPM1=13]="EXPM1",e[e.FLOOR=14]="FLOOR",e[e.IS_FINITE=15]="IS_FINITE",e[e.IS_INF=16]="IS_INF",e[e.IS_NAN=17]="IS_NAN",e[e.LINEAR=18]="LINEAR",e[e.LOG=19]="LOG",e[e.LOG1P=20]="LOG1P",e[e.LOGICAL_NOT=21]="LOGICAL_NOT",e[e.NEG=22]="NEG",e[e.RELU=23]="RELU",e[e.RELU6=24]="RELU6",e[e.LEAKYRELU=25]="LEAKYRELU",e[e.RECIPROCAL=26]="RECIPROCAL",e[e.ROUND=27]="ROUND",e[e.RSQRT=28]="RSQRT",e[e.SELU=29]="SELU",e[e.SIGMOID=30]="SIGMOID",e[e.SIGN=31]="SIGN",e[e.SIN=32]="SIN",e[e.SINH=33]="SINH",e[e.SOFTPLUS=34]="SOFTPLUS",e[e.SQRT=35]="SQRT",e[e.SQUARE=36]="SQUARE",e[e.STEP=37]="STEP",e[e.TAN=38]="TAN",e[e.TANH=39]="TANH",e[e.TO_INT=40]="TO_INT"}(pz||(pz={}));var Yz="return abs(a);",Jz="\n  if (abs(a) > 1.) {\n    return uniforms.NAN;\n  }\n  return acos(a);\n",Qz="\n  if (a < 1.) {\n    return uniforms.NAN;\n  }\n  return acosh(a);\n",eB="\n  if (abs(a) > 1.) {\n    return uniforms.NAN;\n  }\n  return asin(a);\n",tB="return asinh(a);",nB="\n  if (isnan(a)) {\n    return uniforms.NAN;\n  }\n  return atan(a);\n",rB="\n  if (abs(a) > 1.) {\n    return uniforms.NAN;\n  }\n  if (a == 1.) {\n    return uniforms.INFINITY;\n  }\n  if (a == -1.) {\n    return -uniforms.INFINITY;\n  }\n  return atanh(a);\n",aB="return ceil(a);",iB="return cos(a);",sB="\n  let e2x = exp(-a);\n  return (e2x + 1.0 / e2x) / 2.0;\n",oB="return exp(a) - 1.0;",lB="if (a >= 0.0) { return a; }  return (exp(a) - 1.0);",uB="\n  var resFloat = exp(a) - vec4<f32>(1.0);\n  if (a.r >= 0.0) {\n    resFloat.r = a.r;\n  }\n  if (a.g >= 0.0) {\n    resFloat.g = a.g;\n  }\n  if (a.b >= 0.0) {\n    resFloat.b = a.b;\n  }\n  if (a.a >= 0.0) {\n    resFloat.a = a.a;\n  }\n  return resFloat;\n",dB=`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  let p = ${$m.ERF_P};\n  let a1 = ${$m.ERF_A1};\n  let a2 = ${$m.ERF_A2};\n  let a3 = ${$m.ERF_A3};\n  let a4 = ${$m.ERF_A4};\n  let a5 = ${$m.ERF_A5};\n\n  let sign = sign(a);\n  let absA = abs(a);\n  let t = 1.0 / (1.0 + p * absA);\n  return sign * (1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-absA * absA));\n`,cB="return exp(a);",hB="return floor(a);",pB="return f32(!isnan(a) && !isinf(a));",mB="return f32(isinf(a));",fB="return f32(isnan(a));",gB="return a;",yB="if (a < 0.0) { return uniforms.NAN; }\n  return log(a);",bB="\n  if (isnan(a)) { return a; }\n  return log(1.0 + a);\n",xB="return f32(!(a >= 1.0));",AB="return -a;",vB="if (a < 0.0) { return uniforms.alpha * a; } return a;",wB="\n  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));\n  return (aLessThanZero * (uniforms.alpha * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);\n",kB="return 1.0 / a;",SB="return select(a, 0.0, a < 0.0);",TB="return clamp(a, 0.0, 6.0);",_B="return clamp(a, vec4<f32>(0.0, 0.0, 0.0, 0.0), vec4<f32>(6.0, 6.0, 6.0, 6.0));",IB="\n  return select(a, vec4<f32>(0.0), a < vec4<f32>(0.0));\n",CB="return round(a);",EB="return inverseSqrt(a);",NB=`\n  if (a >= 0.0) {\n    return ${$m.SELU_SCALE} * a;\n  } else {\n    return ${$m.SELU_SCALEALPHA} * (exp(a) - 1.0);\n  }\n`,RB="return 1.0 / (1.0 + exp(-1.0 * a));",PB="return sign(a);",DB="return sin(a);",MB="\n  let e2x = exp(a);\n  return (e2x - 1.0 / e2x) / 2.0;\n",OB="\n  let epsilon = 1.1920928955078125e-7;\n  let threshold = log(epsilon) + 2.0;\n\n  let too_large = a > -threshold;\n  let too_small = a < threshold;\n  let exp_a = exp(a);\n\n  if (too_large) {\n    return a;\n  } else if (too_small) {\n    return exp_a;\n  } else {\n    return log(exp_a + 1.0);\n  }\n",$B="return sqrt(a);",FB="return a * a;",LB="\n  if (isnan(a)) {\n    return a;\n  }\n\n  return select(uniforms.stepAlpha, 1.0, a > 0.0);\n",zB="return tan(a);",BB="\n  let e2x = exp(-2.0 * abs(a));\n  return sign(a) * (1.0 - e2x) / (1.0 + e2x);\n",UB="return f32(i32((a)));";function WB(e,t){switch(e){case pz.ABS:return Yz;case pz.ACOS:return Jz;case pz.ACOSH:return Qz;case pz.ASIN:return eB;case pz.ASINH:return tB;case pz.ATAN:return nB;case pz.ATANH:return rB;case pz.COS:return iB;case pz.COSH:return sB;case pz.CEIL:return aB;case pz.ELU:return t?uB:lB;case pz.ERF:return dB;case pz.EXP:return cB;case pz.EXPM1:return oB;case pz.FLOOR:return hB;case pz.IS_FINITE:return pB;case pz.IS_INF:return mB;case pz.IS_NAN:return fB;case pz.LINEAR:return gB;case pz.LOG:return yB;case pz.LOG1P:return bB;case pz.LOGICAL_NOT:return xB;case pz.NEG:return AB;case pz.LEAKYRELU:return t?wB:vB;case pz.RECIPROCAL:return kB;case pz.RELU:return t?IB:SB;case pz.RELU6:return t?_B:TB;case pz.ROUND:return CB;case pz.RSQRT:return EB;case pz.SELU:return NB;case pz.SIGMOID:return RB;case pz.SIGN:return PB;case pz.SIN:return DB;case pz.SINH:return MB;case pz.SOFTPLUS:return OB;case pz.SQRT:return $B;case pz.SQUARE:return FB;case pz.STEP:return LB;case pz.TAN:return zB;case pz.TANH:return BB;case pz.TO_INT:return UB;default:throw new Error(`BinaryType ${e} is not implemented!`)}}function VB(e,t=!1,n=!1,r=3){if(null===e)return"";let a="";if("linear"===e)a=WB(pz.LINEAR);else if("relu"===e)a=WB(pz.RELU,n);else if("elu"===e)a=WB(pz.ELU,n);else if("relu6"===e)a=WB(pz.RELU6,n);else if("prelu"===e)a=Zz(dz.PRELU,n);else if("sigmoid"===e)a=WB(pz.SIGMOID,n);else{if("leakyrelu"!==e)throw new Error(`Activation ${e} has not been implemented for the WebGPU backend.`);a=WB(pz.LEAKYRELU,n)}let i=BL(n?4:1),s="";return s=t?`\n      fn activation(a : ${i}, coords : vec${r}<i32>) -> ${i} {\n        let b = getPreluActivationWeightsByOutputCoords(coords);\n        ${a}\n      }`:`\n      fn activation(a : ${i}, coords : vec${r}<i32>) -> ${i} {\n        ${a}\n      }`,s}function jB(e,t){return`\n      ${e?"value = value + getBiasByOutputCoords(coords);":""}\n      ${t?"value = activation(value, coords);":""}\n      `}function HB(e,t,n=!1,r=!1,a=!1,i=1){Sa.assert(e&&1===i||!e,(()=>`transposeA ${e} is not compatible with component size ${i}`));let s=`\n      ${e?"value = getA(batch, col, row);":"value = getA(batch, row, col);"}\n\n    `,o=t?"value = getB(batch, col, row);":"value = getB(batch, row, col);";return`\n  fn mm_readA(batch: i32, row: i32, colIn: i32) -> ${BL(i)} {\n    var value = ${BL(i)}(0.0);\n    let col = colIn * ${i};\n    ${n&&a?s:`\n    ${e?"if(row < uniforms.dimAOuter && col < uniforms.dimInner)":"if(row < uniforms.aShape[1] && col < uniforms.aShape[2])"}\n    {\n      ${s}\n    }\n    `}\n    return value;\n  }\n\n  fn mm_readB(batch: i32, row: i32, colIn: i32) -> ${BL(i)} {\n    let col = colIn * ${i};\n    var value = ${BL(i)}(0.0);\n    ${o}\n    return value;\n  }\n  `}function GB(e,t,n,r,a=!1,i=!1,s=!1,o=1){return`\n  ${HB(n,r,a,i,s,o)}\n  fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${BL(o)}) {\n    let col = colIn * ${o};\n    ${a&&i?"":"if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)"}\n    {\n      var value = valueIn;\n      let coords = vec3<i32>(batch, row, col);\n      ${jB(e,t)}\n      setOutputAtCoords(coords[0], coords[1], coords[2], value);\n    }\n  }\n  `}function qB(e,t,n=!1,r=32,a=!1,i=32,s=!1){let o=t[1]*e[1],l=t[0]*e[0],u=n?o:r,d=n?r:o,c=u/t[0],h=r/t[1],p=e[1];return Sa.assert((n&&4===c&&4===e[1]||!n&&(3===c||4===c))&&u%t[0]==0&&r%t[1]==0&&4===e[0],(()=>`If transposeA ${n} is true, innerElementSize ${c} and workPerThread[1] ${e[1]} must be 4.\n          Otherwise, innerElementSize ${c} must be 3 or 4.\n      tileAWidth ${u} must be divisible by workgroupSize[0]${t[0]}. tileInner ${r} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`)),`\n  var<workgroup> mm_Asub : array<array<vec${c}<f32>, ${u/c}>, ${d}>;\n  var<workgroup> mm_Bsub : array<array<vec4<f32>, ${l/e[0]}>, ${r}>;\n\n  ${VL()} {\n    let localRow = i32(localId.y);\n    let tileRow = localRow * ${p};\n    let tileCol = i32(localId.x);\n\n    let globalRow = i32(globalId.y) * ${p};\n    let globalCol = i32(globalId.x);\n    let batch = ${a?"0":"i32(globalId.z)"};\n    let batchA = ${a||!s?"batch":"batch % uniforms.aShape[0]"};\n    let batchB = ${a||!s?"batch":"batch % uniforms.bShape[0]"};\n    let globalRowStart = i32(workgroupId.y) * ${o};\n\n    let numTiles = ${a?`${Math.ceil(i/r)}`:`(uniforms.dimInner - 1) / ${r} + 1`};\n    var kStart = ${a?`i32(globalId.z) * ${i}`:"0"};\n\n    var acc: array<vec4<f32>, ${p}>;\n\n    // Loop over shared dimension.\n    let tileRowB = localRow * ${h};\n    for (var t = 0; t < numTiles; t++) {\n        // Load one tile of A into local memory.\n        for (var innerRow = 0; innerRow < ${p}; innerRow++) {\n            let inputRow = tileRow + innerRow;\n            let inputCol = tileCol;\n            ${((e,t)=>e?`\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          kStart + inputRow,\n          globalRowStart / ${t} + inputCol);\n        `:`\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          globalRow + innerRow,\n          kStart / ${t} + inputCol);\n        `)(n,c)}\n        }\n\n        // Load one tile of B into local memory.\n        for (var innerRow = 0; innerRow < ${h}; innerRow++) {\n            let inputRow = tileRowB + innerRow;\n            let inputCol = tileCol;\n            mm_Bsub[inputRow][inputCol] = mm_readB(batchB, kStart + inputRow, globalCol);\n        }\n        kStart = kStart + ${r};\n        workgroupBarrier();\n\n        // Compute acc values for a single thread.\n        for (var k = 0; k < ${r/c}; k++) {\n            let BCached0 = mm_Bsub[k * ${c}][tileCol];\n            let BCached1 = mm_Bsub[k * ${c} + 1][tileCol];\n            let BCached2 = mm_Bsub[k * ${c} + 2][tileCol];\n            ${3===c?"":`let BCached3 = mm_Bsub[k * ${c} + 3][tileCol];`}\n\n            ${((e,t,n)=>e?`\n        let ACached0 = mm_Asub[k * ${t}][localRow];\n        let ACached1 = mm_Asub[k * ${t} + 1][localRow];\n        let ACached2 = mm_Asub[k * ${t} + 2][localRow];\n        ${3===t?"":`let ACached3 = mm_Asub[k * ${t} + 3][localRow];`}\n        for (var i = 0; i < ${n}; i++) {\n          acc[i] = fma(BCached0, vec4<f32>(ACached0[i]), acc[i]);\n          acc[i] = fma(BCached1, vec4<f32>(ACached1[i]), acc[i]);\n          acc[i] = fma(BCached2, vec4<f32>(ACached2[i]), acc[i]);\n          ${3===t?"":"acc[i] = fma(BCached3, vec4<f32>(ACached3[i]), acc[i]);"}\n        }`:`\n        for (var i = 0; i < ${n}; i++) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = fma(BCached0, vec4<f32>(ACached.x), acc[i]);\n          acc[i] = fma(BCached1, vec4<f32>(ACached.y), acc[i]);\n          acc[i] = fma(BCached2, vec4<f32>(ACached.z), acc[i]);\n          ${3===t?"":"acc[i] = fma(BCached3, vec4<f32>(ACached.w), acc[i]);"}\n        }`)(n,c,p)}\n        }\n\n        workgroupBarrier();\n    }\n\n    for (var innerRow = 0; innerRow < ${p}; innerRow++) {\n        mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n    }\n  }`}var XB=e=>e?"\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          kStart + inputRow,\n          globalRowStart + inputCol);\n        ":"\n        mm_Asub[inputRow][inputCol] = mm_readA(batchA,\n          globalRowStart + inputRow,\n          kStart + inputCol);\n        ";function KB(e,t,n=!1,r=32,a=!1,i=32,s=!1,o=!1){let l=e[1]*t[1],u=e[0]*t[0],d=n?l:r,c=n?r:l;Sa.assert(c%t[1]==0&&d%t[0]==0&&r%t[1]==0,(()=>`tileAHight ${c} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${d} must be divisible by workgroupSize[0]${t[0]}, tileInner ${r} must be divisible by workgroupSize[1]${t[1]}`));let h=c/t[1],p=d/t[0],m=r/t[1],f=e[1],g=e[0],y=s?`\n      let localRow = i32(localId.y);\n      let localCol = i32(localId.x);\n      let globalRowStart = i32(workgroupId.y) * ${l};\n      let globalColStart = i32(workgroupId.x) * ${u};\n\n      // Loop over shared dimension.\n      for (var t = 0; t < numTiles; t++) {\n        // Load one tile of A into local memory.\n        for (var inputRow = localRow; inputRow < ${c}; inputRow = inputRow + ${t[1]}) {\n          for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${t[0]}) {\n            ${XB(n)}\n          }\n        }\n        // Load one tile of B into local memory.\n        for (var inputRow = localRow; inputRow < ${r}; inputRow = inputRow + ${t[1]}) {\n              for (var inputCol = localCol; inputCol < ${u}; inputCol = inputCol + ${t[0]}) {\n            mm_Bsub[inputRow][inputCol] = mm_readB(batchB,\n              kStart + inputRow,\n              globalColStart + inputCol);\n          }\n        }\n        kStart = kStart + ${r};\n        workgroupBarrier();\n\n        // Compute acc values for a single thread.\n        var BCached : array<f32, ${g}>;\n        for (var k = 0; k < ${r}; k++) {\n          for (var inner = 0; inner < ${g}; inner++) {\n            BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];\n          }\n          for (var innerRow = 0; innerRow < ${f}; innerRow++) {\n            let ACached = ${n?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}\n            for (var innerCol = 0; innerCol < ${g}; innerCol++) {\n              acc[innerRow][innerCol] =\n                  fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);\n            }\n          }\n        }\n        workgroupBarrier();\n      }\n      for (var innerRow = 0; innerRow < ${f}; innerRow++) {\n        let gRow = globalRowStart + localRow + innerRow * ${t[1]};\n        for (var innerCol = 0; innerCol < ${g}; innerCol++) {\n          let gCol = globalColStart + localCol + innerCol * ${t[0]};\n          mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n        }\n      }\n      `:`\n  let tileRow = i32(localId.y) * ${f};\n  let tileCol = i32(localId.x) * ${g};\n\n  let globalRow = i32(globalId.y) * ${f};\n  let globalCol = i32(globalId.x) * ${g};\n  let globalRowStart = i32(workgroupId.y) * ${l};\n\n  let tileRowA = i32(localId.y) * ${h};\n  let tileColA = i32(localId.x) * ${p};\n  let tileRowB = i32(localId.y) * ${m};\n  // Loop over shared dimension.\n  for (var t = 0; t < numTiles; t++) {\n    // Load one tile of A into local memory.\n    for (var innerRow = 0; innerRow < ${h}; innerRow++) {\n      for (var innerCol = 0; innerCol < ${p}; innerCol++) {\n        let inputRow = tileRowA + innerRow;\n        let inputCol = tileColA + innerCol;\n        ${XB(n)}\n      }\n    }\n\n    // Load one tile of B into local memory.\n    for (var innerRow = 0; innerRow < ${m}; innerRow++) {\n      for (var innerCol = 0; innerCol < ${g}; innerCol++) {\n        let inputRow = tileRowB + innerRow;\n        let inputCol = tileCol + innerCol;\n        mm_Bsub[inputRow][inputCol] = mm_readB(batchB,\n          kStart + inputRow,\n          globalCol + innerCol);\n      }\n    }\n    kStart = kStart + ${r};\n    workgroupBarrier();\n\n    // Compute acc values for a single thread.\n    var BCached : array<f32, ${g}>;\n    for (var k = 0; k < ${r}; k++) {\n      for (var inner = 0; inner < ${g}; inner++) {\n        BCached[inner] = mm_Bsub[k][tileCol + inner];\n      }\n\n      for (var innerRow = 0; innerRow < ${f}; innerRow++) {\n        ${(e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];")(n)}\n        for (var innerCol = 0; innerCol < ${g}; innerCol++) {\n          acc[innerRow][innerCol] =\n              fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);\n        }\n      }\n    }\n\n    workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < ${f}; innerRow++) {\n    for (var innerCol = 0; innerCol < ${g}; innerCol++) {\n      mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n          acc[innerRow][innerCol]);\n    }\n  }\n  `;return`\n    var<workgroup> mm_Asub : array<array<f32, ${d}>, ${c}>;\n    var<workgroup> mm_Bsub : array<array<f32, ${u}>, ${r}>;\n\n    ${VL()} {\n      let batch = ${a?"0":"i32(globalId.z)"};\n      let batchA = ${a||!o?"batch":"batch % uniforms.aShape[0]"};\n      let batchB = ${a||!o?"batch":"batch % uniforms.bShape[0]"};\n      let numTiles = ${a?`${Math.ceil(i/r)}`:`(uniforms.dimInner - 1) / ${r} + 1`};\n      var kStart = ${a?`i32(globalId.z) * ${i}`:"0"};\n\n      var acc : array<array<f32, ${g}>, ${f}>;\n\n      // Without this initialization strange values show up in acc.\n      for (var innerRow = 0; innerRow < ${f}; innerRow++) {\n        for (var innerCol = 0; innerCol < ${g}; innerCol++) {\n          acc[innerRow][innerCol] = 0.0;\n        }\n      }\n      ${y}\n    }\n  `}var ZB=class{constructor(e,t,n=!1,r=!1,a=null,i=null,s=null,o=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=t,this.dispatchLayout={x:[2],y:[1],z:[0]};let l=n?e[1]:e[2];if(this.isVec4=(l%4==0&&!n||t[1]%4==0&&n)&&t[2]%4==0&&!r,this.outputComponent=this.isVec4?4:1,this.isVectorA=1===t[1]&&!n,!this.isVec4&&this.isVectorA)this.elementsPerThread=[1,1,1],this.workgroupSize=[32,1,1];else{let e=rz(t[1],l,t[2],n);this.workgroupSize=e.workgroupSize,this.elementsPerThread=e.elementsPerThread}this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread);let u=null!=a,d=null!=s;u&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.sequentialAccessByThreads=o,this.transposeA=n,this.transposeB=r,this.addBias=u,this.activation=i,this.hasPreluActivationWeights=d,[this.fitAOuter,this.fitBOuter,this.fitInner]=this.getShapeFit(t[1],t[2],l),this.shaderKey=`matMulPacked_${this.elementsPerThread}_${n}_${r}_${this.activation}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.isVectorA}_${this.sequentialAccessByThreads}`}getShapeFit(e,t,n){let r=this.workgroupSize[1]*this.elementsPerThread[1],a=this.workgroupSize[0]*this.elementsPerThread[0];return!this.isVec4&&this.isVectorA?this.tileInner=4*this.workgroupSize[0]:this.tileInner=a,[e%r==0,t%a==0,n%this.tileInner==0]}getUserCode(){return`\n      ${VB(this.activation,this.hasPreluActivationWeights,this.isVec4)}\n      ${GB(this.addBias,this.activation,!1,this.transposeB,this.fitAOuter,this.fitBOuter,this.fitInner,this.isVec4?4:1)}\n      ${this.isVec4?qB(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,!0):this.isVectorA?function(e,t=!1){Sa.assert(1===e[1]&&1===e[2],(()=>`A linear work group size is required. But got ${e}.`));let n=4*e[0];return`\n    var<workgroup> mm_Asub : array<vec4<f32>, ${e[0]}>;\n\n    ${VL()} {\n      let tileCol = i32(localId.x);\n      let globalCol = i32(globalId.x);\n      let globalRow = i32(globalId.y);\n\n      let numTiles = (uniforms.dimInner - 1) / ${n} + 1;\n      let batch = i32(globalId.z);\n      let batchA = batch % uniforms.aShape[0];\n      let batchB = batch % uniforms.bShape[0];\n      // Without this initialization strange values show up in acc.\n      var acc = 0.0;\n\n      // Loop over shared dimension.\n      for (var t = 0; t < numTiles; t++) {\n        // Load one tile of A into local memory.\n        let colA = t * ${n} + tileCol * 4;\n        mm_Asub[tileCol] = vec4<f32>(${(e=>e?"\n      mm_readA(batchA, colA, globalRow),\n      mm_readA(batchA, colA + 1, globalRow),\n      mm_readA(batchA, colA + 2, globalRow),\n      mm_readA(batchA, colA + 3, globalRow)\n  ":"\n      mm_readA(batchA, globalRow, colA),\n      mm_readA(batchA, globalRow, colA + 1),\n      mm_readA(batchA, globalRow, colA + 2),\n      mm_readA(batchA, globalRow, colA + 3)\n  ")(t)});\n        workgroupBarrier();\n\n        // Compute acc values for a single thread.\n        for (var k = 0; k < ${n/4}; k++) {\n          let rowB = t * ${n} + k * 4;\n          let BCached = vec4<f32>(mm_readB(batchB, rowB, globalCol),\n                              mm_readB(batchB, rowB + 1, globalCol),\n                              mm_readB(batchB, rowB + 2, globalCol),\n                              mm_readB(batchB, rowB + 3, globalCol));\n\n          let ACached = mm_Asub[k];\n          acc = acc + dot(ACached, BCached);\n        }\n\n        workgroupBarrier();\n      }\n\n      mm_write(batch, globalRow, globalCol, acc);\n    }\n  `}(this.workgroupSize,this.transposeA):KB(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.sequentialAccessByThreads,!0)}\n    `}},YB=class{constructor(e,t=!1,n=!1,r=null,a=null,i=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout={x:[],y:[1,2],z:[0]},this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize);let s=null!=r,o=null!=i;s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.transposeA=t,this.transposeB=n,this.addBias=s,this.activation=a,this.hasPreluActivationWeights=o,this.shaderKey=`matMulReduce_${this.activation}_${t}_${n}`}getUserCode(){return`\n      ${VB(this.activation,this.hasPreluActivationWeights)}\n      ${GB(this.addBias,this.activation,this.transposeA,this.transposeB)}\n      ${function(e){return`\n    var<workgroup> sumValues : array<f32, ${e}>;\n    ${VL()} {\n      let coords = getOutputCoords();\n      let batch = coords[0];\n      let batchA = batch % uniforms.aShape[0];\n      let batchB = batch % uniforms.bShape[0];\n      let row = coords[1];\n      let col = coords[2];\n      var sum = 0.0;\n      let Length = uniforms.dimInner;\n      for (var k = i32(localId.x); k < Length; k = k + ${e}) {\n        let dataA = mm_readA(batchA, row, k);\n        let dataB = mm_readB(batchB, k, col);\n        sum = sum + dataA * dataB;\n      }\n      sumValues[localId.x] = sum;\n      workgroupBarrier();\n\n      for(var currentSize = ${e/2}u; currentSize > 1u;\n          currentSize = currentSize / 2u) {\n        if (localId.x < currentSize)\n        {\n          sumValues[localId.x] = sumValues[localId.x] + sumValues[localId.x + currentSize];\n        }\n        workgroupBarrier();\n      }\n\n      if (localId.x == 0u) {\n        sum = sumValues[0] + sumValues[1];\n        mm_write(batch, row, col, sum);\n      }\n    }\n  `}(this.workgroupSize[0])}\n    `}},JB=class{constructor(e,t,n,r=!1,a=!1,i=null,s=null,o=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[16,8,1],this.outputShape=n,this.dispatchLayout={x:[2],y:[1],z:[0]},this.dispatch=[Math.ceil(n[2]/this.workgroupSize[0]),Math.ceil(n[1]/this.workgroupSize[1]),n[0]];let l=null!=i;l&&this.variableNames.push("bias");let u=null!=o;u&&this.variableNames.push("preluActivationWeights"),this.transposeA=r,this.transposeB=a,this.addBias=l,this.activation=s,this.hasPreluActivationWeights=u,this.shaderKey=`matMulSmallOutputSize_${this.activation}_${r}_${a}`}getUserCode(){return`\n      ${VB(this.activation,this.hasPreluActivationWeights)}\n      ${GB(this.addBias,this.activation,this.transposeA,this.transposeB)}\n      ${function(e){let t=e[1],n=e[0],r=t>n?t:n;return`\n  var<workgroup> mm_Asub : array<array<f32, ${r}>, ${t}>;\n  var<workgroup> mm_Bsub : array<array<f32, ${n}>, ${r}>;\n\n  // If the output size is small for matrix multiplication, avoid to use vec4\n  // and handle some elements per thread to optimally utilize the ALU.\n  // Read data from global memory to registers firstly, then store them into\n  // shared memory, so it is instruction-Level parallelism for arithmetic\n  // operations and others handle IO operations between barrier api, makes ALU\n  // and load/store units work simultaneously, could improves the performance.\n  ${VL()} {\n    let tileRow = i32(localId.y);\n    let tileCol = i32(localId.x);\n    let globalRow = i32(globalId.y);\n    let globalCol = i32(globalId.x);\n    let batch = i32(globalId.z);\n    let batchA = batch % uniforms.aShape[0];\n    let batchB = batch % uniforms.bShape[0];\n\n    // uniforms.dimInner should be greater than 0.\n    let numTiles = (uniforms.dimInner - 1) / ${r} + 1;\n    var acc = 0.0;\n\n    var globalColA = tileCol;\n    var globalRowB = 0;\n    var regA = mm_readA(batchA, globalRow, globalColA);\n    var regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);\n    var regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);\n    globalColA = globalColA + ${r};\n    globalRowB = globalRowB + ${r};\n\n    for (var t = 0; t < numTiles; t = t + 1) {\n      mm_Asub[tileRow][tileCol] = regA;\n      mm_Bsub[2 * tileRow][tileCol] = regB0;\n      mm_Bsub[2 * tileRow + 1][tileCol] = regB1;\n\n      workgroupBarrier();\n\n      regA = mm_readA(batchA, globalRow, globalColA);\n      regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);\n      regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);\n      globalColA = globalColA + ${r};\n      globalRowB = globalRowB + ${r};\n\n      for (var k = 0; k < ${r}; k = k + 1) {\n        acc = acc + mm_Asub[tileRow][k] * mm_Bsub[k][tileCol];\n      }\n      workgroupBarrier();\n    }\n\n    mm_write(batch, globalRow, globalCol, acc);\n  }\n  `}(this.workgroupSize)}\n    `}},QB=class{constructor(e,t,n=!1,r=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[8,8,1],this.atomic=!0,this.splitedDimInner=128,Sa.assert(1===e[0],(()=>"MatMulSplitKProgram only supports batch = 1.")),this.outputShape=e,this.dispatchLayout={x:[2],y:[1],z:[0,3]};let a=(n&&this.outputShape[1]%4==0||!n&&t%4==0)&&this.outputShape[2]%4==0;this.elementsPerThread=[4,4,this.splitedDimInner],this.outputComponent=a?4:1,a||(this.outputShape[1]<16&&(this.elementsPerThread[1]=1),this.outputShape[2]<16&&(this.elementsPerThread[0]=1)),this.dispatch=nz(this.dispatchLayout,[this.outputShape[0],this.outputShape[1],this.outputShape[2],t],this.workgroupSize,this.elementsPerThread),this.transposeA=n,this.transposeB=r,this.shaderKey=`matMulSplitK_${n}_${r}_${this.elementsPerThread}_${this.outputComponent}`}getUserCode(){let e=this.outputComponent;return`\n      ${HB(!1,this.transposeB,!1,!1,!1,e)}\n      fn mm_write(batch: i32, row : i32, colIn : i32, value : ${BL(e)}) {\n        let col = colIn * ${e};\n        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {\n          let coords = vec3<i32>(batch, row, col);\n          let flatIndex = getOutputIndexFromCoords(coords);\n          // The problem is that we should initialize output to zero before using.\n          // Otherwise, the original value will be added to the result.\n          for (var i = 0; i < ${e}; i = i + 1) {\n            ${zL("&result[flatIndex + i]",e>1?"value[i]":"value","float32")}\n          }\n        }\n      }\n      ${4===e?qB(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner):KB(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner)}\n    `}},eU=class{constructor(e,t=null,n=null,r=null){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=null!=t,this.hasPreluActivationWeights=null!=r,this.activation=n,this.addBias&&this.variableNames.push("bias"),this.hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`biasActivation_${n}`}getUserCode(){return`\n    ${VB(this.activation,this.hasPreluActivationWeights)}\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        var value = getXByOutputIndex(index);\n        ${jB(this.addBias,this.activation)}\n        setOutputAtIndex(index, value);\n      }\n    }\n    `}},tU=class{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="value : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="fill"}getUserCode(){return`\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        setOutputAtIndex(index, uniforms.value);\n      }\n    }\n  `}};function nU(e){let{backend:t,attrs:n}=e,{shape:r,value:a}=n,{dtype:i}=n;if(i=i||Sa.inferDtype(a),"string"===i){let e=Sa.getArrayFromDType(i,Sa.sizeFromShape(r));return e.fill(a),t.makeTensorInfo(r,i,e)}{let e=new tU(r),n=[{type:"float32",data:[a]}];return t.runWebGPUProgram(e,[],i,n)}}var rU={kernelName:Qt,backendName:"webgpu",kernelFunc:nU};function aU(e){let{inputs:t,attrs:n}=e,{x:r}=t,{shape:a}=n,i=Sa.sizeFromShape(r.shape),s=Sa.inferFromImplicitShape(a,i),o=Sa.sizeFromShape(s);return Sa.assert(i===o,(()=>`The new shape (${s}) has ${o} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`)),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:s,dtype:r.dtype}}var iU={kernelName:dr,backendName:"webgpu",kernelFunc:aU};function sU({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}){let u=e.shape.length,d=t.shape.length,c=n?e.shape[u-2]:e.shape[u-1],h=r?t.shape[d-1]:t.shape[d-2],p=n?e.shape[u-1]:e.shape[u-2],m=r?t.shape[d-2]:t.shape[d-1],f=e.shape.slice(0,-2),g=t.shape.slice(0,-2),y=Sa.sizeFromShape(f),b=Sa.sizeFromShape(g),x=Ml.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([p,m]);Sa.assert(c===h,(()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`));let A,v,w=n?[y,c,p]:[y,p,c],k=r?[b,m,h]:[b,h,m],S=aU({inputs:{x:e},backend:a,attrs:{shape:w}}),T=aU({inputs:{x:t},backend:a,attrs:{shape:k}}),_=[S,T],I=Math.max(y,b),C=[S,T],E=[{type:"int32",data:[p]},{type:"int32",data:[m]},{type:"int32",data:[c]}],N=[I,p,m],R=Ue().get("WEBGPU_MATMUL_PROGRAM_TYPE");if(R<0){let e=Ue().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),t=e>0?e:a.thresholdToIncreaseWorkgroups,n=I*Math.ceil(p/32)*Math.ceil(m/32);R=n<=t||p<=8&&n<=2*t?I*p*m<=128?QL.MatMulReduceProgram:1===I&&h>=2e3?QL.MatMulSplitKProgram:QL.MatMulSmallOutputSizeProgram:QL.MatMulPackedProgram}switch(R){case QL.MatMulReduceProgram:A=new YB(N,n,r,i,l,s);break;case QL.MatMulSplitKProgram:if(v=nU({backend:a,attrs:{shape:N,value:0,dtype:e.dtype}}),A=new QB(N,h,n,r),i||l){v=a.runWebGPUProgram(A,C,e.dtype,E,v);let t=new eU(v.shape,i,l,s),n=null,r=[v];i&&r.push(i),s&&r.push(s),"leakyrelu"===l&&(n=[{type:"float32",data:[o]}],t.uniforms+=" alpha : f32,");let u=a.runWebGPUProgram(t,r,v.dtype,n);_.push(v);let d=aU({inputs:{x:u},backend:a,attrs:{shape:x}});_.push(u);for(let e of _)a.disposeData(e.dataId);return d}break;case QL.MatMulSmallOutputSizeProgram:A=new JB(w,k,N,n,r,i,l,s);break;case QL.MatMulPackedProgram:let t=a.adapterInfo.isIntel();A=new ZB(w,N,n,r,i,l,s,t);break;default:throw new Error(`Unsupported MatMulProgramType ${R}.`)}i&&C.push(i),s&&C.push(s),"leakyrelu"===l&&(E.push({type:"float32",data:[o]}),A.uniforms+=" alpha : f32,"),v=a.runWebGPUProgram(A,C,e.dtype,E,v);let P=aU({inputs:{x:v},backend:a,attrs:{shape:x}});_.push(v);for(let e of _)a.disposeData(e.dataId);return P}var oU={kernelName:la,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:c}=r;return sU({a,b:i,transposeA:l,transposeB:u,backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:c,activation:d})}},lU=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=$m.assertAndGetBroadcastShape(t,n),this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`binaryOpComplex_${e}`,this.op=e}getUserCode(){return`\n      fn binaryOpComplex(\n          areal : f32, aimag : f32, breal : f32, bimag : f32) -> f32 {\n        ${Zz(this.op,!1)}\n      }\n\n      ${VL("index")} {\n        if(index < uniforms.size) {\n          let areal = getARealByOutputIndex(index);\n          let aimag = getAImagByOutputIndex(index);\n          let breal = getBRealByOutputIndex(index);\n          let bimag = getBImagByOutputIndex(index);\n          setOutputAtIndex(index, binaryOpComplex(areal, aimag, breal, bimag));\n        }\n      }\n    `}},uU=class{constructor(e,t,n){if(this.size=!0,this.variableNames=["A","B"],this.outputShape=$m.assertAndGetBroadcastShape(t,n),this.dispatchLayout=sz(this.outputShape),this.op=e,this.useSharedMemoryWithA=t.length<=1&&n.length>1&&t[0]<128,this.useSharedMemoryWithB=n.length<=1&&t.length>1&&n[0]<128,this.useSharedMemoryWithA||this.useSharedMemoryWithB)this.outputComponent=1,this.variableComponents=[1,1],this.lastDimensionSize=this.useSharedMemoryWithB?n[0]:t[0],this.shaderKey=`binary_${e}_${this.lastDimensionSize}`,this.type="shared",this.workgroupSize=[256,1,1];else{let r=t.length>0&&t[t.length-1]%4==0,a=n.length>0&&n[n.length-1]%4==0;r&&a?(this.outputComponent=4,this.variableComponents=[4,4]):r&&(Sa.isScalarShape(n)||1===n[n.length-1])||a&&(Sa.isScalarShape(t)||1===t[t.length-1])?(this.outputComponent=4,this.variableComponents=r?[4,1]:[1,4]):(this.outputComponent=1,this.variableComponents=[1,1]),this.type="nonshared",this.shaderKey=`binary_${e}_${this.variableComponents}`,this.workgroupSize=[128,1,1]}this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.outputComponent,1,1])}getUserCode(){let e,t=4===this.outputComponent?"vec4<f32>":"f32",n=`\n    fn binaryOperation(a : ${t}, b : ${t}) -> ${t} {\n      ${Zz(this.op,4===this.outputComponent)}\n    };\n    `;if("shared"===this.type){let t=this.lastDimensionSize>1?`coords[${this.outputShape.length-1}]`:"0",r=this.useSharedMemoryWithB?`let a = getAByOutputIndex(index);\n          let b = sharedBuf[${t}];`:`let a = sharedBuf[${t}];\n          let b = getBByOutputIndex(index);`;e=`\n        ${n}\n        var<workgroup> sharedBuf : array<f32, ${this.lastDimensionSize}>;\n        ${VL("index")} {\n          // Fill in the shared memory buffer.\n          let localIndex = i32(localId.x);\n          if(localIndex < ${this.lastDimensionSize}) {\n            sharedBuf[localIndex] = f32(${this.useSharedMemoryWithB?"B":"A"}[localIndex]);\n          }\n          workgroupBarrier();\n\n          if(index < uniforms.size) {\n            let coords = getCoordsFromIndex(index);\n            ${r}\n            setOutputAtIndex(index, binaryOperation(a, b));\n          }\n        }\n        `}else e=`\n       ${n}\n       ${VL("index")} {\n         if (index < uniforms.size) {\n           let coords = getCoordsFromIndex(index * ${this.outputComponent});\n           let a = ${t}(getAByOutputCoords(coords));\n           let b = ${t}(getBByOutputCoords(coords));\n           setOutputAtIndex(index, binaryOperation(a, b));\n         }\n       }\n       `;return e}};function dU(e){let{inputs:t}=e,{x:n}=t;return e.backend.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var cU={kernelName:un,backendName:"webgpu",kernelFunc:dU};function hU(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.makeTensorInfo(r.shape,"complex64"),s=n.tensorMap.get(i.dataId),o=dU({inputs:{x:r},backend:n}),l=dU({inputs:{x:a},backend:n});return s.complexTensorInfos={real:o,imag:l},i}var pU={kernelName:xt,backendName:"webgpu",kernelFunc:hU},mU=class{constructor(e,t,n=""){this.variableNames=["A"],this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.op=t,""!==n&&(this.uniforms=n),this.shaderKey=`unary_${t}`}getUserCode(){return`\n      fn unaryOperation(a : f32) -> f32 {\n        ${WB(this.op,!1)}\n      }\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let a = getAByOutputIndex(index);\n          setOutputAtIndex(index, unaryOperation(a));\n        }\n      }\n      `}};function fU({opType:e,cpuKernelImpl:t,dtype:n}){return({inputs:r,backend:a})=>{let{x:i}=r,s=a,o=n||i.dtype;if(s.shouldExecuteOnCPU([i])&&null!=t){let e=s.tensorMap.get(i.dataId),n=t(e.values,o);return s.makeTensorInfo(i.shape,o,n)}let l=new mU(i.shape,e);return s.runWebGPUProgram(l,[i],o)}}function gU({opType:e,cpuKernelImpl:t,supportsComplex:n=!1,dtype:r}){return({inputs:a,backend:i})=>{let{a:s,b:o}=a,l=i;if(n&&"complex64"===s.dtype){let t,n,r=l.tensorMap.get(s.dataId),a=l.tensorMap.get(o.dataId);if(e!==dz.MUL)[t,n]=[[r.complexTensorInfos.real,a.complexTensorInfos.real],[r.complexTensorInfos.imag,a.complexTensorInfos.imag]].map((t=>{let[n,r]=t,a={dataId:n.dataId,dtype:n.dtype,shape:s.shape},i={dataId:r.dataId,dtype:r.dtype,shape:o.shape},u=new uU(e,s.shape,o.shape);return l.runWebGPUProgram(u,[a,i],gi(n.dtype,r.dtype))}));else{let e=new lU(dz.COMPLEX_MULTIPLY_REAL,s.shape,o.shape),i=new lU(dz.COMPLEX_MULTIPLY_IMAG,s.shape,o.shape),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s.shape},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:o.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:o.shape}];t=l.runWebGPUProgram(e,u,"float32"),n=l.runWebGPUProgram(i,u,"float32")}let i=hU({inputs:{real:t,imag:n},backend:l});return l.disposeData(t.dataId),l.disposeData(n.dataId),i}let u=r||gi(s.dtype,o.dtype);if(("string"===s.dtype||"string"===o.dtype||l.shouldExecuteOnCPU([s,o]))&&null!=t){let e=l.tensorMap.get(s.dataId).values,n=l.tensorMap.get(o.dataId).values,r="string"===s.dtype?$m.fromUint8ToStringArray(e):e,a="string"===s.dtype?$m.fromUint8ToStringArray(n):n,[i,d]=t(s.shape,o.shape,r,a,u);return l.makeTensorInfo(d,u,i)}let d=new uU(e,s.shape,o.shape);return l.runWebGPUProgram(d,[s,o],u)}}var{addImpl:yU,castImpl:bU,ceilImpl:xU,concatImpl:AU,equalImpl:vU,expImpl:wU,expm1Impl:kU,floorImpl:SU,floorDivImpl:TU,gatherNdImpl:_U,gatherV2Impl:IU,greaterEqualImpl:CU,greaterImpl:EU,lessEqualImpl:NU,lessImpl:RU,logImpl:PU,maxImpl:DU,maximumImpl:MU,minimumImpl:OU,multiplyImpl:$U,negImpl:FU,notEqualImpl:LU,prodImpl:zU,rangeImpl:BU,rsqrtImpl:UU,scatterImpl:WU,simpleAbsImpl:VU,sliceImpl:jU,stridedSliceImpl:HU,stringNGramsImpl:GU,subImpl:qU,tileImpl:XU,topKImpl:KU,transposeImpl:ZU,uniqueImpl:YU}=Dy,JU=fU({opType:pz.ABS,cpuKernelImpl:VU}),QU={kernelName:Ge,backendName:"webgpu",kernelFunc:JU},eW=fU({opType:pz.ACOS}),tW={kernelName:qe,backendName:"webgpu",kernelFunc:eW},nW=fU({opType:pz.ACOSH}),rW={kernelName:Xe,backendName:"webgpu",kernelFunc:nW},aW=gU({opType:dz.ADD,cpuKernelImpl:yU,supportsComplex:!0}),iW={kernelName:Ke,backendName:"webgpu",kernelFunc:aW},sW={kernelName:Ze,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,r=t;if(1===r.length)return dU({inputs:{x:r[0]},backend:n});let a=r.map((e=>e.dtype)).reduce(((e,t)=>gi(e,t))),i=r.map((e=>e.shape)),s=new class{constructor(e){this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e[0],this.variableNames=e.map(((e,t)=>`T${t}`)),this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="addN"}getUserCode(){let e=[];this.variableNames.forEach((t=>{e.push(`let v${t} = get${t}ByOutputCoords(coords);`)}));let t=this.variableNames.map((e=>`v${e}`)).join(" + ");return`\n      ${VL("index")} {\n        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {\n          let flatIndex = index * ${this.workPerThread} + i;\n          if (flatIndex < uniforms.size) {\n            let coords = getCoordsFromIndex(flatIndex);\n            ${e.join("\n        ")}\n            setOutputAtIndex(flatIndex, ${t});\n          }\n        }\n      }\n    `}}(i);return n.runWebGPUProgram(s,r,a)}},oW=class{constructor(e,t){this.variableNames=["A"],this.workgroupSize=[16,16,1];let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.dispatchLayout={x:[0],y:[1]},this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[1,1,1]),this.shaderKey="transposeShared"}getUserCode(){Sa.assert(this.workgroupSize[0]===this.workgroupSize[1],(()=>`Must be a square tile, current tile shape is ${this.workgroupSize[0]} x ${this.workgroupSize[1]}`));let e=this.workgroupSize[0];return`\n      var<workgroup> tile : array<array<f32, ${this.workgroupSize[0]+1}>, ${this.workgroupSize[0]}>;\n      ${VL()} {\n        var x = i32(workgroupId.x) * ${e} + i32(localId.x);\n        var y = i32(workgroupId.y) * ${e} + i32(localId.y);\n        let width = uniforms.outShape[0];\n        let height = uniforms.outShape[1];\n        if (x < width && y < height) {\n          tile[localId.y][localId.x] = f32(A[y * width + x]);\n        }\n        workgroupBarrier();\n\n        x = i32(workgroupId.y) * ${e} + i32(localId.x);\n        y = i32(workgroupId.x) * ${e} + i32(localId.y);\n        if (x < height && y < width) {\n          setOutputAtIndex((y * height + x), tile[localId.x]\n            [localId.y]);\n        }\n      }\n    `}},lW=class{constructor(e,t){this.variableNames=["A"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0;let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.newDim=t,this.shaderKey=`transpose_${t}`}getUserCode(){let e=UL(this.outputShape.length),t=uW(this.newDim);return`\n      ${VL("index")} {\n        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {\n          let flatIndex = index * ${this.workPerThread} + i;\n          if(flatIndex < uniforms.size) {\n            let coords = getCoordsFromIndex(flatIndex);\n            setOutputAtIndex(flatIndex, A[getIndexFromCoords${this.outputShape.length}D(\n              ${e}(${t}), uniforms.aShape)]);\n          }\n        }\n      }\n    `}};function uW(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let n=new Array(t);for(let t=0;t<e.length;t++)n[e[t]]=`coords.${WL(t)}`;return n.join()}function dW(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:i}=r,s=n,o=a.shape.length,l=new Array(o);for(let e=0;e<l.length;e++)l[e]=a.shape[i[e]];if(n.shouldExecuteOnCPU([a])){let e=s.tensorMap.get(a.dataId).values,t=ZU(e,a.shape,a.dtype,i,l);return n.makeTensorInfo(l,a.dtype,t)}if(2===a.shape.length&&Sa.arraysEqual(i,[1,0])){let e=new oW(a.shape,i);return s.runWebGPUProgram(e,[a],a.dtype)}let u=new lW(a.shape,i);return s.runWebGPUProgram(u,[a],a.dtype)}var cW={kernelName:Qr,backendName:"webgpu",kernelFunc:dW},hW=class{constructor(e,t,n){this.variableNames=["x"],this.uniforms="reduceSize : i32,",this.size=!0,this.inputShape=[e.batchSize,e.inSize];let[r]=$m.computeOutAndReduceShapes(this.inputShape,[1]);this.outputShape=0===r.length?[1]:r,e.inSize>=32768&&n>=512?this.workgroupSize=[512,1,1]:e.inSize>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,[1,1,1]),this.reduceType=t,this.shaderKey=`reduce_${t}`}getUserCode(){let e="",t="0.0",n=this.workgroupSize[0];"min"===this.reduceType||"max"===this.reduceType?(e=`\n         if (isnan(candidate)) {\n          bestValue = uniforms.NAN;\n         } else if (!isnan(bestValue) && candidate ${"min"===this.reduceType?"<":">"} bestValue)\n           {  bestValue = candidate; }`,t="f32(x[offset])"):"sum"===this.reduceType||"mean"===this.reduceType?e=" bestValue = bestValue + candidate; ":"prod"===this.reduceType?(e=" bestValue = bestValue * candidate; ",t="1.0"):"all"===this.reduceType?(e=" bestValue = f32(bestValue >= 1.0 && candidate >= 1.0); ",t="1.0"):"any"===this.reduceType&&(e=" bestValue = f32(bestValue >= 1.0 || candidate >= 1.0); ",t="0.0");let r="mean"===this.reduceType?"setOutputAtIndex(outputIndex, bestValue / f32(uniforms.reduceSize));":"setOutputAtIndex(outputIndex, bestValue);";return`\n       fn DIV_CEIL(a : u32, b : u32) -> u32 {\n        return ((a - 1u) / b + 1u);\n       }\n\n       \n         var<workgroup> xBestValues : array<f32, ${n}>;\n       \n       fn getOffset(outputIndex : i32) -> i32 {\n         let outputCoords = getCoordsFromIndex(outputIndex);\n         let offset = ${1===this.outputShape.length?"outputCoords":"outputCoords[0]"} * uniforms.reduceSize;\n          return offset;\n       }\n       ${VL("index")} {\n         let outputIndex = index / ${n};\n         let offset = getOffset(outputIndex);\n         var bestValue = ${t};\n         let Length = uniforms.reduceSize;\n         let WorkPerThread = DIV_CEIL(u32(Length), ${n}u);\n         for (var k = i32(localId.x); k < Length && outputIndex < uniforms.size;\n             k = k + ${n}) {\n           let candidate = f32(x[offset + k]);\n           ${e}\n         }\n         xBestValues[localId.x] = bestValue;\n         workgroupBarrier();\n\n         var reduceSize = min(u32(Length), ${n}u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (localId.x < currentSize) {\n            let candidate = xBestValues[localId.x + interval];\n            ${e}\n            xBestValues[localId.x] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (localId.x == 0u && outputIndex < uniforms.size) {\n          ${r}\n        }\n       }\n     `}};function pW(e,t,n,r,a){let i=e.shape.length,s=[],o=Sa.parseAxisParam(t,e.shape),l=o,u=$m.getAxesPermutation(l,i),d=e;null!=u&&(d=dW({inputs:{x:e},attrs:{perm:u},backend:a}),l=$m.getInnerMostAxes(l.length,i),s.push(d)),$m.assertAxesAreInnerMostDims(r,l,i);let c,[h,p]=$m.computeOutAndReduceShapes(d.shape,l),m=h;if(n&&(m=$m.expandShapeToKeepDim(h,o)),"max"!==r&&"prod"!==r||!a.shouldExecuteOnCPU([d])){let t=Sa.sizeFromShape(p),n={windowSize:t,inSize:t,batchSize:Sa.sizeFromShape(d.shape)/t,outSize:1},i="mean"===r?"float32":yi(e.dtype),o=[{type:"int32",data:[t]}],l=new hW(n,r,a.device.limits.maxComputeWorkgroupSizeX),u=a.runWebGPUProgram(l,[d],i,o);s.push(u),c=aU({inputs:{x:u},attrs:{shape:m},backend:a})}else{let t=a.tensorMap.get(d.dataId).values;switch(r){case"max":let n=DU(t,Sa.sizeFromShape(p),m,e.dtype);c=a.makeTensorInfo(m,e.dtype,n);break;case"prod":let{outVals:i,outShape:s,outDtype:o}=zU(d.shape,d.dtype,t,l);c=a.makeTensorInfo(s,o,i);break;default:throw new Error(`${r} CPU implementation is not yet supported.`)}}return s.forEach((e=>a.disposeData(e.dataId))),c}var mW={kernelName:Ye,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{keepDims:i,axis:s}=r;return pW(a,s,i,"all",n)}},fW={kernelName:Je,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{keepDims:i,axis:s}=r;return pW(a,s,i,"any",n)}},gW=class{constructor(e,t,n){this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="infinityValue : f32,",this.size=!0;let r=[t];this.op="min"===n?"<":">";let[a,i]=$m.computeOutAndReduceShapes(e,r);this.outputShape=0===a.length?[1]:a,this.dispatchLayout=sz(this.outputShape),Sa.sizeFromShape(i)<32||Sa.sizeFromShape(a)>1e3?(this.type="plain",this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize)):(this.type="shared",this.dispatch=nz(this.dispatchLayout,this.outputShape,[1,1,1])),this.inputShape=e,this.shaderKey=`argMinMax_${this.op}_${this.type}`}getUserCode(){let e=this.workgroupSize[0],t=()=>1===this.inputShape.length?"uniforms.xShape":`uniforms.xShape.${WL(this.inputShape.length-1)}`,n=()=>{let e="";if(1===this.outputShape.length)1!==this.inputShape.length&&(e+="outputCoords,");else for(let t=0;t<this.outputShape.length;t++)e+=`outputCoords.${WL(t)},`;return e};return"shared"===this.type?`\n      fn DIV_CEIL(a : u32, b : u32) -> u32 {\n        return ((a - 1u) / b + 1u);\n      }\n\n      \n      var<workgroup> xBestIndices : array<i32, ${e}>;\n      var<workgroup> xBestValues : array<f32, ${e}>;\n    \n\n      ${VL("index")} {\n        let outputIndex = index / ${e};\n        let reduceLength = ${t()};\n\n        var bestIndex = i32(localId.x);\n        var bestValue = uniforms.infinityValue;\n        let outputCoords = getCoordsFromIndex(outputIndex);\n        for (var k = i32(localId.x); k < reduceLength && outputIndex < uniforms.size;\n            k = k + ${e}) {\n          let candidate = getX(${n()} k);\n          if (!isnan(candidate) && candidate ${this.op} bestValue) {\n            bestValue = candidate;\n            bestIndex = k;\n          }\n        }\n        xBestValues[localId.x] = bestValue;\n        xBestIndices[localId.x] = bestIndex;\n        workgroupBarrier();\n\n        var reduceSize = min(u32(reduceLength), ${e}u);\n        for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n            currentSize = reduceSize / 2u) {\n          let interval = DIV_CEIL(reduceSize, 2u);\n          if (localId.x < currentSize) {\n            let candidate = xBestValues[localId.x + interval];\n            if (candidate ${this.op} bestValue) {\n              bestValue = candidate;\n              xBestValues[localId.x] = bestValue;\n              xBestIndices[localId.x] = xBestIndices[localId.x + interval];\n            }\n          }\n          reduceSize = interval;\n          workgroupBarrier();\n        }\n\n        if (localId.x == 0u && outputIndex < uniforms.size) {\n          setOutputAtIndexI32(outputIndex, xBestIndices[localId.x]);\n        }\n      }\n    `:`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let outputCoords = getCoordsFromIndex(index);\n          var bestIndex = 0;\n          var bestValue = getX(${n()} 0);\n          let reduceLength = ${t()};\n          for (var i = 1; i < reduceLength; i++) {\n            let candidate = getX(${n()} i);\n            if (candidate ${this.op} bestValue) {\n              bestValue = candidate;\n              bestIndex = i;\n            }\n          }\n          setOutputAtIndexI32(index, bestIndex);\n        }\n      }\n      `}},yW={kernelName:Qe,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r,s=Sa.parseAxisParam(i,a.shape),o=$m.getAxesPermutation(s,a.shape.length),l=a,u=[];null!=o&&(l=dW({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=$m.getInnerMostAxes(s.length,l.shape.length)),$m.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let d=new gW(l.shape,s[0],"max"),c=[{type:"float32",data:[Number.NEGATIVE_INFINITY]}],h=n.runWebGPUProgram(d,[l],"int32",c);return u.forEach((e=>n.disposeData(e.dataId))),h}},bW={kernelName:et,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r,s=Sa.parseAxisParam(i,a.shape),o=$m.getAxesPermutation(s,a.shape.length),l=a,u=[];null!=o&&(l=dW({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=$m.getInnerMostAxes(s.length,l.shape.length)),$m.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let d=new gW(l.shape,s[0],"min"),c=[{type:"float32",data:[Number.POSITIVE_INFINITY]}],h=n.runWebGPUProgram(d,[l],"int32",c);return u.forEach((e=>n.disposeData(e.dataId))),h}},xW=fU({opType:pz.ASIN}),AW={kernelName:tt,backendName:"webgpu",kernelFunc:xW},vW=fU({opType:pz.ASINH}),wW={kernelName:nt,backendName:"webgpu",kernelFunc:vW},kW=fU({opType:pz.ATAN}),SW={kernelName:rt,backendName:"webgpu",kernelFunc:kW},TW=gU({opType:dz.ATAN2}),_W={kernelName:it,backendName:"webgpu",kernelFunc:TW},IW=fU({opType:pz.ATANH}),CW={kernelName:at,backendName:"webgpu",kernelFunc:IW},EW=class{constructor(e,t,n=!1,r=!1,a=!1){if(this.variableNames=["x"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, convDims : vec2<i32>, filterDims : vec2<i32>,",this.workgroupSize=[128,1,1],this.size=!0,"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=t,this.computePositions=n,this.flattenPositions=r,this.includeBatchIndex=a,this.shaderKey=`pool2D_${t}_${n}_${r}_${a}`}getUserCode(){let e;e="avg"===this.poolType?"resultValue = resultValue + value; count = count + 1.0;":this.computePositions?`let currMaxValue = mix(value, maxValue, maxValueFound);\n      if (value >= currMaxValue) {\n        maxValue = value;\n        maxValueFound = 1.0;\n        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"((batch * uniforms.xShape[1] + xR) * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"(xR * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"wR * uniforms.filterDims.y + wC"};\n      }`:"resultValue = max(value, resultValue);";let t="resultValue";return"avg"===this.poolType&&(t="resultValue / max(count, 1.0)"),`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n          let batch = coords[0];\n          let d = coords[3];\n          let xRCCorner = vec2<i32>(coords.yz) * uniforms.strides - uniforms.pads;\n          let xRCorner = xRCCorner.x;\n          let xCCorner = xRCCorner.y;\n\n          ${this.computePositions?"var maxValue = 0.0;\n            var maxValueFound = 0.0;\n            var maxPosition = 0;":`var resultValue = ${"avg"===this.poolType?"0.0":"-1.0 / pow(10.0, -20.0)"};`}\n\n          var count = 0.0;\n          for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + uniforms.dilations.x) {\n            let xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= uniforms.convDims.x) {\n              continue;\n            }\n\n            for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + uniforms.dilations.y) {\n              let xC = xCCorner + wC;\n              if (xC < 0 || xC >= uniforms.convDims.y) {\n                continue;\n              }\n\n              let value = getX(batch, xR, xC, d);\n              ${e}\n            }\n          }\n\n          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${t});`}\n        }\n      }\n    `}},NW=class{constructor(e,t,n=!1,r=!1,a=!1){if(this.variableNames=["x"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, convDims : vec3<i32>, filterDims : vec3<i32>,",this.workgroupSize=[128,1,1],this.size=!0,"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=t,this.computePositions=n,this.flattenPositions=r,this.includeBatchIndex=a,this.shaderKey=`pool3D_${t}_${n}_${r}_${a}`}getUserCode(){let e;e="avg"===this.poolType?"resultValue += value; count += 1.0;":this.computePositions?`let currMaxValue = mix(value, maxValue, maxValueFound);\n      if (value >= currMaxValue) {\n        maxValue = value;\n        maxValueFound = 1.0;\n        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"(((batch * uniforms.xShape.y + xD) * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"((xD * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"wD * uniforms.filterDims.y * uniforms.filterDims.y + wR * uniforms.filterDims.z + wC"};\n      }`:"resultValue = max(value, resultValue);";let t="resultValue";return"avg"===this.poolType&&(t="resultValue / max(count, 1.0)"),`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let batch = coords.x;\n          let ch = coords.u;\n\n          let xCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;\n          let xDCorner = xCorner.x;\n          let xRCorner = xCorner.y;\n          let xCCorner = xCorner.z;\n\n          ${this.computePositions?"var maxValue = 0.0;\n            var maxValueFound = 0.0;\n            var maxPosition = 0;":`var resultValue = ${"avg"===this.poolType?"0.0":"-1.0 / pow(10.0, -20.0)"};`}\n\n          var count = 0.0;\n          for (var wD = 0; wD < uniforms.filterDims.x; wD++) {\n            let xD = xDCorner + wD;\n            if (xD < 0 || xD >= uniforms.convDims.x) {\n              continue;\n            }\n\n            for (var wR = 0; wR < uniforms.filterDims.y; wR++) {\n              let xR = xRCorner + wR;\n              if (xR < 0 || xR >= uniforms.convDims.y) {\n                continue;\n              }\n\n              for (var wC = 0; wC < uniforms.filterDims.z; wC++) {\n                let xC = xCCorner + wC;\n                if (xC < 0 || xC >= uniforms.convDims.z) {\n                  continue;\n                }\n\n                let value = getX(batch, xD, xR, xC, ch);\n                ${e}\n              }\n            }\n          }\n\n          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${t});`}\n        }\n      }\n    `}};function RW(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r;return pW(a,i,s,"max",n)}var PW={kernelName:Nn,backendName:"webgpu",kernelFunc:RW};function DW(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{keepDims:i,axis:s}=r;return pW(a,s,i,"mean",n)}var MW={kernelName:Fn,backendName:"webgpu",kernelFunc:DW};function OW(e,t,n,r){if(1===t.filterWidth&&1===t.filterHeight&&Sa.arraysEqual(t.inShape,t.outShape))return dU({inputs:{x:e},backend:r});if(t.filterWidth===t.inWidth&&t.filterHeight===t.inHeight&&1===t.batchSize&&"VALID"===t.padInfo.type){let a,i=e.shape.length,s=aU({inputs:{x:e},backend:r,attrs:{shape:[e.shape[i-3]*e.shape[i-2],e.shape[i-1]]}});"avg"===n?a=DW({inputs:{x:s},backend:r,attrs:{axis:0,keepDims:!1}}):(Sa.assert("max"===n,(()=>`Invalid pool type ${n}`)),a=RW({inputs:{x:s},backend:r,attrs:{reductionIndices:0,keepDims:!1}}));let o=aU({inputs:{x:a},backend:r,attrs:{shape:t.outShape}});return r.disposeData(s.dataId),r.disposeData(a.dataId),o}let a,i=[{type:"int32",data:[t.strideHeight,t.strideWidth]}];return 1===t.filterHeight&&1===t.filterWidth?a=new class{constructor(e){this.variableNames=["x"],this.uniforms="strides : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="poolWithFilterSizeEqualsOne"}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let batch = coords[0];\n          let d = coords[3];\n\n          let xRCCorner = coords.yz * uniforms.strides;\n          let xRCorner = xRCCorner.x;\n          let xCCorner = xRCCorner.y;\n\n          let value = getX(batch, xRCorner, xCCorner, d);\n          setOutputAtIndex(index, value);\n        }\n      }\n    `}}(t):("avg"===n?a=new EW(t,"avg"):(Sa.assert("max"===n,(()=>`Invalid pool type ${n}`)),a=new EW(t,"max")),i.push({type:"int32",data:[t.padInfo.top,t.padInfo.left]},{type:"int32",data:[t.dilationHeight,t.dilationWidth]},{type:"int32",data:[t.inHeight,t.inWidth]},{type:"int32",data:[t.effectiveFilterHeight,t.effectiveFilterWidth]})),r.runWebGPUProgram(a,[e],e.dtype,i)}var $W={kernelName:st,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;return OW(a,$m.computePool2DInfo(a.shape,i,s,1,o,l),"avg",n)}},FW={kernelName:lt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dataFormat:l,dimRoundingMode:u}=r,d=$m.computePool3DInfo(a.shape,i,s,[1,1,1],o,u,l),c=new NW(d,"avg"),h=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}];return n.runWebGPUProgram(c,[a],a.dtype,h)}},LW={kernelName:ut,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:u,dimRoundingMode:d}=r,c=$m.computePool3DInfo(s.shape,o,l,1,u,d),h=new class{constructor(e){this.variableNames=["dy"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,\n       outDepth : i32, outHeight : i32, outWidth : i32, avgMultiplier : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool3DBackprop"}getUserCode(){return`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords.x;\n        let ch = coords.u;\n\n        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;\n        let dyDCorner = dyCorner.x;\n        let dyRCorner = dyCorner.y;\n        let dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {\n          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);\n\n          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {\n            continue;\n          }\n          let idyD = i32(dyD);\n\n          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {\n            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);\n\n            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n              continue;\n            }\n            let idyR = i32(dyR);\n\n            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {\n              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);\n\n              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n                continue;\n              }\n              let idyC = i32(dyC);\n\n              let dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              dotProd += dyValue * uniforms.avgMultiplier;\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    `}}(c),p=1/(c.filterDepth*c.filterHeight*c.filterWidth),m=[{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.effectiveFilterDepth-1-c.padInfo.front,c.effectiveFilterHeight-1-c.padInfo.top,c.effectiveFilterWidth-1-c.padInfo.left]},{type:"int32",data:[c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth]},{type:"int32",data:[c.outDepth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"float32",data:[p]}];return n.runWebGPUProgram(h,[a],s.dtype,m)}},zW={kernelName:ot,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;uz([a,i],"avgPoolGrad");let{filterSize:o,strides:l,pad:u}=r,d=$m.computePool2DInfo(s.shape,o,l,1,u),c=new class{constructor(e){this.variableNames=["dy"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,\n       outHeight : i32, outWidth : i32, avgMultiplier : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool2DBackprop"}getUserCode(){return`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords[0];\n        let d = coords[3];\n\n        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;\n        let dyRCorner = dyRCCorner.x;\n        let dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var wR = 0; wR < uniforms.filterDims[0]; wR = wR + uniforms.dilations[0]) {\n          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);\n\n          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n            continue;\n          }\n          let idyR = i32(dyR);\n\n          for (var wC = 0; wC < uniforms.filterDims[1]; wC = wC + uniforms.dilations[1]) {\n            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);\n\n            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n              continue;\n            }\n            let idyC = i32(dyC);\n\n            let dyValue = getDy(batch, idyR, idyC, d);\n\n            dotProd = dotProd + dyValue * uniforms.avgMultiplier;\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    `}}(d),h=1/(d.filterHeight*d.filterWidth),p=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.effectiveFilterHeight-1-d.padInfo.top,d.effectiveFilterWidth-1-d.padInfo.left]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[d.effectiveFilterHeight,d.effectiveFilterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"float32",data:[h]}];return n.runWebGPUProgram(c,[a],s.dtype,p)}},BW={kernelName:dt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:i}=t,{transposeA:s,transposeB:o}=r;return sU({a,b:i,transposeA:s,transposeB:o,backend:n})}},UW=["x","y","z","w","u","v"];function WW(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r,[o,l]=dm.parseSliceParams(a,i,s);if(dm.assertParamsValid(a,o,l),n.shouldExecuteOnCPU([a])||"string"===a.dtype){let e=n.tensorMap.get(a.dataId),t=jU(e.values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,t)}if(0===Sa.sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);let u=new class{constructor(e,t){this.variableNames=["source"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.rank=t.length,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.start=e,this.uniforms=`start : ${UL(e.length)}, `,this.shaderKey="slice"}getUserCode(){let e,t=UL(this.rank),n=function(e){if(1===e)return"sourceLoc";if(e<=6)return UW.slice(0,e).map((e=>`sourceLoc.${e}`)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);return e=1===this.start.length?this.outputShape.map(((e,t)=>"sourceLoc = uniforms.start + coords;")):this.outputShape.map(((e,t)=>`sourceLoc.${UW[t]} = uniforms.start.${WL(t)} + coords.${UW[t]};`)),`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          var sourceLoc : ${t};\n          let coords = getCoordsFromIndex(index);\n          ${e.join("\n")}\n          setOutputAtIndex(index, getSource(${n}));\n        }\n      }\n    `}}(o,l),d=[{type:"int32",data:o}];return n.runWebGPUProgram(u,[a],a.dtype,d)}var VW={kernelName:Sr,backendName:"webgpu",kernelFunc:WW},jW={kernelName:ct,backendName:"webgpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;Sa.assert(a.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGPU backend not implemented yet"));let o=i.reduce(((e,t)=>e*t)),l=$m.getReshaped(a.shape,i,o),u=$m.getPermuted(l.length,i.length),d=$m.getReshapedPermuted(a.shape,i,o),c=$m.getSliceBeginCoords(s,i.length),h=$m.getSliceSize(d,s,i.length),p=[],m=aU({inputs:{x:a},backend:n,attrs:{shape:l}}),f=dW({inputs:{x:m},backend:n,attrs:{perm:u}}),g=aU({inputs:{x:f},backend:n,attrs:{shape:d}}),y=WW({inputs:{x:g},backend:n,attrs:{begin:c,size:h}});return p.push(m),p.push(f),p.push(g),p.forEach((e=>n.disposeData(e.dataId))),y}},HW=`\n  fn bincount_write(index: i32, value: f32) {\n    ${zL("&result[index]","value","float32")}\n  }\n`,GW=class{constructor(e,t,n=!1){this.outputShape=[],this.variableNames=["x"],this.uniforms="binCountSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.hasWeights=!0,this.binaryOutput=!1,this.outputShape=e,this.rank=e.length,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.binaryOutput=n,n&&(this.atomic=!1),this.hasWeights=t,this.hasWeights&&this.variableNames.push("w"),this.shaderKey=`bincount_${this.hasWeights}_${this.binaryOutput}_${this.rank}`}getUserCode(){return`\n    ${this.binaryOutput?"\n  fn bincount_write(index: i32, value: f32) {\n    atomicStore(&result[index], bitcast<i32>(value));\n  }\n":HW}\n  ${VL("index")} {\n    ${1===this.rank?`if (index < uniforms.xShape) {\n      let indexVal = i32(getX(index));\n      if (indexVal < uniforms.binCountSize) {\n        let value = ${this.binaryOutput?1:this.hasWeights?"getW(index)":"1."};\n        bincount_write(indexVal, value);\n      }\n    }`:`let coord = getCoordsFromIndex(index);\n    if (coordsInBounds2D(coord, uniforms.xShape)) {\n      let indexVal = i32(getX(coord[0], coord[1]));\n      if (indexVal < uniforms.binCountSize) {\n        let value = ${this.binaryOutput?1:this.hasWeights?"getW(coord[0], coord[1])":"1."};\n        bincount_write(coord.x * uniforms.binCountSize + indexVal, value);\n      }\n    }`}\n  }\n  `}},qW={kernelName:ht,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=Sa.sizeFromShape(a.shape),l=Sa.sizeFromShape(i.shape)>0,u=[s],d=i.dtype,c=nU({backend:n,attrs:{shape:u,value:0,dtype:d}}),h=new GW([o],l),p=[{type:"int32",data:[s]}],m=l?[a,i]:[a];return n.runWebGPUProgram(h,m,d,p,c)}},XW={kernelName:ft,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t;if(n.shouldExecuteOnCPU([r,a])){let e=n.tensorMap.get(r.dataId),t=n.tensorMap.get(a.dataId),i=e.values,s=t.values,o=$m.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}let i=Sa.sizeFromShape(r.shape),s=Sa.sizeFromShape(a.shape),o=Math.max(i,s),l=new class{constructor(e){this.outputShape=[],this.variableNames=["s0","s1"],this.uniforms="s0Size : i32, s1Size : i32, ",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="broadcastArgs"}getUserCode(){return`\n  ${VL("index")} {\n    if (index < uniforms.size) {\n      var s0 = 1.0;\n      var s1 = 1.0;\n      let indexS0 = index - uniforms.size + uniforms.s0Size;\n      let indexS1 = index - uniforms.size + uniforms.s1Size;\n      if (indexS0 >= 0) {\n        s0 = getS0(indexS0);\n      }\n      if (indexS1 >= 0) {\n        s1 = getS1(indexS1);\n      }\n\n      if (s0 == 1.0) {\n        setOutputAtIndex(index, s1);\n      } else if (s1 == 1.0) {\n        setOutputAtIndex(index, s0);\n      } else if (s0 != s1) {\n        setOutputAtIndex(index, uniforms.NAN);\n      } else {\n        setOutputAtIndex(index, s0);\n      }\n    }\n  }\n  `}}(o),u=[{type:"int32",data:[i]},{type:"int32",data:[s]}];return n.runWebGPUProgram(l,[r,a],"int32",u)}},KW=gU({opType:dz.NOT_EQUAL,dtype:"bool",cpuKernelImpl:LU}),ZW={kernelName:Hn,backendName:"webgpu",kernelFunc:KW};function YW(e){let{inputs:t,backend:n}=e,{input:r}=t;return dU({inputs:{x:n.tensorMap.get(r.dataId).complexTensorInfos.real},backend:n})}var JW={kernelName:or,backendName:"webgpu",kernelFunc:YW},QW={kernelName:gt,backendName:"webgpu",kernelFunc:function e(t){let{inputs:n,backend:r,attrs:a}=t,{x:i}=n,{dtype:s}=a;if("complex64"===s){if("complex64"===i.dtype)return dU({inputs:{x:i},backend:r});let t=nd(i.shape),n=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),a=hU({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeData(n.dataId),a}if("complex64"===i.dtype){let t=YW({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeData(t.dataId),n}if(!Sa.hasEncodingLoss(i.dtype,s)){let e=dU({inputs:{x:i},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if(r.shouldExecuteOnCPU([i])){let e=r.tensorMap.get(i.dataId).values,[t,n,a]=bU(e,i.shape,i.dtype,s);return r.makeTensorInfo(t,n,a)}if("int32"===s)return function(e,t){let n=new mU(e.shape,pz.TO_INT),r=t.runWebGPUProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===s){let e=r.makeTensorInfo([],"bool",Sa.getTypedArrayFromDType("bool",1)),t=KW({inputs:{a:i,b:e},backend:r});return r.disposeData(e.dataId),t}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}},eV=fU({opType:pz.CEIL,cpuKernelImpl:xU}),tV={kernelName:yt,backendName:"webgpu",kernelFunc:eV},nV={kernelName:bt,backendName:"webgpu",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{clipValueMin:s,clipValueMax:o}=a,l=[{type:"float32",data:[s]},{type:"float32",data:[o]}];return t=Sa.sizeFromShape(i.shape)%4==0?new class{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workPerThread=4,this.workgroupSize=[64,1,1],this.outputComponent=4,this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="clipVec4"}getUserCode(){return`\n      ${VL("index")} {\n        if(index < uniforms.size) {\n          let value = getAByOutputIndex(index);\n          var clampedValue = clamp(\n              value, vec4<f32>(uniforms.minVal), vec4<f32>(uniforms.maxVal));\n          clampedValue = select(clampedValue, value, isnanVec4(value));\n          setOutputAtIndex(index, clampedValue);\n        }\n      }\n    `}}(i.shape):new class{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="clip"}getUserCode(){return`\n      ${VL("index")} {\n        if(index < uniforms.size) {\n          let value = getAByOutputIndex(index);\n          if (isnan(value)) {\n            setOutputAtIndex(index, value);\n            return;\n          }\n          setOutputAtIndex(index, clamp(value, uniforms.minVal, uniforms.maxVal));\n        }\n      }\n    `}}(i.shape),r.runWebGPUProgram(t,[i],i.dtype,l)}};function rV(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var aV={kernelName:At,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,a=n.tensorMap.get(r.dataId),i=new class{constructor(e){this.outputShape=[],this.variableNames=["real","imag"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="complexAbs"}getUserCode(){return`\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let re = abs(getRealByOutputIndex(index));\n        let im = abs(getImagByOutputIndex(index));\n        let mx = max(re, im);\n\n        // The length function in wgsl may be not underflow-safe on some GPUs.\n        // So the safe solution is to ensure underflow-safety in all cases.\n        setOutputAtIndex(index, select(mx * length(vec2<f32>(1, min(re, im)/mx)), 0.0, mx == 0.0));\n      }\n    }\n  `}}(r.shape),s=[rV(r,a.complexTensorInfos.real),rV(r,a.complexTensorInfos.imag)];return n.runWebGPUProgram(i,s,s[0].dtype)}},iV=class{constructor(e){this.uniforms="",this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=$m.computeOutShape(e,1),this.variableNames=e.map(((e,t)=>`T${t}`)),this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.offsetLength=e.length-1;for(let e=0;e<this.offsetLength;e++)this.uniforms+=`offset${e} : i32,`;this.shaderKey="concat"}getUserCode(){let e=[];if(this.offsetLength>0){e.push("if (yC < uniforms.offset0){ setOutputAtCoords(coords.x, coords.y, getT0(yR, yC)); }");for(let t=1;t<this.offsetLength;t++)e.push(`else if (yC < uniforms.offset${[t]}){ setOutputAtCoords(coords.x, coords.y, getT${t}(yR, yC - uniforms.offset${t-1})); }`);let t=this.offsetLength,n=this.offsetLength-1;e.push(`else { setOutputAtCoords(coords.x, coords.y, getT${t}(yR, yC - uniforms.offset${n})); }`)}else e.push("setOutputAtCoords(coords.x, coords.y, getT0(yR, yC));");return`\n      ${VL("index")} {\n        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {\n          let flatIndex = index * ${this.workPerThread} + i;\n          if(flatIndex < uniforms.size) {\n            let coords = getCoordsFromIndex(flatIndex);\n            let yR = coords.x;\n            let yC = coords.y;\n\n            ${e.join("\n        ")}\n          }\n        }\n      }\n    `}};function sV(e){let{inputs:t,backend:n}=e,{input:r}=t;return dU({inputs:{x:n.tensorMap.get(r.dataId).complexTensorInfos.imag},backend:n})}var oV={kernelName:cn,backendName:"webgpu",kernelFunc:sV};function lV(e,t,n){let r=e[0].dtype;if("complex64"===r){let r=e.map((e=>YW({inputs:{input:e},backend:n}))),a=e.map((e=>sV({inputs:{input:e},backend:n}))),i=lV(r,t,n),s=lV(a,t,n),o=hU({inputs:{real:i,imag:s},backend:n});return r.forEach((e=>n.disposeData(e.dataId))),a.forEach((e=>n.disposeData(e.dataId))),n.disposeData(i.dataId),n.disposeData(s.dataId),o}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){let a=e.map((e=>{let r=[-1,Sa.sizeFromShape(e.shape.slice(t))];return aU({inputs:{x:e},backend:n,attrs:{shape:r}})})),i=a.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),s=$m.computeOutShape(a.map((e=>e.shape)),1),o=1===a[0].shape[0],l=AU(i,s,r,o),u=$m.computeOutShape(e.map((e=>e.shape)),t),d=n.makeTensorInfo(u,r,l);return a.forEach((e=>n.disposeData(e.dataId))),d}let i=n.device.limits.maxStorageBuffersPerShaderStage-1;if(e.length>i){let r=[];for(let a=0;a<e.length;a+=i){let s=e.slice(a,a+i);r.push(lV(s,t,n))}let a=lV(r,t,n);for(let e of r)n.disposeData(e.dataId);return a}let{tensors2D:s,outShape:o}=function(e,t,n){let r=$m.computeOutShape(e.map((e=>e.shape)),t);return{tensors2D:e.map((e=>aU({inputs:{x:e},backend:n,attrs:{shape:[Sa.sizeFromShape(e.shape.slice(0,t)),Sa.sizeFromShape(e.shape.slice(t))]}}))),outShape:r}}(e,t,n),l=s.map((e=>e.shape)),u=new iV(l),d=[],c=new Array(l.length-1);if(c.length>0){c[0]=l[0][1],d.push({type:"int32",data:[c[0]]});for(let e=1;e<c.length;e++)c[e]=c[e-1]+l[e][1],d.push({type:"int32",data:[c[e]]})}let h=n.runWebGPUProgram(u,s,s[0].dtype,d);s.forEach((e=>n.disposeData(e.dataId)));let p=aU({inputs:{x:h},backend:n,attrs:{shape:o}});return n.disposeData(h.dataId),p}function uV(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=Sa.parseAxisParam(a,t[0].shape)[0],s=t.map((e=>e.shape));$m.assertParamsConsistent(s,i);let o=$m.computeOutShape(t.map((e=>e.shape)),i);if(0===Sa.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);let l=t.filter((e=>Sa.sizeFromShape(e.shape)>0));return 1===l.length?dU({inputs:{x:l[0]},backend:n}):lV(l,i,n)}var dV={kernelName:vt,backendName:"webgpu",kernelFunc:uV};function cV(e,t){let n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function hV({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){let l=null!=a,u=null!=i,d="channelsLast"===n.dataFormat,c=d&&n.filterHeight===n.inHeight&&n.filterWidth===n.inWidth&&"VALID"===n.padInfo.type,h=Ue().getBool("WEBGPU_USE_NAIVE_CONV2D_DEBUG");if(!h&&(c||1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type)))return function({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){let l,u,d="channelsLast"===n.dataFormat,c=!d,h=[];if(d&&n.filterHeight===n.inHeight&&n.filterWidth===n.inWidth&&"VALID"===n.padInfo.type){let a=n.inHeight*n.inWidth*n.inChannels;l=aU({inputs:{x:e},backend:r,attrs:{shape:[1,n.batchSize,a]}}),u=aU({inputs:{x:t},backend:r,attrs:{shape:[1,a,n.outChannels]}})}else l=aU({inputs:{x:e},backend:r,attrs:{shape:d?[n.batchSize,n.inHeight*n.inWidth,n.inChannels]:[n.batchSize,n.inChannels,n.inHeight*n.inWidth]}}),u=aU({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});if(h.push(l),h.push(u),null!=i){let e=cV(i.shape,d);null!=e&&(i=aU({inputs:{x:i},backend:r,attrs:{shape:e}}),h.push(i))}if(null!=a){let e=cV(a.shape,d);null!=e&&(a=aU({inputs:{x:a},backend:r,attrs:{shape:e}}),h.push(a))}let p=sU({a:d?l:u,b:d?u:l,transposeA:c,transposeB:!1,backend:r,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s}),m=aU({inputs:{x:p},backend:r,attrs:{shape:n.outShape}});h.push(p);for(let e of h)r.disposeData(e.dataId);return m}({x:e,filter:t,convInfo:n,backend:r,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s});let p=Ue().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),m=p>0?p:r.thresholdToIncreaseWorkgroups,f=n.batchSize*Math.ceil(n.outHeight*n.outWidth/32)*Math.ceil(n.outChannels/32);if(Ue().getBool("WEBGPU_CONV_SEPARATE_IM2COL_SHADER")||f<=m)return function({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){let{filterWidth:l,filterHeight:u,inChannels:d,strideWidth:c,strideHeight:h,padInfo:p,outWidth:m,outHeight:f,dilationWidth:g,dilationHeight:y,dataFormat:b}=n,x="channelsLast"===b,A=l*u*d,v=f*m,w=x?[n.batchSize,v,A]:[n.batchSize,A,v],k=new class{constructor(e,t){this.variableNames=["x"],this.uniforms="pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, outWidth : i32, itemsPerBlockRow : i32,\n       inChannels : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=t,this.shaderKey=`im2col_${this.isChannelsLast}`}getUserCode(){let e=this.isChannelsLast?1:2,t=this.isChannelsLast?2:3,n=this.isChannelsLast?"coords[1]":"coords[2]",r=this.isChannelsLast?"coords[2]":"coords[1]",a=this.isChannelsLast?"getX(batch, xRow, xCol, ch)":"getX(batch, ch, xRow, xCol)";return`\n    ${VL("index")} {\n      let coords = getCoordsFromIndex(index);\n      if(index < uniforms.size) {\n        let batch = coords[0];\n        let row = ${n};\n        let col = ${r};\n        let offsetY = (row / uniforms.outWidth) * uniforms.strides[0] - uniforms.pads[0];\n        let xRow = offsetY + uniforms.dilations[0] * (col / uniforms.itemsPerBlockRow);\n        var value = 0.0;\n        if(xRow < uniforms.xShape[${e}] && xRow >= 0) {\n          let offsetX = (row % uniforms.outWidth) * uniforms.strides[1] -\n              uniforms.pads[1];\n          let xCol = offsetX + uniforms.dilations[1] * ((col %\n              uniforms.itemsPerBlockRow) / uniforms.inChannels);\n          let ch = col % uniforms.inChannels;\n          if(xCol < uniforms.xShape[${t}] && xCol >= 0) {\n            value = ${a};\n          }\n        }\n        setOutputAtIndex(index, value);\n      }\n    }\n   `}}(w,x),S=[{type:"int32",data:[p.top,p.left]},{type:"int32",data:[h,c]},{type:"int32",data:[y,g]},{type:"int32",data:[m]},{type:"int32",data:[d*l]},{type:"int32",data:[d]}],T=r.runWebGPUProgram(k,[e],e.dtype,S),_=[];_.push(T);let I=aU({inputs:{x:t},backend:r,attrs:{shape:[1,A,-1]}});if(_.push(I),null!=i){let e=cV(i.shape,x);null!=e&&(i=aU({inputs:{x:i},backend:r,attrs:{shape:e}}),_.push(i))}if(null!=a){let e=cV(a.shape,x);null!=e&&(a=aU({inputs:{x:a},backend:r,attrs:{shape:e}}),_.push(a))}let C=sU({a:x?T:I,b:x?I:T,transposeA:!x,transposeB:!1,backend:r,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s}),E=aU({inputs:{x:C},backend:r,attrs:{shape:n.outShape}});_.push(C);for(let e of _)r.disposeData(e.dataId);return E}({x:e,filter:t,convInfo:n,backend:r,bias:a,preluActivationWeights:i,leakyreluAlpha:s,activation:o});let g,y=[n.padInfo.top,n.padInfo.left],b=[{type:"int32",data:[n.filterHeight,n.filterWidth]},{type:"int32",data:[...y]},{type:"int32",data:[n.strideHeight,n.strideWidth]},{type:"int32",data:[n.dilationHeight,n.dilationWidth]}];if(h)g=new class{constructor(e,t=!1,n=null,r=!1){this.variableNames=["x","W"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>,",this.workgroupSize=[4,4,8],this.outputShape=e.outShape,this.isChannelsLast="channelsLast"===e.dataFormat,this.dispatchLayout=this.isChannelsLast?{x:[2],y:[1],z:[0,3]}:{x:[3],y:[2],z:[0,1]},this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=t,this.activation=n,this.hasPreluActivationWeights=r,t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`conv2dnaive_${this.activation}_${this.isChannelsLast}`}getUserCode(){return`\n       ${VB(this.activation,this.hasPreluActivationWeights,!1,4)}\n       fn readInp(batch : i32, row : i32, col : i32, chan : i32) -> f32{\n         let coords = vec4<i32>(batch, row, col, chan);\n         if (coordsInBounds4D(coords, uniforms.xShape)) {\n           return  getX(batch, row, col, chan);\n         } else {\n          return 0.0;\n         }\n       }\n       fn readFilt(row : i32, col : i32, xChannel : i32, outChannel : i32) -> f32{\n         let coords = vec4<i32>(row, col, xChannel, outChannel);\n         if(coordsInBounds4D(coords, uniforms.wShape)) {\n           return getW(row, col, xChannel, outChannel);\n          } else {\n            return 0.0;\n          }\n       }\n       fn writeResult(batch : i32, row : i32, col : i32, chan : i32, valueIn : f32) {\n         let coords = ${this.isChannelsLast?"vec4<i32>(batch, row, col, chan);":"vec4<i32>(batch, chan, row, col);"}\n         if (coordsInBounds4D(coords, uniforms.outShape)) {\n           var value = valueIn;\n           ${jB(this.addBias,this.activation)}\n           setOutputAtCoords(coords.x, coords.y, coords.z, coords.w, value);\n         }\n       }\n       ${VL("index")} {\n         let coords = getOutputCoords();\n         let batch = coords[0];\n         let outChannel = ${this.isChannelsLast?"coords[3];":"coords[1];"}\n         let outRow = ${this.isChannelsLast?"coords[1];":"coords[2];"}\n         let outCol = ${this.isChannelsLast?"coords[2];":"coords[3];"}\n         var acc : f32 = 0.0;\n         for (var row = 0; row < uniforms.filterDims[0]; row = row + 1) {\n           for (var col = 0; col < uniforms.filterDims[1]; col = col + 1) {\n             let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * row - uniforms.pads[0];\n             let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * col - uniforms.pads[1];\n             for (var xChannel = 0; xChannel < ${this.isChannelsLast?"uniforms.xShape[3];":"uniforms.xShape[1];"} xChannel = xChannel + 1) {\n               ${this.isChannelsLast?"let v = readInp(batch, xRow, xCol, xChannel);":"let v = readInp(batch, xChannel, xRow, xCol);"}\n               let f = readFilt(row, col, xChannel, outChannel);\n               acc = acc + v * f;\n             }\n           }\n         }\n         writeResult(batch, outRow, outCol, outChannel, acc);\n       }\n     `}}(n,l,o,u);else{let e=d?n.outHeight*n.outWidth:n.outChannels,t=d?n.outChannels:n.outHeight*n.outWidth,a=n.filterHeight*n.filterWidth*n.inChannels;b.push({type:"int32",data:[e]},{type:"int32",data:[t]},{type:"int32",data:[a]});let i=r.adapterInfo.isIntel();g=new class{constructor(e,t,n,r,a=!1,i=null,s=!1,o=!1){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.outShape,this.isChannelsLast="channelsLast"===e.dataFormat,this.isVec4=((e.inChannels%4==0||e.inChannels%3==0)&&this.isChannelsLast||e.outWidth%4==0&&!this.isChannelsLast)&&e.outChannels%4==0,this.dispatchLayout=this.isChannelsLast?{x:[3],y:[1,2],z:[0]}:{x:[2,3],y:[1],z:[0]},this.workgroupSize=az(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=iz(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4?(this.outputComponent=4,this.isChannelsLast&&e.inChannels%4!=0?(this.innerElementSize=3,this.variableComponents=[1,4]):(this.innerElementSize=4,this.variableComponents=[4,4]),a&&(this.variableNames.push("bias"),this.variableComponents.push(4)),s&&(this.variableNames.push("preluActivationWeights"),this.variableComponents.push(4))):(this.innerElementSize=this.elementsPerThread[0],a&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights")),this.sequentialAccessByThreads=o,this.addBias=a,this.activation=i,this.hasPreluActivationWeights=s,this.tileAOuter=this.workgroupSize[1]*this.elementsPerThread[1],this.tileBOuter=this.workgroupSize[0]*this.elementsPerThread[0],this.tileInner=Math.max(this.workgroupSize[0]*this.innerElementSize,this.workgroupSize[1]),this.fitAOuter=t%this.tileAOuter==0,this.fitBOuter=n%this.tileBOuter==0,this.fitInner=r%this.tileInner==0,this.shaderKey=`conv2DMM_${this.elementsPerThread}_${this.activation}}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.innerElementSize}_${this.isChannelsLast}_${this.sequentialAccessByThreads}`}getUserCode(){let e=this.isVec4?qB(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner):KB(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner,!1,null,this.sequentialAccessByThreads),t=this.isVec4?[this.innerElementSize,4,4]:[1,1,1];return`\n    ${function(e,t,n,r,a=!1,i=null,s=!1,o=4,l=4,u=4){let d=e?"\n      let coord = vec4<i32>(batch, xRow, xCol, xCh);\n      ":"\n      let coord = vec4<i32>(batch, xCh, xRow, xCol);\n      ",c=e?"\n      let coords = vec4<i32>(\n        batch,\n        row / outWidth,\n        row % outWidth,\n        col);\n      ":"\n      let coords = vec4<i32>(\n        batch,\n        row,\n        col / outWidth,\n        col % outWidth);\n      ",h=e?"uniforms.xShape[1]":"uniforms.xShape[2]",p=e?"uniforms.xShape[2]":"uniforms.xShape[3]",m=e?"row":"col",f=e?"col":"row",g=`\n      let inChannels = uniforms.wShape[2];\n      let outWidth = ${e?"uniforms.outShape[2]":"uniforms.outShape[3]"};\n      let outRow = ${m} / outWidth;\n      let outCol = ${m} % outWidth;\n\n      let WRow = ${f} / (uniforms.filterDims[1] * inChannels);\n      let WCol = ${f} / inChannels % uniforms.filterDims[1];\n      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];\n      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];\n      let xCh = ${f} % inChannels;\n      var resData = ${BL(o)}(0.0);\n      // The bounds checking is always needed since we use it to pad zero for\n      // the 'same' padding type.\n      if (xRow >= 0 && xRow < ${h} && xCol >= 0 && xCol < ${p}) {\n        ${d}\n        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);\n        ${(e=>{switch(e){case 1:return"resData = x[xIndex];";case 3:return"resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);";case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${e} is not supported.`)}})(o)}\n      }\n      return resData;`,y=e?t&&r?`\n      let col = colIn * ${o};\n      ${g}`:`\n      let col = colIn * ${o};\n      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        ${g}\n      }\n      return ${BL(o)}(0.0);`:r&&n?`\n      let col = colIn * ${o};\n      ${g}`:`\n      let col = colIn * ${o};\n      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n        ${g}\n      }\n      return ${BL(o)}(0.0);`,b=`${(e=>{switch(e){case 1:return"return W[row * uniforms.wShape[3] + colIn];";case 4:return"return W[row * uniforms.wShape[3] / 4 + colIn];";default:throw new Error(`innerElementSize ${e} is not supported.`)}})(l)}`,x=BL(u),A=BL(e?o:l),v=BL(e?l:o);return`\n      ${VB(i,s,4===u,4)}\n      fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${A} {\n        ${e?y:b}\n      }\n\n      fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${v} {\n        ${e?b:y}\n      }\n\n      fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${x}) {\n        let col = colIn * ${u};\n        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)\n        {\n        var value = valueIn;\n        let outWidth = ${e?"uniforms.outShape[2]":"uniforms.outShape[3]"};\n        ${c}\n        ${jB(a,i)}\n        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }`}(this.isChannelsLast,this.fitAOuter,this.fitBOuter,this.fitInner,this.addBias,this.activation,this.hasPreluActivationWeights,t[0],t[1],t[2])}\n    ${e}\n  `}}(n,e,t,a,l,o,u,i)}let x=[],A=[e,t];l&&(!d&&1===a.shape.length&&(a=aU({inputs:{x:a},backend:r,attrs:{shape:[a.shape[0],1,1]}}),x.push(a)),A.push(a)),u&&(!d&&1===i.shape.length&&(i=aU({inputs:{x:i},backend:r,attrs:{shape:[i.shape[0],1,1]}}),x.push(i)),A.push(i)),"leakyrelu"===o&&(b.push({type:"float32",data:[s]}),g.uniforms+=" alpha : f32,");let v=r.runWebGPUProgram(g,A,e.dtype,b);for(let e of x)r.disposeData(e.dataId);return v}var pV,mV={kernelName:wt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:u,dimRoundingMode:d}=n,c=$m.convertConv2DDataFormat(l);return hV({x:a,filter:i,convInfo:$m.computeConv2DInfo(a.shape,i.shape,s,u,o,d,!1,c),backend:r})}},fV={kernelName:kt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:d}=r,c=$m.convertConv2DDataFormat(l),h=$m.computeConv2DInfo(a.shape,d,s,1,o,u,!1,c),p=new class{constructor(e){this.variableNames=["x","dy"],this.uniforms="pads : vec2<i32>, strides : vec2<i32>, batchSize : i32, outHeight : i32, outWidth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast="channelsLast"===e.dataFormat,this.shaderKey=`conv2DDerFilter_${this.isChannelsLast}`}getUserCode(){return`\n    ${VL("index")} {\n      if(index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let wR = coords[0];\n        let wC = coords[1];\n        let d1 = coords[2];\n        let d2 = coords[3];\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var b = 0; b < uniforms.batchSize; b = b + 1) {\n          for (var yR = 0; yR < uniforms.outHeight; yR = yR + 1) {\n            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];\n            if (xR < 0 || xR >= uniforms.inHeight) {\n              continue;\n            }\n\n            for (var yC = 0; yC < uniforms.outWidth; yC = yC + 1) {\n              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];\n\n              if (xC < 0 || xC >= uniforms.inWidth) {\n                continue;\n              }\n\n              if (${this.isChannelsLast}) {\n                let dyValue = getDy(b, yR, yC, d2);\n                let xValue = getX(b, xR, xC, d1);\n                dotProd = dotProd + xValue * dyValue;\n              } else {\n                let dyValue = getDy(b, d2, yR, yC);\n                let xValue = getX(b, d1, xR, xC);\n                dotProd = dotProd + xValue * dyValue;\n              }\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n  `}}(h),m=[{type:"int32",data:[h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.batchSize]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]},{type:"int32",data:[h.inHeight]},{type:"int32",data:[h.inWidth]}];return n.runWebGPUProgram(p,[a,i],a.dtype,m)}},gV={kernelName:St,backendName:"webgpu",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{dy:i,filter:s}=n,{inputShape:o,strides:l,pad:u,dataFormat:d,dimRoundingMode:c}=a,h=$m.convertConv2DDataFormat(d),p=$m.computeConv2DInfo(o,s.shape,l,1,u,c,!1,h),m=[{type:"int32",data:[p.filterHeight,p.filterWidth]},{type:"int32",data:[p.filterHeight-1-p.padInfo.top,p.filterWidth-1-p.padInfo.left]},{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.batchSize,p.outHeight,p.outWidth,p.outChannels]}];if(Ue().getBool("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE")||"channelsLast"!==p.dataFormat)t=new class{constructor(e){this.variableNames=["dy","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>,",this.workgroupSize=[64,1,1],this.size=!1,this.isVec4=!1,this.workPerThread=1,this.outputShape=e.inShape,this.isChannelsLast="channelsLast"===e.dataFormat,this.isVec4=this.isChannelsLast&&e.outChannels%4==0&&e.inChannels%4==0,this.isVec4?(this.workPerThread=2,this.outputComponent=4,this.workgroupSize=[4,4,4],this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[4,this.workPerThread,1])):(this.size=!0,this.workPerThread=1,this.workgroupSize=[64,1,1],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize)),this.shaderKey=`conv2DDerInput_${this.isChannelsLast}_${this.isVec4}_${this.workPerThread}`}getUserCode(){let e=this.isChannelsLast?1:2,t=this.isChannelsLast?2:3,n=this.isChannelsLast?3:1,r=`\n    ${VL()} {\n      let batch = i32(globalId.z) / uniforms.outShape[1];\n      let r = i32(globalId.z) % uniforms.outShape[1];\n      let c = i32(globalId.y) * ${this.workPerThread};\n      let d1 = i32(globalId.x) * 4;\n\n      let dyCorner = vec2<i32>(r, c) - uniforms.pads;\n\n      // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n      // ? = to be determined. : = across all values in that axis.\n      var dotProd: array<vec4<f32>, ${this.workPerThread}>;\n      for (var i = 0; i < ${this.workPerThread}; i++) {\n        dotProd[i] = vec4<f32>(0.0);\n      }\n      for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {\n        let dyR = f32(dyCorner.x + wR) / f32(uniforms.strides.x);\n        let wRPerm = uniforms.filterDims.x - 1 - wR;\n        if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) ||\n            fract(dyR) > 0.0) {\n          continue;\n        }\n        let idyR = i32(dyR);\n\n        for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {\n          let dyC = f32(dyCorner.y + wC) / f32(uniforms.strides.y);\n          let dyC2 = f32(dyCorner.y + 1 + wC) / f32(uniforms.strides.y);\n          let wCPerm = uniforms.filterDims.y - 1 - wC;\n          var bDyCVal = true;\n          var bDyCVal2 = true;\n          if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||\n              fract(dyC) > 0.0) {\n            bDyCVal = false;\n          }\n          if (dyC2 < 0.0 || dyC2 >= f32(uniforms.outBackprop[2]) ||\n              fract(dyC2) > 0.0) {\n            bDyCVal2 = false;\n          }\n\n          let idyC = i32(dyC);\n          let idyC2 = i32(dyC2);\n          if (bDyCVal && bDyCVal2) {\n            let d2Length = uniforms.outBackprop[3];\n            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {\n              let wValue0 = getW(wRPerm, wCPerm, d1, d2);\n              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);\n              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);\n              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);\n              var xValue =  getDy(batch, idyR, idyC, d2);\n              let tmpval = vec4<f32>(dot(xValue, wValue0),\n                                     dot(xValue, wValue1),\n                                     dot(xValue, wValue2),\n                                     dot(xValue, wValue3));\n              dotProd[0] = dotProd[0] + tmpval;\n              xValue = getDy(batch, idyR, idyC2, d2);\n              dotProd[1] = dotProd[1] + vec4<f32>(dot(xValue, wValue0),\n                                                  dot(xValue, wValue1),\n                                                  dot(xValue, wValue2),\n                                                  dot(xValue, wValue3));\n            }\n          } else if (bDyCVal) {\n            let d2Length = uniforms.outBackprop[3];\n            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {\n              let wValue0 = getW(wRPerm, wCPerm, d1, d2);\n              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);\n              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);\n              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);\n              var xValue =  getDy(batch, idyR, idyC, d2);\n              let tmpval = vec4<f32>(dot(xValue, wValue0),\n                                     dot(xValue, wValue1),\n                                     dot(xValue, wValue2),\n                                     dot(xValue, wValue3));\n              dotProd[0] = dotProd[0] + tmpval;\n            }\n          } else if (bDyCVal2) {\n            let d2Length = uniforms.outBackprop[3];\n            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {\n              let wValue0 = getW(wRPerm, wCPerm, d1, d2);\n              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);\n              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);\n              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);\n              var xValue =  getDy(batch, idyR, idyC2, d2);\n              let tmpval = vec4<f32>(dot(xValue, wValue0),\n                                     dot(xValue, wValue1),\n                                     dot(xValue, wValue2),\n                                     dot(xValue, wValue3));\n              dotProd[1] = dotProd[1] + tmpval;\n            }\n          }\n        }\n      }\n\n      for (var i = 0; i < ${this.workPerThread}; i = i + 1) {\n        let coords = vec4<i32>(batch, r, c + i, d1);\n        if (coordsInBounds4D(coords, uniforms.outShape)) {\n          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], dotProd[i]);\n        }\n      }\n    }\n    `;return this.isVec4?`\n    ${r}\n    `:`\n    ${VL("index")} {\n      if(index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords[0];\n        let d1 = coords[${n}];\n\n        let dyCorner = vec2<i32>(coords[${e}], coords[${t}]) - uniforms.pads;\n        let dyRCorner = dyCorner.x;\n        let dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {\n          let dyR = (f32(dyRCorner) + f32(wR)) / f32(uniforms.strides.x);\n          let wRPerm = uniforms.filterDims.x - 1 - wR;\n          if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) || fract(dyR) > 0.0 ||\n              wRPerm < 0) {\n            continue;\n          }\n          let idyR = i32(dyR);\n\n          for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {\n            let dyC = (f32(dyCCorner) + f32(wC)) / f32(uniforms.strides.y);\n            let wCPerm = uniforms.filterDims.y - 1 - wC;\n            if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||\n                fract(dyC) > 0.0 || wCPerm < 0) {\n              continue;\n            }\n            let idyC = i32(dyC);\n\n            for (var d2 = 0; d2 < uniforms.outBackprop[3]; d2 = d2 + 1) {\n              let xValue = ${this.isChannelsLast?"getDy(batch, idyR, idyC, d2)":"getDy(batch, d2, idyR, idyC)"};\n              let wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd = dotProd + xValue * wValue;\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n  `}}(p);else{t=new class{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.inShape,Sa.assert("channelsLast"===e.dataFormat,(()=>"TODO: NCHW is unimplemented")),this.isVec4=e.inChannels%4==0&&e.outChannels%4==0,this.dispatchLayout={x:[3],y:[1,2],z:[0]},this.workgroupSize=az(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=iz(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4&&(this.outputComponent=4,this.variableComponents=[4,1]),this.shaderKey=`conv2DDerInputMM_${this.isVec4}_${this.elementsPerThread}`}getUserCode(){let e=this.isVec4?qB(this.elementsPerThread,this.workgroupSize):KB(this.elementsPerThread,this.workgroupSize);return`\n    ${function(e=4){let t=`if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        \n      let outRow = row / uniforms.outShape[2];\n      let outCol = row % uniforms.outShape[2];\n\n      let WRow = col / (uniforms.filterDims[1] * uniforms.outBackprop[3]);\n      let WCol = col / uniforms.outBackprop[3] % uniforms.filterDims[1];\n      let xR = f32(outRow - uniforms.pads[0] + WRow) / f32(uniforms.strides[0]);\n      let xC = f32(outCol - uniforms.pads[1] + WCol) / f32(uniforms.strides[1]);\n      if (xR < 0.0 || xR >= f32(uniforms.outBackprop[1]) || fract(xR) > 0.0) {\n        return ${BL(e)}(0.0);\n      }\n      if (xC < 0.0 || xC >= f32(uniforms.outBackprop[2]) || fract(xC) > 0.0) {\n        return ${BL(e)}(0.0);\n      }\n      let coord = vec4<i32>(\n          batch,\n          i32(xR),\n          i32(xC),\n          col % uniforms.outBackprop[3]);\n      return x[getIndexFromCoords4D(coord, uniforms.xShape)/${e}];\n      }\n      return ${BL(e)}(0.0);`;return`\n  fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${BL(e)} {\n    let col = colIn * ${e};\n    ${t}\n  }\n\n  fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${BL(e)} {\n    let col = colIn * ${e};\n    let coordX = uniforms.filterDims.x - 1 -\n        row / (uniforms.filterDims[1] * uniforms.outBackprop[3]);\n    let coordY = uniforms.filterDims.y - 1 -\n        (row / uniforms.outBackprop[3]) % uniforms.filterDims[1];\n    if (row < uniforms.dimInner && col < uniforms.dimBOuter &&\n        coordX >= 0 && coordY >= 0) {\n      let rowInner = row % uniforms.outBackprop[3];\n      let coord = vec4<i32>(coordX, coordY, col, rowInner);\n      ${(e=>{switch(e){case 1:return"return W[getIndexFromCoords4D(coord, uniforms.wShape)];";case 4:return"\n            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);\n            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);\n            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);\n            let v0 = W[getIndexFromCoords4D(coord, uniforms.wShape)];\n            let v1 = W[getIndexFromCoords4D(coord1, uniforms.wShape)];\n            let v2 = W[getIndexFromCoords4D(coord2, uniforms.wShape)];\n            let v3 = W[getIndexFromCoords4D(coord3, uniforms.wShape)];\n            return vec4<f32>(v0, v1, v2, v3);\n            ";default:throw new Error(`innerElementSize ${e} is not supported.`)}})(e)}\n    }\n    return ${BL(e)}(0.0);\n  }\n\n  fn mm_write(batch: i32, row : i32, colIn : i32, valueInput : ${BL(e)}) {\n    let col = colIn * ${e};\n    if (row < uniforms.dimAOuter && (col + ${e-1}) < uniforms.dimBOuter) {\n      var value = valueInput;\n      let outCoord = vec4<i32>(\n          batch,\n          row / uniforms.outShape[2],\n          row % uniforms.outShape[2],\n          col);\n      result[getIndexFromCoords4D(outCoord, uniforms.outShape)/${e}] = value;\n    }\n  }`}(this.isVec4?4:1)}\n    ${e}\n    `}}(p);let e=p.inHeight*p.inWidth,n=p.inChannels,r=p.filterHeight*p.filterWidth*p.outChannels;m.push({type:"uint32",data:[e]},{type:"uint32",data:[n]},{type:"uint32",data:[r]})}return r.runWebGPUProgram(t,[i,s],"float32",m)}},yV={kernelName:Tt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,u=$m.computeConv3DInfo(a.shape,i.shape,s,l,o),d=[u.padInfo.front,u.padInfo.top,u.padInfo.left],c=[{type:"int32",data:[u.filterDepth,u.filterHeight,u.filterWidth]},{type:"int32",data:[...d]},{type:"int32",data:[u.strideDepth,u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationDepth,u.dilationHeight,u.dilationWidth]}],h=new class{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims: vec3<i32>, pads: vec3<i32>, strides: vec3<i32>, dilations: vec3<i32>,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3dnaive"}getUserCode(){return`\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        let batch = coords.x;\n        let d2 = coords.u;\n\n        let xFRCCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;\n        let xFCorner = xFRCCorner.x;\n        let xRCorner = xFRCCorner.y;\n        let xCCorner = xFRCCorner.z;\n\n        let inputDepthNearestVec4 = (uniforms.xShape.u / 4) * 4;\n        let inputDepthVec4Remainder = uniforms.xShape.u % 4;\n\n        var dotProd = 0.0;\n        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {\n          let xF = xFCorner + wF * uniforms.dilations[0];\n          if (xF < 0 || xF >= uniforms.xShape.y) {\n            continue;\n          }\n\n          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {\n            let xR = xRCorner + wR * uniforms.dilations[1];\n            if (xR < 0 || xR >= uniforms.xShape.z) {\n              continue;\n            }\n\n            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {\n              let xC = xCCorner + wC * uniforms.dilations[2];\n              if (xC < 0 || xC >= uniforms.xShape.w) {\n                continue;\n              }\n\n              for (var d1 = 0; d1 < inputDepthNearestVec4; d1 += 4) {\n                let xValues = vec4<f32>(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                let wValues = vec4<f32>(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (inputDepthVec4Remainder == 1) {\n                dotProd += getX(batch, xF, xR, xC, inputDepthNearestVec4) *\n                  getW(wF, wR, wC, inputDepthNearestVec4, d2);\n              } else if (inputDepthVec4Remainder == 2) {\n                let xValues = vec2<f32>(\n                  getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1)\n                );\n                let wValues = vec2<f32>(\n                  getW(wF, wR, wC, inputDepthNearestVec4, d2),\n                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (inputDepthVec4Remainder == 3) {\n                let xValues = vec3<f32>(\n                  getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),\n                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2)\n                );\n                let wValues = vec3<f32>(\n                  getW(wF, wR, wC, inputDepthNearestVec4, d2),\n                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2),\n                  getW(wF, wR, wC, inputDepthNearestVec4 + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }`}}(u),p=gi(a.dtype,i.dtype);return n.runWebGPUProgram(h,[a,i],p,c)}},bV={kernelName:_t,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r,u=$m.computeConv3DInfo(a.shape,l,s,1,o),d=new class{constructor(e){this.variableNames=["x","dy"],this.uniforms="pads : vec3<i32>, strides : vec3<i32>, batchSize : i32, outDepth : i32,\n       outHeight : i32, outWidth : i32, inDepth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerFilter"}getUserCode(){return`\n    ${VL("index")} {\n      if(index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let wF = coords.x;\n        let wR = coords.y;\n        let wC = coords.z;\n        let d1 = coords.w;\n        let d2 = coords.u;\n\n        var dotProd = 0.0;\n        for (var b = 0; b < uniforms.batchSize; b++) {\n          for (var yF = 0; yF < uniforms.outDepth; yF++) {\n            let xF = wF + yF * uniforms.strides[0] - uniforms.pads[0];\n            if (xF < 0 || xF >= uniforms.inDepth) {\n              continue;\n            }\n\n            for (var yR = 0; yR < uniforms.outHeight; yR++) {\n              let xR = wR + yR * uniforms.strides[1] - uniforms.pads[1];\n              if (xR < 0 || xR >= uniforms.inHeight) {\n                continue;\n              }\n\n              for (var yC = 0; yC < uniforms.outWidth; yC++) {\n                let xC = wC + yC * uniforms.strides[2] - uniforms.pads[2];\n                if (xC < 0 || xC >= uniforms.inWidth) {\n                  continue;\n                }\n\n                let dyValue = getDy(b, yF, yR, yC, d2);\n                let xValue = getX(b, xF, xR, xC, d1);\n                dotProd += xValue * dyValue;\n              }\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n  `}}(u),c=[{type:"int32",data:[u.padInfo.front,u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.strideDepth,u.strideHeight,u.strideWidth]},{type:"int32",data:[u.batchSize]},{type:"int32",data:[u.outDepth]},{type:"int32",data:[u.outHeight]},{type:"int32",data:[u.outWidth]},{type:"int32",data:[u.inDepth]},{type:"int32",data:[u.inHeight]},{type:"int32",data:[u.inWidth]}];return n.runWebGPUProgram(d,[a,i],i.dtype,c)}},xV={kernelName:It,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,pad:o,inputShape:l}=r,u=$m.computeConv3DInfo(l,i.shape,s,1,o),d=new class{constructor(e){this.variableNames=["dy","W"],this.uniforms="filterDims : vec3<i32>, pads : vec3<i32>, strides : vec3<i32>,\n      outDepth : i32, outHeight : i32, outWidth : i32, outChannels : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerInput"}getUserCode(){return`\n    ${VL("index")} {\n      if(index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords.x;\n        let d1 = coords.u;\n\n        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;\n        let dyFCorner = dyCorner.x;\n        let dyRCorner = dyCorner.y;\n        let dyCCorner = dyCorner.z;\n\n        var dotProd = 0.0;\n        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {\n          let dyF = f32(dyFCorner + wF) / f32(uniforms.strides[0]);\n          if (dyF < 0.0 || dyF >= f32(uniforms.outDepth) || fract(dyF) > 0.0) {\n            continue;\n          }\n          let idyF = i32(dyF);\n\n          let wFPerm = uniforms.filterDims[0] - 1 - wF;\n\n          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {\n            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);\n\n            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n              continue;\n            }\n            let idyR = i32(dyR);\n\n            let wRPerm = uniforms.filterDims[1] - 1 - wR;\n\n            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {\n              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);\n\n              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n                continue;\n              }\n              let idyC = i32(dyC);\n\n              let wCPerm = uniforms.filterDims[2] - 1 - wC;\n\n              for (var d2 = 0; d2 < uniforms.outChannels; d2++) {\n                let xValue = getDy(batch, idyF, idyR, idyC, d2);\n                let wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n  `}}(u),c=[{type:"int32",data:[u.filterDepth,u.filterHeight,u.filterWidth]},{type:"int32",data:[u.filterDepth-1-u.padInfo.front,u.filterHeight-1-u.padInfo.top,u.filterWidth-1-u.padInfo.left]},{type:"int32",data:[u.strideDepth,u.strideHeight,u.strideWidth]},{type:"int32",data:[u.outDepth]},{type:"int32",data:[u.outHeight]},{type:"int32",data:[u.outWidth]},{type:"int32",data:[u.outChannels]}];return n.runWebGPUProgram(d,[a,i],a.dtype,c)}},AV=fU({opType:pz.COS}),vV={kernelName:Ct,backendName:"webgpu",kernelFunc:AV},wV=fU({opType:pz.COSH}),kV={kernelName:Et,backendName:"webgpu",kernelFunc:wV},SV={kernelName:Pt,backendName:"webgpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:u}=r,d=new class{constructor(e,t,n,r){this.variableNames=["Image","Boxes","BoxInd"],this.uniforms="extrapolationValue : f32,",this.workgroupSize=[64,1,1],this.size=!0;let[a]=t;this.outputShape=[a,n[0],n[1],e],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.methodId="bilinear"===r?1:0,this.cropHeightBiggerThan1=this.outputShape[1]>1,this.cropWidthBiggerThan1=this.outputShape[2]>1,this.shaderKey=`cropAndResize_${this.methodId}_${this.cropHeightBiggerThan1}_${this.cropWidthBiggerThan1}`}getUserCode(){let[e,t]=["f32(uniforms.imageShape[1] - 1)","f32(uniforms.imageShape[2] - 1)"],[n,r,a]=this.cropHeightBiggerThan1?[`(${e} / f32(uniforms.outShape[1] - 1))`,"(y2-y1) * height_ratio",`y1*${e} + f32(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${e}`],[i,s,o]=this.cropWidthBiggerThan1?[`(${t} / f32(uniforms.outShape[2] - 1))`,"(x2-x1) * width_ratio",`x1*${t} + f32(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${t}`];return`\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let height_ratio = f32(${n});\n        let width_ratio = f32(${i});\n        let b = coords[0];\n        let y = coords[1];\n        let x = coords[2];\n        let d = coords[3];\n        // get box vals\n        let y1 = getBoxes(b, 0);\n        let x1 = getBoxes(b, 1);\n        let y2 = getBoxes(b, 2);\n        let x2 = getBoxes(b, 3);\n        // get image in batch index\n        let bInd = i32(round(getBoxInd(b)));\n        if(bInd < 0 || bInd >= uniforms.outShape[0]) {\n          return;\n        }\n        let height_scale = ${r};\n        let width_scale = ${s};\n        let in_y = ${a};\n        if( in_y < 0.0 || in_y > ${e} ) {\n          setOutputAtIndex(index, uniforms.extrapolationValue);\n          return;\n        }\n        let in_x = ${o};\n        if( in_x < 0.0 || in_x > ${t} ) {\n          setOutputAtIndex(index, uniforms.extrapolationValue);\n          return;\n        }\n        let sourceFracIndexCR = vec2<f32>(in_x,in_y);\n        if(${this.methodId} == 1) {\n          // Compute the four integer indices.\n          let sourceFloorCR = vec2<i32>(sourceFracIndexCR);\n          let sourceCeilCR = vec2<i32>(ceil(sourceFracIndexCR));\n          let topLeft = getImage(bInd, sourceFloorCR.y, sourceFloorCR.x, d);\n          let bottomLeft = getImage(bInd, sourceCeilCR.y, sourceFloorCR.x, d);\n          let topRight = getImage(bInd, sourceFloorCR.y, sourceCeilCR.x, d);\n          let bottomRight = getImage(bInd, sourceCeilCR.y, sourceCeilCR.x, d);\n          let fracCR = sourceFracIndexCR - vec2<f32>(sourceFloorCR);\n          let top = topLeft + (topRight - topLeft) * fracCR.x;\n          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          let newValue = top + (bottom - top) * fracCR.y;\n          setOutputAtIndex(index, newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          let sourceNearestCR = vec2<i32>(floor(\n            sourceFracIndexCR + vec2<f32>(0.5,0.5)));\n          let newValue = getImage(\n            bInd, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutputAtIndex(index, newValue);\n        }\n      }\n    }\n    `}}(a.shape[3],i.shape,o,l),c=[{type:"float32",data:[u]}];return n.runWebGPUProgram(d,[a,i,s],"float32",c)}};!function(e){e.Prod="*",e.Sum="+"}(pV||(pV={}));var TV=class{constructor(e,t,n,r){this.variableNames=["x"],this.uniforms="index : f32,",this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=t,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.exclusive=n,this.reverse=r,this.op=e,this.shaderKey=`cum_${this.op}_${this.exclusive}_${this.reverse}`}getUserCode(){let e=this.outputShape.length,t=this.op===pV.Prod?"1.0":"0.0",n=this.exclusive?t:`getX(${_V(e,"coords",this.op)})`,r=this.outputShape[this.outputShape.length-1],a="",i="";return this.exclusive?(a=this.reverse?"end != "+(r-1):"end != 0",i=this.reverse?"end + 1":"end - 1"):(a=this.reverse?`end + pow2 < ${r}`:"end >= pow2",i=this.reverse?"end + pow2":"end - pow2"),`\n      ${VL("index")} {\n       if (index < uniforms.size) {\n         var coords = getCoordsFromIndex(index);\n\n         let end = ${IV(e,"coords",this.op)};\n         var val = ${n};\n         let pow2 = i32(pow(2.0, uniforms.index));\n         if (${a}) {\n           let idx = ${i};\n           ${IV(e,"coords",this.op)} = idx;\n           val ${this.op}= getX(${_V(e,"coords",this.op)});\n         }\n         setOutputAtIndex(index, val);\n       }\n      }\n    `}};function _V(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function IV(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function CV(e,t,n,r,a,i){let s=t.shape.length,o=$m.getAxesPermutation([r],s),l=t;null!=o&&(l=dW({inputs:{x:t},backend:n,attrs:{perm:o}}));let u=$m.getInnerMostAxes(1,s)[0];if(u!==s-1)throw new Error(`WebGPU cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let d=l.shape[u],c=dU({inputs:{x:l},backend:n});for(let t=0;t<=Math.ceil(Math.log2(d))-1;t++){let r=new TV(e,l.shape,!1,i),a=c,s=[{type:"float32",data:[t]}];c=n.runWebGPUProgram(r,[c],c.dtype,s),n.disposeData(a.dataId)}if(a){let t=new TV(e,l.shape,a,i),r=c,s=[{type:"float32",data:[0]}];c=n.runWebGPUProgram(t,[c],c.dtype,s),n.disposeData(r.dataId)}if(null!=o){let e=dW({inputs:{x:c},backend:n,attrs:{perm:$m.getUndoAxesPermutation(o)}});return n.disposeData(c.dataId),n.disposeData(l.dataId),e}return c}var EV={kernelName:Nt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return CV(pV.Prod,a,n,i,s,o)}},NV={kernelName:Rt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return CV(pV.Sum,a,n,i,s,o)}},RV={kernelName:Dt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r,l=1===a.shape.length,u=Sa.sizeFromShape(i.shape)>0,d=i.dtype,c=l?[a.shape[0]]:[a.shape[0],a.shape[1]],h=nU({backend:n,attrs:{shape:l?[s]:[a.shape[0],s],value:0,dtype:d}}),p=new GW(c,u,o),m=[{type:"int32",data:[s]}],f=u?[a,i]:[a];return n.runWebGPUProgram(p,f,d,m,h)}},PV={kernelName:Mt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r,o=a.shape[0],l=("NHWC"===s?a.shape[1]:a.shape[2])*i,u=("NHWC"===s?a.shape[2]:a.shape[3])*i,d=("NHWC"===s?a.shape[3]:a.shape[1])/(i*i),c="NHWC"===s?[o,l,u,d]:[o,d,l,u],h=[{type:"int32",data:[i]}],p=new class{constructor(e,t){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.uniforms="blockSize : i32,",this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`depthToSpace_${t}`,this.dataFormat=t}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let b = coords[0];\n          let h = ${this.getHeightCoordString()};\n          let w = ${this.getWidthCoordString()};\n          let d = ${this.getDepthCoordString()};\n\n          let in_h = h / uniforms.blockSize;\n          let offset_h = h % uniforms.blockSize;\n          let in_w = w / uniforms.blockSize;\n          let offset_w = w % uniforms.blockSize;\n          let offset_d = (offset_h * uniforms.blockSize + offset_w) *\n            ${this.getOutputDepthSize()};\n          let in_d = d + offset_d;\n\n          let rlt = ${this.getInputSamplingString()};\n          setOutputAtIndex(index, rlt);\n        }\n      }`}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?"uniforms.outShape[3]":"uniforms.outShape[1]"}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}(c,s);return n.runWebGPUProgram(p,[a],a.dtype,h)}},DV=class{constructor(e,t=!1,n=null,r=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>, virtualWidth : i32,",this.workgroupSize=[64,1,1],this.workPerThread=4,this.outputComponent=4,this.outputShape=e.outShape,this.virtualWidth=Math.ceil(this.outputShape[2]/this.workPerThread)*this.workPerThread;let a=[this.outputShape[0],this.outputShape[1],this.virtualWidth,this.outputShape[3]];this.dispatchLayout=sz(a),this.dispatch=nz(this.dispatchLayout,a,this.workgroupSize,[this.outputComponent*this.workPerThread,1,1]),Sa.assert("channelsLast"===e.dataFormat,(()=>"TODO: NCHW is unimplemented")),t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=t,this.activation=n,this.hasPreluActivation=r,this.shaderKey=`depthwiseVec4_${n}_${this.convInfo.filterHeight}_${this.convInfo.filterWidth}_${this.convInfo.strideHeight}_${this.convInfo.strideWidth}_${this.workPerThread}`}getUserCode(){let e=(this.workPerThread-1)*this.convInfo.strideWidth+this.convInfo.filterWidth,t=this.convInfo.strideHeight,n=this.convInfo.strideWidth;return`\n      ${VB(this.activation,this.hasPreluActivation,!0,4)}\n      fn readX(batch : i32, row : i32, col : i32, channel : i32) -> vec4<f32> {\n        var value = vec4<f32>(0.0);\n        if (col >=0 && col < uniforms.inDims[1]) {\n          value = getX(batch, row, col, channel);\n        }\n        return value;\n      }\n\n      ${VL("index")} {\n        let width0 = uniforms.outShape[3] / ${this.outputComponent};\n        let d1 = (index % width0) * ${this.outputComponent};\n        var index1 = index / width0;\n        let width1 = uniforms.virtualWidth / ${this.workPerThread};\n        let c = (index1 % width1) * ${this.workPerThread};\n        index1 = index1 / width1;\n        let r = index1 % uniforms.outShape[1];\n        let batch = index1 / uniforms.outShape[1];\n\n        let xRCCorner = vec2<i32>(r, c) * vec2<i32>(${t}, ${n}) - uniforms.pads;\n\n        let xRCorner = xRCCorner.x;\n        let xCCorner = xRCCorner.y;\n        var xVals : array<vec4<f32>, ${e}>;\n        var dotProd : array<vec4<f32>, ${this.workPerThread}>;\n        for (var i = 0; i < ${this.workPerThread}; i++) {\n          dotProd[i] = vec4<f32>(0.0);\n        }\n\n        // Use constant instead of uniform can give better performance.\n        for (var wR = 0; wR < ${this.convInfo.filterHeight}; wR = wR + 1) {\n          let xR = xRCorner + wR;\n          if (xR >=0 && xR < uniforms.inDims[0]) {\n            for (var i = 0; i < ${e}; i++) {\n              xVals[i] = readX(batch, xR, xCCorner + i, d1);\n            }\n            for (var wC = 0; wC < ${this.convInfo.filterWidth}; wC = wC + 1) {\n              let wValue = getW(wR, wC, d1, 0);\n              for (var i = 0; i < ${this.workPerThread}; i++) {\n                dotProd[i] = fma(xVals[i * ${n} + wC], wValue, dotProd[i]);\n              }\n            }\n          }\n        }\n\n        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {\n          let coords = vec4<i32>(batch, r, c + i, d1);\n          if (coordsInBounds4D(coords, uniforms.outShape)) {\n            var value = dotProd[i];\n            ${jB(this.addBias,this.activation)}\n            setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n          }\n        }\n      }\n    `}},MV=class{constructor(e,t=!1,n=null,r=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>, filterHeight : i32,\n      filterWidth : i32, strides : vec2<i32>, dilations : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast="channelsLast"===e.dataFormat,t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=t,this.activation=n,this.hasPreluActivation=r,this.shaderKey=`depthwise_${this.activation}_${this.isChannelsLast}`}getUserCode(){let e=this.isChannelsLast?"getX(batch, xR, xC, d1);":"getX(batch, d1, xR, xC);";return`\n      ${VB(this.activation,this.hasPreluActivation,!1,4)}\n\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getOutputCoords();\n          let batch = coords[0];\n          let xRCCorner = vec2<i32>(coords.${this.isChannelsLast?"yz":"zw"}) * uniforms.strides - uniforms.pads;\n          let d2 = coords[${this.isChannelsLast?3:1}];\n          let channelMul = uniforms.wShape[3];\n          let d1 = d2 / channelMul;\n          let q = d2 % channelMul;\n\n          let inputRowStart = xRCCorner.x;\n          let inputColStart = xRCCorner.y;\n          let inputRowEnd = inputRowStart + uniforms.filterHeight *\n              uniforms.dilations[0];\n          let inputColEnd = inputColStart + uniforms.filterWidth *\n              uniforms.dilations[1];\n\n          // Convolve x(?, ?, d1)|x(d1, ?, ?) with w(:, :, d1, q) to get\n          // y(yR, yC, d2)|y(d2, yR, yC). ? = to be determined. : = across all\n          // values in that axis. x(?, ?, d1) and y(yR, yC, d2) is for NHWC.\n          // x(d1, ?, ?) and y(d2, yR, yC) is for NCHW.\n          var value = 0.0;\n\n          // Extract if checking out of for loop for performance.\n          if (inputRowStart >= 0 && inputColStart >= 0 &&\n            inputRowEnd < uniforms.inDims[0] &&\n                inputColEnd < uniforms.inDims[1]) {\n              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {\n                let xR = inputRowStart + wR * uniforms.dilations[0];\n\n                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {\n                  let xC = inputColStart + wC * uniforms.dilations[1];\n\n                  let xVal = ${e};\n                  let wVal = getW(wR, wC, d1, q);\n                  value = value + xVal * wVal;\n                }\n              }\n            } else {\n              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {\n                let xR = inputRowStart + wR * uniforms.dilations[0];\n\n                if (xR < 0 || xR >= uniforms.inDims[0]) {\n                  continue;\n                }\n\n                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {\n                  let xC = inputColStart + wC * uniforms.dilations[1];\n\n                  if (xC < 0 || xC >= uniforms.inDims[1]) {\n                    continue;\n                  }\n\n                  let xVal = ${e};\n                  let wVal = getW(wR, wC, d1, q);\n                  value = value + xVal * wVal;\n                }\n              }\n            }\n            ${jB(this.addBias,this.activation)}\n          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }\n    `}},OV={kernelName:Ot,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:u,dimRoundingMode:d}=r,c=$m.convertConv2DDataFormat(l),h=u;null==h&&(h=[1,1]);let p,m=$m.computeConv2DInfo(a.shape,i.shape,s,h,o,d,!0,c),f=[{type:"int32",data:[m.padInfo.top,m.padInfo.left]},{type:"int32",data:[m.inHeight,m.inWidth]}],g="channelsLast"===m.dataFormat;return!g&&m.inHeight>16&&m.inWidth>16&&1===m.strideHeight&&1===m.strideWidth&&1===m.dilationWidth&&1===m.dilationHeight&&m.inChannels===m.outChannels?p=new class{constructor(e,t,n,r=!1,a=null,i=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[16,16,1],this.outputShape=e,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),r&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.addBias=r,this.activation=a,this.hasPreluActivation=i,this.filterHeight=t,this.filterWidth=n,this.shaderKey=`depthwiseNCHW_${this.activation}_${this.filterHeight}_${this.filterWidth}`}getUserCode(){let e=this.filterWidth*this.filterHeight,t=this.workgroupSize[0]*this.workgroupSize[1]*this.workgroupSize[2],n=this.workgroupSize[1]+this.filterHeight-1,r=this.workgroupSize[0]+this.filterWidth-1;return`\n      ${VB(this.activation,this.hasPreluActivation,!1,4)}\n\n      var<workgroup> mm_Asub : array<array<f32, ${r}>, ${n}>;\n      var<workgroup> mm_Bsub : array<array<f32, ${this.filterWidth}>, ${this.filterHeight}>;\n      fn readX(batch : i32, channel : i32, row : i32, col : i32) -> f32 {\n        var value = 0.0;\n        if (row >=0 && row < uniforms.inDims[0] && col >=0 && col < uniforms.inDims[1])\n        {\n          value = getX(batch, channel, row, col);\n        }\n        return value;\n      }\n\n      ${VL()} {\n        let coords = getOutputCoords();\n        let batch = coords[0];\n        let xRCCorner = vec2<i32>(coords.zw) - uniforms.pads;\n        let channelMul = uniforms.wShape[3];\n        let d1 = coords[1] / channelMul;\n        let q = coords[1] % channelMul;\n\n        let inputRowStart = xRCCorner.x;\n        let inputColStart = xRCCorner.y;\n\n        let localRow = i32(localId.y);\n        let localCol = i32(localId.x);\n\n        // Load one tile of X into local memory.\n        for (var inputRow = localRow; inputRow < ${n}; inputRow = inputRow + ${this.workgroupSize[1]}) {\n          for (var inputCol = localCol; inputCol < ${r}; inputCol = inputCol + ${this.workgroupSize[0]}) {\n            let rowOffset = inputRow - localRow;\n            let colOffset = inputCol - localCol;\n            mm_Asub[inputRow][inputCol] = readX(batch, d1, inputRowStart + rowOffset, inputColStart + colOffset);\n          }\n        }\n\n        // Load one tile of W into local memory.\n        var wIndex = i32(localIndex);\n        ${e<t?`if (wIndex < ${e})`:`for(; wIndex < ${e}; wIndex = wIndex + ${t})`}\n\n        {\n          let wRow = wIndex / ${this.filterWidth};\n          let wCol = wIndex % ${this.filterWidth};\n          mm_Bsub[wRow][wCol] = getW(wRow, wCol, d1, q);\n        }\n\n        workgroupBarrier();\n\n        var value = 0.0;\n        for (var wR = 0; wR < ${this.filterHeight}; wR = wR + 1) {\n          for (var wC = 0; wC < ${this.filterWidth}; wC = wC + 1) {\n            let xVal = mm_Asub[localRow + wR][localCol + wC];\n            let wVal = mm_Bsub[wR][wC];\n            value = fma(xVal, wVal, value);\n          }\n        }\n        ${jB(this.addBias,this.activation)}\n        if (coordsInBounds4D(coords, uniforms.outShape)) {\n          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }\n    `}}(m.outShape,m.filterHeight,m.filterWidth):g&&m.outHeight>4&&m.outWidth>4&&m.strideWidth<=2&&m.inChannels===m.outChannels&&1===m.dilationHeight&&1===m.dilationWidth&&m.inChannels%4==0?(p=new DV(m),f.push({type:"int32",data:[p.virtualWidth]})):(p=new MV(m),f.push({type:"int32",data:[m.filterHeight]},{type:"int32",data:[m.filterWidth]},{type:"int32",data:[m.strideHeight,m.strideWidth]},{type:"int32",data:[m.dilationHeight,m.dilationWidth]})),n.runWebGPUProgram(p,[a,i],a.dtype,f)}},$V={kernelName:$t,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,filterShape:d}=r,c=$m.computeConv2DInfo(a.shape,d,s,o,l,u,!0),h=new class{constructor(e){this.variableNames=["x","dy"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>, outHeight : i32,\n      outWidth : i32, inHeight : i32, inWidth : i32, batchSize : i32, channelMul : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_filter"}getUserCode(){return`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let wR = coords[0];\n        let wC = coords[1];\n        let d1 = coords[2];\n        let dm = coords[3];\n        let d2 = d1 * uniforms.channelMul + dm;\n\n        var dotProd = 0.0;\n        for (var b = 0; b < uniforms.batchSize; b++) {\n          for (var yR = 0; yR < uniforms.outHeight; yR++) {\n            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];\n\n            if (xR < 0 || xR >= uniforms.inHeight) {\n              continue;\n            }\n\n            for (var yC = 0; yC < uniforms.outWidth; yC++) {\n              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];\n\n              if (xC < 0 || xC >= uniforms.inWidth) {\n                continue;\n              }\n\n              let dyValue = getDy(b, yR, yC, d2);\n              let xValue = getX(b, xR, xC, d1);\n              dotProd += xValue * dyValue;\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    `}}(c),p=[{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"int32",data:[c.inHeight]},{type:"int32",data:[c.inWidth]},{type:"int32",data:[c.batchSize]},{type:"int32",data:[c.outChannels/c.inChannels]}];return n.runWebGPUProgram(h,[a,i],"float32",p)}},FV={kernelName:Ft,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,inputShape:d}=r,c=$m.computeConv2DInfo(d,i.shape,s,o,l,u,!0),h=new class{constructor(e){this.variableNames=["dy","W"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>,\n       outHeight : i32, outWidth : i32, channelMul : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_input"}getUserCode(){return`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords[0];\n        let d1 = coords[3];\n        let dyCorner = coords.yz - uniforms.pads;\n        let dyRCorner = dyCorner.x;\n        let dyCCorner = dyCorner.y;\n\n        var dotProd = 0.0;\n        for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {\n          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);\n\n          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n            continue;\n          }\n\n          let idyR = i32(dyR);\n          let wRPerm = uniforms.filterDims[0] - 1 - wR;\n\n          for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {\n            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);\n\n            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n              continue;\n            }\n\n            let idyC = i32(dyC);\n            let wCPerm = uniforms.filterDims[1] - 1 - wC;\n\n            for (var dm = 0; dm < uniforms.channelMul; dm++) {\n              let d2 = d1 * uniforms.channelMul + dm;\n              let xValue = getDy(batch, idyR, idyC, d2);\n              let wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    `}}(c),p=[{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.filterHeight-1-c.padInfo.top,c.filterWidth-1-c.padInfo.left]},{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"int32",data:[c.outChannels/c.inChannels]}];return n.runWebGPUProgram(h,[a,i],a.dtype,p)}},LV={kernelName:Lt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],i=Sa.sizeFromShape(r.shape),s=aU({inputs:{x:r},backend:n,attrs:{shape:[i]}}),o=new class{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,e],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="diag"}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getOutputCoords();\n          let value = select(0.0, getX(coords[0]), coords[0] == coords[1]);\n          setOutputAtIndex(index, value);\n        }\n      }\n    `}}(i),l=n.runWebGPUProgram(o,[s],s.dtype),u=aU({inputs:{x:l},backend:n,attrs:{shape:a}});return n.disposeData(s.dataId),n.disposeData(l.dataId),u}},zV={kernelName:zt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,u=$m.computeDilation2DInfo(a.shape,i.shape,s,o,"NHWC",l),d=[u.padInfo.top,u.padInfo.left],c=[{type:"int32",data:[u.filterHeight,u.filterWidth]},{type:"int32",data:[...d]},{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]}],h=new class{constructor(e){this.variableNames=["x","w"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="dilation2d"}getUserCode(){return`\n       ${VL("index")} {\n         if (index < uniforms.size) {\n           let neg_infinity = -3.4e38;\n           let coords = getOutputCoords();\n           let batch = coords.x;\n           let d1 = coords.w;\n           let outTopLeftCorner = coords.yz * uniforms.strides - uniforms.pads;\n           let hBeg = outTopLeftCorner.x;\n           let wBeg = outTopLeftCorner.y;\n\n           var curVal = neg_infinity;\n           for (var h = 0; h < uniforms.filterDims[0]; h = h + 1) {\n             let hIn = hBeg + h * uniforms.dilations[0];\n\n             if (hIn >= 0 && hIn < uniforms.xShape[1]) {\n               for (var w = 0; w < uniforms.filterDims[1]; w = w + 1) {\n                 let wIn = wBeg + w * uniforms.dilations[1];\n\n                 if (wIn >= 0 && wIn < uniforms.xShape[2]) {\n                   let val = getX(batch, hIn, wIn, d1) + getW(h, w, d1);\n                   if (val > curVal) {\n                     curVal = val;\n                   }\n                 }\n               }\n             }\n           }\n\n           setOutputAtIndex(index, curVal);\n         }\n       }\n     `}}(u);return n.runWebGPUProgram(h,[a,i],a.dtype,c)}},BV={kernelName:Ut,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,dy:s}=t,{strides:o,pad:l,dilations:u}=r,d=$m.computeDilation2DInfo(a.shape,i.shape,o,l,"NHWC",u),c=i.dtype,h=new class{constructor(e,t,n){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.filterShape,this.dispatchLayout=sz(e.outShape),this.dispatch=nz(this.dispatchLayout,e.outShape,this.workgroupSize),"float32"!==n&&"int32"!==n)throw new Error(`Dilation2DBackpropFilter only supports float32 and int32\n          types, does not support ${n} type.`);this.type=n,this.shaderKey="dilation2DBackpropFilter"}getUserCode(){return`\n       ${VL("index")} {\n         if (index < uniforms.dySize) {\n           let coords = getDyCoordsFromIndex(index);\n           let b = coords[0];\n           let r = coords[1];\n           let c = coords[2];\n           let d = coords[3];\n\n           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;\n           var curVal = -3.4e38;  // neg_infinity\n           var wRMax = 0;\n           var wCMax = 0;\n\n           // In the case of multiple argmax branches, we only back-propagate\n           // along the last branch, i.e., the one with largest value of\n           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling\n           // backward routines.\n           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {\n             let xR = dyCorner.x + wR * uniforms.dilations[0];\n\n             if (xR >= 0 && xR < uniforms.xShape[1]) {\n               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {\n                 let xC = dyCorner.y + wC * uniforms.dilations[1];\n\n                 if (xC >= 0 && xC < uniforms.xShape[2]) {\n                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);\n                   if (val > curVal) {\n                     curVal = val;\n                     wRMax = wR;\n                     wCMax = wC;\n                   }\n                 }\n               }\n             }\n           }\n\n           let flatIndexIn = d + uniforms.wShape[2] * (wCMax + wRMax * uniforms.wShape[1]);\n           let value = getDy(b, r, c, d);\n           ${zL("&result[flatIndexIn]","value",this.type)}\n         }\n       }\n     `}}(d,i.shape,c),p=[{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[Sa.sizeFromShape(d.outShape)]}],m=nU({backend:n,attrs:{shape:i.shape,value:0,dtype:c}});return n.runWebGPUProgram(h,[a,i,s],c,p,m)}},UV={kernelName:Bt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,dy:s}=t,{strides:o,pad:l,dilations:u}=r,d=$m.computeDilation2DInfo(a.shape,i.shape,o,l,"NHWC",u),c=a.dtype,h=new class{constructor(e,t){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(e.outShape),this.dispatch=nz(this.dispatchLayout,e.outShape,this.workgroupSize),"float32"!==t&&"int32"!==t)throw new Error(`Dilation2DBackpropInput only supports float32 and int32\n          types, does not support ${t} type.`);this.type=t,this.shaderKey="dilation2DBackpropInput"}getUserCode(){return`\n       ${VL("index")} {\n         if (index < uniforms.dySize) {\n           let coords = getDyCoordsFromIndex(index);\n           let b = coords[0];\n           let r = coords[1];\n           let c = coords[2];\n           let d = coords[3];\n\n           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;\n           var curVal = -3.4e38;  // neg_infinity\n           var xRMax = 0;\n           var xCMax = 0;\n\n           // In the case of multiple argmax branches, we only back-propagate\n           // along the last branch, i.e., the one with largest value of\n           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling\n           // backward routines.\n           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {\n             let xR = dyCorner.x + wR * uniforms.dilations[0];\n\n             if (xR >= 0 && xR < uniforms.xShape[1]) {\n               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {\n                 let xC = dyCorner.y + wC * uniforms.dilations[1];\n\n                 if (xC >= 0 && xC < uniforms.xShape[2]) {\n                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);\n                   if (val > curVal) {\n                     curVal = val;\n                     xRMax = xR;\n                     xCMax = xC;\n                   }\n                 }\n               }\n             }\n           }\n\n           let flatIndexIn = d + uniforms.xShape[3] *\n               (xCMax + uniforms.xShape[2] * (xRMax + uniforms.xShape[1] * b));\n           let value = getDy(b, r, c, d);\n           ${zL("&result[flatIndexIn]","value",this.type)}\n         }\n       }\n     `}}(d,c),p=[{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[Sa.sizeFromShape(d.outShape)]}],m=nU({backend:n,attrs:{shape:d.inShape,value:0,dtype:c}});return n.runWebGPUProgram(h,[a,i,s],c,p,m)}},WV=gU({opType:dz.MUL,cpuKernelImpl:$U,supportsComplex:!0}),VV={kernelName:Vn,backendName:"webgpu",kernelFunc:WV};function jV(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;return pW(a,i,s,"sum",n)}var HV={kernelName:Rr,backendName:"webgpu",kernelFunc:jV},GV={kernelName:jt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=$m.decodeEinsumEquation(a,i.length);$m.checkEinsumDimSizes(s.length,l,i);let{path:u,steps:d}=$m.getEinsumComputePath(o,l),c=d.length,h=null,p=s.length,m=[];for(let e=0;e<c;++e){for(let t of d[e]){let e,{permutationIndices:r,expandDims:a}=$m.getEinsumPermutation(p,l[t]);$m.isIdentityPermutation(r)?e=i[t]:(e=dW({inputs:{x:i[t]},backend:n,attrs:{perm:r}}),m.push(e));let s=e.shape.slice();for(let e=0;e<a.length;++e)s.splice(a[e],0,1);Sa.arraysEqual(e.shape,s)||(e=aU({inputs:{x:e},backend:n,attrs:{shape:s}}),m.push(e)),null===h?h=e:(h=WV({inputs:{a:e,b:h},backend:n}),m.push(h))}e<c-1&&(u[e]>=0&&(h=jV({inputs:{x:h},backend:n,attrs:{axis:u[e]-(s.length-p),keepDims:!1}}),m.push(h)),p--)}for(let e of m)e!==h&&n.disposeData(e.dataId);return h}},qV=fU({opType:pz.ELU}),XV={kernelName:Ht,backendName:"webgpu",kernelFunc:qV},KV={kernelName:Gt,backendName:"webgpu",kernelFunc:e=>{let{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=new uU(dz.ELU_DER,r.shape,a.shape);return n.runWebGPUProgram(i,[r,a],r.dtype)}},ZV=gU({opType:dz.EQUAL,dtype:"bool",cpuKernelImpl:vU}),YV={kernelName:Xt,backendName:"webgpu",kernelFunc:ZV},JV=fU({opType:pz.ERF}),QV={kernelName:qt,backendName:"webgpu",kernelFunc:JV},ej=fU({opType:pz.EXP,cpuKernelImpl:wU,dtype:"float32"}),tj={kernelName:Kt,backendName:"webgpu",kernelFunc:ej};function nj(e){let{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:i}=t,s=i.shape.length,o=i.shape.slice(),l=a;return a<0&&(Sa.assert(-(s+1)<=a,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),l=s+a+1),o.splice(l,0,1),aU({inputs:{x:i},backend:r,attrs:{shape:o}})}var rj={kernelName:Zt,backendName:"webgpu",kernelFunc:nj},aj=fU({opType:pz.EXPM1,cpuKernelImpl:kU}),ij={kernelName:Yt,backendName:"webgpu",kernelFunc:aj},sj=class{constructor(e,t){this.variableNames=["real","imag"],this.outputShape=[],this.uniforms="exponentMultiplier : f32, denominator: f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.component=e,this.shaderKey=`fft_${e}`}getUserCode(){return`\n    fn unaryOpComplex(real: f32, expR: f32, imag: f32, expI: f32) -> f32 {\n      ${"real"===this.component?"return real * expR - imag * expI;":"return real * expI + imag * expR;"}\n    }\n\n    fn mulMatDFT(batch: i32, index: i32) -> f32 {\n      let indexRatio = f32(index) / f32(uniforms.realShape[1]);\n      let exponentMultiplierTimesIndexRatio =\n          uniforms.exponentMultiplier * indexRatio;\n\n      var result = 0.0;\n\n      for (var i = 0; i < uniforms.realShape[1]; i = i + 1) {\n        // x = (-2|2 * PI / N) * index * i;\n        let x = exponentMultiplierTimesIndexRatio * f32(i);\n        let expR = cos(x);\n        let expI = sin(x);\n        let real = getReal(batch, i);\n        let imag = getImag(batch, i);\n\n        result = result +\n            unaryOpComplex(real, expR, imag, expI) / uniforms.denominator;\n      }\n\n      return result;\n    }\n\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        setOutputAtIndex(index, mulMatDFT(coords[0], coords[1]));\n      }\n    }\n  `}};function oj(e,t,n){let r=n.tensorMap.get(e.dataId),a=Sa.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],s=[],o=aU({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}});s.push(o);let l=o.shape,u=new sj("real",l),d=new sj("imag",l),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],h=[{type:"float32",data:[t?2*Math.PI:-2*Math.PI]},{type:"float32",data:[t?l[1]:1]}],p=n.runWebGPUProgram(u,c,"float32",h);s.push(p);let m=n.runWebGPUProgram(d,c,"float32",h);s.push(m);let f=hU({inputs:{real:p,imag:m},backend:n});s.push(f);let g=aU({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return s.forEach((e=>n.disposeData(e.dataId))),g}var lj,uj={kernelName:Jt,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t;return oj(r,!1,n)}},dj={kernelName:en,backendName:"webgpu",kernelFunc:({inputs:e,backend:t})=>{let{image:n}=e,r=t,a=new class{constructor(e){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="flipLeftRight"}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let coordX = uniforms.xShape[2] - coords[2] - 1;\n          let outputValue = getX(coords[0], coords[1], coordX, coords[3]);\n          setOutputAtIndex(index, outputValue);\n        }\n      }\n    `}}(n.shape);return r.runWebGPUProgram(a,[n],n.dtype)}},cj=fU({opType:pz.FLOOR,cpuKernelImpl:SU}),hj={kernelName:tn,backendName:"webgpu",kernelFunc:cj},pj=gU({opType:dz.INT_DIV,cpuKernelImpl:TU,dtype:"int32"}),mj={kernelName:nn,backendName:"webgpu",kernelFunc:pj},fj={kernelName:sa,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{pixels:a}=t,{numChannels:i}=r;if(null==a)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,l="undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&a instanceof OffscreenCanvas,u="undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap,[d,c]=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],h=[c,d,i],p=s||o;if(u||l||p){let e;{if(p){let e=Ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==lj||e!==gj)&&(gj=e,lj=document.createElement("canvas").getContext("2d",{willReadFrequently:gj})),lj.canvas.width=d,lj.canvas.height=c,lj.drawImage(a,0,0,d,c),a=lj.canvas}let t=GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,r="rgba8unorm",i=n.textureManager.acquireTexture(h[1],h[0],r,t);n.queue.copyExternalImageToTexture({source:a},{texture:i},[h[1],h[0]]),e=i}let t=Sa.sizeFromShape(h),r=Sa.computeStrides(h),s=new class{constructor(e,t,n=!1){this.isFromPixels=!0,this.outputShape=[0],this.variableNames=[],this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[t,1,1]),this.importVideo=n,this.shaderKey=`fromPixels_${this.importVideo}`}getUserCode(){let e=this.importVideo?"textureLoad(src, vec2<i32>(coords.yx));":"textureLoad(src, vec2<i32>(coords.yx), 0)";return`\n      @binding(1) @group(0) var src: ${this.importVideo?"texture_external":"texture_2d<f32>"};\n      ${VL("index")} {\n        let flatIndex = index * uniforms.numChannels;\n        if (flatIndex < uniforms.size) {\n          let coords = getCoordsFromIndex(flatIndex);\n          let values = ${e};\n          for (var i = 0; i < uniforms.numChannels; i = i + 1) {\n            result[flatIndex + i] = i32(floor(255.0 * values[i]));\n          }\n        }\n      }\n  `}}(h,i,!1),o=[{type:"uint32",data:[t]},{type:"uint32",data:[i]},{type:"uint32",data:[...r]}],l=n.makeTensorInfo([c,d],"int32");n.tensorMap.get(l.dataId).resource=e;let u=n.runWebGPUProgram(s,[l],"int32",o);return n.disposeData(l.dataId),u}let m=a.data,f=m;if(null!=i&&4!==i){f=new Uint8Array(a.width*a.height*i);let e=m.length,t=0;for(let n=0;n<e;n++)n%4<i&&(f[t++]=m[n])}let g=n.makeTensorInfo(h,"int32",new Int32Array(f));return n.uploadToGPU(g.dataId),g}},gj=Ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU"),yj={kernelName:rn,backendName:"webgpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r,scale:a,offset:i,mean:s,variance:o}=e,{varianceEpsilon:l}=t,u=n,d=[r,s,o],c=null;null!=i&&(c=i.shape,d.push(i));let h=null;null!=a&&(h=a.shape,d.push(a));let p=new class{constructor(e,t,n,r,a){this.uniforms="varianceEpsilon : f32,",this.workgroupSize=[128,1,1],this.size=!0,this.variableNames=["x","mean","variance"],$m.assertAndGetBroadcastShape(e,t),$m.assertAndGetBroadcastShape(e,n),this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),null!=r&&($m.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset")),null!=a&&($m.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale")),this.offsetShape=r,this.scaleShape=a,this.shaderKey="batchNorm"}getUserCode(){let e="0.0";null!=this.offsetShape&&(e="getOffsetByOutputIndex(index)");let t="1.0";return null!=this.scaleShape&&(t="getScaleByOutputIndex(index)"),`\n      ${VL("index")} {\n        if (index < uniforms.size)\n        {\n          let xValue = getXByOutputIndex(index);\n          let meanValue = getMeanByOutputIndex(index);\n          let varianValue = getVarianceByOutputIndex(index);\n          let offsetValue = ${e};\n          let scaleValue = ${t};\n          let inv = scaleValue * inverseSqrt(varianValue + f32(uniforms.varianceEpsilon));\n          setOutputAtIndex(index,dot(vec3<f32>(xValue, -meanValue, offsetValue), vec3<f32>(inv, inv, 1.0)));\n        }\n      }\n  `}}(r.shape,s.shape,o.shape,c,h),m=[{type:"float32",data:[l]}];return u.runWebGPUProgram(p,d,r.dtype,m)}},bj={kernelName:ua,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:d,dilations:c,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=r,f=$m.convertConv2DDataFormat(d);return hV({x:a,filter:i,convInfo:$m.computeConv2DInfo(a.shape,i.shape,l,c,u,h,!1,f),backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:m,activation:p})}},xj={kernelName:da,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dilations:d,dimRoundingMode:c,activation:h,leakyreluAlpha:p}=r,m=d;null==m&&(m=[1,1]),Sa.assert($m.eitherStridesOrDilationsAreOne(l,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`));let f=$m.computeConv2DInfo(a.shape,i.shape,l,m,u,c,!0),g=[a,i],y=null!=s,b=null!=o;y&&g.push(s),b&&g.push(o);let x,A=[{type:"int32",data:[f.padInfo.top,f.padInfo.left]},{type:"int32",data:[f.inHeight,f.inWidth]}];return f.outHeight>4&&f.outWidth>4&&f.strideWidth<=2&&f.inChannels===f.outChannels&&1===f.dilationHeight&&1===f.dilationWidth&&f.inChannels%4==0?(x=new DV(f,y,h,b),A.push({type:"int32",data:[x.virtualWidth]})):(x=new MV(f,y,h,b),A.push({type:"int32",data:[f.filterHeight]},{type:"int32",data:[f.filterWidth]},{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.dilationHeight,f.dilationWidth]})),"leakyrelu"===h&&(A.push({type:"float32",data:[p]}),x.uniforms+=" alpha : f32,"),n.runWebGPUProgram(x,g,"float32",A)}},Aj={kernelName:sn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=a.shape,s=i[i.length-1],o=Sa.sizeFromShape(r.shape),[l,u,d,c]=$m.prepareAndValidate(r,a),h=aU({inputs:{x:a},backend:n,attrs:{shape:[u,s]}}),p=aU({inputs:{x:r},backend:n,attrs:{shape:[Sa.sizeFromShape(r.shape)/d,d]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){let e=n.readSync(a.dataId),t=n.bufferSync(r),i=_U(e,t,r.dtype,u,s,d,c,r.shape,o);return n.makeTensorInfo(l,r.dtype,i.values)}let m=new class{constructor(e,t){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`gathernd_${e}`,this.sliceDim=e,this.uniforms=`sliceDim : i32, strides : ${UL(e)},`}getUserCode(){let e;return e=this.sliceDim>1?"uniforms.strides[j]":"uniforms.strides",`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          var flattenIndex = 0;\n          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {\n            let indexTemp = i32(round(getIndices(coords[0], j)));\n            let strideNum = ${e};\n            flattenIndex = flattenIndex + indexTemp * strideNum;\n          }\n\n          setOutputAtIndex(index, getA(flattenIndex, coords[1]));\n        }\n      }\n      `}}(s,[u,d]),f=[{type:"int32",data:[s]},{type:"int32",data:c}],g=n.runWebGPUProgram(m,[p,h],p.dtype,f),y=aU({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeData(h.dataId),n.disposeData(p.dataId),n.disposeData(g.dataId),y}};function vj(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r,l=Sa.parseAxisParam(s,a.shape)[0],u=$m.segment_util.collectGatherOpShapeInfo(a,i,l,o),d=Sa.sizeFromShape(i.shape),c=[],h=aU({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=aU({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,d/u.batchSize]}});c.push(h),c.push(p);let m=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])){let e=n.tensorMap.get(p.dataId).values,t=Ws(p.shape,p.dtype,e),r=n.tensorMap.get(h.dataId).values,a=Ws(h.shape,h.dtype,r),i=IU(a,t,m);return c.forEach((e=>n.disposeData(e.dataId))),n.makeTensorInfo(u.outputShape,i.dtype,i.values)}let f=new class{constructor(e,t){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.slice(),this.aShape=e,this.outputShape=t,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gather"}getUserCode(){let e=function(e){let t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<e.length;r++)2===r?n.push("indexZ"):n.push(`${t[r]}`);return n.join()}(this.aShape);return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let resRC = getCoordsFromIndex(index);\n          let indexZ = i32(getIndices(resRC.x, resRC.z));\n          let inBounds = select(0.0, 1.0, indexZ >= 0 && indexZ < uniforms.aShape[2]);\n          setOutputAtIndex(index, inBounds * getA(${e}));\n        }\n      }\n    `}}(h.shape,m),g=n.runWebGPUProgram(f,[h,p],h.dtype);c.push(g);let y=aU({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return c.forEach((e=>n.disposeData(e.dataId))),y}var wj={kernelName:an,backendName:"webgpu",kernelFunc:vj},kj=gU({opType:dz.GREATER,cpuKernelImpl:EU,dtype:"bool"}),Sj={kernelName:on,backendName:"webgpu",kernelFunc:kj},Tj=gU({opType:dz.GREATER_EQUAL,dtype:"bool",cpuKernelImpl:CU}),_j={kernelName:ln,backendName:"webgpu",kernelFunc:Tj},Ij={kernelName:dn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t;return oj(r,!0,n)}},Cj=fU({opType:pz.IS_FINITE,dtype:"bool"}),Ej={kernelName:hn,backendName:"webgpu",kernelFunc:Cj},Nj=fU({opType:pz.IS_INF,dtype:"bool"}),Rj={kernelName:pn,backendName:"webgpu",kernelFunc:Nj},Pj=fU({opType:pz.IS_NAN,dtype:"bool"}),Dj={kernelName:mn,backendName:"webgpu",kernelFunc:Pj},Mj={kernelName:fn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r,s=[{type:"float32",data:[i]}],o=new mU(a.shape,pz.LEAKYRELU,"alpha : f32,");return n.runWebGPUProgram(o,[a],"float32",s)}},Oj=gU({opType:dz.LESS,dtype:"bool",cpuKernelImpl:RU}),$j={kernelName:gn,backendName:"webgpu",kernelFunc:Oj},Fj=gU({opType:dz.LESS_EQUAL,dtype:"bool",cpuKernelImpl:NU}),Lj={kernelName:yn,backendName:"webgpu",kernelFunc:Fj},zj={kernelName:bn,backendName:"webgpu",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=(a-r)/(i-1),o=new class{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="start : f32, step : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="linSpace"}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          setOutputAtIndex(index, uniforms.start + f32(index) * uniforms.step);\n        }\n      }\n    `}}(i),l=[{type:"float32",data:[r]},{type:"float32",data:[s]}];return t.runWebGPUProgram(o,[],"float32",l)}},Bj=fU({opType:pz.LOG,cpuKernelImpl:PU}),Uj={kernelName:xn,backendName:"webgpu",kernelFunc:Bj},Wj=fU({opType:pz.LOG1P}),Vj={kernelName:An,backendName:"webgpu",kernelFunc:Wj},jj=gU({opType:dz.LOGICAL_AND,dtype:"bool"}),Hj={kernelName:vn,backendName:"webgpu",kernelFunc:jj},Gj=fU({opType:pz.LOGICAL_NOT}),qj={kernelName:wn,backendName:"webgpu",kernelFunc:Gj},Xj=gU({opType:dz.LOGICAL_OR}),Kj={kernelName:kn,backendName:"webgpu",kernelFunc:Xj},Zj="\n  var powValue = 0.0;\n  let basis = uniforms.bias + uniforms.alpha * sum;\n  if (uniforms.beta == 0.5) {\n    powValue = inverseSqrt(basis);\n  } else if (uniforms.beta == 1.0) {\n    powValue = 1.0 / basis;\n  } else {\n    powValue = exp(log(basis) * (-uniforms.beta));\n  }\n",Yj={kernelName:In,backendName:"webgpu",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{depthRadius:s,bias:o,alpha:l,beta:u}=a;t=s>16?new class{constructor(e){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn"}getUserCode(){return`\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        let b = coords[0];\n        let r = coords[1];\n        let c = coords[2];\n        let d = coords[3];\n\n        let x = getX(b, r, c, d);\n        var sum = 0.0;\n        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {\n          let idx = d + i;\n          if (idx >= 0 && idx < uniforms.xShape[3]) {\n            let z = getX(b, r, c, idx);\n            sum = sum + z * z;\n          }\n        }\n        ${Zj}\n\n        setOutputAtIndex(index, x * powValue);\n      }\n    }\n  `}}(i.shape):new class{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[256,1,1],this.maxAllowRadius=16,Sa.assert(t<=this.maxAllowRadius,(()=>`Radius must be less than or equal to ${this.maxAllowRadius}, current radius is ${t}`)),this.outputShape=e,this.elementsPerWorkgroup=this.workgroupSize[0]-2*this.maxAllowRadius,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=nz(this.dispatchLayout,this.outputShape,[this.elementsPerWorkgroup,this.workgroupSize[1],this.workgroupSize[2]]),this.shaderKey="lrn_shared"}getUserCode(){return`\n    var <workgroup>lrnSub: array<f32, ${this.workgroupSize[0]}>;\n    const elementsPerWorkgroup = ${this.elementsPerWorkgroup};\n    const maxAllowRadius = ${this.maxAllowRadius};\n\n    ${VL()} {\n      let localDepth = i32(localId.x);\n      let workgroupDepth = i32(workgroupId.x) * elementsPerWorkgroup;\n      let xDepth = workgroupDepth + localDepth - maxAllowRadius;\n      let b = i32(globalId.z) / uniforms.xShape[1];\n      let r = i32(globalId.z) - b * uniforms.xShape[1];\n      let c = i32(globalId.y);\n      let d = workgroupDepth + localDepth;\n\n      var x = 0.0;\n      if (xDepth >= 0 && xDepth < uniforms.xShape[3]) {\n        x = getX(b, r, c, xDepth);\n      }\n      lrnSub[localDepth] = x;\n      workgroupBarrier();\n\n      if (localDepth < elementsPerWorkgroup && d < uniforms.outShape[3]) {\n        var sum = 0.0;\n        let index = localDepth + maxAllowRadius;\n        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {\n          let z = lrnSub[index + i];\n          sum = sum + z * z;\n        }\n        ${Zj}\n\n        setOutputAtCoords(b, r, c, d, lrnSub[index] * powValue);\n      }\n    } `}}(i.shape,s);let d=[{type:"int32",data:[s]},{type:"float32",data:[o]},{type:"float32",data:[l]},{type:"float32",data:[u]}];return r.runWebGPUProgram(t,[i],i.dtype,d)}},Jj={kernelName:Cn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:u,beta:d}=r,c=new class{constructor(e){this.outputShape=[],this.variableNames=["inputImage","outputImage","dy"],this.uniforms="depthRadius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn_grad"}getUserCode(){return`\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        let b = coords[0];\n        let r = coords[1];\n        let c = coords[2];\n\n        let MIN_DEPTH_BEGIN = 0;\n        let MAX_DEPTH_END = uniforms.outShape[3];\n        var result = 0.0;\n        for (var d = MIN_DEPTH_BEGIN; d < MAX_DEPTH_END; d++) {\n          let depthBegin = max(MIN_DEPTH_BEGIN, d - uniforms.depthRadius);\n          let depthEnd = min(MAX_DEPTH_END, d + uniforms.depthRadius + 1);\n\n          var norm = 0.0;\n          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {\n            if (k < depthBegin) {\n              continue;\n            } else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            } else {\n              break;\n            }\n          }\n\n          norm = uniforms.alpha * norm + uniforms.bias;\n\n          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {\n            if (k < depthBegin) {\n              continue;\n            } else if (k >= depthBegin && k < depthEnd) {\n              var dyi = -2.0 * uniforms.alpha * uniforms.beta\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d) / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * uniforms.beta);\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            } else {\n              break;\n            }\n          }\n        }\n\n        setOutputAtIndex(index, result);\n      }\n    }\n  `}}(a.shape),h=[{type:"int32",data:[o]},{type:"float32",data:[l]},{type:"float32",data:[u]},{type:"float32",data:[d]}];return n.runWebGPUProgram(c,[a,i,s],a.dtype,h)}},Qj=gU({opType:dz.MAX,cpuKernelImpl:MU}),eH={kernelName:Rn,backendName:"webgpu",kernelFunc:Qj},tH={kernelName:Pn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;return OW(a,$m.computePool2DInfo(a.shape,i,s,1,o,l),"max",n)}},nH={kernelName:Mn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dataFormat:l,dimRoundingMode:u}=r,d=$m.computePool3DInfo(a.shape,i,s,[1,1,1],o,u,l),c=new NW(d,"max"),h=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}];return n.runWebGPUProgram(c,[a],a.dtype,h)}},rH={kernelName:On,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:u,dimRoundingMode:d}=r,c=$m.computePool3DInfo(s.shape,o,l,[1,1,1],u,d),h=new NW(c,"max",!0),p=[{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.padInfo.front,c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.inDepth,c.inHeight,c.inWidth]},{type:"int32",data:[c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth]}],m=n.runWebGPUProgram(h,[s],"int32",p),f=new class{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,\n      outDepth : i32, outHeight : i32, outWidth : i32",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool3DBackprop"}getUserCode(){return`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords.x;\n        let ch = coords.u;\n\n        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;\n        let dyDCorner = dyCorner.x;\n        let dyRCorner = dyCorner.y;\n        let dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] * uniforms.filterDims[2] - 1;\n\n        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {\n          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);\n\n          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {\n            continue;\n          }\n          let idyD = i32(dyD);\n\n          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {\n            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);\n\n            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n              continue;\n            }\n            let idyR = i32(dyR);\n\n            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {\n              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);\n\n              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n                continue;\n              }\n              let idyC = i32(dyC);\n\n              let dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              let maxPosValue = lastIndex - i32(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              let curPosValue = wD * uniforms.filterDims[1] * uniforms.filterDims[2] + wR * uniforms.filterDims[2] + wC;\n              let mask = select(0.0, 1.0, maxPosValue == curPosValue);\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    `}}(c);p=[{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.effectiveFilterDepth-1-c.padInfo.front,c.effectiveFilterHeight-1-c.padInfo.top,c.effectiveFilterWidth-1-c.padInfo.left]},{type:"int32",data:[c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth]},{type:"int32",data:[c.outDepth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]}];let g=n.runWebGPUProgram(f,[a,m],s.dtype,p);return n.disposeData(m.dataId),g}},aH={kernelName:Dn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;uz([i,s],"maxPoolGrad");let{filterSize:l,strides:u,pad:d,dimRoundingMode:c}=r,h=$m.computePool2DInfo(o.shape,l,u,1,d,c),p=new EW(h,"max",!0),m=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.dilationHeight,h.dilationWidth]},{type:"int32",data:[h.inHeight,h.inWidth]},{type:"int32",data:[h.effectiveFilterHeight,h.effectiveFilterWidth]}],f=n.runWebGPUProgram(p,[o],"int32",m),g=new class{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,\n       outHeight : i32, outWidth : i32",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool2DBackprop"}getUserCode(){return`\n      ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n        let batch = coords[0];\n        let d = coords[3];\n\n        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;\n        let dyRCorner = dyRCCorner.x;\n        let dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd = 0.0;\n        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] - 1;\n        for (var wR = 0; wR < uniforms.filterDims[0]; wR += uniforms.dilations[0]) {\n          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);\n\n          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {\n            continue;\n          }\n          let idyR = i32(dyR);\n\n          for (var wC = 0; wC < uniforms.filterDims[1]; wC += uniforms.dilations[1]) {\n            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);\n\n            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {\n              continue;\n            }\n            let idyC = i32(dyC);\n\n            let dyValue = getDy(batch, idyR, idyC, d);\n            let maxPosValue = lastIndex - i32(getMaxPos(batch, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            let curPosValue = wR * uniforms.filterDims[1] + wC;\n            let mask = select(0.0, 1.0, maxPosValue == curPosValue);\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutputAtIndex(index, dotProd);\n      }\n    }\n    `}}(h);m=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.effectiveFilterHeight-1-h.padInfo.top,h.effectiveFilterWidth-1-h.padInfo.left]},{type:"int32",data:[h.dilationHeight,h.dilationWidth]},{type:"int32",data:[h.effectiveFilterHeight,h.effectiveFilterWidth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]}];let y=n.runWebGPUProgram(g,[a,f],o.dtype,m);return n.disposeData(f.dataId),y}},iH={kernelName:$n,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{filterSize:a,strides:i,pad:s,includeBatchInIndex:o}=r,{x:l}=t;Sa.assert(4===l.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${l.shape.length}.`));let u=[1,1];Sa.assert($m.eitherStridesOrDilationsAreOne(i,u),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`));let d=$m.computePool2DInfo(l.shape,a,i,u,s),c=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterHeight,d.effectiveFilterWidth]}],h=new EW(d,"max",!1),p=n.runWebGPUProgram(h,[l],l.dtype,c);return h=new EW(d,"max",!0,!0,o),[p,n.runWebGPUProgram(h,[l],"int32",c)]}},sH={kernelName:Ln,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;return pW(a,i,s,"min",n)}},oH=gU({opType:dz.MIN,cpuKernelImpl:OU}),lH={kernelName:zn,backendName:"webgpu",kernelFunc:oH},uH={kernelName:Bn,backendName:"webgpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{paddings:a,mode:i}=t,s=n,o=a.map((e=>({type:"int32",data:[e[0],e[1]]}))),l=new class{constructor(e,t,n){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1])),this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,t.map(((e,t)=>{this.uniforms+=` pad${t} : vec2<i32>,`})),this.offset="reflect"===n?0:1,this.shaderKey=`mirrorPad_${n}`}getUserCode(){let e=this.xShape.length,t=this.xShape.map(((e,t)=>`uniforms.pad${t}[0]`)).join(","),n=this.xShape.map(((t,n)=>`uniforms.pad${n}[0] + uniforms.xShape${e>1?`[${n}]`:""}`)).join(","),r=1===e?"start":"start[i]",a=1===e?"end":"end[i]",i=1===e?"outC":"outC[i]",s=UL(e),o=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let start = ${s}(${t});\n          let end = ${s}(${n});\n          var outC = getCoordsFromIndex(index);\n          for (var i = 0; i < ${e}; i = i + 1) {\n            if (${i} < ${r}) {\n              ${i} = ${r} * 2 - ${i} - ${this.offset};\n            } else if(${i} >= ${a}) {\n              ${i} = (${a} - 1) * 2 - ${i} + ${this.offset};\n            }\n          }\n          let coords = outC - start;\n          setOutputAtIndex(index, getX(${o}));\n        }\n      }\n    `}}(r.shape,a,i);return s.runWebGPUProgram(l,[r],r.dtype,o)}},dH=gU({opType:dz.MOD}),cH={kernelName:Un,backendName:"webgpu",kernelFunc:dH};function hH(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=aU({inputs:{x:a},backend:n,attrs:{shape:[Sa.sizeFromShape(a.shape)/a.shape[i],a.shape[i]]}}),o=new class{constructor(e){this.variableNames=["logits"],this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=[this.outputShape[0],1,1],this.outputShape[1]>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.shaderKey="softmax"}getUserCode(){return`\n    var<workgroup> buf : array<f32, ${this.workgroupSize[0]}>;\n    var<workgroup> rowMaxShared : f32;\n    var<workgroup> rowSumShared : f32;\n    const blockSize = ${this.workgroupSize[0]};\n    ${VL("index")} {\n      let row = index / blockSize;\n      let tid = i32(localId.x);\n      let cols = uniforms.outShape[1];\n\n      var threadMax = -3.402823e+38f;\n      for (var col = tid; col < cols; col += blockSize) {\n        let value = getLogits(row, col);\n        threadMax = max(threadMax, value);\n      }\n      if (tid < cols) {\n        buf[tid] = threadMax;\n      }\n      workgroupBarrier();\n\n      var reduceSize = min(cols, blockSize);\n      for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n        reduceSize = currSize + (reduceSize & 1);\n        if (tid < currSize) {\n          buf[tid] = max(buf[tid], buf[tid + reduceSize]);\n        }\n        workgroupBarrier();\n      }\n\n      if (tid == 0) {\n        rowMaxShared = buf[0];\n      }\n      workgroupBarrier();\n\n      var threadSum = 0.0;\n      for (var col = tid; col < cols; col += blockSize) {\n        let subExp = exp(getLogits(row, col) - rowMaxShared);\n        threadSum += subExp;\n      }\n      buf[tid] = threadSum;\n      workgroupBarrier();\n\n      for (var currSize = blockSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n        if (tid < currSize) {\n          buf[tid] = buf[tid] + buf[tid + currSize];\n        }\n        workgroupBarrier();\n      }\n\n      if (tid == 0) {\n        rowSumShared = buf[0];\n      }\n      workgroupBarrier();\n\n      for (var col = tid; col < cols; col += blockSize) {\n        let value = exp(getLogits(row, col) - rowMaxShared) / rowSumShared;\n        setOutputAtCoords(row, col, value);\n      }\n  }\n    `}}(s.shape),l=n.runWebGPUProgram(o,[s],a.dtype),u=aU({inputs:{x:l},backend:n,attrs:{shape:a.shape}});return n.disposeData(s.dataId),n.disposeData(l.dataId),u}var pH={kernelName:Mr,backendName:"webgpu",kernelFunc:hH},mH={kernelName:Wn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r,l=o?a:hH({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),u=l.shape[0],d=l.shape[1],c=new class{constructor(e,t){this.variableNames=["probs"],this.outputShape=[],this.uniforms="seed : f32, numOutcomes: i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,t],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="multinomial"}getUserCode(){return`\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    fn random (seed : f32, resultUV : vec2<f32>) -> f32 {\n      let HASHSCALE1 = 443.8975;\n      let p = resultUV * seed;\n      var p3  = fract(vec3<f32>(p.xyx) * HASHSCALE1);\n      p3 = p3 + dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${VL("index")} {\n      if (index < uniforms.size) {\n        let coords = getOutputCoords();\n        let batch = coords[0];\n\n        let resUV = vec2<f32>(f32(coords[1]) / f32(uniforms.outShape[1]),\n            f32(coords[0]) / f32(uniforms.outShape[0]));\n        let r = random(uniforms.seed, resUV);\n        var cdf = 0.0;\n        for (var i = 0; i < uniforms.numOutcomes - 1; i = i + 1) {\n          cdf = cdf + getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutputAtIndexI32(index, i);\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutputAtIndexI32(index, uniforms.numOutcomes - 1);\n      }\n    }\n  `}}(u,i),h=[{type:"float32",data:[s]},{type:"int32",data:[d]}],p=n.runWebGPUProgram(c,[l],"int32",h);return o||n.disposeData(l.dataId),p}},fH={kernelName:jn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){let e=n.tensorMap.get(r.dataId),[t,a]=FU(e.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,t)}let a=new mU(r.shape,pz.NEG);return n.runWebGPUProgram(a,[r],r.dtype)}},gH={kernelName:Gn,backendName:"webgpu",kernelFunc:function(e){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r,u=n.readSync(a.dataId),d=n.readSync(i.dataId),{selectedIndices:c}=Hf.nonMaxSuppressionV3Impl(u,d,s,o,l);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}},yH={kernelName:Xn,backendName:"webgpu",kernelFunc:function(e){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r,d=n.readSync(a.dataId),c=n.readSync(i.dataId),h=s,p=o,m=l,f=u,{selectedIndices:g,selectedScores:y}=Hf.nonMaxSuppressionV5Impl(d,c,h,p,m,f);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}},bH={kernelName:Zn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r,u=Sa.sizeFromShape(a.shape),d=new class{constructor(e,t){this.variableNames=["x"],this.uniforms="onValue : f32, offValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,t],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="onehot"}getUserCode(){return`\n      ${VL("index")} {\n        if(index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          setOutputAtIndex(index, mix(uniforms.offValue, uniforms.onValue,\n                                      f32(i32(round(getX(coords.x))) == coords.y)));\n        }\n      }\n    `}}(u,s),c=aU({inputs:{x:a},backend:n,attrs:{shape:[u]}}),h=[{type:"float32",data:[o]},{type:"float32",data:[l]}],p=n.runWebGPUProgram(d,[c],i,h);n.disposeData(c.dataId);let m=aU({inputs:{x:p},backend:n,attrs:{shape:[...a.shape,s]}});return n.disposeData(p.dataId),m}};function xH(e){let{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){let e=YW({inputs:{input:r},backend:n}),t=xH({inputs:{x:e},backend:n}),a=sV({inputs:{input:r},backend:n}),i=xH({inputs:{x:a},backend:n}),s=hU({inputs:{real:t,imag:i},backend:n});return n.disposeData(e.dataId),n.disposeData(t.dataId),n.disposeData(a.dataId),n.disposeData(i.dataId),s}return nU({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var AH={kernelName:aa,backendName:"webgpu",kernelFunc:xH},vH={kernelName:Kn,backendName:"webgpu",kernelFunc:function e(t){let{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){let t=YW({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=sV({inputs:{input:a},backend:r}),s=xH({inputs:{x:i},backend:r}),o=hU({inputs:{real:n,imag:s},backend:r});return r.disposeData(t.dataId),r.disposeData(n.dataId),r.disposeData(i.dataId),r.disposeData(s.dataId),o}return nU({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},wH={kernelName:Yn,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return nj({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let i=t[0].shape,s=t[0].dtype;t.forEach((e=>{Sa.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),Sa.assert(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));let o=[],l=uV({inputs:t.map((e=>{let t=nj({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t})),backend:n,attrs:{axis:a}});return o.forEach((e=>n.disposeData(e.dataId))),l}};function kH(e,t=!1){let n=e.length,r=UL(n),a=e.map(((e,t)=>`uniforms.pad${t}[0]`)).join(","),i=e.map(((e,t)=>`uniforms.pad${t}[0] + uniforms.xShape${n>1?`[${t}]`:""}`)).join(",");return`\n        let start = ${n>1?`${r}(${a})`:`${a}`};\n        let end = ${n>1?`${r}(${i})`:`${i}`};\n        if (${n>1?"any(paddedCoords < start)":"paddedCoords < start"} || ${n>1?"any(paddedCoords >= end)":"paddedCoords >= end"}) {\n          setOutputAtIndex(index, ${t?0:"uniforms.constantValue"});\n        } else {\n          let coords = paddedCoords - start;\n          setOutputAtIndex(index, getX(${n>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n):"coords"}));\n        }\n  `}var SH={kernelName:Jn,backendName:"webgpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;if(i.every((e=>Sa.arraysEqual(e,[0,0]))))return dU({inputs:{x:a},backend:n});if(0===Sa.sizeFromShape(a.shape))return nU({backend:n,attrs:{shape:i.map(((e,t)=>e[0]+a.shape[t]+e[1])),value:s,dtype:a.dtype}});let o=[{type:"float32",data:[s]}];i.map((e=>o.push({type:"int32",data:[e[0],e[1]]})));let l=new class{constructor(e,t){this.variableNames=["x"],this.uniforms="constantValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1])),this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),t.map(((e,t)=>{this.uniforms+=` pad${t} : vec2<i32>,`})),this.xShape=e,this.shaderKey="pad"}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let paddedCoords = getCoordsFromIndex(index);\n          ${kH(this.xShape)}\n        }\n      }\n    `}}(a.shape,i);return n.runWebGPUProgram(l,[a],a.dtype,o)}},TH=gU({opType:dz.POW}),_H={kernelName:er,backendName:"webgpu",kernelFunc:TH},IH={kernelName:tr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=new uU(dz.PRELU,r.shape,a.shape);return n.runWebGPUProgram(i,[r,a],"float32")}},CH={kernelName:nr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;return pW(a,i,s,"prod",n)}},EH={kernelName:sr,backendName:"webgpu",kernelFunc:e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:s}=n,o=BU(r,a,i,s);return t.makeTensorInfo([o.length],s,o)}},NH=gU({opType:dz.DIV}),RH={kernelName:Vt,backendName:"webgpu",kernelFunc:NH},PH=fU({opType:pz.RECIPROCAL}),DH={kernelName:lr,backendName:"webgpu",kernelFunc:PH},MH=fU({opType:pz.RELU}),OH={kernelName:ur,backendName:"webgpu",kernelFunc:MH},$H=fU({opType:pz.RELU6}),FH={kernelName:fr,backendName:"webgpu",kernelFunc:$H},LH={kernelName:pr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,size:s,halfPixelCenters:o}=r,[l,u]=s,d=[{type:"float32",data:[i&&l>1?1:0,i&&u>1?1:0]},{type:"float32",data:[o?.5:0]}],c=new class{constructor(e,t,n){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, halfPixelCenters : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],t,n,e[3]],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="resizeBilinear"}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n        let coords = getCoordsFromIndex(index);\n          let b = coords[0];\n          let d = coords[3];\n          let rc = coords.yz;\n\n          let effectiveInSize = vec2<f32>(\n            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveOutSize = vec2<f32>(\n            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveInputOverOutputRatioRC =\n              effectiveInSize / effectiveOutSize;\n\n          // Fractional source index\n          let sourceFracIndexRC =\n            (vec2<f32>(rc) + vec2<f32>(uniforms.halfPixelCenters)) *\n            effectiveInputOverOutputRatioRC - vec2<f32>(uniforms.halfPixelCenters);\n\n          // Compute the four integer indices.\n          let sourceFloorRC = vec2<i32>(sourceFracIndexRC);\n          let sourceCeilRC = vec2<i32>(\n            min(vec2<f32>(uniforms.xShape.yz) - vec2<f32>(1.0), ceil(sourceFracIndexRC)));\n\n          let topLeft = getX(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          let bottomLeft = getX(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          let topRight = getX(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          let bottomRight = getX(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          let fracRC = sourceFracIndexRC - vec2<f32>(sourceFloorRC);\n\n          let top = topLeft + (topRight - topLeft) * fracRC.y;\n          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          let newValue = top + (bottom - top) * fracRC.x;\n\n          setOutputAtIndex(index, newValue);\n        }\n      }\n    `}}(a.shape,l,u);return n.runWebGPUProgram(c,[a],"float32",d)}},zH={kernelName:mr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,[,o,l]=a.shape,[,u,d]=i.shape,c=[s&&u>1?o-1:o,s&&d>1?l-1:l],h=[s&&u>1?u-1:u,s&&d>1?d-1:d],p=c[0]/h[0],m=c[1]/h[1],f=1/p,g=1/m,y=2*Math.ceil(f)+2,b=2*Math.ceil(g)+2,x=new class{constructor(e,t){this.variableNames=["dy"],this.uniforms="effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, heightScale : f32, widthScale : f32,\n       invHeightScale : f32, invWidthScale : f32, winHeight : i32, winWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=t,this.shaderKey=`resizeBilinearBackprop_${t}`}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getOutputCoords();\n          let b = coords[0];\n          let d = coords[3];\n          let r = coords[1];\n          let c = coords[2];\n\n          var accumulator = 0.0;\n\n          // Compute bounds for where in dy we will look\n          let startRLerp = floor(f32(r) * uniforms.invHeightScale);\n          let startDyR = i32(startRLerp - f32(uniforms.winHeight / 2));\n\n          let startCLerp = floor(f32(c) * uniforms.invWidthScale);\n          let startDyC = i32(startCLerp - f32(uniforms.winWidth / 2));\n\n          // Loop over dy\n          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {\n            let dyR = startDyR + dyROffset;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {\n              continue;\n            }\n\n            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {\n              let dyC = startDyC + dyCOffset;\n\n              // Guard against the window exceeding the bounds of dy\n              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {\n                continue;\n              }\n\n              let dxR = f32(dyR) * uniforms.heightScale;\n              let topDxRIndex = i32(floor(dxR));\n              let bottomDxRIndex = i32(min(ceil(dxR), f32(uniforms.outShape[1] - 1)));\n              let dxRLerp = dxR - f32(topDxRIndex);\n              let inverseDxRLerp = 1.0 - dxRLerp;\n\n              let dxC = f32(dyC) * uniforms.widthScale;\n              let leftDxCIndex = i32(floor(dxC));\n              let rightDxCIndex = i32(min(ceil(dxC), f32(uniforms.outShape[2] - 1)));\n              let dxCLerp = dxC - f32(leftDxCIndex);\n              let inverseDxCLerp = 1.0 - dxCLerp;\n\n              if (r == topDxRIndex && c == leftDxCIndex) {\n                // topLeft\n                accumulator +=\n                  getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n              }\n\n              if (r == topDxRIndex && c == rightDxCIndex) {\n                // topRight\n                accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n              }\n\n              if (r == bottomDxRIndex && c == leftDxCIndex) {\n                // bottomLeft\n                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n              }\n\n              if (r == bottomDxRIndex && c == rightDxCIndex) {\n                // bottomRight\n                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n              }\n            }\n          }\n          // End loop over dy\n\n          setOutputAtIndex(index, accumulator);\n        }\n      }\n    `}}(a.shape,s),A=[{type:"int32",data:c},{type:"int32",data:h},{type:"float32",data:[p]},{type:"float32",data:[m]},{type:"float32",data:[f]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[b]}];return n.runWebGPUProgram(x,[i],i.dtype,A)}},BH={kernelName:cr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,u]=o,d=[{type:"float32",data:[i&&l>1?1:0,i&&u>1?1:0]},{type:"float32",data:[i?.5:0]}],c=new class{constructor(e,t,n,r){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, roundBase : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],t,n,e[3]],this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.halfPixelCenters=r,this.shaderKey=`resizeNearest_${r}`}getUserCode(){let e;return e=this.halfPixelCenters?"max((vec2<f32>(rc) + vec2<f32>(0.5)) * effectiveInputOverOutputRatioRC, vec2<f32>(0.0))":"vec2<f32>(rc) * effectiveInputOverOutputRatioRC",`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let b = coords[0];\n          let d = coords[3];\n          let rc = coords.yz;\n\n          let effectiveInSize = vec2<f32>(\n            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveOutSize = vec2<f32>(\n            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],\n            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);\n\n          let effectiveInputOverOutputRatioRC =\n              effectiveInSize / effectiveOutSize;\n\n          // Fractional source index\n          let sourceFracIndexRC = ${e};\n\n          // Compute the coordinators of nearest neighbor point.\n          let inputShapeRC = vec2<f32>(f32(uniforms.xShape.y), f32(uniforms.xShape.z));\n          let sourceNearestRC = vec2<i32>(\n            min(inputShapeRC - 1.0, floor(sourceFracIndexRC + uniforms.roundBase)));\n          let newValue = getX(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n          setOutputAtIndex(index, newValue);\n        }\n      }\n    `}}(a.shape,l,u,s);return n.runWebGPUProgram(c,[a],a.dtype,d)}},UH={kernelName:hr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,[,o,l]=a.shape,[,u,d]=i.shape,c=[s&&u>1?o-1:o,s&&d>1?l-1:l],h=[s&&u>1?u-1:u,s&&d>1?d-1:d],p=1/(c[0]/h[0]),m=1/(c[1]/h[1]),f=2*Math.ceil(p)+2,g=2*Math.ceil(m)+2,y=new class{constructor(e,t){this.variableNames=["dy"],this.uniforms="effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, invHeightScale : f32, invWidthScale : f32,\n       winHeight : i32, winWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=t,this.shaderKey=`resizeNearestNeigborBackprop_${t}`}getUserCode(){return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getOutputCoords();\n          let b = coords[0];\n          let d = coords[3];\n          let r = coords[1];\n          let c = coords[2];\n\n          var accumulator = 0.0;\n\n          // Compute bounds for where in dy we will look\n          let startRLerp = floor(f32(r) * uniforms.invHeightScale);\n          let startDyR = i32(floor(startRLerp - f32(uniforms.winHeight / 2)));\n\n          let startCLerp = floor(f32(c) * uniforms.invWidthScale);\n          let startDyC = i32(floor(startCLerp - f32(uniforms.winWidth / 2)));\n\n          // Loop over dy\n          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {\n            let dyR = startDyR + dyROffset;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {\n              continue;\n            }\n\n            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {\n              let dyC = startDyC + dyCOffset;\n\n              // Guard against the window exceeding the bounds of dy\n              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {\n                continue;\n              }\n\n              let sourceFracRow = f32(uniforms.effectiveXSize[0]) *\n                  (f32(dyR) / f32(uniforms.effectiveYSize[0]));\n\n              let sourceFracCol = f32(uniforms.effectiveXSize[1]) *\n                  (f32(dyC) / f32(uniforms.effectiveYSize[1]));\n\n              let sourceNearestRow =\n                  i32(min(f32(uniforms.outShape[1] - 1),\n                  ${this.alignCorners?"floor(sourceFracRow + 0.5)":"floor(sourceFracRow)"}));\n\n              let sourceNearestCol =\n                  i32(min(f32(uniforms.outShape[2] - 1),\n                  ${this.alignCorners?"floor(sourceFracCol + 0.5)":"floor(sourceFracCol)"}));\n\n              if (r == sourceNearestRow && c == sourceNearestCol) {\n                accumulator += getDy(b, dyR, dyC, d);\n              }\n            }\n          }\n          // End loop over dy\n\n          setOutputAtIndex(index, accumulator);\n        }\n      }\n    `}}(a.shape,s),b=[{type:"int32",data:c},{type:"int32",data:h},{type:"float32",data:[p]},{type:"float32",data:[m]},{type:"int32",data:[f]},{type:"int32",data:[g]}];return n.runWebGPUProgram(y,[i],i.dtype,b)}},WH={kernelName:gr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,s=a.shape.length;if(0===s)return dU({inputs:{x:a},backend:n});let o=a.shape,l=[1,1,1,1];o.forEach(((e,t)=>{l[t+4-s]=e}));let u=Sa.parseAxisParam(i,a.shape),d=[0,0,0,0];u.forEach((e=>{d[e+4-s]=1}));let c=[{type:"int32",data:d}],h=aU({inputs:{x:a},backend:n,attrs:{shape:l}}),p=new class{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=" axis : vec4<i32>,",this.shaderKey="reverse"}getUserCode(){return`\n      \n      // Using uniform variables as judging conditions, so the function has\n      // coherent execution within all threads.\n      fn getReverseCoords(coords : vec4<i32>) -> vec4<i32> {\n        var reverseCoords = coords;\n        if (uniforms.axis[0] == 1) {\n          reverseCoords[0] = uniforms.xShape[0] - coords[0] - 1;\n        }\n        if (uniforms.axis[1] == 1) {\n          reverseCoords[1] = uniforms.xShape[1] - coords[1] - 1;\n        }\n        if (uniforms.axis[2] == 1) {\n          reverseCoords[2] = uniforms.xShape[2] - coords[2] - 1;\n        }\n        if (uniforms.axis[3] == 1) {\n          reverseCoords[3] = uniforms.xShape[3] - coords[3] - 1;\n        }\n\n        return reverseCoords;\n      }\n    \n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let reverseCoords = getReverseCoords(coords);\n          setOutputAtIndex(index, getX(reverseCoords[0],\n              reverseCoords[1], reverseCoords[2], reverseCoords[3]));\n        }\n      }\n    `}}(l),m=n.runWebGPUProgram(p,[h],h.dtype,c);n.disposeData(h.dataId);let f=aU({inputs:{x:m},backend:n,attrs:{shape:o}});return n.disposeData(m.dataId),f}},VH={kernelName:oa,backendName:"webgpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:i,center:s}=t,o=n,l=new class{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="centerX : f32, centerY : f32, sinRadians : f32,\n          cosRadians : f32,",this.shaderKey="rotate",this.outputShape=e,"number"==typeof t?(this.uniforms+=" fillValue : f32,",this.fillSnippet="var outputValue = uniforms.fillValue;",this.shaderKey+="_float"):(this.uniforms+=" fillValue : vec3<f32>,",this.fillSnippet="var outputValue = uniforms.fillValue[coords[3]];",this.shaderKey+="_vec3")}getUserCode(){return`\n        ${VL("index")} {\n          if (index < uniforms.size) {\n            let coords = getCoordsFromIndex(index);\n            let coordXFloat = (f32(coords[2]) - uniforms.centerX) *\n                uniforms.cosRadians - (f32(coords[1]) - uniforms.centerY) *\n                uniforms.sinRadians;\n            let coordYFloat = (f32(coords[2]) - uniforms.centerX) *\n                uniforms.sinRadians + (f32(coords[1]) - uniforms.centerY) *\n                uniforms.cosRadians;\n            let coordX = i32(round(coordXFloat + uniforms.centerX));\n            let coordY = i32(round(coordYFloat + uniforms.centerY));\n            ${this.fillSnippet}\n            if(coordX >= 0 && coordX < uniforms.xShape[2] && coordY >= 0 &&\n                coordY < uniforms.xShape[1]) {\n              outputValue = getX(coords[0], coordY, coordX, coords[3]);\n            }\n            setOutputAtIndex(index, outputValue);\n          }\n        }\n      `}}(r.shape,i),[u,d]=$m.getImageCenter(s,r.shape[1],r.shape[2]),c=[{type:"float32",data:[u]},{type:"float32",data:[d]},{type:"float32",data:[Math.sin(a)]},{type:"float32",data:[Math.cos(a)]}];return"number"==typeof i?c.push({type:"float32",data:[Number.parseFloat(i.toFixed(2))]}):c.push({type:"float32",data:i}),o.runWebGPUProgram(l,[r],r.dtype,c)}},jH=fU({opType:pz.ROUND}),HH={kernelName:yr,backendName:"webgpu",kernelFunc:jH},GH=fU({opType:pz.RSQRT,cpuKernelImpl:UU}),qH={kernelName:br,backendName:"webgpu",kernelFunc:GH},XH=class{constructor(e,t,n,r,a,i,s,o=!0){this.variableNames=["updates","indices"],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=i,this.type=s,this.sumDupeIndices=o,this.dispatchLayout=sz(e),this.dispatch=nz(this.dispatchLayout,e,this.workgroupSize),this.sliceDimGreaterThanOne=t>1,this.shaderKey=`scatter_${n}_${r}_${this.sliceDimGreaterThanOne}_${s}_${o}`;let l=UL(a.length);this.uniforms=`sliceDim : i32, strides: ${l}, updatesSize: i32,`,this.updatesRank=r,this.indicesRank=n}getUserCode(){let e="";1===this.indicesRank?e="coords[0]":2===this.indicesRank&&(e="coords[0], j");let t=`getIndices(${e})`,n=this.sliceDimGreaterThanOne?"uniforms.strides[j]":"uniforms.strides",r="",a="";1===this.dispatchLayout.x.length?(r="flattenedIndex",a="\n      fn getUpdatesCoordsFromFlatIndex(index : i32) -> i32 {\n        return index;\n      }\n      "):2===this.dispatchLayout.x.length&&(r="vec2<i32>(flattenedIndex, coords[1])",a="\n      fn getUpdatesCoordsFromFlatIndex(index : i32) -> vec2<i32> {\n        // N.B. |updates| could be a scalar tensor, conceptually representing a\n        // 2D tensor with all values equal to that. By design, its size must be\n        // the same as |outShape[1]| in one dimension, and |indicesShape[0]|\n        // gives the other.\n        let sliceSize = uniforms.outShape[1];\n        let d0 = index / sliceSize;\n        let d1 = index - d0 * sliceSize;\n        return vec2<i32>(d0, d1);\n      }\n      ");let i=`getUpdates(${Array.from({length:this.updatesRank},((e,t)=>`coords[${t}]`)).join(", ")})`;return`\n    ${a}\n      ${VL("index")} {\n        if (index < uniforms.updatesSize) {\n          let coords = getUpdatesCoordsFromFlatIndex(index);\n          var flattenedIndex = 0;\n          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {\n            let indexInside = i32(round(${t}));\n            flattenedIndex = flattenedIndex + indexInside * ${n};\n          }\n          let updateValue =\n              ${ZL(this.type)}(${i});\n          let flatIndex = getOutputIndexFromCoords(${r});\n\n          ${this.sumDupeIndices?zL("&result[flatIndex]","updateValue",this.type):"atomicStore(&result[flatIndex], bitcast<i32>(updateValue));"}\n        }\n      }`}},KH={kernelName:xr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:d,outputSize:c}=$m.calculateShapes(i,a,s),h=[c/u,u];if(0===c)return n.makeTensorInfo(s,a.dtype);let p=aU({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),m=aU({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),f=m.dtype,g=nU({backend:n,attrs:{shape:h,value:0,dtype:f}}),y=[{type:"int32",data:[o]},{type:"int32",data:d},{type:"int32",data:[Sa.sizeFromShape(m.shape)]}],b=new XH(m.shape,o,p.shape.length,m.shape.length,d,h,f),x=n.runWebGPUProgram(b,[m,p],f,y,g),A=aU({inputs:{x},backend:n,attrs:{shape:s}});return n.disposeData(p.dataId),n.disposeData(m.dataId),n.disposeData(x.dataId),A}},ZH={kernelName:vr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=new class{constructor(e,t){this.outputShape=[],this.variableNames=["sortedSequence","values"],this.uniforms="numInputs : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.side=t,this.shaderKey=`search_sorted_${t}`}getUserCode(){return`\n      fn findBound(batch: i32, value: f32) -> i32 {\n        var left = i32(0);\n        var right = uniforms.numInputs;\n        while (left < right) {\n          var mid = (left + right) / 2;\n          if (getSortedSequence(batch, mid) ${"left"===this.side?"<":"<="} value) {\n            left = mid + 1;\n          } else {\n            right = mid;\n          }\n        }\n        return right;\n      }\n\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let value = getValuesByOutputIndex(index);\n          setOutputAtIndexI32(index, findBound(coords[0], value));\n        }\n      }\n    `}}([i.shape[0],i.shape[1]],s),l=[{type:"int32",data:[a.shape[1]]}];return n.runWebGPUProgram(o,[a,i],"int32",l)}},YH={kernelName:wr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,s=new class{constructor(e,t,n){this.variableNames=["c","a","b"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.cRank=e,this.rank=n,this.shaderKey="select"}getUserCode(){let e,t;if(this.rank>4)throw Error(`Where for rank ${this.rank} is not yet supported`);if(1===this.rank)t="resRC",e="resRC";else{let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=[];for(let e=0;e<this.outputShape.length;e++)a.push(`${n[e]}`),e<this.cRank&&r.push(`${n[e]}`);e=r.join(),t=a.join()}return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let resRC = getCoordsFromIndex(index);\n          let cVal = getC(${e});\n          if (cVal >= 1.0) {\n            setOutputAtIndex(index, getA(${t}));\n          } else {\n            setOutputAtIndex(index, getB(${t}));\n          }\n        }\n      }\n    `}}(r.shape.length,a.shape,a.shape.length);return n.runWebGPUProgram(s,[r,a,i],gi(a.dtype,i.dtype))}},JH=fU({opType:pz.SELU}),QH={kernelName:kr,backendName:"webgpu",kernelFunc:JH},eG=fU({opType:pz.SIGMOID}),tG={kernelName:Cr,backendName:"webgpu",kernelFunc:eG},nG=fU({opType:pz.SIGN}),rG={kernelName:Ir,backendName:"webgpu",kernelFunc:nG},aG=fU({opType:pz.SIN}),iG={kernelName:Tr,backendName:"webgpu",kernelFunc:aG},sG=fU({opType:pz.SINH}),oG={kernelName:_r,backendName:"webgpu",kernelFunc:sG},lG=fU({opType:pz.SOFTPLUS}),uG={kernelName:Er,backendName:"webgpu",kernelFunc:lG},dG={kernelName:Pr,backendName:"webgpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;Sa.assert(a.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGPU backend not implemented yet"));let o=i.reduce(((e,t)=>e*t)),l=[[0,0]];l.push(...s);for(let e=1+i.length;e<a.shape.length;++e)l.push([0,0]);let u=l.map(((e,t)=>e[0]+a.shape[t]+e[1])),d=$m.getReshaped(u,i,o,!1),c=$m.getPermuted(d.length,i.length,!1),h=$m.getReshapedPermuted(u,i,o,!1),p=Sa.computeStrides(u),m=new class{constructor(e,t,n,r,a,i){this.variableNames=["x"],this.outputShape=[],this.uniforms="",this.workgroupSize=[64,1,1],this.size=!0;let s=new Array(r.length);for(let e=0;e<s.length;e++)s[e]=r[a[e]];this.outputShape=s,this.newDim=a,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,this.paddedXShape=t,this.uniforms+=`reshapedPaddedXShape : ${UL(r.length)}, paddedXShapeStrides : ${UL(i)}, `,n.map(((e,t)=>{this.uniforms+=` pad${t} : vec2<i32>,`})),this.shaderKey=`spaceToBatchND_${a}`}getUserCode(){let e=UL(this.outputShape.length),t=uW(this.newDim);return`\n      ${qL(this.paddedXShape,"PaddedX")}\n      ${VL("index")} {\n        if(index < uniforms.size) {\n          let coords = getCoordsFromIndex(index);\n          let switchedIndex = getIndexFromCoords${this.outputShape.length}D(${e}(${t}), uniforms.reshapedPaddedXShape);\n          let paddedCoords = getPaddedXCoordsFromIndex(switchedIndex);\n          ${kH(this.xShape,!0)}\n        }\n      }\n    `}}(a.shape,u,l,d,c,p.length),f=[{type:"int32",data:d},{type:"int32",data:p}];l.map((e=>f.push({type:"int32",data:[e[0],e[1]]})));let g=n.runWebGPUProgram(m,[a],a.dtype,f),y=aU({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeData(g.dataId),y}};function cG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;if(n.shouldExecuteOnCPU([a])||"string"===a.dtype||a.shape.length>=5){let e=n.readSync(a.dataId),t="string"===a.dtype?e.map((e=>Sa.decodeString(e))):e,r=Ws(a.shape,a.dtype,t),s=XU(r,i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}let s=new class{constructor(e,t){this.variableNames=["A"],this.workgroupSize=[64,1,1],this.size=!0;let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.rank=this.outputShape.length,this.shaderKey="tile"}getUserCode(){let e=function(e,t=""){if(e>=5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`(resRC % ${t}aShape)`;let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let a=0;a<e;a++)r.push(`(${n[a]} % ${t}aShape[${a}])`);return r.join()}(this.rank,"uniforms.");return`\n      ${VL("index")} {\n        if (index < uniforms.size) {\n          let resRC = getCoordsFromIndex(index);\n          setOutputAtIndex(index, getA(${e}));\n        }\n      }\n    `}}(a.shape,i);return n.runWebGPUProgram(s,[a],a.dtype)}var hG={kernelName:Zr,backendName:"webgpu",kernelFunc:cG},pG={kernelName:zr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=$m.calculateShapes(i,a,o),p=!1;if("string"===i.dtype){let e=n.bufferSync(a),t=n.bufferSync(i),r=Sa.decodeString(n.readSync(s.dataId)[0]),m=WU(e,t,o,h,d,u,l,c,r,p);return n.makeTensorInfo(o,m.dtype,m.values)}let m=[h/d,d],f=aU({inputs:{x:a},backend:n,attrs:{shape:[u,l]}}),g=i.shape.length?aU({inputs:{x:i},backend:n,attrs:{shape:[u,d]}}):dU({inputs:{x:i},backend:n}),y=g.dtype,b=n.makeTensorInfo([],y,Sa.makeZerosTypedArray(1,y)),x=aU({inputs:{x:s},backend:n,attrs:{shape:Array(m.length).fill(1)}}),A=cG({inputs:{x},backend:n,attrs:{reps:m}}),v=[{type:"int32",data:[l]},{type:"int32",data:c},{type:"int32",data:[Sa.sizeFromShape([u,d])]}];switch(u){case 0:break;case 1:{let e=new XH([u,d],l,f.shape.length,g.shape.length,c,m,y,p);n.runWebGPUProgram(e,[g,f],y,v,A)}break;default:{let e=new XH([u,d],l,f.shape.length,b.shape.length,c,m,y,p);n.runWebGPUProgram(e,[b,f],y,v,A)}{let e=new XH([u,d],l,f.shape.length,g.shape.length,c,m,y);n.runWebGPUProgram(e,[g,f],y,v,A)}}let w=aU({inputs:{x:A},backend:n,attrs:{shape:o}});return n.disposeData(f.dataId),n.disposeData(g.dataId),n.disposeData(x.dataId),n.disposeData(b.dataId),n.disposeData(A.dataId),w}},mG={kernelName:Dr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=Sa.parseAxisParam(s,a.shape)[0],l=$m.prepareSplitSize(a,i,o),u=a.shape.length,d=new Array(u).fill(0),c=a.shape.slice();return l.map((e=>{let t=[...c];t[o]=e;let r=WW({inputs:{x:a},backend:n,attrs:{begin:d,size:t}});return d[o]+=e,r}))}},fG=fU({opType:pz.SQRT}),gG={kernelName:Nr,backendName:"webgpu",kernelFunc:fG},yG={kernelName:Ur,backendName:"webgpu",kernelFunc:({inputs:e,backend:t})=>{let{x:n}=e,r=t,a=new mU(n.shape,pz.SQUARE);return r.runWebGPUProgram(a,[n],n.dtype)}},bG=gU({opType:dz.SQUARED_DIFFERENCE}),xG={kernelName:Br,backendName:"webgpu",kernelFunc:bG},AG={kernelName:ia,backendName:"webgpu",kernelFunc:function({inputs:e,attrs:t,backend:n}){let{x:r}=e,a=new mU(r.shape,pz.STEP,"stepAlpha : f32,"),i=[{type:"float32",data:[t.alpha]}];return n.runWebGPUProgram(a,[r],r.dtype,i)}},vG={kernelName:Vr,backendName:"webgpu",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{x:i}=n,{begin:s,end:o,strides:l,beginMask:u,endMask:d,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=a,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:x,end:A,strides:v}=dm.sliceInfo(i.shape,s,o,l,u,d,c,h,p);if(g)t=aU({inputs:{x:i},backend:r,attrs:{shape:f}});else if(y||b){Sa.assert(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));let e=dm.computeOutShape(x,A,v),n=WW({inputs:{x:i},backend:r,attrs:{begin:x,size:e}});t=aU({inputs:{x:n},backend:r,attrs:{shape:f}}),r.disposeData(n.dataId)}else if(r.shouldExecuteOnCPU([i])){let e=r.readSync(i.dataId),n=Ws(i.shape,i.dtype,e),a=HU(m,n,v,x);t=r.makeTensorInfo(f,i.dtype,a.values)}else{let e=new class{constructor(e){this.variableNames=["x"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]);let t=UL(this.outputShape.length);this.uniforms=`begin : ${t},  strides : ${t}, `,this.shaderKey="stridedSlice"}getUserCode(){let e="";if(1===this.outputShape.length)e="coords * uniforms.strides + uniforms.begin";else{let t=0;e=this.outputShape.map(((e,n)=>(t++,1===this.outputShape.length?`coords * uniforms.strides[${n}] + uniforms.begin[${n}]`:`coords[${t-1}] * uniforms.strides[${n}] + uniforms.begin[${n}]`))).join(",")}return`\n       ${VL("index")} {\n         if (index < uniforms.size) {\n           let coords = getCoordsFromIndex(index);\n           setOutputAtIndex(index, getX(${e}));\n         }\n       }\n     `}}(m),n=[{type:"int32",data:x},{type:"int32",data:v}],a=r.runWebGPUProgram(e,[i],i.dtype,n);t=aU({inputs:{x:a},backend:r,attrs:{shape:f}}),r.disposeData(a.dataId)}return t}},wG={kernelName:jr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:d,dataSplits:c}=t,h=n.readSync(d.dataId),p=n.readSync(c.dataId),[m,f]=GU(h,p,a,i,s,o,l,u);return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(c.shape,"int32",f)]}},kG=gU({opType:dz.SUB,cpuKernelImpl:qU,supportsComplex:!0}),SG={kernelName:qr,backendName:"webgpu",kernelFunc:kG},TG=fU({opType:pz.TAN}),_G={kernelName:Xr,backendName:"webgpu",kernelFunc:TG},IG=fU({opType:pz.TANH}),CG={kernelName:Kr,backendName:"webgpu",kernelFunc:IG},EG={kernelName:Ar,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:i,updates:s}=t,{}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:d,outputSize:c}=$m.calculateShapes(s,i,a.shape),h=[c/u,u];if(0===c)return n.makeTensorInfo(a.shape,i.dtype);let p=[],m=aU({inputs:{x:i},backend:n,attrs:{shape:[l,o]}});p.push(m);let f=aU({inputs:{x:s},backend:n,attrs:{shape:[l,u]}});p.push(f);let g=aU({inputs:{x:a},backend:n,attrs:{shape:h}});p.push(g);let y=cG({inputs:{x:g},backend:n,attrs:{reps:Array(h.length).fill(1)}}),b=new XH([l,u],o,m.shape.length,f.shape.length,d,h,a.dtype,!1),x=[{type:"int32",data:[o]},{type:"int32",data:d},{type:"int32",data:[Sa.sizeFromShape([l,u])]}],A=n.runWebGPUProgram(b,[f,m],g.dtype,x,y);p.push(A);let v=aU({inputs:{x:A},backend:n,attrs:{shape:a.shape}});return p.forEach((e=>n.disposeData(e.dataId))),v}},NG=class{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, k : i32,",this.shaderKey="merge"}getUserCode(){return`\n        ${VL("index")} {\n          if (index < uniforms.size) {\n            let outC = getCoordsFromIndex(index);\n            let batch = outC[0];\n            let elemIdx = outC[1];\n            // The output size is half of the previous size.\n            // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _\n            // (k=4), we only need to output the indices at positions |, the\n            // indices at positions _ can be thrown away, see Figure5(b) After\n            // Phase 2 (Merge phase) in the Bitonic Top K paper referenced\n            // above.\n            // For example, the paper shows we only need to output the orange\n            // bars. The output sequence should look like this | | | | | | | |.\n            // Because the sequence is halved, to map the output index back to\n            // the previous sequence to find the corresponding value, we need\n            // to double the index. When we double the index, we basically\n            // interpolate a position, so 2i looks like\n            // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k\n            // position of each 2k positions by - elemIdx % k. E.g. for output\n            // at index 4,5,6,7, we want to get the corresponding element at\n            // original index 8,9,10,11, for output at index 8,9,10,11,\n            // we want to get the corresponding element at original index\n            // 16,17,18,19, so on and so forth.\n\n            var i = 0;\n            if (elemIdx < uniforms.k) {\n              i = elemIdx;\n            } else {\n              i = elemIdx * 2 - elemIdx % uniforms.k;\n            }\n            var i0 = 0;\n            if (uniforms.firstPass == 1) {\n              i0 = i;\n            } else {\n              i0 = i32(getIndices(batch, i));\n            }\n            var i1 = 0;\n            if (uniforms.firstPass == 1) {\n              i1 = i + uniforms.k;\n            } else {\n              i1 = i32(getIndices(batch, i + uniforms.k));\n            }\n\n            let x0 = getX(batch, i0);\n            var x1 = f32(0.0);\n            if (i1 < uniforms.inputSize) {\n              x1 = getX(batch, i1);\n            } else {\n              x1 = x0;\n            }\n\n            if (x0 >= x1) {\n              setOutputAtIndex(index, f32(i0));\n            } else {\n              setOutputAtIndex(index, f32(i1));\n            }\n          }\n        }\n      `}};function RG(e,t){null!==t&&e.disposeData(t.dataId)}function PG(e){let t=1;for(;t<e;)t*=2;return t}var DG={kernelName:Yr,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r,o=a.shape,l=o[o.length-1];if(n.shouldExecuteOnCPU([a])){let e=n.readSync(a.dataId),[t,r]=KU(e,o,a.dtype,i,s);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===i)return o[o.length-1]=0,[n.makeTensorInfo(o,a.dtype,[]),n.makeTensorInfo(o,"int32",[])];if(1===l)return[a,nU({attrs:{shape:o,dtype:"int32",value:0},backend:n})];let u=Sa.sizeFromShape(o)/l,d=aU({inputs:{x:a},attrs:{shape:[u,l]},backend:n}),c=PG(i),h=PG(l),p=null,m=()=>null===p?[d,d]:[d,p],f=(e,t,r)=>{let a=m(),i=new class{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, negativeInf : f32,\n        dir : i32, inc : i32,",this.shaderKey="swap"}getUserCode(){return`\n        ${VL("index")} {\n          if (index < uniforms.size) {\n            let outC = getCoordsFromIndex(index);\n            let batch = outC[0];\n            let elemIdx = outC[1];\n            // We compare elements pair-wise within a group of size 2 * inc.\n            // The comparing rule for each group alternates between ascending\n            // and descending. Within each group, we compare each pair at\n            // positions i and i+inc. To decide whether an element at position i\n            // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n            // inc, it is in the first half of the group, we denote it as x0,\n            // otherwise we denote it as x1.\n            // For example, as shown in the Bitonic top K paper referenced\n            // above, Figure5(a) shows that element[1] is in the second half of\n            // the group when group size is 2, but it is in the first half of\n            // the group when group size is 4.\n            let isFirstInPair = elemIdx % (2 * uniforms.inc) < uniforms.inc;\n            var i = 0;\n            if (isFirstInPair) {\n              i = elemIdx;\n            } else {\n              i = elemIdx - uniforms.inc;\n            }\n\n            var i0 = 0;\n            if (uniforms.firstPass == 1) {\n              i0 = i;\n            } else {\n              i0 = i32(getIndices(batch, i));\n            }\n\n            var i1 = 0;\n            if (uniforms.firstPass == 1) {\n              i1 = i + uniforms.inc;\n            } else {\n              i1 = i32(getIndices(batch, i + uniforms.inc));\n            }\n\n            var x0 = f32(0.0);\n            var x1 = f32(0.0);\n            if (i0 < uniforms.inputSize) {\n              x0 = getX(batch, i0);\n            } else {\n              x0 = uniforms.negativeInf;\n            }\n            if (i1 < uniforms.inputSize) {\n              x1 = getX(batch, i1);\n            } else {\n              x1 = uniforms.negativeInf;\n            }\n\n            let reverse = elemIdx % (2 * uniforms.dir) >= uniforms.dir;\n            let isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n            if (reverse == isGreater) {\n              // Elements in opposite order of direction\n              let iTemp = i0;\n              i0 = i1;\n              i1 = iTemp;\n            }\n            if (isFirstInPair) {\n              setOutputAtIndex(index, f32(i0));\n            } else {\n              setOutputAtIndex(index, f32(i1));\n            }\n          }\n        }\n      `}}(r),s=[{type:"int32",data:[l]},{type:"int32",data:[null===p?1:0]},{type:"float32",data:[Number.NEGATIVE_INFINITY]},{type:"int32",data:[e]},{type:"int32",data:[t]}],o=p;p=n.runWebGPUProgram(i,a,"int32",s),RG(n,o)};for(let e=1;e<c;e*=2){let t=2*e;for(let n=e;n>=1;n/=2)f(t,n,[u,h])}for(let e=h;e>c;e/=2){let t=m(),r=new NG([u,e/2]),a=[{type:"int32",data:[l]},{type:"int32",data:[null===p?1:0]},{type:"int32",data:[c]}],i=p;p=n.runWebGPUProgram(r,t,"int32",a),RG(n,i);let s=c/2,o=2*s;for(let e=s;e>=1;e/=2)f(o,e,p.shape)}let g=p;p=WW({inputs:{x:p},backend:n,attrs:{begin:0,size:[u,i]}}),RG(n,g);let y=vj({inputs:{x:d,indices:p},backend:n,attrs:{axis:1,batchDims:1}});RG(n,d);let b=o.slice(0,-1);b.push(i),g=p,p=aU({inputs:{x:p},attrs:{shape:b},backend:n}),RG(n,g);let x=y;return y=aU({inputs:{x:y},attrs:{shape:b},backend:n}),RG(n,x),[y,p]}},MG={kernelName:Jr,backendName:"webgpu",kernelFunc:function(e){let t,{inputs:n,backend:r,attrs:a}=e,{image:i,transforms:s}=n,{interpolation:o,fillMode:l,fillValue:u,outputShape:d}=a,[c,h,p,m]=i.shape,[f,g]=null!=d?d:[h,p],y=[c,f,g,m],b=new class{constructor(e){this.variableNames=["Image","Transforms"],this.uniforms="interpolationModeId : i32, fillModeId : i32, fillValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=sz(this.outputShape),this.dispatch=nz(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="transform"}getUserCode(){return`\n          fn mapCoord(outCoord : f32, len : f32) -> f32{\n            var inCoord = outCoord;\n            if(uniforms.fillModeId == 2) {\n              if (inCoord < 0.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz2 = 2.0 * len;\n                  if (inCoord < sz2) {\n                    inCoord = sz2 * f32(i32(f32(-inCoord / sz2))) +\n                    inCoord;\n                  }\n                  if (inCoord < -len) {\n                    inCoord = inCoord + sz2;\n                  } else {\n                    inCoord = -inCoord - 1.0;\n                  }\n                }\n              } else if (inCoord > len - 1.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz2 = 2.0 * len;\n                  inCoord = inCoord - sz2 * f32(i32(f32(inCoord / sz2)));\n                  if (inCoord >= len) {\n                    inCoord = sz2 - inCoord - 1.0;\n                  }\n                }\n              }\n              return clamp(inCoord, 0.0, len - 1.0);\n            } else if (uniforms.fillModeId == 3) {\n              if (inCoord < 0.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz = len - 1.0;\n                  inCoord = inCoord + len * (f32(i32(f32(-inCoord / sz))) + 1.0);\n                }\n              } else if (inCoord > len - 1.0) {\n                if (len <= 1.0) {\n                  inCoord = 0.0;\n                } else {\n                  let sz = len - 1.0;\n                  inCoord = inCoord - len * f32(i32(f32(inCoord / sz)));\n                }\n              }\n              return clamp(inCoord, 0.0, len - 1.0);\n            } else if (uniforms.fillModeId == 4) {\n              return clamp(outCoord, 0.0, len - 1.0);\n            }\n            return outCoord;\n          }\n          fn readWithFillValue(batch : i32, coordY : i32, coordX : i32,\n            channel : i32) -> f32 {\n            var outputValue : f32;\n            if (0 <= coordY && coordY < uniforms.imageShape[1] && 0 <= coordX && coordX < uniforms.imageShape[2]) {\n                outputValue = getImage(batch, coordY, coordX, channel);\n            } else {\n              outputValue = uniforms.fillValue;\n            }\n            return outputValue;\n          }\n\n          ${VL("index")} {\n            if (index < uniforms.size) {\n              let coords = getCoordsFromIndex(index);\n              var outputValue : f32;\n              let batch = coords[0];\n              let x = coords[2];\n              let y = coords[1];\n              let channel = coords[3];\n              let xf = f32(x);\n              let yf = f32(y);\n              let a1 = getTransforms(batch, 0);\n              let a2 = getTransforms(batch, 1);\n              let a3 = getTransforms(batch, 2);\n              let b1 = getTransforms(batch, 3);\n              let b2 = getTransforms(batch, 4);\n              let b3 = getTransforms(batch, 5);\n              let c1 = getTransforms(batch, 6);\n              let c2 = getTransforms(batch, 7);\n              let projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = uniforms.fillValue;\n              } else {\n                let inX = (a1 * xf + a2 * yf + a3) / projection;\n                let inY = (b1 * xf + b2 * yf + b3) / projection;\n                let mapX = mapCoord(inX, f32(uniforms.imageShape[2]));\n                let mapY = mapCoord(inY, f32(uniforms.imageShape[1]));\n\n                if (uniforms.interpolationModeId == 1) {\n                  let coordY = i32(round(mapY));\n                  let coordX = i32(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  let yFloor = floor(mapY);\n                  let xFloor = floor(mapX);\n                  let yCeil = yFloor + 1.0;\n                  let xCeil = xFloor + 1.0;\n                  let valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, i32(yFloor), i32(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, i32(yFloor), i32(xCeil), channel);\n                  let valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, i32(yCeil), i32(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, i32(yCeil), i32(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutputAtIndex(index, outputValue);\n            }\n          }\n        `}}(y),x="nearest"===o?1:2;switch(l){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}let A=[{type:"int32",data:[x]},{type:"int32",data:[t]},{type:"float32",data:[u]}];return r.runWebGPUProgram(b,[i,s],"float32",A)}},OG={kernelName:ta,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:i}=r;i<0&&(i+=a.shape.length);let s=a,o=s.shape.length,l=a.shape[i],u=new Array(o-1),d=0;for(let e=0;e<o;e++)e!==i&&(u[d++]=s.shape[e]);let c=[],h=new Array(o).fill(0),p=s.shape.slice();p[i]=1;let m=new Array(l);for(let e=0;e<m.length;e++){h[i]=e;let t=WW({inputs:{x:s},backend:n,attrs:{begin:h,size:p}}),r=aU({inputs:{x:t},backend:n,attrs:{shape:u}});m[e]=r,c.push(t)}return c.forEach((e=>n.disposeData(e.dataId))),m}},$G={kernelName:na,backendName:"webgpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r,o=a.shape.length,l=[],u=0,d=$m.getAxesPermutation([u],o),c=a;null!=d&&(c=dW({inputs:{x:a},backend:n,attrs:{perm:d}}),l.push(c),u=$m.getInnerMostAxes(1,o)[0]);let h=$m.segment_util.computeOutShape(c.shape,u,s),p=Sa.sizeFromShape([c.shape[u]]),m=aU({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}});l.push(m);let f=a.dtype,g=[m.shape[0],s],y=nU({backend:n,attrs:{shape:g,value:0,dtype:f}}),b=new class{constructor(e,t,n){if(this.outputShape=[],this.variableNames=["x","segmentIds"],this.uniforms="numSegments : i32, xSize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=t,this.dispatchLayout=sz(e),this.dispatch=nz(this.dispatchLayout,e,this.workgroupSize),"float32"!==n&&"int32"!==n)throw new Error(`UnsortedSegmentSum only supports float32 and int32\n              types, does not support ${n} type.`);this.type=n,this.shaderKey="unsortedSegmentSum"}getUserCode(){return`\n    ${VL("index")} {\n      if (index < uniforms.xSize) {\n        let coords = getXCoordsFromIndex(index);\n        let b = coords[0];\n        let inCol = coords[1];\n\n        let segmentId = i32(getSegmentIds(inCol));\n        if (segmentId >= 0) {\n          let flatIndex = b * uniforms.numSegments + segmentId % uniforms.numSegments;\n          let value = getX(b, inCol);\n\n          ${zL("&result[flatIndex]","value",this.type)}\n        }\n      }\n    }\n  `}}(m.shape,g,f),x=[{type:"int32",data:[s]},{type:"int32",data:[Sa.sizeFromShape(m.shape)]}],A=n.runWebGPUProgram(b,[m,i],f,x,y),v=aU({inputs:{x:A},backend:n,attrs:{shape:h}});l.push(A);let w=v;if(null!=d){l.push(v);let e=$m.getUndoAxesPermutation(d);w=dW({inputs:{x:w},backend:n,attrs:{perm:e}})}return l.forEach((e=>n.disposeData(e.dataId))),w}},FG=[oU,QU,tW,rW,iW,sW,mW,fW,yW,bW,AW,wW,SW,_W,CW,$W,FW,LW,zW,BW,jW,qW,XW,QW,tV,nV,pU,aV,dV,mV,fV,gV,yV,bV,xV,vV,kV,SV,EV,NV,RV,PV,$V,FV,OV,LV,zV,BV,UV,GV,XV,KV,YV,QV,tj,rj,ij,uj,rU,dj,fj,hj,mj,yj,bj,xj,Aj,wj,Sj,_j,cU,Ij,oV,Ej,Rj,Dj,Mj,$j,Lj,zj,Vj,Uj,Hj,qj,Kj,Yj,Jj,PW,eH,tH,aH,nH,rH,iH,MW,sH,lH,uH,cH,mH,VV,fH,gH,yH,ZW,bH,vH,wH,SH,_H,IH,CH,EH,JW,RH,DH,OH,FH,iU,LH,zH,BH,UH,WH,VH,HH,qH,KH,ZH,YH,QH,tG,rG,iG,oG,VW,AG,vG,wG,pH,uG,dG,pG,mG,gG,yG,xG,SG,HV,_G,CG,EG,hG,DG,MG,cW,OG,$G,AH];for(let e of FG)ba(e);var LG="4.7.0",zG={tfjs:LG,"tfjs-core":LG,"tfjs-converter":"4.7.0","tfjs-backend-cpu":"4.7.0","tfjs-backend-webgl":"4.7.0","tfjs-backend-wasm":"4.7.0","tfjs-backend-webgpu":"4.7.0"};function BG(...e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}.${t.getMilliseconds().toString().padStart(3,"0")}`;e&&console.log(n,"Human:",...e)}var UG=()=>"undefined"!=typeof performance?performance.now():parseInt((Number(process.hrtime.bigint())/1e3/1e3).toString());function WG(e,t,n="config",r=[]){for(const a of Object.keys(t))if("object"==typeof t[a])WG(e[a],t[a],a,r);else{const i=e&&void 0!==e[a];i||r.push({reason:"unknown property",where:`${n}.${a} = ${t[a]}`});const s=e&&typeof e[a]==typeof t[a];i&&!s&&r.push({reason:"property type mismatch",where:`${n}.${a} = ${t[a]}`,expected:typeof e[a]})}return t.debug&&"config"===n&&r.length>0&&BG("invalid configuration",r),r}function VG(...e){const t=e=>e&&"object"==typeof e;return e.reduce(((e,n)=>(Object.keys(n||{}).forEach((r=>{const a=e[r],i=n[r];Array.isArray(a)&&Array.isArray(i)?e[r]=a.concat(...i):t(a)&&t(i)?e[r]=VG(a,i):e[r]=i})),e)),{})}var jG={backend:"",modelBasePath:"",cacheModels:!0,validateModels:!0,wasmPath:"",wasmPlatformFetch:!1,debug:!1,async:!0,warmup:"full",cacheSensitivity:.7,skipAllowed:!1,deallocate:!1,flags:{},softwareKernels:!1,filter:{enabled:!0,equalization:!1,width:0,height:0,flip:!1,return:!0,autoBrightness:!0,brightness:0,contrast:0,sharpness:0,blur:0,saturation:0,hue:0,negative:!1,sepia:!1,vintage:!1,kodachrome:!1,technicolor:!1,polaroid:!1,pixelate:0},gesture:{enabled:!0},face:{enabled:!0,detector:{modelPath:"blazeface.json",rotation:!1,maxDetected:1,skipFrames:99,skipTime:2500,minConfidence:.2,minSize:0,iouThreshold:.1,mask:!1,return:!1},mesh:{enabled:!0,modelPath:"facemesh.json",keepInvalid:!1},attention:{enabled:!1,modelPath:"facemesh-attention.json"},iris:{enabled:!0,modelPath:"iris.json"},emotion:{enabled:!0,minConfidence:.1,skipFrames:99,skipTime:1500,modelPath:"emotion.json"},description:{enabled:!0,modelPath:"faceres.json",skipFrames:99,skipTime:3e3,minConfidence:.1},antispoof:{enabled:!1,skipFrames:99,skipTime:4e3,modelPath:"antispoof.json"},liveness:{enabled:!1,skipFrames:99,skipTime:4e3,modelPath:"liveness.json"}},body:{enabled:!0,modelPath:"movenet-lightning.json",maxDetected:-1,minConfidence:.3,skipFrames:1,skipTime:200},hand:{enabled:!0,rotation:!0,skipFrames:99,skipTime:1e3,minConfidence:.5,iouThreshold:.2,maxDetected:-1,landmarks:!0,detector:{modelPath:"handtrack.json"},skeleton:{modelPath:"handlandmark-lite.json"}},object:{enabled:!1,modelPath:"centernet.json",minConfidence:.2,iouThreshold:.4,maxDetected:10,skipFrames:99,skipTime:2e3},segmentation:{enabled:!1,modelPath:"rvm.json",ratio:.5,mode:"default"}},HG="\n  precision highp float;\n  attribute vec2 pos;\n  attribute vec2 uv;\n  varying vec2 vUv;\n  uniform float flipY;\n  void main(void) {\n    vUv = uv;\n    gl_Position = vec4(pos.x, pos.y*flipY, 0.0, 1.);\n  }\n",GG="\n  precision highp float;\n  varying vec2 vUv;\n  uniform sampler2D texture;\n  uniform float m[20];\n  void main(void) {\n    vec4 c = texture2D(texture, vUv);\n    gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4];\n    gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9];\n    gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14];\n    gl_FragColor.a = m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19];\n  }\n",qG="\n  precision highp float;\n  varying vec2 vUv;\n  uniform sampler2D texture;\n  uniform float m[20];\n  void main(void) {\n    vec4 c = texture2D(texture, vUv);\n    gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[4];\n    gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[9];\n    gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[14];\n    gl_FragColor.a = c.a;\n  }\n",XG="\n  precision highp float;\n  varying vec2 vUv;\n  uniform vec2 size;\n  uniform sampler2D texture;\n  vec2 pixelate(vec2 coord, vec2 size) {\n    return floor( coord / size ) * size;\n  }\n  void main(void) {\n    gl_FragColor = vec4(0.0);\n    vec2 coord = pixelate(vUv, size);\n    gl_FragColor += texture2D(texture, coord);\n  }\n",KG="\n  precision highp float;\n  varying vec2 vUv;\n  uniform sampler2D texture;\n  uniform vec2 px;\n  void main(void) {\n    gl_FragColor = vec4(0.0);\n    gl_FragColor += texture2D(texture, vUv + vec2(-7.0*px.x, -7.0*px.y))*0.0044299121055113265;\n    gl_FragColor += texture2D(texture, vUv + vec2(-6.0*px.x, -6.0*px.y))*0.00895781211794;\n    gl_FragColor += texture2D(texture, vUv + vec2(-5.0*px.x, -5.0*px.y))*0.0215963866053;\n    gl_FragColor += texture2D(texture, vUv + vec2(-4.0*px.x, -4.0*px.y))*0.0443683338718;\n    gl_FragColor += texture2D(texture, vUv + vec2(-3.0*px.x, -3.0*px.y))*0.0776744219933;\n    gl_FragColor += texture2D(texture, vUv + vec2(-2.0*px.x, -2.0*px.y))*0.115876621105;\n    gl_FragColor += texture2D(texture, vUv + vec2(-1.0*px.x, -1.0*px.y))*0.147308056121;\n    gl_FragColor += texture2D(texture, vUv                             )*0.159576912161;\n    gl_FragColor += texture2D(texture, vUv + vec2( 1.0*px.x,  1.0*px.y))*0.147308056121;\n    gl_FragColor += texture2D(texture, vUv + vec2( 2.0*px.x,  2.0*px.y))*0.115876621105;\n    gl_FragColor += texture2D(texture, vUv + vec2( 3.0*px.x,  3.0*px.y))*0.0776744219933;\n    gl_FragColor += texture2D(texture, vUv + vec2( 4.0*px.x,  4.0*px.y))*0.0443683338718;\n    gl_FragColor += texture2D(texture, vUv + vec2( 5.0*px.x,  5.0*px.y))*0.0215963866053;\n    gl_FragColor += texture2D(texture, vUv + vec2( 6.0*px.x,  6.0*px.y))*0.00895781211794;\n    gl_FragColor += texture2D(texture, vUv + vec2( 7.0*px.x,  7.0*px.y))*0.0044299121055113265;\n  }\n",ZG="\n  precision highp float;\n  varying vec2 vUv;\n  uniform sampler2D texture;\n  uniform vec2 px;\n  uniform float m[9];\n  void main(void) {\n    vec4 c11 = texture2D(texture, vUv - px); // top left\n    vec4 c12 = texture2D(texture, vec2(vUv.x, vUv.y - px.y)); // top center\n    vec4 c13 = texture2D(texture, vec2(vUv.x + px.x, vUv.y - px.y)); // top right\n    vec4 c21 = texture2D(texture, vec2(vUv.x - px.x, vUv.y) ); // mid left\n    vec4 c22 = texture2D(texture, vUv); // mid center\n    vec4 c23 = texture2D(texture, vec2(vUv.x + px.x, vUv.y) ); // mid right\n    vec4 c31 = texture2D(texture, vec2(vUv.x - px.x, vUv.y + px.y) ); // bottom left\n    vec4 c32 = texture2D(texture, vec2(vUv.x, vUv.y + px.y) ); // bottom center\n    vec4 c33 = texture2D(texture, vUv + px ); // bottom right\n    gl_FragColor = \n    c11 * m[0] + c12 * m[1] + c22 * m[2] +\n    c21 * m[3] + c22 * m[4] + c23 * m[5] +\n    c31 * m[6] + c32 * m[7] + c33 * m[8];\n    gl_FragColor.a = c22.a;\n  }\n",YG=(e,t,n)=>{const r=new RegExp("\\b"+t+" \\w+ (\\w+)","ig");e.replace(r,((e,t)=>(n[t]=0,e)))},JG=class{constructor(e,t,n){s(this,"uniform",{}),s(this,"attribute",{}),s(this,"gl"),s(this,"id"),s(this,"compile",((e,t)=>{const n=this.gl.createShader(t);return n?(this.gl.shaderSource(n,e),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(BG(`filter: gl compile failed: ${this.gl.getShaderInfoLog(n)||"unknown"}`),null)):(BG("filter: could not create shader"),null)})),this.gl=e;const r=this.compile(t,this.gl.VERTEX_SHADER),a=this.compile(n,this.gl.FRAGMENT_SHADER);if(this.id=this.gl.createProgram(),r&&a)if(this.id)if(this.gl.attachShader(this.id,r),this.gl.attachShader(this.id,a),this.gl.linkProgram(this.id),this.gl.getProgramParameter(this.id,this.gl.LINK_STATUS)){this.gl.useProgram(this.id),YG(t,"attribute",this.attribute);for(const e in this.attribute)this.attribute[e]=this.gl.getAttribLocation(this.id,e);YG(t,"uniform",this.uniform),YG(n,"uniform",this.uniform);for(const e in this.uniform)this.uniform[e]=this.gl.getUniformLocation(this.id,e)}else BG(`filter: gl link failed: ${this.gl.getProgramInfoLog(this.id)||"unknown"}`);else BG("filter: could not create webgl program")}};function QG(){let e=0,t=null,n=!1,r=-1,a=[null,null],i=[],s=null,o=null;const l=cq(100,100),u={},d=l.getContext("webgl");if(!d)return void BG("filter: cannot get webgl context");function c(e){return a[e]=a[e]||function(e,t){const n=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,n);const r=d.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,r);const a=d.createTexture();return d.bindTexture(d.TEXTURE_2D,a),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,e,t,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),d.bindTexture(d.TEXTURE_2D,null),d.bindFramebuffer(d.FRAMEBUFFER,null),{fbo:n,texture:a}}(l.width,l.height),a[e]}function h(a=0){if(!o)return;let i=null,s=null,l=!1;i=0===e?t:c(r).texture||null,e++,!n||1&a?(r=(r+1)%2,s=c(r).fbo||null):(s=null,l=e%2==0),d.bindTexture(d.TEXTURE_2D,i),d.bindFramebuffer(d.FRAMEBUFFER,s),d.uniform1f(o.uniform.flipY,l?-1:1),d.drawArrays(d.TRIANGLES,0,6)}function p(e){if(u[e])return o=u[e],d.useProgram((o?o.id:null)||null),o;if(o=new JG(d,HG,e),!o)return BG("filter: could not get webgl program"),null;const t=Float32Array.BYTES_PER_ELEMENT,n=4*t;return d.enableVertexAttribArray(o.attribute.pos),d.vertexAttribPointer(o.attribute.pos,2,d.FLOAT,!1,n,0*t),d.enableVertexAttribArray(o.attribute.uv),d.vertexAttribPointer(o.attribute.uv,2,d.FLOAT,!1,n,2*t),u[e]=o,o}this.gl=d;const m={colorMatrix:e=>{const t=new Float32Array(e);t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255;const n=p(1===t[18]&&0===t[3]&&0===t[8]&&0===t[13]&&0===t[15]&&0===t[16]&&0===t[17]&&0===t[19]?qG:GG);n&&(d.uniform1fv(n.uniform.m,t),h())},brightness:e=>{const t=(e||0)+1;m.colorMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},saturation:e=>{const t=2*(e||0)/3+1,n=-.5*(t-1);m.colorMatrix([t,n,n,0,0,n,t,n,0,0,n,n,t,0,0,0,0,0,1,0])},desaturate:()=>{m.saturation(-1)},contrast:e=>{const t=(e||0)+1,n=-128*(t-1);m.colorMatrix([t,0,0,0,n,0,t,0,0,n,0,0,t,0,n,0,0,0,1,0])},negative:()=>{m.contrast(-2)},hue:e=>{e=(e||0)/180*Math.PI;const t=Math.cos(e),n=Math.sin(e),r=.213,a=.715,i=.072;m.colorMatrix([r+.787*t+n*-r,a+t*-a+n*-a,i+t*-i+.928*n,0,0,r+t*-r+.143*n,a+t*(1-a)+.14*n,i+t*-i+-.283*n,0,0,r+t*-r+-.787*n,a+t*-a+n*a,i+.928*t+n*i,0,0,0,0,0,1,0])},desaturateLuminance:()=>{m.colorMatrix([.2764723,.929708,.0938197,0,-37.1,.2764723,.929708,.0938197,0,-37.1,.2764723,.929708,.0938197,0,-37.1,0,0,0,1,0])},sepia:()=>{m.colorMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0])},brownie:()=>{m.colorMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0])},vintagePinhole:()=>{m.colorMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0])},kodachrome:()=>{m.colorMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0])},technicolor:()=>{m.colorMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0])},polaroid:()=>{m.colorMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0])},shiftToBGR:()=>{m.colorMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])},convolution:e=>{const t=new Float32Array(e),n=1/l.width,r=1/l.height,a=p(ZG);a&&(d.uniform1fv(a.uniform.m,t),d.uniform2f(a.uniform.px,n,r),h())},detectEdges:()=>{m.convolution.call(this,[0,1,0,1,-4,1,0,1,0])},sobelX:()=>{m.convolution.call(this,[-1,0,1,-2,0,2,-1,0,1])},sobelY:()=>{m.convolution.call(this,[-1,-2,-1,0,0,0,1,2,1])},sharpen:e=>{const t=e||1;m.convolution.call(this,[0,-1*t,0,-1*t,1+4*t,-1*t,0,-1*t,0])},emboss:e=>{const t=e||1;m.convolution.call(this,[-2*t,-1*t,0,-1*t,1,1*t,0,1*t,2*t])},blur:e=>{const t=e/7/l.width,n=e/7/l.height,r=p(KG);r&&(d.uniform2f(r.uniform.px,0,n),h(1),d.uniform2f(r.uniform.px,t,0),h())},pixelate:e=>{const t=e/l.width,n=e/l.height,r=p(XG);r&&(d.uniform2f(r.uniform.size,t,n),h())}};this.add=function(e){const t=Array.prototype.slice.call(arguments,1),n=m[e];i.push({func:n,args:t})},this.reset=function(){i=[]},this.get=function(){return i},this.apply=function(r){!function(e,t){if(e!==l.width||t!==l.height){if(l.width=e,l.height=t,!s){const e=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,-1,1,0,0,1,-1,1,1,1,1,1,0]);s=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,s),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)}d.viewport(0,0,l.width,l.height),a=[null,null]}}(r.width,r.height),e=0,t||(t=d.createTexture()),d.bindTexture(d.TEXTURE_2D,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,r);for(let e=0;e<i.length;e++){n=e===i.length-1;const t=i[e];t.func.apply(this,t.args||[])}return l},this.draw=function(e){return this.add("brightness",0),this.apply(e)}}async function eq(e){const t=4===e.shape.length?Tc(e):e,n=wc(t,3,2),r=[nu(n[0]),nu(n[1]),nu(n[2])],a=[tu(n[0]),tu(n[1]),tu(n[2])],i=await Promise.all(a.map((e=>e.data()))),s=Math.max(i[0][0],i[1][0],i[2][0]),o=(s>1?255:1)/s;let l;if(o>1){const e=[Uu(n[0],r[0]),Uu(n[1],r[1]),Uu(n[2],r[2])],i=[Uu(a[0],r[0]),Uu(a[1],r[1]),Uu(a[2],r[2])],s=[yo(e[0],o),yo(e[1],o),yo(e[2],o)],u=_c([s[0],s[1],s[2]],2);l=Go(u,[1,t.shape[0]||0,t.shape[1]||0,3]),to([...e,...i,...s,u])}else l=hu(t,0);return to([...n,...r,...a,n,t,e]),l}var tq,nq,rq,aq,iq=3840,sq=null,oq=null,lq=null,uq={inputSum:0,cacheDiff:1,sumMethod:0,inputTensor:void 0};function dq(){uq.inputSum=0,uq.cacheDiff=1,uq.sumMethod=0,uq.inputTensor=void 0}function cq(e,t){let n;if(mq.browser)if(mq.worker){if("undefined"==typeof OffscreenCanvas)throw new Error("canvas error: attempted to run in web worker but OffscreenCanvas is not supported");n=new OffscreenCanvas(e,t)}else if("undefined"!=typeof document)n=document.createElement("canvas"),n.width=e,n.height=t;else{if("undefined"==typeof navigator||"ReactNative"!==navigator.product)throw new Error("canvas error: attempted to run in browser but DOM is not defined");if(void 0!==mq.Canvas)n=new mq.Canvas(e,t);else{if(void 0===globalThis.Canvas)throw new Error("canvas error: attempted to use canvas in react-native without canvas support installed");n=new globalThis.Canvas(e,t)}}else void 0!==mq.Canvas?n=new mq.Canvas(e,t):void 0!==globalThis.Canvas&&(n=new globalThis.Canvas(e,t));return n}function hq(e,t){const n=t||cq(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),n}async function pq(e,t,n=!0){var r,a,i;if(!e)return t.debug&&BG("input error: input is missing"),{tensor:null,canvas:null};if(!(e instanceof si||"undefined"!=typeof Image&&e instanceof Image||void 0!==globalThis.Canvas&&e instanceof globalThis.Canvas||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLMediaElement&&e instanceof HTMLMediaElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("input error: type not recognized");if(e instanceof si){let n=null;if(e.isDisposedInternal)throw new Error("input error: attempted to use tensor but it is disposed");if(!e.shape)throw new Error("input error: attempted to use tensor without a shape");if(3===e.shape.length){if(3===e.shape[2])n=hu(e,0);else if(4===e.shape[2]){const t=gc(e,[0,0,0],[-1,-1,3]);n=hu(t,0),to(t)}}else 4===e.shape.length&&(3===e.shape[3]?n=js(e):4===e.shape[3]&&(n=yc(e,[0,0,0,0],[-1,-1,-1,3])));if(null==n||4!==n.shape.length||1!==n.shape[0]||3!==n.shape[3])throw new Error(`input error: attempted to use tensor with unrecognized shape: ${e.shape.toString()}`);if("int32"===n.dtype){const e=Vs(n,"float32");to(n),n=e}return{tensor:n,canvas:t.filter.return?oq:null}}if(void 0!==e.readyState&&e.readyState<=2)return t.debug&&BG("input stream is not ready"),{tensor:null,canvas:sq};const s=e.naturalWidth||e.videoWidth||e.width||e.shape&&e.shape[1]>0,o=e.naturalHeight||e.videoHeight||e.height||e.shape&&e.shape[2]>0;if(!s||!o)return t.debug&&BG("cannot determine input dimensions"),{tensor:null,canvas:sq};let l=s,u=o;if(l>iq&&(l=iq,u=Math.trunc(l*o/s)),u>iq&&(u=iq,l=Math.trunc(u*s/o)),((null==(r=t.filter)?void 0:r.width)||0)>0?l=t.filter.width:((null==(a=t.filter)?void 0:a.height)||0)>0&&(l=s*((t.filter.height||0)/o)),(t.filter.height||0)>0?u=t.filter.height:(t.filter.width||0)>0&&(u=o*((t.filter.width||0)/s)),!l||!u)throw new Error("input error: cannot determine dimension");sq&&sq.width===l&&sq.height===u||(sq=cq(l,u));const d=sq.getContext("2d");if("undefined"!=typeof ImageData&&e instanceof ImageData?d.putImageData(e,0,0):t.filter.flip&&void 0!==d.translate?(d.translate(s,0),d.scale(-1,1),d.drawImage(e,0,0,s,o,0,0,sq.width,sq.height),d.setTransform(1,0,0,1,0,0)):d.drawImage(e,0,0,s,o,0,0,sq.width,sq.height),oq&&sq.width===oq.width&&sq.height===oq.height||(oq=cq(sq.width,sq.height)),t.filter.enabled&&mq.webgl.supported?(tq||(tq=mq.browser?new QG:null),mq.filter=!!tq,(null==tq?void 0:tq.add)?(tq.reset(),0!==t.filter.brightness&&tq.add("brightness",t.filter.brightness),0!==t.filter.contrast&&tq.add("contrast",t.filter.contrast),0!==t.filter.sharpness&&tq.add("sharpen",t.filter.sharpness),0!==t.filter.blur&&tq.add("blur",t.filter.blur),0!==t.filter.saturation&&tq.add("saturation",t.filter.saturation),0!==t.filter.hue&&tq.add("hue",t.filter.hue),t.filter.negative&&tq.add("negative"),t.filter.sepia&&tq.add("sepia"),t.filter.vintage&&tq.add("brownie"),t.filter.sepia&&tq.add("sepia"),t.filter.kodachrome&&tq.add("kodachrome"),t.filter.technicolor&&tq.add("technicolor"),t.filter.polaroid&&tq.add("polaroid"),0!==t.filter.pixelate&&tq.add("pixelate",t.filter.pixelate),oq=(null==(i=tq.get())?void 0:i.length)>1?tq.apply(sq):tq.draw(sq)):(t.debug&&BG("input process error: cannot initialize filters"),mq.webgl.supported=!1,t.filter.enabled=!1,hq(sq,oq))):(hq(sq,oq),tq&&(tq=null),mq.filter=!!tq),!n)return{tensor:null,canvas:oq};if(!oq)throw new Error("canvas error: cannot create output");let c,h=3;if("undefined"!=typeof ImageData&&e instanceof ImageData||e.data&&e.width&&e.height)mq.browser&&em?c=em?em.fromPixels(e):null:(h=e.data.length/e.height/e.width,c=Gi(new Uint8Array(e.data.buffer),[e.height,e.width,h],"int32"));else if(lq&&oq.width===lq.width&&oq.height===lq.height||(lq=cq(oq.width,oq.height)),em&&mq.browser)"webgl"===t.backend||"humangl"===t.backend||"webgpu"===t.backend?c=em.fromPixels(oq):(lq=hq(oq),c=em.fromPixels(lq));else{const e=hq(oq).getContext("2d").getImageData(0,0,l,u);h=e.data.length/l/u,c=Gi(new Uint8Array(e.data.buffer),[l,u,h])}if(4===h){const e=gc(c,[0,0,0],[-1,-1,3]);to(c),c=e}if(!c)throw new Error("input error: cannot create tensor");const p=Vs(c,"float32"),m=t.filter.equalization?await eq(p):hu(p,0);if(to([c,p]),t.filter.autoBrightness){const e=tu(m),n=await e.data();t.filter.brightness=n[0]>1?1-n[0]/255:1-n[0],to(e)}return{tensor:m,canvas:t.filter.return?oq:null}}nq=new WeakMap,rq=new WeakMap,aq=new WeakMap;var mq=new class{constructor(){if(s(this,"browser"),s(this,"node"),s(this,"worker"),s(this,"platform",""),s(this,"agent",""),s(this,"backends",[]),s(this,"initial"),s(this,"filter"),s(this,"tfjs"),s(this,"offscreen"),s(this,"perfadd",!1),s(this,"tensorflow",{version:void 0,gpu:void 0}),s(this,"wasm",{supported:void 0,backend:void 0,simd:void 0,multithread:void 0}),s(this,"webgl",{supported:void 0,backend:void 0,version:void 0,renderer:void 0,shader:void 0,vendor:void 0}),s(this,"webgpu",{supported:void 0,backend:void 0,adapter:void 0}),s(this,"cpu",{model:void 0,flags:[]}),s(this,"kernels",[]),u(this,nq,void 0),u(this,rq,void 0),u(this,aq,void 0),this.browser="undefined"!=typeof navigator,this.node="undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node,this.tfjs={version:zG["tfjs-core"]},this.offscreen="undefined"!=typeof OffscreenCanvas,this.initial=!0,this.worker=this.browser&&this.offscreen?"undefined"!=typeof WorkerGlobalScope:void 0,"undefined"!=typeof navigator&&void 0!==navigator.userAgent){const e=navigator.userAgent||"",t=e.match(/\(([^()]+)\)/g);if(null==t?void 0:t[0]){const n=t[0].match(/\(([^()]+)\)/g);this.platform=(null==n?void 0:n[0])?n[0].replace(/\(|\)/g,""):"",this.agent=e.replace(t[0],""),this.platform[1]&&(this.agent=this.agent.replace(t[1],"")),this.agent=this.agent.replace(/  /g," ")}}else"undefined"!=typeof process&&(this.platform=`${process.platform} ${process.arch}`,this.agent=`NodeJS ${process.version}`)}get Canvas(){return l(this,nq)}set Canvas(e){d(this,nq,e),globalThis.Canvas=e}get Image(){return l(this,rq)}set Image(e){d(this,rq,e),globalThis.Image=e}get ImageData(){return l(this,aq)}set ImageData(e){d(this,aq,e),globalThis.ImageData=e}async updateBackend(){this.backends=Object.keys(Ys().registryFactory);try{this.tensorflow={version:ho().binding?ho().binding.TF_Version:void 0,gpu:ho().binding?ho().binding.isUsingGpuDevice():void 0}}catch(e){}this.wasm.supported="undefined"!=typeof WebAssembly,this.wasm.backend=this.backends.includes("wasm"),this.wasm.supported&&this.wasm.backend&&(this.wasm.simd=await Ue().getAsync("WASM_HAS_SIMD_SUPPORT"),this.wasm.multithread=await Ue().getAsync("WASM_HAS_MULTITHREAD_SUPPORT"));const e=cq(100,100),t=e?e.getContext("webgl2"):void 0;this.webgl.supported=void 0!==t,this.webgl.backend=this.backends.includes("webgl"),this.webgl.supported&&this.webgl.backend&&t&&(this.webgl.version=t.getParameter(t.VERSION),this.webgl.vendor=t.getParameter(t.VENDOR),this.webgl.renderer=t.getParameter(t.RENDERER),this.webgl.shader=t.getParameter(t.SHADING_LANGUAGE_VERSION)),this.webgpu.supported=this.browser&&"undefined"!=typeof navigator&&void 0!==navigator.gpu,this.webgpu.backend=this.backends.includes("webgpu");try{if(this.webgpu.supported){const e=await navigator.gpu.requestAdapter();this.webgpu.adapter=await(null==e?void 0:e.requestAdapterInfo())}}catch(e){this.webgpu.supported=!1}try{this.kernels=ya(so()).map((e=>e.kernelName.toLowerCase()))}catch(e){}}updateCPU(){const e={model:"",flags:[]};this.node&&this.platform.startsWith("linux"),this.cpu?this.cpu=e:Object.defineProperty(this,"cpu",{value:e})}},fq={};i(fq,{"affectnet-mobilenet":()=>Cq,age:()=>Eq,"anti-spoofing":()=>oX,antispoof:()=>gq,blazeface:()=>yq,"blazeface-back":()=>Nq,"blazeface-front":()=>Rq,"blazepose-detector":()=>Pq,"blazepose-full":()=>Dq,"blazepose-heavy":()=>Mq,"blazepose-lite":()=>Oq,centernet:()=>bq,default:()=>AX,efficientpose:()=>$q,"efficientpose-i-lite":()=>lX,"efficientpose-ii-lite":()=>uX,"efficientpose-iv":()=>dX,emotion:()=>xq,faceboxes:()=>Fq,facemesh:()=>Aq,"facemesh-attention":()=>zq,"facemesh-attention-pinto":()=>Lq,"facemesh-detection-full":()=>Bq,"facemesh-detection-short":()=>Uq,faceres:()=>vq,"faceres-deep":()=>Wq,gear:()=>Hq,"gear-e1":()=>Vq,"gear-e2":()=>jq,gender:()=>qq,"gender-ssrnet-imdb":()=>Gq,handdetect:()=>Xq,"handlandmark-full":()=>Kq,"handlandmark-lite":()=>wq,"handlandmark-sparse":()=>Zq,handskeleton:()=>Yq,handtrack:()=>kq,"insightface-efficientnet-b0":()=>cX,"insightface-ghostnet-strides1":()=>hX,"insightface-ghostnet-strides2":()=>pX,"insightface-mobilenet-emore":()=>mX,"insightface-mobilenet-swish":()=>fX,iris:()=>Sq,liveness:()=>Tq,meet:()=>Jq,mobileface:()=>Qq,mobilefacenet:()=>eX,models:()=>_q,"movenet-lightning":()=>Iq,"movenet-multipose":()=>tX,"movenet-thunder":()=>nX,nanodet:()=>rX,"nanodet-e":()=>gX,"nanodet-g":()=>yX,"nanodet-m":()=>bX,"nanodet-t":()=>xX,posenet:()=>aX,rvm:()=>iX,selfie:()=>sX});var gq=853098,yq=538928,bq=4030290,xq=820516,Aq=1477958,vq=6978814,wq=2023432,kq=2964837,Sq=2599092,Tq=592976,_q=0,Iq=4650216,Cq=6920630,Eq=161240,Nq=538928,Rq=402048,Pq=5928856,Dq=6339202,Mq=27502466,Oq=2726402,$q=5651240,Fq=2013002,Lq=2387598,zq=2382414,Bq=1026192,Uq=201268,Wq=13957620,Vq=112438,jq=112438,Hq=1498916,Gq=161236,qq=201808,Xq=3515612,Kq=5431368,Zq=5286322,Yq=5502280,Jq=372228,Qq=2183192,eX=5171976,tX=9448838,nX=12477112,rX=7574558,aX=5032780,iX=3739355,sX=212886,oX=853098,lX=2269064,uX=5651240,dX=25643252,cX=13013224,hX=8093408,pX=8049584,mX=6938536,fX=12168584,gX=12319156,yX=7574558,bX=1887474,xX=5294216,AX={antispoof:gq,blazeface:yq,centernet:bq,emotion:xq,facemesh:Aq,faceres:vq,"handlandmark-lite":wq,handtrack:kq,iris:Sq,liveness:Tq,models:_q,"movenet-lightning":Iq,"affectnet-mobilenet":Cq,age:Eq,"blazeface-back":Nq,"blazeface-front":Rq,"blazepose-detector":Pq,"blazepose-full":Dq,"blazepose-heavy":Mq,"blazepose-lite":Oq,efficientpose:$q,faceboxes:Fq,"facemesh-attention-pinto":Lq,"facemesh-attention":zq,"facemesh-detection-full":Bq,"facemesh-detection-short":Uq,"faceres-deep":Wq,"gear-e1":Vq,"gear-e2":jq,gear:Hq,"gender-ssrnet-imdb":Gq,gender:qq,handdetect:Xq,"handlandmark-full":Kq,"handlandmark-sparse":Zq,handskeleton:Yq,meet:Jq,mobileface:Qq,mobilefacenet:eX,"movenet-multipose":tX,"movenet-thunder":nX,nanodet:rX,posenet:aX,rvm:iX,selfie:sX,"anti-spoofing":oX,"efficientpose-i-lite":lX,"efficientpose-ii-lite":uX,"efficientpose-iv":dX,"insightface-efficientnet-b0":cX,"insightface-ghostnet-strides1":hX,"insightface-ghostnet-strides2":pX,"insightface-mobilenet-emore":mX,"insightface-mobilenet-swish":fX,"nanodet-e":gX,"nanodet-g":yX,"nanodet-m":bX,"nanodet-t":xX},vX={cacheModels:!0,cacheSupported:!0,verbose:!0,debug:!1,modelBasePath:""},wX={};async function kX(e){var t,n,r,a;let i=function(e,t){const n=e.endsWith("/")?"":"/",r=t.startsWith(".")||t.startsWith("/")||t.startsWith("http:")||t.startsWith("https:")||t.startsWith("file:")?`${t}`:`${e}${n}${t}`;if(!r.toLocaleLowerCase().includes(".json"))throw new Error(`modelpath error: expecting json file: ${r}`);return r}(vX.modelBasePath,e||"");i.toLowerCase().endsWith(".json")||(i+=".json");const s=i.includes("/")?i.split("/"):i.split("\\"),o=s[s.length-1].replace(".json",""),l="indexeddb://"+o;wX[o]={name:o,sizeFromManifest:0,sizeLoadedWeights:0,sizeDesired:fq[o],inCache:!1,url:""},vX.cacheSupported="undefined"!=typeof indexedDB;let u={};try{u=vX.cacheSupported&&vX.cacheModels?await Np.listModels():{}}catch(e){vX.cacheSupported=!1}wX[o].inCache=vX.cacheSupported&&vX.cacheModels&&Object.keys(u).includes(l),wX[o].url=wX[o].inCache?l:i;const d="undefined"==typeof fetch?{}:{fetchFunc:(e,t)=>async function(e,t){return vX.debug&&BG("load model fetch:",e,t),fetch(e,t)}(e,t)};let c=new _y(wX[o].url,d),h=!1;try{c.findIOHandler(),vX.debug&&BG("model load handler:",c.handler)}catch(e){BG("error finding model i/o handler:",i,e)}try{const e=await(null==(t=c.handler)?void 0:t.load())||null;wX[o].sizeFromManifest=(null==(n=null==e?void 0:e.weightData)?void 0:n.byteLength)||0,e?c.loadSync(e):c=await Iy(wX[o].inCache?l:i,d),wX[o].sizeLoadedWeights=(null==(a=null==(r=c.artifacts)?void 0:r.weightData)?void 0:a.byteLength)||0,vX.verbose&&BG("load:",{model:o,url:c.modelUrl,bytes:wX[o].sizeLoadedWeights}),h=!0}catch(e){BG("error loading model:",i,e)}if(h&&vX.cacheModels&&vX.cacheSupported&&!wX[o].inCache)try{const e=await c.save(l);vX.debug&&BG("model saved:",l,e)}catch(e){BG("error saving model:",i,e)}return c}var SX="3.0.7",TX={name:"humangl",priority:999,canvas:null,gl:null,extensions:[],webGLattr:{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!1,desynchronized:!0}};var _X={tf255:255,tf1:1,tf2:2,tf05:.5,tf127:127.5,rgb:[.2989,.587,.114]},IX={};async function CX(e,t=!1){var n,r;if(e.state="backend",0===(null==(n=e.config.backend)?void 0:n.length)&&(e.config.backend=await async function(){var e;return await mq.updateBackend(),(null==(e=mq.tensorflow)?void 0:e.version)?"tensorflow":mq.webgpu.supported&&mq.webgpu.backend?"webgpu":mq.webgl.supported&&mq.webgl.backend?"webgl":mq.wasm.supported&&mq.wasm.backend?"wasm":"cpu"}()),t||mq.initial||e.config.backend&&e.config.backend.length>0&&so()!==e.config.backend){const t=UG();if(e.config.backend&&e.config.backend.length>0){"undefined"==typeof window&&"undefined"!=typeof WorkerGlobalScope&&e.config.debug&&e.config.debug&&BG("running inside web worker"),"undefined"!=typeof navigator&&(null==(r=null==navigator?void 0:navigator.userAgent)?void 0:r.toLowerCase().includes("electron"))&&e.config.debug&&BG("running inside electron");let t=Object.keys(Ys().registryFactory);if("humangl"!==e.config.backend||t.includes("humangl")||(function(e){var t;if("humangl"===e.config.backend&&(TX.name in Ys().registry&&!(null==(t=null==TX?void 0:TX.gl)?void 0:t.getParameter(TX.gl.VERSION))&&(BG("humangl error: backend invalid context"),e.models.reset()),!lo(TX.name))){try{TX.canvas=cq(100,100)}catch(e){return void BG("humangl error: cannot create canvas:",e)}try{if(TX.gl=TX.canvas.getContext("webgl2",TX.webGLattr),!TX.gl)return void BG("humangl error: cannot get webgl context");if(!TX.gl.getParameter(TX.gl.VERSION).includes("2.0"))return BG("backend override: using fallback webgl backend as webgl 2.0 is not detected"),void(e.config.backend="webgl");TX.canvas&&(TX.canvas.addEventListener("webglcontextlost",(t=>{throw BG("humangl error:",t.type),BG("possible browser memory leak using webgl or conflict with multiple backend registrations"),e.emit("error"),new Error("backend error: webgl context lost")})),TX.canvas.addEventListener("webglcontextrestored",(e=>{BG("humangl error: context restored:",e)})),TX.canvas.addEventListener("webglcontextcreationerror",(e=>{BG("humangl error: context create:",e)})))}catch(e){return void BG("humangl error: cannot get webgl context:",e)}try{yS(2,TX.gl)}catch(e){return void BG("humangl error: cannot set webgl context:",e)}try{const e=new f_(TX.gl);co(TX.name,(()=>new OI(e)),TX.priority)}catch(e){return void BG("humangl error: cannot register webgl backend:",e)}try{ya("webgl").forEach((e=>{ba({...e,backendName:TX.name})}))}catch(e){return void BG("humangl error: cannot update webgl backend registration:",e)}try{Ue().flagRegistry.WEBGL_VERSION&&Ue().set("WEBGL_VERSION",2)}catch(e){return void BG("humangl error: cannot set WebGL backend flags:",e)}!function(){const e=TX.gl;e&&(TX.extensions=e.getSupportedExtensions())}();const t=ho(),n=void 0!==t.gpgpu?t.getGPGPUContext().gl:null;n?e.config.debug&&BG("humangl backend registered:",{webgl:n.getParameter(n.VERSION),renderer:n.getParameter(n.RENDERER)}):BG("humangl error: no current gl context:",n,TX.gl)}}(e),t=Object.keys(Ys().registryFactory)),e.config.debug&&BG("available backends:",t),mq.browser&&!mq.node&&"tensorflow"===e.config.backend&&t.includes("webgl")&&(e.config.debug&&BG("override: backend set to tensorflow while running in browser"),e.config.backend="webgl"),!mq.node||mq.browser||"webgl"!==e.config.backend&&"humangl"!==e.config.backend||!t.includes("tensorflow")||(e.config.debug&&BG(`override: backend set to ${e.config.backend} while running in nodejs`),e.config.backend="tensorflow"),mq.browser&&"webgpu"===e.config.backend)if("undefined"==typeof navigator||void 0===navigator.gpu)BG("override: backend set to webgpu but browser does not support webgpu"),e.config.backend="webgl";else{const t=await navigator.gpu.requestAdapter();e.config.debug&&BG("enumerated webgpu adapter:",t),t?BG("webgpu adapter info:","requestAdapterInfo"in t?await t.requestAdapterInfo():void 0):(BG("override: backend set to webgpu but browser reports no available gpu"),e.config.backend="webgl")}if(t.includes(e.config.backend)||(BG(`error: backend ${e.config.backend} not found in registry`),e.config.backend=mq.node?"tensorflow":"webgl",e.config.debug&&BG(`override: setting backend ${e.config.backend}`)),e.config.debug&&BG("setting backend:",[e.config.backend]),"wasm"===e.config.backend){if(Ue().flagRegistry.CANVAS2D_WILL_READ_FREQUENTLY&&Ue().set("CANVAS2D_WILL_READ_FREQUENTLY",!0),e.config.debug&&BG("wasm path:",e.config.wasmPath),void 0===CL)throw new Error("backend error: attempting to use wasm backend but wasm path is not set");CL(e.config.wasmPath,e.config.wasmPlatformFetch);let t=!1,n=!1;try{t=await Ue().getAsync("WASM_HAS_MULTITHREAD_SUPPORT"),n=await Ue().getAsync("WASM_HAS_SIMD_SUPPORT"),e.config.debug&&BG(`wasm execution: ${n?"simd":"no simd"} ${t?"multithreaded":"singlethreaded"}`),e.config.debug&&!n&&BG("warning: wasm simd support is not enabled")}catch(e){BG("wasm detection failed")}}try{await ao(e.config.backend),await io()}catch(t){return BG("error: cannot set backend:",e.config.backend,t),!1}e.config.debug&&(IX=JSON.parse(JSON.stringify(Ue().flags)))}if("humangl"!==so()&&"webgl"!==so()||(Ue().flagRegistry.WEBGL_USE_SHAPES_UNIFORMS&&Ue().set("WEBGL_USE_SHAPES_UNIFORMS",!0),Ue().flagRegistry.WEBGL_EXP_CONV&&Ue().set("WEBGL_EXP_CONV",!0),e.config.debug&&void 0!==e.config.deallocate&&e.config.deallocate&&(BG("changing webgl: WEBGL_DELETE_TEXTURE_THRESHOLD:",!0),Ue().set("WEBGL_DELETE_TEXTURE_THRESHOLD",0))),so(),e.config.debug){const t=Ue().flags,n={};for(const e of Object.keys(t))IX[e]!==t[e]&&(n[e]=t[e]);e.config.debug&&Object.keys(n).length>0&&BG("backend:",so(),"flags:",n)}if(e.config.flags&&Object.keys(e.config.flags).length>0){e.config.debug&&BG("flags:",e.config.flags);for(const[t,n]of Object.entries(e.config.flags))Ue().set(t,n)}Gs(),_X.tf255=au(255,"float32"),_X.tf1=au(1,"float32"),_X.tf2=au(2,"float32"),_X.tf05=au(.5,"float32"),_X.tf127=au(127.5,"float32"),_X.rgb=Nc([.2989,.587,.114],"float32"),e.performance.initBackend=Math.trunc(UG()-t),e.config.backend=so(),await mq.updateBackend(),function(e){const t=[];mq.kernels.includes("mod")||(ba({kernelName:"Mod",backendName:so(),kernelFunc:e=>eo((()=>Uu(e.inputs.a,yo(go(e.inputs.a,e.inputs.b),e.inputs.b))))}),mq.kernels.push("mod"),t.push("mod")),mq.kernels.includes("floormod")||(ba({kernelName:"FloorMod",backendName:so(),kernelFunc:e=>eo((()=>mo(yo(fo(e.inputs.a,e.inputs.b),e.inputs.b),od(e.inputs.a,e.inputs.b))))}),mq.kernels.push("floormod"),t.push("floormod")),!mq.kernels.includes("rotatewithoffset")&&e.softwareKernels&&(ba({kernelName:"RotateWithOffset",backendName:so(),kernelFunc:e=>eo((()=>{const t=so();ao("cpu");const n=hp.rotateWithOffset(e.inputs.image,e.attrs.radians,e.attrs.fillValue,e.attrs.center);return ao(t),n}))}),mq.kernels.push("rotatewithoffset"),t.push("rotatewithoffset")),t.length>0&&e.debug&&BG("registered kernels:",t)}(e.config)}return!0}function EX(e,t){for(const n of e)ba({kernelName:n,backendName:t.backend,kernelFunc:e=>{var r;return t.debug&&BG("kernelFunc",n,t.backend,e),null==(r=null==e?void 0:e.inputs)?void 0:r.info}});mq.kernels=ya(so()).map((e=>e.kernelName.toLowerCase()))}var NX={};i(NX,{all:()=>yK,body:()=>uK,canvas:()=>gK,face:()=>lK,gesture:()=>hK,hand:()=>dK,init:()=>bK,object:()=>cK,options:()=>UX,person:()=>fK});var RX=e=>{if(e)if(e.getContext){const t=e.getContext("2d",{willReadFrequently:!0});if(t)return t;BG("draw error: cannot get canvas context")}else BG("draw error: canvas context not defined");else BG("draw error: invalid canvas");return null},PX=e=>Math.round(180*e/Math.PI),DX=(e,t,n)=>e.replace(t,"number"==typeof n?n.toFixed(1):n),MX=(e,t)=>{if(!t.useDepth||void 0===e)return t.color;const n=Uint8ClampedArray.from([127+2*e,127-2*e,255]);return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t.alpha})`};function OX(e,t,n,r,a){const i=t.replace(/\[.*\]/g,"").split("\n").map((e=>e.trim())),s=Math.max(0,n);for(let t=i.length-1;t>=0;t--){const n=t*a.lineHeight+r;a.shadowColor&&""!==a.shadowColor&&(e.fillStyle=a.shadowColor,e.fillText(i[t],s+5,n+16)),e.fillStyle=a.labelColor,e.fillText(i[t],s+4,n+15)}}function $X(e,t,n,r,a){e.fillStyle=MX(r,a),e.beginPath(),e.arc(t,n,a.pointSize,0,2*Math.PI),e.fill()}function FX(e,t,n,r,a,i){if(e.beginPath(),e.lineWidth=i.lineWidth,i.useCurves){const i=(t+t+r)/2,s=(n+n+a)/2;e.ellipse(i,s,r/2,a/2,0,0,2*Math.PI)}else e.moveTo(t+i.roundRect,n),e.lineTo(t+r-i.roundRect,n),e.quadraticCurveTo(t+r,n,t+r,n+i.roundRect),e.lineTo(t+r,n+a-i.roundRect),e.quadraticCurveTo(t+r,n+a,t+r-i.roundRect,n+a),e.lineTo(t+i.roundRect,n+a),e.quadraticCurveTo(t,n+a,t,n+a-i.roundRect),e.lineTo(t,n+i.roundRect),e.quadraticCurveTo(t,n,t+i.roundRect,n),e.closePath();e.stroke()}function LX(e,t,n){if(!(t.length<2)){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(const r of t)e.strokeStyle=MX(r[2]||0,n),e.lineTo(Math.trunc(r[0]),Math.trunc(r[1]));e.stroke(),n.fillPolygons&&(e.closePath(),e.fill())}}function zX(e,t,n){if(!(t.length<2))if(e.lineWidth=n.lineWidth,!n.useCurves||t.length<=2)LX(e,t,n);else{e.moveTo(t[0][0],t[0][1]);for(let n=0;n<t.length-2;n++){const r=(t[n][0]+t[n+1][0])/2,a=(t[n][1]+t[n+1][1])/2;e.quadraticCurveTo(t[n][0],t[n][1],r,a)}e.quadraticCurveTo(t[t.length-2][0],t[t.length-2][1],t[t.length-1][0],t[t.length-1][1]),e.stroke(),n.fillPolygons&&(e.closePath(),e.fill())}}function BX(e,t,n,r=5){let a,i,s;e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1]),a=Math.atan2(n[1]-t[1],n[0]-t[0]),i=r*Math.cos(a)+n[0],s=r*Math.sin(a)+n[1],e.moveTo(i,s),a+=1/3*(2*Math.PI),i=r*Math.cos(a)+n[0],s=r*Math.sin(a)+n[1],e.lineTo(i,s),a+=1/3*(2*Math.PI),i=r*Math.cos(a)+n[0],s=r*Math.sin(a)+n[1],e.lineTo(i,s),e.closePath(),e.stroke(),e.fill()}var UX={color:"rgba(173, 216, 230, 0.6)",labelColor:"rgba(173, 216, 230, 1)",shadowColor:"black",alpha:.5,font:'small-caps 16px "Segoe UI"',lineHeight:18,lineWidth:4,pointSize:2,roundRect:8,drawPoints:!1,drawLabels:!0,drawBoxes:!0,drawAttention:!0,drawGestures:!0,drawPolygons:!0,drawGaze:!0,fillPolygons:!1,useDepth:!0,useCurves:!1,faceLabels:"",bodyLabels:"",bodyPartLabels:"",objectLabels:"",handLabels:"",fingerLabels:"",gestureLabels:""},WX={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[185,40,39,37,0,267,269,270,409],lipsLowerOuter:[61,146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[191,80,81,82,13,312,311,310,415],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],lipsLowerSemiOuter:[76,77,90,180,85,16,315,404,320,307,306],lipsUpperSemiOuter:[184,74,73,72,11,302,303,304,408],lipsLowerSemiInner:[62,96,89,179,86,15,316,403,319,325,292],lipsUpperSemiInner:[183,42,41,38,12,268,271,272,407],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],rightEyeIris:[473,474,475,476,477],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],leftEyeIris:[468,469,470,471,472],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]},VX={count:468,mouth:13,symmetryLine:[13,WX.midwayBetweenEyes[0]]},jX={leftEye:0,rightEye:1,nose:2,mouth:3,leftEar:4,rightEar:5,symmetryLine:[3,2]},HX=[{key:"EyeUpper0",indices:[9,10,11,12,13,14,15]},{key:"EyeUpper1",indices:[25,26,27,28,29,30,31]},{key:"EyeUpper2",indices:[41,42,43,44,45,46,47]},{key:"EyeLower0",indices:[0,1,2,3,4,5,6,7,8]},{key:"EyeLower1",indices:[16,17,18,19,20,21,22,23,24]},{key:"EyeLower2",indices:[32,33,34,35,36,37,38,39,40]},{key:"EyeLower3",indices:[54,55,56,57,58,59,60,61,62]},{key:"EyebrowUpper",indices:[63,64,65,66,67,68,69,70]},{key:"EyebrowLower",indices:[48,49,50,51,52,53]}],GX=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],qX=[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255];function XX(e){const t=e.map((e=>e[0]));return t.push(e[e.length-1][1]),t}function KX(e){const t=e.map((e=>e[0]));return t.push(e[e.length-1][1]),t}[127,234,132,58,172,150,149,148,152,377,378,379,397,288,361,454,356,70,63,105,66,107,336,296,334,293,300,168,6,195,4,98,97,2,326,327,33,160,158,133,153,144,362,385,387,263,373,380,57,40,37,0,267,270,287,321,314,17,84,91,78,81,13,311,308,402,14,178].map((e=>GX[e])),[33,133,362,263,1,62,308,159,145,386,374,6,102,331,2,13,14,70,105,107,336,334,300,54,10,284,50,280,234,454,58,288,152].map((e=>GX[e])),[33,133,362,263,1,78,308].map((e=>GX[e])),XX([[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]]),XX([[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]]),XX([[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]]),XX([[474,475],[475,476],[476,477],[477,474]]),XX([[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]]),XX([[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]]),XX([[469,470],[470,471],[471,472],[472,469]]),XX([[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]]);var ZX,YX={lips:KX([[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]]),leftEye:KX([[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]]),leftEyebrow:KX([[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]]),leftIris:KX([[474,475],[475,476],[476,477],[477,474]]),rightEye:KX([[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]]),rightEyebrow:KX([[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]]),rightIris:KX([[469,470],[470,471],[471,472],[472,469]]),faceOval:KX([[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]])},JX=Object.entries(YX).map((([e,t])=>t.map((t=>[t,e])))).flat(),QX=(new Map(JX),[61,146,91,181,84,17,314,405,321,375,291,185,40,39,37,0,267,269,270,409,78,95,88,178,87,14,317,402,318,324,308,191,80,81,82,13,312,311,310,415,76,77,90,180,85,16,315,404,320,307,306,184,74,73,72,11,302,303,304,408,62,96,89,179,86,15,316,403,319,325,292,183,42,41,38,12,268,271,272,407]),eK=[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173,130,25,110,24,23,22,26,112,243,247,30,29,27,28,56,190,226,31,228,229,230,231,232,233,244,113,225,224,223,222,221,189,35,124,46,53,52,65,143,111,117,118,119,120,121,128,245,156,70,63,105,66,107,55,193],tK=[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398,359,255,339,254,253,252,256,341,463,467,260,259,257,258,286,414,446,261,448,449,450,451,452,453,464,342,445,444,443,442,441,413,265,353,276,283,282,295,372,340,346,347,348,349,350,357,465,383,300,293,334,296,336,285,417];function nK(e,t){var n,r,a,i,s,o,l,u,d;if(!ZX.drawLabels||0===(null==(n=ZX.faceLabels)?void 0:n.length))return;let c=ZX.faceLabels.slice();if(c=DX(c,"[id]",e.id.toFixed(0)),e.score&&(c=DX(c,"[score]",100*e.score)),e.gender&&(c=DX(c,"[gender]",e.gender)),e.genderScore&&(c=DX(c,"[genderScore]",100*e.genderScore)),e.age&&(c=DX(c,"[age]",e.age)),e.distance&&(c=DX(c,"[distance]",100*e.distance)),e.real&&(c=DX(c,"[real]",100*e.real)),e.live&&(c=DX(c,"[live]",100*e.live)),e.emotion&&e.emotion.length>0){const t=e.emotion.map((e=>`${Math.trunc(100*e.score)}% ${e.emotion}`));t.length>3&&(t.length=3),c=DX(c,"[emotions]",t.join(" "))}(null==(a=null==(r=e.rotation)?void 0:r.angle)?void 0:a.roll)&&(c=DX(c,"[roll]",PX(e.rotation.angle.roll))),(null==(s=null==(i=e.rotation)?void 0:i.angle)?void 0:s.yaw)&&(c=DX(c,"[yaw]",PX(e.rotation.angle.yaw))),(null==(l=null==(o=e.rotation)?void 0:o.angle)?void 0:l.pitch)&&(c=DX(c,"[pitch]",PX(e.rotation.angle.pitch))),(null==(d=null==(u=e.rotation)?void 0:u.gaze)?void 0:d.bearing)&&(c=DX(c,"[gaze]",PX(e.rotation.gaze.bearing))),OX(t,c,e.box[0],e.box[1],ZX)}function rK(e,t){var n;if(ZX.drawGaze&&(null==(n=e.rotation)?void 0:n.angle)&&"undefined"!=typeof Path2D){t.strokeStyle="pink";const n=e.box[0]+e.box[2]/2-e.box[3]*PX(e.rotation.angle.yaw)/90,r=e.box[1]+e.box[3]/2+e.box[2]*PX(e.rotation.angle.pitch)/90,a=new Path2D(`\n      M ${e.box[0]+e.box[2]/2} ${e.box[1]}\n      C\n        ${n} ${e.box[1]},\n        ${n} ${e.box[1]+e.box[3]},\n        ${e.box[0]+e.box[2]/2} ${e.box[1]+e.box[3]}\n    `),i=new Path2D(`\n      M ${e.box[0]} ${e.box[1]+e.box[3]/2}\n      C \n        ${e.box[0]} ${r},\n        ${e.box[0]+e.box[2]} ${r},\n        ${e.box[0]+e.box[2]} ${e.box[1]+e.box[3]/2}\n    `);t.stroke(i),t.stroke(a)}}function aK(e,t){var n;if(ZX.drawGaze&&(null==(n=e.rotation)?void 0:n.gaze.strength)&&e.rotation.gaze.bearing&&e.annotations.leftEyeIris&&e.annotations.rightEyeIris&&e.annotations.leftEyeIris[0]&&e.annotations.rightEyeIris[0]){t.strokeStyle="pink",t.fillStyle="pink";const n=[e.annotations.leftEyeIris[0][0]+Math.sin(e.rotation.gaze.bearing)*e.rotation.gaze.strength*e.box[3],e.annotations.leftEyeIris[0][1]+Math.cos(e.rotation.gaze.bearing)*e.rotation.gaze.strength*e.box[2]];BX(t,[e.annotations.leftEyeIris[0][0],e.annotations.leftEyeIris[0][1]],[n[0],n[1]],4);const r=[e.annotations.rightEyeIris[0][0]+Math.sin(e.rotation.gaze.bearing)*e.rotation.gaze.strength*e.box[3],e.annotations.rightEyeIris[0][1]+Math.cos(e.rotation.gaze.bearing)*e.rotation.gaze.strength*e.box[2]];BX(t,[e.annotations.rightEyeIris[0][0],e.annotations.rightEyeIris[0][1]],[r[0],r[1]],4)}}function iK(e,t){if(ZX.drawPolygons&&e.mesh.length>=468){t.lineWidth=1;for(let n=0;n<qX.length/3;n++)LX(t,[qX[3*n+0],qX[3*n+1],qX[3*n+2]].map((t=>e.mesh[t])),ZX);!function(e,t){var n,r,a,i;if((null==(n=e.annotations)?void 0:n.leftEyeIris)&&(null==(r=e.annotations)?void 0:r.leftEyeIris[0])){t.strokeStyle=ZX.useDepth?"rgba(255, 200, 255, 0.3)":ZX.color,t.beginPath();const n=Math.abs(e.annotations.leftEyeIris[3][0]-e.annotations.leftEyeIris[1][0])/2,r=Math.abs(e.annotations.leftEyeIris[4][1]-e.annotations.leftEyeIris[2][1])/2;t.ellipse(e.annotations.leftEyeIris[0][0],e.annotations.leftEyeIris[0][1],n,r,0,0,2*Math.PI),t.stroke(),ZX.fillPolygons&&(t.fillStyle=ZX.useDepth?"rgba(255, 255, 200, 0.3)":ZX.color,t.fill())}if((null==(a=e.annotations)?void 0:a.rightEyeIris)&&(null==(i=e.annotations)?void 0:i.rightEyeIris[0])){t.strokeStyle=ZX.useDepth?"rgba(255, 200, 255, 0.3)":ZX.color,t.beginPath();const n=Math.abs(e.annotations.rightEyeIris[3][0]-e.annotations.rightEyeIris[1][0])/2,r=Math.abs(e.annotations.rightEyeIris[4][1]-e.annotations.rightEyeIris[2][1])/2;t.ellipse(e.annotations.rightEyeIris[0][0],e.annotations.rightEyeIris[0][1],n,r,0,0,2*Math.PI),t.stroke(),ZX.fillPolygons&&(t.fillStyle=ZX.useDepth?"rgba(255, 255, 200, 0.3)":ZX.color,t.fill())}}(e,t)}}function sK(e,t){if(ZX.drawPoints)if((null==e?void 0:e.mesh.length)>=468)for(let n=0;n<e.mesh.length;n++)$X(t,e.mesh[n][0],e.mesh[n][1],e.mesh[n][2],ZX),ZX.drawAttention&&(QX.includes(n)&&$X(t,e.mesh[n][0],e.mesh[n][1],e.mesh[n][2]+127,ZX),eK.includes(n)&&$X(t,e.mesh[n][0],e.mesh[n][1],e.mesh[n][2]-127,ZX),tK.includes(n)&&$X(t,e.mesh[n][0],e.mesh[n][1],e.mesh[n][2]-127,ZX));else for(const[n,r]of Object.entries((null==e?void 0:e.annotations)||{})){if(!(null==r?void 0:r[0]))continue;const e=r[0];$X(t,e[0],e[1],0,ZX),ZX.drawLabels&&OX(t,n,e[0],e[1],ZX)}}function oK(e,t){ZX.drawBoxes&&FX(t,e.box[0],e.box[1],e.box[2],e.box[3],ZX)}function lK(e,t,n){if(ZX=VG(UX,n),!t||!e)return;const r=RX(e);if(r){r.font=ZX.font,r.strokeStyle=ZX.color,r.fillStyle=ZX.color;for(const e of t)oK(e,r),nK(e,r),e.mesh&&e.mesh.length>0&&(sK(e,r),iK(e,r),rK(e,r),aK(e,r))}}function uK(e,t,n){var r,a;const i=VG(UX,n);if(!t||!e)return;const s=RX(e);if(s){s.lineJoin="round";for(let e=0;e<t.length;e++){if(s.strokeStyle=i.color,s.fillStyle=i.color,s.lineWidth=i.lineWidth,s.font=i.font,i.drawBoxes&&t[e].box&&4===t[e].box.length&&(FX(s,t[e].box[0],t[e].box[1],t[e].box[2],t[e].box[3],i),i.drawLabels&&(null==(r=i.bodyLabels)?void 0:r.length)>0)){let n=i.bodyLabels.slice();n=DX(n,"[id]",t[e].id.toFixed(0)),n=DX(n,"[score]",100*t[e].score),OX(s,n,t[e].box[0],t[e].box[1],i)}if(i.drawPoints&&t[e].keypoints)for(let n=0;n<t[e].keypoints.length;n++)t[e].keypoints[n].score&&0!==t[e].keypoints[n].score&&(s.fillStyle=MX(t[e].keypoints[n].position[2],i),$X(s,t[e].keypoints[n].position[0],t[e].keypoints[n].position[1],0,i));if(i.drawLabels&&(null==(a=i.bodyPartLabels)?void 0:a.length)>0&&t[e].keypoints){s.font=i.font;for(const n of t[e].keypoints){if(!n.score||0===n.score)continue;let e=i.bodyPartLabels.slice();e=DX(e,"[label]",n.part),e=DX(e,"[score]",100*n.score),OX(s,e,n.position[0],n.position[1],i)}}if(i.drawPolygons&&t[e].keypoints&&t[e].annotations)for(const n of Object.values(t[e].annotations))for(const e of n)zX(s,e,i)}}}function dK(e,t,n){var r,a;const i=VG(UX,n);if(!t||!e)return;const s=RX(e);if(s){s.lineJoin="round",s.font=i.font;for(const e of t){if(i.drawBoxes){if(s.strokeStyle=i.color,s.fillStyle=i.color,FX(s,e.box[0],e.box[1],e.box[2],e.box[3],i),i.drawLabels&&(null==(r=i.handLabels)?void 0:r.length)>0){let t=i.handLabels.slice();t=DX(t,"[id]",e.id.toFixed(0)),t=DX(t,"[label]",e.label),t=DX(t,"[score]",100*e.score),OX(s,t,e.box[0],e.box[1],i)}s.stroke()}if(i.drawPoints&&e.keypoints&&e.keypoints.length>0)for(const t of e.keypoints)s.fillStyle=MX(t[2],i),$X(s,t[0],t[1],0,i);if(i.drawLabels&&e.annotations&&(null==(a=i.fingerLabels)?void 0:a.length)>0)for(const[t,n]of Object.entries(e.annotations)){let e=i.fingerLabels.slice();e=DX(e,"[label]",t),OX(s,e,n[n.length-1][0],n[n.length-1][1],i)}if(i.drawPolygons&&e.annotations){const t=e=>{if(e&&0!==e.length&&e[0])for(let t=0;t<e.length;t++){s.beginPath();const n=e[t][2]||0;s.strokeStyle=MX(t*n,i),s.moveTo(e[t>0?t-1:0][0],e[t>0?t-1:0][1]),s.lineTo(e[t][0],e[t][1]),s.stroke()}};s.lineWidth=i.lineWidth,t(e.annotations.index),t(e.annotations.middle),t(e.annotations.ring),t(e.annotations.pinky),t(e.annotations.thumb)}}}}function cK(e,t,n){var r;const a=VG(UX,n);if(!t||!e)return;const i=RX(e);if(i){i.lineJoin="round",i.font=a.font;for(const e of t)if(a.drawBoxes){if(i.strokeStyle=a.color,i.fillStyle=a.color,FX(i,e.box[0],e.box[1],e.box[2],e.box[3],a),a.drawLabels&&(null==(r=a.objectLabels)?void 0:r.length)>0){let t=a.objectLabels.slice();t=DX(t,"[id]",e.id.toFixed(0)),t=DX(t,"[label]",e.label),t=DX(t,"[score]",100*e.score),OX(i,t,e.box[0],e.box[1],a)}i.stroke()}}}function hK(e,t,n){var r;const a=VG(UX,n);if(t&&e&&a.drawGestures&&(null==(r=a.gestureLabels)?void 0:r.length)>0){const n=RX(e);if(!n)return;n.font=a.font,n.fillStyle=a.color;let r=1;for(let e=0;e<t.length;e++){const[i,s]=Object.entries(t[e]);if(s.length>1&&s[1].length>0){const e=i[1]>0?`#${i[1]}`:"";let t=a.gestureLabels.slice();t=DX(t,"[where]",i[0]),t=DX(t,"[who]",e),t=DX(t,"[what]",s[1]),OX(n,t,8,2+r*a.lineHeight,a),r+=1}}}}var pK={face:"face\n    confidence: [score]%\n    [gender] [genderScore]%\n    age: [age] years\n    distance: [distance]cm\n    real: [real]%\n    live: [live]%\n    [emotions]\n    roll: [roll]° yaw:[yaw]° pitch:[pitch]°\n    gaze: [gaze]°",body:"body [score]%",bodyPart:"[label] [score]%",object:"[label] [score]%",hand:"[label] [score]%",finger:"[label]",gesture:"[where] [who]: [what]"},mK=0;function fK(e,t,n){const r=VG(UX,n);if(!t||!e)return;const a=RX(e);if(a){a.lineJoin="round",a.font=r.font;for(let e=0;e<t.length;e++)if(r.drawBoxes){if(a.strokeStyle=r.color,a.fillStyle=r.color,FX(a,t[e].box[0],t[e].box[1],t[e].box[2],t[e].box[3],r),r.drawLabels){const n=`person #${e}`;r.shadowColor&&""!==r.shadowColor&&(a.fillStyle=r.shadowColor,a.fillText(n,t[e].box[0]+3,1+t[e].box[1]+r.lineHeight,t[e].box[2])),a.fillStyle=r.labelColor,a.fillText(n,t[e].box[0]+2,0+t[e].box[1]+r.lineHeight,t[e].box[2])}a.stroke()}}}function gK(e,t){if(!e||!t)return;const n=RX(t);n&&n.drawImage(e,0,0)}async function yK(e,t,n){if(!(null==t?void 0:t.performance)||!e)return null;const r=UG(),a=VG(UX,n),i=Promise.all([lK(e,t.face,a),uK(e,t.body,a),dK(e,t.hand,a),cK(e,t.object,a),hK(e,t.gesture,a)]);return mK=mq.perfadd?mK+Math.round(UG()-r):Math.round(UG()-r),t.performance.draw=mK,i}function bK(){UX.faceLabels=pK.face,UX.bodyLabels=pK.body,UX.bodyPartLabels=pK.bodyPart,UX.handLabels=pK.hand,UX.fingerLabels=pK.finger,UX.objectLabels=pK.object,UX.gestureLabels=pK.gesture}var xK={};i(xK,{connected:()=>kK,kpt:()=>wK});var AK,vK,wK=["nose","leftEyeInside","leftEye","leftEyeOutside","rightEyeInside","rightEye","rightEyeOutside","leftEar","rightEar","leftMouth","rightMouth","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftPinky","rightPinky","leftIndex","rightIndex","leftThumb","rightThumb","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle","leftHeel","rightHeel","leftFoot","rightFoot","bodyCenter","bodyTop","leftPalm","leftHand","rightPalm","rightHand"],kK={shoulders:["leftShoulder","rightShoulder"],hips:["rightHip","leftHip"],mouth:["leftMouth","rightMouth"],leftLegUpper:["leftHip","leftKnee"],leftLegLower:["leftKnee","leftAnkle"],leftFoot:["leftAnkle","leftHeel","leftFoot"],leftTorso:["leftShoulder","leftHip"],leftArmUpper:["leftShoulder","leftElbow"],leftArmLower:["leftElbow","leftWrist"],leftHand:["leftWrist","leftPalm"],leftHandPinky:["leftPalm","leftPinky"],leftHandIndex:["leftPalm","leftIndex"],leftHandThumb:["leftPalm","leftThumb"],leftEyeOutline:["leftEyeInside","leftEyeOutside"],rightLegUpper:["rightHip","rightKnee"],rightLegLower:["rightKnee","rightAnkle"],rightFoot:["rightAnkle","rightHeel","rightFoot"],rightTorso:["rightShoulder","rightHip"],rightArmUpper:["rightShoulder","rightElbow"],rightArmLower:["rightElbow","rightWrist"],rightHand:["rightWrist","rightPalm"],rightHandPinky:["rightPalm","rightPinky"],rightHandIndex:["rightPalm","rightIndex"],rightHandThumb:["rightPalm","rightThumb"],rightEyeOutline:["rightEyeInside","rightEyeOutside"]},SK=224,TK=[8,16,32,32,32];var _K,IK=[5,5];function CK(e,t=[1,1]){const n=[e.map((e=>e[0])),e.map((e=>e[1]))],r=[Math.min(...n[0]),Math.min(...n[1])],a=[Math.max(...n[0]),Math.max(...n[1])],i=[r[0],r[1],a[0]-r[0],a[1]-r[1]];return{box:i,boxRaw:[i[0]/t[0],i[1]/t[1],i[2]/t[0],i[3]/t[1]]}}function EK(e,t=[1,1]){const n=[e.map((e=>e[0])),e.map((e=>e[1]))],r=[Math.min(...n[0]),Math.min(...n[1])],a=[Math.max(...n[0]),Math.max(...n[1])],i=[(r[0]+a[0])/2,(r[1]+a[1])/2],s=Math.max(i[0]-r[0],i[1]-r[1],-i[0]+a[0],-i[1]+a[1]),o=[Math.trunc(i[0]-s),Math.trunc(i[1]-s),Math.trunc(2*s),Math.trunc(2*s)];return{box:o,boxRaw:[o[0]/t[0],o[1]/t[1],o[2]/t[0],o[3]/t[1]]}}function NK(e,t){const n=[e[2]*t,e[3]*t];return[e[0]-(n[0]-e[2])/2,e[1]-(n[1]-e[3])/2,n[0],n[1]]}var RK=256,PK=Number.MAX_SAFE_INTEGER,DK={landmarks:["ld_3d","activation_segmentation","activation_heatmap","world_3d","output_poseflag"],detector:[]},MK=[],OK=[[0,0],[0,0],[0,0],[0,0]],$K=0,FK=e=>1-1/(1+Math.exp(e));function LK(e,t,n){var r,a;const i={};if(!(null==(r=null==e?void 0:e.shape)?void 0:r[1])||!(null==(a=null==e?void 0:e.shape)?void 0:a[2]))return e;let s;if(n&&(i.cropped=hp.cropAndResize(e,[n],[0],[e.shape[1],e.shape[2]])),e.shape[1]!==e.shape[2]){const n=[e.shape[2]>e.shape[1]?Math.trunc((e.shape[2]-e.shape[1])/2):0,e.shape[2]>e.shape[1]?Math.trunc((e.shape[2]-e.shape[1])/2):0],r=[e.shape[1]>e.shape[2]?Math.trunc((e.shape[1]-e.shape[2])/2):0,e.shape[1]>e.shape[2]?Math.trunc((e.shape[1]-e.shape[2])/2):0];OK=[[0,0],n,r,[0,0]],i.pad=fd(i.cropped||e,OK),i.resize=hp.resizeBilinear(i.pad,[t,t]),s=go(i.resize,_X.tf255)}else e.shape[1]!==t?(i.resize=hp.resizeBilinear(i.cropped||e,[t,t]),s=go(i.resize,_X.tf255)):s=go(i.cropped||e,_X.tf255);return Object.keys(i).forEach((e=>to(i[e]))),s}async function zK(e,t,n){if(!(null==_K?void 0:_K.executor))return null;const r={};[r.ld,r.segmentation,r.heatmap,r.world,r.poseflag]=null==_K?void 0:_K.execute(e,DK.landmarks);const a=(await r.poseflag.data())[0],i=await r.ld.data(),s=await r.world.data();Object.keys(r).forEach((e=>to(r[e])));const o=[];for(let e=0;e<i.length/5;e++){const t=FK(i[5*e+3]),r=FK(i[5*e+4]),l=Math.trunc(100*t*r*a)/100,u=[i[5*e+0]/RK,i[5*e+1]/RK,i[5*e+2]+0],d=[Math.trunc(n[0]*u[0]),Math.trunc(n[1]*u[1]),u[2]],c=[s[5*e+0],s[5*e+1],s[5*e+2]+0];o.push({part:wK[e],positionRaw:u,position:d,distance:c,score:l})}if(a<(t.body.minConfidence||0))return null;!function(e){const t=e.find((e=>"leftPalm"===e.part)),n=e.find((e=>"leftWrist"===e.part)),r=e.find((e=>"leftIndex"===e.part));t.position[2]=((n.position[2]||0)+(r.position[2]||0))/2;const a=e.find((e=>"rightPalm"===e.part)),i=e.find((e=>"rightWrist"===e.part)),s=e.find((e=>"rightIndex"===e.part));a.position[2]=((i.position[2]||0)+(s.position[2]||0))/2}(o);const l=function(e,t,n){for(const n of e)n.position=[Math.trunc(n.position[0]*(t[0]+OK[2][0]+OK[2][1])/t[0]-OK[2][0]),Math.trunc(n.position[1]*(t[1]+OK[1][0]+OK[1][1])/t[1]-OK[1][0]),n.position[2]],n.positionRaw=[n.position[0]/t[0],n.position[1]/t[1],2*n.position[2]/(t[0]+t[1])];return e}(o,n),u=CK(l.map((e=>e.position)),[n[0],n[1]]),d={};for(const[e,t]of Object.entries(kK)){const n=[];for(let e=0;e<t.length-1;e++){const r=l.find((n=>n.part===t[e])),a=l.find((n=>n.part===t[e+1]));r&&a&&n.push([r.position,a.position])}d[e]=n}return{id:0,score:Math.trunc(100*a)/100,box:u.box,boxRaw:u.boxRaw,keypoints:l,annotations:d}}async function BK(e,t){var n,r,a;const i=[e.shape[2]||0,e.shape[1]||0],s=(t.body.skipTime||0)>UG()-$K,o=PK<(t.body.skipFrames||0);if(t.skipAllowed&&s&&o&&null!==MK)PK++;else{let s=[];if(null==(r=null==(n=t.body)?void 0:n.detector)?void 0:r.enabled){const n=LK(e,224);s=await async function(e,t,n){const r={};r.res=null==AK?void 0:AK.execute(e,["Identity"]),r.logitsRaw=Jo(r.res,[0,0,0],[1,-1,1]),r.boxesRaw=Jo(r.res,[0,0,1],[1,-1,-1]),r.logits=Tc(r.logitsRaw),r.boxes=Tc(r.boxesRaw);const a=await async function(e,t,n,r){var a,i;const s=[],o={};o.boxes=function(e,t){return eo((()=>{const n=wc(e,12,1);let r=Tc(n[0]),a=Tc(n[1]),i=Tc(n[2]),s=Tc(n[3]);r=mo(go(r,SK),t.x),a=mo(go(a,SK),t.y),i=yo(go(i,SK),IK[0]),s=yo(go(s,SK),IK[1]);const o=Uu(r,go(i,2)),l=Uu(a,go(s,2)),u=mo(o,i),d=mo(l,s);return _c([o,l,u,d],1)}))}(e,vK),o.scores=Yo(t),o.nms=await hp.nonMaxSuppressionAsync(o.boxes,o.scores,1,(null==(a=n.body.detector)?void 0:a.minConfidence)||.1,(null==(i=n.body.detector)?void 0:i.iouThreshold)||.1);const l=await o.nms.data(),u=await o.scores.data(),d=await o.boxes.array();for(const e of Array.from(l)){const t=u[e],n=d[e],a={score:t,boxRaw:n,box:[Math.round(n[0]*r[0]),Math.round(n[1]*r[1]),Math.round(n[2]*r[0]),Math.round(n[3]*r[1])]};s.push(a)}return Object.keys(o).forEach((e=>to(o[e]))),s}(r.boxes,r.logits,t,n);return Object.keys(r).forEach((e=>to(r[e]))),a}(n,t,i),to(n)}else s=[{box:[0,0,0,0],boxRaw:[0,0,1,1],score:0}];for(let n=0;n<s.length;n++){const r=LK(e,256,null==(a=s[n])?void 0:a.boxRaw);MK.length=0;const o=await zK(r,t,i);to(r),o&&(o.id=n,MK.push(o))}$K=UG(),PK=0}return MK}var UK,WK=[{class:1,label:"person"},{class:2,label:"bicycle"},{class:3,label:"car"},{class:4,label:"motorcycle"},{class:5,label:"airplane"},{class:6,label:"bus"},{class:7,label:"train"},{class:8,label:"truck"},{class:9,label:"boat"},{class:10,label:"traffic light"},{class:11,label:"fire hydrant"},{class:12,label:"stop sign"},{class:13,label:"parking meter"},{class:14,label:"bench"},{class:15,label:"bird"},{class:16,label:"cat"},{class:17,label:"dog"},{class:18,label:"horse"},{class:19,label:"sheep"},{class:20,label:"cow"},{class:21,label:"elephant"},{class:22,label:"bear"},{class:23,label:"zebra"},{class:24,label:"giraffe"},{class:25,label:"backpack"},{class:26,label:"umbrella"},{class:27,label:"handbag"},{class:28,label:"tie"},{class:29,label:"suitcase"},{class:30,label:"frisbee"},{class:31,label:"skis"},{class:32,label:"snowboard"},{class:33,label:"sports ball"},{class:34,label:"kite"},{class:35,label:"baseball bat"},{class:36,label:"baseball glove"},{class:37,label:"skateboard"},{class:38,label:"surfboard"},{class:39,label:"tennis racket"},{class:40,label:"bottle"},{class:41,label:"wine glass"},{class:42,label:"cup"},{class:43,label:"fork"},{class:44,label:"knife"},{class:45,label:"spoon"},{class:46,label:"bowl"},{class:47,label:"banana"},{class:48,label:"apple"},{class:49,label:"sandwich"},{class:50,label:"orange"},{class:51,label:"broccoli"},{class:52,label:"carrot"},{class:53,label:"hot dog"},{class:54,label:"pizza"},{class:55,label:"donut"},{class:56,label:"cake"},{class:57,label:"chair"},{class:58,label:"couch"},{class:59,label:"potted plant"},{class:60,label:"bed"},{class:61,label:"dining table"},{class:62,label:"toilet"},{class:63,label:"tv"},{class:64,label:"laptop"},{class:65,label:"mouse"},{class:66,label:"remote"},{class:67,label:"keyboard"},{class:68,label:"cell phone"},{class:69,label:"microwave"},{class:70,label:"oven"},{class:71,label:"toaster"},{class:72,label:"sink"},{class:73,label:"refrigerator"},{class:74,label:"book"},{class:75,label:"clock"},{class:76,label:"vase"},{class:77,label:"scissors"},{class:78,label:"teddy bear"},{class:79,label:"hair drier"},{class:80,label:"toothbrush"}],VK=0,jK=[],HK=0,GK=Number.MAX_SAFE_INTEGER;async function qK(e,t){if(!(null==UK?void 0:UK.executor))return[];const n=(t.object.skipTime||0)>UG()-HK,r=GK<(t.object.skipFrames||0);return t.skipAllowed&&n&&r&&jK.length>0?(GK++,jK):(GK=0,new Promise((async n=>{const r=[e.shape[2]||0,e.shape[1]||0],a=hp.resizeBilinear(e,[VK,VK]),i=t.object.enabled?null==UK?void 0:UK.execute(a,["tower_0/detections"]):null;HK=UG(),to(a);const s=await async function(e,t,n){if(!e)return[];const r={},a=[],i=await e.array();r.squeeze=Tc(e);const s=wc(r.squeeze,6,1);r.stack=_c([s[1],s[0],s[3],s[2]],1),r.boxes=Tc(r.stack),r.scores=Tc(s[4]),r.classes=Tc(s[5]),to([e,...s]),r.nms=await hp.nonMaxSuppressionAsync(r.boxes,r.scores,n.object.maxDetected||0,n.object.iouThreshold,n.object.minConfidence||0);const o=await r.nms.data();let l=0;for(const e of Array.from(o)){const n=Math.trunc(100*i[0][e][4])/100,r=i[0][e][5];if(Number.isNaN(r))continue;const s=WK[r].label,[o,u]=[i[0][e][0]/VK,i[0][e][1]/VK],d=[o,u,i[0][e][2]/VK-o,i[0][e][3]/VK-u],c=[Math.trunc(d[0]*t[0]),Math.trunc(d[1]*t[1]),Math.trunc(d[2]*t[0]),Math.trunc(d[3]*t[1])];a.push({id:l++,score:n,class:r,label:s,box:c,boxRaw:d})}return Object.keys(r).forEach((e=>to(r[e]))),a}(i,r,t);jK=s,n(s)})))}var XK={};i(XK,{connected:()=>YK,kpt:()=>ZK});var KK,ZK=["head","neck","rightShoulder","rightElbow","rightWrist","chest","leftShoulder","leftElbow","leftWrist","bodyCenter","rightHip","rightKnee","rightAnkle","leftHip","leftKnee","leftAnkle"],YK={leftLeg:["leftHip","leftKnee","leftAnkle"],rightLeg:["rightHip","rightKnee","rightAnkle"],torso:["leftShoulder","rightShoulder","rightHip","leftHip","leftShoulder"],leftArm:["leftShoulder","leftElbow","leftWrist"],rightArm:["rightShoulder","rightElbow","rightWrist"],head:[]},JK=0,QK={id:0,keypoints:[],box:[0,0,0,0],boxRaw:[0,0,0,0],score:0,annotations:{}},eZ=Number.MAX_SAFE_INTEGER;async function tZ(e,t){const[n,r]=e.shape,a=Go(e,[r*n]),i=tu(a,0),s=(await i.data())[0];if(s>t){const e=So(a,0),t=od(e,n),r=(await t.data())[0],o=go(e,n),l=(await o.data())[0];return to([a,i,e,t,o]),[r,l,s]}return to([a,i]),[0,0,s]}async function nZ(e,t){if(!(null==KK?void 0:KK.executor)||!(null==KK?void 0:KK.inputs[0].shape))return[];const n=(t.body.skipTime||0)>UG()-JK,r=eZ<(t.body.skipFrames||0);return t.skipAllowed&&n&&r&&Object.keys(QK.keypoints).length>0?(eZ++,[QK]):(eZ=0,new Promise((async n=>{const r=eo((()=>{var t,n;const r=hp.resizeBilinear(e,[(null==(t=null==KK?void 0:KK.inputs[0].shape)?void 0:t[2])||0,(null==(n=null==KK?void 0:KK.inputs[0].shape)?void 0:n[1])||0],!1),a=yo(r,_X.tf2);return Uu(a,_X.tf1)}));let a;if(t.body.enabled&&(a=null==KK?void 0:KK.execute(r)),JK=UG(),to(r),a){QK.keypoints.length=0;const n=Tc(a);to(a);const r=Hc(n,2);to(n);for(let n=0;n<r.length;n++){const[a,i,s]=await tZ(r[n],t.body.minConfidence);s>(t.body.minConfidence||0)&&QK.keypoints.push({score:Math.round(100*s)/100,part:ZK[n],positionRaw:[a/KK.inputs[0].shape[2],i/KK.inputs[0].shape[1]],position:[Math.round(e.shape[2]*a/KK.inputs[0].shape[2]),Math.round(e.shape[1]*i/KK.inputs[0].shape[1])]})}r.forEach((e=>to(e)))}QK.score=QK.keypoints.reduce(((e,t)=>t.score>e?t.score:e),0);const i=QK.keypoints.map((e=>e.position[0])),s=QK.keypoints.map((e=>e.position[1]));QK.box=[Math.min(...i),Math.min(...s),Math.max(...i)-Math.min(...i),Math.max(...s)-Math.min(...s)];const o=QK.keypoints.map((e=>e.positionRaw[0])),l=QK.keypoints.map((e=>e.positionRaw[1]));QK.boxRaw=[Math.min(...o),Math.min(...l),Math.max(...o)-Math.min(...o),Math.max(...l)-Math.min(...l)];for(const[e,n]of Object.entries(YK)){const r=[];for(let e=0;e<n.length-1;e++){const a=QK.keypoints.find((t=>t.part===n[e])),i=QK.keypoints.find((t=>t.part===n[e+1]));a&&i&&a.score>(t.body.minConfidence||0)&&i.score>(t.body.minConfidence||0)&&r.push([a.position,i.position])}QK.annotations[e]=r}n([QK])})))}var rZ=e=>[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])],aZ=e=>[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2,1],iZ=(e,t)=>e?[Math.trunc(Math.max(0,e.startPoint[0])),Math.trunc(Math.max(0,e.startPoint[1])),Math.trunc(Math.min(t.shape[2]||0,e.endPoint[0])-Math.max(0,e.startPoint[0])),Math.trunc(Math.min(t.shape[1]||0,e.endPoint[1])-Math.max(0,e.startPoint[1]))]:[0,0,0,0],sZ=(e,t)=>e?[e.startPoint[0]/(t.shape[2]||0),e.startPoint[1]/(t.shape[1]||0),(e.endPoint[0]-e.startPoint[0])/(t.shape[2]||0),(e.endPoint[1]-e.startPoint[1])/(t.shape[1]||0)]:[0,0,0,0],oZ=(e,t,n)=>({startPoint:[e.startPoint[0]*t[0],e.startPoint[1]*t[1]],endPoint:[e.endPoint[0]*t[0],e.endPoint[1]*t[1]],landmarks:e.landmarks.map((e=>[(e[0]+n[0])*t[0],(e[1]+n[1])*t[1]])),confidence:e.confidence}),lZ=(e,t,n)=>{const r=t.shape[1],a=t.shape[2],i=[e.startPoint[1]/r,e.startPoint[0]/a,e.endPoint[1]/r,e.endPoint[0]/a],s=hp.cropAndResize(t,[i],[0],n),o=go(s,_X.tf255);return to(s),o},uZ=(e,t)=>{const n=aZ(e),r=rZ(e),a=[t*r[0]/2,t*r[1]/2];return{startPoint:[n[0]-a[0],n[1]-a[1]],endPoint:[n[0]+a[0],n[1]+a[1]],landmarks:e.landmarks,confidence:e.confidence,size:r}},dZ=e=>{const t=aZ(e),n=rZ(e),r=Math.max(...n)/2;return{startPoint:[Math.round(t[0]-r),Math.round(t[1]-r)],endPoint:[Math.round(t[0]+r),Math.round(t[1]+r)],landmarks:e.landmarks,confidence:e.confidence,size:[Math.round(n[0]),Math.round(n[1])]}},cZ=[[1,0,0],[0,1,0],[0,0,1]],hZ=(e,t)=>[[1,0,e],[0,1,t],[0,0,1]],pZ=(e,t)=>{let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n},mZ=(e,t)=>{const n=[];for(let r=0;r<e.length;r++)n.push(e[r][t]);return n},fZ=(e,t)=>{const n=[],r=e.length;for(let a=0;a<r;a++){n.push([]);for(let i=0;i<r;i++)n[a].push(pZ(e[a],mZ(t,i)))}return n},gZ=(e,t)=>{const n=Math.cos(e),r=Math.sin(e),a=[[n,-r,0],[r,n,0],[0,0,1]],i=hZ(t[0],t[1]),s=fZ(i,a),o=hZ(-t[0],-t[1]);return fZ(s,o)},yZ=(e,t)=>[pZ(e,t[0]),pZ(e,t[1])];function bZ(e,t,n,r,a){const i=rZ(t),s=e.map((e=>[i[0]/a*(e[0]-a/2),i[1]/a*(e[1]-a/2),e[2]||0])),o=n&&0!==n&&Math.abs(n)>.2,l=o?gZ(n,[0,0]):cZ,u=o?s.map((e=>[...yZ(e,l),e[2]])):s,d=o?(e=>{const t=[[e[0][0],e[1][0]],[e[0][1],e[1][1]]],n=[e[0][2],e[1][2]],r=[-pZ(t[0],n),-pZ(t[1],n)];return[t[0].concat(r[0]),t[1].concat(r[1]),[0,0,1]]})(r):cZ,c=aZ(t),h=[pZ(c,d[0]),pZ(c,d[1])];return u.map((e=>[Math.trunc(e[0]+h[0]),Math.trunc(e[1]+h[1]),Math.trunc(e[2]||0)]))}function xZ(e,t,n,r){const a=t.landmarks.length>=VX.count?VX.symmetryLine:jX.symmetryLine;let i,s=0,o=cZ;if(e&&mq.kernels.includes("rotatewithoffset"))if(s=((e,t)=>{return(n=Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]))-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI));var n})(t.landmarks[a[0]],t.landmarks[a[1]]),s&&0!==s&&Math.abs(s)>.2){const e=aZ(t),a=[e[0]/n.shape[2],e[1]/n.shape[1]],l=hp.rotateWithOffset(n,s,0,[a[0],a[1]]);o=gZ(-s,e),i=lZ(t,l,[r,r]),to(l)}else i=lZ(t,n,[r,r]);else i=lZ(t,n,[r,r]);return[s,o,i]}var AZ,vZ,wZ=(e,t)=>{const n=(e=>{const t=e.map((e=>e[0])),n=e.map((e=>e[1]));return[Math.min(...t)+(Math.max(...t)-Math.min(...t))/2,Math.min(...n)+(Math.max(...n)-Math.min(...n))/2]})(e),r=rZ(t);return{startPoint:[n[0]-r[0]/2,n[1]-r[1]/2],endPoint:[n[0]+r[0]/2,n[1]+r[1]/2]}},kZ=null,SZ=0,TZ=null;var _Z=0,IZ=WX.leftEyeLower0,CZ=WX.rightEyeLower0,EZ={leftBounds:[IZ[0],IZ[IZ.length-1]],rightBounds:[CZ[0],CZ[CZ.length-1]]},NZ=3,RZ=4,PZ=71,DZ=76;function MZ(e,t,n,r){for(let a=0;a<HX.length;a++){const{key:i,indices:s}=HX[a],o=WX[`${n}${i}`];if(!r||r.includes(i))for(let n=0;n<s.length;n++){const r=s[n];e[o[n]]=[t[r][0],t[r][1],(t[r][2]+e[o[n]][2])/2]}}}var OZ=(e,t,n,r,a,i=!1)=>{const s=dZ(uZ((e=>{const t=e.map((e=>e[0])),n=e.map((e=>e[1]));return{startPoint:[Math.min(...t),Math.min(...n)],endPoint:[Math.max(...t),Math.max(...n)],landmarks:e}})([e[n],e[r]]),2.3)),o=rZ(s);let l=hp.cropAndResize(t,[[s.startPoint[1]/a,s.startPoint[0]/a,s.endPoint[1]/a,s.endPoint[0]/a]],[0],[_Z,_Z]);if(i&&mq.kernels.includes("flipleftright")){const e=hp.flipLeftRight(l);to(l),l=e}return{box:s,boxSize:o,crop:l}},$Z=(e,t,n,r=!1)=>{const a=[];for(let i=0;i<DZ;i++){const s=e[3*i],o=e[3*i+1],l=e[3*i+2];a.push([(r?1-s/_Z:s/_Z)*n[0]+t.startPoint[0],o/_Z*n[1]+t.startPoint[1],l])}return{rawCoords:a,iris:a.slice(PZ)}},FZ=(e,t,n)=>{const r=e[WX[`${n}EyeUpper0`][NZ]][2],a=e[WX[`${n}EyeLower0`][RZ]][2],i=(r+a)/2;return t.map(((e,t)=>{let n=i;return 2===t?n=r:4===t&&(n=a),[e[0],e[1],n]}))};async function LZ(e,t,n){if(!(null==vZ?void 0:vZ.executor))return e;const{box:r,boxSize:a,crop:i}=OZ(e,t,EZ.leftBounds[0],EZ.leftBounds[1],n,!0),{box:s,boxSize:o,crop:l}=OZ(e,t,EZ.rightBounds[0],EZ.rightBounds[1],n,!0),u=Ko([i,l]);to(i),to(l);const d=vZ.execute(u);to(u);const c=await d.data();to(d);const h=c.slice(0,3*DZ),{rawCoords:p,iris:m}=$Z(h,r,a,!0),f=c.slice(3*DZ),{rawCoords:g,iris:y}=$Z(f,s,o,!1),b=(e=>e[EZ.leftBounds[0]][2]-e[EZ.rightBounds[0]][2])(e);Math.abs(b)<30?(MZ(e,p,"left",null),MZ(e,g,"right",null)):b<1?MZ(e,p,"left",["EyeUpper0","EyeLower0"]):MZ(e,g,"right",["EyeUpper0","EyeLower0"]);const x=FZ(e,m,"left"),A=FZ(e,y,"right");return e.concat(x).concat(A)}async function zZ(e,t){var n,r,a,i,s,o,l,u,d,c;const h={lips:await(null==(r=null==(n=t.filter((e=>160===e.size)))?void 0:n[0])?void 0:r.data()),irisL:await(null==(i=null==(a=t.filter((e=>10===e.size)))?void 0:a[0])?void 0:i.data()),eyeL:await(null==(o=null==(s=t.filter((e=>142===e.size)))?void 0:s[0])?void 0:o.data()),irisR:await(null==(u=null==(l=t.filter((e=>10===e.size)))?void 0:l[1])?void 0:u.data()),eyeR:await(null==(c=null==(d=t.filter((e=>142===e.size)))?void 0:d[1])?void 0:c.data())};for(const t of Object.values(h))if(!t)return e;const p=eK.reduce(((t,n)=>t+e[n][2]),0)/eK.length;for(let t=0;t<h.irisL.length/2;t++)e.push([h.irisL[2*t+0],h.irisL[2*t+1],p]);const m=tK.reduce(((t,n)=>t+e[n][2]),0)/tK.length;for(let t=0;t<h.irisR.length/2;t++)e.push([h.irisR[2*t+0],h.irisR[2*t+1],m]);for(let t=0;t<h.eyeL.length/2;t++)e[eK[t]]=[h.eyeL[2*t+0],h.eyeL[2*t+1],e[eK[t]][2]];for(let t=0;t<h.eyeR.length/2;t++)e[tK[t]]=[h.eyeR[2*t+0],h.eyeR[2*t+1],e[tK[t]][2]];for(let t=0;t<h.lips.length/2;t++)e[QX[t]]=[h.lips[2*t+0],h.lips[2*t+1],e[QX[t]][2]];return e}var BZ,UZ,WZ={boxes:[],skipped:Number.MAX_SAFE_INTEGER,timestamp:0},VZ=null,jZ=0,HZ=qX,GZ=GX,qZ=[],XZ=[],KZ=0,ZZ=0,YZ=Number.MAX_SAFE_INTEGER,JZ=!1;async function QZ(e,t,n,r){var a,i;if(!BZ)return[];const s=YZ<((null==(a=t.face.emotion)?void 0:a.skipFrames)||0),o=((null==(i=t.face.emotion)?void 0:i.skipTime)||0)>UG()-ZZ;return t.skipAllowed&&o&&s&&KZ===r&&XZ[n]&&XZ[n].length>0?(YZ++,XZ[n]):(YZ=0,new Promise((async a=>{var i,s,o;const l=[];if(null==(i=t.face.emotion)?void 0:i.enabled){const n={},r=(null==BZ?void 0:BZ.inputs[0].shape)?BZ.inputs[0].shape[2]:0;if((null==(s=t.face.emotion)?void 0:s.crop)>0){const a=null==(o=t.face.emotion)?void 0:o.crop,i=[[a,a,1-a,1-a]];n.resize=hp.cropAndResize(e,i,[0],[r,r])}else n.resize=hp.resizeBilinear(e,[r,r],!1);JZ?(n.mul=yo(n.resize,255),n.normalize=Uu(n.mul,[103.939,116.779,123.68]),n.emotion=null==BZ?void 0:BZ.execute(n.normalize)):(n.channels=yo(n.resize,_X.rgb),n.grayscale=ou(n.channels,3,!0),n.grayscaleSub=Uu(n.grayscale,_X.tf05),n.grayscaleMul=yo(n.grayscaleSub,_X.tf2),n.emotion=null==BZ?void 0:BZ.execute(n.grayscaleMul)),ZZ=UG();const a=await n.emotion.data();for(let e=0;e<a.length;e++)a[e]>(t.face.emotion.minConfidence||0)&&l.push({score:Math.min(.99,Math.trunc(100*a[e])/100),emotion:qZ[e]});l.sort(((e,t)=>t.score-e.score)),Object.keys(n).forEach((e=>to(n[e])))}XZ[n]=l,KZ=r,a(l)})))}var eY=[],tY=0,nY=0,rY=Number.MAX_SAFE_INTEGER;async function aY(e,t,n,r){var a,i,s,o;const l={age:0,gender:"unknown",genderScore:0,descriptor:[]};if(!(null==UZ?void 0:UZ.executor))return l;const u=rY<((null==(a=t.face.description)?void 0:a.skipFrames)||0),d=((null==(i=t.face.description)?void 0:i.skipTime)||0)>UG()-tY;return t.skipAllowed&&u&&d&&nY===r&&(null==(s=null==eY?void 0:eY[n])?void 0:s.age)>0&&(null==(o=null==eY?void 0:eY[n])?void 0:o.genderScore)>0?(rY++,eY[n]):(rY=0,new Promise((async a=>{var i;if(null==(i=t.face.description)?void 0:i.enabled){const n=function(e,t){var n,r;const a=e.image||e.tensor||e;if(!(null==UZ?void 0:UZ.inputs[0].shape))return a;let i;if((null==(n=t.face.description)?void 0:n.crop)>0){const e=null==(r=t.face.description)?void 0:r.crop,n=[[e,e,1-e,1-e]];i=hp.cropAndResize(a,n,[0],[UZ.inputs[0].shape[2],UZ.inputs[0].shape[1]])}else i=hp.resizeBilinear(a,[UZ.inputs[0].shape[2],UZ.inputs[0].shape[1]],!1);const s=yo(i,_X.tf255);return to(i),s}(e,t),r=null==UZ?void 0:UZ.execute(n);tY=UG(),to(n);const a=r.find((e=>1===e.shape[1])),i=await a.data(),s=Math.trunc(200*Math.abs(i[0]-.5))/100;s>(t.face.description.minConfidence||0)&&(l.gender=i[0]<=.5?"female":"male",l.genderScore=Math.min(.99,s));const o=So(r.find((e=>100===e.shape[1])),1),u=(await o.data())[0];to(o);const d=r.find((e=>100===e.shape[1])),c=await d.data();l.age=Math.round(c[u-1]>c[u+1]?10*u-100*c[u-1]:10*u+100*c[u+1])/10,(Number.isNaN(i[0])||Number.isNaN(c[0]))&&BG("faceres error:",{model:UZ,result:r});const h=r.find((e=>1024===e.shape[1])),p=h?await h.data():[];l.descriptor=Array.from(p),r.forEach((e=>to(e)))}eY[n]=l,nY=r,a(l)})))}var iY,sY=.1;function oY(e,t,n){let r=!1,a=n.length-1;for(let i=0;i<n.length;a=i++)n[i].y>t!=n[a].y>t&&e<(n[a].x-n[i].x)*(t-n[i].y)/(n[a].y-n[i].y)+n[i].x&&(r=!r);return r}async function lY(e){if(!e.tensor)return e.tensor;if(!e.mesh||e.mesh.length<100)return e.tensor;const t=e.tensor.shape[2]||0,n=e.tensor.shape[1]||0,r=await e.tensor.buffer();let a=[];for(const t of WX.silhouette)a.push({x:(e.mesh[t][0]-e.box[0])/e.box[2],y:(e.mesh[t][1]-e.box[1])/e.box[3]});a=a.map((e=>({x:e.x>.5?e.x+sY:e.x-sY,y:e.y>.5?e.y+sY:e.y-sY})));for(let e=0;e<t;e++)for(let i=0;i<n;i++)oY(e/t,i/t,a)||(r.set(.5*r.get(0,i,e,0),0,i,e,0),r.set(.5*r.get(0,i,e,1),0,i,e,1),r.set(.5*r.get(0,i,e,2),0,i,e,2));return r.toTensor()}var uY,dY=[],cY=Number.MAX_SAFE_INTEGER,hY=0,pY=0;async function mY(e,t,n,r){var a,i;if(!(null==iY?void 0:iY.executor))return 0;const s=((null==(a=t.face.antispoof)?void 0:a.skipTime)||0)>UG()-pY,o=cY<((null==(i=t.face.antispoof)?void 0:i.skipFrames)||0);return t.skipAllowed&&s&&o&&hY===r&&dY[n]?(cY++,dY[n]):(cY=0,new Promise((async t=>{const a=hp.resizeBilinear(e,[(null==iY?void 0:iY.inputs[0].shape)?iY.inputs[0].shape[2]:0,(null==iY?void 0:iY.inputs[0].shape)?iY.inputs[0].shape[1]:0],!1),i=null==iY?void 0:iY.execute(a),s=(await i.data())[0];dY[n]=Math.round(100*s)/100,hY=r,pY=UG(),to([a,i]),t(dY[n])})))}var fY,gY=[],yY=Number.MAX_SAFE_INTEGER,bY=0,xY=0;async function AY(e,t,n,r){var a,i;if(!(null==uY?void 0:uY.executor))return 0;const s=((null==(a=t.face.liveness)?void 0:a.skipTime)||0)>UG()-xY,o=yY<((null==(i=t.face.liveness)?void 0:i.skipFrames)||0);return t.skipAllowed&&s&&o&&bY===r&&gY[n]?(yY++,gY[n]):(yY=0,new Promise((async t=>{const a=hp.resizeBilinear(e,[(null==uY?void 0:uY.inputs[0].shape)?uY.inputs[0].shape[2]:0,(null==uY?void 0:uY.inputs[0].shape)?uY.inputs[0].shape[1]:0],!1),i=null==uY?void 0:uY.execute(a),s=(await i.data())[0];gY[n]=Math.round(100*s)/100,bY=r,xY=UG(),to([a,i]),t(gY[n])})))}var vY,wY=[],kY=["white","black","asian","indian","other"],SY=[15,23,28,35.5,45.5,55.5,65],TY=0,_Y=0,IY=Number.MAX_SAFE_INTEGER;async function CY(e,t,n,r){var a,i;if(!fY)return{age:0,gender:"unknown",genderScore:0,race:[]};const s=IY<((null==(a=t.face.gear)?void 0:a.skipFrames)||0),o=((null==(i=t.face.gear)?void 0:i.skipTime)||0)>UG()-_Y;return t.skipAllowed&&o&&s&&TY===r&&wY[n]?(IY++,wY[n]):(IY=0,new Promise((async a=>{var i,s,o,l;if(!(null==fY?void 0:fY.inputs[0].shape))return;const u={};let d=[[0,.1,.9,.9]];if((null==(i=t.face.gear)?void 0:i.crop)>0){const e=null==(s=t.face.gear)?void 0:s.crop;d=[[e,e,1-e,1-e]]}u.resize=hp.cropAndResize(e,d,[0],[fY.inputs[0].shape[2],fY.inputs[0].shape[1]]);const c={age:0,gender:"unknown",genderScore:0,race:[]};(null==(o=t.face.gear)?void 0:o.enabled)&&([u.age,u.gender,u.race]=fY.execute(u.resize,["age_output","gender_output","race_output"]));const h=await u.gender.data();c.gender=h[0]>h[1]?"male":"female",c.genderScore=Math.round(100*(h[0]>h[1]?h[0]:h[1]))/100;const p=await u.race.data();for(let e=0;e<p.length;e++)p[e]>((null==(l=t.face.gear)?void 0:l.minConfidence)||.2)&&c.race.push({score:Math.round(100*p[e])/100,race:kY[e]});c.race.sort(((e,t)=>t.score-e.score));const m=Array.from(await u.age.data()).map(((e,t)=>[SY[t],e])).sort(((e,t)=>t[1]-e[1]));let f=m[0][0];for(let e=1;e<m.length;e++)f+=m[e][1]*(m[e][0]-f);c.age=Math.round(10*f)/10,Object.keys(u).forEach((e=>to(u[e]))),wY[n]=c,TY=r,_Y=UG(),a(c)})))}var EY,NY=[],RY=0,PY=0,DY=Number.MAX_SAFE_INTEGER;async function MY(e,t,n,r){var a,i,s,o;if(!vY)return{age:0};const l=DY<((null==(a=t.face.ssrnet)?void 0:a.skipFrames)||0),u=((null==(i=t.face.ssrnet)?void 0:i.skipTime)||0)>UG()-PY;return t.skipAllowed&&l&&u&&RY===r&&(null==(s=NY[n])?void 0:s.age)&&(null==(o=NY[n])?void 0:o.age)>0?(DY++,NY[n]):(DY=0,new Promise((async a=>{var i,s,o;if(!(null==vY?void 0:vY.inputs)||!vY.inputs[0]||!vY.inputs[0].shape)return;const l={};if((null==(i=t.face.ssrnet)?void 0:i.crop)>0){const n=null==(s=t.face.ssrnet)?void 0:s.crop,r=[[n,n,1-n,1-n]];l.resize=hp.cropAndResize(e,r,[0],[vY.inputs[0].shape[2],vY.inputs[0].shape[1]])}else l.resize=hp.resizeBilinear(e,[vY.inputs[0].shape[2],vY.inputs[0].shape[1]],!1);l.enhance=yo(l.resize,_X.tf255);const u={age:0};if((null==(o=t.face.ssrnet)?void 0:o.enabled)&&(l.age=vY.execute(l.enhance)),l.age){const e=await l.age.data();u.age=Math.trunc(10*e[0])/10}Object.keys(l).forEach((e=>to(l[e]))),NY[n]=u,RY=r,PY=UG(),a(u)})))}var OY,$Y=[],FY=0,LY=0,zY=Number.MAX_SAFE_INTEGER,BY=[.2989,.587,.114];async function UY(e,t,n,r){var a,i,s,o;if(!EY)return{gender:"unknown",genderScore:0};const l=zY<((null==(a=t.face.ssrnet)?void 0:a.skipFrames)||0),u=((null==(i=t.face.ssrnet)?void 0:i.skipTime)||0)>UG()-LY;return t.skipAllowed&&l&&u&&FY===r&&(null==(s=$Y[n])?void 0:s.gender)&&(null==(o=$Y[n])?void 0:o.genderScore)>0?(zY++,$Y[n]):(zY=0,new Promise((async a=>{var i,s,o;if(!(null==EY?void 0:EY.inputs[0].shape))return;const l={};if((null==(i=t.face.ssrnet)?void 0:i.crop)>0){const n=null==(s=t.face.ssrnet)?void 0:s.crop,r=[[n,n,1-n,1-n]];l.resize=hp.cropAndResize(e,r,[0],[EY.inputs[0].shape[2],EY.inputs[0].shape[1]])}else l.resize=hp.resizeBilinear(e,[EY.inputs[0].shape[2],EY.inputs[0].shape[1]],!1);l.enhance=eo((()=>{var e,t;let n;if(1===(null==(t=null==(e=null==EY?void 0:EY.inputs)?void 0:e[0].shape)?void 0:t[3])){const[e,t,r]=wc(l.resize,3,3),a=yo(e,BY[0]),i=yo(t,BY[1]),s=yo(r,BY[2]),o=vo([a,i,s]);n=yo(Uu(o,_X.tf05),2)}else n=yo(Uu(l.resize,_X.tf05),2);return n}));const u={gender:"unknown",genderScore:0};(null==(o=t.face.ssrnet)?void 0:o.enabled)&&(l.gender=EY.execute(l.enhance));const d=await l.gender.data();u.gender=d[0]>d[1]?"female":"male",u.genderScore=d[0]>d[1]?Math.trunc(100*d[0])/100:Math.trunc(100*d[1])/100,Object.keys(l).forEach((e=>to(l[e]))),$Y[n]=u,FY=r,LY=UG(),a(u)})))}var WY,VY=[],jY=0,HY=0,GY=Number.MAX_SAFE_INTEGER;async function qY(e,t,n,r){var a,i;if(!(null==OY?void 0:OY.executor))return[];const s=GY<((null==(a=t.face.mobilefacenet)?void 0:a.skipFrames)||0),o=((null==(i=t.face.mobilefacenet)?void 0:i.skipTime)||0)>UG()-HY;return t.skipAllowed&&o&&s&&jY===r&&VY[n]?(GY++,VY[n]):new Promise((async a=>{var i;let s=[];if((null==(i=t.face.mobilefacenet)?void 0:i.enabled)&&(null==OY?void 0:OY.inputs[0].shape)){const t={};t.crop=hp.resizeBilinear(e,[OY.inputs[0].shape[2],OY.inputs[0].shape[1]],!1),t.data=OY.execute(t.crop);const n=await t.data.data();s=Array.from(n),Object.keys(t).forEach((e=>to(t[e])))}VY[n]=s,jY=r,HY=UG(),a(s)}))}var XY=[],KY=0,ZY=0,YY=Number.MAX_SAFE_INTEGER;async function JY(e,t,n,r){var a,i;if(!(null==WY?void 0:WY.executor))return[];const s=YY<((null==(a=t.face.insightface)?void 0:a.skipFrames)||0),o=((null==(i=t.face.insightface)?void 0:i.skipTime)||0)>UG()-ZY;return t.skipAllowed&&o&&s&&KY===r&&XY[n]?(YY++,XY[n]):new Promise((async a=>{var i;let s=[];if((null==(i=t.face.insightface)?void 0:i.enabled)&&(null==WY?void 0:WY.inputs[0].shape)){const t={};t.crop=hp.resizeBilinear(e,[WY.inputs[0].shape[2],WY.inputs[0].shape[1]],!1),t.data=WY.execute(t.crop);const n=await t.data.data();s=Array.from(n),Object.keys(t).forEach((e=>to(t[e])))}XY[n]=s,KY=r,ZY=UG(),a(s)}))}var QY=(e,t)=>{const n=e=>{const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return e[0]/=t,e[1]/=t,e[2]/=t,e},r=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],a=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],i=e.meshRaw;if(!i||i.length<300)return{angle:{pitch:0,yaw:0,roll:0},matrix:[1,0,0,0,1,0,0,0,1],gaze:{bearing:0,strength:0}};const s=Math.max(e.boxRaw[2]*t[0],e.boxRaw[3]*t[1])/1.5,o=[i[10],i[152],i[234],i[454]].map((e=>[e[0]*t[0]/s,e[1]*t[1]/s,e[2]])),l=n(r(o[1],o[0]));let u=n(r(o[3],o[2]));const d=n(a(u,l));u=a(l,d);const c=[u[0],u[1],u[2],l[0],l[1],l[2],d[0],d[1],d[2]],h=(e=>{const[t,n,r,a,i,s,o,l,u]=e;let d,c,h;return a<1?a>-1?(h=Math.asin(a),c=Math.atan2(-o,t),d=Math.atan2(-s,i)):(h=-Math.PI/2,c=-Math.atan2(l,u),d=0):(h=Math.PI/2,c=Math.atan2(l,u),d=0),Number.isNaN(d)&&(d=0),Number.isNaN(c)&&(c=0),Number.isNaN(h)&&(h=0),{pitch:2*-d,yaw:2*-c,roll:2*-h}})(c),p=478===i.length?(e=>{if(!e.annotations.rightEyeIris||!e.annotations.leftEyeIris)return{bearing:0,strength:0};const t=[0,-.1],n=(e.mesh[33][2]||0)>(e.mesh[263][2]||0),r=n?e.mesh[473]:e.mesh[468],a=n?[(e.mesh[133][0]+e.mesh[33][0])/2,(e.mesh[133][1]+e.mesh[33][1])/2]:[(e.mesh[263][0]+e.mesh[362][0])/2,(e.mesh[263][1]+e.mesh[362][1])/2],i=n?[e.mesh[133][0]-e.mesh[33][0],e.mesh[23][1]-e.mesh[27][1]]:[e.mesh[263][0]-e.mesh[362][0],e.mesh[253][1]-e.mesh[257][1]],s=[(a[0]-r[0])/i[0]-t[0],1*(r[1]-a[1])/i[1]-t[1]];let o=Math.sqrt(s[0]*s[0]+s[1]*s[1]);var l,u;return o=Math.min(o,e.boxRaw[2]/2,e.boxRaw[3]/2),{bearing:(l=[0,0],u=s,(Math.atan2(l[1]-u[1],l[0]-u[0])+Math.PI/2)%Math.PI),strength:o}})(e):{bearing:0,strength:0};return{angle:h,matrix:c,gaze:p}};function eJ(e,t){const n=null==e?void 0:e.annotations;if(!(null==n?void 0:n.leftEyeIris)||!(null==n?void 0:n.rightEyeIris))return 0;const r=Math.max(Math.abs(n.leftEyeIris[3][0]-n.leftEyeIris[1][0]),Math.abs(n.rightEyeIris[3][0]-n.rightEyeIris[1][0]))/t;return Math.round(1.17/r)/100}var tJ=async(e,t)=>{var n,r,a,i,s,o,l,u,d,c,h,p,m,f,g,y,b,x,A,v,w,k,S;let T,_,I,C,E,N,R,P,D,M=UG();const O=[];e.state="run:face";const $=await async function(e,t){var n,r,a,i,s,o,l,u,d,c;const h=((null==(n=t.face.detector)?void 0:n.skipTime)||0)>UG()-WZ.timestamp,p=WZ.skipped<((null==(r=t.face.detector)?void 0:r.skipFrames)||0);t.skipAllowed&&h&&p&&0!==WZ.boxes.length?WZ.skipped++:(WZ.boxes=await async function(e,t){var n,r,a,i,s,o;if(!e||e.isDisposedInternal||4!==e.shape.length||e.shape[1]<1||e.shape[2]<1)return[];const l={};l.resized=hp.resizeBilinear(e,[SZ,SZ]),l.div=go(l.resized,_X.tf127),l.normalized=Uu(l.div,_X.tf05);const u=null==AZ?void 0:AZ.execute(l.normalized);if(Array.isArray(u)&&u.length>2){const e=u.sort(((e,t)=>e.size-t.size));l.concat384=Ko([e[0],e[2]],2),l.concat512=Ko([e[1],e[3]],2),l.concat=Ko([l.concat512,l.concat384],1),l.batch=Tc(l.concat,[0])}else Array.isArray(u)?l.batch=Tc(u[0]):l.batch=Tc(u);to(u),l.boxes=function(e){if(!kZ||!TZ)return nd([0,0]);const t={};t.boxStarts=Jo(e,[0,1],[-1,2]),t.centers=mo(t.boxStarts,kZ),t.boxSizes=Jo(e,[0,3],[-1,2]),t.boxSizesNormalized=go(t.boxSizes,TZ),t.centersNormalized=go(t.centers,TZ),t.halfBoxSize=go(t.boxSizesNormalized,_X.tf2),t.starts=Uu(t.centersNormalized,t.halfBoxSize),t.ends=mo(t.centersNormalized,t.halfBoxSize),t.startNormalized=yo(t.starts,TZ),t.endNormalized=yo(t.ends,TZ);const n=fl([t.startNormalized,t.endNormalized],1);return Object.keys(t).forEach((e=>to(t[e]))),n}(l.batch),l.logits=Jo(l.batch,[0,0],[-1,1]),l.sigmoid=Yo(l.logits),l.scores=Tc(l.sigmoid),l.nms=await hp.nonMaxSuppressionAsync(l.boxes,l.scores,(null==(n=t.face.detector)?void 0:n.maxDetected)||0,(null==(r=t.face.detector)?void 0:r.iouThreshold)||0,(null==(a=t.face.detector)?void 0:a.minConfidence)||0);const d=await l.nms.array(),c=[],h=await l.scores.data();for(let n=0;n<d.length;n++){const r=h[d[n]];if(r>((null==(i=t.face.detector)?void 0:i.minConfidence)||0)){const a={};a.bbox=Jo(l.boxes,[d[n],0],[1,-1]),a.slice=Jo(l.batch,[d[n],5],[1,-1]),a.squeeze=Tc(a.slice),a.landmarks=Go(a.squeeze,[6,-1]);const i=await a.bbox.data(),u={startPoint:[i[0],i[1]],endPoint:[i[2],i[3]],landmarks:await a.landmarks.array(),confidence:r};a.anchor=Jo(kZ,[d[n],0],[1,2]);const h=await a.anchor.data(),p=oZ(u,[(e.shape[2]||0)/SZ,(e.shape[1]||0)/SZ],h),m=uZ(p,t.face.scale||1.4),f=dZ(m);f.size[0]>((null==(s=t.face.detector)?void 0:s.minSize)||0)&&f.size[1]>((null==(o=t.face.detector)?void 0:o.minSize)||0)&&c.push(f),Object.keys(a).forEach((e=>to(a[e])))}}return Object.keys(l).forEach((e=>to(l[e]))),c}(e,t),WZ.timestamp=UG(),WZ.skipped=0);const m=[],f=[];let g=0;const y=jZ;for(let n=0;n<WZ.boxes.length;n++){const r=WZ.boxes[n];let h,p=0;const b={id:g++,mesh:[],meshRaw:[],box:[0,0,0,0],boxRaw:[0,0,0,0],score:0,boxScore:0,faceScore:0,size:[0,0],annotations:{}};if([p,h,b.tensor]=xZ(null==(a=t.face.detector)?void 0:a.rotation,r,e,(null==(i=t.face.mesh)?void 0:i.enabled)?jZ:SZ),t.filter.equalization){const e=b.tensor?await eq(b.tensor):void 0;to(b.tensor),e&&(b.tensor=e)}if(b.boxScore=Math.round(100*r.confidence)/100,(null==(s=t.face.mesh)?void 0:s.enabled)&&(null==VZ?void 0:VZ.executor))if(VZ){if((null==(o=t.face.attention)?void 0:o.enabled)&&!mq.kernels.includes("atan2"))return t.face.attention.enabled=!1,to(b.tensor),m;const n=VZ.execute(b.tensor),a=n.find((e=>1===e.shape[e.shape.length-1])),i=await a.data();if(b.faceScore=Math.round(100*i[0])/100,b.faceScore<((null==(l=t.face.detector)?void 0:l.minConfidence)||1)){if(r.confidence=b.faceScore,t.face.mesh.keepInvalid){b.box=iZ(r,e),b.boxRaw=sZ(r,e),b.size=r.size,b.score=b.boxScore,b.mesh=r.landmarks,b.meshRaw=b.mesh.map((t=>[t[0]/(e.shape[2]||1),t[1]/(e.shape[1]||1),(t[2]||0)/y]));for(const e of Object.keys(jX))b.annotations[e]=[b.mesh[jX[e]]]}}else{const a=n.find((e=>1404===e.shape[e.shape.length-1])),i=Go(a,[-1,3]);let s=await i.array();to(i),(null==(u=t.face.attention)?void 0:u.enabled)?s=await zZ(s,n):(null==(d=t.face.iris)?void 0:d.enabled)&&(s=await LZ(s,b.tensor,jZ)),b.mesh=bZ(s,r,p,h,jZ),b.meshRaw=b.mesh.map((t=>[t[0]/(e.shape[2]||0),t[1]/(e.shape[1]||0),(t[2]||0)/y]));for(const e of Object.keys(WX))b.annotations[e]=WX[e].map((e=>b.mesh[e]));b.score=b.faceScore;const o={...wZ(b.mesh,r),confidence:r.confidence,landmarks:r.landmarks,size:r.size};b.box=iZ(o,e),b.boxRaw=sZ(o,e),b.size=o.size,f.push(o)}to(n)}else t.debug&&BG("face mesh detection requested, but model is not loaded");else{b.box=iZ(r,e),b.boxRaw=sZ(r,e),b.score=b.boxScore,b.size=r.size,b.mesh=r.landmarks,b.meshRaw=b.mesh.map((t=>[t[0]/(e.shape[2]||0),t[1]/(e.shape[1]||0),(t[2]||0)/y]));for(const e of Object.keys(jX))b.annotations[e]=[b.mesh[jX[e]]]}b.score>((null==(c=t.face.detector)?void 0:c.minConfidence)||1)?m.push(b):to(b.tensor)}return WZ.boxes=f,m}(t,e.config);if(e.performance.face=mq.perfadd?(e.performance.face||0)+Math.trunc(UG()-M):Math.trunc(UG()-M),!t.shape||4!==t.shape.length)return[];if(!$)return[];for(let F=0;F<$.length;F++){if(e.analyze("Get Face"),!$[F].tensor||$[F].tensor.isDisposedInternal){BG("Face object is disposed:",$[F].tensor);continue}if(null==(n=e.config.face.detector)?void 0:n.mask){const e=await lY($[F]);to($[F].tensor),e&&($[F].tensor=e)}const L=$[F].mesh&&$[F].mesh.length>200?QY($[F],[t.shape[2],t.shape[1]]):null;e.analyze("Start Emotion:"),e.config.async?C=(null==(r=e.config.face.emotion)?void 0:r.enabled)?QZ($[F].tensor||Gi([]),e.config,F,$.length):[]:(e.state="run:emotion",M=UG(),C=(null==(a=e.config.face.emotion)?void 0:a.enabled)?await QZ($[F].tensor||Gi([]),e.config,F,$.length):[],e.performance.emotion=mq.perfadd?(e.performance.emotion||0)+Math.trunc(UG()-M):Math.trunc(UG()-M)),e.analyze("End Emotion:"),e.analyze("Start AntiSpoof:"),e.config.async?R=(null==(i=e.config.face.antispoof)?void 0:i.enabled)?mY($[F].tensor||Gi([]),e.config,F,$.length):0:(e.state="run:antispoof",M=UG(),R=(null==(s=e.config.face.antispoof)?void 0:s.enabled)?await mY($[F].tensor||Gi([]),e.config,F,$.length):0,e.performance.antispoof=mq.perfadd?(e.performance.antispoof||0)+Math.trunc(UG()-M):Math.trunc(UG()-M)),e.analyze("End AntiSpoof:"),e.analyze("Start Liveness:"),e.config.async?P=(null==(o=e.config.face.liveness)?void 0:o.enabled)?AY($[F].tensor||Gi([]),e.config,F,$.length):0:(e.state="run:liveness",M=UG(),P=(null==(l=e.config.face.liveness)?void 0:l.enabled)?await AY($[F].tensor||Gi([]),e.config,F,$.length):0,e.performance.liveness=mq.perfadd?(e.performance.antispoof||0)+Math.trunc(UG()-M):Math.trunc(UG()-M)),e.analyze("End Liveness:"),e.analyze("Start GEAR:"),e.config.async?_=(null==(u=e.config.face.gear)?void 0:u.enabled)?CY($[F].tensor||Gi([]),e.config,F,$.length):null:(e.state="run:gear",M=UG(),_=(null==(d=e.config.face.gear)?void 0:d.enabled)?await CY($[F].tensor||Gi([]),e.config,F,$.length):null,e.performance.gear=Math.trunc(UG()-M)),e.analyze("End GEAR:"),e.analyze("Start SSRNet:"),e.config.async?(T=(null==(c=e.config.face.ssrnet)?void 0:c.enabled)?MY($[F].tensor||Gi([]),e.config,F,$.length):null,I=(null==(h=e.config.face.ssrnet)?void 0:h.enabled)?UY($[F].tensor||Gi([]),e.config,F,$.length):null):(e.state="run:ssrnet",M=UG(),T=(null==(p=e.config.face.ssrnet)?void 0:p.enabled)?await MY($[F].tensor||Gi([]),e.config,F,$.length):null,I=(null==(m=e.config.face.ssrnet)?void 0:m.enabled)?await UY($[F].tensor||Gi([]),e.config,F,$.length):null,e.performance.ssrnet=Math.trunc(UG()-M)),e.analyze("End SSRNet:"),e.analyze("Start MobileFaceNet:"),e.config.async?E=(null==(f=e.config.face.mobilefacenet)?void 0:f.enabled)?qY($[F].tensor||Gi([]),e.config,F,$.length):null:(e.state="run:mobilefacenet",M=UG(),E=(null==(g=e.config.face.mobilefacenet)?void 0:g.enabled)?await qY($[F].tensor||Gi([]),e.config,F,$.length):null,e.performance.mobilefacenet=Math.trunc(UG()-M)),e.analyze("End MobileFaceNet:"),e.analyze("Start InsightFace:"),e.config.async?N=(null==(y=e.config.face.insightface)?void 0:y.enabled)?JY($[F].tensor||Gi([]),e.config,F,$.length):null:(e.state="run:mobilefacenet",M=UG(),N=(null==(b=e.config.face.insightface)?void 0:b.enabled)?await JY($[F].tensor||Gi([]),e.config,F,$.length):null,e.performance.mobilefacenet=Math.trunc(UG()-M)),e.analyze("End InsightFace:"),e.analyze("Start Description:"),e.config.async?D=aY($[F].tensor||Gi([]),e.config,F,$.length):(e.state="run:description",M=UG(),D=await aY($[F].tensor||Gi([]),e.config,F,$.length),e.performance.description=mq.perfadd?(e.performance.description||0)+Math.trunc(UG()-M):Math.trunc(UG()-M)),e.analyze("End Description:"),e.config.async&&([T,I,C,E,N,D,_,R,P]=await Promise.all([T,I,C,E,N,D,_,R,P])),e.analyze("Finish Face:"),(null==(x=e.config.face.ssrnet)?void 0:x.enabled)&&T&&I&&(D={...D,age:T.age,gender:I.gender,genderScore:I.genderScore}),(null==(A=e.config.face.gear)?void 0:A.enabled)&&_&&(D={...D,age:_.age,gender:_.gender,genderScore:_.genderScore,race:_.race}),(null==(v=e.config.face.mobilefacenet)?void 0:v.enabled)&&E&&(D.descriptor=E),(null==(w=e.config.face.insightface)?void 0:w.enabled)&&N&&(D.descriptor=N);const z=(null==(k=e.config.face.iris)?void 0:k.enabled)?eJ($[F],t.shape[2]):0,B=(null==(S=e.config.face.detector)?void 0:S.return)?Tc($[F].tensor):null;to($[F].tensor),$[F].tensor&&delete $[F].tensor;const U={...$[F],id:F};D.age&&(U.age=D.age),D.gender&&(U.gender=D.gender),D.genderScore&&(U.genderScore=D.genderScore),D.descriptor&&(U.embedding=D.descriptor),D.race&&(U.race=D.race),C&&(U.emotion=C),R&&(U.real=R),P&&(U.live=P),z>0&&(U.distance=z),L&&(U.rotation=L),B&&(U.tensor=B),O.push(U),e.analyze("End Face")}return e.analyze("End FaceMesh:"),e.config.async&&(e.performance.face&&delete e.performance.face,e.performance.age&&delete e.performance.age,e.performance.gender&&delete e.performance.gender,e.performance.emotion&&delete e.performance.emotion),O},nJ={thumb:0,index:1,middle:2,ring:3,pinky:4,all:[0,1,2,3,4],nameMapping:{0:"thumb",1:"index",2:"middle",3:"ring",4:"pinky"},pointsMapping:{0:[[0,1],[1,2],[2,3],[3,4]],1:[[0,5],[5,6],[6,7],[7,8]],2:[[0,9],[9,10],[10,11],[11,12]],3:[[0,13],[13,14],[14,15],[15,16]],4:[[0,17],[17,18],[18,19],[19,20]]},getName:e=>nJ.nameMapping[e],getPoints:e=>nJ.pointsMapping[e]},rJ={none:0,half:1,full:2,nameMapping:{0:"none",1:"half",2:"full"},getName:e=>rJ.nameMapping[e]},aJ={verticalUp:0,verticalDown:1,horizontalLeft:2,horizontalRight:3,diagonalUpRight:4,diagonalUpLeft:5,diagonalDownRight:6,diagonalDownLeft:7,nameMapping:{0:"verticalUp",1:"verticalDown",2:"horizontalLeft",3:"horizontalRight",4:"diagonalUpRight",5:"diagonalUpLeft",6:"diagonalDownRight",7:"diagonalDownLeft"},getName:e=>aJ.nameMapping[e]},iJ=class{constructor(e){s(this,"name"),s(this,"curls"),s(this,"directions"),s(this,"weights"),s(this,"weightsRelative"),this.name=e,this.curls={},this.directions={},this.weights=[1,1,1,1,1],this.weightsRelative=[1,1,1,1,1]}curl(e,t,n){void 0===this.curls[e]&&(this.curls[e]=[]),this.curls[e].push([t,n])}direction(e,t,n){this.directions[e]||(this.directions[e]=[]),this.directions[e].push([t,n])}weight(e,t){this.weights[e]=t;const n=this.weights.reduce(((e,t)=>e+t),0);this.weightsRelative=this.weights.map((e=>5*e/n))}matchAgainst(e,t){let n=0;for(const t in e){const r=e[t],a=this.curls[t];if(void 0!==a){for(const[e,i]of a)if(r===e){n+=i*this.weightsRelative[t];break}}else n+=this.weightsRelative[t]}for(const e in t){const r=t[e],a=this.directions[e];if(void 0!==a){for(const[t,i]of a)if(r===t){n+=i*this.weightsRelative[e];break}}else n+=this.weightsRelative[e]}return n/10}},{thumb:sJ,index:oJ,middle:lJ,ring:uJ,pinky:dJ}=nJ,{none:cJ,half:hJ,full:pJ}=rJ,{verticalUp:mJ,verticalDown:fJ,horizontalLeft:gJ,horizontalRight:yJ,diagonalUpRight:bJ,diagonalUpLeft:xJ,diagonalDownRight:AJ,diagonalDownLeft:vJ}=aJ,wJ=new iJ("thumbs up");wJ.curl(sJ,cJ,1),wJ.direction(sJ,mJ,1),wJ.direction(sJ,xJ,.25),wJ.direction(sJ,bJ,.25);for(const e of[nJ.index,nJ.middle,nJ.ring,nJ.pinky])wJ.curl(e,pJ,1),wJ.direction(e,gJ,1),wJ.direction(e,yJ,1);var kJ=new iJ("victory");kJ.curl(sJ,hJ,.5),kJ.curl(sJ,cJ,.5),kJ.direction(sJ,mJ,1),kJ.direction(sJ,xJ,1),kJ.curl(oJ,cJ,1),kJ.direction(oJ,mJ,.75),kJ.direction(oJ,xJ,1),kJ.curl(lJ,cJ,1),kJ.direction(lJ,mJ,1),kJ.direction(lJ,xJ,.75),kJ.curl(uJ,pJ,1),kJ.direction(uJ,mJ,.2),kJ.direction(uJ,xJ,1),kJ.direction(uJ,gJ,.2),kJ.curl(dJ,pJ,1),kJ.direction(dJ,mJ,.2),kJ.direction(dJ,xJ,1),kJ.direction(dJ,gJ,.2),kJ.weight(oJ,2),kJ.weight(lJ,2);var SJ=new iJ("point");SJ.curl(sJ,pJ,1),SJ.curl(oJ,cJ,.5),SJ.curl(lJ,pJ,.5),SJ.curl(uJ,pJ,.5),SJ.curl(dJ,pJ,.5),SJ.weight(oJ,2),SJ.weight(lJ,2);var TJ=new iJ("middle finger");TJ.curl(sJ,cJ,1),TJ.curl(oJ,pJ,.5),TJ.curl(lJ,pJ,.5),TJ.curl(uJ,pJ,.5),TJ.curl(dJ,pJ,.5),TJ.weight(oJ,2),TJ.weight(lJ,2);var _J=new iJ("open palm");_J.curl(sJ,cJ,.75),_J.curl(oJ,cJ,.75),_J.curl(lJ,cJ,.75),_J.curl(uJ,cJ,.75),_J.curl(dJ,cJ,.75);var IJ=[wJ,kJ,SJ,TJ,_J],CJ={HALF_CURL_START_LIMIT:60,NO_CURL_START_LIMIT:130,DISTANCE_VOTE_POWER:1.1,SINGLE_ANGLE_VOTE_POWER:.9,TOTAL_ANGLE_VOTE_POWER:1.6};function EJ(e,t,n,r){const a=(t-r)/(e-n);let i=180*Math.atan(a)/Math.PI;return i<=0?i=-i:i>0&&(i=180-i),i}function NJ(e,t){if(!e||!t)return[0,0];const n=EJ(e[0],e[1],t[0],t[1]);return 2===e.length?n:[n,EJ(e[1],e[2],t[1],t[2])]}function RJ(e,t=1){let n=0,r=0,a=0;return e>=75&&e<=105?n=1*t:e>=25&&e<=155?r=1*t:a=1*t,[n,r,a]}function PJ(e,t,n){const r=e[0]-t[0],a=e[0]-n[0],i=t[0]-n[0],s=e[1]-t[1],o=e[1]-n[1],l=t[1]-n[1],u=e[2]-t[2],d=e[2]-n[2],c=t[2]-n[2],h=Math.sqrt(r*r+s*s+u*u),p=Math.sqrt(a*a+o*o+d*d),m=Math.sqrt(i*i+l*l+c*c);let f=(m*m+h*h-p*p)/(2*m*h);f>1?f=1:f<-1&&(f=-1);let g,y=Math.acos(f);return y=57.2958*y%180,g=y>CJ.NO_CURL_START_LIMIT?rJ.none:y>CJ.HALF_CURL_START_LIMIT?rJ.half:rJ.full,g}function DJ(e,t,n,r){let a;return a=r===Math.abs(e)?e>0?aJ.horizontalLeft:aJ.horizontalRight:r===Math.abs(t)?t>0?aJ.horizontalLeft:aJ.horizontalRight:n>0?aJ.horizontalLeft:aJ.horizontalRight,a}function MJ(e,t,n,r){let a;return a=r===Math.abs(e)?e<0?aJ.verticalDown:aJ.verticalUp:r===Math.abs(t)?t<0?aJ.verticalDown:aJ.verticalUp:n<0?aJ.verticalDown:aJ.verticalUp,a}function OJ(e,t,n,r){const a=e[0]-t[0],i=e[0]-n[0],s=t[0]-n[0],o=e[1]-t[1],l=e[1]-n[1],u=t[1]-n[1],d=Math.max(Math.abs(a),Math.abs(i),Math.abs(s)),c=Math.max(Math.abs(o),Math.abs(l),Math.abs(u));let h=0,p=0,m=0;const f=c/(d+1e-5);f>1.5?h+=CJ.DISTANCE_VOTE_POWER:f>.66?p+=CJ.DISTANCE_VOTE_POWER:m+=CJ.DISTANCE_VOTE_POWER;const g=Math.sqrt(a*a+o*o),y=Math.sqrt(i*i+l*l),b=Math.sqrt(s*s+u*u),x=Math.max(g,y,b);let A=e[0],v=e[1],w=n[0],k=n[1];x===g?(w=n[0],k=n[1]):x===b&&(A=t[0],v=t[1]);const S=RJ(NJ([A,v],[w,k]),CJ.TOTAL_ANGLE_VOTE_POWER);h+=S[0],p+=S[1],m+=S[2];for(const e of r){const t=RJ(e,CJ.SINGLE_ANGLE_VOTE_POWER);h+=t[0],p+=t[1],m+=t[2]}let T;return T=h===Math.max(h,p,m)?MJ(l,o,u,c):m===Math.max(p,m)?DJ(i,a,s,d):function(e,t,n,r,a,i,s,o){let l;const u=MJ(e,t,n,r),d=DJ(a,i,s,o);return l=u===aJ.verticalUp?d===aJ.horizontalLeft?aJ.diagonalUpLeft:aJ.diagonalUpRight:d===aJ.horizontalLeft?aJ.diagonalDownLeft:aJ.diagonalDownRight,l}(l,o,u,c,i,a,s,d),T}function $J(e){const t=[],n=[],r=[],a=[];if(!e)return{curls:r,directions:a};for(const r of nJ.all){const a=nJ.getPoints(r),i=[],s=[];for(const t of a){const n=NJ(e[t[0]],e[t[1]]),r=n[0],a=n[1];i.push(r),s.push(a)}t.push(i),n.push(s)}for(const n of nJ.all){const i=n===nJ.thumb?1:0,s=nJ.getPoints(n),o=e[s[i][0]],l=e[s[i+1][1]],u=e[s[3][1]],d=PJ(o,l,u),c=OJ(o,l,u,t[n].slice(i));r[n]=d,a[n]=c}return{curls:r,directions:a}}function FJ(e){if(!e||0===e.length)return null;const t=$J(e),n={};for(const e of nJ.all)n[nJ.getName(e)]={curl:rJ.getName(t.curls[e]),direction:aJ.getName(t.directions[e])};return n}function LJ(e){const t=[];if(!e||0===e.length)return t;const n=$J(e);for(const e of IJ){const r=e.matchAgainst(n.curls,n.directions);r>=.7&&t.push({name:e.name,confidence:r})}return t}var zJ=e=>{if(!e)return[];const t=[];for(let n=0;n<e.length;n++){const r=e[n].keypoints.find((e=>"leftWrist"===e.part)),a=e[n].keypoints.find((e=>"rightWrist"===e.part)),i=e[n].keypoints.find((e=>"nose"===e.part));i&&r&&a&&r.position[1]<i.position[1]&&a.position[1]<i.position[1]?t.push({body:n,gesture:"i give up"}):i&&r&&r.position[1]<i.position[1]?t.push({body:n,gesture:"raise left hand"}):i&&a&&a.position[1]<i.position[1]&&t.push({body:n,gesture:"raise right hand"});const s=e[n].keypoints.find((e=>"leftShoulder"===e.part)),o=e[n].keypoints.find((e=>"rightShoulder"===e.part));s&&o&&Math.abs(s.positionRaw[1]-o.positionRaw[1])>.1&&t.push({body:n,gesture:"leaning "+(s.position[1]>o.position[1]?"left":"right")})}return t},BJ=e=>{if(!e)return[];const t=[];for(let n=0;n<e.length;n++)if(e[n].mesh&&e[n].mesh.length>450){const r=(e[n].mesh[33][2]||0)-(e[n].mesh[263][2]||0),a=e[n].mesh[33][0]-e[n].mesh[263][0];Math.abs(r/a)<=.15?t.push({face:n,gesture:"facing center"}):t.push({face:n,gesture:"facing "+(r<0?"left":"right")}),Math.abs(e[n].mesh[374][1]-e[n].mesh[386][1])/Math.abs(e[n].mesh[443][1]-e[n].mesh[450][1])<.2&&t.push({face:n,gesture:"blink left eye"}),Math.abs(e[n].mesh[145][1]-e[n].mesh[159][1])/Math.abs(e[n].mesh[223][1]-e[n].mesh[230][1])<.2&&t.push({face:n,gesture:"blink right eye"});const i=Math.min(100,500*Math.abs(e[n].mesh[13][1]-e[n].mesh[14][1])/Math.abs(e[n].mesh[10][1]-e[n].mesh[152][1]));i>10&&t.push({face:n,gesture:`mouth ${Math.trunc(i)}% open`});const s=e[n].mesh[152][2]||0;Math.abs(s)>10&&t.push({face:n,gesture:"head "+(s<0?"up":"down")})}return t},UJ=e=>{var t,n,r,a;if(!e)return[];const i=[];for(let s=0;s<e.length;s++){if(!(null==(n=null==(t=e[s].annotations)?void 0:t.leftEyeIris)?void 0:n[0])||!(null==(a=null==(r=e[s].annotations)?void 0:r.rightEyeIris)?void 0:a[0]))continue;const o=e[s].annotations.leftEyeIris[3][0]-e[s].annotations.leftEyeIris[1][0],l=e[s].annotations.leftEyeIris[4][1]-e[s].annotations.leftEyeIris[2][1],u=Math.abs(o*l),d=e[s].annotations.rightEyeIris[3][0]-e[s].annotations.rightEyeIris[1][0],c=e[s].annotations.rightEyeIris[4][1]-e[s].annotations.rightEyeIris[2][1],h=Math.abs(d*c);let p=!1;Math.abs(u-h)/Math.max(u,h)<.25&&(p=!0,i.push({iris:s,gesture:"facing center"}));const m=Math.abs(e[s].mesh[263][0]-e[s].annotations.leftEyeIris[0][0])/e[s].box[2],f=Math.abs(e[s].mesh[33][0]-e[s].annotations.rightEyeIris[0][0])/e[s].box[2];(m>.06||f>.06)&&(p=!1),m>f?f>.04&&i.push({iris:s,gesture:"looking right"}):m>.04&&i.push({iris:s,gesture:"looking left"});const g=Math.abs(e[s].mesh[145][1]-e[s].annotations.rightEyeIris[0][1])/e[s].box[3],y=Math.abs(e[s].mesh[374][1]-e[s].annotations.leftEyeIris[0][1])/e[s].box[3];(y<.01||g<.01||y>.022||g>.022)&&(p=!1),(y<.01||g<.01)&&i.push({iris:s,gesture:"looking down"}),(y>.022||g>.022)&&i.push({iris:s,gesture:"looking up"}),p&&i.push({iris:s,gesture:"looking center"})}return i},WJ=e=>{if(!e)return[];const t=[];for(let n=0;n<e.length;n++){const r=[];if(e[n].annotations)for(const[t,a]of Object.entries(e[n].annotations))"palmBase"!==t&&Array.isArray(a)&&a[0]&&r.push({name:t.toLowerCase(),position:a[0]});if(r&&r.length>0){const e=r.reduce(((e,t)=>(e.position[2]||0)<(t.position[2]||0)?e:t));t.push({hand:n,gesture:`${e.name} forward`});const a=r.reduce(((e,t)=>e.position[1]<t.position[1]?e:t));t.push({hand:n,gesture:`${a.name} up`})}if(e[n].keypoints){const r=LJ(e[n].keypoints);for(const e of r)t.push({hand:n,gesture:e.name})}}return t};function VJ(e){return[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])]}function jJ(e){return[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2]}function HJ(e,t,n){const r=t.shape[1],a=t.shape[2],i=[[e.startPoint[1]/r,e.startPoint[0]/a,e.endPoint[1]/r,e.endPoint[0]/a]];return hp.cropAndResize(t,i,[0],n)}function GJ(e,t){return{startPoint:[e.startPoint[0]*t[0],e.startPoint[1]*t[1]],endPoint:[e.endPoint[0]*t[0],e.endPoint[1]*t[1]],palmLandmarks:e.palmLandmarks.map((e=>[e[0]*t[0],e[1]*t[1]])),confidence:e.confidence}}function qJ(e,t=1.5){const n=jJ(e),r=VJ(e),a=[t*r[0]/2,t*r[1]/2];return{startPoint:[n[0]-a[0],n[1]-a[1]],endPoint:[n[0]+a[0],n[1]+a[1]],palmLandmarks:e.palmLandmarks}}function XJ(e){const t=jJ(e),n=VJ(e),r=Math.max(...n)/2;return{startPoint:[t[0]-r,t[1]-r],endPoint:[t[0]+r,t[1]+r],palmLandmarks:e.palmLandmarks}}function KJ(e,t){return(n=Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]))-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI));var n}var ZJ=(e,t)=>[[1,0,e],[0,1,t],[0,0,1]];function YJ(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}function JJ(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e[r][t]);return n}function QJ(e,t){const n=[],r=e.length;for(let a=0;a<r;a++){n.push([]);for(let i=0;i<r;i++)n[a].push(YJ(e[a],JJ(t,i)))}return n}function eQ(e,t){const n=Math.cos(e),r=Math.sin(e),a=[[n,-r,0],[r,n,0],[0,0,1]],i=QJ(ZJ(t[0],t[1]),a);return QJ(i,ZJ(-t[0],-t[1]))}function tQ(e,t){return[YJ(e,t[0]),YJ(e,t[1])]}var nQ,rQ,aQ,iQ=[{x:.015625,y:.015625},{x:.015625,y:.015625},{x:.046875,y:.015625},{x:.046875,y:.015625},{x:.078125,y:.015625},{x:.078125,y:.015625},{x:.109375,y:.015625},{x:.109375,y:.015625},{x:.140625,y:.015625},{x:.140625,y:.015625},{x:.171875,y:.015625},{x:.171875,y:.015625},{x:.203125,y:.015625},{x:.203125,y:.015625},{x:.234375,y:.015625},{x:.234375,y:.015625},{x:.265625,y:.015625},{x:.265625,y:.015625},{x:.296875,y:.015625},{x:.296875,y:.015625},{x:.328125,y:.015625},{x:.328125,y:.015625},{x:.359375,y:.015625},{x:.359375,y:.015625},{x:.390625,y:.015625},{x:.390625,y:.015625},{x:.421875,y:.015625},{x:.421875,y:.015625},{x:.453125,y:.015625},{x:.453125,y:.015625},{x:.484375,y:.015625},{x:.484375,y:.015625},{x:.515625,y:.015625},{x:.515625,y:.015625},{x:.546875,y:.015625},{x:.546875,y:.015625},{x:.578125,y:.015625},{x:.578125,y:.015625},{x:.609375,y:.015625},{x:.609375,y:.015625},{x:.640625,y:.015625},{x:.640625,y:.015625},{x:.671875,y:.015625},{x:.671875,y:.015625},{x:.703125,y:.015625},{x:.703125,y:.015625},{x:.734375,y:.015625},{x:.734375,y:.015625},{x:.765625,y:.015625},{x:.765625,y:.015625},{x:.796875,y:.015625},{x:.796875,y:.015625},{x:.828125,y:.015625},{x:.828125,y:.015625},{x:.859375,y:.015625},{x:.859375,y:.015625},{x:.890625,y:.015625},{x:.890625,y:.015625},{x:.921875,y:.015625},{x:.921875,y:.015625},{x:.953125,y:.015625},{x:.953125,y:.015625},{x:.984375,y:.015625},{x:.984375,y:.015625},{x:.015625,y:.046875},{x:.015625,y:.046875},{x:.046875,y:.046875},{x:.046875,y:.046875},{x:.078125,y:.046875},{x:.078125,y:.046875},{x:.109375,y:.046875},{x:.109375,y:.046875},{x:.140625,y:.046875},{x:.140625,y:.046875},{x:.171875,y:.046875},{x:.171875,y:.046875},{x:.203125,y:.046875},{x:.203125,y:.046875},{x:.234375,y:.046875},{x:.234375,y:.046875},{x:.265625,y:.046875},{x:.265625,y:.046875},{x:.296875,y:.046875},{x:.296875,y:.046875},{x:.328125,y:.046875},{x:.328125,y:.046875},{x:.359375,y:.046875},{x:.359375,y:.046875},{x:.390625,y:.046875},{x:.390625,y:.046875},{x:.421875,y:.046875},{x:.421875,y:.046875},{x:.453125,y:.046875},{x:.453125,y:.046875},{x:.484375,y:.046875},{x:.484375,y:.046875},{x:.515625,y:.046875},{x:.515625,y:.046875},{x:.546875,y:.046875},{x:.546875,y:.046875},{x:.578125,y:.046875},{x:.578125,y:.046875},{x:.609375,y:.046875},{x:.609375,y:.046875},{x:.640625,y:.046875},{x:.640625,y:.046875},{x:.671875,y:.046875},{x:.671875,y:.046875},{x:.703125,y:.046875},{x:.703125,y:.046875},{x:.734375,y:.046875},{x:.734375,y:.046875},{x:.765625,y:.046875},{x:.765625,y:.046875},{x:.796875,y:.046875},{x:.796875,y:.046875},{x:.828125,y:.046875},{x:.828125,y:.046875},{x:.859375,y:.046875},{x:.859375,y:.046875},{x:.890625,y:.046875},{x:.890625,y:.046875},{x:.921875,y:.046875},{x:.921875,y:.046875},{x:.953125,y:.046875},{x:.953125,y:.046875},{x:.984375,y:.046875},{x:.984375,y:.046875},{x:.015625,y:.078125},{x:.015625,y:.078125},{x:.046875,y:.078125},{x:.046875,y:.078125},{x:.078125,y:.078125},{x:.078125,y:.078125},{x:.109375,y:.078125},{x:.109375,y:.078125},{x:.140625,y:.078125},{x:.140625,y:.078125},{x:.171875,y:.078125},{x:.171875,y:.078125},{x:.203125,y:.078125},{x:.203125,y:.078125},{x:.234375,y:.078125},{x:.234375,y:.078125},{x:.265625,y:.078125},{x:.265625,y:.078125},{x:.296875,y:.078125},{x:.296875,y:.078125},{x:.328125,y:.078125},{x:.328125,y:.078125},{x:.359375,y:.078125},{x:.359375,y:.078125},{x:.390625,y:.078125},{x:.390625,y:.078125},{x:.421875,y:.078125},{x:.421875,y:.078125},{x:.453125,y:.078125},{x:.453125,y:.078125},{x:.484375,y:.078125},{x:.484375,y:.078125},{x:.515625,y:.078125},{x:.515625,y:.078125},{x:.546875,y:.078125},{x:.546875,y:.078125},{x:.578125,y:.078125},{x:.578125,y:.078125},{x:.609375,y:.078125},{x:.609375,y:.078125},{x:.640625,y:.078125},{x:.640625,y:.078125},{x:.671875,y:.078125},{x:.671875,y:.078125},{x:.703125,y:.078125},{x:.703125,y:.078125},{x:.734375,y:.078125},{x:.734375,y:.078125},{x:.765625,y:.078125},{x:.765625,y:.078125},{x:.796875,y:.078125},{x:.796875,y:.078125},{x:.828125,y:.078125},{x:.828125,y:.078125},{x:.859375,y:.078125},{x:.859375,y:.078125},{x:.890625,y:.078125},{x:.890625,y:.078125},{x:.921875,y:.078125},{x:.921875,y:.078125},{x:.953125,y:.078125},{x:.953125,y:.078125},{x:.984375,y:.078125},{x:.984375,y:.078125},{x:.015625,y:.109375},{x:.015625,y:.109375},{x:.046875,y:.109375},{x:.046875,y:.109375},{x:.078125,y:.109375},{x:.078125,y:.109375},{x:.109375,y:.109375},{x:.109375,y:.109375},{x:.140625,y:.109375},{x:.140625,y:.109375},{x:.171875,y:.109375},{x:.171875,y:.109375},{x:.203125,y:.109375},{x:.203125,y:.109375},{x:.234375,y:.109375},{x:.234375,y:.109375},{x:.265625,y:.109375},{x:.265625,y:.109375},{x:.296875,y:.109375},{x:.296875,y:.109375},{x:.328125,y:.109375},{x:.328125,y:.109375},{x:.359375,y:.109375},{x:.359375,y:.109375},{x:.390625,y:.109375},{x:.390625,y:.109375},{x:.421875,y:.109375},{x:.421875,y:.109375},{x:.453125,y:.109375},{x:.453125,y:.109375},{x:.484375,y:.109375},{x:.484375,y:.109375},{x:.515625,y:.109375},{x:.515625,y:.109375},{x:.546875,y:.109375},{x:.546875,y:.109375},{x:.578125,y:.109375},{x:.578125,y:.109375},{x:.609375,y:.109375},{x:.609375,y:.109375},{x:.640625,y:.109375},{x:.640625,y:.109375},{x:.671875,y:.109375},{x:.671875,y:.109375},{x:.703125,y:.109375},{x:.703125,y:.109375},{x:.734375,y:.109375},{x:.734375,y:.109375},{x:.765625,y:.109375},{x:.765625,y:.109375},{x:.796875,y:.109375},{x:.796875,y:.109375},{x:.828125,y:.109375},{x:.828125,y:.109375},{x:.859375,y:.109375},{x:.859375,y:.109375},{x:.890625,y:.109375},{x:.890625,y:.109375},{x:.921875,y:.109375},{x:.921875,y:.109375},{x:.953125,y:.109375},{x:.953125,y:.109375},{x:.984375,y:.109375},{x:.984375,y:.109375},{x:.015625,y:.140625},{x:.015625,y:.140625},{x:.046875,y:.140625},{x:.046875,y:.140625},{x:.078125,y:.140625},{x:.078125,y:.140625},{x:.109375,y:.140625},{x:.109375,y:.140625},{x:.140625,y:.140625},{x:.140625,y:.140625},{x:.171875,y:.140625},{x:.171875,y:.140625},{x:.203125,y:.140625},{x:.203125,y:.140625},{x:.234375,y:.140625},{x:.234375,y:.140625},{x:.265625,y:.140625},{x:.265625,y:.140625},{x:.296875,y:.140625},{x:.296875,y:.140625},{x:.328125,y:.140625},{x:.328125,y:.140625},{x:.359375,y:.140625},{x:.359375,y:.140625},{x:.390625,y:.140625},{x:.390625,y:.140625},{x:.421875,y:.140625},{x:.421875,y:.140625},{x:.453125,y:.140625},{x:.453125,y:.140625},{x:.484375,y:.140625},{x:.484375,y:.140625},{x:.515625,y:.140625},{x:.515625,y:.140625},{x:.546875,y:.140625},{x:.546875,y:.140625},{x:.578125,y:.140625},{x:.578125,y:.140625},{x:.609375,y:.140625},{x:.609375,y:.140625},{x:.640625,y:.140625},{x:.640625,y:.140625},{x:.671875,y:.140625},{x:.671875,y:.140625},{x:.703125,y:.140625},{x:.703125,y:.140625},{x:.734375,y:.140625},{x:.734375,y:.140625},{x:.765625,y:.140625},{x:.765625,y:.140625},{x:.796875,y:.140625},{x:.796875,y:.140625},{x:.828125,y:.140625},{x:.828125,y:.140625},{x:.859375,y:.140625},{x:.859375,y:.140625},{x:.890625,y:.140625},{x:.890625,y:.140625},{x:.921875,y:.140625},{x:.921875,y:.140625},{x:.953125,y:.140625},{x:.953125,y:.140625},{x:.984375,y:.140625},{x:.984375,y:.140625},{x:.015625,y:.171875},{x:.015625,y:.171875},{x:.046875,y:.171875},{x:.046875,y:.171875},{x:.078125,y:.171875},{x:.078125,y:.171875},{x:.109375,y:.171875},{x:.109375,y:.171875},{x:.140625,y:.171875},{x:.140625,y:.171875},{x:.171875,y:.171875},{x:.171875,y:.171875},{x:.203125,y:.171875},{x:.203125,y:.171875},{x:.234375,y:.171875},{x:.234375,y:.171875},{x:.265625,y:.171875},{x:.265625,y:.171875},{x:.296875,y:.171875},{x:.296875,y:.171875},{x:.328125,y:.171875},{x:.328125,y:.171875},{x:.359375,y:.171875},{x:.359375,y:.171875},{x:.390625,y:.171875},{x:.390625,y:.171875},{x:.421875,y:.171875},{x:.421875,y:.171875},{x:.453125,y:.171875},{x:.453125,y:.171875},{x:.484375,y:.171875},{x:.484375,y:.171875},{x:.515625,y:.171875},{x:.515625,y:.171875},{x:.546875,y:.171875},{x:.546875,y:.171875},{x:.578125,y:.171875},{x:.578125,y:.171875},{x:.609375,y:.171875},{x:.609375,y:.171875},{x:.640625,y:.171875},{x:.640625,y:.171875},{x:.671875,y:.171875},{x:.671875,y:.171875},{x:.703125,y:.171875},{x:.703125,y:.171875},{x:.734375,y:.171875},{x:.734375,y:.171875},{x:.765625,y:.171875},{x:.765625,y:.171875},{x:.796875,y:.171875},{x:.796875,y:.171875},{x:.828125,y:.171875},{x:.828125,y:.171875},{x:.859375,y:.171875},{x:.859375,y:.171875},{x:.890625,y:.171875},{x:.890625,y:.171875},{x:.921875,y:.171875},{x:.921875,y:.171875},{x:.953125,y:.171875},{x:.953125,y:.171875},{x:.984375,y:.171875},{x:.984375,y:.171875},{x:.015625,y:.203125},{x:.015625,y:.203125},{x:.046875,y:.203125},{x:.046875,y:.203125},{x:.078125,y:.203125},{x:.078125,y:.203125},{x:.109375,y:.203125},{x:.109375,y:.203125},{x:.140625,y:.203125},{x:.140625,y:.203125},{x:.171875,y:.203125},{x:.171875,y:.203125},{x:.203125,y:.203125},{x:.203125,y:.203125},{x:.234375,y:.203125},{x:.234375,y:.203125},{x:.265625,y:.203125},{x:.265625,y:.203125},{x:.296875,y:.203125},{x:.296875,y:.203125},{x:.328125,y:.203125},{x:.328125,y:.203125},{x:.359375,y:.203125},{x:.359375,y:.203125},{x:.390625,y:.203125},{x:.390625,y:.203125},{x:.421875,y:.203125},{x:.421875,y:.203125},{x:.453125,y:.203125},{x:.453125,y:.203125},{x:.484375,y:.203125},{x:.484375,y:.203125},{x:.515625,y:.203125},{x:.515625,y:.203125},{x:.546875,y:.203125},{x:.546875,y:.203125},{x:.578125,y:.203125},{x:.578125,y:.203125},{x:.609375,y:.203125},{x:.609375,y:.203125},{x:.640625,y:.203125},{x:.640625,y:.203125},{x:.671875,y:.203125},{x:.671875,y:.203125},{x:.703125,y:.203125},{x:.703125,y:.203125},{x:.734375,y:.203125},{x:.734375,y:.203125},{x:.765625,y:.203125},{x:.765625,y:.203125},{x:.796875,y:.203125},{x:.796875,y:.203125},{x:.828125,y:.203125},{x:.828125,y:.203125},{x:.859375,y:.203125},{x:.859375,y:.203125},{x:.890625,y:.203125},{x:.890625,y:.203125},{x:.921875,y:.203125},{x:.921875,y:.203125},{x:.953125,y:.203125},{x:.953125,y:.203125},{x:.984375,y:.203125},{x:.984375,y:.203125},{x:.015625,y:.234375},{x:.015625,y:.234375},{x:.046875,y:.234375},{x:.046875,y:.234375},{x:.078125,y:.234375},{x:.078125,y:.234375},{x:.109375,y:.234375},{x:.109375,y:.234375},{x:.140625,y:.234375},{x:.140625,y:.234375},{x:.171875,y:.234375},{x:.171875,y:.234375},{x:.203125,y:.234375},{x:.203125,y:.234375},{x:.234375,y:.234375},{x:.234375,y:.234375},{x:.265625,y:.234375},{x:.265625,y:.234375},{x:.296875,y:.234375},{x:.296875,y:.234375},{x:.328125,y:.234375},{x:.328125,y:.234375},{x:.359375,y:.234375},{x:.359375,y:.234375},{x:.390625,y:.234375},{x:.390625,y:.234375},{x:.421875,y:.234375},{x:.421875,y:.234375},{x:.453125,y:.234375},{x:.453125,y:.234375},{x:.484375,y:.234375},{x:.484375,y:.234375},{x:.515625,y:.234375},{x:.515625,y:.234375},{x:.546875,y:.234375},{x:.546875,y:.234375},{x:.578125,y:.234375},{x:.578125,y:.234375},{x:.609375,y:.234375},{x:.609375,y:.234375},{x:.640625,y:.234375},{x:.640625,y:.234375},{x:.671875,y:.234375},{x:.671875,y:.234375},{x:.703125,y:.234375},{x:.703125,y:.234375},{x:.734375,y:.234375},{x:.734375,y:.234375},{x:.765625,y:.234375},{x:.765625,y:.234375},{x:.796875,y:.234375},{x:.796875,y:.234375},{x:.828125,y:.234375},{x:.828125,y:.234375},{x:.859375,y:.234375},{x:.859375,y:.234375},{x:.890625,y:.234375},{x:.890625,y:.234375},{x:.921875,y:.234375},{x:.921875,y:.234375},{x:.953125,y:.234375},{x:.953125,y:.234375},{x:.984375,y:.234375},{x:.984375,y:.234375},{x:.015625,y:.265625},{x:.015625,y:.265625},{x:.046875,y:.265625},{x:.046875,y:.265625},{x:.078125,y:.265625},{x:.078125,y:.265625},{x:.109375,y:.265625},{x:.109375,y:.265625},{x:.140625,y:.265625},{x:.140625,y:.265625},{x:.171875,y:.265625},{x:.171875,y:.265625},{x:.203125,y:.265625},{x:.203125,y:.265625},{x:.234375,y:.265625},{x:.234375,y:.265625},{x:.265625,y:.265625},{x:.265625,y:.265625},{x:.296875,y:.265625},{x:.296875,y:.265625},{x:.328125,y:.265625},{x:.328125,y:.265625},{x:.359375,y:.265625},{x:.359375,y:.265625},{x:.390625,y:.265625},{x:.390625,y:.265625},{x:.421875,y:.265625},{x:.421875,y:.265625},{x:.453125,y:.265625},{x:.453125,y:.265625},{x:.484375,y:.265625},{x:.484375,y:.265625},{x:.515625,y:.265625},{x:.515625,y:.265625},{x:.546875,y:.265625},{x:.546875,y:.265625},{x:.578125,y:.265625},{x:.578125,y:.265625},{x:.609375,y:.265625},{x:.609375,y:.265625},{x:.640625,y:.265625},{x:.640625,y:.265625},{x:.671875,y:.265625},{x:.671875,y:.265625},{x:.703125,y:.265625},{x:.703125,y:.265625},{x:.734375,y:.265625},{x:.734375,y:.265625},{x:.765625,y:.265625},{x:.765625,y:.265625},{x:.796875,y:.265625},{x:.796875,y:.265625},{x:.828125,y:.265625},{x:.828125,y:.265625},{x:.859375,y:.265625},{x:.859375,y:.265625},{x:.890625,y:.265625},{x:.890625,y:.265625},{x:.921875,y:.265625},{x:.921875,y:.265625},{x:.953125,y:.265625},{x:.953125,y:.265625},{x:.984375,y:.265625},{x:.984375,y:.265625},{x:.015625,y:.296875},{x:.015625,y:.296875},{x:.046875,y:.296875},{x:.046875,y:.296875},{x:.078125,y:.296875},{x:.078125,y:.296875},{x:.109375,y:.296875},{x:.109375,y:.296875},{x:.140625,y:.296875},{x:.140625,y:.296875},{x:.171875,y:.296875},{x:.171875,y:.296875},{x:.203125,y:.296875},{x:.203125,y:.296875},{x:.234375,y:.296875},{x:.234375,y:.296875},{x:.265625,y:.296875},{x:.265625,y:.296875},{x:.296875,y:.296875},{x:.296875,y:.296875},{x:.328125,y:.296875},{x:.328125,y:.296875},{x:.359375,y:.296875},{x:.359375,y:.296875},{x:.390625,y:.296875},{x:.390625,y:.296875},{x:.421875,y:.296875},{x:.421875,y:.296875},{x:.453125,y:.296875},{x:.453125,y:.296875},{x:.484375,y:.296875},{x:.484375,y:.296875},{x:.515625,y:.296875},{x:.515625,y:.296875},{x:.546875,y:.296875},{x:.546875,y:.296875},{x:.578125,y:.296875},{x:.578125,y:.296875},{x:.609375,y:.296875},{x:.609375,y:.296875},{x:.640625,y:.296875},{x:.640625,y:.296875},{x:.671875,y:.296875},{x:.671875,y:.296875},{x:.703125,y:.296875},{x:.703125,y:.296875},{x:.734375,y:.296875},{x:.734375,y:.296875},{x:.765625,y:.296875},{x:.765625,y:.296875},{x:.796875,y:.296875},{x:.796875,y:.296875},{x:.828125,y:.296875},{x:.828125,y:.296875},{x:.859375,y:.296875},{x:.859375,y:.296875},{x:.890625,y:.296875},{x:.890625,y:.296875},{x:.921875,y:.296875},{x:.921875,y:.296875},{x:.953125,y:.296875},{x:.953125,y:.296875},{x:.984375,y:.296875},{x:.984375,y:.296875},{x:.015625,y:.328125},{x:.015625,y:.328125},{x:.046875,y:.328125},{x:.046875,y:.328125},{x:.078125,y:.328125},{x:.078125,y:.328125},{x:.109375,y:.328125},{x:.109375,y:.328125},{x:.140625,y:.328125},{x:.140625,y:.328125},{x:.171875,y:.328125},{x:.171875,y:.328125},{x:.203125,y:.328125},{x:.203125,y:.328125},{x:.234375,y:.328125},{x:.234375,y:.328125},{x:.265625,y:.328125},{x:.265625,y:.328125},{x:.296875,y:.328125},{x:.296875,y:.328125},{x:.328125,y:.328125},{x:.328125,y:.328125},{x:.359375,y:.328125},{x:.359375,y:.328125},{x:.390625,y:.328125},{x:.390625,y:.328125},{x:.421875,y:.328125},{x:.421875,y:.328125},{x:.453125,y:.328125},{x:.453125,y:.328125},{x:.484375,y:.328125},{x:.484375,y:.328125},{x:.515625,y:.328125},{x:.515625,y:.328125},{x:.546875,y:.328125},{x:.546875,y:.328125},{x:.578125,y:.328125},{x:.578125,y:.328125},{x:.609375,y:.328125},{x:.609375,y:.328125},{x:.640625,y:.328125},{x:.640625,y:.328125},{x:.671875,y:.328125},{x:.671875,y:.328125},{x:.703125,y:.328125},{x:.703125,y:.328125},{x:.734375,y:.328125},{x:.734375,y:.328125},{x:.765625,y:.328125},{x:.765625,y:.328125},{x:.796875,y:.328125},{x:.796875,y:.328125},{x:.828125,y:.328125},{x:.828125,y:.328125},{x:.859375,y:.328125},{x:.859375,y:.328125},{x:.890625,y:.328125},{x:.890625,y:.328125},{x:.921875,y:.328125},{x:.921875,y:.328125},{x:.953125,y:.328125},{x:.953125,y:.328125},{x:.984375,y:.328125},{x:.984375,y:.328125},{x:.015625,y:.359375},{x:.015625,y:.359375},{x:.046875,y:.359375},{x:.046875,y:.359375},{x:.078125,y:.359375},{x:.078125,y:.359375},{x:.109375,y:.359375},{x:.109375,y:.359375},{x:.140625,y:.359375},{x:.140625,y:.359375},{x:.171875,y:.359375},{x:.171875,y:.359375},{x:.203125,y:.359375},{x:.203125,y:.359375},{x:.234375,y:.359375},{x:.234375,y:.359375},{x:.265625,y:.359375},{x:.265625,y:.359375},{x:.296875,y:.359375},{x:.296875,y:.359375},{x:.328125,y:.359375},{x:.328125,y:.359375},{x:.359375,y:.359375},{x:.359375,y:.359375},{x:.390625,y:.359375},{x:.390625,y:.359375},{x:.421875,y:.359375},{x:.421875,y:.359375},{x:.453125,y:.359375},{x:.453125,y:.359375},{x:.484375,y:.359375},{x:.484375,y:.359375},{x:.515625,y:.359375},{x:.515625,y:.359375},{x:.546875,y:.359375},{x:.546875,y:.359375},{x:.578125,y:.359375},{x:.578125,y:.359375},{x:.609375,y:.359375},{x:.609375,y:.359375},{x:.640625,y:.359375},{x:.640625,y:.359375},{x:.671875,y:.359375},{x:.671875,y:.359375},{x:.703125,y:.359375},{x:.703125,y:.359375},{x:.734375,y:.359375},{x:.734375,y:.359375},{x:.765625,y:.359375},{x:.765625,y:.359375},{x:.796875,y:.359375},{x:.796875,y:.359375},{x:.828125,y:.359375},{x:.828125,y:.359375},{x:.859375,y:.359375},{x:.859375,y:.359375},{x:.890625,y:.359375},{x:.890625,y:.359375},{x:.921875,y:.359375},{x:.921875,y:.359375},{x:.953125,y:.359375},{x:.953125,y:.359375},{x:.984375,y:.359375},{x:.984375,y:.359375},{x:.015625,y:.390625},{x:.015625,y:.390625},{x:.046875,y:.390625},{x:.046875,y:.390625},{x:.078125,y:.390625},{x:.078125,y:.390625},{x:.109375,y:.390625},{x:.109375,y:.390625},{x:.140625,y:.390625},{x:.140625,y:.390625},{x:.171875,y:.390625},{x:.171875,y:.390625},{x:.203125,y:.390625},{x:.203125,y:.390625},{x:.234375,y:.390625},{x:.234375,y:.390625},{x:.265625,y:.390625},{x:.265625,y:.390625},{x:.296875,y:.390625},{x:.296875,y:.390625},{x:.328125,y:.390625},{x:.328125,y:.390625},{x:.359375,y:.390625},{x:.359375,y:.390625},{x:.390625,y:.390625},{x:.390625,y:.390625},{x:.421875,y:.390625},{x:.421875,y:.390625},{x:.453125,y:.390625},{x:.453125,y:.390625},{x:.484375,y:.390625},{x:.484375,y:.390625},{x:.515625,y:.390625},{x:.515625,y:.390625},{x:.546875,y:.390625},{x:.546875,y:.390625},{x:.578125,y:.390625},{x:.578125,y:.390625},{x:.609375,y:.390625},{x:.609375,y:.390625},{x:.640625,y:.390625},{x:.640625,y:.390625},{x:.671875,y:.390625},{x:.671875,y:.390625},{x:.703125,y:.390625},{x:.703125,y:.390625},{x:.734375,y:.390625},{x:.734375,y:.390625},{x:.765625,y:.390625},{x:.765625,y:.390625},{x:.796875,y:.390625},{x:.796875,y:.390625},{x:.828125,y:.390625},{x:.828125,y:.390625},{x:.859375,y:.390625},{x:.859375,y:.390625},{x:.890625,y:.390625},{x:.890625,y:.390625},{x:.921875,y:.390625},{x:.921875,y:.390625},{x:.953125,y:.390625},{x:.953125,y:.390625},{x:.984375,y:.390625},{x:.984375,y:.390625},{x:.015625,y:.421875},{x:.015625,y:.421875},{x:.046875,y:.421875},{x:.046875,y:.421875},{x:.078125,y:.421875},{x:.078125,y:.421875},{x:.109375,y:.421875},{x:.109375,y:.421875},{x:.140625,y:.421875},{x:.140625,y:.421875},{x:.171875,y:.421875},{x:.171875,y:.421875},{x:.203125,y:.421875},{x:.203125,y:.421875},{x:.234375,y:.421875},{x:.234375,y:.421875},{x:.265625,y:.421875},{x:.265625,y:.421875},{x:.296875,y:.421875},{x:.296875,y:.421875},{x:.328125,y:.421875},{x:.328125,y:.421875},{x:.359375,y:.421875},{x:.359375,y:.421875},{x:.390625,y:.421875},{x:.390625,y:.421875},{x:.421875,y:.421875},{x:.421875,y:.421875},{x:.453125,y:.421875},{x:.453125,y:.421875},{x:.484375,y:.421875},{x:.484375,y:.421875},{x:.515625,y:.421875},{x:.515625,y:.421875},{x:.546875,y:.421875},{x:.546875,y:.421875},{x:.578125,y:.421875},{x:.578125,y:.421875},{x:.609375,y:.421875},{x:.609375,y:.421875},{x:.640625,y:.421875},{x:.640625,y:.421875},{x:.671875,y:.421875},{x:.671875,y:.421875},{x:.703125,y:.421875},{x:.703125,y:.421875},{x:.734375,y:.421875},{x:.734375,y:.421875},{x:.765625,y:.421875},{x:.765625,y:.421875},{x:.796875,y:.421875},{x:.796875,y:.421875},{x:.828125,y:.421875},{x:.828125,y:.421875},{x:.859375,y:.421875},{x:.859375,y:.421875},{x:.890625,y:.421875},{x:.890625,y:.421875},{x:.921875,y:.421875},{x:.921875,y:.421875},{x:.953125,y:.421875},{x:.953125,y:.421875},{x:.984375,y:.421875},{x:.984375,y:.421875},{x:.015625,y:.453125},{x:.015625,y:.453125},{x:.046875,y:.453125},{x:.046875,y:.453125},{x:.078125,y:.453125},{x:.078125,y:.453125},{x:.109375,y:.453125},{x:.109375,y:.453125},{x:.140625,y:.453125},{x:.140625,y:.453125},{x:.171875,y:.453125},{x:.171875,y:.453125},{x:.203125,y:.453125},{x:.203125,y:.453125},{x:.234375,y:.453125},{x:.234375,y:.453125},{x:.265625,y:.453125},{x:.265625,y:.453125},{x:.296875,y:.453125},{x:.296875,y:.453125},{x:.328125,y:.453125},{x:.328125,y:.453125},{x:.359375,y:.453125},{x:.359375,y:.453125},{x:.390625,y:.453125},{x:.390625,y:.453125},{x:.421875,y:.453125},{x:.421875,y:.453125},{x:.453125,y:.453125},{x:.453125,y:.453125},{x:.484375,y:.453125},{x:.484375,y:.453125},{x:.515625,y:.453125},{x:.515625,y:.453125},{x:.546875,y:.453125},{x:.546875,y:.453125},{x:.578125,y:.453125},{x:.578125,y:.453125},{x:.609375,y:.453125},{x:.609375,y:.453125},{x:.640625,y:.453125},{x:.640625,y:.453125},{x:.671875,y:.453125},{x:.671875,y:.453125},{x:.703125,y:.453125},{x:.703125,y:.453125},{x:.734375,y:.453125},{x:.734375,y:.453125},{x:.765625,y:.453125},{x:.765625,y:.453125},{x:.796875,y:.453125},{x:.796875,y:.453125},{x:.828125,y:.453125},{x:.828125,y:.453125},{x:.859375,y:.453125},{x:.859375,y:.453125},{x:.890625,y:.453125},{x:.890625,y:.453125},{x:.921875,y:.453125},{x:.921875,y:.453125},{x:.953125,y:.453125},{x:.953125,y:.453125},{x:.984375,y:.453125},{x:.984375,y:.453125},{x:.015625,y:.484375},{x:.015625,y:.484375},{x:.046875,y:.484375},{x:.046875,y:.484375},{x:.078125,y:.484375},{x:.078125,y:.484375},{x:.109375,y:.484375},{x:.109375,y:.484375},{x:.140625,y:.484375},{x:.140625,y:.484375},{x:.171875,y:.484375},{x:.171875,y:.484375},{x:.203125,y:.484375},{x:.203125,y:.484375},{x:.234375,y:.484375},{x:.234375,y:.484375},{x:.265625,y:.484375},{x:.265625,y:.484375},{x:.296875,y:.484375},{x:.296875,y:.484375},{x:.328125,y:.484375},{x:.328125,y:.484375},{x:.359375,y:.484375},{x:.359375,y:.484375},{x:.390625,y:.484375},{x:.390625,y:.484375},{x:.421875,y:.484375},{x:.421875,y:.484375},{x:.453125,y:.484375},{x:.453125,y:.484375},{x:.484375,y:.484375},{x:.484375,y:.484375},{x:.515625,y:.484375},{x:.515625,y:.484375},{x:.546875,y:.484375},{x:.546875,y:.484375},{x:.578125,y:.484375},{x:.578125,y:.484375},{x:.609375,y:.484375},{x:.609375,y:.484375},{x:.640625,y:.484375},{x:.640625,y:.484375},{x:.671875,y:.484375},{x:.671875,y:.484375},{x:.703125,y:.484375},{x:.703125,y:.484375},{x:.734375,y:.484375},{x:.734375,y:.484375},{x:.765625,y:.484375},{x:.765625,y:.484375},{x:.796875,y:.484375},{x:.796875,y:.484375},{x:.828125,y:.484375},{x:.828125,y:.484375},{x:.859375,y:.484375},{x:.859375,y:.484375},{x:.890625,y:.484375},{x:.890625,y:.484375},{x:.921875,y:.484375},{x:.921875,y:.484375},{x:.953125,y:.484375},{x:.953125,y:.484375},{x:.984375,y:.484375},{x:.984375,y:.484375},{x:.015625,y:.515625},{x:.015625,y:.515625},{x:.046875,y:.515625},{x:.046875,y:.515625},{x:.078125,y:.515625},{x:.078125,y:.515625},{x:.109375,y:.515625},{x:.109375,y:.515625},{x:.140625,y:.515625},{x:.140625,y:.515625},{x:.171875,y:.515625},{x:.171875,y:.515625},{x:.203125,y:.515625},{x:.203125,y:.515625},{x:.234375,y:.515625},{x:.234375,y:.515625},{x:.265625,y:.515625},{x:.265625,y:.515625},{x:.296875,y:.515625},{x:.296875,y:.515625},{x:.328125,y:.515625},{x:.328125,y:.515625},{x:.359375,y:.515625},{x:.359375,y:.515625},{x:.390625,y:.515625},{x:.390625,y:.515625},{x:.421875,y:.515625},{x:.421875,y:.515625},{x:.453125,y:.515625},{x:.453125,y:.515625},{x:.484375,y:.515625},{x:.484375,y:.515625},{x:.515625,y:.515625},{x:.515625,y:.515625},{x:.546875,y:.515625},{x:.546875,y:.515625},{x:.578125,y:.515625},{x:.578125,y:.515625},{x:.609375,y:.515625},{x:.609375,y:.515625},{x:.640625,y:.515625},{x:.640625,y:.515625},{x:.671875,y:.515625},{x:.671875,y:.515625},{x:.703125,y:.515625},{x:.703125,y:.515625},{x:.734375,y:.515625},{x:.734375,y:.515625},{x:.765625,y:.515625},{x:.765625,y:.515625},{x:.796875,y:.515625},{x:.796875,y:.515625},{x:.828125,y:.515625},{x:.828125,y:.515625},{x:.859375,y:.515625},{x:.859375,y:.515625},{x:.890625,y:.515625},{x:.890625,y:.515625},{x:.921875,y:.515625},{x:.921875,y:.515625},{x:.953125,y:.515625},{x:.953125,y:.515625},{x:.984375,y:.515625},{x:.984375,y:.515625},{x:.015625,y:.546875},{x:.015625,y:.546875},{x:.046875,y:.546875},{x:.046875,y:.546875},{x:.078125,y:.546875},{x:.078125,y:.546875},{x:.109375,y:.546875},{x:.109375,y:.546875},{x:.140625,y:.546875},{x:.140625,y:.546875},{x:.171875,y:.546875},{x:.171875,y:.546875},{x:.203125,y:.546875},{x:.203125,y:.546875},{x:.234375,y:.546875},{x:.234375,y:.546875},{x:.265625,y:.546875},{x:.265625,y:.546875},{x:.296875,y:.546875},{x:.296875,y:.546875},{x:.328125,y:.546875},{x:.328125,y:.546875},{x:.359375,y:.546875},{x:.359375,y:.546875},{x:.390625,y:.546875},{x:.390625,y:.546875},{x:.421875,y:.546875},{x:.421875,y:.546875},{x:.453125,y:.546875},{x:.453125,y:.546875},{x:.484375,y:.546875},{x:.484375,y:.546875},{x:.515625,y:.546875},{x:.515625,y:.546875},{x:.546875,y:.546875},{x:.546875,y:.546875},{x:.578125,y:.546875},{x:.578125,y:.546875},{x:.609375,y:.546875},{x:.609375,y:.546875},{x:.640625,y:.546875},{x:.640625,y:.546875},{x:.671875,y:.546875},{x:.671875,y:.546875},{x:.703125,y:.546875},{x:.703125,y:.546875},{x:.734375,y:.546875},{x:.734375,y:.546875},{x:.765625,y:.546875},{x:.765625,y:.546875},{x:.796875,y:.546875},{x:.796875,y:.546875},{x:.828125,y:.546875},{x:.828125,y:.546875},{x:.859375,y:.546875},{x:.859375,y:.546875},{x:.890625,y:.546875},{x:.890625,y:.546875},{x:.921875,y:.546875},{x:.921875,y:.546875},{x:.953125,y:.546875},{x:.953125,y:.546875},{x:.984375,y:.546875},{x:.984375,y:.546875},{x:.015625,y:.578125},{x:.015625,y:.578125},{x:.046875,y:.578125},{x:.046875,y:.578125},{x:.078125,y:.578125},{x:.078125,y:.578125},{x:.109375,y:.578125},{x:.109375,y:.578125},{x:.140625,y:.578125},{x:.140625,y:.578125},{x:.171875,y:.578125},{x:.171875,y:.578125},{x:.203125,y:.578125},{x:.203125,y:.578125},{x:.234375,y:.578125},{x:.234375,y:.578125},{x:.265625,y:.578125},{x:.265625,y:.578125},{x:.296875,y:.578125},{x:.296875,y:.578125},{x:.328125,y:.578125},{x:.328125,y:.578125},{x:.359375,y:.578125},{x:.359375,y:.578125},{x:.390625,y:.578125},{x:.390625,y:.578125},{x:.421875,y:.578125},{x:.421875,y:.578125},{x:.453125,y:.578125},{x:.453125,y:.578125},{x:.484375,y:.578125},{x:.484375,y:.578125},{x:.515625,y:.578125},{x:.515625,y:.578125},{x:.546875,y:.578125},{x:.546875,y:.578125},{x:.578125,y:.578125},{x:.578125,y:.578125},{x:.609375,y:.578125},{x:.609375,y:.578125},{x:.640625,y:.578125},{x:.640625,y:.578125},{x:.671875,y:.578125},{x:.671875,y:.578125},{x:.703125,y:.578125},{x:.703125,y:.578125},{x:.734375,y:.578125},{x:.734375,y:.578125},{x:.765625,y:.578125},{x:.765625,y:.578125},{x:.796875,y:.578125},{x:.796875,y:.578125},{x:.828125,y:.578125},{x:.828125,y:.578125},{x:.859375,y:.578125},{x:.859375,y:.578125},{x:.890625,y:.578125},{x:.890625,y:.578125},{x:.921875,y:.578125},{x:.921875,y:.578125},{x:.953125,y:.578125},{x:.953125,y:.578125},{x:.984375,y:.578125},{x:.984375,y:.578125},{x:.015625,y:.609375},{x:.015625,y:.609375},{x:.046875,y:.609375},{x:.046875,y:.609375},{x:.078125,y:.609375},{x:.078125,y:.609375},{x:.109375,y:.609375},{x:.109375,y:.609375},{x:.140625,y:.609375},{x:.140625,y:.609375},{x:.171875,y:.609375},{x:.171875,y:.609375},{x:.203125,y:.609375},{x:.203125,y:.609375},{x:.234375,y:.609375},{x:.234375,y:.609375},{x:.265625,y:.609375},{x:.265625,y:.609375},{x:.296875,y:.609375},{x:.296875,y:.609375},{x:.328125,y:.609375},{x:.328125,y:.609375},{x:.359375,y:.609375},{x:.359375,y:.609375},{x:.390625,y:.609375},{x:.390625,y:.609375},{x:.421875,y:.609375},{x:.421875,y:.609375},{x:.453125,y:.609375},{x:.453125,y:.609375},{x:.484375,y:.609375},{x:.484375,y:.609375},{x:.515625,y:.609375},{x:.515625,y:.609375},{x:.546875,y:.609375},{x:.546875,y:.609375},{x:.578125,y:.609375},{x:.578125,y:.609375},{x:.609375,y:.609375},{x:.609375,y:.609375},{x:.640625,y:.609375},{x:.640625,y:.609375},{x:.671875,y:.609375},{x:.671875,y:.609375},{x:.703125,y:.609375},{x:.703125,y:.609375},{x:.734375,y:.609375},{x:.734375,y:.609375},{x:.765625,y:.609375},{x:.765625,y:.609375},{x:.796875,y:.609375},{x:.796875,y:.609375},{x:.828125,y:.609375},{x:.828125,y:.609375},{x:.859375,y:.609375},{x:.859375,y:.609375},{x:.890625,y:.609375},{x:.890625,y:.609375},{x:.921875,y:.609375},{x:.921875,y:.609375},{x:.953125,y:.609375},{x:.953125,y:.609375},{x:.984375,y:.609375},{x:.984375,y:.609375},{x:.015625,y:.640625},{x:.015625,y:.640625},{x:.046875,y:.640625},{x:.046875,y:.640625},{x:.078125,y:.640625},{x:.078125,y:.640625},{x:.109375,y:.640625},{x:.109375,y:.640625},{x:.140625,y:.640625},{x:.140625,y:.640625},{x:.171875,y:.640625},{x:.171875,y:.640625},{x:.203125,y:.640625},{x:.203125,y:.640625},{x:.234375,y:.640625},{x:.234375,y:.640625},{x:.265625,y:.640625},{x:.265625,y:.640625},{x:.296875,y:.640625},{x:.296875,y:.640625},{x:.328125,y:.640625},{x:.328125,y:.640625},{x:.359375,y:.640625},{x:.359375,y:.640625},{x:.390625,y:.640625},{x:.390625,y:.640625},{x:.421875,y:.640625},{x:.421875,y:.640625},{x:.453125,y:.640625},{x:.453125,y:.640625},{x:.484375,y:.640625},{x:.484375,y:.640625},{x:.515625,y:.640625},{x:.515625,y:.640625},{x:.546875,y:.640625},{x:.546875,y:.640625},{x:.578125,y:.640625},{x:.578125,y:.640625},{x:.609375,y:.640625},{x:.609375,y:.640625},{x:.640625,y:.640625},{x:.640625,y:.640625},{x:.671875,y:.640625},{x:.671875,y:.640625},{x:.703125,y:.640625},{x:.703125,y:.640625},{x:.734375,y:.640625},{x:.734375,y:.640625},{x:.765625,y:.640625},{x:.765625,y:.640625},{x:.796875,y:.640625},{x:.796875,y:.640625},{x:.828125,y:.640625},{x:.828125,y:.640625},{x:.859375,y:.640625},{x:.859375,y:.640625},{x:.890625,y:.640625},{x:.890625,y:.640625},{x:.921875,y:.640625},{x:.921875,y:.640625},{x:.953125,y:.640625},{x:.953125,y:.640625},{x:.984375,y:.640625},{x:.984375,y:.640625},{x:.015625,y:.671875},{x:.015625,y:.671875},{x:.046875,y:.671875},{x:.046875,y:.671875},{x:.078125,y:.671875},{x:.078125,y:.671875},{x:.109375,y:.671875},{x:.109375,y:.671875},{x:.140625,y:.671875},{x:.140625,y:.671875},{x:.171875,y:.671875},{x:.171875,y:.671875},{x:.203125,y:.671875},{x:.203125,y:.671875},{x:.234375,y:.671875},{x:.234375,y:.671875},{x:.265625,y:.671875},{x:.265625,y:.671875},{x:.296875,y:.671875},{x:.296875,y:.671875},{x:.328125,y:.671875},{x:.328125,y:.671875},{x:.359375,y:.671875},{x:.359375,y:.671875},{x:.390625,y:.671875},{x:.390625,y:.671875},{x:.421875,y:.671875},{x:.421875,y:.671875},{x:.453125,y:.671875},{x:.453125,y:.671875},{x:.484375,y:.671875},{x:.484375,y:.671875},{x:.515625,y:.671875},{x:.515625,y:.671875},{x:.546875,y:.671875},{x:.546875,y:.671875},{x:.578125,y:.671875},{x:.578125,y:.671875},{x:.609375,y:.671875},{x:.609375,y:.671875},{x:.640625,y:.671875},{x:.640625,y:.671875},{x:.671875,y:.671875},{x:.671875,y:.671875},{x:.703125,y:.671875},{x:.703125,y:.671875},{x:.734375,y:.671875},{x:.734375,y:.671875},{x:.765625,y:.671875},{x:.765625,y:.671875},{x:.796875,y:.671875},{x:.796875,y:.671875},{x:.828125,y:.671875},{x:.828125,y:.671875},{x:.859375,y:.671875},{x:.859375,y:.671875},{x:.890625,y:.671875},{x:.890625,y:.671875},{x:.921875,y:.671875},{x:.921875,y:.671875},{x:.953125,y:.671875},{x:.953125,y:.671875},{x:.984375,y:.671875},{x:.984375,y:.671875},{x:.015625,y:.703125},{x:.015625,y:.703125},{x:.046875,y:.703125},{x:.046875,y:.703125},{x:.078125,y:.703125},{x:.078125,y:.703125},{x:.109375,y:.703125},{x:.109375,y:.703125},{x:.140625,y:.703125},{x:.140625,y:.703125},{x:.171875,y:.703125},{x:.171875,y:.703125},{x:.203125,y:.703125},{x:.203125,y:.703125},{x:.234375,y:.703125},{x:.234375,y:.703125},{x:.265625,y:.703125},{x:.265625,y:.703125},{x:.296875,y:.703125},{x:.296875,y:.703125},{x:.328125,y:.703125},{x:.328125,y:.703125},{x:.359375,y:.703125},{x:.359375,y:.703125},{x:.390625,y:.703125},{x:.390625,y:.703125},{x:.421875,y:.703125},{x:.421875,y:.703125},{x:.453125,y:.703125},{x:.453125,y:.703125},{x:.484375,y:.703125},{x:.484375,y:.703125},{x:.515625,y:.703125},{x:.515625,y:.703125},{x:.546875,y:.703125},{x:.546875,y:.703125},{x:.578125,y:.703125},{x:.578125,y:.703125},{x:.609375,y:.703125},{x:.609375,y:.703125},{x:.640625,y:.703125},{x:.640625,y:.703125},{x:.671875,y:.703125},{x:.671875,y:.703125},{x:.703125,y:.703125},{x:.703125,y:.703125},{x:.734375,y:.703125},{x:.734375,y:.703125},{x:.765625,y:.703125},{x:.765625,y:.703125},{x:.796875,y:.703125},{x:.796875,y:.703125},{x:.828125,y:.703125},{x:.828125,y:.703125},{x:.859375,y:.703125},{x:.859375,y:.703125},{x:.890625,y:.703125},{x:.890625,y:.703125},{x:.921875,y:.703125},{x:.921875,y:.703125},{x:.953125,y:.703125},{x:.953125,y:.703125},{x:.984375,y:.703125},{x:.984375,y:.703125},{x:.015625,y:.734375},{x:.015625,y:.734375},{x:.046875,y:.734375},{x:.046875,y:.734375},{x:.078125,y:.734375},{x:.078125,y:.734375},{x:.109375,y:.734375},{x:.109375,y:.734375},{x:.140625,y:.734375},{x:.140625,y:.734375},{x:.171875,y:.734375},{x:.171875,y:.734375},{x:.203125,y:.734375},{x:.203125,y:.734375},{x:.234375,y:.734375},{x:.234375,y:.734375},{x:.265625,y:.734375},{x:.265625,y:.734375},{x:.296875,y:.734375},{x:.296875,y:.734375},{x:.328125,y:.734375},{x:.328125,y:.734375},{x:.359375,y:.734375},{x:.359375,y:.734375},{x:.390625,y:.734375},{x:.390625,y:.734375},{x:.421875,y:.734375},{x:.421875,y:.734375},{x:.453125,y:.734375},{x:.453125,y:.734375},{x:.484375,y:.734375},{x:.484375,y:.734375},{x:.515625,y:.734375},{x:.515625,y:.734375},{x:.546875,y:.734375},{x:.546875,y:.734375},{x:.578125,y:.734375},{x:.578125,y:.734375},{x:.609375,y:.734375},{x:.609375,y:.734375},{x:.640625,y:.734375},{x:.640625,y:.734375},{x:.671875,y:.734375},{x:.671875,y:.734375},{x:.703125,y:.734375},{x:.703125,y:.734375},{x:.734375,y:.734375},{x:.734375,y:.734375},{x:.765625,y:.734375},{x:.765625,y:.734375},{x:.796875,y:.734375},{x:.796875,y:.734375},{x:.828125,y:.734375},{x:.828125,y:.734375},{x:.859375,y:.734375},{x:.859375,y:.734375},{x:.890625,y:.734375},{x:.890625,y:.734375},{x:.921875,y:.734375},{x:.921875,y:.734375},{x:.953125,y:.734375},{x:.953125,y:.734375},{x:.984375,y:.734375},{x:.984375,y:.734375},{x:.015625,y:.765625},{x:.015625,y:.765625},{x:.046875,y:.765625},{x:.046875,y:.765625},{x:.078125,y:.765625},{x:.078125,y:.765625},{x:.109375,y:.765625},{x:.109375,y:.765625},{x:.140625,y:.765625},{x:.140625,y:.765625},{x:.171875,y:.765625},{x:.171875,y:.765625},{x:.203125,y:.765625},{x:.203125,y:.765625},{x:.234375,y:.765625},{x:.234375,y:.765625},{x:.265625,y:.765625},{x:.265625,y:.765625},{x:.296875,y:.765625},{x:.296875,y:.765625},{x:.328125,y:.765625},{x:.328125,y:.765625},{x:.359375,y:.765625},{x:.359375,y:.765625},{x:.390625,y:.765625},{x:.390625,y:.765625},{x:.421875,y:.765625},{x:.421875,y:.765625},{x:.453125,y:.765625},{x:.453125,y:.765625},{x:.484375,y:.765625},{x:.484375,y:.765625},{x:.515625,y:.765625},{x:.515625,y:.765625},{x:.546875,y:.765625},{x:.546875,y:.765625},{x:.578125,y:.765625},{x:.578125,y:.765625},{x:.609375,y:.765625},{x:.609375,y:.765625},{x:.640625,y:.765625},{x:.640625,y:.765625},{x:.671875,y:.765625},{x:.671875,y:.765625},{x:.703125,y:.765625},{x:.703125,y:.765625},{x:.734375,y:.765625},{x:.734375,y:.765625},{x:.765625,y:.765625},{x:.765625,y:.765625},{x:.796875,y:.765625},{x:.796875,y:.765625},{x:.828125,y:.765625},{x:.828125,y:.765625},{x:.859375,y:.765625},{x:.859375,y:.765625},{x:.890625,y:.765625},{x:.890625,y:.765625},{x:.921875,y:.765625},{x:.921875,y:.765625},{x:.953125,y:.765625},{x:.953125,y:.765625},{x:.984375,y:.765625},{x:.984375,y:.765625},{x:.015625,y:.796875},{x:.015625,y:.796875},{x:.046875,y:.796875},{x:.046875,y:.796875},{x:.078125,y:.796875},{x:.078125,y:.796875},{x:.109375,y:.796875},{x:.109375,y:.796875},{x:.140625,y:.796875},{x:.140625,y:.796875},{x:.171875,y:.796875},{x:.171875,y:.796875},{x:.203125,y:.796875},{x:.203125,y:.796875},{x:.234375,y:.796875},{x:.234375,y:.796875},{x:.265625,y:.796875},{x:.265625,y:.796875},{x:.296875,y:.796875},{x:.296875,y:.796875},{x:.328125,y:.796875},{x:.328125,y:.796875},{x:.359375,y:.796875},{x:.359375,y:.796875},{x:.390625,y:.796875},{x:.390625,y:.796875},{x:.421875,y:.796875},{x:.421875,y:.796875},{x:.453125,y:.796875},{x:.453125,y:.796875},{x:.484375,y:.796875},{x:.484375,y:.796875},{x:.515625,y:.796875},{x:.515625,y:.796875},{x:.546875,y:.796875},{x:.546875,y:.796875},{x:.578125,y:.796875},{x:.578125,y:.796875},{x:.609375,y:.796875},{x:.609375,y:.796875},{x:.640625,y:.796875},{x:.640625,y:.796875},{x:.671875,y:.796875},{x:.671875,y:.796875},{x:.703125,y:.796875},{x:.703125,y:.796875},{x:.734375,y:.796875},{x:.734375,y:.796875},{x:.765625,y:.796875},{x:.765625,y:.796875},{x:.796875,y:.796875},{x:.796875,y:.796875},{x:.828125,y:.796875},{x:.828125,y:.796875},{x:.859375,y:.796875},{x:.859375,y:.796875},{x:.890625,y:.796875},{x:.890625,y:.796875},{x:.921875,y:.796875},{x:.921875,y:.796875},{x:.953125,y:.796875},{x:.953125,y:.796875},{x:.984375,y:.796875},{x:.984375,y:.796875},{x:.015625,y:.828125},{x:.015625,y:.828125},{x:.046875,y:.828125},{x:.046875,y:.828125},{x:.078125,y:.828125},{x:.078125,y:.828125},{x:.109375,y:.828125},{x:.109375,y:.828125},{x:.140625,y:.828125},{x:.140625,y:.828125},{x:.171875,y:.828125},{x:.171875,y:.828125},{x:.203125,y:.828125},{x:.203125,y:.828125},{x:.234375,y:.828125},{x:.234375,y:.828125},{x:.265625,y:.828125},{x:.265625,y:.828125},{x:.296875,y:.828125},{x:.296875,y:.828125},{x:.328125,y:.828125},{x:.328125,y:.828125},{x:.359375,y:.828125},{x:.359375,y:.828125},{x:.390625,y:.828125},{x:.390625,y:.828125},{x:.421875,y:.828125},{x:.421875,y:.828125},{x:.453125,y:.828125},{x:.453125,y:.828125},{x:.484375,y:.828125},{x:.484375,y:.828125},{x:.515625,y:.828125},{x:.515625,y:.828125},{x:.546875,y:.828125},{x:.546875,y:.828125},{x:.578125,y:.828125},{x:.578125,y:.828125},{x:.609375,y:.828125},{x:.609375,y:.828125},{x:.640625,y:.828125},{x:.640625,y:.828125},{x:.671875,y:.828125},{x:.671875,y:.828125},{x:.703125,y:.828125},{x:.703125,y:.828125},{x:.734375,y:.828125},{x:.734375,y:.828125},{x:.765625,y:.828125},{x:.765625,y:.828125},{x:.796875,y:.828125},{x:.796875,y:.828125},{x:.828125,y:.828125},{x:.828125,y:.828125},{x:.859375,y:.828125},{x:.859375,y:.828125},{x:.890625,y:.828125},{x:.890625,y:.828125},{x:.921875,y:.828125},{x:.921875,y:.828125},{x:.953125,y:.828125},{x:.953125,y:.828125},{x:.984375,y:.828125},{x:.984375,y:.828125},{x:.015625,y:.859375},{x:.015625,y:.859375},{x:.046875,y:.859375},{x:.046875,y:.859375},{x:.078125,y:.859375},{x:.078125,y:.859375},{x:.109375,y:.859375},{x:.109375,y:.859375},{x:.140625,y:.859375},{x:.140625,y:.859375},{x:.171875,y:.859375},{x:.171875,y:.859375},{x:.203125,y:.859375},{x:.203125,y:.859375},{x:.234375,y:.859375},{x:.234375,y:.859375},{x:.265625,y:.859375},{x:.265625,y:.859375},{x:.296875,y:.859375},{x:.296875,y:.859375},{x:.328125,y:.859375},{x:.328125,y:.859375},{x:.359375,y:.859375},{x:.359375,y:.859375},{x:.390625,y:.859375},{x:.390625,y:.859375},{x:.421875,y:.859375},{x:.421875,y:.859375},{x:.453125,y:.859375},{x:.453125,y:.859375},{x:.484375,y:.859375},{x:.484375,y:.859375},{x:.515625,y:.859375},{x:.515625,y:.859375},{x:.546875,y:.859375},{x:.546875,y:.859375},{x:.578125,y:.859375},{x:.578125,y:.859375},{x:.609375,y:.859375},{x:.609375,y:.859375},{x:.640625,y:.859375},{x:.640625,y:.859375},{x:.671875,y:.859375},{x:.671875,y:.859375},{x:.703125,y:.859375},{x:.703125,y:.859375},{x:.734375,y:.859375},{x:.734375,y:.859375},{x:.765625,y:.859375},{x:.765625,y:.859375},{x:.796875,y:.859375},{x:.796875,y:.859375},{x:.828125,y:.859375},{x:.828125,y:.859375},{x:.859375,y:.859375},{x:.859375,y:.859375},{x:.890625,y:.859375},{x:.890625,y:.859375},{x:.921875,y:.859375},{x:.921875,y:.859375},{x:.953125,y:.859375},{x:.953125,y:.859375},{x:.984375,y:.859375},{x:.984375,y:.859375},{x:.015625,y:.890625},{x:.015625,y:.890625},{x:.046875,y:.890625},{x:.046875,y:.890625},{x:.078125,y:.890625},{x:.078125,y:.890625},{x:.109375,y:.890625},{x:.109375,y:.890625},{x:.140625,y:.890625},{x:.140625,y:.890625},{x:.171875,y:.890625},{x:.171875,y:.890625},{x:.203125,y:.890625},{x:.203125,y:.890625},{x:.234375,y:.890625},{x:.234375,y:.890625},{x:.265625,y:.890625},{x:.265625,y:.890625},{x:.296875,y:.890625},{x:.296875,y:.890625},{x:.328125,y:.890625},{x:.328125,y:.890625},{x:.359375,y:.890625},{x:.359375,y:.890625},{x:.390625,y:.890625},{x:.390625,y:.890625},{x:.421875,y:.890625},{x:.421875,y:.890625},{x:.453125,y:.890625},{x:.453125,y:.890625},{x:.484375,y:.890625},{x:.484375,y:.890625},{x:.515625,y:.890625},{x:.515625,y:.890625},{x:.546875,y:.890625},{x:.546875,y:.890625},{x:.578125,y:.890625},{x:.578125,y:.890625},{x:.609375,y:.890625},{x:.609375,y:.890625},{x:.640625,y:.890625},{x:.640625,y:.890625},{x:.671875,y:.890625},{x:.671875,y:.890625},{x:.703125,y:.890625},{x:.703125,y:.890625},{x:.734375,y:.890625},{x:.734375,y:.890625},{x:.765625,y:.890625},{x:.765625,y:.890625},{x:.796875,y:.890625},{x:.796875,y:.890625},{x:.828125,y:.890625},{x:.828125,y:.890625},{x:.859375,y:.890625},{x:.859375,y:.890625},{x:.890625,y:.890625},{x:.890625,y:.890625},{x:.921875,y:.890625},{x:.921875,y:.890625},{x:.953125,y:.890625},{x:.953125,y:.890625},{x:.984375,y:.890625},{x:.984375,y:.890625},{x:.015625,y:.921875},{x:.015625,y:.921875},{x:.046875,y:.921875},{x:.046875,y:.921875},{x:.078125,y:.921875},{x:.078125,y:.921875},{x:.109375,y:.921875},{x:.109375,y:.921875},{x:.140625,y:.921875},{x:.140625,y:.921875},{x:.171875,y:.921875},{x:.171875,y:.921875},{x:.203125,y:.921875},{x:.203125,y:.921875},{x:.234375,y:.921875},{x:.234375,y:.921875},{x:.265625,y:.921875},{x:.265625,y:.921875},{x:.296875,y:.921875},{x:.296875,y:.921875},{x:.328125,y:.921875},{x:.328125,y:.921875},{x:.359375,y:.921875},{x:.359375,y:.921875},{x:.390625,y:.921875},{x:.390625,y:.921875},{x:.421875,y:.921875},{x:.421875,y:.921875},{x:.453125,y:.921875},{x:.453125,y:.921875},{x:.484375,y:.921875},{x:.484375,y:.921875},{x:.515625,y:.921875},{x:.515625,y:.921875},{x:.546875,y:.921875},{x:.546875,y:.921875},{x:.578125,y:.921875},{x:.578125,y:.921875},{x:.609375,y:.921875},{x:.609375,y:.921875},{x:.640625,y:.921875},{x:.640625,y:.921875},{x:.671875,y:.921875},{x:.671875,y:.921875},{x:.703125,y:.921875},{x:.703125,y:.921875},{x:.734375,y:.921875},{x:.734375,y:.921875},{x:.765625,y:.921875},{x:.765625,y:.921875},{x:.796875,y:.921875},{x:.796875,y:.921875},{x:.828125,y:.921875},{x:.828125,y:.921875},{x:.859375,y:.921875},{x:.859375,y:.921875},{x:.890625,y:.921875},{x:.890625,y:.921875},{x:.921875,y:.921875},{x:.921875,y:.921875},{x:.953125,y:.921875},{x:.953125,y:.921875},{x:.984375,y:.921875},{x:.984375,y:.921875},{x:.015625,y:.953125},{x:.015625,y:.953125},{x:.046875,y:.953125},{x:.046875,y:.953125},{x:.078125,y:.953125},{x:.078125,y:.953125},{x:.109375,y:.953125},{x:.109375,y:.953125},{x:.140625,y:.953125},{x:.140625,y:.953125},{x:.171875,y:.953125},{x:.171875,y:.953125},{x:.203125,y:.953125},{x:.203125,y:.953125},{x:.234375,y:.953125},{x:.234375,y:.953125},{x:.265625,y:.953125},{x:.265625,y:.953125},{x:.296875,y:.953125},{x:.296875,y:.953125},{x:.328125,y:.953125},{x:.328125,y:.953125},{x:.359375,y:.953125},{x:.359375,y:.953125},{x:.390625,y:.953125},{x:.390625,y:.953125},{x:.421875,y:.953125},{x:.421875,y:.953125},{x:.453125,y:.953125},{x:.453125,y:.953125},{x:.484375,y:.953125},{x:.484375,y:.953125},{x:.515625,y:.953125},{x:.515625,y:.953125},{x:.546875,y:.953125},{x:.546875,y:.953125},{x:.578125,y:.953125},{x:.578125,y:.953125},{x:.609375,y:.953125},{x:.609375,y:.953125},{x:.640625,y:.953125},{x:.640625,y:.953125},{x:.671875,y:.953125},{x:.671875,y:.953125},{x:.703125,y:.953125},{x:.703125,y:.953125},{x:.734375,y:.953125},{x:.734375,y:.953125},{x:.765625,y:.953125},{x:.765625,y:.953125},{x:.796875,y:.953125},{x:.796875,y:.953125},{x:.828125,y:.953125},{x:.828125,y:.953125},{x:.859375,y:.953125},{x:.859375,y:.953125},{x:.890625,y:.953125},{x:.890625,y:.953125},{x:.921875,y:.953125},{x:.921875,y:.953125},{x:.953125,y:.953125},{x:.953125,y:.953125},{x:.984375,y:.953125},{x:.984375,y:.953125},{x:.015625,y:.984375},{x:.015625,y:.984375},{x:.046875,y:.984375},{x:.046875,y:.984375},{x:.078125,y:.984375},{x:.078125,y:.984375},{x:.109375,y:.984375},{x:.109375,y:.984375},{x:.140625,y:.984375},{x:.140625,y:.984375},{x:.171875,y:.984375},{x:.171875,y:.984375},{x:.203125,y:.984375},{x:.203125,y:.984375},{x:.234375,y:.984375},{x:.234375,y:.984375},{x:.265625,y:.984375},{x:.265625,y:.984375},{x:.296875,y:.984375},{x:.296875,y:.984375},{x:.328125,y:.984375},{x:.328125,y:.984375},{x:.359375,y:.984375},{x:.359375,y:.984375},{x:.390625,y:.984375},{x:.390625,y:.984375},{x:.421875,y:.984375},{x:.421875,y:.984375},{x:.453125,y:.984375},{x:.453125,y:.984375},{x:.484375,y:.984375},{x:.484375,y:.984375},{x:.515625,y:.984375},{x:.515625,y:.984375},{x:.546875,y:.984375},{x:.546875,y:.984375},{x:.578125,y:.984375},{x:.578125,y:.984375},{x:.609375,y:.984375},{x:.609375,y:.984375},{x:.640625,y:.984375},{x:.640625,y:.984375},{x:.671875,y:.984375},{x:.671875,y:.984375},{x:.703125,y:.984375},{x:.703125,y:.984375},{x:.734375,y:.984375},{x:.734375,y:.984375},{x:.765625,y:.984375},{x:.765625,y:.984375},{x:.796875,y:.984375},{x:.796875,y:.984375},{x:.828125,y:.984375},{x:.828125,y:.984375},{x:.859375,y:.984375},{x:.859375,y:.984375},{x:.890625,y:.984375},{x:.890625,y:.984375},{x:.921875,y:.984375},{x:.921875,y:.984375},{x:.953125,y:.984375},{x:.953125,y:.984375},{x:.984375,y:.984375},{x:.984375,y:.984375},{x:.03125,y:.03125},{x:.03125,y:.03125},{x:.09375,y:.03125},{x:.09375,y:.03125},{x:.15625,y:.03125},{x:.15625,y:.03125},{x:.21875,y:.03125},{x:.21875,y:.03125},{x:.28125,y:.03125},{x:.28125,y:.03125},{x:.34375,y:.03125},{x:.34375,y:.03125},{x:.40625,y:.03125},{x:.40625,y:.03125},{x:.46875,y:.03125},{x:.46875,y:.03125},{x:.53125,y:.03125},{x:.53125,y:.03125},{x:.59375,y:.03125},{x:.59375,y:.03125},{x:.65625,y:.03125},{x:.65625,y:.03125},{x:.71875,y:.03125},{x:.71875,y:.03125},{x:.78125,y:.03125},{x:.78125,y:.03125},{x:.84375,y:.03125},{x:.84375,y:.03125},{x:.90625,y:.03125},{x:.90625,y:.03125},{x:.96875,y:.03125},{x:.96875,y:.03125},{x:.03125,y:.09375},{x:.03125,y:.09375},{x:.09375,y:.09375},{x:.09375,y:.09375},{x:.15625,y:.09375},{x:.15625,y:.09375},{x:.21875,y:.09375},{x:.21875,y:.09375},{x:.28125,y:.09375},{x:.28125,y:.09375},{x:.34375,y:.09375},{x:.34375,y:.09375},{x:.40625,y:.09375},{x:.40625,y:.09375},{x:.46875,y:.09375},{x:.46875,y:.09375},{x:.53125,y:.09375},{x:.53125,y:.09375},{x:.59375,y:.09375},{x:.59375,y:.09375},{x:.65625,y:.09375},{x:.65625,y:.09375},{x:.71875,y:.09375},{x:.71875,y:.09375},{x:.78125,y:.09375},{x:.78125,y:.09375},{x:.84375,y:.09375},{x:.84375,y:.09375},{x:.90625,y:.09375},{x:.90625,y:.09375},{x:.96875,y:.09375},{x:.96875,y:.09375},{x:.03125,y:.15625},{x:.03125,y:.15625},{x:.09375,y:.15625},{x:.09375,y:.15625},{x:.15625,y:.15625},{x:.15625,y:.15625},{x:.21875,y:.15625},{x:.21875,y:.15625},{x:.28125,y:.15625},{x:.28125,y:.15625},{x:.34375,y:.15625},{x:.34375,y:.15625},{x:.40625,y:.15625},{x:.40625,y:.15625},{x:.46875,y:.15625},{x:.46875,y:.15625},{x:.53125,y:.15625},{x:.53125,y:.15625},{x:.59375,y:.15625},{x:.59375,y:.15625},{x:.65625,y:.15625},{x:.65625,y:.15625},{x:.71875,y:.15625},{x:.71875,y:.15625},{x:.78125,y:.15625},{x:.78125,y:.15625},{x:.84375,y:.15625},{x:.84375,y:.15625},{x:.90625,y:.15625},{x:.90625,y:.15625},{x:.96875,y:.15625},{x:.96875,y:.15625},{x:.03125,y:.21875},{x:.03125,y:.21875},{x:.09375,y:.21875},{x:.09375,y:.21875},{x:.15625,y:.21875},{x:.15625,y:.21875},{x:.21875,y:.21875},{x:.21875,y:.21875},{x:.28125,y:.21875},{x:.28125,y:.21875},{x:.34375,y:.21875},{x:.34375,y:.21875},{x:.40625,y:.21875},{x:.40625,y:.21875},{x:.46875,y:.21875},{x:.46875,y:.21875},{x:.53125,y:.21875},{x:.53125,y:.21875},{x:.59375,y:.21875},{x:.59375,y:.21875},{x:.65625,y:.21875},{x:.65625,y:.21875},{x:.71875,y:.21875},{x:.71875,y:.21875},{x:.78125,y:.21875},{x:.78125,y:.21875},{x:.84375,y:.21875},{x:.84375,y:.21875},{x:.90625,y:.21875},{x:.90625,y:.21875},{x:.96875,y:.21875},{x:.96875,y:.21875},{x:.03125,y:.28125},{x:.03125,y:.28125},{x:.09375,y:.28125},{x:.09375,y:.28125},{x:.15625,y:.28125},{x:.15625,y:.28125},{x:.21875,y:.28125},{x:.21875,y:.28125},{x:.28125,y:.28125},{x:.28125,y:.28125},{x:.34375,y:.28125},{x:.34375,y:.28125},{x:.40625,y:.28125},{x:.40625,y:.28125},{x:.46875,y:.28125},{x:.46875,y:.28125},{x:.53125,y:.28125},{x:.53125,y:.28125},{x:.59375,y:.28125},{x:.59375,y:.28125},{x:.65625,y:.28125},{x:.65625,y:.28125},{x:.71875,y:.28125},{x:.71875,y:.28125},{x:.78125,y:.28125},{x:.78125,y:.28125},{x:.84375,y:.28125},{x:.84375,y:.28125},{x:.90625,y:.28125},{x:.90625,y:.28125},{x:.96875,y:.28125},{x:.96875,y:.28125},{x:.03125,y:.34375},{x:.03125,y:.34375},{x:.09375,y:.34375},{x:.09375,y:.34375},{x:.15625,y:.34375},{x:.15625,y:.34375},{x:.21875,y:.34375},{x:.21875,y:.34375},{x:.28125,y:.34375},{x:.28125,y:.34375},{x:.34375,y:.34375},{x:.34375,y:.34375},{x:.40625,y:.34375},{x:.40625,y:.34375},{x:.46875,y:.34375},{x:.46875,y:.34375},{x:.53125,y:.34375},{x:.53125,y:.34375},{x:.59375,y:.34375},{x:.59375,y:.34375},{x:.65625,y:.34375},{x:.65625,y:.34375},{x:.71875,y:.34375},{x:.71875,y:.34375},{x:.78125,y:.34375},{x:.78125,y:.34375},{x:.84375,y:.34375},{x:.84375,y:.34375},{x:.90625,y:.34375},{x:.90625,y:.34375},{x:.96875,y:.34375},{x:.96875,y:.34375},{x:.03125,y:.40625},{x:.03125,y:.40625},{x:.09375,y:.40625},{x:.09375,y:.40625},{x:.15625,y:.40625},{x:.15625,y:.40625},{x:.21875,y:.40625},{x:.21875,y:.40625},{x:.28125,y:.40625},{x:.28125,y:.40625},{x:.34375,y:.40625},{x:.34375,y:.40625},{x:.40625,y:.40625},{x:.40625,y:.40625},{x:.46875,y:.40625},{x:.46875,y:.40625},{x:.53125,y:.40625},{x:.53125,y:.40625},{x:.59375,y:.40625},{x:.59375,y:.40625},{x:.65625,y:.40625},{x:.65625,y:.40625},{x:.71875,y:.40625},{x:.71875,y:.40625},{x:.78125,y:.40625},{x:.78125,y:.40625},{x:.84375,y:.40625},{x:.84375,y:.40625},{x:.90625,y:.40625},{x:.90625,y:.40625},{x:.96875,y:.40625},{x:.96875,y:.40625},{x:.03125,y:.46875},{x:.03125,y:.46875},{x:.09375,y:.46875},{x:.09375,y:.46875},{x:.15625,y:.46875},{x:.15625,y:.46875},{x:.21875,y:.46875},{x:.21875,y:.46875},{x:.28125,y:.46875},{x:.28125,y:.46875},{x:.34375,y:.46875},{x:.34375,y:.46875},{x:.40625,y:.46875},{x:.40625,y:.46875},{x:.46875,y:.46875},{x:.46875,y:.46875},{x:.53125,y:.46875},{x:.53125,y:.46875},{x:.59375,y:.46875},{x:.59375,y:.46875},{x:.65625,y:.46875},{x:.65625,y:.46875},{x:.71875,y:.46875},{x:.71875,y:.46875},{x:.78125,y:.46875},{x:.78125,y:.46875},{x:.84375,y:.46875},{x:.84375,y:.46875},{x:.90625,y:.46875},{x:.90625,y:.46875},{x:.96875,y:.46875},{x:.96875,y:.46875},{x:.03125,y:.53125},{x:.03125,y:.53125},{x:.09375,y:.53125},{x:.09375,y:.53125},{x:.15625,y:.53125},{x:.15625,y:.53125},{x:.21875,y:.53125},{x:.21875,y:.53125},{x:.28125,y:.53125},{x:.28125,y:.53125},{x:.34375,y:.53125},{x:.34375,y:.53125},{x:.40625,y:.53125},{x:.40625,y:.53125},{x:.46875,y:.53125},{x:.46875,y:.53125},{x:.53125,y:.53125},{x:.53125,y:.53125},{x:.59375,y:.53125},{x:.59375,y:.53125},{x:.65625,y:.53125},{x:.65625,y:.53125},{x:.71875,y:.53125},{x:.71875,y:.53125},{x:.78125,y:.53125},{x:.78125,y:.53125},{x:.84375,y:.53125},{x:.84375,y:.53125},{x:.90625,y:.53125},{x:.90625,y:.53125},{x:.96875,y:.53125},{x:.96875,y:.53125},{x:.03125,y:.59375},{x:.03125,y:.59375},{x:.09375,y:.59375},{x:.09375,y:.59375},{x:.15625,y:.59375},{x:.15625,y:.59375},{x:.21875,y:.59375},{x:.21875,y:.59375},{x:.28125,y:.59375},{x:.28125,y:.59375},{x:.34375,y:.59375},{x:.34375,y:.59375},{x:.40625,y:.59375},{x:.40625,y:.59375},{x:.46875,y:.59375},{x:.46875,y:.59375},{x:.53125,y:.59375},{x:.53125,y:.59375},{x:.59375,y:.59375},{x:.59375,y:.59375},{x:.65625,y:.59375},{x:.65625,y:.59375},{x:.71875,y:.59375},{x:.71875,y:.59375},{x:.78125,y:.59375},{x:.78125,y:.59375},{x:.84375,y:.59375},{x:.84375,y:.59375},{x:.90625,y:.59375},{x:.90625,y:.59375},{x:.96875,y:.59375},{x:.96875,y:.59375},{x:.03125,y:.65625},{x:.03125,y:.65625},{x:.09375,y:.65625},{x:.09375,y:.65625},{x:.15625,y:.65625},{x:.15625,y:.65625},{x:.21875,y:.65625},{x:.21875,y:.65625},{x:.28125,y:.65625},{x:.28125,y:.65625},{x:.34375,y:.65625},{x:.34375,y:.65625},{x:.40625,y:.65625},{x:.40625,y:.65625},{x:.46875,y:.65625},{x:.46875,y:.65625},{x:.53125,y:.65625},{x:.53125,y:.65625},{x:.59375,y:.65625},{x:.59375,y:.65625},{x:.65625,y:.65625},{x:.65625,y:.65625},{x:.71875,y:.65625},{x:.71875,y:.65625},{x:.78125,y:.65625},{x:.78125,y:.65625},{x:.84375,y:.65625},{x:.84375,y:.65625},{x:.90625,y:.65625},{x:.90625,y:.65625},{x:.96875,y:.65625},{x:.96875,y:.65625},{x:.03125,y:.71875},{x:.03125,y:.71875},{x:.09375,y:.71875},{x:.09375,y:.71875},{x:.15625,y:.71875},{x:.15625,y:.71875},{x:.21875,y:.71875},{x:.21875,y:.71875},{x:.28125,y:.71875},{x:.28125,y:.71875},{x:.34375,y:.71875},{x:.34375,y:.71875},{x:.40625,y:.71875},{x:.40625,y:.71875},{x:.46875,y:.71875},{x:.46875,y:.71875},{x:.53125,y:.71875},{x:.53125,y:.71875},{x:.59375,y:.71875},{x:.59375,y:.71875},{x:.65625,y:.71875},{x:.65625,y:.71875},{x:.71875,y:.71875},{x:.71875,y:.71875},{x:.78125,y:.71875},{x:.78125,y:.71875},{x:.84375,y:.71875},{x:.84375,y:.71875},{x:.90625,y:.71875},{x:.90625,y:.71875},{x:.96875,y:.71875},{x:.96875,y:.71875},{x:.03125,y:.78125},{x:.03125,y:.78125},{x:.09375,y:.78125},{x:.09375,y:.78125},{x:.15625,y:.78125},{x:.15625,y:.78125},{x:.21875,y:.78125},{x:.21875,y:.78125},{x:.28125,y:.78125},{x:.28125,y:.78125},{x:.34375,y:.78125},{x:.34375,y:.78125},{x:.40625,y:.78125},{x:.40625,y:.78125},{x:.46875,y:.78125},{x:.46875,y:.78125},{x:.53125,y:.78125},{x:.53125,y:.78125},{x:.59375,y:.78125},{x:.59375,y:.78125},{x:.65625,y:.78125},{x:.65625,y:.78125},{x:.71875,y:.78125},{x:.71875,y:.78125},{x:.78125,y:.78125},{x:.78125,y:.78125},{x:.84375,y:.78125},{x:.84375,y:.78125},{x:.90625,y:.78125},{x:.90625,y:.78125},{x:.96875,y:.78125},{x:.96875,y:.78125},{x:.03125,y:.84375},{x:.03125,y:.84375},{x:.09375,y:.84375},{x:.09375,y:.84375},{x:.15625,y:.84375},{x:.15625,y:.84375},{x:.21875,y:.84375},{x:.21875,y:.84375},{x:.28125,y:.84375},{x:.28125,y:.84375},{x:.34375,y:.84375},{x:.34375,y:.84375},{x:.40625,y:.84375},{x:.40625,y:.84375},{x:.46875,y:.84375},{x:.46875,y:.84375},{x:.53125,y:.84375},{x:.53125,y:.84375},{x:.59375,y:.84375},{x:.59375,y:.84375},{x:.65625,y:.84375},{x:.65625,y:.84375},{x:.71875,y:.84375},{x:.71875,y:.84375},{x:.78125,y:.84375},{x:.78125,y:.84375},{x:.84375,y:.84375},{x:.84375,y:.84375},{x:.90625,y:.84375},{x:.90625,y:.84375},{x:.96875,y:.84375},{x:.96875,y:.84375},{x:.03125,y:.90625},{x:.03125,y:.90625},{x:.09375,y:.90625},{x:.09375,y:.90625},{x:.15625,y:.90625},{x:.15625,y:.90625},{x:.21875,y:.90625},{x:.21875,y:.90625},{x:.28125,y:.90625},{x:.28125,y:.90625},{x:.34375,y:.90625},{x:.34375,y:.90625},{x:.40625,y:.90625},{x:.40625,y:.90625},{x:.46875,y:.90625},{x:.46875,y:.90625},{x:.53125,y:.90625},{x:.53125,y:.90625},{x:.59375,y:.90625},{x:.59375,y:.90625},{x:.65625,y:.90625},{x:.65625,y:.90625},{x:.71875,y:.90625},{x:.71875,y:.90625},{x:.78125,y:.90625},{x:.78125,y:.90625},{x:.84375,y:.90625},{x:.84375,y:.90625},{x:.90625,y:.90625},{x:.90625,y:.90625},{x:.96875,y:.90625},{x:.96875,y:.90625},{x:.03125,y:.96875},{x:.03125,y:.96875},{x:.09375,y:.96875},{x:.09375,y:.96875},{x:.15625,y:.96875},{x:.15625,y:.96875},{x:.21875,y:.96875},{x:.21875,y:.96875},{x:.28125,y:.96875},{x:.28125,y:.96875},{x:.34375,y:.96875},{x:.34375,y:.96875},{x:.40625,y:.96875},{x:.40625,y:.96875},{x:.46875,y:.96875},{x:.46875,y:.96875},{x:.53125,y:.96875},{x:.53125,y:.96875},{x:.59375,y:.96875},{x:.59375,y:.96875},{x:.65625,y:.96875},{x:.65625,y:.96875},{x:.71875,y:.96875},{x:.71875,y:.96875},{x:.78125,y:.96875},{x:.78125,y:.96875},{x:.84375,y:.96875},{x:.84375,y:.96875},{x:.90625,y:.96875},{x:.90625,y:.96875},{x:.96875,y:.96875},{x:.96875,y:.96875},{x:.0625,y:.0625},{x:.0625,y:.0625},{x:.0625,y:.0625},{x:.0625,y:.0625},{x:.0625,y:.0625},{x:.0625,y:.0625},{x:.1875,y:.0625},{x:.1875,y:.0625},{x:.1875,y:.0625},{x:.1875,y:.0625},{x:.1875,y:.0625},{x:.1875,y:.0625},{x:.3125,y:.0625},{x:.3125,y:.0625},{x:.3125,y:.0625},{x:.3125,y:.0625},{x:.3125,y:.0625},{x:.3125,y:.0625},{x:.4375,y:.0625},{x:.4375,y:.0625},{x:.4375,y:.0625},{x:.4375,y:.0625},{x:.4375,y:.0625},{x:.4375,y:.0625},{x:.5625,y:.0625},{x:.5625,y:.0625},{x:.5625,y:.0625},{x:.5625,y:.0625},{x:.5625,y:.0625},{x:.5625,y:.0625},{x:.6875,y:.0625},{x:.6875,y:.0625},{x:.6875,y:.0625},{x:.6875,y:.0625},{x:.6875,y:.0625},{x:.6875,y:.0625},{x:.8125,y:.0625},{x:.8125,y:.0625},{x:.8125,y:.0625},{x:.8125,y:.0625},{x:.8125,y:.0625},{x:.8125,y:.0625},{x:.9375,y:.0625},{x:.9375,y:.0625},{x:.9375,y:.0625},{x:.9375,y:.0625},{x:.9375,y:.0625},{x:.9375,y:.0625},{x:.0625,y:.1875},{x:.0625,y:.1875},{x:.0625,y:.1875},{x:.0625,y:.1875},{x:.0625,y:.1875},{x:.0625,y:.1875},{x:.1875,y:.1875},{x:.1875,y:.1875},{x:.1875,y:.1875},{x:.1875,y:.1875},{x:.1875,y:.1875},{x:.1875,y:.1875},{x:.3125,y:.1875},{x:.3125,y:.1875},{x:.3125,y:.1875},{x:.3125,y:.1875},{x:.3125,y:.1875},{x:.3125,y:.1875},{x:.4375,y:.1875},{x:.4375,y:.1875},{x:.4375,y:.1875},{x:.4375,y:.1875},{x:.4375,y:.1875},{x:.4375,y:.1875},{x:.5625,y:.1875},{x:.5625,y:.1875},{x:.5625,y:.1875},{x:.5625,y:.1875},{x:.5625,y:.1875},{x:.5625,y:.1875},{x:.6875,y:.1875},{x:.6875,y:.1875},{x:.6875,y:.1875},{x:.6875,y:.1875},{x:.6875,y:.1875},{x:.6875,y:.1875},{x:.8125,y:.1875},{x:.8125,y:.1875},{x:.8125,y:.1875},{x:.8125,y:.1875},{x:.8125,y:.1875},{x:.8125,y:.1875},{x:.9375,y:.1875},{x:.9375,y:.1875},{x:.9375,y:.1875},{x:.9375,y:.1875},{x:.9375,y:.1875},{x:.9375,y:.1875},{x:.0625,y:.3125},{x:.0625,y:.3125},{x:.0625,y:.3125},{x:.0625,y:.3125},{x:.0625,y:.3125},{x:.0625,y:.3125},{x:.1875,y:.3125},{x:.1875,y:.3125},{x:.1875,y:.3125},{x:.1875,y:.3125},{x:.1875,y:.3125},{x:.1875,y:.3125},{x:.3125,y:.3125},{x:.3125,y:.3125},{x:.3125,y:.3125},{x:.3125,y:.3125},{x:.3125,y:.3125},{x:.3125,y:.3125},{x:.4375,y:.3125},{x:.4375,y:.3125},{x:.4375,y:.3125},{x:.4375,y:.3125},{x:.4375,y:.3125},{x:.4375,y:.3125},{x:.5625,y:.3125},{x:.5625,y:.3125},{x:.5625,y:.3125},{x:.5625,y:.3125},{x:.5625,y:.3125},{x:.5625,y:.3125},{x:.6875,y:.3125},{x:.6875,y:.3125},{x:.6875,y:.3125},{x:.6875,y:.3125},{x:.6875,y:.3125},{x:.6875,y:.3125},{x:.8125,y:.3125},{x:.8125,y:.3125},{x:.8125,y:.3125},{x:.8125,y:.3125},{x:.8125,y:.3125},{x:.8125,y:.3125},{x:.9375,y:.3125},{x:.9375,y:.3125},{x:.9375,y:.3125},{x:.9375,y:.3125},{x:.9375,y:.3125},{x:.9375,y:.3125},{x:.0625,y:.4375},{x:.0625,y:.4375},{x:.0625,y:.4375},{x:.0625,y:.4375},{x:.0625,y:.4375},{x:.0625,y:.4375},{x:.1875,y:.4375},{x:.1875,y:.4375},{x:.1875,y:.4375},{x:.1875,y:.4375},{x:.1875,y:.4375},{x:.1875,y:.4375},{x:.3125,y:.4375},{x:.3125,y:.4375},{x:.3125,y:.4375},{x:.3125,y:.4375},{x:.3125,y:.4375},{x:.3125,y:.4375},{x:.4375,y:.4375},{x:.4375,y:.4375},{x:.4375,y:.4375},{x:.4375,y:.4375},{x:.4375,y:.4375},{x:.4375,y:.4375},{x:.5625,y:.4375},{x:.5625,y:.4375},{x:.5625,y:.4375},{x:.5625,y:.4375},{x:.5625,y:.4375},{x:.5625,y:.4375},{x:.6875,y:.4375},{x:.6875,y:.4375},{x:.6875,y:.4375},{x:.6875,y:.4375},{x:.6875,y:.4375},{x:.6875,y:.4375},{x:.8125,y:.4375},{x:.8125,y:.4375},{x:.8125,y:.4375},{x:.8125,y:.4375},{x:.8125,y:.4375},{x:.8125,y:.4375},{x:.9375,y:.4375},{x:.9375,y:.4375},{x:.9375,y:.4375},{x:.9375,y:.4375},{x:.9375,y:.4375},{x:.9375,y:.4375},{x:.0625,y:.5625},{x:.0625,y:.5625},{x:.0625,y:.5625},{x:.0625,y:.5625},{x:.0625,y:.5625},{x:.0625,y:.5625},{x:.1875,y:.5625},{x:.1875,y:.5625},{x:.1875,y:.5625},{x:.1875,y:.5625},{x:.1875,y:.5625},{x:.1875,y:.5625},{x:.3125,y:.5625},{x:.3125,y:.5625},{x:.3125,y:.5625},{x:.3125,y:.5625},{x:.3125,y:.5625},{x:.3125,y:.5625},{x:.4375,y:.5625},{x:.4375,y:.5625},{x:.4375,y:.5625},{x:.4375,y:.5625},{x:.4375,y:.5625},{x:.4375,y:.5625},{x:.5625,y:.5625},{x:.5625,y:.5625},{x:.5625,y:.5625},{x:.5625,y:.5625},{x:.5625,y:.5625},{x:.5625,y:.5625},{x:.6875,y:.5625},{x:.6875,y:.5625},{x:.6875,y:.5625},{x:.6875,y:.5625},{x:.6875,y:.5625},{x:.6875,y:.5625},{x:.8125,y:.5625},{x:.8125,y:.5625},{x:.8125,y:.5625},{x:.8125,y:.5625},{x:.8125,y:.5625},{x:.8125,y:.5625},{x:.9375,y:.5625},{x:.9375,y:.5625},{x:.9375,y:.5625},{x:.9375,y:.5625},{x:.9375,y:.5625},{x:.9375,y:.5625},{x:.0625,y:.6875},{x:.0625,y:.6875},{x:.0625,y:.6875},{x:.0625,y:.6875},{x:.0625,y:.6875},{x:.0625,y:.6875},{x:.1875,y:.6875},{x:.1875,y:.6875},{x:.1875,y:.6875},{x:.1875,y:.6875},{x:.1875,y:.6875},{x:.1875,y:.6875},{x:.3125,y:.6875},{x:.3125,y:.6875},{x:.3125,y:.6875},{x:.3125,y:.6875},{x:.3125,y:.6875},{x:.3125,y:.6875},{x:.4375,y:.6875},{x:.4375,y:.6875},{x:.4375,y:.6875},{x:.4375,y:.6875},{x:.4375,y:.6875},{x:.4375,y:.6875},{x:.5625,y:.6875},{x:.5625,y:.6875},{x:.5625,y:.6875},{x:.5625,y:.6875},{x:.5625,y:.6875},{x:.5625,y:.6875},{x:.6875,y:.6875},{x:.6875,y:.6875},{x:.6875,y:.6875},{x:.6875,y:.6875},{x:.6875,y:.6875},{x:.6875,y:.6875},{x:.8125,y:.6875},{x:.8125,y:.6875},{x:.8125,y:.6875},{x:.8125,y:.6875},{x:.8125,y:.6875},{x:.8125,y:.6875},{x:.9375,y:.6875},{x:.9375,y:.6875},{x:.9375,y:.6875},{x:.9375,y:.6875},{x:.9375,y:.6875},{x:.9375,y:.6875},{x:.0625,y:.8125},{x:.0625,y:.8125},{x:.0625,y:.8125},{x:.0625,y:.8125},{x:.0625,y:.8125},{x:.0625,y:.8125},{x:.1875,y:.8125},{x:.1875,y:.8125},{x:.1875,y:.8125},{x:.1875,y:.8125},{x:.1875,y:.8125},{x:.1875,y:.8125},{x:.3125,y:.8125},{x:.3125,y:.8125},{x:.3125,y:.8125},{x:.3125,y:.8125},{x:.3125,y:.8125},{x:.3125,y:.8125},{x:.4375,y:.8125},{x:.4375,y:.8125},{x:.4375,y:.8125},{x:.4375,y:.8125},{x:.4375,y:.8125},{x:.4375,y:.8125},{x:.5625,y:.8125},{x:.5625,y:.8125},{x:.5625,y:.8125},{x:.5625,y:.8125},{x:.5625,y:.8125},{x:.5625,y:.8125},{x:.6875,y:.8125},{x:.6875,y:.8125},{x:.6875,y:.8125},{x:.6875,y:.8125},{x:.6875,y:.8125},{x:.6875,y:.8125},{x:.8125,y:.8125},{x:.8125,y:.8125},{x:.8125,y:.8125},{x:.8125,y:.8125},{x:.8125,y:.8125},{x:.8125,y:.8125},{x:.9375,y:.8125},{x:.9375,y:.8125},{x:.9375,y:.8125},{x:.9375,y:.8125},{x:.9375,y:.8125},{x:.9375,y:.8125},{x:.0625,y:.9375},{x:.0625,y:.9375},{x:.0625,y:.9375},{x:.0625,y:.9375},{x:.0625,y:.9375},{x:.0625,y:.9375},{x:.1875,y:.9375},{x:.1875,y:.9375},{x:.1875,y:.9375},{x:.1875,y:.9375},{x:.1875,y:.9375},{x:.1875,y:.9375},{x:.3125,y:.9375},{x:.3125,y:.9375},{x:.3125,y:.9375},{x:.3125,y:.9375},{x:.3125,y:.9375},{x:.3125,y:.9375},{x:.4375,y:.9375},{x:.4375,y:.9375},{x:.4375,y:.9375},{x:.4375,y:.9375},{x:.4375,y:.9375},{x:.4375,y:.9375},{x:.5625,y:.9375},{x:.5625,y:.9375},{x:.5625,y:.9375},{x:.5625,y:.9375},{x:.5625,y:.9375},{x:.5625,y:.9375},{x:.6875,y:.9375},{x:.6875,y:.9375},{x:.6875,y:.9375},{x:.6875,y:.9375},{x:.6875,y:.9375},{x:.6875,y:.9375},{x:.8125,y:.9375},{x:.8125,y:.9375},{x:.8125,y:.9375},{x:.8125,y:.9375},{x:.8125,y:.9375},{x:.8125,y:.9375},{x:.9375,y:.9375},{x:.9375,y:.9375},{x:.9375,y:.9375},{x:.9375,y:.9375},{x:.9375,y:.9375},{x:.9375,y:.9375}],sQ=[0,5,9,13,17,1,2],oQ=0,lQ={thumb:[1,2,3,4],index:[5,6,7,8],middle:[9,10,11,12],ring:[13,14,15,16],pinky:[17,18,19,20],palm:[0]};async function uQ(e,t){aQ||function(){const e=nQ?new class{constructor(e){var t,n,r,a;s(this,"model"),s(this,"anchors"),s(this,"anchorsTensor"),s(this,"inputSize"),s(this,"inputSizeTensor"),s(this,"doubleInputSizeTensor"),this.model=e,this.anchors=iQ.map((e=>[e.x,e.y])),this.anchorsTensor=Rc(this.anchors),this.inputSize=(null==(a=null==(r=null==(n=null==(t=null==this?void 0:this.model)?void 0:t.inputs)?void 0:n[0])?void 0:r.shape)?void 0:a[2])||0,this.inputSizeTensor=Nc([this.inputSize,this.inputSize]),this.doubleInputSizeTensor=Nc([2*this.inputSize,2*this.inputSize])}normalizeBoxes(e){const t={};t.boxOffsets=Jo(e,[0,0],[-1,2]),t.boxSizes=Jo(e,[0,2],[-1,2]),t.div=go(t.boxOffsets,this.inputSizeTensor),t.boxCenterPoints=mo(t.div,this.anchorsTensor),t.halfBoxSizes=go(t.boxSizes,this.doubleInputSizeTensor),t.sub=Uu(t.boxCenterPoints,t.halfBoxSizes),t.startPoints=yo(t.sub,this.inputSizeTensor),t.add=mo(t.boxCenterPoints,t.halfBoxSizes),t.endPoints=yo(t.add,this.inputSizeTensor);const n=fl([t.startPoints,t.endPoints],1);return Object.keys(t).forEach((e=>to(t[e]))),n}normalizeLandmarks(e,t){const n={};n.reshape=Go(e,[-1,7,2]),n.div=go(n.reshape,this.inputSizeTensor),n.landmarks=mo(n.div,this.anchors[t]?this.anchors[t]:0);const r=yo(n.landmarks,this.inputSizeTensor);return Object.keys(n).forEach((e=>to(n[e]))),r}async predict(e,t){var n;const r={};r.resize=hp.resizeBilinear(e,[this.inputSize,this.inputSize]),r.div=go(r.resize,_X.tf127),r.image=Uu(r.div,_X.tf1),r.batched=this.model.execute(r.image),r.predictions=Tc(r.batched),r.slice=Jo(r.predictions,[0,0],[-1,1]),r.sigmoid=Yo(r.slice),r.scores=Tc(r.sigmoid);const a=await r.scores.data();r.boxes=Jo(r.predictions,[0,1],[-1,4]),r.norm=this.normalizeBoxes(r.boxes),r.nms=await hp.nonMaxSuppressionAsync(r.norm,r.scores,3*((null==(n=t.hand)?void 0:n.maxDetected)||1),t.hand.iouThreshold,t.hand.minConfidence);const i=await r.nms.array(),s=[];for(const t of i){const n={};n.box=Jo(r.norm,[t,0],[1,-1]),n.slice=Jo(r.predictions,[t,5],[1,14]),n.norm=this.normalizeLandmarks(n.slice,t),n.palmLandmarks=Go(n.norm,[-1,2]);const i=await n.box.data(),o=GJ({startPoint:i.slice(0,2),endPoint:i.slice(2,4),palmLandmarks:await n.palmLandmarks.array(),confidence:a[t]},[(e.shape[2]||1)/this.inputSize,(e.shape[1]||0)/this.inputSize]);s.push(o),Object.keys(n).forEach((e=>to(n[e])))}return Object.keys(r).forEach((e=>to(r[e]))),s}}(nQ):void 0;e&&rQ&&(aQ=new class{constructor(e,t){var n,r,a;s(this,"handDetector"),s(this,"handPoseModel"),s(this,"inputSize"),s(this,"storedBoxes"),s(this,"skipped"),s(this,"detectedHands"),this.handDetector=e,this.handPoseModel=t,this.inputSize=(null==(a=null==(r=null==(n=this.handPoseModel)?void 0:n.inputs)?void 0:r[0].shape)?void 0:a[2])||0,this.storedBoxes=[],this.skipped=Number.MAX_SAFE_INTEGER,this.detectedHands=0}calculateLandmarksBoundingBox(e){const t=e.map((e=>e[0])),n=e.map((e=>e[1]));return{startPoint:[Math.min(...t),Math.min(...n)],endPoint:[Math.max(...t),Math.max(...n)]}}getBoxForPalmLandmarks(e,t){const n=e.map((e=>tQ([...e,1],t)));return qJ(XJ(this.calculateLandmarksBoundingBox(n)),5)}getBoxForHandLandmarks(e){const t=qJ(XJ(this.calculateLandmarksBoundingBox(e)),1.65);t.palmLandmarks=[];for(let n=0;n<sQ.length;n++)t.palmLandmarks.push(e[sQ[n]].slice(0,2));return t}transformRawCoords(e,t,n,r){const a=VJ(t),i=[a[0]/this.inputSize,a[1]/this.inputSize,(a[0]+a[1])/this.inputSize/2],s=e.map((e=>[i[0]*(e[0]-this.inputSize/2),i[1]*(e[1]-this.inputSize/2),i[2]*e[2]])),o=eQ(n,[0,0]),l=s.map((e=>[...tQ(e,o),e[2]])),u=function(e){const t=[[e[0][0],e[1][0]],[e[0][1],e[1][1]]],n=[e[0][2],e[1][2]],r=[-YJ(t[0],n),-YJ(t[1],n)];return[t[0].concat(r[0]),t[1].concat(r[1]),[0,0,1]]}(r),d=[...jJ(t),1],c=[YJ(d,u[0]),YJ(d,u[1])];return l.map((e=>[Math.trunc(e[0]+c[0]),Math.trunc(e[1]+c[1]),Math.trunc(e[2])]))}async estimateHands(e,t){let n,r=!1;const a=(t.hand.skipTime||0)>UG()-oQ,i=this.skipped<(t.hand.skipFrames||0);t.skipAllowed&&a&&i?this.skipped++:(n=await this.handDetector.predict(e,t),this.skipped=0),n&&n.length>0&&(n.length!==this.detectedHands&&this.detectedHands!==t.hand.maxDetected||!t.hand.landmarks)&&(this.detectedHands=0,this.storedBoxes=[...n],this.storedBoxes.length>0&&(r=!0));const s=[];for(let n=0;n<this.storedBoxes.length;n++){const a=this.storedBoxes[n];if(a)if(t.hand.landmarks){const i=t.hand.rotation?KJ(a.palmLandmarks[0],a.palmLandmarks[2]):0,o=jJ(a),l=[o[0]/e.shape[2],o[1]/e.shape[1]],u=t.hand.rotation&&mq.kernels.includes("rotatewithoffset")?hp.rotateWithOffset(e,i,0,l):e.clone(),d=eQ(-i,o),c=r?this.getBoxForPalmLandmarks(a.palmLandmarks,d):a,h=HJ(c,u,[this.inputSize,this.inputSize]),p=go(h,_X.tf255);to(h),to(u);const[m,f]=this.handPoseModel.execute(p);oQ=UG(),to(p);const g=(await m.data())[0];if(to(m),g>=t.hand.minConfidence/4){const e=Go(f,[-1,3]),t=await e.array();to(f),to(e);const r=this.transformRawCoords(t,c,i,d),o=this.getBoxForHandLandmarks(r);this.storedBoxes[n]={...o,confidence:g};const l={landmarks:r,confidence:g,boxConfidence:a.confidence,fingerConfidence:g,box:{topLeft:o.startPoint,bottomRight:o.endPoint}};s.push(l)}else this.storedBoxes[n]=null;to(f)}else{const e=qJ(XJ(a),1.65),t={confidence:a.confidence,boxConfidence:a.confidence,fingerConfidence:0,box:{topLeft:e.startPoint,bottomRight:e.endPoint},landmarks:[]};s.push(t)}}return this.storedBoxes=this.storedBoxes.filter((e=>null!==e)),this.detectedHands=s.length,s.length>t.hand.maxDetected&&(s.length=t.hand.maxDetected),s}}(e,rQ))}();const n=await aQ.estimateHands(e,t);if(!n)return[];const r=[];for(let t=0;t<n.length;t++){const a={};if(n[t].landmarks)for(const e of Object.keys(lQ))a[e]=lQ[e].map((e=>n[t].landmarks[e]));const i=n[t].landmarks;let s=[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,0,0],o=[0,0,0,0];if(i&&i.length>0){for(const e of i)e[0]<s[0]&&(s[0]=e[0]),e[1]<s[1]&&(s[1]=e[1]),e[0]>s[2]&&(s[2]=e[0]),e[1]>s[3]&&(s[3]=e[1]);s[2]-=s[0],s[3]-=s[1],o=[s[0]/(e.shape[2]||0),s[1]/(e.shape[1]||0),s[2]/(e.shape[2]||0),s[3]/(e.shape[1]||0)]}else s=n[t].box?[Math.trunc(Math.max(0,n[t].box.topLeft[0])),Math.trunc(Math.max(0,n[t].box.topLeft[1])),Math.trunc(Math.min(e.shape[2]||0,n[t].box.bottomRight[0])-Math.max(0,n[t].box.topLeft[0])),Math.trunc(Math.min(e.shape[1]||0,n[t].box.bottomRight[1])-Math.max(0,n[t].box.topLeft[1]))]:[0,0,0,0],o=[n[t].box.topLeft[0]/(e.shape[2]||0),n[t].box.topLeft[1]/(e.shape[1]||0),(n[t].box.bottomRight[0]-n[t].box.topLeft[0])/(e.shape[2]||0),(n[t].box.bottomRight[1]-n[t].box.topLeft[1])/(e.shape[1]||0)];const l=FJ(i);r.push({id:t,score:Math.round(100*n[t].confidence)/100,boxScore:Math.round(100*n[t].boxConfidence)/100,fingerScore:Math.round(100*n[t].fingerConfidence)/100,label:"hand",box:s,boxRaw:o,keypoints:i,annotations:a,landmarks:l})}return r}var dQ=[null,null],cQ=["StatefulPartitionedCall/Postprocessor/Slice","StatefulPartitionedCall/Postprocessor/ExpandDims_1"],hQ=[[0,0],[0,0]],pQ=["hand","fist","pinch","point","face","tip","pinchtip"],mQ=Number.MAX_SAFE_INTEGER,fQ=0,gQ=[0,0],yQ={boxes:[],hands:[]},bQ={thumb:[1,2,3,4],index:[5,6,7,8],middle:[9,10,11,12],ring:[13,14,15,16],pinky:[17,18,19,20],base:[0],palm:[0,17,13,9,5,1,0]};async function xQ(e,t,n){const r={id:t.id,score:Math.round(100*t.score)/100,boxScore:Math.round(100*t.score)/100,fingerScore:0,box:t.box,boxRaw:t.boxRaw,label:t.label,keypoints:[],landmarks:{},annotations:{}};if(e&&dQ[1]&&n.hand.landmarks&&t.score>(n.hand.minConfidence||0)){const a={},i=[t.boxRaw[1],t.boxRaw[0],t.boxRaw[3]+t.boxRaw[1],t.boxRaw[2]+t.boxRaw[0]];a.crop=hp.cropAndResize(e,[i],[0],[hQ[1][0],hQ[1][1]],"bilinear"),a.div=go(a.crop,_X.tf255),[a.score,a.keypoints]=dQ[1].execute(a.div,["Identity_1","Identity"]);const s=(await a.score.data())[0],o=(100-Math.trunc(100/(1+Math.exp(s))))/100;if(o>=(n.hand.minConfidence||0)){r.fingerScore=o,a.reshaped=Go(a.keypoints,[-1,3]);const e=(await a.reshaped.array()).map((e=>[e[0]/hQ[1][1],e[1]/hQ[1][0],e[2]||0])).map((e=>[e[0]*t.boxRaw[2],e[1]*t.boxRaw[3],e[2]||0]));r.keypoints=e.map((e=>[gQ[0]*(e[0]+t.boxRaw[0]),gQ[1]*(e[1]+t.boxRaw[1]),e[2]||0])),r.landmarks=FJ(r.keypoints);for(const e of Object.keys(bQ))r.annotations[e]=bQ[e].map((e=>r.landmarks&&r.keypoints[e]?r.keypoints[e]:null))}Object.keys(a).forEach((e=>to(a[e])))}return r}async function AQ(e,t){var n,r;if(!((null==(n=dQ[0])?void 0:n.executor)&&(null==(r=dQ[1])?void 0:r.executor)&&dQ[0].inputs[0].shape&&dQ[1].inputs[0].shape))return[];gQ=[e.shape[2]||0,e.shape[1]||0],mQ++;const a=(t.hand.skipTime||0)>UG()-fQ,i=mQ<(t.hand.skipFrames||0);return t.skipAllowed&&a&&i?yQ.hands:new Promise((async n=>{const r=3*(t.hand.skipTime||0)>UG()-fQ,a=mQ<3*(t.hand.skipFrames||0);t.skipAllowed&&yQ.hands.length===t.hand.maxDetected||t.skipAllowed&&r&&a&&yQ.hands.length>0?yQ.hands=await Promise.all(yQ.boxes.map((n=>xQ(e,n,t)))):(yQ.boxes=await async function(e,t){const n=[];if(!e||!dQ[0])return n;const r={},a=(e.shape[2]||1)/(e.shape[1]||1),i=Math.min(8*Math.round((e.shape[1]||0)/8),512),s=8*Math.round(i*a/8);r.resize=hp.resizeBilinear(e,[i,s]),r.cast=Vs(r.resize,"int32"),[r.rawScores,r.rawBoxes]=await dQ[0].executeAsync(r.cast,cQ),r.boxes=Tc(r.rawBoxes,[0,2]),r.scores=Tc(r.rawScores,[0]);const o=Hc(r.scores,1);to(o[4]),o.splice(4,1),r.filtered=_c(o,1),to(o),r.max=tu(r.filtered,1),r.argmax=So(r.filtered,1);let l=0;r.nms=await hp.nonMaxSuppressionAsync(r.boxes,r.max,(t.hand.maxDetected||0)+1,t.hand.iouThreshold||0,t.hand.minConfidence||1);const u=await r.nms.data(),d=await r.max.data(),c=await r.argmax.data();for(const e of Array.from(u)){const t=Jo(r.boxes,e,1),a=await t.data();to(t);const i=[a[1],a[0],a[3]-a[1],a[2]-a[0]],s=NK(i,1.4),o=[Math.trunc(i[0]*gQ[0]),Math.trunc(i[1]*gQ[1]),Math.trunc(i[2]*gQ[0]),Math.trunc(i[3]*gQ[1])],u={id:l++,score:d[e],box:o,boxRaw:s,label:pQ[c[e]]};n.push(u)}return Object.keys(r).forEach((e=>to(r[e]))),n.sort(((e,t)=>t.score-e.score)),n.length>(t.hand.maxDetected||1)&&(n.length=t.hand.maxDetected||1),n}(e,t),fQ=UG(),yQ.hands=await Promise.all(yQ.boxes.map((n=>xQ(e,n,t)))),mQ=0);const i=[...yQ.boxes];if(yQ.boxes.length=0,t.cacheSensitivity>0)for(let n=0;n<yQ.hands.length;n++){const r=EK(yQ.hands[n].keypoints,gQ);if(r.box[2]/(e.shape[2]||1)>.05&&r.box[3]/(e.shape[1]||1)>.05&&yQ.hands[n].fingerScore&&yQ.hands[n].fingerScore>(t.hand.minConfidence||0)){const e=NK(r.box,1.6),t=NK(r.boxRaw,1.6);yQ.boxes.push({...i[n],box:e,boxRaw:t})}}for(let e=0;e<yQ.hands.length;e++){const t=CK(yQ.hands[e].keypoints,gQ);yQ.hands[e].box=t.box,yQ.hands[e].boxRaw=t.boxRaw}n(yQ.hands)}))}var vQ=(e=null)=>({face:[],body:[],hand:[],gesture:[],object:[],persons:[],performance:{},timestamp:0,width:0,height:0,error:e}),wQ={};i(wQ,{connected:()=>CQ,horizontal:()=>TQ,kpt:()=>SQ,relative:()=>IQ,vertical:()=>_Q});var kQ,SQ=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],TQ=[["leftEye","rightEye"],["leftEar","rightEar"],["leftShoulder","rightShoulder"],["leftElbow","rightElbow"],["leftWrist","rightWrist"],["leftHip","rightHip"],["leftKnee","rightKnee"],["leftAnkle","rightAnkle"]],_Q=[["leftKnee","leftShoulder"],["rightKnee","rightShoulder"],["leftAnkle","leftKnee"],["rightAnkle","rightKnee"]],IQ=[[["leftHip","rightHip"],["leftShoulder","rightShoulder"]],[["leftElbow","rightElbow"],["leftShoulder","rightShoulder"]]],CQ={leftLeg:["leftHip","leftKnee","leftAnkle"],rightLeg:["rightHip","rightKnee","rightAnkle"],torso:["leftShoulder","rightShoulder","rightHip","leftHip","leftShoulder"],leftArm:["leftShoulder","leftElbow","leftWrist"],rightArm:["rightShoulder","rightElbow","rightWrist"],head:[]},EQ=vQ(),NQ=0;async function RQ(e){return!kQ||mq.initial?kQ=await kX(e.segmentation.modelPath):e.debug&&BG("cached model:",kQ.modelUrl),kQ}var PQ={};function DQ(e,t,n={order:2,multiplier:25}){if(!e||!e)return Number.MAX_SAFE_INTEGER;let r=0;for(let a=0;a<e.length;a++){const i=n.order&&2!==n.order?Math.abs(e[a]-t[a]):e[a]-t[a];r+=n.order&&2!==n.order?i**n.order:i*i}return(n.multiplier||20)*r}i(PQ,{distance:()=>DQ,find:()=>$Q,similarity:()=>OQ});var MQ=(e,t,n,r)=>{if(0===e)return 1;const a=(1-(2===t?Math.sqrt(e):e**(1/t))/100-n)/(r-n);return Math.max(Math.min(a,1),0)};function OQ(e,t,n={order:2,multiplier:25,min:.2,max:.8}){const r=DQ(e,t,n);return MQ(r,n.order||2,n.min||0,n.max||1)}function $Q(e,t,n={order:2,multiplier:25,threshold:0,min:.2,max:.8}){if(!Array.isArray(e)||!Array.isArray(t)||e.length<64||0===t.length)return{index:-1,distance:Number.POSITIVE_INFINITY,similarity:0};let r=Number.MAX_SAFE_INTEGER,a=-1;for(let i=0;i<t.length;i++){const s=t[i].length===e.length?DQ(e,t[i],n):Number.MAX_SAFE_INTEGER;if(s<r&&(r=s,a=i),r<(n.threshold||0))break}return{index:a,distance:r,similarity:MQ(r,n.order||2,n.min||0,n.max||1)}}i({},{Models:()=>F0,validateModel:()=>R0});var FQ,LQ=.005,zQ={keypoints:[],padding:[[0,0],[0,0],[0,0],[0,0]]};function BQ(e){for(const t of TQ){const n=e.keypoints.findIndex((e=>e.part===t[0])),r=e.keypoints.findIndex((e=>e.part===t[1]));if(e.keypoints[n]&&e.keypoints[r]&&e.keypoints[n].position[0]<e.keypoints[r].position[0]){const t=e.keypoints[n];e.keypoints[n]=e.keypoints[r],e.keypoints[r]=t}}for(const t of _Q){const n=e.keypoints.findIndex((e=>e&&e.part===t[0])),r=e.keypoints.findIndex((e=>e&&e.part===t[1]));e.keypoints[n]&&e.keypoints[r]&&e.keypoints[n].position[1]<e.keypoints[r].position[1]&&e.keypoints.splice(n,1)}for(const[t,n]of IQ){const r=e.keypoints.findIndex((e=>e&&e.part===t[0])),a=e.keypoints.findIndex((e=>e&&e.part===t[1])),i=e.keypoints.findIndex((e=>e&&e.part===n[0])),s=e.keypoints.findIndex((e=>e&&e.part===n[1]));if(!e.keypoints[i]||!e.keypoints[s])continue;const o=e.keypoints[r]?[Math.abs(e.keypoints[i].position[0]-e.keypoints[r].position[0]),Math.abs(e.keypoints[s].position[0]-e.keypoints[r].position[0])]:[0,0],l=e.keypoints[a]?[Math.abs(e.keypoints[s].position[0]-e.keypoints[a].position[0]),Math.abs(e.keypoints[i].position[0]-e.keypoints[a].position[0])]:[0,0];if(o[0]>o[1]||l[0]>l[1]){const t=e.keypoints[r];e.keypoints[r]=e.keypoints[a],e.keypoints[a]=t}}}function UQ(e){for(let t=0;t<e.length;t++)if(e[t]&&zQ.keypoints[t]){const n=[Math.abs(e[t].positionRaw[0]-zQ.keypoints[t].positionRaw[0]),Math.abs(e[t].positionRaw[1]-zQ.keypoints[t].positionRaw[1])];n[0]<LQ&&n[1]<LQ?e[t]=zQ.keypoints[t]:zQ.keypoints[t]=e[t]}else zQ.keypoints[t]=e[t];return e}function WQ(e,t){e.keypoints=e.keypoints.filter((e=>null==e?void 0:e.position));for(const n of e.keypoints)n.position=[n.position[0]*(t[0]+zQ.padding[2][0]+zQ.padding[2][1])/t[0]-zQ.padding[2][0],n.position[1]*(t[1]+zQ.padding[1][0]+zQ.padding[1][1])/t[1]-zQ.padding[1][0]],n.positionRaw=[n.position[0]/t[0],n.position[1]/t[1]];const n=CK(e.keypoints.map((e=>e.position)),t);return e.box=n.box,e.boxRaw=n.boxRaw,e}var VQ,jQ=0,HQ=Number.MAX_SAFE_INTEGER,GQ={boxes:[],bodies:[],last:0};async function qQ(e,t){var n;if(!(null==FQ?void 0:FQ.executor)||!(null==(n=null==FQ?void 0:FQ.inputs)?void 0:n[0].shape))return[];t.skipAllowed||(GQ.boxes.length=0),HQ++;const r=(t.body.skipTime||0)>UG()-GQ.last,a=HQ<(t.body.skipFrames||0);return t.skipAllowed&&r&&a?GQ.bodies:new Promise((async n=>{const r={};HQ=0,r.input=function(e,t){var n,r;const a={};if(!(null==(n=null==e?void 0:e.shape)?void 0:n[1])||!(null==(r=null==e?void 0:e.shape)?void 0:r[2]))return e;zQ.padding=[[0,0],[e.shape[2]>e.shape[1]?Math.trunc((e.shape[2]-e.shape[1])/2):0,e.shape[2]>e.shape[1]?Math.trunc((e.shape[2]-e.shape[1])/2):0],[e.shape[1]>e.shape[2]?Math.trunc((e.shape[1]-e.shape[2])/2):0,e.shape[1]>e.shape[2]?Math.trunc((e.shape[1]-e.shape[2])/2):0],[0,0]],a.pad=fd(e,zQ.padding),a.resize=hp.resizeBilinear(a.pad,[t,t]);const i=Vs(a.resize,"int32");return Object.keys(a).forEach((e=>to(a[e]))),i}(e,jQ),r.res=null==FQ?void 0:FQ.execute(r.input),GQ.last=UG();const a=await r.res.array();GQ.bodies=17===r.res.shape[2]?function(e,t,n){const r=e[0][0],a=[];let i=0;for(let e=0;e<r.length;e++)if(i=r[e][2],i>t.body.minConfidence){const t=[r[e][1],r[e][0]];a.push({score:Math.round(100*i)/100,part:SQ[e],positionRaw:t,position:[Math.round((n.shape[2]||0)*t[0]),Math.round((n.shape[1]||0)*t[1])]})}i=a.reduce(((e,t)=>t.score>e?t.score:e),0);const s=[],o=CK(a.map((e=>e.position)),[n.shape[2],n.shape[1]]),l={};for(const[e,n]of Object.entries(CQ)){const r=[];for(let e=0;e<n.length-1;e++){const i=a.find((t=>t.part===n[e])),s=a.find((t=>t.part===n[e+1]));i&&s&&i.score>(t.body.minConfidence||0)&&s.score>(t.body.minConfidence||0)&&r.push([i.position,s.position])}l[e]=r}const u={id:0,score:i,box:o.box,boxRaw:o.boxRaw,keypoints:a,annotations:l};return BQ(u),s.push(u),s}(a,t,e):function(e,t,n){const r=[];for(let a=0;a<e[0].length;a++){const i=e[0][a],s=Math.round(100*i[55])/100;if(s>t.body.minConfidence){const e=[];for(let r=0;r<17;r++){const a=i[3*r+2];if(a>t.body.minConfidence){const t=[i[3*r+1],i[3*r+0]];e.push({part:SQ[r],score:Math.round(100*a)/100,positionRaw:t,position:[Math.round((n.shape[2]||0)*t[0]),Math.round((n.shape[1]||0)*t[1])]})}}const o=[i[52],i[51],i[54]-i[52],i[53]-i[51]],l=[Math.trunc(o[0]*(n.shape[2]||0)),Math.trunc(o[1]*(n.shape[1]||0)),Math.trunc(o[2]*(n.shape[2]||0)),Math.trunc(o[3]*(n.shape[1]||0))],u={};for(const[n,r]of Object.entries(CQ)){const a=[];for(let n=0;n<r.length-1;n++){const i=e.find((e=>e.part===r[n])),s=e.find((e=>e.part===r[n+1]));i&&s&&i.score>(t.body.minConfidence||0)&&s.score>(t.body.minConfidence||0)&&a.push([i.position,s.position])}u[n]=a}const d={id:a,score:s,box:l,boxRaw:o,keypoints:[...e],annotations:u};BQ(d),r.push(d)}}return r.sort(((e,t)=>t.score-e.score)),r.length>t.body.maxDetected&&(r.length=t.body.maxDetected),r}(a,t,e);for(const t of GQ.bodies)WQ(t,[e.shape[2]||1,e.shape[1]||1]),UQ(t.keypoints);Object.keys(r).forEach((e=>to(r[e]))),n(GQ.bodies)}))}var XQ=[],KQ=0,ZQ=Number.MAX_SAFE_INTEGER,YQ=0,JQ=2.5;async function QQ(e,t){if(!(null==VQ?void 0:VQ.executor))return[];const n=(t.object.skipTime||0)>UG()-KQ,r=ZQ<(t.object.skipFrames||0);return t.skipAllowed&&n&&r&&XQ.length>0?(ZQ++,XQ):(ZQ=0,mq.kernels.includes("mod")&&mq.kernels.includes("sparsetodense")?new Promise((async n=>{const r=[e.shape[2]||0,e.shape[1]||0],a=hp.resizeBilinear(e,[YQ,YQ],!1),i=go(a,_X.tf255),s=Yc(i,[0,3,1,2]);let o;t.object.enabled&&(o=VQ.execute(s)),KQ=UG();const l=await async function(e,t,n){var r,a;let i=0,s=[];const o=YQ;for(const l of[1,2,4]){const u=13*l,d=Tc(e.find((e=>e.shape[1]===u**2&&(e.shape[2]||0)===WK.length))),c=await d.array(),h=Tc(e.find((e=>e.shape[1]===u**2&&(e.shape[2]||0)<WK.length))),p=Go(h,[-1,4,((null==(r=h.shape)?void 0:r[1])||0)/4]),m=So(p,2),f=await m.array();for(let e=0;e<d.shape[0];e++)for(let r=0;r<((null==(a=d.shape)?void 0:a[1])||0);r++){const a=c[e][r];if(a>(n.object.minConfidence||0)&&61!==r){const n=(.5+Math.trunc(e%u))/u,d=(.5+Math.trunc(e/u))/u,c=f[e].map((e=>e*(u/l/o))),[h,p]=[n-JQ/l*c[0],d-JQ/l*c[1]],[m,g]=[n+JQ/l*c[2]-h,d+JQ/l*c[3]-p];let y=[h,p,m,g];y=y.map((e=>Math.max(0,Math.min(e,1))));const b=[y[0]*t[0],y[1]*t[1],y[2]*t[0],y[3]*t[1]],x={id:i++,score:Math.round(100*a)/100,class:r+1,label:WK[r].label,box:b.map((e=>Math.trunc(e))),boxRaw:y};s.push(x)}}to([d,h,p,m])}const l=s.map((e=>[e.boxRaw[1],e.boxRaw[0],e.boxRaw[3],e.boxRaw[2]])),u=s.map((e=>e.score));let d=[];if(l&&l.length>0){const e=await hp.nonMaxSuppressionAsync(l,u,n.object.maxDetected||0,n.object.iouThreshold,n.object.minConfidence);d=Array.from(await e.data()),to(e)}return s=s.filter(((e,t)=>d.includes(t))).sort(((e,t)=>t.score-e.score)),s}(o,r,t);XQ=l,to([a,i,s,...o]),n(l)})):XQ)}var e0=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],t0=e0.length,n0=e0.reduce(((e,t,n)=>(e[t]=n,e)),{}),r0=([["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((([e,t])=>[n0[e],n0[t]])),[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]]);function a0(e){const t=e.reduce((({maxX:e,maxY:t,minX:n,minY:r},{position:{x:a,y:i}})=>({maxX:Math.max(e,a),maxY:Math.max(t,i),minX:Math.min(n,a),minY:Math.min(r,i)})),{maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY});return[t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY]}var i0,s0=class{constructor(e,t){s(this,"priorityQueue"),s(this,"numberOfElements"),s(this,"getElementValue"),this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}enqueue(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)}dequeue(){const e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e}empty(){return-1===this.numberOfElements}size(){return this.numberOfElements+1}all(){return this.priorityQueue.slice(0,this.numberOfElements+1)}max(){return this.priorityQueue[0]}swim(e){for(;e>0&&this.less(Math.floor(e/2),e);)this.exchange(e,Math.floor(e/2)),e=Math.floor(e/2)}sink(e){for(;2*e<=this.numberOfElements;){let t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}}getValueAt(e){return this.getElementValue(this.priorityQueue[e])}less(e,t){return this.getValueAt(e)<this.getValueAt(t)}exchange(e,t){const n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n}};function o0(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+t0)}}function l0(e,t,n){const{heatmapY:r,heatmapX:a,id:i}=e,{y:s,x:o}=o0(r,a,i,n);return{x:e.heatmapX*t+o,y:e.heatmapY*t+s}}function u0(e,t,n){return e<t?t:e>n?n:e}function d0(e,t){return{x:e.x+t.x,y:e.y+t.y}}var c0,h0=["MobilenetV1/offset_2/BiasAdd","MobilenetV1/heatmap_2/BiasAdd","MobilenetV1/displacement_fwd_2/BiasAdd","MobilenetV1/displacement_bwd_2/BiasAdd"],p0=1,m0=16,f0=2500;function g0(e,t,n,r,a,i,s=2){const o=(e,t,n)=>({y:u0(Math.round(e.y/m0),0,t-1),x:u0(Math.round(e.x/m0),0,n-1)}),[l,u]=r.shape,d=(c=o(t.position,l,u),{y:i.get(c.y,c.x,e),x:i.get(c.y,c.x,i.shape[2]/2+e)});var c;let h=d0(t.position,d);for(let e=0;e<s;e++){const e=o(h,l,u),t=o0(e.y,e.x,n,a);h=d0({x:e.x*m0,y:e.y*m0},{x:t.x,y:t.y})}const p=o(h,l,u),m=r.get(p.y,p.x,n);return{position:h,part:e0[n],score:m}}function y0(e,t,n,r,a){const i=r0.map((([e,t])=>[n0[e],n0[t]])),s=i.map((([,e])=>e)),o=i.map((([e])=>e)),l=t.shape[2],u=s.length,d=new Array(l),c=l0(e.part,m0,n);d[e.part.id]={score:e.score,part:e0[e.part.id],position:c};for(let e=u-1;e>=0;--e){const r=s[e],i=o[e];d[r]&&!d[i]&&(d[i]=g0(e,d[r],i,t,n,a))}for(let e=0;e<u;++e){const a=o[e],i=s[e];d[a]&&!d[i]&&(d[i]=g0(e,d[a],i,t,n,r))}return d}function b0(e,t,n,r,a){const[i,s]=a.shape;let o=!0;const l=Math.max(n-p0,0),u=Math.min(n+p0+1,i);for(let n=l;n<u;++n){const i=Math.max(r-p0,0),l=Math.min(r+p0+1,s);for(let r=i;r<l;++r)if(a.get(n,r,e)>t){o=!1;break}if(!o)break}return o}function x0(e,{x:t,y:n},r){return e.some((({keypoints:e})=>{var a;const i=null==(a=e[r])?void 0:a.position;return!!i&&function(e,t,n,r){const a=n-e,i=r-t;return a*a+i*i}(n,t,i.y,i.x)<=f0}))}function A0(e,t){return t.reduce(((t,{position:n,score:r},a)=>(x0(e,n,a)||(t+=r),t)),0)/t.length}async function v0(e,t){if(!(null==i0?void 0:i0.executor))return[];const n=eo((()=>{if(!i0.inputs[0].shape)return[];const t=hp.resizeBilinear(e,[i0.inputs[0].shape[2],i0.inputs[0].shape[1]]),n=Uu(go(Vs(t,"float32"),127.5),1),r=i0.execute(n,h0).map((e=>Tc(e,[0])));return r[1]=Yo(r[1]),r})),r=await Promise.all(n.map((e=>e.buffer())));for(const e of n)to(e);const a=function(e,t,n,r,a,i){const s=[],o=function(e,t){const[n,r,a]=t.shape,i=new s0(n*r*a,(({score:e})=>e));for(let s=0;s<n;++s)for(let n=0;n<r;++n)for(let r=0;r<a;++r){const a=t.get(s,n,r);a<e||b0(r,a,s,n,t)&&i.enqueue({score:a,part:{heatmapY:s,heatmapX:n,id:r}})}return i}(i,t);for(;s.length<a&&!o.empty();){const a=o.dequeue();if(x0(s,l0(a.part,m0,e),a.part.id))continue;let l=y0(a,t,e,n,r);l=l.filter((e=>e.score>i));const u=A0(s,l),d=a0(l);u>i&&s.push({keypoints:l,box:d,score:Math.round(100*u)/100})}return s}(r[0],r[1],r[2],r[3],t.body.maxDetected,t.body.minConfidence);return i0.inputs[0].shape?function(e,[t,n],[r,a]){const i=t/r,s=n/a;return e.map(((e,t)=>((e,t)=>({id:t,score:e.score,boxRaw:[e.box[0]/a,e.box[1]/r,e.box[2]/a,e.box[3]/r],box:[Math.trunc(e.box[0]*s),Math.trunc(e.box[1]*i),Math.trunc(e.box[2]*s),Math.trunc(e.box[3]*i)],keypoints:e.keypoints.map((({score:e,part:t,position:n})=>({score:e,part:t,position:[Math.trunc(n.x*s),Math.trunc(n.y*i)],positionRaw:[n.x/r,n.y/r]}))),annotations:{}}))(e,t)))}(a,[e.shape[1],e.shape[2]],[i0.inputs[0].shape[2],i0.inputs[0].shape[1]]):[]}var w0=["fgr","pha","r1o","r2o","r3o","r4o"],k0={},S0=0;function T0(e){to([k0.r1i,k0.r2i,k0.r3i,k0.r4i,k0.downsample_ratio]),k0.r1i=Gi(0),k0.r2i=Gi(0),k0.r3i=Gi(0),k0.r4i=Gi(0),S0=e.segmentation.ratio||.5,k0.downsample_ratio=Gi(S0)}async function _0(e){return!c0||mq.initial?c0=await kX(e.segmentation.modelPath):e.debug&&BG("cached model:",c0.modelUrl),T0(e),c0}var I0,C0=e=>eo((()=>{const t=Tc(e,[0]),n=yo(t,_X.tf255);return Vs(n,"int32")}));function E0(e,t){const n=e?C0(e):hl([t.shape[1]||0,t.shape[2]||0,3],255,"int32"),r=t?C0(t):hl([e.shape[1]||0,e.shape[2]||0,1],255,"int32"),a=Ko([n,r],-1);return to([n,r]),a}async function N0(e){return!I0||mq.initial?I0=await kX(e.segmentation.modelPath):e.debug&&BG("cached model:",I0.modelUrl),I0}function R0(e,t,n){var r,a;if(!t)return null;if(!(null==(r=null==e?void 0:e.config)?void 0:r.validateModels))return null;const i=["const","placeholder","noop","pad","squeeze","add","sub","mul","div"],s=["biasadd","fusedbatchnormv3","matmul","switch","shape","merge","split","broadcastto"],o=[],l=[],u=t.modelUrl,d=t.executor;if(null==(a=null==d?void 0:d.graph)?void 0:a.nodes)for(const e of Object.values(d.graph.nodes)){const t=e.op.toLowerCase();o.includes(t)||o.push(t)}else!d&&e.config.debug&&BG("model not loaded",n);for(const t of o)i.includes(t)||s.includes(t)||e.env.kernels.includes(t)||e.env.kernels.includes(t.replace("_",""))||e.env.kernels.includes(t.replace("native",""))||e.env.kernels.includes(t.replace("v2",""))||l.push(t);return e.config.debug&&l.length>0&&BG("model validation failed:",n,l),l.length>0?{name:n,missing:l,ops:o,url:u}:null}var P0,D0,M0,O0,$0,F0=class{constructor(e){s(this,"instance"),s(this,"models",{}),this.models={},this.instance=e}stats(){let e=0,t=0,n=0;for(const r of Object.values(wX))e+=r.sizeFromManifest,t+=r.sizeLoadedWeights,n+=r.sizeDesired;const r=n>0?t/n:0;return{numLoadedModels:Object.values(wX).length,numDefinedModels:Object.keys(this.models).length,percentageLoaded:r,totalSizeFromManifest:e,totalSizeWeights:t,totalSizeLoading:n,modelStats:Object.values(wX)}}reset(){for(const e of Object.keys(this.models))this.models[e]=null}async load(e){var t,n,r,a,i,s,o,l,u,d,c,h,p,m,f,g,y,b,x,A,v,w,k,S,T,_,I;mq.initial&&this.reset(),e&&(this.instance=e);const C={};C.blazeface=this.instance.config.face.enabled&&!this.models.blazeface?async function(e){var t;return mq.initial&&(AZ=null),AZ?e.debug&&BG("cached model:",AZ.modelUrl):AZ=await kX(null==(t=e.face.detector)?void 0:t.modelPath),SZ=AZ.executor&&AZ.inputs[0].shape?AZ.inputs[0].shape[2]:256,TZ=au(SZ,"int32"),kZ=Rc(function(e){const t=192===e?{strides:[4],anchors:[1]}:{strides:[e/16,e/8],anchors:[2,6]},n=[];for(let r=0;r<t.strides.length;r++){const a=t.strides[r],i=Math.floor((e+a-1)/a),s=Math.floor((e+a-1)/a),o=t.anchors[r];for(let e=0;e<i;e++){const t=a*(e+.5);for(let e=0;e<s;e++){const r=a*(e+.5);for(let e=0;e<o;e++)n.push([r,t])}}}return n}(SZ)),AZ}(this.instance.config):null,C.antispoof=this.instance.config.face.enabled&&(null==(t=this.instance.config.face.antispoof)?void 0:t.enabled)&&!this.models.antispoof?async function(e){var t;return mq.initial&&(iY=null),iY?e.debug&&BG("cached model:",iY.modelUrl):iY=await kX(null==(t=e.face.antispoof)?void 0:t.modelPath),iY}(this.instance.config):null,C.liveness=this.instance.config.face.enabled&&(null==(n=this.instance.config.face.liveness)?void 0:n.enabled)&&!this.models.liveness?async function(e){var t;return mq.initial&&(uY=null),uY?e.debug&&BG("cached model:",uY.modelUrl):uY=await kX(null==(t=e.face.liveness)?void 0:t.modelPath),uY}(this.instance.config):null,C.faceres=this.instance.config.face.enabled&&(null==(r=this.instance.config.face.description)?void 0:r.enabled)&&!this.models.faceres?async function(e){var t;return mq.initial&&(UZ=null),UZ?e.debug&&BG("cached model:",UZ.modelUrl):UZ=await kX(null==(t=e.face.description)?void 0:t.modelPath),UZ}(this.instance.config):null,C.emotion=this.instance.config.face.enabled&&(null==(a=this.instance.config.face.emotion)?void 0:a.enabled)&&!this.models.emotion?async function(e){var t,n,r;return mq.initial&&(BZ=null),BZ?e.debug&&BG("cached model:",BZ.modelUrl):(BZ=await kX(null==(t=e.face.emotion)?void 0:t.modelPath),JZ=3===(null==(r=null==(n=null==BZ?void 0:BZ.inputs)?void 0:n[0].shape)?void 0:r[3]),qZ=JZ?["angry","disgust","fear","happy","neutral","sad","surprise"]:["angry","disgust","fear","happy","sad","surprise","neutral"]),BZ}(this.instance.config):null,C.iris=this.instance.config.face.enabled&&(null==(i=this.instance.config.face.iris)?void 0:i.enabled)&&!(null==(s=this.instance.config.face.attention)?void 0:s.enabled)&&!this.models.iris?async function(e){var t,n;return mq.initial&&(vZ=null),vZ?e.debug&&BG("cached model:",vZ.modelUrl):vZ=await kX(null==(t=e.face.iris)?void 0:t.modelPath),-1===(_Z=(null==vZ?void 0:vZ.executor)&&(null==(n=vZ.inputs)?void 0:n[0].shape)?vZ.inputs[0].shape[2]:0)&&(_Z=64),vZ}(this.instance.config):null,C.facemesh=this.instance.config.face.enabled&&(null==(o=this.instance.config.face.mesh)?void 0:o.enabled)&&!this.models.facemesh?async function(e){var t,n,r,a,i,s;return mq.initial&&(VZ=null),(null==(t=e.face.attention)?void 0:t.enabled)&&(null==VZ?void 0:VZ.signature)&&Object.keys((null==(n=null==VZ?void 0:VZ.signature)?void 0:n.outputs)||{}).length<6&&(VZ=null),VZ?e.debug&&BG("cached model:",VZ.modelUrl):VZ=(null==(r=e.face.attention)?void 0:r.enabled)?await kX(e.face.attention.modelPath):await kX(null==(a=e.face.mesh)?void 0:a.modelPath),jZ=VZ.executor&&(null==(i=null==VZ?void 0:VZ.inputs)?void 0:i[0].shape)?null==(s=null==VZ?void 0:VZ.inputs)?void 0:s[0].shape[2]:256,VZ}(this.instance.config):null,C.gear=this.instance.config.face.enabled&&(null==(l=this.instance.config.face.gear)?void 0:l.enabled)&&!this.models.gear?async function(e){var t;return mq.initial&&(fY=null),fY?e.debug&&BG("cached model:",fY.modelUrl):fY=await kX(null==(t=e.face.gear)?void 0:t.modelPath),fY}(this.instance.config):null,C.ssrnetage=this.instance.config.face.enabled&&(null==(u=this.instance.config.face.ssrnet)?void 0:u.enabled)&&!this.models.ssrnetage?async function(e){return mq.initial&&(vY=null),vY?e.debug&&BG("cached model:",vY.modelUrl):vY=await kX(e.face.ssrnet.modelPathAge),vY}(this.instance.config):null,C.ssrnetgender=this.instance.config.face.enabled&&(null==(d=this.instance.config.face.ssrnet)?void 0:d.enabled)&&!this.models.ssrnetgender?async function(e){var t;return mq.initial&&(EY=null),EY?e.debug&&BG("cached model:",EY.modelUrl):EY=await kX(null==(t=e.face.ssrnet)?void 0:t.modelPathGender),EY}(this.instance.config):null,C.mobilefacenet=this.instance.config.face.enabled&&(null==(c=this.instance.config.face.mobilefacenet)?void 0:c.enabled)&&!this.models.mobilefacenet?async function(e){var t;return mq.initial&&(OY=null),OY?e.debug&&BG("cached model:",OY.modelUrl):OY=await kX(null==(t=e.face.mobilefacenet)?void 0:t.modelPath),OY}(this.instance.config):null,C.insightface=this.instance.config.face.enabled&&(null==(h=this.instance.config.face.insightface)?void 0:h.enabled)&&!this.models.insightface?async function(e){return mq.initial&&(WY=null),WY?e.debug&&BG("cached model:",WY.modelUrl):WY=await kX(e.face.insightface.modelPath),WY}(this.instance.config):null,C.blazepose=this.instance.config.body.enabled&&!this.models.blazepose&&(null==(p=this.instance.config.body.modelPath)?void 0:p.includes("blazepose"))?async function(e){if(mq.initial&&(_K=null),_K)e.debug&&BG("cached model:",_K.modelUrl);else{const t=(null==(_K=await kX(e.body.modelPath))?void 0:_K.executor)?Object.values(_K.modelSignature.inputs):void 0;RK=Array.isArray(t)?parseInt(t[0].tensorShape.dim[1].size):0}return _K}(this.instance.config):null,C.blazeposedetect=this.instance.config.body.enabled&&!this.models.blazeposedetect&&this.instance.config.body.detector&&this.instance.config.body.detector.modelPath?async function(e){if(mq.initial&&(AK=null),!AK&&e.body.detector&&e.body.detector.modelPath){const t=(null==(AK=await kX(e.body.detector.modelPath))?void 0:AK.executor)?Object.values(AK.modelSignature.inputs):void 0;SK=Array.isArray(t)?parseInt(t[0].tensorShape.dim[1].size):0}else e.debug&&AK&&BG("cached model:",AK.modelUrl);return function(){const e=[];let t=0;for(;t<5;){let n=0,r=t;for(;r<TK.length&&TK[r]===TK[t];)n+=2,r++;const a=TK[t],i=Math.ceil(SK/a),s=Math.ceil(SK/a);for(let t=0;t<i;++t)for(let r=0;r<s;++r)for(let a=0;a<n;++a)e.push({x:(r+.5)/s,y:(t+.5)/i});t=r}vK={x:Nc(e.map((e=>e.x))),y:Nc(e.map((e=>e.y)))}}(),AK}(this.instance.config):null,C.efficientpose=this.instance.config.body.enabled&&!this.models.efficientpose&&(null==(m=this.instance.config.body.modelPath)?void 0:m.includes("efficientpose"))?async function(e){return mq.initial&&(KK=null),KK?e.debug&&BG("cached model:",KK.modelUrl):KK=await kX(e.body.modelPath),KK}(this.instance.config):null,C.movenet=this.instance.config.body.enabled&&!this.models.movenet&&(null==(f=this.instance.config.body.modelPath)?void 0:f.includes("movenet"))?async function(e){var t;return mq.initial&&(FQ=null),FQ?e.debug&&BG("cached model:",FQ.modelUrl):(EX(["size"],e),FQ=await kX(e.body.modelPath)),(jQ=(null==FQ?void 0:FQ.executor)&&(null==(t=null==FQ?void 0:FQ.inputs)?void 0:t[0].shape)?FQ.inputs[0].shape[2]:0)<64&&(jQ=256),Ue().flagRegistry.WEBGL_USE_SHAPES_UNIFORMS&&Ue().set("WEBGL_USE_SHAPES_UNIFORMS",!1),FQ}(this.instance.config):null,C.posenet=this.instance.config.body.enabled&&!this.models.posenet&&(null==(g=this.instance.config.body.modelPath)?void 0:g.includes("posenet"))?async function(e){return!i0||mq.initial?i0=await kX(e.body.modelPath):e.debug&&BG("cached model:",i0.modelUrl),i0}(this.instance.config):null,C.handtrack=this.instance.config.hand.enabled&&!this.models.handtrack&&(null==(b=null==(y=this.instance.config.hand.detector)?void 0:y.modelPath)?void 0:b.includes("handtrack"))?async function(e){var t;if(mq.initial&&(dQ[0]=null),dQ[0])e.debug&&BG("cached model:",dQ[0].modelUrl);else{EX(["tensorlistreserve","enter","tensorlistfromtensor","merge","loopcond","switch","exit","tensorliststack","nextiteration","tensorlistsetitem","tensorlistgetitem","reciprocal","shape","split","where"],e),dQ[0]=await kX(null==(t=e.hand.detector)?void 0:t.modelPath);const n=dQ[0].executor?Object.values(dQ[0].modelSignature.inputs):void 0;hQ[0][0]=Array.isArray(n)?parseInt(n[0].tensorShape.dim[1].size):0,hQ[0][1]=Array.isArray(n)?parseInt(n[0].tensorShape.dim[2].size):0}return dQ[0]}(this.instance.config):null,C.handskeleton=this.instance.config.hand.enabled&&this.instance.config.hand.landmarks&&!this.models.handskeleton&&(null==(A=null==(x=this.instance.config.hand.detector)?void 0:x.modelPath)?void 0:A.includes("handtrack"))?async function(e){var t;if(mq.initial&&(dQ[1]=null),dQ[1])e.debug&&BG("cached model:",dQ[1].modelUrl);else{dQ[1]=await kX(null==(t=e.hand.skeleton)?void 0:t.modelPath);const n=dQ[1].executor?Object.values(dQ[1].modelSignature.inputs):void 0;hQ[1][0]=Array.isArray(n)?parseInt(n[0].tensorShape.dim[1].size):0,hQ[1][1]=Array.isArray(n)?parseInt(n[0].tensorShape.dim[2].size):0}return dQ[1]}(this.instance.config):null,this.instance.config.hand.enabled&&!this.models.handdetect&&(null==(w=null==(v=this.instance.config.hand.detector)?void 0:v.modelPath)?void 0:w.includes("handdetect"))&&(C.handdetect=async function(e){var t;return mq.initial&&(nQ=null),nQ?e.debug&&BG("cached model:",nQ.modelUrl):nQ=await kX(null==(t=e.hand.detector)?void 0:t.modelPath),nQ}(this.instance.config),C.handskeleton=async function(e){var t;return mq.initial&&(rQ=null),rQ?e.debug&&BG("cached model:",rQ.modelUrl):rQ=await kX(null==(t=e.hand.skeleton)?void 0:t.modelPath),rQ}(this.instance.config)),C.centernet=this.instance.config.object.enabled&&!this.models.centernet&&(null==(k=this.instance.config.object.modelPath)?void 0:k.includes("centernet"))?async function(e){if(mq.initial&&(UK=null),UK)e.debug&&BG("cached model:",UK.modelUrl);else{const t=(null==(UK=await kX(e.object.modelPath))?void 0:UK.executor)?Object.values(UK.modelSignature.inputs):void 0;VK=Array.isArray(t)?parseInt(t[0].tensorShape.dim[2].size):0}return UK}(this.instance.config):null,C.nanodet=this.instance.config.object.enabled&&!this.models.nanodet&&(null==(S=this.instance.config.object.modelPath)?void 0:S.includes("nanodet"))?async function(e){if(!VQ||mq.initial){const t=(null==(VQ=await kX(e.object.modelPath))?void 0:VQ.executor)?Object.values(VQ.modelSignature.inputs):void 0;YQ=Array.isArray(t)?parseInt(t[0].tensorShape.dim[2].size):416}else e.debug&&BG("cached model:",VQ.modelUrl);return VQ}(this.instance.config):null,C.selfie=this.instance.config.segmentation.enabled&&!this.models.selfie&&(null==(T=this.instance.config.segmentation.modelPath)?void 0:T.includes("selfie"))?N0(this.instance.config):null,C.meet=this.instance.config.segmentation.enabled&&!this.models.meet&&(null==(_=this.instance.config.segmentation.modelPath)?void 0:_.includes("meet"))?RQ(this.instance.config):null,C.rvm=this.instance.config.segmentation.enabled&&!this.models.rvm&&(null==(I=this.instance.config.segmentation.modelPath)?void 0:I.includes("rvm"))?_0(this.instance.config):null;for(const[e,t]of Object.entries(C))(null==t?void 0:t.then)&&t.then((t=>this.models[e]=t));await Promise.all(Object.values(C))}list(){const e=Object.keys(this.models).map((e=>{var t;return{name:e,loaded:null!==this.models[e],size:0,url:this.models[e]?null==(t=this.models[e])?void 0:t.modelUrl:null}}));for(const t of e){const e=Object.keys(wX).find((e=>e.startsWith(t.name)));e&&(t.size=wX[e].sizeLoadedWeights,t.url=wX[e].url)}return e}loaded(){return this.list().filter((e=>e.loaded)).map((e=>e.name))}validate(){const e=[];for(const t of Object.keys(this.models)){const n=this.models[t];if(!n)continue;const r=R0(this.instance,n,t);r&&e.push(r)}return e}},L0="\n/9j/4AAQSkZJRgABAQEAYABgAAD/4QBoRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUA\nAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAARAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQu\nbmV0IDQuMi4xMwAA/9sAQwAGBAUGBQQGBgUGBwcGCAoQCgoJCQoUDg8MEBcUGBgXFBYWGh0lHxob\nIxwWFiAsICMmJykqKRkfLTAtKDAlKCko/9sAQwEHBwcKCAoTCgoTKBoWGigoKCgoKCgoKCgoKCgo\nKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgo/8AAEQgBAAEAAwEhAAIRAQMRAf/E\nAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAE\nEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZH\nSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1\ntre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEB\nAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXET\nIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFla\nY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXG\nx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A+qaKACigApGOKAML\nXp8xlF5A7V4X8RtYs7PzfNImnx8sa8Kp9z3q2tEgp6angWs62ZZ5CTGoJ6DArGNz5p+UrID6EUrF\nPUlW1EuN0XNW7PQ2L5j3JnoKXN0KijqNP0eYoqXBdgPuuo+ZPeupisWn2Jd4+0r924XgsQOCff3/\nAJ1FzRKxDqGii6m3siiQ8F1XGfXI6YNWLfRbiRQMkcZI9fpTDluT2/h6Qy8gDPbtmtG38JeY480Z\n5zSLUTZg8M28YwYxjAArXtdPt402qgHbpSaLWhma3o0Uqk7Nx9DWLaaVblgPs6qRyds2M/gRSQp9\nzZOni2iWS2hlQ+kjYz9OMGrdjq89vIPPVhj+8M/lQyDq9P1WOYBlMZz1AOD+VdDaTiReOKulK0jO\ntHmi0WDTlr0TyxRVhT8tJjIX+9SUxHXUV553BRQAVBcPhSBTSuxPY86+IGti0s5I7dsORy9fM3i6\n8e8mfDO5P90ZrWWiJicNPpZZtxV/xrW0jQt4DOv6Vk2dEEdTY6BHuB25rpbPSo0QARjP0qTRI17W\nwA/hFaMWmoQMgflQXYsDS142rU9tpqqenfNA7GgtihxkdKuRW6qMY/GkDZY8sY4Ap4hXbyB+VArk\nEtuH4wPyrk/EGkOm+a3jw3suRQLc5i38SX9hJ9nnY+XnBUdPyNdFY6pa3KkkAE9l6f8AfJ/pSJT6\nGhDmI+Zb4ZRycdv6ium0nUhKFydrelTsNnS2829RnrVgV6NKXNG55lWPLIM81Op+WrZkRMfmNNzT\nA7GivPO4KKAEY4XNYWt3vkwPg4OK0giJdjw/xrqhm87Zs8tc7pX5A+leSajf6aHYJ50kn4AZpTep\nrBWRm2Vobm4BXfyehPFdnpmnBFUY5rI2SN63tlToK0YI+KZpFF+3QdavwoKTLtoW0Toaswpk5pCb\nLCxipAhoIuP2dKevHXoaYDylRyxhlwRQI4nxVoCXWZI1GfpXGtbSWjYPGP73+NIGupt6TqMsLruZ\nih4xnP5V09mQ+JLd8gn0xSYJnVaVdkook69K34zuUGunDS3Rx4qOzHVIp4rrOMY3NJQI7GivPO8K\nKAILt9kZrz3xlebYiu8KCCWb0XvW0NFch6ysfO3jLVjfXLIn+pQkKorl7WxNxIPl71g2dUUdpo+l\npBGvHPet23iC8ihFosrxirkHQUFo0IF4FXI1O726CpKLacCrMJoJLYHAPpTwucHpSRJJ5e4AZI9x\nUqpxzVpCuOC8cUpQUMRnXttuB4rjNdsYyeVwfXpmpGmcvcQyafMCFJjPY10eg34BUg4DcZP8jUO4\nHaRq3lLNF+IHet7R7jz7c56rwa2wz9+xhiVeFy/T1PFegeaNPWigDsc0ZrzzvDNIaAM7VpNqdegr\nxL4l6kywyRhseZ19lrdfAZL4jxYg3Fw20d63tJsdrDI5rm3Z3R0R0Mce1eKnQYAplIkWrMJ45oZS\nNO3PHbNXIyfpSGWowSOasxLUiZdjFSqtNEMkUemKlAGKsRJjAppFAiORMjmsTVrNZEO4cfSoZSOD\n1eJ7WXBUzQZ+7nkfSo7e2Ei+ZaMzxntjBX2NSU1Y6/wxqojiEFzkA8KTXYaUoWRyv3W5rSjpNHPX\n+BmpSg8V6J5gUUAdhRXnneFFAGHrTfu5PpXzj8S70/aZtxzztXFbv4DKHxHI+H4GZiz9zxXXW8G3\nGBXMjvLRXAx0oPGPSmMVeOnWrMTYpFI0bcg1fh54xmgovRcD3qxETSIZcRvzp+/BpEkqsBUqsM9K\nq4Em4Gkxk0yRGXrVW6i8yFhkg+tJjRxGsWrxllkUMh9eK5uMz6bcebbnfG33kPcVkay2OntPKuo0\nnhXI67c8qa7Lw3c+adjcEDGK1paSRhVV4s6A0or0jyRRQ1AHX0V553hRQBz+vNtt5z3xXzX8Qbdm\nuic5YnOMdK3l8JnTXvlbwpYl+WySOgrp5YfLOOB9O1c62O7qQkc+9RsKChFPWp4DluOlSykaNruH\nArUgHShFNF2NT1qxGO3NBmyxGcE1N2560CFzjrUysO9JAPDDjFOVuKoQuSRTWouBkazbCa3cd8cV\nwF7IISQccHBzUSWpV9C3o1x5b5GAjdQD1rs9DjC3kckbEhqKfxIzn8LOupRXqnkPccBSkUAzraK8\n87wooA5rxMSI3HqK8B8bQl9Q8sffY5b/AAraXwkUviNrw9pH2W1ViMMRTdRjw4HpWNtDti9TPc4P\nFQs2M5qdyyMHLcfjV63HTAoBGtap0wK0YxigpsuRDtVhVYd6GQydVwwIqdRnqKCR23I5pCMUW6gD\nYNKuetAEise9KTxQBWuFyhrznxNZkXjFeN3I+tTIZg2OqmzmxNF0PO3vXp/g2+hukVl4zyPanTXv\nJmVR+60dpThXpnlPceopWFAbnV0V553hSGgRynjC5FujOey14Ssp1HxNmTnc+a3kvcIpv37HoEYQ\nQmMdVHSsnVbYJF5jVk0dsNzlruVIsl2wKxbjWrVHILjg1CRbZJb+ILHPzyhfStODWLQgFJFYd+el\nUJM27HUIXxhga1Y5lLVLKLkMnoauxnPPrSEx7ShF+Y/n2qrc6xBbhizDAqkK1zJuvG9nbg8ZA681\nly/Ei052RO3uKAsZlx8QGd8xxvt9Aa1NH8dK7AXMcip64zigdkdrZX8F7EJLdwwNXMkrz1qRMRly\nCK4TxmpidWI49felPYSOMmi80NIoOV6qRzXYeA5SskYPfirpfEjGr8LPWVHyD6U4CvQPL3ZItOYc\nUDOoNFeed4Uhpks4H4iE/Z5MeleMeGULeLgjds10S+BGdL+Jc9OSBU2Huc5Nc74yvUtrcDBrJnZF\n63PJdXvLy/lKWw46bvQVz82jXhkLO5Y+9ZlsYthcRnbIjY9R3q3awTRkEM3WmJI6C0ea3dGRsr1x\nXY6TqW9FLHnjrUs0izpLK5DDjofSta3ckH09KRUkZuuTvFGdvPauE1Y3U6Mqbssf/rUxHPTaJPK2\nZmJPbBqzY6DCZh5xJC9s9aBJHU6dpemJjfEmfetJtI0+VPkUr/unFOxdiextHs33W07YHQHk11mk\nXb3KbZ1xIvcd6LEyWho4Nct41sTPYb16ipexCPPZN+wYGCvH1rrPAEJmvkPoc1VL4kZVvgZ6yFwK\ncBXoHkkqinFaVyzo80GuE7WJRQSziPiGdthK5HQV4x4J/wBI8WPIewNdEvgRNL42emO/yj1UHNef\neNpRczbC+I17DvWT2OqJxc0sMK4TCisy41q0hfEkqj8aixdwTXNOlwvmqD9anS9tXH7uVG+hosO4\n/wC0oOhrR0+6G4YNIEzsNEuCxAPNdjZruA4xxUmjINSjURksOlcbqFykbnjFA1sYGoassaknCqO5\nrl7rxhGm7yBnBxuJq0rkSlYpw+NLlsfd5P8AerVsvHEqSBHwPVgcgVpyMyVXU3rXxcHYETAk+hru\n/DWti6ZSTyOKzZqndHaxvvUGq2rQ+dYyqR24qWI8dvbr7LqDxyDAzXpvw6FvIxePGSM06Xxoyr/A\nzviKFHNegeX1J41zUhXioGbuaSuM6wpCaBHG/EcA6HN/exxXjXw2jL67cv8A3Qa6H8CFR+NnoWpO\nI4XI44rxLxrqjQzSEsQM1gdSPM9U1uR1YbmWIdXHf2rmpIb67YS28UrRlsLI3c/jW0VZGUpO5pW1\njfLNOjahawzwReYI5cjzMkDavHJ5/SrVv9uhtPtVxCPLBwzxnlT9KGghLU3tKvvPjHzbl7EGuisJ\nGRxWLOg7nRXJEbDjmvSNK+aFSfSoZr0KutRkphc4NcRrdkVjL9aVio7Hk3iqS8ubhrWzUlsZY9kG\ncZNc5D4aee5MclzJIFTzHAO0MfatqSOWu7bFS1srDUZEis0vIZoUxPvfcC+4/dx2xjr712XiTwXb\nWmlQ6hol3cRhoFd4rlg3zY5wR0GelavQwjq7GD4etdVvSnk2wAB+9v8A8mvcfA2kXiRo0/UdcDis\nZnTTulqeoWqbUAJqWUb42X1FZlnjfjSwlGrr5S/eNdD4RkvLAAQ4yRyaUZcruVKl7TQ9I0G+mnzH\nckFwM8VuIK7ac3KF2eXiKapz5UWYxipNtMyNejNch0jSar3cjR27uoyQCRVRWom9DxTx54gu5fMi\nlbKdMVjfCZPNlv5v9rFbVHpYqjGzbOn8SzFI9o715L4u0r7arYzk+lYdTqSujy7U/C0u4vHk+WwO\nxuh9q3J9dgvbdVukMV1EwbDDgn04rZMwlHoZ+orZ6hfQ3RWVnQYCgZAq+8U0ln5NtBsV2yxYcfgK\nJtW0CnB31LlroVwJ1nQLGDjeP7w+lb0dsFxjrWB0tHS6NuWPJ6A16ToUm63T3Gallr4S7cxiTjrX\nPaxaF7dlVeSMUhxZ5jd+H7qCa4eF3DSE5x3zXN3Wk6jbyeaiFWUY6ZyPStYS5SalPmVipFbX0E4c\nW0alvmPHJrag0rVvEE6LdljGpG2NRtQD+tW5XMI0uU9M8NeFo9PiQhecDIIrtrOMIoG3H4VlJm9t\nC6CB06VPGM1IHLeItGS6uw+ORT7e3jsbQvj7gzUNam0JaWE+HN7NqOqX80n3FO1RXo8YzXdS+BHk\n4z+KyzGPapcU2YIv7qQtiuaxvcaWqG4O6FwfSrS1JbPnrxoxkv7qIfejcitj4V2f2exumI+8+aKn\nxHTT+G5d8Txlm4rjLxMsQwzWT3OiK0Mm6sEkVsAcjFc1d+FEmlGwEDPQVopaEuOpr6f4ZWNAu3tW\nvHpAj5ZQcUFIWaDjGMVUMQ3cVDBmvbhY7QAV2nh+T/R1yeKhlrY31+b61FcQK6nIoJMi401WblRi\nqr6PCw5UYq9y+YgOgWzNkRrx3xWjp+nx2v3FQcelAbmko9anQ4GBUNisPHWr1qMrQhS2K11HvmYV\nhamcxSRZ5xRIqluS/DKAQQXZxyXrvo2FdlL4EeZjH+/ZbjNSZpswLNBrE1Gt7VE4ODVIlnh/j61F\nj4lmeTGyUbq6LwdEqWbeX0YbhSqfEddP4Bddj4JIrhL5d8h7VjI6oLQqKNzelWre3yc4/ClFjaL6\nwqBxxUUxwCKu5BmXRA6c+9ZjP83FSBoQuPs4BrsNBlUW659KmRrDY6G1lyQtW3Hy0lqQ1qVJnAbm\noy3b9KYJCqRj3o4zRctIlhjLHmpSuOBRbQOpLGpPFaES7UqkZzKN1KsEc87/AHUUmvPLTVGv72aQ\nk7WJwKmRrQ3ud74Ltilgz4++2a6iNDXdS0gjyMU71my7GpqTbxSbMki3SViajTTHqkSeR/GeyZmg\nnQHkEE1S+F+oPPavBL96I4/Cia1udVF+4dVrkW+Fq8+v4tjMDWUkdVJ6WM0cNV+F+MVmjUcZgqnP\n1qpNNnkcVRLiZtxIS1UzzIF7mghlxUZpVQdq6nTVdAoAOKzkbQWhvwM6gMM1twOJYx3NOJE11Kt1\nH1/pVVlwBkk+9NocXoOQ45FPj+fkUJFF2NSB700v/hTEty5ZpkjvVyUgcCq6GM9zC14/8Se6GcZQ\n1574Xs5WkI2HBPHFQ1dm1KSSZ7Rotn9l0+KPHIHNacae1dy0Vjxaj5ptlhVp+2s2CJ9ppCKzuWNx\nzSFc1SYrHNeNdIGpaYw25ZeRXmvheyk0jVpEdcLJ0q3ZxNKTa0O3vQHg/DNcHrsJDmsmjspnNzNt\nfFIJ24GazOhC+azDmgZIOOKBsp3J2qSaZodubq58yQ4QAnmhGT3NO18pb7BORmu205LfYpyKVkWp\nOxr5gKYWoIZWgfGfloFq1qTPLubnGO1RPtxg4P0oBAkY/hBz6VNDDkZ6AU0W2WSdqkdKr9ZOaGSj\nVtcLHmnOcgmmYvcz7mBLy3MbdD1q9ouiRK6bUAVeelOC1InPlidSsWMDFOCEdq3uefykqrinYqGy\nrFvApMVka2DAowKAsMkRXQqwyDXn/iWyitNQ3qPl6itIvRoF8RXinW4tQ6HI6GuW8SIVBPalc6qe\n5x9x97r3qruwTjrWZ0ksZ9TUmcDNAmZ9/wAoao63rR0+w22MLPtAzt6mghmfofiB76LdJBJBIp5D\nd/oa7bSdWLIPnpDi9TM8TeKdas51XTbIyxd3J/pXS+E/EFxqNoFu7do5OmD60maHWrnZyDRkn/69\nMlEyOR0xntVoNx+FUgYjPxg4FLCuWDZyKQr2RoRnP0qO+nEFpJITgAUzLqZnhu6+0rknOTXpOmwJ\nFbrt5yMmnHYyr6Oxb2ijaKLnPYMClwKQWK3n0hn+lachHOJ9pNNN0apQFzsY10a4v4hXQh0xpieQ\nMA1XLZNjhK80cT8OdV+3Wl3A7ZZJCw+hrR1qLcjZ/CsbnfHRnFXseHJArOYYbrUs1uPhYbuatqFP\nByfSkMq3UIINYkto+87Tx6GkSxfsDbflGD7CtTw/pk4nzITtPIFMFudsukh4Rxz71paTpKwP5jcn\n0qTRy0NORMDgVCqewoJTJgAoxjntTiTu7fWmFxAcnn1q3EPl+X8KZMi4gKqB1Peob/Tv7Us5bfeU\nyOoq4R5nYxqT5I8xieH9J1DTbvyJELRg8ODwa9Ms5mSFV9BWiptbnNVrKdmif7Q1KLg96XIZc5Is\npNL5pqeUrmMtZs0jzV08phchaY00zH1p2ZNxjS1g+LdJOt6U9ssmxjyGp2urDjLlaZzng/wUPDqz\nTSTmWeTrjpVjVk3Rvjr2rnqQ5dDvo1XUd2cTqSNk9OKxXGCeKxZ1DAxHTr2q5C/y8GokUhsz54qu\nuCxzSQjQ0+FZblR2ro4bZYiMVQ0dBb7Qi5x0qzuG5QOh71LYErDufpSeWrHnimIXbjkUjLkH1Hem\ngGxryc+tXI19KYmWegq9YLiLJ7mtqS945cS7QsWehqxA9dEjz4krPSxyZqbFFhGxUm6smjRM55Lk\nHvSvNxXTY57kLT+9MNwKdhXGm5FIbkU7Bca1wMEVhaiuQcVhXWiZ14R6tHGanGBI2OtYkqEHjgVy\ns9ErEeo6UBsHipKEZs5qpPdRxcbhx70NCSuybTNWihc5brW9Fq6vjMnFSdEIdDRi8RRKygZbHFbu\nm6nb3RA3gMegNJhOm0jbXGOoxTuCc1Rz3FyoGKawz9KaAVcZqeMgCmIkB4FaUTbYwB6V00Fuzixb\n0SFMuDU8Mlbs4UPeXHeiOXkUrDuXYnyKk3cVk0ap6HMxxketSMhrcwRC0dMMZFMQ3yzSeVQAeUaz\n9Vj8uPd271nVV4m+GdpnHX67pCeKyLtBtNcR6xlk9RVeWTb3qRnO6trgttyIfm71z7ai8j7/AJmN\nDNqUVa5Yi1AnjynHuBV+11YJhWWXcP8AZNSzqgmaEerSsf3NtIQP4mGKtRavdRgMIpVI9KjU0a7n\nR6T43uYQI7qN2Tpkqciu503VVuQGAYZHQjFVc4alPlZrpKGAznpTwxOc9+lWjIlUACnM4XApiLNk\nnmvnsK0NvpXZRVonmYqV52GsmanhXitTmFkSiJTSAvwrxUxXIrJ7miOfjf1pzNWxkRlqYWpgJupu\n6gQbuahvIxPA6eo4pNXVioS5WmefakGhndH4INZs5DJXA10PaTurmLO21uKpSZqGMoXGnRzBiyjd\n9Kx5rcQS428fSkjanLoaOliHGZFB56VswW+mtPufcBsGOAfmxz+tFkd8HpoaUx09FAtFY8DO71qb\nSms/Nb7RbecG6AEjFLS5c78t+p0djpVs9wsyQiJAdyr1rW+zqjErzSe559Sbk9S3C+MA1bjbgE1S\nMSXzMVG0vNUI2tPKrAuCMnrVzNd0PhR49W/O2xrHmp4TxVMzQshpIzzQBehqesnuaI5VGzT2bitz\nFEbNTC1ADS1JupgG6l3UAc14s04yR/aYRll+8BXCtLncDXFWjys9TCz5oW7GddH5qqNzWDOgQnC8\nVSuo1kHzAGkPYopEY2+RWxV23Vzj5G/Kg3jWaNazhZuqNXS6TaKhB2c0jR1nJWOlhOxRxU4YkCgx\nY0OQatQyDbyaaFYe8uF4NY3iC9ltbVGj43NTIL3h7WzMihjzXVQXYYDdW9Cf2WcOJpfaRZ3g9KsQ\nmupnCLIabGeaAL0LcVY3cVmzRHIxtUhetzEjZqjLUAIWpN1ArhupwagAfDKQ3Q1594v0c2bm6tx+\n5Y8j+6ayrR5onThp8s7dzkZjuqAAmuBnqC7c0iwgtzSA0rWzjfGRW3ZadDu4AoNYo2rfS4v7orSh\n05UA2r0pDbsTm29KRottBNyJ0wpJ9KhD7f6U0ikNWffIFBz60zVUW52ow4UcUN6EPcx44WsbgOmd\nua7TT5Bd24KHnFKnLlZFSN4koluLdueRWvp14swweG9DXoxldHlTjYtzGoo25qzEvwtUxas2jRPQ\n5CNqkLVsYoYzUzdQA3dSFqBBmnqaBhuqhriCXTpVIzxUz+Fl03aSPI9QTypW2/dz0qKNw3SvOPZR\nMqin8VLKRcs3O4Cuk0w/MDjt1NBtHY6O2IIHY1pxgFaETIRwMkjtVSUEk4570MlFW5bap6dKzWm8\n1tqH8aY+hp2FvGoGayNevVt7/ap4xzUvYjqTLtvLPcvJxSaVcyWsxTnFZlnT2t15xHmCtOBYwQy4\nB9q7cPO+jPPxFO2qLEj5HWo42+aus4HpoX4W4FTF+KlotbHII9SFuK0MUNZqiLUDE3UbqBBupwag\nBc1DefPbyD/ZND2KjujyPWlKzuPesRZjHJXms9lMuw3StjnmphKDSLTJ7OfE3JrpbO4GQc9qlnRA\n3LO82k5NbFvdADkjBoCSHyXIIIzgVQvdRigT7wzjgUzO1jHknlvG7qnp61etYFQDIpCZoqVijzXn\n3iC8EmsOuaCGb/heR/s0ijkVv6fbxy3QMg5xmsnuX0Ldzut3+UYTPWk+2GJSe+M1pFtamcldalmx\n1eO4XaThhWnC+TXqR2PHqL3maUJ4qRjxSEjj42qXdxVmaGs1MJoATfSbqBAG5p6mgAzTJTmNvpQU\ntzzHXY83D/U1zF5FhjgV5r3Pa6FMsV5HWnLe7RhqBRdmTwagN2d2K2rPU1C5LAnPrUs6Iysbdrq6\nf3gK0BrUKj/WClY05iM6xLOcQAj3NT29uznfKSzHuadzNu7NSBFjHNSm5VO9IRnajqoWMhTzXFtA\nbvUfMduSeg702Qz0rS7FbTToQFwzjJqaGTFyfK5PQViyzUuFmuIdgGABya5u/vTaN5cnUHFUmLoZ\nzyskwlgJweSK6zQdUEwVJeGr0aUrxPLxEfe0OrhPAqVjxWhznGRtUwatDK4jNxURbmkAm6jNABup\n6tQAFqhupNtu59qUnZFwV5JHnWsHdIx96w5lz15rzT2uhRmt85xWbcxMnUGmZlB0bdxmrNvFIcfM\n350mWjbs7YkDJY/jW5ZWW4jikWkdNp9mqYJFaJdEHHakUULu/VB1rLn1Ld/FgetMGYd/qWSQmSa0\n/AemS32pfa7piLeLkg9z6UmQtz0W7uQ2cZx0A9BVzR7cAea6j2rPqX0L99KRat5A6Dk1wOoKZ52a\nYfMORTYRLujiGWEq6/NWza2yKQVHNdOHerRy4laJo6TTnbbtb8KuM3Fdh5z3OJjbmpt3FaMxAtUZ\nagBN1GaQBzTwaAAms3VbjERUGsa07RsdeFpuUuY4jUjljWTKK4j02RE4IpJYFk6imQkVl0xWarsO\nmAEcUi0bNnZBR0rWtoguMCkUi21wI161mXuocEKaYXMS4u+pY/hVCSWSY4HT0pEmlouiSahdpEBl\nmOceleiwWcNjClvHgJH97Hc1EmVFFi3Czy7mwIl/WtJbjP7uLgd/apQ2VNVvtsBhiPzdK5S4nAuR\nnqOCaTGi9pcytPlU+XpmumtWII44rah8ZjiNIXRuWeNvvViQ/LXpJWPJbu7nCRvVkNxVsxBmqJmo\nEPiXca0YLMuOlJsuKuPlsSi5IrNuG8s4HWs5VEkbwoOTKsk+FJY4rC1K53k1xTk5O7PSpwVNWRzt\n4cms+WpKICtSLTETQj5q0YeBSGiys23pUguGxQMq3E59ayrm4x3yaAKiRtO2WPHcmhruKFxFajzZ\nScA44qRHoXhuMaLpxaUg6hcDLMf4F9KlhuDeXGASIl+8azZslYma68y48m1+7nFW5rtbRNhb5z1p\niMKbUg0zuW4A4rPgb7VdKXOMmpA7HRbMS7nUYiUda0lkQOBngVrS+JGdbWLRt2bAx5BqeQ/LXpnj\nPQ4GJ+ashuK0MhWaoWcA0AaOmASMK7jRNPWYBmHyiuepO2x10qfcv6vYxCzYqoGK4HVYVTJrmb5l\nc6oaM5TUJ8EgGsG4kLNUHT0M64OaqMMikSRsuKbnFMRLG3zVehOaGNE445NNlnVFpDMu6uie9Vo1\n8z5mOAOST2pDK91cNN+5tsrH3PrW54a06KxT7fdrlh/q1Pc+tJ6IUdZGvHPLezMcnBOWbsPap5r3\nylFtbdT1xUWNWzU0/Zbwlgfmx8zGsHWtRHmMqE59aAMyNifvHPc1f0gtPdqkY5JosJHeNci2tktY\neuPnNY+oXWZEVJNrZ9aun8SIq/CzodHuriIokhDIR1ronbKZr0o6o8ipoz//2Q==",z0="\n/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAsICAoIBwsKCQoNDAsNERwSEQ8PESIZGhQcKSQrKigk\nJyctMkA3LTA9MCcnOEw5PUNFSElIKzZPVU5GVEBHSEX/2wBDAQwNDREPESESEiFFLicuRUVFRUVF\nRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUX/wAARCASwBLADASIA\nAhEBAxEB/8QAGwABAAIDAQEAAAAAAAAAAAAAAAEDAgQFBgf/xABDEAEAAgECBAMECQIDBgUFAQAA\nAQIDBBEFEiExE0FRBiJhcRQjMkJSgZGhsWLBJDNyFSVTY3OSNEPR4fAHFjWCokT/xAAYAQEAAwEA\nAAAAAAAAAAAAAAAAAQIDBP/EACARAQEBAQADAQEBAQEBAAAAAAABAhEDITFBEjJRIhP/2gAMAwEA\nAhEDEQA/APqYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAKNTq8OkxzfNkisQC8eb1XtRNbzXT4q7eU2nu0MntRq/D8StMccvW29ZmdvgjsTyvZjxOLj\n+s8WLxn8TFPXs6Oj9oct7c14rkxz22nrB2I49KOdTjelmszfmpMeUxv/AA28OqwZ4icWWtt/SUi4\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmdo3nsPNe0Pt\nFh09Z0+DNWL7+9O/7A3eJcZppsV5raI27esvH6jX5ddM25p79Ilo59VbUZOe2Tm/PeGvfPfT2iKR\nPLv1+DO678XmW/a97U6TtOyzTbTF538/T9WjTNecm9a7126tqk3rSYxY5ta1plRZqZNXGjyZcPXl\nmZmsx+qjBrsuO16xM7eXRt04JrdTltk5OWJnfaWf0a2lty5MdZnfzSn+WOHiOutFpjHa9e8bQ2fp\n+alYy462pk7zXbuxjPesbRS0f6ZZV1ET1tErzXFLHo+A+1ddZf6NrI8PJHa1vN6iJi0bxMTHwfOa\nzhzd61v1846utwniM6DUdb3nBaNrVmd9vjC/ZVePYirBqMWppz4rxaPgtEAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAItaK1m09ojcHnvarjM8P0vh49+a/eY8ng9D\nh1fGM1rxjtGPfvbzdbjuTJxHX48cTPNltM/KsS9Dw7S49Jp6UpHaGe2vjz1y9J7LYK13vHWe7bj2\nex1tvM80ekuxW3RnW3Vm6P5jRx8H0+OYmMcb+bapo8GKPdpC6bQwtdHU8JpWkdJ/JweL6e23iU67\nd4dubSqyVi9Zi0bwIs68XGp36TtEq7ZJmZmevzdbifCKWtbJinkt6eTgZPFw32t+sRurbWVzxs1y\nRv6T8V1NZNPtfq0seTm+Kevr+SZuxXjvaPiV8N4viycto9HseG6+uu08W6Rkj7UPmFck1tE1nlmP\nLd3eA8V8HVVi1pjq6Ma/pnqce/ERMTETHaUrKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAADW19+TQ5p/p2bLS4v04Zmt5VjeQeJ4bjnLqsupv+Ka1+ERLv4reTmcNxcuC\nvy3l0qdI2hlr66sT02ot0ZV7qqrInruzrVZLGSZ37JjqgYTG0K5lbaFVhDT1Ub456RPweY4hixWi\neSdpjvD1eWejz3FNHWYtkpvFo9EIseb3tS3SerOms22rfpPqZKzvvHSYUz70TExG6Gdbs2rljeJ/\nMx5L0vEzPaelnOi98c9J2bFNTFpit47+a+PVUvx9T9nOIfT+GV5p3yY/ds67wvsXqpxau+G09Lx+\nr3TqrEAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADV4ljnLw3U0jvO\nO0fs2lWqyUw6XLkyfYrWZkHldBEV09eveG3Fq1mI3jd4vPrOIaid8G9MP3Y38k6fNrt/rMk9Ou8s\ntfXXn49rGWInuy8SO/k5Gl1E3rG/fzbOe94wTy99mbRvTrMOOvNfJWsesywniukrG/jU6fF43WYN\nTmtEeJtEQ06aSmK2+bNtEd+qfSO17unF9Hmvy1y13XWyVmN4tExLxVK8PmNq5NrT58zawam+m/yc\n0Xj8NpRYSvQZ7xEOdqI3rPozxayNRXe0ct/ON03jmrKB5nV4q1yTO20Obmv4c+cx8HoeI6WZpNoj\nq83niYmYscU0r8aJ6T1n49zeJ+Meqm1drb9J+Kd5p136StGVem9l9TbHxLDFp7W7+sS+q1nesT6w\n+PcAzVjiGHftzQ+v4f8AJpv6On8jH9ZgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAABp8VrW/C9TW0ztOO3b5Nxp8VmI4bn37TWYB8f1HFtTfUfR9FWJmsdZ9I7MtJxDX5s\nd8ta1y0xzteaR2277rcuhycP12SceLxMeWNpjttHwlu8I0mfQ1y+D7k5YmJmY36T36Ka43z/AF1t\ncI1ds+qxVj7/AEej19PCw9HJ4NoK4OIU5Y35YmZdzVTGebVZabx5jJS+Tmns81rNLm1Wrzc9rVw4\nYibbem72mXTTS0w0M3BvEta1bWrM95ie5EanY87wXgNOL6XPfxraXLhra/W28bR/dzYzarBqJxRe\nbzE7Rt5vWU9n8mPHOGmS0Ypnea1naJb+k9ncNLR7u2y/WcxXO4TOoyUrN6zD0FaW5Y3hu49FiwUi\nKxCvLMR0hlW0jn6ukWw3iXjOJzbDlneOj3GaN6zDzfFOH+LE7SRGo83XNSZ2lbG2/WfdlvaT2cy6\nrNFInlrv1mfJ37cK4PwTTxOoidRm2+/2/KFuyMp47XB4LivXiunrH2b2iH2qn2K/J8x4fGDNxTSZ\n9Nh8OviRvTyfT6xtWI+DeXs9MNZubypASqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAOZx6/LoOWPvWiHTcf2hiZ0e8fc2mf1E5+vP/AEeuSd7RC2uKtI6QjHfeINTfwtPf\nJvty9WPfbt/lucP03gxfJf7d/wBoReYpm97zaNeLb4Ims9Nt94auDjem1Wo5PFi1onylS+1o7l8V\nbxvtupjDMdNkYtXS1+Stt+m63xImEJ4xjHER2ZxMUjeUTO3VRmydBbjLJqPi08mbeVOXJPq1sl5Q\nVbkz9+rRy35rxHqzmZlVEe/Ez5LRlW5iyfR6zffaIjq1OSNZps2a21rZInafSPJhxGMl9LStLRWM\nlorM/A4dkrWbYfLZC2W/7K6eubX6b4RzT+W76K8b7G6X62cu3Sten59nsm3j+OXz3/0ANGIAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0OIYfpOHPijvNNo+fdvtXJO18k/\n/OwPFYbz2ls3jx8VqW6xMdWPEdP9D4lkx/dt79flLLHbkxTPwY6nt2512ORTRzE2x4/dpE7cvkme\nE4IrW3hRMxO8THRtU1FKWtvtvK2upx22rzRCtXkqzh2jtF7ZbT122b01ndnpuWuP3Z3+Ky20qDVv\nfauzVy3mejZzNK8dVjqi87KLRLYtXruqvXzkQp7Qoid88R6rcl+WGlW0/Sa22mfhCZOq2x082ix6\njkm822pO8VrPdr4dNObVeDo8XW3uzMbzK+mvxT7szE27cvnu9j7PcNjSaXx8mOIzZevbrEeic5tN\n+SZnpt8J4fHD9HXHO3PPW0x/DeBtJxx29vaAJQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAKNRim9Z5e89Nl4DzXtVh5babURHrSf7f3ec1+qnDorWrvvt5Pccb0n0zhmWk\nRvevv1+cPE2rGTFNZU26PFfxwa5dVkjelI2772nZnX6bbrEUq3o0d678u8wmuDL2ittvVjXdneeK\ncGv4jpJ6U56+kS7+j118+GLXpakzHaWlp9NNY3tv+bbiYiNoQy1y30uyZJlrWmZnuym6q1iIJnop\nyW2Te8bdWnnypQqzZOadokiIpSZntWN5lrxki19vNRxrUeBwnNNd+fJEY6/OejXLn3Xe/wDp9wyn\nE8uo4lqqxblv7lJ26T6vpD5X7G8QycKzeBMbzMRM1/FH/wA/h9QwZ6ajDXLitvWzRgsAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeL45w+dDrZvWv1OWd4+E+j2jX\n12jx67TWw5Y6T2nzifU+rZ1y9eHwzDYxxEy18+DJodXfT5o96vafWPVbjyxDn1OOzHudbM0rt2UW\niI69mVtRXZq5tREb9VUoy2iIlRbJ0UX1VZ6btTLrI7V6yk62M2oisT1c7JmtkttVMUyZp6x0beDS\nRWOvdKijDimvWd3G9pNRMfRcNfvZOb9Hpb0itJeP47k/3hgjaZnbaP1XxWW3T0movbNS0W645nbf\n0nrMPpXs3xamoxdJiLbe/X1n8Uf3fKsOTw4jbaXo+EarJhtGTHMxeJ6xH7Sti9Zaj6x3HM4NxXFx\nDS1mtoi8dJrv2l011QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAGjxLhODieOIye7kr9m8d4eM4to9RwjPXFa0ZIvG9bR0fQXmPbDFvTTZPOJmEWS/V8bs9R43NxLL\nG8eFbePg1bajU5/s0l1ceKLx1hbjwRE9mOpx0y2uRTSZsm3PMw2aaKtIjo6kYo9EXpET0hVLXxYK\nxC6MZvyx1lFs0RHfaPiCnU12pLyHGNDbUajBekWma2npWN3p8+opa20e9LSyZLxExTlpM+vdOdcZ\na9tPS8MyUvFrzWlI6727u1pYxYrbVmb7x+TQx6au3Nqcl7/0rcmW9axGnwZJj1novmxnZXV0fFp4\nZxLBPgTGK8xzXr5fOH0bFlpmxVyY7Rato3iYfNuG2x56Wrqa8s2jz+7Lu8O12bS6jkwzN6THNNI6\ntvrN68Y4rxlx1vHa0bskAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAA4XtTTm0OKfTJ/aXdcL2pyRGjwU362yb7fkJz9eTxxyZJjyltRXzUZK7TFtl9Lbwy06YzrHwa+\nfJFd/wCVt8m0bQ0eS2qzcm+1K/an+zNZFL5M1pjFXeI72ky48eGnPkvNp27+TPU6nHpMfLXaIjpE\nerk5dRMxOfN1mPeisfshW1ne1a1577Y6x5R3U0zze31FOWI6ze0byU098kRlzbxM9qrMlPDpyRMR\nMd5Vt/Ihp5898mWZm1pjftE91uCt7fCI7dWeHDEW3t723l6rslqxWZnasR+SYhFbzhnfxJ2jyeq9\nlcGXWZcmW0zWKxHLaI7794eJx5fpfEKabT8t8l5isddo3l9S4VjrwrRUwzSJt3tav3pdOL6Y6dXD\nj8HFWm+/KsU4NRXPvtWazHquWVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAa+fXYNP9u8b+kdZBsDkZOO135cWOZn4y5Wu4xqctbe9y19Kp4njt6vi+PDm8DFMWybbzPlV\n5PiGtz67UxbNbeKTtWIjaIXYpnwuaftT5tXJT3vmi1pMsrU5qIrG1V1a+5DCa7b9GFbRr5J6Wnbt\nCu+Wmk0m8956z8ZWZNorbfzcbX5rZslazPux3hUt41NTntktObJ13+zX1bek01r4/HzVm0bxPXy/\n+bNfDgjVa2uOY92kdfg6ufJOKvLXtttVVSqbcta2vM7zXtHpLQy5ZtMd+vWd+7Zy3mdJHXra3f0c\nvUarw7zFY5rT2hH1Lavnrgx81p3U49Pk4nE5L35MO/StfNRXR5tXnrS8W67WvfyiPSPi7uLHFK1p\njrtSsbR5Lc4RzsXBaYreP4l45esRD2HD9fnw6evvWvO3Tfr0aGk0U55ra0TFInv6uzgrXFXlx0i0\n77RPlC83Yj+JW7oddqr6vHzTTw9/f6dod+L1t9m0T8pcbFSmPHER3892W0zPuz+jSbVvidkcqmfP\nSel7bekrI4n4dZnPWIrHeYnZee2Wpy8dEaml4npNZblw5qzb8M9JbYgAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAABEzFYmZnaI7yCXL1XGa0jJXT0571nbee27DiXEprp8nhbxG20W8\n5cbD0ikfnKO+urTPvjoZdXqctdsmTaPSvRpWmsdZ6yztfaGplvv3lWW1tyRlz1x0vkn7Vo5atTNe\nY0+1o79V2KsZsvX7Ne5mwxnyTNvsx2iGneM/rCdRSuOsTasTt5kRFtpjqmOH4t4nk7estiMNa97R\nHwhna0iuKTEdmGWa4672nZtRele1N59Zlq6vLOSsYorEc07qcW65euzRvtXvPZy52naZ7ujr6fXV\nrWdukREK8+njHgmZmPc67bq6ivVWhxxgxZLztNrT1mZ/SP4VZs0zaOvfp84WUtNsXLvtv3699+rU\nz7+Jtt5qURqMnPpctaR1rMSw4ZoK57eNk6xHaJRh97Ltt7lo5Z+L1HAPZvVauZ2nFTSzMTzeJEz8\nto6xPfvsZntPZ9rXxabmxzefdrv0j1dXh/BcmstW1qxTHHasR3+b0GPhGl+kWmd64dNEVjf73T7X\ny8vy+Ddx6O3iRakxTH5RXrMw1/lX+3Itw2MFIraN48qRHdZi0cUjmmPen9noox1iO0fNzdXEYrTt\nstcmd9aX0bJ+HePmiKTitO8TMLZ1cVjrMfqpz6ys4pjfrPRWZ9rXXptUit6zO+23VyaRHEc05L1/\nw9J9ys/en1ljqdVbwYw452tlnl3jyjzbmmiMeKtYjpEbLeTXPUU8ee/+qjJpsV5rbkrFqzE1tEbT\nDpYNbW21Mnu29fKWna0KbqTdjXXjld0cvQ63ltGHNPSfs2n+HUbS9c2s2UASqAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAOVxPWe99HpP8ArmP4b+r1EabT3yT3iOkesvMVtN7za07zad5l\nXV5GmM9vVfEstvDx0jtaVVMlq+UJ18b5cMRvPeSuK87bUt+i2Z3PtG7zXpjkzXt6R+TXyTMzvM7t\nydHqZ+zhv1+Cv/ZuqvPTHMfOYaTMil1a1K2vHSLTELq2v+KWzThGo84rH5rq8JzedqR+ZeI7WnOS\n34pYTafWXR/2Pln/AMyrKOCWnvmiPyR6O1y9585lhWJvl557Q6eo4T4dYiMvW3b3UanhldHpJtGX\ne09unmjsT7eb1l4trI2t0hsZfrdNO0bzy+nzU20/+NmkzO9esz+TZxWis9dttvPv+Tn21jjaW8zn\n26bTG3mp1M/Wzv3t0jyWXiKZJmsTERaZhXXDbNl8WaztWenxZLstPp5pau8frDtVrNMM5cfTfpMf\n3aunxxbes9d/R09Dp8ebJi09ptFr3jtt2WyrW9wy1Jx132mK+Xq9PotT0iIU19ntLtExa3T47T+q\n6nBaYvsZstZ+cT/LeMnUi0TXffo1s2m8Ws2/OIMWk5Jib5L328rS2t94Sh5TV4ppklpW6PT6rh+P\nNbebTHyas8E081mZy5P2W6OFhjxNTE/hr/LoRO0Kvo9dPqctKzMxEx1la5t3tdnjnMs4noievcrO\nyZjeFF1OSnNV0OG62cn1GWffj7Mz5w05joovzY7xes7TE7w0xrjPeex6Ua+j1UarBFu1o6Wj0lsN\n3JfQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACrU5o0+nvlt92P3BxuM6nxNRGCs+7Tv8\n2hToxm1r3m9utrTvMsonqyt7XTmcja0u3O6FMfi5t/u0/lzdJM81p9O3zdvHTwsUR5+bfPqOfX1h\ndqV+3O7bs1+T31oqmI3TEM4rvCdkDGIIhlFd2daboS0NXG2bD6bufxXU1vlmu/u4us/N0+L1tTSx\nkr9qk7w89j1FNZMV3jxLzvaJ8mer+LSOZqK2xZotbvljfr/89U453rXt9lse081xZtNjx7TGKu0t\nDHlrevSevaN5Y6+tJ8c7VRNMt63n3ub+6/R54rERMztDYy4a5omclYmfxKcenrjtHLvtPrCnVmdb\neFe3JXmjy6eS/DrMuLVYsta9Mdt++6qLxO+0dEc8UmInr18iUfReHcXrqccb9Z27Q61Lb13eJ9nc\n1Z35rTvE9avY4bTkpG8xEfB05vYxqybc07R281naGMREdoT5JQqy9mply7Q3bV3iXG1eXw7TWSka\nc258t7+tpT5/BjT7MfHqndz12Z+M4lMMKyziUJJiN1WSu9fku23RaOgKNJqbaTU1t9yelo+D0cTE\nxEx1iXmM1Nt3W4PqvFweDaffx9vjDbGvxz+TP66QDRiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAOJxzU73rp6z296zsZMkYsdr2naKxvLyObNOfNfJbvad1dXkaeOdpvsc2yuZVzfbfqybutwu\ns5s8R92J3dvJb3tnO4HSMegtmt3nfZvYp8SZl0z45NfSK7onH1bNcfRFqnUKJr0Y7dVtq7prjEsK\n0XVpEM6028mW20IHK41aPo3J6zs4ODhdcvPnvExFevNXpMOrxi/PlrTee7PLX6Pwa09uaNlKtHg9\ndM3z5d7ReOu02nu0JzZMfblrv5R5uvrcdImZ26T1mYhxs1Os7RH93PZ7axuafNfLitvbaYU3yZYt\nPXs9NwHhui1HBa5LVicsb81onrEuVqNNSuS8Y67dZ6xPZa59Il9uX41vEitImZme3q2Kxbxora0T\nMd/ROSa4Ztkj7c9OafL5LuGYubmyX3iu/TfbdSfVnpvZLT/XZK233+Mbbva1xRXyiPk8pwbH4N6T\nadq5a71n0tD1WDL4tPe6Xr0tDpz8YVnJHWEXYxbqlBedoef4tW0XraO09HdyztSZcbUz43C+ee9b\nSVMaeOfqq7+jGckQ1Yz7+7v2RN/WXPXZPjci2+2yyJaVMuy+uSJlA2d+pNoVRbeDcSxyTE+TDDlt\npdRXLTynrHrDOyiyZeVFnY9TjvXJjres71tG8MnJ4Nqt4tp7T1jrV1nRL1x2cvABKAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAHJ49qfD09cNZ97JPX5PPw2uI6j6Vrsl/ux7tfk1mWr7dOM8iLdm\nvfebREefRsWldw7SxqNbWbR7lPesrn3Vteo7dYjDpMGCvfbeXQ0uLlxRLRxROfUc34p6fCHYrXlr\nEejqrjY8uzCYW7MZjdVKqK9VlaxCYrsnYExBMRMJRPZA8/xPHtmpP9W2xx76vhWOInvt/C7ike7N\nvwzE9kcapGfhlevTaFbFo8RqJ5vy8/RoW09ek0msxHfp3dzNoLzp4zUmZpMbT8HJyYJi20X2n0lh\nZY1li/RaidBF4w2mK3jrHaFGp1lN+tptPp5IjBkid5mIp16TKu0abBPv33vPlM7z+iPdFNcWXU5I\ntkrNce/b1W5db1nTaf3ax9q0fxDW1ebNk2phty1mOu09VOm8W19orEz23j1TwfSeERFuEYMddptW\nd43dvBn21eKJ75KbW+cf/JcTgMxXTb3nbljz+TpcPmc2uyZO1KRtVtGVdi0bx07qJnllsRO6rNTe\nN4XVamsy8mnvPwc3R2jPwe8TPbdlxXNOPSZfhWWpwO85OFzv57qrODkzeHntSe8Sn6Rv0a3EZ218\n8nXekfr1a0ZLVnqx19dWb6demXybOO7lYMvNMdW9S/VVLo0us7tPHdtUtEwJiZU3jq2Jhham8CVG\nPNODNTJXvWd3qcWSubFXJWd4tG8PK3pPd1OB6veLaa89Y61/u2xfxh5c/rsgNHOAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAANLimq+i6O0xPv392rdeZ4rq/pOqnlnelOkIt5F8Z7Wj27I2I6sb25YY\nV1ImY3dbQ08LRc23vZp2j5OJG+XJWle9p2h6HHtbJXFT7OOIpX+7TxT31j5rycdTh+Dpz+XaG/sw\nw18PHWseULN2trBE9UcrJKBhFU7JAQi0dEomegNDUYovM7x3jb5tO1ZvpbaTLtzRExWfWPJ08kbT\nEx5NXWYYyV5omYtHWJieyeDzuizfRs19Jn6TM7Ru1uMcJxZqTkw+5f4ebqa7SV1MR4tdrx2vEfy1\naxqsNOTLjnLXytVXi3Xj8+nmsxTLM16d5npPyUzpekTtSK+U7vS6vQ/SYmK1vWPS1HOn2dvvvvE/\ntDO5XlcO+LbfHSd/W3o6/BdDOXPTnj3Kz38rS6Wm4FNrRyRzTH3p6RH/AKvR8L4dXSzE3jmtHn5I\nmbfqLV+m4dbLSsZInHjr3iI6zLpYaxS01rHuxHRHiT9mv6s67Vj1aqL6326MrWiYa+/Q54BxPaGe\nXRZpj8MquB4+Xg8zPnB7SX30to379GxpK1xcHiKz5IS8xr8PLPixH2bftLTy05o6dHYyVjLhy0t1\nizjZa3pMVv3iO/qz1G2L+NbSajbNyW7xLsY8kTDz+fJXFqKZN4iZnafi6WHL0iYlStI7OO+7axW2\ncrFl7dW9jvE9ULN+J3ZbdFGOy+AYWpEqN7afNXLj+1Wd23KrJVMvCzseh0+auow1yU7WhY4fCdV4\nOadPefcvPuz6S7jol649Tl4AJVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAV581NPhtkvO0R+4NPi2\nr8DB4dJ9+/7Q83Po2NTqLanNbLfvPaPSFDHV66sZ5ET0hRknyW2lTtMyouz0c8usx2n7s7vScKwx\nzc1vu/y85p+maJh6Th+SOWeveXR4/wDLm8v+nX5mUWa9bbrInolmu5jdTNkxYFk2Isr3TuCzeGMz\n+THdEyDDJO9Ja823rt2XWnya946pGvktDXta0ztWu/ybvLE9dkcoOf4GbJPWK1j49VmLh9JtE33v\nMevb9G7WsW8l1ccREISophiJ2jpDYpijbaOjOuOJ8ujOdqxsgVcsUjaETYvbaFFrgu5lVsm0yUtu\nryg43H5m+GIj1XcJzePoL4pnrWGtxmfchr8JvfHS1622if3QljzTTLes+qrNjrkiYtCzPMxnm095\nYZJ6boS5teB49Tqscza97VtvWvlv8V/FOF34RrIxTM2xXjelp/eHoeA6XnzReY3ivX/0dfivDcfE\n9HbDbaLx1pb0lOs+jO7K8Lis3cN+0NKcd9PmthzV5clJ2mF9J9GHHVL108dm1SznYr/Ft0tuhLb8\nmNohFbMhLWy0mJ3rPXvDvcO1karBG8/WV6Wj+7kWrvDDBlvpdRGSnbzj1hpjX4z8mOx6UYYstc2O\nuSk71tG7Ns5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZ2jeXneJ62dVl5KT9VTt8Z9W9xbWclPo+O\nfft9qfSHEU1pv48ftYST23ZTDC/p0YtlVuvVjMbM5+LCZjYGWGdrTPxiHY4ffaf3cjTxz1v6xMS6\nOlty2iXVj/Dk8n+ndrkhnGRo1v8AFdW3RCrZ5uiYsqrboncSu508yjmZRYQt50TfowYTbYGVrKrT\nuTZjvukQnYhMIGVY2ZxPVWyrHVCWzXpVXkt3TE7Va+W4K7X3jv1auTNy3jdba0RZpamfroQN7Hk3\n6wr1GTaN2OOJiu6Mu98NvgDi8Wy74d/yZ8PiPAiO2zU4nb6qIn1bugjfFE/ASp1ke9u15mbbRDZ1\nMb823kx0Ontn1OOkedoJCvT8I03gaKsz9q/WW+isRWsVjtHRKyrhe0XCfpWL6Vgr9fjjrEfeh5fF\nfeH0V5Dj3DPoOo+k4a/U5J6xH3ZZ7z3228evytOk7NvFbo0cdols47bSybt7HbddHVqUs2aW3Qnq\nxVeu8LILR3SlZw3V/R8nhXn6u0/pLuPMXjeHT4Zruf6jLPvR9mZ8/g1xrvpz+TH7HUAaMAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAABRq9VXSYJyW79qx6yvmdo3l5viGs+maqYrO+OnSvx+KLeLZz2te1rZL2v\ned7WneZYWnZl5K72YV1xEyxmeqJljzIEWlVkszvbZp5soN3h2SJz3pP3odCnuWmPRxuERfJrZmtZ\nmtY96fR28kbX3dXj/wAuTyf6bmK+9YX1s0cNtm3Sd4LFY2K23W1s16StiUJW7bp22RW3RluBuruz\nmWEgrmCGWyNkoExKE1QlPmsqRDKeyBjaejWy2W3ttDUyz1QKslvehVqKTNosyyTvELabXptIJpaP\nB39Ia2mz+JGpr51jdZefDx2hzuHZObNq58poJaGtjxJ2+LoaKP8ADRPo5+T3skx5OhpOmC0fBNQ0\n5yTbn+bt8A0u9raiY6RHLVwY62mI6zMvaaHBGn0mPHt1iN5+aYVsACBXqMFNTgviyxvW0bSsAeE1\nmkvw7V2w5Ote9besJx2er4rw2nEdNNekZa9aW9JeQjnxZLYskTW9Z2mJY7zz26fHrrdpbZsY7NGt\nmxjvso1b9NmUwpx33XRO4K7VUTE1nmrvEx1bVo2VWiJE/XY4frY1WPlt0y17x6/FuPM0m+HJGTHO\n1qu9pNVXVYt46Xj7VfRtnXXL5MfzexsALsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHM4jxOMFJphmJv529Dq\nZLfjDjPEIx450+K3v2+1MeUOHSOWFc3nJkmZnf4yujpVlqunOeFpV2nctLCZUXRM7MJtsWlRkv3Q\nky5NmpWt9RnrixVm17TtEQnJabXisRMzPSIew9n+CRoccajURvqLx5/chfOest642OGcIpoOG2w7\nROW9d72+LQvXevyejcPUU5M+SvpLeOataraw2a0dLbLqTtK1G3Es4lVWWUSoldFtmcXUbpidgXzK\nGEW3TuCUSncnsDFMMLSms9EC6J6FpVzbZE5ALy0809ZbFr9GtfrEoFMzuuwz0Ueey3HbaBLDXe7i\ntMOfwWnP9I+NZbuttvhs1uBRtXPb4SDm3iIvf57N7Dbl0VrS5+XrltEd+Z1Jx7cNms9N4TURRw3T\n+PrcO3WszEvZOD7P6aYiMlvu16S7y1QAIAABxOPcLnUY/pWCv1tI96I+9DtgmXl68Biy7/NtUu3+\nO8HnFa2s0tfd75KR5fFyMWTdhrPHVnX9R0cd21S3Rzsdm1iuqs256wrmGcT0RYSx5d047X02SMmO\nesd49YRE9WcdSXhZ2O1p89NRji9J+cei1xMc3wXi+KZj1j1dTTaqmor06WjvWW+ddcu8XK8BZmAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAMMmWmKu952UZ9XFZmuP3revlDTtzWnmvO8q3XGmfHb9ZanV3yxtWeWn7y4es\nvPNtDqZJ6Ts5mppvdl/XXRMyfGvSNlu/RVvtOzLfoipLT1VTKbSpvfogRkvtDVyZOhkyvQcA4Dzz\nXV6yvTvTHMfvK+c9U3rkW+zvA/D21urr789cdZ8vi9KDb45rejl8Rry6iJ/FV1HP4vXbBTJEfYt1\n+UpiHM295bXsqrO9l8QkZ0lZEqqLeyBZHZLGvZkhIndADKJ3TMoqWQMZ6pjsxll2jsCLSrmU2lFY\n36gieyu0LJk3jbsga0wdqzK20QpyztQGprL/AFMrOE05NLkt6qdVWZxNrSe5o9vWBLiUjnzXn0vL\nq555dHt8HOwV928/1z/LpzXxbYccRvzTB+jucOwxh0dI22mY3ltIrHLWIjyjZKyoAAAAACJiJjaY\n3iXleM8InR5J1GniZw2n3oj7s/8Ao9Wi9a3rNbRE1mNpifNFnVs65XhcWTdt47bnFuF24dm8TFEz\np7T0/pn0a+HJux1OOrOux08d1ndqY7tillVkzExLOk7yd4YxGwluViJhE45raL0na0dtlWO0+bZr\n1TKi+2zptZGTamT3b/tLacvJjiY3XaTWdYxZZ6/dtPm1zrv1z78fPcbwC7EAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABhkyV\nxUm152iAZWtFazNp2iGhm1Vss8uP3aevnKrNntqLdelI7VRHRnrX/HRjx/tZREVjZXeybW6KbWZt\npCZ6S08tN7Nmbb7zCrJtyoS5145bSx5mWafelr3tsKmS/o08uXyhlly7RPV2+AcBnPNdZrK+53pS\nfP4ytnPVda4y4BwHxOXV6uvu96Unz+MvVxG0bQRG0bR2G0nHLb2gCUDX12LxtFmpHeazt82wT1gH\nmMN4tWs+rcr2aEV8DU5sM/cvO3yb+O0csLUTSdrLphRE8tlkZI7Atr2ZMazDJVKTYSCawi7Ksq7z\n1QERvLK3ZGPrKbyCrbdnMcsbeaa18/RhvvM7oGEwTG0JmYYTIML22a2e28xELM19oURPNO4lOem+\nn3ZY5+prVnMc2GYU4/L4A0a15cNf6rz/AC6fC6+NxCPOuOu/5tHJTbHj+F5/l1+BYumXJMd9o3/d\nMRXYASgAAAAAAABhlxUz4rY8lYtS0bTEvH8R4ffhmo6bzhtPu29Pg9mq1Gnx6rDbFmrzVsizq2df\nzXkMWTeIbNL7tbXaHLwzUctvexWn3bmPL8WFnHVL326VZ91MfFVjvvVlz79kLrcf2m7j7bNHH3bl\nJ2SirLQoy4t1++7G0dBC/RanxI8PJPv18/WG241+alovSdrV6w6mDNGfFF4/OPSW2b1zeTPL1aAs\nzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAVZ9RXBTe3WZ7R6iZOpzZq4ac1p+UermZMl89+a/byj0Ra9815ted59PQ32hlrXXRjH\nDpCLX6ML5NlNsm/ZRqstfdXzbsZt06sLZNvNB1Za8RDWyZdo7q8udq5Mu/mIMt4md2lmy7JzZuWJ\ndHgfBL8RvGo1MTXTxPSPx/8AstJ1XWpIs4BwSdbeNVqq/URPu0n73/s9hEREbRG0QUpWlYrWIisR\ntER5JbSccur2gCUAAAAPM8Sry8Uyz67fwuxbzVPGsE49XGbvF42V4M0TEL33ERnktsxpk3sumK2j\nadmFdPFZ33VS2Mdui2J3UU6LYlFSsN2O5NkCyJ6K7T1TEsbAsxdpReerKkTFGMxvYEz0rsqtbbpC\nb2VT1QEzuwtbaGUxspuJU3neWdKoiu8rq12gCI92YatLcublnzbEz1aOptyZqTuDHLfxN6R0+t5X\nqdJhjBp6UiPLeXl9NSMnEKxHa1+bb8nrlvxUAAAAAAAAAAABTqtNj1eC2LLXeto/R43VabJw/VTh\nydY+7b1h7ho8V4dXiGlmvbJXrS3xRZ1fGv5rzeHN02bEW3cys3xZJx5ImtqztMS3MeTeGFjqlb2O\n8btql3NpbZtYsnSBLeiWfdTjtutid+ghherHS5p0+f3vsX6T8Fkw181d4lMvEWdnHaGnw/UeNh5L\nT7+PpPxbjdyWcvAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAo1Oprgr63ntAmTqdRqK4K9etp7Q5d7Wy2m953lNrWyWm953mVd77R0\nZa1104xxlN9lV8qnJl2a9s3xUXX2ybsJyRDWtl3YWydEC+2VRkzeW6q+T4tbJm+KRdfK1cmWZnlr\nvNp7RC/R6HU8SycmCk7ed57Q9ZwvgOn4fEXtHi5/O9o7fJaZ6z1uRyOEezVstq6jiEbV71xevzer\nrWtKxWsRFY6REeSRrJxz22gCUAAAAAANbX6aNVpL0npMRvWfSXlKamsRMVvXm+EvZXjmpaPWHzfL\noNRjzXicfWJ8phfPxFejx72x7xMzK+sXiNoiXlq+Pi6fWV/VfTNqfLJl/WTg9Pji8R70LqvMV1Gq\nj/zcv6yz+lanzzZP1lWpelTET6S81Gp1P/Gyf90s412rjtnyfqql6asREdWM9+jz9eJ6yP8Az7uh\nodZqMt458tpB1JvEViI3/RhzRt13/R1MNaziiZiJn5K9ZNceKZiIiQcu/WekT+iYrWI3lzdTrs+8\n8uW0fJzcur1Np/zsn6g79phVaIeetqNR/wAXJ/3SwnUaj/i5P+6UD0ldonum161h5mNRqP8Ai5P1\nlNtRqJjacuT9Qd22WN5aGeZyZd/KHJy59RHbLf8AVq31Gp/4uT9ZEvS8Lr/vSs2npzRtL1z53wK+\noza/HW2XJNd99pmX0Rb8VAAAAAAAAAAAAAAcHj/C5yV+l4I9+v24jzj1cLFk8nu5jeNpeW41wmdL\nknU6ev1Vp96sfdn/ANFdTrXG+eq1q5F2LLtbZoY8m8d11bbSydErsYsm+zZrO/zcnBm226uhiyRK\nEtrvCrJDOJTeu8A1MWX6Lqq5N/dnpb5O5ExMbx2cPNTeJb/DM/iYPDtPvY+nzhri/jDy5/W6AuwA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAa2p1UYo5adbz+xbxMlvqJ1OqjDHLXree0ejmzNrWm953tPmTPWbWneZ7yoy5YhjrXXTjH8s75N\nmtkyxt0VZM2/m175N1V03yTKubMLXVXybeYLLX2VXy7eam+b0bOg4VquJW+rry4/O9uyZOq3UjVm\n9r25axMzPaIdvhns1kzbZddM0p5Y47z8/R2+HcF03Doi1a8+Xzvbv+TotJnjDXkt+K8ODHp8cY8N\nIpSO0RCwF2YAAAAAAAAACvUZYw6fJkntWN3k8dfHz2vLucdz8mkjFE9bz1+UOZosX1UzPm0nqI/W\nMYo9FlcPNklfFGeH/NshLGun+Cz6PtHZtVZWlRLS+jxPkRpIn7rdoupHTdA5s6SI+7H6Mfo+32Y2\n+To3neSIiZ7A0IjPXpXLePlMotGW3272t85datKzHZjbTVnsDj+FG/2Y/RlGP4R+jo20u7H6N1Ql\no+H8I/REY957R+jpfReiK6eOYHLtj2tttH6KrY/6Y/R2c+kjeJiFVtLG24hxpw7/AHY/RRkw9O37\nO99Hrt1YX0tfOBLjcGp4XF8c+u8fs9c4dcVcGemSI61nd3IneN1orQAAAAAAAAAAAAABFqxes1tE\nTE9JiUgPKcX4RbRXnNgiZwWnrH4XPi28PdXpW9JraImsxtMS8pxXhF9DecuGJtgmf+1TWW2N/la1\nL7N7T5e3Vy6W3hsYcvLbqzbO9jvvCzvDR0+XeO7crO6FmGSvRThy/RtVXJ92elvk2rRvDUzU7pl4\nizsd2J3jeBpcNz+Lg5LT7+Pp+Xk3W7js5eAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADs0NTrN96Yp6edkW8Wzm6+LNTq4pvTHO9vOfRoWtt\n1mes95YWvs1s2fZldddOczLPLn2ju0MmebT3YZc2/mpm3qqllN1drsbZIhr3yzvtHf4AsvlYYseb\nV5Yx4KTe0+UQ6nDvZ3UazbJqd8OKeu33peq0eh0+hxcmnxxWPOfOfm0mP+steT/ji8N9mKY9suum\nL37+HHaPm9DSlaVitKxWsdohI0Y22gAgAAAAAAAAAABXnyRhw3yT92Nwef4xm8bVzET0rPJH5d12\nCvLhho3rN9RWs9Z23n5y6O21YhrVYbdGOCfrrLPJRpv863zVS6FS09SvZj3lVZZRdPSqmnSWdrIE\nebOkK4ldTsgW1WKqd1oMZhEVZyRAImOjGI6rJ7IiATNd46qL02bHkiaxaoNGY2n4ImPgtyV2n0Vo\nGvlx7x2beiyTk08RPevSVUxux00+Fn2n7N+n5rRFb4AAAAAAAAAAAAAAACLVres1tETWekxKQHlu\nL8InR2nPp43wz3j8P/s5dLveWrFqzW0bxPeJeV4xwmdFec+CJnDM9Y/CrY1xv8qvTZ+WYdbDk5oh\n5zHk283U0eo3jaZZ2N5XYjrCnLSJhOK+8d1kxvCqzSwZvousrb7k9LfJ3nB1OLeJdLhufx9LEWn3\n6e7LXN9Ofy5/W4AuxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAETaKxMzO0Qi9646Ta07RDmZ9VbPbaOlI7Qi3i+c3TPUaqcu9adKfy0722ZXvFa9\nXO1OrjrESxt66ZJmcjPUanlidmhkzTZVfLN5VWvsC2b7R3U3yqrZZtO1esz2h2+F+zWTUcuXXTNM\nfeKR3n5+iZLVbqRzNJo9TxHLyaekz62ntD1fDOA6fQbZL7Zc/wCKY6R8odLBgxabFGPDSKUjyiFj\nSZkYa3aALKAAAAAAAAAAAAAADQ4pl2pTFH3p3n5Q33E12Tn1eSfKscsLZ+orS00eJqbW+Lfnu1tF\nXaJnZsz3WpCfsyp00fWSvmPdVYOmSUDd8kR3InoQosy7JmUX7MdwZ17ro7KKT1XRPRAsrO0rYndr\n79V1ZBaQiJ6JgCSIJASwrO07MpV2nqBlrv1a1o2bf2qtfLXaQUTO0sb05o3jv3ZXhjS20xEphW5h\nyeJjjf7UdJWNKLziyRePsz0lux1SgAQAAAAAAAAAAAAAADG9K5KTS8Rato2mJZAPIcU4ZbQZuekT\nOC3afT4NXFkmlntc2GmoxWx5K71tG0vHa/RX0GpmlutJ61t6wrY2xr8dXS5uesN+tt4ef0eaa223\n2dnHk3juyreM81OaFGiy/RtZET9jJ7s/2bdutd2jqKeic3iNTsd8a2h1H0jTVtP2o6W+bZbOO+gA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABje9cdJt\nadohGTLXFTmvO0fy52bJfU23t0pHaqLeL5xdK9Rnvqb+cUjtCi94xxvK3JetKuHrdZvaa1ljb10y\ncnIs1Wt3naJc++TmVWvMz1YWybfMGdsm3eWek0mo4jm8PT0mfW3lDf4V7P5tdMZdRviwfvZ6/TaX\nDpMMYsFIpWPTzXmf+steT8jn8L4Dp+HxF77Zc/4pjpHydYGjC3oAAAAAAAAAAAAAAAAADG9opS1p\n7RG7zszN6WtPe0zLua+3Joss/wBOzhzG2OsL5+IrY09dsSyYRijbHEMvOChb7KjF0yS2LQ169Mso\nS24noyrPVXWejNVKbTuw3T3REdQWU6LYlVvsyiUDPfqupPRr79VuOQX1lZEqoZxIMksd0gT2VT0l\nbPZVbuCaW8i8bwr32WxbcGnkjaZa9p2ndv5qbw5+aNugLItF6TEtvTX5sMb969HMpfazc0d9stqe\nvVZDdAQAAAAAAAAAAAAAAAADV1+iprtPOO/2u9bektoB4TJTJpNRbHkja1Z6uto8viVht+0HDvpG\nH6Tjj6zHHvbecONw7Ltfkmeqmo6Ma69DXbbZTkr1mGWO3RneOaGbZRoM30fVzSelMnT83aef1FZ7\nx3h1tBqfpGnjmn369LNc3sc3kzy9bQCzIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAa+q1dNNXr7157VhGp1Xh70x+9f9ocy283m1p5rz3mVbrjXHjt91lz\n5c9+fJ1nyjyhdM8lZlOOIiqrUXikd+kMreunnI5XEdX4dZiZcG+XmtNl/F83PeeWWHDOGanieSKY\nq+5H2rz2hMzWd1Iqx1yajJXHhrNrW6REeb1nCPZumn2z62Ivl7xTyr/6uhwzhGn4Zj2xxzZJ+1kn\nvLoNJnjHW7TbbsAszAAAAAAAAAAAAAAAAAAAAaPFrbaSK/itEOXt0rDf4xb/ACa/GZacRvaF58Q2\nIjasQnzPIhCU92tMbZGzHmotG10C6nZkwpPRmipIllEbMIZIE7solgmJBnCyk9VMM6z1BtVllEqK\nz0WRILYlluriWcSDJVbusV27gwInaSWM9ECyZ3hqamnSWxFmOSOaqRx725bNnSZNs9J+OynVY+WZ\nYYr7TE+nVaIr0Ais81Yn1hKAAAAAAAAAAAAAAAAAABExvG09peU4nov9n66L0j6q/WPg9Y1OJaON\nZpL0+9HWs/EWzeVz9PbmrEtnyc3h9reHy26TWdnSr2YX6657ijLXpLX0+onSamL/AHJ6W+Tbv2aW\nekTv16JzeI1Ox6KJiYiY7Slz+E6jxdN4dp3vj6fl5Og2clnKACAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZ2jeQRMxEbzO0Q08uqtkma4ulfO3r8lefUePMxWf\ncjy9WvlzVxV6T1Z61/x0Y8f7Wc7Ur1lqVy+LqOWJ2hp6rXddon5rOF1tfmz5OkT0qzb8dWbxjp1c\nbiuuilJ5Z6r+IcQrixzEy8zl1E6rNt1tMztFY81sztU1eRucN4ffi2p5esRM72n0h7rS6XFo8FcO\nCkVpX082nwXh3+z9FWLxHi36328vg6TZyW9ABAAAAAAAAAAAAAAAAAAAAAADj8Unm1tK/hqppHvw\ny1k8/EMk+m0GOPeafiFpCZYwolnXspvHvLa9mF46gmnZmwozRUiUCBKYYsoBLOFbKAX0llEqqyzi\nQXRLOJVRLOOwLIljZMEgrlhKyYYTAK5nZPN0RZjugUanHzVlz6xtLq361c+9eXItPpXX0dubTU+E\nbL2lw2++O1fSW6m/VYAISAAAAAAAAAAAAAAAAAp1GbwcfTreelYEydcuMcRrM/L9nnlsV6wqpi2r\ntv133mfWVkRyRtEdGFva7MzkYZNoamWN4bV4mYa9qztKIujhVppxGI8r1mJegeZpknBqKZY+7L0t\nLRekWrO8TG8Ns/HJ5ZypAWZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAADS12fp4VJ6z9qVuq1HgUiI+3bpDl589cOKZmevqprXPTbx477rDJlrhr1nq4+s182tMRP\nRqaziXiZJrWekNG17ZbxWJ336M5LXRbI3dLTJrs07RMY6fan1dHLrowY+X7MVjt6N3R6Kul0EbWm\ns7bz8Z+LnabQX43r7Y53php/mXj+Dnv0f1JO1x/8ZxbUzj02O15mfLtD13AvZqnDds+pmMmo26el\nXX0Wh0/D8EYtNjilY7+s/NstpOOTW7QBKgAAAAAAAAAAAAAAAAAAAAAADG88tLW9I3BwJtz6nNf1\nvK/DHVqYJ3pzT5y3MPZeojOWMQylEKpTVjZnDCwkqzYQyRRICATCITAJZQxhMAshnEq4ZQC2srKq\nqrIBZCWNZZgwswmFloVyCu0dFcx1WyrtCBhv5NTPHXds2U5o3hIz4ffbPt+KHUcTSW5c9Jme0u2v\nVYAKpAAAAAAAAAAAAAAAAYZctcVOa35R6tLrltN795/YvknNqrfhpPLH92V5isd9mWq6fHjk6rn0\nZxG8KK5Jm/wbVZiYZtqrmkqL023bkxvCiY3lJHNyRG81mHS4Rn5sNsNp64+3yaWaNrzOzHBl+i6q\nmT7s9J+S+ay8mex6EIneN47SNXKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAImYiJme0JafEs3h6fkidrZOn5eaLeJk7eOdm1Hi2vmtPTry/CHmOJcUvmvOPF1n09Pm\n6HF9ZGm01qxO3R5vSY7XwzmzTy47zzTEd7en5Mfvt2/PURWdo3tvPrPlKymbktFqTtMTvHzbOLDG\nf63JXbFX7FdnoODcDprZpq9TjiMMTvSn4vj8l5fxnrk91saPSa7i2hpOfbTVt5x1m0fLydzR6PDo\ndPGHBXasd585n1lsRERG0dIF5OOe6tAEqgAAAAAAAAAAAAAAAAAAAAAAADX11+TRZrf0y2Gjxe22\ngtH4piP3TPpXKwxtjhuYo9xq442iIblI2pC1RET2ILd9kxCqRjZmwlCSEohIJAQAAJZISDKGUd2M\nMoBnVbVVCyAWVWeSuqyOwIlXZZKue4MJV2WWYT2QKbKL9YlfdRdIo35b7/Hd3KTzUrPrDh27uxpb\nc2mpPwX/ABX9XAKpAAAAAAAAAAAAAACekTIp1eTwtJmv+GkyJn1oafeazbfpMzLR4jq/o8b823zX\n6XNF8ERCvTcNpxLV5LauvPhx9Irv3lhztdtv8TtaWLicXrt03jzjzb2k1nid56ty3s/w+a7Uwzjn\n1raejlarhmbhl/FpbxMO/fzj5p/ixSeXOvTtRfeI280ZI26tfDm3pWe63LaZx7qtGvniJ6tPLvOK\nfOa9WzbJvTbza02jl3n5SSljscK1MajSxWZ96nSW88xw/VfQ9XMT9nfa3yemid43jtLeXsce88qQ\nEqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADia3UTm1l4j7OP3Y/u\n7Vp2rM+kPJW1PhYcmS0+9MzKm/jbwz31weMzbV8UppazPL9q0/BF4rk1GLDSNqxPWPhCnHmnNrtT\nqPKteWPm6U6OdHaZvO+SaRNvhv12Ub/q3FhtrNVj0uKOt56z6R5y9zix1w4qY6RtWsREOJ7L6OKa\nS2rvX6zNM7T6Vh3mmZyOfya7eACzIAAAAAAAAAAAAAAAAAAAAAAAAAAczjVvqMVfW/8AZ03I41bf\nLp6/OVs/UVrY47NyOzUxd4bUJpEbb3Z7IiOrKIVSjZhMLJYyhKIgmGUQSDESIEbJEgQmCITEAmGU\nIiGUAyhZVhDOoM4Wx2VQtqBKuyyWEgqlhKyyuyBVaGtkbNmvk7A15l1eH2300R6TMORPSXT4ZO+O\n8fFefEX63gEAAAAAAAAAAAAAAAq1WPxdLlp+Kkx+y1Fvsz8gjhaDauGK8sx07y3OE3m1tT6RaP4c\nvU6yMNKUx73zT0ilY3l2eF6a+m0kRl/zbzz3+Ez5M8z26fJruW6wzYq5sV8d43raNpZjRzPPaTmx\n5b6bJ9rHO3zb2WJ8GWPEscY9bgzxH2t62n19GWW0eHOzHU5XbjXZ1x8WTnz2iZ7S2M1IjH2+LX0V\nKTqs8zO9ot0j8nUthi1J3UaOFMTfLFo6xMbS9BwHWTqdHOO8+/hnln5eTjYMFo1WTH5VnePzXcIm\n2k4zlpPSmXy/hfF5eMfJns69OA2cgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAADG/2LfJ874rW845mubliY7bPoto5qzHrDz0+yePNF41OotaJ7RWNtpV1OtfHqZ715fhu\nj8adNpcVfeyzE2/vLuanhOu1nEctIxTTFa/+ZPbZ3eHcF0vDbTfFE2yzG03t32+DokynXl9+leDB\nTTYKYccbUpWIhYCzEAAAAAAAAAAAAAAAAAAAAAAAAAAAAcXjE/4zDH9M/wAu04XF5/3jj/0f3Wz9\nRUYmzDWxS2I7FSyjuzY1ZKpRKEygEwiWUIkGIk2QJNhKQhMIhkCYZQxhlAMoZwwZwgWQshVCyATL\nCWc9ldpBhZXLOVdpQK7NfJPRdaWvknoDVvPvOnwuel4+TlXn3nS4VPvXj4QtEV0wAAAAAAAAAAAA\nAAAAAVV02CmTxK4qRf8AFFeq0AAAanEsfPpZmO9Ji0NDLfkwdOsulrumiyzHlVzJrz4Ovoy26vB8\ncTBa9NffLtMY77Rv8Yegx5ImkKdJoY1HC81Y+3OSbVn0mGGkmbY45u6tnrrTOu2xGO0RxCd+nNVj\nqKxTV1vH2pjaGtnyzXXYdo96ZmGXEMk15b7/AGZiVerWPTYckZcNbx5wzc7hGbnxXxzPWk7x8pdF\n0S9jh1OXgAlUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAcPjEf4/FP9H93ccXjMf4vDP9Mx+62fqKrx+S+GvibEFSsqyYwlVK\nZYsmIMoRKYJQIPIEiQ2ATCUQygCGUIhMAyhnDCGUIFkLIV1ZxIMpVWWSrsCuyqyyyq09ECq8tfJK\n66jJ2Bp5J6upwn7dv9Lk5J951uE/av8AJaIrqAAAAAAAAAAAAAAAAAAAAAAq1Mc2myxPnWf4cmtu\nXT9fR0tffk0WSe28bfq5Wbamm3326MtunwfK6PCv/AxPraZ/dz9PO97/AOqf5dHhdZrw7Dv3mOb9\nXOxRFM+avpe38mvkPHf/AFWlrKba7Tzt99ZxKkfR7euyNXMTrtPHfa0z+zPiM/UR8Zj+Wbdu8HpN\nM2bfzrV13M4dO2pyR61dNvj44/J/oAWZgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADj8bj63BPzdhyeNx0wz8ZWz9RWri7Nmv\nVrYu0NmqaRZHZlDGGSiwxZSgCEkCBCQSCQBMJRCYgEsoYx3Z17AlMIhlCBnDOGEM4AlhZZKq4KrK\n7LLKrIFN2vdfZReAaObu6/CO9vk5OePR1uEd7fJeIrqAIAAAAAAAAAAAAAAAAAAAAGtxCk5NFliI\n3mI32+XVyNTyZOHTee946PQKPoeDffw4777eW/yVs60xv+ZxOnr4Okx1t05KRv8Ao41Z5q3yed5m\nXY1szXRZ5jvFJ/hxItP0aOSN9q7yrtr4f2tHFM5+KT16Yq/vK/iGSbXw4vO14UcPx5MGfNbPG18m\n1oj4THRsTw7VanPXVYpi3gzMcnrvCnG11JOupwuN8+a3pEQ6jT4divjxWnJExa09pbjbM5HHu90A\nJUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAHM41H1GOf6nTc/jEf4Ws+lls/UX45uGekNujTwdm5RNIthKIZKLDFlsiQIShIC\nEgCUJ7AmGTGO7IDzZQhMSDJMMYZQgZwzhhDOATuqssmVdgVWVWWyqtCBTeVF19lF+wNLNG7q8I+9\n8nLyupwnt+S8RXUAQAAAAAAAAAAAAAAAAAAAAAAItWL1mto3iY2lyrcLyUxzix2ia2nvPeK+jrCL\nOrTVnxpanhuPPemSs8l6RtE7dJj0ldpNP9GwRSZ3neZmV4cR/Vs4AJQAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANHi1d9H\nM+kt5ra+vPoskfDdOfqK4mn7Q3aNHBPZu0W0RdDOGFWcKLCJZeTGQQlCQSgASBsCYZQxhlAJTAmA\nTsmAgGcM4YQyjsgRLC3VnaVcgwsrt3Z2V2QK7tbJ1bN5a9waeWO7p8Knt8nNyebpcK8vkvlFdQBA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAK9RXmwZI+ErEWjesx6wQeZwejeo0cccuW8\nelpblJaaRGxVnCuss4ZrMvJEgCAASISCQIBlCYYpieoM0wx8k7gzIRueYM4Z79FcSy3QEsLJmWFp\nBjaVVpZWlXMoGNmvkXXlr3kGtknu6XCf7OXkl1OEdl8orqgIAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAHmskcmtzV/rls0U62OXiWX4zErcc9GmkRfWVkSqqziWayxCPIANwBIhIJSxS\nCRG6dwZwlhEs4BluMdzfqgZxLLdXuy3AmVdpZTKuZBjaVVpWWV2QlhZRdfZRcGpl7urwfrzfJy8r\nrcH61vPyWitdMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHA4nHLxKZ9awnH2ZcY\njbW459aq8fZpfiI2IZwrqzhmsz3Ebm4JN0AMhCQSIASndiAziWUSriWcAyRujc80DM3RCfIETLCW\nUsZEsJYSslXZAwlTddPZTkBp5e7r8Gj6rJPxhx8k9Xa4PG2C8/FaK10QAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAcfjcbZMFvnDWx9m5x2PqcNvS+zSxT7sNPxH62YZQwqzhRZO6UCB\nKUAJTux3SDIRuAncQAmJZRLBMSgZ7iIAZRKd2DICUSlAljLCYWMLIFVukNfI2bNbIDTyT7zu8Ijb\nSz/qcG/2nf4T/wCE/wD2WnxWt4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHL9oL\n+Hw2cm28VvEuPptfgyVj6yIn0no7/FtJfW8NzYMe3PaPd39d3iMug1WktNc2C9dvPbeP1aZ9xF+v\nT471tHu2iflK2HkqWmvaZj5Surqc9Ps5bx+alTHqYHm68S1Vf/NmfnC2vGNTXvyT84Ql6A3cSvHM\nsfaxVn5Ssrxyv3sM/lKB1xza8bwT3pePyWV4tpZ+/MfOEjfGrXiGlt2zV/PotrqcN/s5aT/+wLRj\nFontMSlAlKEgndO6IAZQljDIEgeQljLCzOVdkCu/SGrkbF56NPNeKxMzMRHxENe0+89DwuNtHHzl\n5PJr8NcnLW3Pbf7r1nCZm2gpae8zMrz4i/W6AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAETETG0xukB4HVaeMHEtRi26RedvkyjBSfX9W77QYvC4xz7dMlYlrU7M929dWJLFc6aPK0q\n7YLxPS0S22FlP6q38Zac0yR92s/KVc3tHfFf8tpbcsLRvB/dR/8ALLVnU0r9uL1+dZI1mnmdvGpv\n6TOy6ym+Oto2tWJ+cJ/tW+KLK5KW+zes/KU7tG+h01p64qx8Y6NXNo6Y+uPJlp8rLf0rfG7MXtHa\n0x8pZxqs9e2a8f8A7Oj7HaTHn0+f6RWM23LETfr6vRW4PoL99NT8ui7F4+vEdXXtnt+fVbXjGsr/\nAOZE/OsPS29nuH27YrV+VpeV9pdPXhOtw49NG9Mld55+vXcTPd42I47qo7xSfyWV9oM8d8VJ/VxM\nd8l46xWF9cV7en6o/qLfxp2I9ob+eCv/AHMo9op89P8A/wBORGmyT5R+qfo2X8P7n9Q/jTsx7RR5\n6ef+4/8AuHftg/8A6cWcOSO9J/WEbWr3pY7Efzp2Lcfv5YK/9zWy8d1E/ZpSv5Oba1/+Hb9lc+LP\nbFt87I7E/wAabWbiurvEx4nL/pjZzc2bJkn372t85ZXx55/BX85lucC0vPxnTxlnnjm32mOiZqUu\nLJ2p4TwnVavNWaYbRTfre0bQ99pcH0bT0xb78vmtiIiNojaErMwAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAHnfarF7umzRHaZrLjYrdIen9ocPi8JyTt1xzF4eUw23rCm3R4r6bMy\nwt6kdTaWLdjswmNoZontsCm0K5XWjopnuDC0dGpqG5bs08/daKV672MjbSaif6oh6Z5f2LtvptRX\n0tEvUN3Jfo8f7cYve0eX4zV7B5z20xc/C8eSPuZIRficfXlcPaG7ino08HWIbePpLF2NuiyOyrHK\n3fZFSwuovHVfaVF4QK5YWTM9UT0EKry6Ps1Tn4zjn8NZn9nOtLseydObiWW34cf918fWfk+PYANn\nKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAq1WKM+ly4p+/WYeBxTNd6zG0xO0\nvobw3FcP0bi2em20Tbmj5Srr418V9sa2Z7qKyzi07MXUylhaU7yjqhLCeiq3ddaFNxFYW7NLNG8t\nzya+WO6Va9J7FW66mvwidnrXiPY3Ny8RyUn71Jj9Ht3RPjk19HK9pMHj8D1ER3rHN+jqqtTjjNps\nuOe16zAifXzfTz7kNyndpYazS9qT0mszDdoxrsi6m8LazMq6zDOsq1ZEyrt1WWlXaUCqyq0rbKbi\nFdp6PReyFd8uqv8ACsfy83aXrPZHHto89/xX2/SP/dpj6y8vx6EBq5gAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAB5n2q03LfDqqx39y39npmlxbS/TOG5se29tuavzgWzeV4mtui2\nO3RRSY2hdVhqO2MvI36iu9lUsrSrvDHn6spnmSiq5jooyV6tq1VV69RC32byTh43h8otMx+r6I+Z\naK/g8TwX7bXh9Mid4iW+fjl8n1ICWb57xLBOm4zqse20Tbmj8+qKdnS9q8PhcTw5tumSm0/OHMxz\n0Za+uzx3sX1t0Zxurr1ZxvspWiZYWZbsbT0QK7KLrZVZJFaqt5vbezNOTg9J/FaZeJns93wCvLwb\nT/GJn92uGHldIBowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADuAPA67F9H4l\nqMW20VvO3yRWW97T4fC4rXJHSMtI/WGhVlue3b473K2KzMML4+62tujG9pnozXaOSOVFMnVbmq1t\ntrJRW5E7wwvUxTvCyY6CHOt7moxz6Wh9PxTzYaT61h8x1MbZK/OH0zTf+Fxf6I/htj45vL9WgLMn\nmvbPFvocGWO9L7fq85p5maw9d7VYvE4JkmPu2if3eW0+PasdFNOnxfF1Y2hlykRsmY+LJ0MZjZXa\neq2eyi8oQTO0KLdZWzPRjWu6VaqtHR73g0bcI0sf0Q8Nkq93wqNuFaWP+XDTDDytwBowAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAef9q8HNpcGaI60vtPyl56k9Iew49j8ThGe\nPwxFv0l4zH2U26fDfTYiyJljvsjf4sm6vJ1hrXjq2MkqLdZEVbgbMx0auGdmzNt6iHN1Ub5af6of\nTdPG2nxx6Vj+HzaaTm1+nx/iyVj930ysbViPRrj45vL9SAuyc7j1efguqj+jd4/T33rD3HEcPj8O\n1GP8WOY/Z4TTT7sKadHhbcsZnaCJ3TPZk6VdrKbTutmP0U2nqgrGOsr8deiuI2X09EqKM1dt3uuG\nf/jdN/06/wAPE546S9rwud+Gaaf+XH8NMMPK2wGjAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAABrcRp4nDtRWPPHP8PCYusPoWSvNjtX1iYfPuWaXtX8MzCuvjfw32siu8ptXoxi\n0wy5t4YulReqmazu2skbquURWFInddM7VYRGyL291KFnCcfj8e0le/Lbmn8n0N4b2Ur4nHLWmPsY\n5e5a5+OXyXugBZmiY3iY9Xz7NjnTa3Ph/BeYj5PoTxftFg8Hjk2iOmWkW/Psrr418V5WrWd2faFc\nV2jdnEMXWxntupmN7NiYU27iWML6dVMVnddjgVqMsdHr+CW5uE6f4Rt+7yuSsTDv+zWXn0WTHP3L\n/tK+GHl+O0A1c4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8Dn93W56/wDM\nt/L3z59qp24jn+OS38lnpr4r7ZxHQ2TEstt3PXUrt27K57rr1VT0BjKnJPRbMqMs7QlV2fYvHvrd\nVknyrEfu9m8f7FZI8fVU85iJewbT45NfQBKo817W4eulzxHaZrL0rje09ItwqbfhtBVs3leai8RD\nKLw1sduesL606dWFdsZT1jdhNeq6K9DlhCVUU6s4jZnt1YzAhnM71dH2bycmszY/K1d/0c6OzY4R\nfwuK4p8rTstn6z8k7HrwGzkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHz3\nVxvr80/8y38voTwGpj/F5/8AqT/JfjTx/WVeyY6FPspc9dZPVXaOq2WEwIUTVRmjo2rNfLHRI3vZ\nDJycXtX8dZh7t879nsnhcbwz23tt+r6I2nxyb+gCVBzuPY/E4PqI9K7ui19fTxNBnp60n+Aj5/pJ\n3jZu1aOnnltMNussdfXbm+l3ZM9URHREdZVXTuT1Nk7boQiOkJw28PU47/htEp5eivJPLMTCZ9Vv\nx7mJ3iJ9UqNHk8XR4b+tIXuhxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD\nweqjbWZ4/wCZP8vePCaz/wDIaiP+Zb+UX408f0r9lOxWOifJhXWjfyYWllPRXYQxnrCrJHRd3YZI\n6A1NJecHEsN/S0T+76bE7xE+r5dk93LW3pL6ZpMni6PDf8VIn9m2fjm8s9rgFmQxvHNS0esbMiew\nPnHLyai9fS0w2aNfUTtrs3+uf5bGPqy068fF227KtSsdFlKqNGMV6myyY6sbdIQI8tlOWOi6Jhhk\nj3RD0vA8nicMx9etZmHRcT2Zyb6XNT8N9/2dt0T449T2AJVAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAHhdfG3E9TH9cvdPEcXjk4zqI/q3L8aeP6xr2TsxpLOekMK6mFo6qpXSrm\nOqBixvHSVmzC4OfqK7S9/wAByeLwbTW9K7fo8Fqo6Paeyl+fglI/Da0NcMPK7QC7AAB8313TiOf/\nAKk/y2MHWrX4jG3E9R/1Lfyv0/aFNOrHxuU7LI7MMayGTVlHWUXhNe6Z6wIUsb9d1m20q7dkDpez\nN9tRqKT5xEvRvKez9+Xis1/FSYerb5+OTyf6AFlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAB43j9eXjN/jWJ/Z7J5L2mry8Upb8VIF8f6aGOey2eynHvOy7bowrrYSxZSwQJ2YXZ\n92N4BoanrEvVexmTm4blr+HJ/aHltRHSXofYm/1Wrp5RaJaYY+X49WA0c4AD51xONuKan/qW/lbp\n+0MOLRtxbU/9SU4J7KadWPjep2WQrr2WRPRk1TvsndXMpiRCb9FNu0rbTuqvKBscCjfi9PhWZeue\nV9n434rafTHL1TfPxy+T/QAszAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHmv\navHtfTZfnV6VxPajHzcNrf8ABeJFs/XnMcr4no18c+6vr2YadkY2YM57sEDLyY37Mo7MMnYGlqO0\nvQ+xNfqNVb1tEfs87qZ2rL0/sVX/AHdnt65P7Q0wx8vx6UBo5wAHz/jUbcX1PT78qtO2vaCnJxjP\n8Zif2amnnspp04+OjWejKJ6MKdmcMmyJn4m5ZHzEVPMwtJv0VZLbQDqezcb8RzT6Y/7vUPM+ytZt\nn1OTyiIh6Ztn45N/6AFlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABocbxeLw\nnUR5xXm/Rvq8+OMuDJjntaswEeBxT0bNZ6NatZpNqz3rO0rqsdO3PxlaWEMpY+aqWXkryT0ZT2V3\n7A0dVPuy9f7G124NM/iyT/Z4zWT7sw957MYfB4Fp4/FE2/WWmGHldcBowAAeM9qKcvFeb8VIly9P\n0nq7ntbTbVYL+tJj93CwT76unR4/jo0nozhhTsy3Y1sWljM9Ce7HyQIm3RRlttVbaWrnt0Sh6n2U\nx8vD8mSfv3/h3XN4Bi8Lg2nj8Uc36y6TeOPXugCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAPD8RxeBxXUU26Tbmj8+quro+02Lw+I4ssdslNvzhzazvDPbq8d7GW7Dfqz2VzG\n0s2qd+iu/Zn5Ksk9BVztX1mI8930zh2LwOHabH+HHWP2fNYp4+vwYvxXiP3fUqxtWIjyjZtj45/L\nfaQFmQADzftfj3w6fJ6WmHmsP23rvaqnNwqLfhvEvIYZ+sV038bo0noy36MK9oZQxrdMyrlnMbMZ\nQKrS1M07zEestq/RRjr4utwY/wAV4j91p9V18fQdJj8LR4ccfdpEfsuREbREJbuMAAAAAAAAAAAA\nBAJAAAAEAJEAJQAJQAJEAJQAJQAJEACUJAQlAJEAJQAJQJAAAEAJEAJBAAAJAABAJEJAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwvanDzaPFmjvjv8A\ntLztJ3h7HjGHx+FainnFeaPnHV4vFbeIU038VbHeGF+kso7Mb9mTdhKnLK3dRm7SIrHhGPxeP6Sv\n9cT/AHfSnz72Zx+J7Q45/BWZ/Z9BbZ+OXyfQBZQABzeP4/E4NqI9Ii36S8Ng/wAx9C4jTxOH6ivr\njn+Hz3B/mQi/GvjdCnWNlsdI2V07LIlg6USrt2ZzZXMoFV+zPhGLxeOaavpbm/RVltEN72Yx+Jxm\nb7dKUmf7L5+s9/HtRA2cqRACRACRACRACUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQCQQCRACRACRCQBCQBCQB\nACRACRACRACRACL1i9LVntMbPATTwdRkxT3pea/u+gPE8Xx+DxrPHlaYt+qNfGvjvtXXsi0dOrKk\ndEXjZg6VMtbP2bMtXUdpEV0/Y2nNxbNf8OP+727xvsXH+N1U/wBEfy9k3nxyb+gCVQAGOWvNivX1\nrMPnGGOXNNfOJ2fSZ6w+dZKeHxDPX8N7R+6L8a+L63KdoZ7q6zvEMpnowdKJ6ywmWUyqvIKM0vQ+\nx+D6rU55+9aKx+TzWa36vbezmDwODYenW+95/Nphj5L6dQBo5wAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAEiAAAEoA\nAAAAAAAAAAAAAEAkEAkRuAkQbgkQAkQAkQAkQAl5T2nx8nEMOT8dNv0l6pwfarHvpcGWPu32/WCr\nYvK4mOem6b9mGKd4Z3idmFdka0y1c892zfpMtLPaNpEV6D2Kj/Eauf6YeweQ9ieuTVz8K/3evbT4\n5NfQBKoAA8FxCvJxrUx/XMvevD8Zry8fz/Haf2RfjTx/6RSOnRMyypHu9kXjowrqVSrvPRnZVl6V\nkK0775MsUjvadn0nT4ow6bFijtSsVfPuFYvpPGtNTy54mfy6vorXDm8l9pEC7JIgBIgBIgBIgBIg\nBIgBIhIAgBIhIAgBIgBIIBIAAhIAhIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAA\nAAAAAAAAABAJQkAEAAAAAAAAAAjc3BIjdG4Mkbo5kcwMjdhzHMDPc3V8xzAs3N1fMjmBZubq+Y5g\nWbm6vmOYFm5ur5jmBZubq+Y5gWbm6vmOYFm5ur5jmBZubq+Y5gWbm6vmTzAz3N2HMnmBlu5ftFTx\nOEZJ/DMW/d0t2rxKni8N1FPWkiZ9eS08e7Cy8dGGn6UhZaJljXZGnmc3UT3dPP2cnUT78xCIV6j2\nH/8A9c/6f7vXPI+w8bU1U+vL/d63du5NfUiDcVSIAS8b7RV5eOb/AIqRL2TyXtNX/e2KfXH/AHlF\n+NPH/pr4+2xcxx0hFpY11K7R16KM32ZWz3UaidqSgrc9kcPicWyZJjfw6T+727y3sXh2xarN+K0V\nh6lvPjj3e0ASqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJQAAAAAkQAkQAkAAAAAAAAAAAAAAA\nEgAAAAAAAAAAAAAAAAAAAAAgAAABKDcAN0bgkY8xzAyRux5kcwM9zdXNkTcFm6OZXzMeYFvMibKu\nZHMC2bo51U2RuC2bom6rc3BZzom6sBZzI52ADPnOdggFnMc6skFnMc6rc3BbznOp3RzAv50c6nml\nHMC/nOf4qOY5wX85zqOc5wbHOc7X5znBsc6edr85zg2ec52vzpi4NjmY5bROG+/bllVzsNTk5dLl\nn0pP8BHmMHWNmzt0aum8obm08vVjfrtnxztR0mXHzTvaZdjVRMTLkZo6yiFen9iZ2pqY/wBP93rN\n3kPY+/LfPX1rE/u9XzN3HfqzdO6vmTuIZ7m7Hc3Bnu8t7TR/vHBP9E/y9Pu837SV31umn+if5Rfi\n/j/01MMb1hjkrtKzBG0bMsmOZY11tOYamr6Und0LUc7XT7u3rJPqL8er9lcPhcFpbzyWm39v7O00\n+FYvA4Zpsc94xxu227jv1IAgAAAAAAAAABKAAAASgASgBIgBIgBIgBIhIAAAAAAAAAAAAAAAAAAC\nUACUJAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAg3AEbomQZbo3YzLGbAz3RNlc3YzcFs2YzdVN2\nM2Bdzom6nmNwW86JurTAMuY3REJ2BB1ZRVMVBhsbSsiqeUFXLucq3lTygp5TlXcpygp5TlXcpygp\n5TlXcqOUFXKjlXcrGYBXysdlswiYBVMdUTCyY6sZBWxlnMMZgGLGZZSwkDdHMiWO4MuY5mEyjcFn\nN1OdVzHMC3nTzqeY5gX85zqOZPMC+Lqdbk20eb/RKOZr8QybaK/XvtH7iZ9aGlp2luzT3fg19NHS\nOjbmPcYX67XH1XSZ9XIzRvMuzrK7zLkZYmYnciunb9lZ5dTk+OP+71cXeP8AZnJ/ip2nf3J/l6iL\n/Fu5L9bMWZczXi6YuIbEWTzKIuyiwLt3nuO25uI4a/hx7/rLuczg8TicvFLbfdpEK6+NPH/phhjo\nstLGkctUWnoxrrU3j1cnWTzZq1jzl1clo5Zcu8c+txR63iP3Tn6pv4+g4o5cVI9IiGe7CJ2iE7t3\nGyN2O6dwSINwSISAlAAlACRAAlAAlACRACRCQAAAAAAAAAASgASISAAAAAAAAAAAAACQAAAAAAAA\nAAAAAASAAAAAAAAAAAAAAAAIAAAQCAJljuljsCJlhMs9mOwMJYys5TkBVsjZdyHICrZPKt5E8oK4\nqmKrOVOwMIqyirPY2Bjyp2ZbAI2NmSARsbMgEbI2ZAMdjZICNkbMkSCNmOzJEgx2YyzljMAwlhKy\nWEwCuWErJhhMArlhLOWEgxljMpljIImWMyTKJA3N0IBO5vux3NwZbnMx3NwZczT4jf3MdPW27a3a\nfJOq1XNP2KdIRfi+J2trSYfcjeF+Wm1OicVeWIiN9kai8xjY12ORqultnI1Ecsujq79XP1FovWYI\nrTgeq+j8QrWZ+3Mx+r2UXeC0WG2Ti2kiN5mL807eUREvbzbaejefHJv62Iv8WUXa0WTFhVtRdlF2\nrz9WUXBtc7jR9dqc2T1ttHyhvZMvJitb0jdq6XHNcNenWVN3028U99WRj6Kb02be3Tq18/SN2Lpc\n3UdN9nOmZrqKX/DaJ/d0svvTLRzV3jomK6+Pd1vvWJj0ZczT0mXxNJht60hfFnQ4qu3N1cWTEgs3\nTur5k7gz3N2O5uDM3Y7m4MtxBuCQASIASIASAAAAAAACRCQAAAAAAAAEoSAAAAAAAAAAAlAAlCQA\nAAAAAAAAAAASAAAAAAAAAAAAIASgAAAEJAQJQCNkbMgGOyOVnsAw5TlZ7GwMOVPKy2NgY7GzIBGx\nskA2AAAAAAAAAAQkBAEghEskAxYzDPZGwK5hjMLJhjMAqmGEwumrCagomFcw2JqqtUFEsLLrV82F\no7gqljKyYYTGwMZRKUSCAQAboJnaN5Bjkneu0d5W4ccViIiOzHFWbTzNumP1Zarr8eeRMbxDW1Mx\nNO67NbkhzNVnmInqzaOZrL93JyZeV0M1++7S02jvxDWxhxx033tPpC8Z6rrezWjmZyazJG2/u03h\n2vFibTHoqvamiwVwY+nLGzV0+SZ1Mx8G0/45tOhzJ5lXMc3UVXRdlF1HP+iYsDPLPPy49/tz1+Te\npSIr0ho6ak5Ms5J8o2q6NImOrHV7XX488ypzTtHXo0s9t6zG7c1G1qz6ubeZiZ3UatXJG3yauSO7\ncvMTEx5tPLb3prPRMVr0HB8vicNxf0+7+kt+LOJwTJyY/Bnz3tH93X36N58cWvq6LSyiyndMSlC7\nmZcymLJiwLosmJVRLKLAtiU7q4lMSCzc3YxJuDMRuAlKAEgAAAlAkAAAAAABKAEgAAAAAJAAAAAA\nAAAAAAAEgAAAAAAAAAAAAAkAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAhIAAACAAAASgAAAAAAEAAAA\nhGzJAImGMwzQDDZjNVuyNgUTVhNGxysZqDVmiu1G5NN2M4waM0+DCaN2cbGcQNGaMZq3JxMJxA1J\nqx2bU4kU09slorWNwa20z02RXHbJbl26QvtFovbHWkxEdJt5y2MOHlr2U1W3jx+1hiw8vSO63lmI\nXRTaEWmtY6snRHO1VpmJ+DjavpSZl2s8b7y4HFcnh0n0gha5ebJN55KRM2mdoiPN6fh+kpwXh0Wy\nRHj5Otp/s5Ps1p62y31+em9aTMYt/OfVfxTiPjZ52naI7fBrI5t66xz5+a1rW7yx0eSL6iZjtEOX\nqNbSletom3lENjh2fbHzbbWt3iVozruc+5ztWubf4M4ybpQ2Oboyrva0Vjza8WdDR4OkXt3n9ldX\nkaePP9VtYqctYhdvt5oivTeCZ2YOxXk6ubqMfV0b9mrljfqlFcq88k7z2U5axeItDa1OPessuC8P\nya7XRWYnwqdbT/ZMilvIu4dpslNdixXja8Y5tt85djZdbDWnGOesRtXFtuw6T27No5Kx2OrKYQlC\nExKJgBnEpiyvdlEgsizKLKollFgWxLKJVRLKJBbEp3VxLKJBnuMWQJEbpBIAAAJAAAABIAAAAAAA\nlAJAAAAAAAAAAAAAASAAAAAAAAAAAAAJAAAABAJABAlAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAA\nAAABAJQAAAAgAABAAI2EoBGyJhkgGPKxmqxAKpownHC+YRMdN5BrTj67R3bOn01o7p01Iv71u89o\nb9a7LfBTfS1vWI2jf12VfQPSW8KX2mas+NC2iv6xMNfJpMnLtEbuuxtMRCtzF55NR5rPps1N/ctP\ny6uHreE6nXZ4pak48X3rT06fB7fNeI33cbX6mI32R/MWu7XF116aDSRhxbRERs8f499bkyZeeKae\nkzE2mdon81/tfxDLGOunwbzlzbx08oaHBvZHJlx48mrvaa94pu04y617576rNGLRRM0397JEd/lu\n9Dw/S3x4qxffo6mm4NjwUiKY4iI9Ib1dHFY6QIaNabbrYrLfrpJtaK1rMzPZb/s+05IpP59OyLeJ\nk7eNfRaOc1ue32I7fGXYpi5Y77M8OGMeOKxHSFsU3Y29deZMzirl6dlVvhLatCjJHeYQv1rXnps1\n8k9/VsW6qLVmZIi1rzitlvFKRvaZ2h6TSaenC9FFY+3brM+sqeG8Prp4+kZ+lvuxPkr1mqm95nfp\nDXM459676a2q1dsV7XietvNno78+CJn1cjX6mOeIm0bR33dfRU5NJjidt9t5afjG/V6JZ7I2QMNh\nnyo2BhsMuVG3wAhMSbbQRAMolnE+iuGUSCyJZRKuGUSCyJZK4llEgyZMYTuCUsYSCQASISAAAlCQ\nAAAAAAEoASCASAAAAAAAAAAAAlACRACQAAAAAAAAAEgCEoASCAAAAAAAAAAAAAAAAAAAAAAABAAA\nAAAAAAAISAIAAAAAAQAAACASgAAAQJAQAAhIDHZhln3do7z0WS18mWsajHjmes7pg3dNi5aRMNqO\nyvDHTpPRaigHZhN4hHRlaVN59JY3zRENLUavaO+yq0iNVlitJ6vNcR1MVi0zO0era1/Ea0rPvbz5\nPM5MWp45qvo2GZrhmfrsnpHpHzTCseEcM/2vrr8Q1Eb4qzy44nziPN63HpYiIiI7LNHoqabBTFii\nIpSNohuVxrKtWMEejPwY9G1FFmHB4mWJn7MdfnIM9JpIx15to5pbUaas/a6rqViI7MxPxqX0UT1r\nO3wVzpbR2hviP5i03Y5s6a879FNtHljydhExCv8AMTPJXBnRZbz0iG5ptFjwe/l96zctMVamTJtE\nyTMibu1VrdTzRMR0j0ed4lr64MVpm0RERvMz5NvX62uOJ69XhOKX1HH9bHDtFvNYnfJeOy0Z2ojX\n6jjnEq6fRUmccTvN/J9H0eKcOnx45neaxEbubwHgOHg+milI3vP2resu3Wu0JQmITsmISDHZHKz2\nJgFc1RMLJhGwK9iIZ7MZgEdgmAEwyiWCdwWRLKJVxKYsC2JTuriWUSDNlEsIlMAySx3SCRCQSIAS\nAAACRACQAAAAAAASIASAAAAAAAAAAAAAAACRACRACQASIAAAAAAAAAAAAAAAAAAAAAAAAQCUAAAA\nAAAAAAIAAAAAAAAQAAAAAACBICBICAAEJAQJQCJcLjuS2ny6fPG/LWdpd1o8T0X07SXx/e7wCdJx\nWa0jmneHQpxPDMdZmJfNtZm49weZrh0/j4o7VtSZ2+Uw0/8A7o49k92vBLc/ntFohFW9PqGXimOI\n6Tu1L8T3eCx6r2t1O3JwvHjifO99v7t/Bwf2l1PXU6rS6eJ8qUm8x+so5TsekzcSjbvs4mt4rzW5\nK2mbT0itesy2cHsvbvqtbmyz5xERWP2jd1tJwrTaONsOKtZ8585+cnDrzmn4Rq+IZObUROHD32n7\nVv8A0ej0uhxaXFGPFSK1j0bkY4jyZRVZVXFGUVWbGwKsk8mObekNrSW3pWf1a2aYjHbm7bNnQ1id\nPW0TvuDdhJEbQABMsLW2R0ZTMQrvfbz2YWzVhpanUxEd0dWkW5c8R5uXxDX1w4pnfr5Q19XxKuOJ\n2neXltVqtVxbV/RdJ715+1bypANfiOu1HENV9C0MTfNeesx2rD1PAeBYuE6aKx72W3W9/WVnBuB4\neF4dqRzZbdb5J72l160WVK02ZxCYhOwI23TsnY2BGxsnYBjsiYZsZBjMMZZSgGEolMsQDdG6NwZ7\npiVe6YkFsSziVMWZRILolMSriWUSCyJTuwhMSDMRCQSI3SAlACRCQAAEoAEoASAAAAAAAAACUACR\nACQAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAABAAAAAAAAAAAAACBKAAAAAAAQ\nJQAAAhICEbJAYTWJ7wx8KvpC0BV4ceieWGewDHlNmWwCNjZICNhIDmcZredBecdpiY69FXCOLW+i\nUiZidukulmxxlx2paN4mNng+K4+I8Hy2yaTfl37TXetoCPfRxfp1qi3F48ofKMvtvxak8s6LDv61\nrZji9rPaLUf5PC+bfttS0q8q3p9W/wBrRMdpUZuKdN99nzvFqPbTVz7nD8OKs+do2/mW3h4D7Xaq\nZnPrtNpqz35aRaYOHY9Zk4pNt9rR+rl6zi+OnS+WN57Rv1lXp/YrNaYtruL6zNPnGO3hxP6O5w/2\nf0HDuun09Yv55Le9afznqcOvO4tBreMTHu30unnva0bWt8on+70nDuE4OHYYx4Kbesz3tPrMuhGO\nIjpDOKrK9YVpsyiGUQnYGOyUgI2SlAIEmwMWMs9kTAMJYzDOYRMArmGErZhhMArlHmzmGMwDE3Ts\nbAbs4swj5pgFkSziVcM4BZEsolXDKAZwyhjCYBkACQhIAAAAAAAJAAAAAAAAAAAAAAAAAAAShIAA\nAAAAAAJAAAAAAAAAAAAAABAJEAAAAAAAAAAAAAAAIEoBKAAAAAAAAAAAAAAABAlAAAAAAAIAAAAA\nBAkBAkBAkBAlACEgMZjdjbFW8bWrEx8YWANb6Fp+bfwab+vLDKMFK9qxH5L0bAr8OPRPKz2AY7J2\nSbAjYZAI2E7AIEgIEgIEgMdkSy2NgY7MdlmyNoBXsxmFuyNgVTVjNV3KjlBRNTlXTVHKCrlIqt5T\nlBhEMohlFerLlBjEMohMVTEARDKCITsAk2AEgAAAkAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAD/\n2Q==";async function B0(e,t){await CX(e,!1);const n=UG();return e.state="warmup",t&&(e.config=VG(e.config,t)),e.config.warmup&&0!==e.config.warmup.length&&"none"!==e.config.warmup?new Promise((async t=>{await e.models.load(),await async function(e){var t,n,r,a;if(!Ue().flagRegistry.ENGINE_COMPILE_ONLY)return;const i=so(),s=ho();if("webgl"!==i&&"humangl"!==i||!(null==s?void 0:s.checkCompileCompletion))return;Ue().set("ENGINE_COMPILE_ONLY",!0);const o=Ys().state.numTensors,l=[];for(const[i,s]of Object.entries(e.models.models)){if(!s)continue;const o=(null==s?void 0:s.modelSignature)&&(null==(n=null==(t=null==s?void 0:s.inputs)?void 0:t[0])?void 0:n.shape)?[...s.inputs[0].shape]:[1,64,64,3],u=(null==s?void 0:s.modelSignature)&&(null==(a=null==(r=null==s?void 0:s.inputs)?void 0:r[0])?void 0:a.dtype)?s.inputs[0].dtype:"float32";for(let e=0;e<o.length;e++)-1===o[e]&&(o[e]=0===e?1:64);const d=nd(o,u);try{const e=s.execute(d);l.push(i),Array.isArray(e)?e.forEach((e=>to(e))):to(e)}catch(t){e.config.debug&&BG("compile fail model:",i)}to(d)}const u=await s.checkCompileCompletionAsync();s.getUniformLocations(),e.config.debug&&BG("compile pass:",{models:l,kernels:u.length}),Ue().set("ENGINE_COMPILE_ONLY",!1);const d=Ys().state.numTensors;d-o>0&&BG("tensor leak:",d-o)}(e);const r=await async function(e){let t;return t="function"==typeof createImageBitmap?await async function(e){const t=(e,t="application/octet-stream")=>fetch(`data:${t};base64,${e}`).then((e=>e.blob()));let n,r;switch(e.config.warmup){case"face":n=await t(L0);break;case"body":case"full":n=await t(z0);break;default:n=null}if(n){const t=await createImageBitmap(n);r=await e.detect(t,e.config),t.close()}return r}(e):"undefined"!=typeof Image||void 0!==mq.Canvas?await async function(e){return new Promise((t=>{let n,r;switch(e.config.warmup){case"face":n="data:image/jpeg;base64,"+L0;break;case"full":case"body":n="data:image/jpeg;base64,"+z0;break;default:n=""}if("undefined"!=typeof Image)r=new Image;else{if(!mq.Image)return void t(void 0);r=new mq.Image}r.onload=async()=>{const n=cq(r.naturalWidth,r.naturalHeight);if(n){const a=n.getContext("2d");a&&a.drawImage(r,0,0);const i=await e.image(n,!0),s=i.tensor?await e.detect(i.tensor,e.config):void 0;t(s)}else BG("Warmup: Canvas not found"),t(void 0)},n?r.src=n:t(void 0)}))}(e):await async function(e){const t=e=>Buffer.from(e,"base64");let n,r;if(n="face"===e.config.warmup?t(L0):t(z0),"node"in c&&"tensorflow"===so()){const t=(void 0).decodeJpeg(n),a=hu(t,0);e.tf.dispose(t),r=await e.detect(a,e.config),e.tf.dispose(a)}else e.config.debug&&BG("Warmup tfjs-node not loaded");return r}(e),t}(e),a=UG();e.config.debug&&BG("warmup",e.config.warmup,Math.round(a-n),"ms"),e.emit("warmup"),t(r)})):vQ()}var U0=class{constructor(e){s(this,"version"),s(this,"config"),s(this,"result"),s(this,"state"),s(this,"process"),s(this,"tf"),s(this,"env",mq),s(this,"draw",NX),s(this,"match",PQ),s(this,"models"),s(this,"events"),s(this,"faceTriangulation"),s(this,"faceUVMap"),s(this,"performance"),u(this,P0,void 0),u(this,D0,void 0),u(this,M0,void 0),s(this,"analyze",((...e)=>{if(!l(this,D0))return;const t=this.tf.engine().state.numTensors,n=l(this,P0);d(this,P0,t);const r=t-n;0!==r&&BG(...e,r)})),u(this,O0,(e=>{if(!l(this,M0))return null;if(!e)return"input is not defined";if(this.env.node&&!(e instanceof si))return"input must be a tensor";try{this.tf.getBackend()}catch(e){return"backend not loaded"}return null})),s(this,"webcam",new class{constructor(){s(this,"config"),s(this,"element"),s(this,"stream"),s(this,"devices",[]),s(this,"enumerate",(async()=>{try{const e=await navigator.mediaDevices.enumerateDevices();this.devices=e.filter((e=>"videoinput"===e.kind))}catch(e){this.devices=[]}return this.devices})),s(this,"start",(async e=>{var t,n;if((null==e?void 0:e.debug)&&(this.config.debug=null==e?void 0:e.debug),(null==e?void 0:e.crop)&&(this.config.crop=null==e?void 0:e.crop),(null==e?void 0:e.mode)&&(this.config.mode=null==e?void 0:e.mode),(null==e?void 0:e.width)&&(this.config.width=null==e?void 0:e.width),(null==e?void 0:e.height)&&(this.config.height=null==e?void 0:e.height),(null==e?void 0:e.id)&&(this.config.id=null==e?void 0:e.id),null==e?void 0:e.element)if("string"==typeof e.element){const t=document.getElementById(e.element);if(!(t&&t instanceof HTMLVideoElement))return this.config.debug&&BG("webcam","cannot get dom element",e.element),`webcam error: cannot get dom element: ${e.element}`;this.element=t}else{if(!(e.element instanceof HTMLVideoElement))return this.config.debug&&BG("webcam","unknown dom element",e.element),`webcam error: unknown dom element: ${e.element}`;this.element=e.element}else this.element=document.createElement("video");const r={audio:!1,video:{facingMode:"front"===this.config.mode?"user":"environment",resizeMode:this.config.crop?"crop-and-scale":"none"}};if((null==(t=this.config)?void 0:t.width)>0&&(r.video.width={ideal:this.config.width}),(null==(n=this.config)?void 0:n.height)>0&&(r.video.height={ideal:this.config.height}),this.config.id&&(r.video.deviceId=this.config.id),this.element.addEventListener("play",(()=>{this.config.debug&&BG("webcam","play")})),this.element.addEventListener("pause",(()=>{this.config.debug&&BG("webcam","pause")})),this.element.addEventListener("click",(async()=>{this.element&&this.stream&&(this.element.paused?await this.element.play():this.element.pause())})),!(null==navigator?void 0:navigator.mediaDevices))return this.config.debug&&BG("webcam error","no devices"),"webcam error: no devices";try{this.stream=await navigator.mediaDevices.getUserMedia(r)}catch(e){return BG("webcam",e),`webcam error: ${e}`}if(!this.stream)return this.config.debug&&BG("webcam error","no stream"),"webcam error no stream";this.element.srcObject=this.stream;const a=new Promise((e=>{this.element?this.element.onloadeddata=()=>e(!0):e(!1)}));return await a,await this.element.play(),this.config.debug&&BG("webcam",{width:this.width,height:this.height,label:this.label,stream:this.stream,track:this.track,settings:this.settings,constraints:this.constraints,capabilities:this.capabilities}),`webcam: ${this.label}`})),s(this,"pause",(()=>{this.element&&this.element.pause()})),s(this,"play",(async()=>{this.element&&await this.element.play()})),s(this,"stop",(()=>{this.config.debug&&BG("webcam","stop"),this.track&&this.track.stop()})),this.config={element:void 0,debug:!0,mode:"front",crop:!1,width:0,height:0}}get track(){if(this.stream)return this.stream.getVideoTracks()[0]}get capabilities(){if(this.track)return this.track.getCapabilities?this.track.getCapabilities():void 0}get constraints(){if(this.track)return this.track.getConstraints?this.track.getConstraints():void 0}get settings(){if(!this.stream)return;const e=this.stream.getVideoTracks()[0];return e.getSettings?e.getSettings():void 0}get label(){return this.track?this.track.label:""}get paused(){var e;return(null==(e=this.element)?void 0:e.paused)||!1}get width(){var e;return(null==(e=this.element)?void 0:e.videoWidth)||0}get height(){var e;return(null==(e=this.element)?void 0:e.videoHeight)||0}}),s(this,"emit",(e=>{var t;(null==(t=this.events)?void 0:t.dispatchEvent)&&this.events.dispatchEvent(new Event(e))})),u(this,$0,{});const t=(zG.tfjs||Nm).replace(/-(.*)/,"");var n;jG.wasmPath=`https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@${t}/dist/`,jG.modelBasePath=mq.browser?"../models/":"file://models/",this.version=SX,Object.defineProperty(this,"version",{value:SX}),this.config=JSON.parse(JSON.stringify(jG)),Object.seal(this.config),this.config.cacheModels="undefined"!=typeof indexedDB,e&&(this.config=VG(this.config,e)),n=this.config,vX.cacheModels=n.cacheModels,vX.verbose=n.debug,vX.modelBasePath=n.modelBasePath,this.tf=c,this.state="idle",d(this,P0,0),d(this,D0,!1),d(this,M0,!1),this.performance={},this.events="undefined"!=typeof EventTarget?new EventTarget:void 0,this.models=new F0(this),bK(),this.result=vQ(),this.process={tensor:null,canvas:null},this.faceTriangulation=HZ,this.faceUVMap=GZ,R0(this,null,""),this.emit("create"),(this.config.debug||this.env.browser)&&BG(`version: ${this.version}`),this.config.debug&&BG(`tfjs version: ${this.tf.version["tfjs-core"]}`);const r=JSON.parse(JSON.stringify(this.env));delete r.kernels,delete r.initial,delete r.perfadd,this.config.debug&&BG("environment:",r)}reset(){const e=this.config.backend;this.config=JSON.parse(JSON.stringify(jG)),this.config.backend=e,dq(),mq.initial=!0}validate(e){const t=WG(jG,e||this.config);return 0===t.length&&(this.config=VG(this.config,e)),t}now(){return UG()}image(e,t=!1){return pq(e,this.config,t)}async segmentation(e,t){var n,r,a;if(t&&(this.config=VG(this.config,t)),!this.config.segmentation.enabled)return null;const i=await pq(e,this.config);if(!i.tensor)return null;let s=null;return(null==(n=this.config.segmentation.modelPath)?void 0:n.includes("rvm"))&&(s=await async function(e,t){if(c0||(c0=await _0(t)),!(null==c0?void 0:c0.executor))return null;k0.src=go(e,255),S0!==t.segmentation.ratio&&T0(t);const[n,r,a,i,s,o]=await c0.executeAsync(k0,w0);let l;switch(t.segmentation.mode||"default"){case"default":l=E0(n,r);break;case"alpha":l=E0(null,r);break;case"foreground":l=E0(n,null);break;case"state":u=a,l=eo((()=>{const e={};return e.unstack=Hc(u,-1),e.concat=Ko(e.unstack,1),e.split=wc(e.concat,4,1),e.stack=Ko(e.split,2),e.squeeze=Tc(e.stack,[0]),e.expand=hu(e.squeeze,-1),e.add=mo(e.expand,1),e.mul=yo(e.add,127.5),e.cast=Vs(e.mul,"int32"),e.tile=mu(e.cast,[1,1,3]),e.alpha=hl([e.tile.shape[0]||0,e.tile.shape[1]||0,1],255,"int32"),Ko([e.tile,e.alpha],-1)}));break;default:l=Gi(0)}var u;return to([k0.src,n,r,k0.r1i,k0.r2i,k0.r3i,k0.r4i]),[k0.r1i,k0.r2i,k0.r3i,k0.r4i]=[a,i,s,o],l}(i.tensor,this.config)),(null==(r=this.config.segmentation.modelPath)?void 0:r.includes("meet"))&&(s=await async function(e,t){var n;if(kQ||(kQ=await RQ(t)),!(null==kQ?void 0:kQ.executor)||!(null==(n=null==kQ?void 0:kQ.inputs)?void 0:n[0].shape))return null;const r={};let a;switch(r.resize=hp.resizeBilinear(e,[kQ.inputs[0].shape?kQ.inputs[0].shape[1]:0,kQ.inputs[0].shape?kQ.inputs[0].shape[2]:0],!1),r.norm=go(r.resize,_X.tf255),r.res=kQ.execute(r.norm),r.squeeze=Tc(r.res,[0]),[r.bgRaw,r.fgRaw]=Hc(r.squeeze,2),r.fg=bc(r.fgRaw),r.mul=yo(r.fg,_X.tf255),r.expand=hu(r.mul,2),r.output=hp.resizeBilinear(r.expand,[e.shape[1]||0,e.shape[2]||0]),t.segmentation.mode||"default"){case"default":r.input=Tc(e),r.concat=Ko([r.input,r.output],-1),a=Vs(r.concat,"int32");break;case"alpha":a=Vs(r.output,"int32");break;default:a=Gi(0)}return Object.keys(r).forEach((e=>to(r[e]))),a}(i.tensor,this.config)),(null==(a=this.config.segmentation.modelPath)?void 0:a.includes("selfie"))&&(s=await async function(e,t){var n;if(I0||(I0=await N0(t)),!(null==I0?void 0:I0.executor)||!(null==(n=null==I0?void 0:I0.inputs)?void 0:n[0].shape))return null;const r={};let a;switch(r.resize=hp.resizeBilinear(e,[I0.inputs[0].shape?I0.inputs[0].shape[1]:0,I0.inputs[0].shape?I0.inputs[0].shape[2]:0],!1),r.norm=go(r.resize,_X.tf255),r.res=I0.execute(r.norm),r.squeeze=Tc(r.res,[0]),r.alpha=hp.resizeBilinear(r.squeeze,[e.shape[1]||0,e.shape[2]||0]),r.mul=yo(r.alpha,_X.tf255),t.segmentation.mode||"default"){case"default":r.input=Tc(e),r.concat=Ko([r.input,r.mul],-1),a=Vs(r.concat,"int32");break;case"alpha":a=Vs(r.mul,"int32");break;default:a=Gi(0)}return Object.keys(r).forEach((e=>to(r[e]))),a}(i.tensor,this.config)),to(i.tensor),s}compare(e,t){return async function(e,t,n){const r={};if(!t||!n||4!==t.shape.length||t.shape.length!==n.shape.length)return e.debug||BG("invalid input tensor or tensor shapes do not match:",t.shape,n.shape),0;if(1!==t.shape[0]||1!==n.shape[0]||3!==t.shape[3]||3!==n.shape[3])return e.debug||BG("input tensors must be of shape [1, height, width, 3]:",t.shape,n.shape),0;r.input1=js(t),r.input2=t.shape[1]!==n.shape[1]||t.shape[2]!==n.shape[2]?hp.resizeBilinear(n,[t.shape[1],t.shape[2]]):js(n),r.diff=Uu(r.input1,r.input2),r.squared=yo(r.diff,r.diff),r.sum=ou(r.squared);const a=(await r.sum.data())[0]/(t.shape[1]||1)/(t.shape[2]||1)/255/3;return to([r.input1,r.input2,r.diff,r.squared,r.sum]),a}(this.config,e,t)}async init(){await CX(this,!0),await this.tf.ready(),dq()}async load(e){this.state="load";const t=UG(),n=Object.values(this.models.models).filter((e=>e)).length;e&&(this.config=VG(this.config,e)),this.env.initial&&(await CX(this,!1)||BG("error: backend check failed"),await io(),this.env.browser&&(this.config.debug&&BG("configuration:",this.config),this.config.debug&&BG("tf flags:",this.tf.ENV.flags))),await this.models.load(this),this.env.initial&&this.config.debug&&BG("tf engine state:",this.tf.engine().state.numBytes,"bytes",this.tf.engine().state.numTensors,"tensors"),this.env.initial=!1,Object.values(this.models.models).filter((e=>e)).length!==n&&(this.models.validate(),this.emit("load"));const r=Math.trunc(UG()-t);r>(this.performance.loadModels||0)&&(this.performance.loadModels=this.env.perfadd?(this.performance.loadModels||0)+r:r)}next(e=this.result){return function(e,t){var n,r,a,i,s,o,l,u,d,c,h,p,m,f,g,y,b,x,A,v,w,k,S,T,_,I;const C=UG();if(!e)return vQ();const E=Date.now()-e.timestamp,N=E<1e3?8-Math.log(E+1):1;if(e.canvas&&(EQ.canvas=e.canvas),e.error&&(EQ.error=e.error),EQ.body&&e.body.length===EQ.body.length)for(let i=0;i<e.body.length;i++){const s=e.body[i].box.map(((e,t)=>((N-1)*EQ.body[i].box[t]+e)/N)),o=e.body[i].boxRaw.map(((e,t)=>((N-1)*EQ.body[i].boxRaw[t]+e)/N)),l=e.body[i].keypoints.map(((e,t)=>{var n,r,a,s,o,l,u,d,c;return{score:e.score,part:e.part,position:[EQ.body[i].keypoints[t]?((N-1)*(EQ.body[i].keypoints[t].position[0]||0)+(e.position[0]||0))/N:e.position[0],EQ.body[i].keypoints[t]?((N-1)*(EQ.body[i].keypoints[t].position[1]||0)+(e.position[1]||0))/N:e.position[1],EQ.body[i].keypoints[t]?((N-1)*(EQ.body[i].keypoints[t].position[2]||0)+(e.position[2]||0))/N:e.position[2]],positionRaw:[EQ.body[i].keypoints[t]?((N-1)*(EQ.body[i].keypoints[t].positionRaw[0]||0)+(e.positionRaw[0]||0))/N:e.positionRaw[0],EQ.body[i].keypoints[t]?((N-1)*(EQ.body[i].keypoints[t].positionRaw[1]||0)+(e.positionRaw[1]||0))/N:e.positionRaw[1],EQ.body[i].keypoints[t]?((N-1)*(EQ.body[i].keypoints[t].positionRaw[2]||0)+(e.positionRaw[2]||0))/N:e.positionRaw[2]],distance:[EQ.body[i].keypoints[t]?((N-1)*((null==(n=EQ.body[i].keypoints[t].distance)?void 0:n[0])||0)+((null==(r=e.distance)?void 0:r[0])||0))/N:null==(a=e.distance)?void 0:a[0],EQ.body[i].keypoints[t]?((N-1)*((null==(s=EQ.body[i].keypoints[t].distance)?void 0:s[1])||0)+((null==(o=e.distance)?void 0:o[1])||0))/N:null==(l=e.distance)?void 0:l[1],EQ.body[i].keypoints[t]?((N-1)*((null==(u=EQ.body[i].keypoints[t].distance)?void 0:u[2])||0)+((null==(d=e.distance)?void 0:d[2])||0))/N:null==(c=e.distance)?void 0:c[2]]}})),u={};let d={connected:{}};(null==(n=t.body.modelPath)?void 0:n.includes("efficientpose"))?d=XK:(null==(r=t.body.modelPath)?void 0:r.includes("blazepose"))?d=xK:(null==(a=t.body.modelPath)?void 0:a.includes("movenet"))&&(d=wQ);for(const[e,t]of Object.entries(d.connected)){const n=[];for(let e=0;e<t.length-1;e++){const r=l.find((n=>n.part===t[e])),a=l.find((n=>n.part===t[e+1]));r&&a&&n.push([r.position,a.position])}u[e]=n}EQ.body[i]={...e.body[i],box:s,boxRaw:o,keypoints:l,annotations:u}}else EQ.body=JSON.parse(JSON.stringify(e.body));if(EQ.hand&&e.hand.length===EQ.hand.length)for(let t=0;t<e.hand.length;t++){const n=e.hand[t].box.map(((e,n)=>((N-1)*EQ.hand[t].box[n]+e)/N)),r=e.hand[t].boxRaw.map(((e,n)=>((N-1)*EQ.hand[t].boxRaw[n]+e)/N));EQ.hand[t].keypoints.length!==e.hand[t].keypoints.length&&(EQ.hand[t].keypoints=e.hand[t].keypoints);const a=e.hand[t].keypoints&&e.hand[t].keypoints.length>0?e.hand[t].keypoints.map(((e,n)=>e.map(((e,r)=>((N-1)*(EQ.hand[t].keypoints[n][r]||1)+(e||0))/N)))):[];let l={};if(Object.keys(EQ.hand[t].annotations).length!==Object.keys(e.hand[t].annotations).length)EQ.hand[t].annotations=e.hand[t].annotations,l=EQ.hand[t].annotations;else if(e.hand[t].annotations)for(const n of Object.keys(e.hand[t].annotations))l[n]=(null==(o=null==(s=null==(i=e.hand[t])?void 0:i.annotations)?void 0:s[n])?void 0:o[0])?e.hand[t].annotations[n].map(((e,r)=>e.map(((e,a)=>((N-1)*EQ.hand[t].annotations[n][r][a]+e)/N)))):null;EQ.hand[t]={...e.hand[t],box:n,boxRaw:r,keypoints:a,annotations:l}}else EQ.hand=JSON.parse(JSON.stringify(e.hand));if(EQ.face&&e.face.length===EQ.face.length)for(let t=0;t<e.face.length;t++){const n=e.face[t].box.map(((e,n)=>((N-1)*EQ.face[t].box[n]+e)/N)),r=e.face[t].boxRaw.map(((e,n)=>((N-1)*EQ.face[t].boxRaw[n]+e)/N));let a=e.face[t].annotations;if(Object.keys(EQ.face[t].annotations).length!==Object.keys(e.face[t].annotations).length)EQ.face[t].annotations=e.face[t].annotations,a=EQ.face[t].annotations;else if(e.face[t].annotations)for(const n of Object.keys(e.face[t].annotations))a[n]=(null==(d=null==(u=null==(l=e.face[t])?void 0:l.annotations)?void 0:u[n])?void 0:d[0])?e.face[t].annotations[n].map(((e,r)=>e.map(((e,a)=>((N-1)*EQ.face[t].annotations[n][r][a]+e)/N)))):null;if(e.face[t].rotation){const i={matrix:[0,0,0,0,0,0,0,0,0],angle:{roll:0,yaw:0,pitch:0},gaze:{bearing:0,strength:0}};i.matrix=null==(c=e.face[t].rotation)?void 0:c.matrix,i.angle={roll:((N-1)*((null==(p=null==(h=EQ.face[t].rotation)?void 0:h.angle)?void 0:p.roll)||0)+((null==(f=null==(m=e.face[t].rotation)?void 0:m.angle)?void 0:f.roll)||0))/N,yaw:((N-1)*((null==(y=null==(g=EQ.face[t].rotation)?void 0:g.angle)?void 0:y.yaw)||0)+((null==(x=null==(b=e.face[t].rotation)?void 0:b.angle)?void 0:x.yaw)||0))/N,pitch:((N-1)*((null==(v=null==(A=EQ.face[t].rotation)?void 0:A.angle)?void 0:v.pitch)||0)+((null==(k=null==(w=e.face[t].rotation)?void 0:w.angle)?void 0:k.pitch)||0))/N},i.gaze={bearing:((N-1)*((null==(S=EQ.face[t].rotation)?void 0:S.gaze.bearing)||0)+((null==(T=e.face[t].rotation)?void 0:T.gaze.bearing)||0))/N,strength:((N-1)*((null==(_=EQ.face[t].rotation)?void 0:_.gaze.strength)||0)+((null==(I=e.face[t].rotation)?void 0:I.gaze.strength)||0))/N},EQ.face[t]={...e.face[t],rotation:i,box:n,boxRaw:r,annotations:a}}else EQ.face[t]={...e.face[t],box:n,boxRaw:r,annotations:a}}else EQ.face=JSON.parse(JSON.stringify(e.face));if(EQ.object&&e.object.length===EQ.object.length)for(let t=0;t<e.object.length;t++){const n=e.object[t].box.map(((e,n)=>((N-1)*EQ.object[t].box[n]+e)/N)),r=e.object[t].boxRaw.map(((e,n)=>((N-1)*EQ.object[t].boxRaw[n]+e)/N));EQ.object[t]={...e.object[t],box:n,boxRaw:r}}else EQ.object=JSON.parse(JSON.stringify(e.object));if(e.persons){const t=e.persons;if(EQ.persons&&t.length===EQ.persons.length)for(let e=0;e<t.length;e++)EQ.persons[e].box=t[e].box.map(((t,n)=>((N-1)*EQ.persons[e].box[n]+t)/N));else EQ.persons=JSON.parse(JSON.stringify(t))}e.gesture&&(EQ.gesture=e.gesture),EQ.width=e.width,EQ.height=e.height;const R=UG();return NQ=mq.perfadd?NQ+Math.round(R-C):Math.round(R-C),e.performance&&(EQ.performance={...e.performance,interpolate:NQ}),EQ}(e,this.config)}async warmup(e){const t=UG(),n=await B0(this,e),r=UG();return this.performance.warmup=Math.trunc(r-t),n}async profile(e,t){const n=await this.tf.profile((()=>this.detect(e,t))),r={};let a=0;for(const e of n.kernels){const t=Number(e.kernelTimeMs)||0;r[e.name]?r[e.name]+=t:r[e.name]=t,a+=t}const i=[];Object.entries(r).forEach((e=>i.push({kernel:e[0],time:e[1],perc:0})));for(const e of i)e.perc=Math.round(1e3*e.time/a)/1e3,e.time=Math.round(1e3*e.time)/1e3;return i.sort(((e,t)=>t.time-e.time)),i.length=20,i}async detect(e,t){return this.state="detect",new Promise((async n=>{var r,a,i,s,o,u,d,c,h,p,m,f,g,y,b,x,A,v,w,k,S;let T;this.state="config",this.config=VG(this.config,t),this.state="check";const _=l(this,O0).call(this,e);_&&(BG(_,e),this.emit("error"),n(vQ(_)));const I=UG();await this.load(),T=UG(),this.state="image";const C=await pq(e,this.config);if(this.process=C,this.performance.inputProcess=this.env.perfadd?(this.performance.inputProcess||0)+Math.trunc(UG()-T):Math.trunc(UG()-T),this.analyze("Get Image:"),!C.tensor)return this.config.debug&&BG("could not convert input to tensor"),this.emit("error"),void n(vQ("could not convert input to tensor"));this.emit("image"),T=UG(),this.config.skipAllowed=await async function(e,t){let n=!1;if(0===e.cacheSensitivity||!t.shape||4!==t.shape.length||t.shape[1]>3840||t.shape[2]>2160)return n;if(uq.inputTensor)if(uq.inputTensor.shape[1]!==t.shape[1]||uq.inputTensor.shape[2]!==t.shape[2])to(uq.inputTensor),uq.inputTensor=js(t);else{const r={};r.diff=Uu(t,uq.inputTensor),r.squared=yo(r.diff,r.diff),r.sum=ou(r.squared);const a=(await r.sum.data())[0]/(t.shape[1]||1)/(t.shape[2]||1)/255/3;to([uq.inputTensor,r.diff,r.squared,r.sum]),uq.inputTensor=js(t),n=a<=(e.cacheSensitivity||0)}else uq.inputTensor=js(t);return n}(this.config,C.tensor),this.config.filter.autoBrightness=!!this.config.filter.autoBrightness&&this.config.skipAllowed,this.performance.totalFrames||(this.performance.totalFrames=0),this.performance.cachedFrames||(this.performance.cachedFrames=0),this.performance.totalFrames++,this.config.skipAllowed&&this.performance.cachedFrames++,this.performance.cacheCheck=this.env.perfadd?(this.performance.cacheCheck||0)+Math.trunc(UG()-T):Math.trunc(UG()-T),this.analyze("Check Changed:");let E=[],N=[],R=[],P=[];this.state="detect:face",this.config.async?(E=this.config.face.enabled?tJ(this,C.tensor):[],this.performance.face&&delete this.performance.face):(T=UG(),E=this.config.face.enabled?await tJ(this,C.tensor):[],this.performance.face=this.env.perfadd?(this.performance.face||0)+Math.trunc(UG()-T):Math.trunc(UG()-T)),!this.config.async||-1!==this.config.body.maxDetected&&-1!==this.config.hand.maxDetected||(E=await E),this.analyze("Start Body:"),this.state="detect:body";const D=-1===this.config.body.maxDetected?VG(this.config,{body:{maxDetected:this.config.face.enabled?1*E.length:1}}):this.config;this.config.async?((null==(r=this.config.body.modelPath)?void 0:r.includes("posenet"))?N=this.config.body.enabled?v0(C.tensor,D):[]:(null==(a=this.config.body.modelPath)?void 0:a.includes("blazepose"))?N=this.config.body.enabled?BK(C.tensor,D):[]:(null==(i=this.config.body.modelPath)?void 0:i.includes("efficientpose"))?N=this.config.body.enabled?nZ(C.tensor,D):[]:(null==(s=this.config.body.modelPath)?void 0:s.includes("movenet"))&&(N=this.config.body.enabled?qQ(C.tensor,D):[]),this.performance.body&&delete this.performance.body):(T=UG(),(null==(o=this.config.body.modelPath)?void 0:o.includes("posenet"))?N=this.config.body.enabled?await v0(C.tensor,D):[]:(null==(u=this.config.body.modelPath)?void 0:u.includes("blazepose"))?N=this.config.body.enabled?await BK(C.tensor,D):[]:(null==(d=this.config.body.modelPath)?void 0:d.includes("efficientpose"))?N=this.config.body.enabled?await nZ(C.tensor,D):[]:(null==(c=this.config.body.modelPath)?void 0:c.includes("movenet"))&&(N=this.config.body.enabled?await qQ(C.tensor,D):[]),this.performance.body=this.env.perfadd?(this.performance.body||0)+Math.trunc(UG()-T):Math.trunc(UG()-T)),this.analyze("End Body:"),this.analyze("Start Hand:"),this.state="detect:hand";const M=-1===this.config.hand.maxDetected?VG(this.config,{hand:{maxDetected:this.config.face.enabled?2*E.length:1}}):this.config;this.config.async?((null==(p=null==(h=this.config.hand.detector)?void 0:h.modelPath)?void 0:p.includes("handdetect"))?R=this.config.hand.enabled?uQ(C.tensor,M):[]:(null==(f=null==(m=this.config.hand.detector)?void 0:m.modelPath)?void 0:f.includes("handtrack"))&&(R=this.config.hand.enabled?AQ(C.tensor,M):[]),this.performance.hand&&delete this.performance.hand):(T=UG(),(null==(y=null==(g=this.config.hand.detector)?void 0:g.modelPath)?void 0:y.includes("handdetect"))?R=this.config.hand.enabled?await uQ(C.tensor,M):[]:(null==(x=null==(b=this.config.hand.detector)?void 0:b.modelPath)?void 0:x.includes("handtrack"))&&(R=this.config.hand.enabled?await AQ(C.tensor,M):[]),this.performance.hand=this.env.perfadd?(this.performance.hand||0)+Math.trunc(UG()-T):Math.trunc(UG()-T)),this.analyze("End Hand:"),this.analyze("Start Object:"),this.state="detect:object",this.config.async?((null==(A=this.config.object.modelPath)?void 0:A.includes("nanodet"))?P=this.config.object.enabled?QQ(C.tensor,this.config):[]:(null==(v=this.config.object.modelPath)?void 0:v.includes("centernet"))&&(P=this.config.object.enabled?qK(C.tensor,this.config):[]),this.performance.object&&delete this.performance.object):(T=UG(),(null==(w=this.config.object.modelPath)?void 0:w.includes("nanodet"))?P=this.config.object.enabled?await QQ(C.tensor,this.config):[]:(null==(k=this.config.object.modelPath)?void 0:k.includes("centernet"))&&(P=this.config.object.enabled?await qK(C.tensor,this.config):[]),this.performance.object=this.env.perfadd?(this.performance.object||0)+Math.trunc(UG()-T):Math.trunc(UG()-T)),this.analyze("End Object:"),this.state="detect:await",this.config.async&&([E,N,R,P]=await Promise.all([E,N,R,P])),this.state="detect:gesture";let O=[];this.config.gesture.enabled&&(T=UG(),O=[...BJ(E),...zJ(N),...WJ(R),...UJ(E)],this.config.async?this.performance.gesture&&delete this.performance.gesture:this.performance.gesture=this.env.perfadd?(this.performance.gesture||0)+Math.trunc(UG()-T):Math.trunc(UG()-T)),this.performance.total=this.env.perfadd?(this.performance.total||0)+Math.trunc(UG()-I):Math.trunc(UG()-I);const $=(null==(S=this.process.tensor)?void 0:S.shape)||[0,0,0,0];this.result={face:E,body:N,hand:R,gesture:O,object:P,performance:this.performance,canvas:this.process.canvas,timestamp:Date.now(),error:null,width:$[2],height:$[1],get persons(){return function(e,t,n,r,a){var i,s,o,l,u,d;let c=0;const h=[];for(const p of e){const e={id:c++,face:p,body:null,hands:{left:null,right:null},gestures:[],box:[0,0,0,0]};for(const n of t)p.box[0]>n.box[0]&&p.box[0]<n.box[0]+n.box[2]&&p.box[1]+p.box[3]>n.box[1]&&p.box[1]+p.box[3]<n.box[1]+n.box[3]&&(e.body=n);if(e.body)for(const t of n)t.box[0]+t.box[2]>e.body.box[0]&&t.box[0]+t.box[2]<e.body.box[0]+e.body.box[2]&&t.box[1]+t.box[3]>e.body.box[1]&&t.box[1]+t.box[3]<e.body.box[1]+e.body.box[3]&&e.hands&&(e.hands.left=t),t.box[0]<e.body.box[0]+e.body.box[2]&&t.box[0]>e.body.box[0]&&t.box[1]+t.box[3]>e.body.box[1]&&t.box[1]+t.box[3]<e.body.box[1]+e.body.box[3]&&e.hands&&(e.hands.right=t);for(const t of r)(void 0!==t.face&&t.face===p.id||void 0!==t.iris&&t.iris===p.id||void 0!==t.body&&t.body===(null==(i=e.body)?void 0:i.id)||void 0!==t.hand&&t.hand===(null==(s=e.hands.left)?void 0:s.id)||void 0!==t.hand&&t.hand===(null==(o=e.hands.right)?void 0:o.id))&&e.gestures.push(t);const m=[],f=[],g=e=>{e&&4===e.length&&(m.push(e[0],e[0]+e[2]),f.push(e[1],e[1]+e[3]))};g(e.face.box),g(null==(l=e.body)?void 0:l.box),g(null==(u=e.hands.left)?void 0:u.box),g(null==(d=e.hands.right)?void 0:d.box);const y=Math.min(...m),b=Math.min(...f);e.box=[y,b,Math.max(...m)-y,Math.max(...f)-b],(null==a?void 0:a[1])&&(null==a?void 0:a[2])&&(e.boxRaw=[e.box[0]/a[2],e.box[1]/a[1],e.box[2]/a[2],e.box[3]/a[1]]),h.push(e)}return h}(E,N,R,O,$)}},to(C.tensor),this.emit("detect"),this.state="idle",n(this.result)}))}async sleep(e){return new Promise((t=>{setTimeout(t,e)}))}async video(e,t=!0,n=0){t?(l(this,$0)[e.id]||(this.config.debug&&BG("video start",e.id),l(this,$0)[e.id]=!0),!e.paused&&l(this,$0)[e.id]&&e.readyState>=2&&await this.detect(e),n>0&&await this.sleep(n),l(this,$0)[e.id]&&requestAnimationFrame((()=>this.video(e,t,n)))):(this.config.debug&&BG("video stop",e.id),l(this,$0)[e.id]=!1)}};P0=new WeakMap,D0=new WeakMap,M0=new WeakMap,O0=new WeakMap,$0=new WeakMap},167:(e,t)=>{"use strict";function n(e,t){return void 0===t&&(t=Object),t&&"function"==typeof t.freeze?t.freeze(e):e}var r=n({HTML:"text/html",isHTML:function(e){return e===r.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),a=n({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===a.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});t.assign=function(e,t){if(null===e||"object"!=typeof e)throw new TypeError("target is not an object");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},t.find=function(e,t,n){if(void 0===n&&(n=Array.prototype),e&&"function"==typeof n.find)return n.find.call(e,t);for(var r=0;r<e.length;r++)if(Object.prototype.hasOwnProperty.call(e,r)){var a=e[r];if(t.call(void 0,a,r,e))return a}},t.freeze=n,t.MIME_TYPE=r,t.NAMESPACE=a},129:(e,t,n)=>{var r=n(167),a=n(146),i=n(45),s=n(925),o=a.DOMImplementation,l=r.NAMESPACE,u=s.ParseError,d=s.XMLReader;function c(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function h(e){this.options=e||{locator:{}}}function p(){this.cdata=!1}function m(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function f(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function g(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function y(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}h.prototype.parseFromString=function(e,t){var n=this.options,r=new d,a=n.domBuilder||new p,s=n.errorHandler,o=n.locator,u=n.xmlns||{},h=/\/x?html?$/.test(t),m=h?i.HTML_ENTITIES:i.XML_ENTITIES;o&&a.setDocumentLocator(o),r.errorHandler=function(e,t,n){if(!e){if(t instanceof p)return t;e=t}var r={},a=e instanceof Function;function i(t){var i=e[t];!i&&a&&(i=2==e.length?function(n){e(t,n)}:e),r[t]=i&&function(e){i("[xmldom "+t+"]\t"+e+f(n))}||function(){}}return n=n||{},i("warning"),i("error"),i("fatalError"),r}(s,a,o),r.domBuilder=n.domBuilder||a,h&&(u[""]=l.HTML),u.xml=u.xml||l.XML;var g=n.normalizeLineEndings||c;return e&&"string"==typeof e?r.parse(g(e),u,m):r.errorHandler.error("invalid doc source"),a.doc},p.prototype={startDocument:function(){this.doc=(new o).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var a=this.doc,i=a.createElementNS(e,n||t),s=r.length;y(this,i),this.currentElement=i,this.locator&&m(this.locator,i);for(var o=0;o<s;o++){e=r.getURI(o);var l=r.getValue(o),u=(n=r.getQName(o),a.createAttributeNS(e,n));this.locator&&m(r.getLocator(o),u),u.value=u.nodeValue=l,i.setAttributeNode(u)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName,this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&m(this.locator,n),y(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=g.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&m(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=g.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&m(this.locator,r),y(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var a=r.createDocumentType(e,t,n);this.locator&&m(this.locator,a),y(this,a),this.doc.doctype=a}},warning:function(e){console.warn("[xmldom warning]\t"+e,f(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,f(this.locator))},fatalError:function(e){throw new u(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){p.prototype[e]=function(){return null}})),t.DOMParser=h},146:(e,t,n)=>{var r=n(167),a=r.find,i=r.NAMESPACE;function s(e){return""!==e}function o(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function l(e){if(!e)return[];var t=function(e){return e?e.split(/[\t\n\f\r ]+/).filter(s):[]}(e);return Object.keys(t.reduce(o,{}))}function u(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function d(e,t){var n=e.prototype;if(!(n instanceof t)){function r(){}r.prototype=t.prototype,u(n,r=new r),e.prototype=n=r}n.constructor!=e&&("function"!=typeof e&&console.error("unknown Class:"+e),n.constructor=e)}var c={},h=c.ELEMENT_NODE=1,p=c.ATTRIBUTE_NODE=2,m=c.TEXT_NODE=3,f=c.CDATA_SECTION_NODE=4,g=c.ENTITY_REFERENCE_NODE=5,y=c.ENTITY_NODE=6,b=c.PROCESSING_INSTRUCTION_NODE=7,x=c.COMMENT_NODE=8,A=c.DOCUMENT_NODE=9,v=c.DOCUMENT_TYPE_NODE=10,w=c.DOCUMENT_FRAGMENT_NODE=11,k=c.NOTATION_NODE=12,S={},T={},_=(S.INDEX_SIZE_ERR=(T[1]="Index size error",1),S.DOMSTRING_SIZE_ERR=(T[2]="DOMString size error",2),S.HIERARCHY_REQUEST_ERR=(T[3]="Hierarchy request error",3)),I=(S.WRONG_DOCUMENT_ERR=(T[4]="Wrong document",4),S.INVALID_CHARACTER_ERR=(T[5]="Invalid character",5),S.NO_DATA_ALLOWED_ERR=(T[6]="No data allowed",6),S.NO_MODIFICATION_ALLOWED_ERR=(T[7]="No modification allowed",7),S.NOT_FOUND_ERR=(T[8]="Not found",8)),C=(S.NOT_SUPPORTED_ERR=(T[9]="Not supported",9),S.INUSE_ATTRIBUTE_ERR=(T[10]="Attribute in use",10));function E(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,T[e]),this.message=T[e],Error.captureStackTrace&&Error.captureStackTrace(this,E);return n.code=e,t&&(this.message=this.message+": "+t),n}function N(){}function R(e,t){this._node=e,this._refresh=t,P(this)}function P(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);be(e,"length",n.length),u(n,e),e._inc=t}}function D(){}function M(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function O(e,t,n,r){if(r?t[M(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var a=e.ownerDocument;a&&(r&&W(a,e,r),function(e,t,n){e&&e._inc++,n.namespaceURI===i.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(a,e,n))}}function $(e,t,n){var r=M(t,n);if(!(r>=0))throw new E(I,new Error(e.tagName+"@"+n));for(var a=t.length-1;r<a;)t[r]=t[++r];if(t.length=a,e){var i=e.ownerDocument;i&&(W(i,e,n),n.ownerElement=null)}}function F(){}function L(){}function z(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function B(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(B(e,t))return!0}while(e=e.nextSibling)}function U(){this.ownerDocument=this}function W(e,t,n,r){e&&e._inc++,n.namespaceURI===i.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function V(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var a=t.firstChild,i=0;a;)r[i++]=a,a=a.nextSibling;r.length=i,delete r[r.length]}}}function j(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,V(e.ownerDocument,e),t}function H(e){return e&&e.nodeType===L.DOCUMENT_TYPE_NODE}function G(e){return e&&e.nodeType===L.ELEMENT_NODE}function q(e){return e&&e.nodeType===L.TEXT_NODE}function X(e,t){var n=e.childNodes||[];if(a(n,G)||H(t))return!1;var r=a(n,H);return!(t&&r&&n.indexOf(r)>n.indexOf(t))}function K(e,t){var n=e.childNodes||[];if(a(n,(function(e){return G(e)&&e!==t})))return!1;var r=a(n,H);return!(t&&r&&n.indexOf(r)>n.indexOf(t))}function Z(e,t,n){var r=e.childNodes||[],i=t.childNodes||[];if(t.nodeType===L.DOCUMENT_FRAGMENT_NODE){var s=i.filter(G);if(s.length>1||a(i,q))throw new E(_,"More than one element or text in fragment");if(1===s.length&&!X(e,n))throw new E(_,"Element in fragment can not be inserted before doctype")}if(G(t)&&!X(e,n))throw new E(_,"Only one element can be added and only after doctype");if(H(t)){if(a(r,H))throw new E(_,"Only one doctype is allowed");var o=a(r,G);if(n&&r.indexOf(o)<r.indexOf(n))throw new E(_,"Doctype can only be inserted before an element");if(!n&&o)throw new E(_,"Doctype can not be appended since element is present")}}function Y(e,t,n){var r=e.childNodes||[],i=t.childNodes||[];if(t.nodeType===L.DOCUMENT_FRAGMENT_NODE){var s=i.filter(G);if(s.length>1||a(i,q))throw new E(_,"More than one element or text in fragment");if(1===s.length&&!K(e,n))throw new E(_,"Element in fragment can not be inserted before doctype")}if(G(t)&&!K(e,n))throw new E(_,"Only one element can be added and only after doctype");if(H(t)){if(a(r,(function(e){return H(e)&&e!==n})))throw new E(_,"Only one doctype is allowed");var o=a(r,G);if(n&&r.indexOf(o)<r.indexOf(n))throw new E(_,"Doctype can only be inserted before an element")}}function J(e,t,n,r){(function(e,t,n){if(!function(e){return e&&(e.nodeType===L.DOCUMENT_NODE||e.nodeType===L.DOCUMENT_FRAGMENT_NODE||e.nodeType===L.ELEMENT_NODE)}(e))throw new E(_,"Unexpected parent node type "+e.nodeType);if(n&&n.parentNode!==e)throw new E(I,"child not in parent");if(!function(e){return e&&(G(e)||q(e)||H(e)||e.nodeType===L.DOCUMENT_FRAGMENT_NODE||e.nodeType===L.COMMENT_NODE||e.nodeType===L.PROCESSING_INSTRUCTION_NODE)}(t)||H(t)&&e.nodeType!==L.DOCUMENT_NODE)throw new E(_,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)})(e,t,n),e.nodeType===L.DOCUMENT_NODE&&(r||Z)(e,t,n);var a=t.parentNode;if(a&&a.removeChild(t),t.nodeType===w){var i=t.firstChild;if(null==i)return t;var s=t.lastChild}else i=s=t;var o=n?n.previousSibling:e.lastChild;i.previousSibling=o,s.nextSibling=n,o?o.nextSibling=i:e.firstChild=i,null==n?e.lastChild=s:n.previousSibling=s;do{i.parentNode=e}while(i!==s&&(i=i.nextSibling));return V(e.ownerDocument||e,e),t.nodeType==w&&(t.firstChild=t.lastChild=null),t}function Q(){this._nsMap={}}function ee(){}function te(){}function ne(){}function re(){}function ae(){}function ie(){}function se(){}function oe(){}function le(){}function ue(){}function de(){}function ce(){}function he(e,t){var n=[],r=9==this.nodeType&&this.documentElement||this,a=r.prefix,i=r.namespaceURI;if(i&&null==a&&null==(a=r.lookupPrefix(i)))var s=[{namespace:i,prefix:null}];return fe(this,n,e,t,s),n.join("")}function pe(e,t,n){var r=e.prefix||"",a=e.namespaceURI;if(!a)return!1;if("xml"===r&&a===i.XML||a===i.XMLNS)return!1;for(var s=n.length;s--;){var o=n[s];if(o.prefix===r)return o.namespace!==a}return!0}function me(e,t,n){e.push(" ",t,'="',n.replace(/[<>&"\t\n\r]/g,z),'"')}function fe(e,t,n,r,a){if(a||(a=[]),r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case h:var s=e.attributes,o=s.length,l=e.firstChild,u=e.tagName,d=u;if(!(n=i.isHTML(e.namespaceURI)||n)&&!e.prefix&&e.namespaceURI){for(var c,y=0;y<s.length;y++)if("xmlns"===s.item(y).name){c=s.item(y).value;break}if(!c)for(var k=a.length-1;k>=0;k--)if(""===(S=a[k]).prefix&&S.namespace===e.namespaceURI){c=S.namespace;break}if(c!==e.namespaceURI)for(k=a.length-1;k>=0;k--){var S;if((S=a[k]).namespace===e.namespaceURI){S.prefix&&(d=S.prefix+":"+u);break}}}t.push("<",d);for(var T=0;T<o;T++)"xmlns"==(_=s.item(T)).prefix?a.push({prefix:_.localName,namespace:_.value}):"xmlns"==_.nodeName&&a.push({prefix:"",namespace:_.value});for(T=0;T<o;T++){var _,I,C;pe(_=s.item(T),0,a)&&(me(t,(I=_.prefix||"")?"xmlns:"+I:"xmlns",C=_.namespaceURI),a.push({prefix:I,namespace:C})),fe(_,t,n,r,a)}if(u===d&&pe(e,0,a)&&(me(t,(I=e.prefix||"")?"xmlns:"+I:"xmlns",C=e.namespaceURI),a.push({prefix:I,namespace:C})),l||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(u)){if(t.push(">"),n&&/^script$/i.test(u))for(;l;)l.data?t.push(l.data):fe(l,t,n,r,a.slice()),l=l.nextSibling;else for(;l;)fe(l,t,n,r,a.slice()),l=l.nextSibling;t.push("</",d,">")}else t.push("/>");return;case A:case w:for(l=e.firstChild;l;)fe(l,t,n,r,a.slice()),l=l.nextSibling;return;case p:return me(t,e.name,e.value);case m:return t.push(e.data.replace(/[<&>]/g,z));case f:return t.push("<![CDATA[",e.data,"]]>");case x:return t.push("\x3c!--",e.data,"--\x3e");case v:var E=e.publicId,N=e.systemId;if(t.push("<!DOCTYPE ",e.name),E)t.push(" PUBLIC ",E),N&&"."!=N&&t.push(" ",N),t.push(">");else if(N&&"."!=N)t.push(" SYSTEM ",N,">");else{var R=e.internalSubset;R&&t.push(" [",R,"]"),t.push(">")}return;case b:return t.push("<?",e.target," ",e.data,"?>");case g:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ge(e,t,n){var r;switch(t.nodeType){case h:(r=t.cloneNode(!1)).ownerDocument=e;case w:break;case p:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var a=t.firstChild;a;)r.appendChild(ge(e,a,n)),a=a.nextSibling;return r}function ye(e,t,n){var r=new t.constructor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a];"object"!=typeof i&&i!=r[a]&&(r[a]=i)}switch(t.childNodes&&(r.childNodes=new N),r.ownerDocument=e,r.nodeType){case h:var s=t.attributes,o=r.attributes=new D,l=s.length;o._ownerElement=r;for(var u=0;u<l;u++)r.setAttributeNode(ye(e,s.item(u),!0));break;case p:n=!0}if(n)for(var d=t.firstChild;d;)r.appendChild(ye(e,d,n)),d=d.nextSibling;return r}function be(e,t,n){e[t]=n}S.INVALID_STATE_ERR=(T[11]="Invalid state",11),S.SYNTAX_ERR=(T[12]="Syntax error",12),S.INVALID_MODIFICATION_ERR=(T[13]="Invalid modification",13),S.NAMESPACE_ERR=(T[14]="Invalid namespace",14),S.INVALID_ACCESS_ERR=(T[15]="Invalid access",15),E.prototype=Error.prototype,u(S,E),N.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)fe(this[r],n,e,t);return n.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},R.prototype.item=function(e){return P(this),this[e]},d(R,N),D.prototype={length:0,item:N.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new E(C);var n=this.getNamedItem(e.nodeName);return O(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new E(C);return t=this.getNamedItemNS(e.namespaceURI,e.localName),O(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return $(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return $(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},F.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,n){var r=new U;if(r.implementation=this,r.childNodes=new N,r.doctype=n||null,n&&r.appendChild(n),t){var a=r.createElementNS(e,t);r.appendChild(a)}return r},createDocumentType:function(e,t,n){var r=new ie;return r.name=e,r.nodeName=e,r.publicId=t||"",r.systemId=n||"",r}},L.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return J(this,e,t)},replaceChild:function(e,t){J(this,e,t,Y),t&&this.removeChild(t)},removeChild:function(e){return j(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return ye(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==m&&e.nodeType==m?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)&&n[r]===e)return r;t=t.nodeType==p?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e];t=t.nodeType==p?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},u(c,L),u(c,L.prototype),U.prototype={nodeName:"#document",nodeType:A,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==w){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return J(this,e,t),e.ownerDocument=this,null===this.documentElement&&e.nodeType===h&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),j(this,e)},replaceChild:function(e,t){J(this,e,t,Y),e.ownerDocument=this,t&&this.removeChild(t),G(e)&&(this.documentElement=e)},importNode:function(e,t){return ge(this,e,t)},getElementById:function(e){var t=null;return B(this.documentElement,(function(n){if(n.nodeType==h&&n.getAttribute("id")==e)return t=n,!0})),t},getElementsByClassName:function(e){var t=l(e);return new R(this,(function(n){var r=[];return t.length>0&&B(n.documentElement,(function(a){if(a!==n&&a.nodeType===h){var i=a.getAttribute("class");if(i){var s=e===i;if(!s){var o=l(i);s=t.every((u=o,function(e){return u&&-1!==u.indexOf(e)}))}s&&r.push(a)}}var u})),r}))},createElement:function(e){var t=new Q;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new N,(t.attributes=new D)._ownerElement=t,t},createDocumentFragment:function(){var e=new ue;return e.ownerDocument=this,e.childNodes=new N,e},createTextNode:function(e){var t=new ne;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new re;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new ae;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new de;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new ee;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new le;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new Q,r=t.split(":"),a=n.attributes=new D;return n.childNodes=new N,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,a._ownerElement=n,n},createAttributeNS:function(e,t){var n=new ee,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},d(U,L),Q.prototype={nodeType:h,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===w?this.insertBefore(e,null):function(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,V(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new R(this,(function(t){var n=[];return B(t,(function(r){r===t||r.nodeType!=h||"*"!==e&&r.tagName!=e||n.push(r)})),n}))},getElementsByTagNameNS:function(e,t){return new R(this,(function(n){var r=[];return B(n,(function(a){a===n||a.nodeType!==h||"*"!==e&&a.namespaceURI!==e||"*"!==t&&a.localName!=t||r.push(a)})),r}))}},U.prototype.getElementsByTagName=Q.prototype.getElementsByTagName,U.prototype.getElementsByTagNameNS=Q.prototype.getElementsByTagNameNS,d(Q,L),ee.prototype.nodeType=p,d(ee,L),te.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(T[_])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},d(te,L),ne.prototype={nodeName:"#text",nodeType:m,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},d(ne,te),re.prototype={nodeName:"#comment",nodeType:x},d(re,te),ae.prototype={nodeName:"#cdata-section",nodeType:f},d(ae,te),ie.prototype.nodeType=v,d(ie,L),se.prototype.nodeType=k,d(se,L),oe.prototype.nodeType=y,d(oe,L),le.prototype.nodeType=g,d(le,L),ue.prototype.nodeName="#document-fragment",ue.prototype.nodeType=w,d(ue,L),de.prototype.nodeType=b,d(de,L),ce.prototype.serializeToString=function(e,t,n){return he.call(e,t,n)},L.prototype.toString=he;try{if(Object.defineProperty){function xe(e){switch(e.nodeType){case h:case w:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(xe(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(R.prototype,"length",{get:function(){return P(this),this.$$length}}),Object.defineProperty(L.prototype,"textContent",{get:function(){return xe(this)},set:function(e){switch(this.nodeType){case h:case w:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),be=function(e,t,n){e["$$"+t]=n}}}catch(Ae){}t.DocumentType=ie,t.DOMException=E,t.DOMImplementation=F,t.Element=Q,t.Node=L,t.NodeList=N,t.XMLSerializer=ce},45:(e,t,n)=>{"use strict";var r=n(167).freeze;t.XML_ENTITIES=r({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),t.HTML_ENTITIES=r({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),t.entityMap=t.HTML_ENTITIES},969:(e,t,n)=>{var r=n(146);r.DOMImplementation,r.XMLSerializer,t.DOMParser=n(129).DOMParser},925:(e,t,n)=>{var r=n(167).NAMESPACE,a=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,i=new RegExp("[\\-\\.0-9"+a.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),s=new RegExp("^"+a.source+i.source+"*(?::"+a.source+i.source+"*)?$");function o(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,o)}function l(){}function u(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function d(e,t,n,a,i,s){function o(e,t,r){n.attributeNames.hasOwnProperty(e)&&s.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,i),r)}for(var l,u=++t,d=0;;){var c=e.charAt(u);switch(c){case"=":if(1===d)l=e.slice(t,u),d=3;else{if(2!==d)throw new Error("attribute equal must after attrName");d=3}break;case"'":case'"':if(3===d||1===d){if(1===d&&(s.warning('attribute value must after "="'),l=e.slice(t,u)),t=u+1,!((u=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");o(l,h=e.slice(t,u),t-1),d=5}else{if(4!=d)throw new Error('attribute value must after "="');o(l,h=e.slice(t,u),t),s.warning('attribute "'+l+'" missed start quot('+c+")!!"),t=u+1,d=5}break;case"/":switch(d){case 0:n.setTagName(e.slice(t,u));case 5:case 6:case 7:d=7,n.closed=!0;case 4:case 1:break;case 2:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==d&&n.setTagName(e.slice(t,u)),u;case">":switch(d){case 0:n.setTagName(e.slice(t,u));case 5:case 6:case 7:break;case 4:case 1:"/"===(h=e.slice(t,u)).slice(-1)&&(n.closed=!0,h=h.slice(0,-1));case 2:2===d&&(h=l),4==d?(s.warning('attribute "'+h+'" missed quot(")!'),o(l,h,t)):(r.isHTML(a[""])&&h.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+h+'" missed value!! "'+h+'" instead!!'),o(h,h,t));break;case 3:throw new Error("attribute value missed!!")}return u;case"":c=" ";default:if(c<=" ")switch(d){case 0:n.setTagName(e.slice(t,u)),d=6;break;case 1:l=e.slice(t,u),d=2;break;case 4:var h=e.slice(t,u);s.warning('attribute "'+h+'" missed quot(")!!'),o(l,h,t);case 5:d=6}else switch(d){case 2:n.tagName,r.isHTML(a[""])&&l.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+l+'" missed value!! "'+l+'" instead2!!'),o(l,l,t),t=u,d=1;break;case 5:s.warning('attribute space is required"'+l+'"!!');case 6:d=1,t=u;break;case 3:d=4,t=u;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function c(e,t,n){for(var a=e.tagName,i=null,s=e.length;s--;){var o=e[s],l=o.qName,u=o.value;if((p=l.indexOf(":"))>0)var d=o.prefix=l.slice(0,p),c=l.slice(p+1),h="xmlns"===d&&c;else c=l,d=null,h="xmlns"===l&&"";o.localName=c,!1!==h&&(null==i&&(i={},m(n,n={})),n[h]=i[h]=u,o.uri=r.XMLNS,t.startPrefixMapping(h,u))}for(s=e.length;s--;)(d=(o=e[s]).prefix)&&("xml"===d&&(o.uri=r.XML),"xmlns"!==d&&(o.uri=n[d||""]));var p;(p=a.indexOf(":"))>0?(d=e.prefix=a.slice(0,p),c=e.localName=a.slice(p+1)):(d=null,c=e.localName=a);var f=e.uri=n[d||""];if(t.startElement(f,c,a,e),!e.closed)return e.currentNSMap=n,e.localNSMap=i,!0;if(t.endElement(f,c,a),i)for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&t.endPrefixMapping(d)}function h(e,t,n,r,a){if(/^(?:script|textarea)$/i.test(n)){var i=e.indexOf("</"+n+">",t),s=e.substring(t+1,i);if(/[&<]/.test(s))return/^script$/i.test(n)?(a.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,r),a.characters(s,0,s.length),i)}return t+1}function p(e,t,n,r){var a=r[n];return null==a&&((a=e.lastIndexOf("</"+n+">"))<t&&(a=e.lastIndexOf("</"+n)),r[n]=a),a<t}function m(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function f(e,t,n,r){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(a=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,a-t-4),a+3):(r.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var a=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,a-t-9),n.endCDATA(),a+3}var i=function(e,t){var n,r=[],a=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(a.lastIndex=t,a.exec(e);n=a.exec(e);)if(r.push(n),n[1])return r}(e,t),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var o=i[1][0],l=!1,u=!1;s>3&&(/^public$/i.test(i[2][0])?(l=i[3][0],u=s>4&&i[4][0]):/^system$/i.test(i[2][0])&&(u=i[3][0]));var d=i[s-1];return n.startDTD(o,l,u),n.endDTD(),d.index+d[0].length}return-1}function g(e,t,n){var r=e.indexOf("?>",t);if(r){var a=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return a?(a[0].length,n.processingInstruction(a[1],a[2]),r+2):-1}return-1}function y(){this.attributeNames={}}o.prototype=new Error,o.prototype.name=o.name,l.prototype={parse:function(e,t,n){var a=this.domBuilder;a.startDocument(),m(t,t={}),function(e,t,n,a,i){function s(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function l(t){if(t>S){var n=e.substring(S,t).replace(/&#?\w+;/g,s);v&&m(S),a.characters(n,0,t-S),S=t}}function m(t,n){for(;t>=x&&(n=A.exec(e));)b=n.index,x=b+n[0].length,v.lineNumber++;v.columnNumber=t-b+1}for(var b=0,x=0,A=/.*(?:\r\n?|\n)|.*$/g,v=a.locator,w=[{currentNSMap:t}],k={},S=0;;){try{var T=e.indexOf("<",S);if(T<0){if(!e.substr(S).match(/^\s*$/)){var _=a.doc,I=_.createTextNode(e.substr(S));_.appendChild(I),a.currentElement=I}return}switch(T>S&&l(T),e.charAt(T+1)){case"/":var C=e.indexOf(">",T+3),E=e.substring(T+2,C).replace(/[ \t\n\r]+$/g,""),N=w.pop();C<0?(E=e.substring(T+2).replace(/[\s<].*/,""),i.error("end tag name: "+E+" is not complete:"+N.tagName),C=T+1+E.length):E.match(/\s</)&&(E=E.replace(/[\s<].*/,""),i.error("end tag name: "+E+" maybe not complete"),C=T+1+E.length);var R=N.localNSMap,P=N.tagName==E;if(P||N.tagName&&N.tagName.toLowerCase()==E.toLowerCase()){if(a.endElement(N.uri,N.localName,E),R)for(var D in R)Object.prototype.hasOwnProperty.call(R,D)&&a.endPrefixMapping(D);P||i.fatalError("end tag name: "+E+" is not match the current start tagName:"+N.tagName)}else w.push(N);C++;break;case"?":v&&m(T),C=g(e,T,a);break;case"!":v&&m(T),C=f(e,T,a,i);break;default:v&&m(T);var M=new y,O=w[w.length-1].currentNSMap,$=(C=d(e,T,M,O,s,i),M.length);if(!M.closed&&p(e,C,M.tagName,k)&&(M.closed=!0,n.nbsp||i.warning("unclosed xml attribute")),v&&$){for(var F=u(v,{}),L=0;L<$;L++){var z=M[L];m(z.offset),z.locator=u(v,{})}a.locator=F,c(M,a,O)&&w.push(M),a.locator=v}else c(M,a,O)&&w.push(M);r.isHTML(M.uri)&&!M.closed?C=h(e,C,M.tagName,s,a):C++}}catch(e){if(e instanceof o)throw e;i.error("element parse error: "+e),C=-1}C>S?S=C:l(Math.max(T,S)+1)}}(e,t,n,a,this.errorHandler),a.endDocument()}},y.prototype={setTagName:function(e){if(!s.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!s.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=l,t.ParseError=o},144:(e,t,n)=>{var r,a=void 0!==n.g?n.g:"undefined"!=typeof window?window:{},i=n(893);"undefined"!=typeof document?r=document:(r=a["__GLOBAL_DOCUMENT_CACHE@4"])||(r=a["__GLOBAL_DOCUMENT_CACHE@4"]=i),e.exports=r},908:(e,t,n)=>{var r;r="undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},e.exports=r},376:e=>{e.exports=function(e){if(!e)return!1;var n=t.call(e);return"[object Function]"===n||"function"==typeof e&&"[object RegExp]"!==n||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var t=Object.prototype.toString},537:(e,t)=>{function n(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return s[e];var n,i=String(e);return(n=r[i.toLowerCase()])?n:(n=a[i.toLowerCase()])||(1===i.length?i.charCodeAt(0):void 0)}n.isEventKey=function(e,t){if(e&&"object"==typeof e){var n=e.which||e.keyCode||e.charCode;if(null==n)return!1;if("string"==typeof t){var i;if(i=r[t.toLowerCase()])return i===n;if(i=a[t.toLowerCase()])return i===n}else if("number"==typeof t)return t===n;return!1}};var r=(t=e.exports=n).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},a=t.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(i=97;i<123;i++)r[String.fromCharCode(i)]=i-32;for(var i=48;i<58;i++)r[i-48]=i;for(i=1;i<13;i++)r["f"+i]=i+111;for(i=0;i<10;i++)r["numpad "+i]=i+96;var s=t.names=t.title={};for(i in r)s[r[i]]=i;for(var o in a)r[o]=a[o]},221:(e,t,n)=>{var r=n(894).getUint64;e.exports=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},a=12;0===n.version?(n.earliestPresentationTime=t.getUint32(a),n.firstOffset=t.getUint32(a+4),a+=8):(n.earliestPresentationTime=r(e.subarray(a)),n.firstOffset=r(e.subarray(a+8)),a+=16),a+=2;var i=t.getUint16(a);for(a+=2;i>0;a+=12,i--)n.references.push({referenceType:(128&e[a])>>>7,referencedSize:2147483647&t.getUint32(a),subsegmentDuration:t.getUint32(a+4),startsWithSap:!!(128&e[a+8]),sapType:(112&e[a+8])>>>4,sapDeltaTime:268435455&t.getUint32(a+8)});return n}},489:e=>{var t,n,r,a,i,s,o,l=9e4;t=function(e){return e*l},n=function(e,t){return e*t},r=function(e){return e/l},a=function(e,t){return e/t},i=function(e,n){return t(a(e,n))},s=function(e,t){return n(r(e),t)},o=function(e,t,n){return r(n?e:e-t)},e.exports={ONE_SECOND_IN_TS:l,secondsToVideoTs:t,secondsToAudioTs:n,videoTsToSeconds:r,audioTsToSeconds:a,audioTsToVideoTs:i,videoTsToAudioTs:s,metadataTsToSeconds:o}},894:e=>{var t=Math.pow(2,32);e.exports={getUint64:function(e){var n,r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.getBigUint64?(n=r.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(n):n:r.getUint32(0)*t+r.getUint32(4)},MAX_UINT32:t}},974:e=>{e.exports=function(e,t){var n,r=null;try{n=JSON.parse(e,t)}catch(e){r=e}return[r,n]}},945:function(e){var t,n,r,a,i;t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var a=i.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");return a.path=i.normalizePath(a.path),i.buildURLFromParts(a)}var s=i.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return r.alwaysNormalize?(s.path=i.normalizePath(s.path),i.buildURLFromParts(s)):t;var o=i.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var d=o.path,c=d.substring(0,d.lastIndexOf("/")+1)+s.path;u.path=i.normalizePath(c)}else u.path=o.path,s.params||(u.params=o.params,s.query||(u.query=o.query));return null===u.path&&(u.path=r.alwaysNormalize?i.normalizePath(s.path):s.path),i.buildURLFromParts(u)},parseURL:function(e){var n=t.exec(e);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=i},407:(e,t,n)=>{var r=n(908),a=e.exports={WebVTT:n(706),VTTCue:n(230),VTTRegion:n(710)};r.vttjs=a,r.WebVTT=a.WebVTT;var i=a.VTTCue,s=a.VTTRegion,o=r.VTTCue,l=r.VTTRegion;a.shim=function(){r.VTTCue=i,r.VTTRegion=s},a.restore=function(){r.VTTCue=o,r.VTTRegion=l},r.VTTCue||a.shim()},706:(e,t,n)=>{var r=n(144),a=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function i(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function s(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function o(){this.values=a(null)}function l(e,t,n,r){var a=r?e.split(r):[e];for(var i in a)if("string"==typeof a[i]){var s=a[i].split(n);2===s.length&&t(s[0].trim(),s[1].trim())}}function u(e,t,n){var r=e;function a(){var t=s(e);if(null===t)throw new i(i.Errors.BadTimeStamp,"Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function u(){e=e.replace(/^\s+/,"")}if(u(),t.startTime=a(),u(),"--\x3e"!==e.substr(0,3))throw new i(i.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),u(),t.endTime=a(),u(),function(e,t){var r=new o;l(e,(function(e,t){switch(e){case"region":for(var a=n.length-1;a>=0;a--)if(n[a].id===t){r.set(e,n[a].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),s=i[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start","center","end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start","center","end"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start","center","end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");try{t.line=r.get("line","auto")}catch(e){}t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100);try{t.align=r.get("align","center")}catch(e){t.align=r.get("align","middle")}try{t.position=r.get("position","auto")}catch(e){t.position=r.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=r.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}i.prototype=a(Error.prototype),i.prototype.constructor=i,i.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},o.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var d=r.createElement&&r.createElement("textarea"),c={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},p={v:"title",lang:"lang"},m={rt:"ruby"};function f(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]*>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function r(e,t){return!m[t.localName]||m[t.localName]===e.localName}function a(t,n){var r=c[t];if(!r)return null;var a=e.document.createElement(r),i=p[t];return i&&n&&(a[i]=n.trim()),a}for(var i,o,l=e.document.createElement("div"),u=l,f=[];null!==(i=n());)if("<"!==i[0])u.appendChild(e.document.createTextNode((o=i,d.innerHTML=o,o=d.textContent,d.textContent="",o)));else{if("/"===i[1]){f.length&&f[f.length-1]===i.substr(2).replace(">","")&&(f.pop(),u=u.parentNode);continue}var g,y=s(i.substr(1,i.length-2));if(y){g=e.document.createProcessingInstruction("timestamp",y),u.appendChild(g);continue}var b=i.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!b)continue;if(!(g=a(b[1],b[3])))continue;if(!r(u,g))continue;if(b[2]){var x=b[2].split(".");x.forEach((function(e){var t=/^bg_/.test(e),n=t?e.slice(3):e;if(h.hasOwnProperty(n)){var r=t?"background-color":"color",a=h[n];g.style[r]=a}})),g.className=x.join(" ")}f.push(b[1]),u.appendChild(g),u=g}return l}var g=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function y(e){for(var t=0;t<g.length;t++){var n=g[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function b(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function r(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function a(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var i=n.match(/^.*(\n|\r)/);return i?(e.length=0,i[0]):n}return"ruby"===t.tagName?a(e):t.childNodes?(r(e,t),a(e)):void 0}for(r(t,e);n=a(t);)for(var i=0;i<n.length;i++)if(y(n.charCodeAt(i)))return"rtl";return"ltr"}function x(){}function A(e,t,n){x.call(this),this.cue=t,this.cueDiv=f(e,t.text);var r={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(r,this.cueDiv),this.div=e.document.createElement("div"),r={direction:b(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(r),this.div.appendChild(this.cueDiv);var a=0;switch(t.positionAlign){case"start":a=t.position;break;case"center":a=t.position-t.size/2;break;case"end":a=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(a,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(a,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function v(e){var t,n,r,a;if(e.div){n=e.div.offsetHeight,r=e.div.offsetWidth,a=e.div.offsetTop;var i=(i=e.div.childNodes)&&(i=i[0])&&i.getClientRects&&i.getClientRects();e=e.div.getBoundingClientRect(),t=i?Math.max(i[0]&&i[0].height||0,e.height/i.length):0}this.left=e.left,this.right=e.right,this.top=e.top||a,this.height=e.height||n,this.bottom=e.bottom||a+(e.height||n),this.width=e.width||r,this.lineHeight=void 0!==t?t:e.lineHeight}function w(e,t,n,r){var a=new v(t),i=t.cue,s=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,r=0,a=0;a<n.length&&n[a]!==t;a++)"showing"===n[a].mode&&r++;return-1*++r}(i),o=[];if(i.snapToLines){var l;switch(i.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width"}var u=a.lineHeight,d=u*Math.round(s),c=n[l]+u,h=o[0];Math.abs(d)>c&&(d=d<0?-1:1,d*=Math.ceil(c/u)*u),s<0&&(d+=""===i.vertical?n.height:n.width,o=o.reverse()),a.move(h,d)}else{var p=a.lineHeight/n.height*100;switch(i.lineAlign){case"center":s-=p/2;break;case"end":s-=p}switch(i.vertical){case"":t.applyStyles({top:t.formatStyle(s,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(s,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(s,"%")})}o=["+y","-x","+x","-y"],a=new v(t)}var m=function(e,t){for(var a,i=new v(e),s=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(n,t[o])||e.within(n)&&e.overlapsAny(r);)e.move(t[o]);if(e.within(n))return e;var l=e.intersectPercentage(n);s>l&&(a=new v(e),s=l),e=new v(i)}return a||i}(a,o);t.move(m.toCSSCompatValues(n))}function k(){}x.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},x.prototype.formatStyle=function(e,t){return 0===e?0:e+t},A.prototype=a(x.prototype),A.prototype.constructor=A,v.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},v.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},v.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},v.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},v.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},v.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},v.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},v.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,r=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||r,height:e.height||t,bottom:e.bottom||r+(e.height||t),width:e.width||n}},k.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},k.convertCueToDOMTree=function(e,t){return e&&t?f(e,t):null},k.processCues=function(e,t,n){if(!e||!t||!n)return null;for(;n.firstChild;)n.removeChild(n.firstChild);var r=e.document.createElement("div");if(r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin="1.5%",n.appendChild(r),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var a=[],i=v.getSimpleBoxPosition(r),s={font:Math.round(.05*i.height*100)/100+"px sans-serif"};!function(){for(var n,o,l=0;l<t.length;l++)o=t[l],n=new A(e,o,s),r.appendChild(n.div),w(0,n,i,a),o.displayState=n.div,a.push(v.getSimpleBoxPosition(n))}()}else for(var o=0;o<t.length;o++)r.appendChild(t[o].displayState)},k.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},k.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof i))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t,n=this;function r(){for(var e=n.buffer,t=0;t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,n.buffer=e.substr(t),r}e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));try{var a;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;var d=(a=r()).match(/^WEBVTT([ \t].*)?$/);if(!d||!d[0])throw new i(i.Errors.BadSignature);n.state="HEADER"}for(var c=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(c?c=!1:a=r(),n.state){case"HEADER":/:/.test(a)?(t=a).match(/X-TIMESTAMP-MAP/)?l(t,(function(e,t){"X-TIMESTAMP-MAP"===e&&function(e){var t=new o;l(e,(function(e,n){switch(e){case"MPEGT":t.integer(e+"S",n);break;case"LOCA":t.set(e+"L",s(n))}}),/[^\d]:/,/,/),n.ontimestampmap&&n.ontimestampmap({MPEGTS:t.get("MPEGTS"),LOCAL:t.get("LOCAL")})}(t)}),/=/):l(t,(function(e,t){"Region"===e&&function(e){var t=new o;if(l(e,(function(e,n){switch(e){case"id":t.set(e,n);break;case"width":t.percent(e,n);break;case"lines":t.integer(e,n);break;case"regionanchor":case"viewportanchor":var r=n.split(",");if(2!==r.length)break;var a=new o;if(a.percent("x",r[0]),a.percent("y",r[1]),!a.has("x")||!a.has("y"))break;t.set(e+"X",a.get("x")),t.set(e+"Y",a.get("y"));break;case"scroll":t.alt(e,n,["up"])}}),/=/,/\s/),t.has("id")){var r=new(n.vttjs.VTTRegion||n.window.VTTRegion);r.width=t.get("width",100),r.lines=t.get("lines",3),r.regionAnchorX=t.get("regionanchorX",0),r.regionAnchorY=t.get("regionanchorY",100),r.viewportAnchorX=t.get("viewportanchorX",0),r.viewportAnchorY=t.get("viewportanchorY",100),r.scroll=t.get("scroll",""),n.onregion&&n.onregion(r),n.regionList.push({id:t.get("id"),region:r})}}(t)}),/:/):a||(n.state="ID");continue;case"NOTE":a||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){n.state="NOTE";break}if(!a)continue;n.cue=new(n.vttjs.VTTCue||n.window.VTTCue)(0,0,"");try{n.cue.align="center"}catch(e){n.cue.align="middle"}if(n.state="CUE",-1===a.indexOf("--\x3e")){n.cue.id=a;continue}case"CUE":try{u(a,n.cue,n.regionList)}catch(e){n.reportOrThrowError(e),n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var h=-1!==a.indexOf("--\x3e");if(!a||h&&(c=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=a.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":a||(n.state="ID");continue}}}catch(e){n.reportOrThrowError(e),"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new i(i.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.exports=k},230:e=>{var t={"":1,lr:1,rl:1},n={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function r(e){return"string"==typeof e&&!!n[e.toLowerCase()]&&e.toLowerCase()}function a(e,n,a){this.hasBeenReset=!1;var i="",s=!1,o=e,l=n,u=a,d=null,c="",h=!0,p="auto",m="start",f="auto",g="auto",y=100,b="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return i},set:function(e){i=""+e}},pauseOnExit:{enumerable:!0,get:function(){return s},set:function(e){s=!!e}},startTime:{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");o=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return u},set:function(e){u=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return d},set:function(e){d=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return c},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");c=n,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return h},set:function(e){h=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return p},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return m},set:function(e){var t=r(e);t?(m=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return f},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");f=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return g},set:function(e){var t=r(e);t?(g=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return b},set:function(e){var t=r(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");b=t,this.hasBeenReset=!0}}}),this.displayState=void 0}a.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.exports=a},710:e=>{var t={"":!0,up:!0};function n(e){return"number"==typeof e&&e>=0&&e<=100}e.exports=function(){var e=100,r=3,a=0,i=100,s=0,o=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!n(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return r},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");r=e}},regionAnchorY:{enumerable:!0,get:function(){return i},set:function(e){if(!n(e))throw new Error("RegionAnchorX must be between 0 and 100.");i=e}},regionAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!n(e))throw new Error("RegionAnchorY must be between 0 and 100.");a=e}},viewportAnchorY:{enumerable:!0,get:function(){return o},set:function(e){if(!n(e))throw new Error("ViewportAnchorY must be between 0 and 100.");o=e}},viewportAnchorX:{enumerable:!0,get:function(){return s},set:function(e){if(!n(e))throw new Error("ViewportAnchorX must be between 0 and 100.");s=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);!1===n?console.warn("Scroll: an invalid or illegal string was specified."):l=n}}})}},893:()=>{},434:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(this,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return a[e].call(n.exports,n,n.exports,s),n.exports}s.amdO={},e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s.a=(a,i,s)=>{var o;s&&((o=[]).d=1);var l,u,d,c=new Set,h=a.exports,p=new Promise(((e,t)=>{d=t,u=e}));p[t]=h,p[e]=e=>(o&&e(o),c.forEach(e),p.catch((e=>{}))),a.exports=p,i((a=>{var i;l=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var i=[];i.d=0,a.then((e=>{s[t]=e,r(i)}),(e=>{s[n]=e,r(i)}));var s={};return s[e]=e=>e(i),s}}var o={};return o[e]=e=>{},o[t]=a,o})))(a);var s=()=>l.map((e=>{if(e[n])throw e[n];return e[t]})),u=new Promise((t=>{(i=()=>t(s)).r=0;var n=e=>e!==o&&!c.has(e)&&(c.add(e),e&&!e.d&&(i.r++,e.push(i)));l.map((t=>t[e](n)))}));return i.r?u:s()}),(e=>(e?d(p[n]=e):u(h),r(o)))),o&&(o.d=0)},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s(819)})();